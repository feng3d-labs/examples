{"version":3,"file":"index.min.js","sources":["../node_modules/.pnpm/@feng3d+objectview@0.5.0/node_modules/@feng3d/objectview/src/ObjectView.ts","../node_modules/.pnpm/@feng3d+polyfill@0.5.0/node_modules/@feng3d/polyfill/src/Array.ts","../node_modules/.pnpm/@feng3d+polyfill@0.5.0/node_modules/@feng3d/polyfill/src/ArrayUtils.ts","../node_modules/.pnpm/@feng3d+polyfill@0.5.0/node_modules/@feng3d/polyfill/src/ObjectUtils.ts","../node_modules/.pnpm/@feng3d+polyfill@0.5.0/node_modules/@feng3d/polyfill/src/ClassUtils.ts","../node_modules/.pnpm/@feng3d+polyfill@0.5.0/node_modules/@feng3d/polyfill/src/DataTransform.ts","../node_modules/.pnpm/@feng3d+polyfill@0.5.0/node_modules/@feng3d/polyfill/src/MapUtils.ts","../node_modules/.pnpm/@feng3d+polyfill@0.5.0/node_modules/@feng3d/polyfill/src/MathUtil.ts","../node_modules/.pnpm/@feng3d+polyfill@0.5.0/node_modules/@feng3d/polyfill/src/Types.ts","../node_modules/.pnpm/@feng3d+serialization@0.5.0/node_modules/@feng3d/serialization/src/Serialization.ts","../node_modules/.pnpm/@feng3d+watcher@0.5.0/node_modules/@feng3d/watcher/src/watcher.ts","../node_modules/.pnpm/@feng3d+event@0.5.0/node_modules/@feng3d/event/src/EventEmitter.ts","../node_modules/.pnpm/@feng3d+event@0.5.0/node_modules/@feng3d/event/src/AnyEmitter.ts","../node_modules/.pnpm/@feng3d+event@0.5.0/node_modules/@feng3d/event/src/GlobalEmitter.ts","../node_modules/.pnpm/@feng3d+event@0.5.0/node_modules/@feng3d/event/src/ObjectEmitter.ts","../node_modules/.pnpm/@feng3d+bezier@0.5.0/node_modules/@feng3d/bezier/src/EquationSolving.ts","../node_modules/.pnpm/@feng3d+bezier@0.5.0/node_modules/@feng3d/bezier/src/Bezier.ts","../node_modules/.pnpm/@feng3d+bezier@0.5.0/node_modules/@feng3d/bezier/src/HighFunction.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/buildLineGeometry.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/Time.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/MathF.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/geom/Vector2.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/geom/Vector3.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/Color3.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/geom/Vector4.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/Color4.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/curve/WrapMode.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/curve/BezierCurve.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/curve/AnimationCurve.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/curve/MinMaxCurveMode.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/curve/AnimationCurveVector3.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/curve/MinMaxCurve.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/enums/CoordinateSystem.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/enums/PlaneClassification.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/enums/RotationOrder.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/curve/MinMaxCurveVector3.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/geom/Line3.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/geom/Plane.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/geom/Segment3.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/geom/Triangle3.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/geom/Box3.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/geom/Matrix3x3.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/geom/Quaternion.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/geom/Ray3.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/geom/Matrix4x4.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/gradient/GradientMode.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/geom/Euler.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/geom/Frustum.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/geom/Rectangle.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/geom/Sphere.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/geom/TriangleGeometry.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/gradient/Gradient.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/gradient/MinMaxGradientMode.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/gradient/MinMaxGradient.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/Noise.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/shape/core/Curve.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/shape/curves/LineCurve2.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/shape/core/CurvePath.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/shape/Earcut.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/shape/ShapeUtils.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/shape/core/Interpolations.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/shape/curves/CubicBezierCurve2.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/shape/curves/EllipseCurve2.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/shape/curves/QuadraticBezierCurve2.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/shape/curves/SplineCurve2.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/shape/core/Path2.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/shape/core/Shape2.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/shape/core/ShapePath2.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/shape/core/Font.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/shape/curves/ArcCurve2.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/enums/AttributeUsage.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/enums/GLArrayType.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/shape/curves/CatmullRomCurve3.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/shape/curves/CubicBezierCurve3.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/shape/curves/LineCurve3.ts","../node_modules/.pnpm/@feng3d+math@0.5.0/node_modules/@feng3d/math/src/shape/curves/QuadraticBezierCurve3.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/data/Texture.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/enums/BlendEquation.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/enums/BlendFactor.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/enums/ColorMask.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/enums/CullFace.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/enums/DepthFunc.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/enums/FrontFace.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/enums/RenderMode.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/enums/StencilFunc.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/enums/StencilOp.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/GLCache.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/GLCapabilities.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/GLExtension.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/WebGLRenderer.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/data/Attribute.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/data/FrameBuffer.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/data/Index.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/data/RenderParams.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/enums/TextureDataType.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/enums/TextureFormat.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/enums/TextureMagFilter.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/enums/TextureMinFilter.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/enums/TextureType.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/gl/enums/TextureWrap.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/shader/ShaderMacroUtils.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/shader/ShaderLib.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/data/Shader.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/data/RenderAtomic.ts","../node_modules/.pnpm/@feng3d+renderer@0.5.0/node_modules/@feng3d/renderer/src/RenderBuffer.ts","../node_modules/.pnpm/@feng3d+filesystem@0.5.0/node_modules/@feng3d/filesystem/src/base/LoaderDataFormat.ts","../node_modules/.pnpm/@feng3d+task@0.5.0/node_modules/@feng3d/task/src/Task.ts","../node_modules/.pnpm/@feng3d+filesystem@0.5.0/node_modules/@feng3d/filesystem/src/base/Loader.ts","../node_modules/.pnpm/@feng3d+filesystem@0.5.0/node_modules/@feng3d/filesystem/src/base/_IndexedDB.ts","../node_modules/.pnpm/@feng3d+filesystem@0.5.0/node_modules/@feng3d/filesystem/src/FS.ts","../node_modules/.pnpm/@feng3d+filesystem@0.5.0/node_modules/@feng3d/filesystem/src/FSType.ts","../node_modules/.pnpm/@feng3d+filesystem@0.5.0/node_modules/@feng3d/filesystem/src/HttpFS.ts","../node_modules/.pnpm/@feng3d+filesystem@0.5.0/node_modules/@feng3d/filesystem/src/IndexedDBFS.ts","../node_modules/.pnpm/@feng3d+filesystem@0.5.0/node_modules/@feng3d/filesystem/src/PathUtils.ts","../node_modules/.pnpm/@feng3d+filesystem@0.5.0/node_modules/@feng3d/filesystem/src/ReadFS.ts","../node_modules/.pnpm/@feng3d+filesystem@0.5.0/node_modules/@feng3d/filesystem/src/ReadWriteFS.ts","../node_modules/.pnpm/@feng3d+shortcut@0.5.0/node_modules/@feng3d/shortcut/src/EventProxy.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/core/RunEnvironment.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/core/HideFlags.ts","../node_modules/.pnpm/@feng3d+shortcut@0.5.0/node_modules/@feng3d/shortcut/src/handle/KeyState.ts","../node_modules/.pnpm/@feng3d+shortcut@0.5.0/node_modules/@feng3d/shortcut/src/handle/ShortCutCapture.ts","../node_modules/.pnpm/@feng3d+shortcut@0.5.0/node_modules/@feng3d/shortcut/src/Keyboard.ts","../node_modules/.pnpm/@feng3d+shortcut@0.5.0/node_modules/@feng3d/shortcut/src/WindowEventProxy.ts","../node_modules/.pnpm/@feng3d+shortcut@0.5.0/node_modules/@feng3d/shortcut/src/handle/KeyCapture.ts","../node_modules/.pnpm/@feng3d+shortcut@0.5.0/node_modules/@feng3d/shortcut/src/ShortCut.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/core/Feng3dObject.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/component/Component.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/component/Behaviour.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/Menu.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/assets/AssetType.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/animation/AnimationClip.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/animation/PropertyClip.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/animation/Animation.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/animators/skeleton/Skeleton.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/menu/CreateNodeMenu.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/core/BoundingBox.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/utils/Path.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/utils/Ticker.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/assets/FileAsset.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/assets/FolderAsset.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/assets/rs/ReadRS.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/core/AssetData.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/geometry/GeometryUtils.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/light/shadow/ShadowType.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/geometry/Geometry.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/light/pickers/LightPicker.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/textures/Texture2D.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/render/data/TextureInfo.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/utils/ImageUtil.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/textures/TextureCube.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/materials/StandardMaterial.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/materials/Material.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/core/RayCastable.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/core/Renderable.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/core/ScriptComponent.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/core/Transform.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/core/GameObject.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/animators/skeleton/SkeletonComponent.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/animators/skeleton/SkinnedMeshRenderer.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/assets/rs/ReadWriteRS.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/audio/AudioListener.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/audio/AudioSource.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/cameras/Projection.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/cameras/lenses/LensBase.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/cameras/lenses/OrthographicLens.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/cameras/lenses/PerspectiveLens.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/cameras/Camera.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/component/BillboardComponent.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/component/CartoonComponent.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/component/Graphics.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/component/HoldSizeComponent.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/component/OutLineComponent.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/component/WireframeComponent.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/controllers/ControllerBase.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/controllers/FPSController.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/controllers/LookAtController.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/controllers/HoverController.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/core/MeshRenderer.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/pick/Raycaster.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/core/Mouse3DManager.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/core/Script.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/core/TransformLayout.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/primitives/PlaneGeometry.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/textures/RenderTargetTexture2D.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/light/LightType.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/render/FrameBufferObject.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/light/Light.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/light/DirectionalLight.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/render/renderer/ForwardRenderer.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/render/renderer/OutlineRenderer.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/render/renderer/ShadowRenderer.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/render/renderer/WireframeRenderer.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/light/PointLight.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/light/SpotLight.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/skybox/SkyBox.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/scene/ScenePickCache.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/scene/Scene.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/skybox/SkyBoxRenderer.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/core/View.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/geometry/CustomGeometry.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/geometry/PointGeometry.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/geometry/SegmentGeometry.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/materials/ColorMaterial.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/materials/PointMaterial.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/materials/SegmentMaterial.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/materials/TextureMaterial.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/primitives/CapsuleGeometry.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/primitives/CylinderGeometry.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/primitives/ConeGeometry.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/primitives/CubeGeometry.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/primitives/ParametricGeometry.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/primitives/QuadGeometry.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/primitives/SphereGeometry.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/primitives/TorusGeometry.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/render/renderer/MouseRenderer.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/render/shader/ShaderLib.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/scene/SceneUtil.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/ShaderConfig.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/textures/CanvasTexture2D.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/textures/ImageDataTexture2D.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/textures/ImageTexture2D.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/textures/VideoTexture2D.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/utils/Uuid.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/utils/FunctionWarp.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/utils/debug.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/utils/RegExps.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/utils/Stats.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/water/Water.ts","../node_modules/.pnpm/@feng3d+core@0.5.0/node_modules/@feng3d/core/src/water/WaterMaterial.ts","../node_modules/.pnpm/@feng3d+assets@0.5.0/node_modules/@feng3d/assets/src/ArrayBufferAsset.ts","../node_modules/.pnpm/@feng3d+assets@0.5.0/node_modules/@feng3d/assets/src/assets/AudioAsset.ts","../node_modules/.pnpm/@feng3d+assets@0.5.0/node_modules/@feng3d/assets/src/ObjectAsset.ts","../node_modules/.pnpm/@feng3d+assets@0.5.0/node_modules/@feng3d/assets/src/assets/GameObjectAsset.ts","../node_modules/.pnpm/@feng3d+assets@0.5.0/node_modules/@feng3d/assets/src/assets/GeometryAsset.ts","../node_modules/.pnpm/@feng3d+assets@0.5.0/node_modules/@feng3d/assets/src/assets/TextAsset.ts","../node_modules/.pnpm/@feng3d+assets@0.5.0/node_modules/@feng3d/assets/src/assets/JSAsset.ts","../node_modules/.pnpm/@feng3d+assets@0.5.0/node_modules/@feng3d/assets/src/assets/JsonAsset.ts","../node_modules/.pnpm/@feng3d+assets@0.5.0/node_modules/@feng3d/assets/src/assets/MaterialAsset.ts","../node_modules/.pnpm/@feng3d+assets@0.5.0/node_modules/@feng3d/assets/src/assets/ScriptAsset.ts","../node_modules/.pnpm/@feng3d+assets@0.5.0/node_modules/@feng3d/assets/src/assets/ShaderAsset.ts","../node_modules/.pnpm/@feng3d+assets@0.5.0/node_modules/@feng3d/assets/src/assets/TextureAsset.ts","../node_modules/.pnpm/@feng3d+assets@0.5.0/node_modules/@feng3d/assets/src/assets/TextureCubeAsset.ts","../node_modules/.pnpm/@feng3d+parsers@0.5.0/node_modules/@feng3d/parsers/src/converters/MD5AnimConverter.ts","../node_modules/.pnpm/@feng3d+parsers@0.5.0/node_modules/@feng3d/parsers/src/converters/OBJConverter.ts","../node_modules/.pnpm/@feng3d+parsers@0.5.0/node_modules/@feng3d/parsers/src/converters/MD5MeshConverter.ts","../node_modules/.pnpm/@feng3d+parsers@0.5.0/node_modules/@feng3d/parsers/src/converters/MTLConverter.ts","../node_modules/.pnpm/@feng3d+parsers@0.5.0/node_modules/@feng3d/parsers/src/parsers/MD5AnimParser.ts","../node_modules/.pnpm/@feng3d+parsers@0.5.0/node_modules/@feng3d/parsers/src/parsers/MD5MeshParser.ts","../node_modules/.pnpm/@feng3d+parsers@0.5.0/node_modules/@feng3d/parsers/src/loader/MD5Loader.ts","../node_modules/.pnpm/@feng3d+parsers@0.5.0/node_modules/@feng3d/parsers/src/parsers/mdl/MdlModel.ts","../node_modules/.pnpm/@feng3d+parsers@0.5.0/node_modules/@feng3d/parsers/src/parsers/mdl/War3Model.ts","../node_modules/.pnpm/@feng3d+parsers@0.5.0/node_modules/@feng3d/parsers/src/parsers/MDLParser.ts","../node_modules/.pnpm/@feng3d+parsers@0.5.0/node_modules/@feng3d/parsers/src/loader/MDLLoader.ts","../node_modules/.pnpm/@feng3d+parsers@0.5.0/node_modules/@feng3d/parsers/src/parsers/MTLParser.ts","../node_modules/.pnpm/@feng3d+parsers@0.5.0/node_modules/@feng3d/parsers/src/loader/MTLLoader.ts","../node_modules/.pnpm/@feng3d+parsers@0.5.0/node_modules/@feng3d/parsers/src/parsers/OBJParser.ts","../node_modules/.pnpm/@feng3d+parsers@0.5.0/node_modules/@feng3d/parsers/src/loader/OBJLoader.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/enums/ParticleSystemAnimationType.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/enums/ParticleSystemInheritVelocityMode.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/enums/ParticleSystemMeshShapeType.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/enums/ParticleSystemNoiseQuality.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/enums/ParticleSystemRenderMode.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/enums/ParticleSystemRenderSpace.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/enums/ParticleSystemScalingMode.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/enums/ParticleSystemShapeConeEmitFrom.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/enums/ParticleSystemShapeMultiModeValue.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/enums/ParticleSystemShapeType.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/enums/ParticleSystemShapeType1.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/enums/ParticleSystemSimulationSpace.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/enums/ParticleSystemSortMode.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/enums/ParticleSystemSubEmitterProperties.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/enums/ParticleSystemSubEmitterType.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/enums/SpriteMaskInteraction.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/enums/UVChannelFlags.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/modules/ParticleModule.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/shapes/ParticleSystemShapeBox.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/modules/ParticleColorBySpeedModule.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/modules/ParticleColorOverLifetimeModule.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/others/ParticleEmissionBurst.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/modules/ParticleEmissionModule.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/modules/ParticleForceOverLifetimeModule.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/modules/ParticleInheritVelocityModule.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/modules/ParticleLimitVelocityOverLifetimeModule.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/modules/ParticleMainModule.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/modules/ParticleNoiseModule.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/modules/ParticleRotationBySpeedModule.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/modules/ParticleRotationOverLifetimeModule.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/shapes/ParticleSystemShape.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/shapes/ParticleSystemShapeCircle.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/shapes/ParticleSystemShapeCone.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/shapes/ParticleSystemShapeEdge.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/shapes/ParticleSystemShapeHemisphere.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/shapes/ParticleSystemShapeSphere.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/modules/ParticleShapeModule.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/modules/ParticleSizeBySpeedModule.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/modules/ParticleSizeOverLifetimeModule.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/modules/ParticleSubEmittersModule.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/modules/ParticleSystemRenderer.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/modules/ParticleTextureSheetAnimationModule.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/modules/ParticleVelocityOverLifetimeModule.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/Particle.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/ParticlesAdditive.shader.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/ParticlesAlphaBlendedPremultiply.shader.ts","../node_modules/.pnpm/@feng3d+particlesystem@0.5.0/node_modules/@feng3d/particlesystem/src/ParticleSystem.ts","../node_modules/.pnpm/@feng3d+terrain@0.5.0/node_modules/@feng3d/terrain/src/Terrain.ts","../node_modules/.pnpm/@feng3d+terrain@0.5.0/node_modules/@feng3d/terrain/src/TerrainData.ts","../node_modules/.pnpm/@feng3d+terrain@0.5.0/node_modules/@feng3d/terrain/src/TerrainGeometry.ts","../node_modules/.pnpm/@feng3d+terrain@0.5.0/node_modules/@feng3d/terrain/src/TerrainMaterial.ts","../node_modules/.pnpm/@feng3d+terrain@0.5.0/node_modules/@feng3d/terrain/src/TerrainMergeMethod.ts","../node_modules/.pnpm/@feng3d+ui@0.5.0/node_modules/@feng3d/ui/src/core/Transform2D.ts","../node_modules/.pnpm/@feng3d+ui@0.5.0/node_modules/@feng3d/ui/src/Button.ts","../node_modules/.pnpm/@feng3d+ui@0.5.0/node_modules/@feng3d/ui/src/enums/UIRenderMode.ts","../node_modules/.pnpm/@feng3d+ui@0.5.0/node_modules/@feng3d/ui/src/core/Canvas.ts","../node_modules/.pnpm/@feng3d+ui@0.5.0/node_modules/@feng3d/ui/src/core/CanvasRenderer.ts","../node_modules/.pnpm/@feng3d+ui@0.5.0/node_modules/@feng3d/ui/src/core/UIGeometry.ts","../node_modules/.pnpm/@feng3d+ui@0.5.0/node_modules/@feng3d/ui/src/core/UIMaterial.ts","../node_modules/.pnpm/@feng3d+ui@0.5.0/node_modules/@feng3d/ui/src/Image.ts","../node_modules/.pnpm/@feng3d+ui@0.5.0/node_modules/@feng3d/ui/src/polyfill/View.ts","../node_modules/.pnpm/@feng3d+ui@0.5.0/node_modules/@feng3d/ui/src/Rect.ts","../node_modules/.pnpm/@feng3d+ui@0.5.0/node_modules/@feng3d/ui/src/text/TextMetrics.ts","../node_modules/.pnpm/@feng3d+ui@0.5.0/node_modules/@feng3d/ui/src/text/TextStyle.ts","../node_modules/.pnpm/@feng3d+ui@0.5.0/node_modules/@feng3d/ui/src/text/drawText.ts","../node_modules/.pnpm/@feng3d+ui@0.5.0/node_modules/@feng3d/ui/src/Text.ts","../src/index.ts"],"sourcesContent":["declare global\r\n{\r\n\tinterface MixinsOAVComponentParamMap\r\n\t{\r\n\t}\r\n}\r\n\r\n/**\r\n * 构造函数\r\n */\r\ntype Constructor<T> = (new (...args: any[]) => T);\r\n\r\n/**\r\n * 标记objectview对象界面类\r\n */\r\nexport function OVComponent(component?: string)\r\n{\r\n\treturn (constructor: Constructor<any>) =>\r\n\t{\r\n\t\tcomponent = component || constructor.name;\r\n\t\tobjectview.OVComponent[component] = constructor;\r\n\t};\r\n}\r\n\r\n/**\r\n * 标记objectview块界面类\r\n */\r\nexport function OBVComponent(component?: string)\r\n{\r\n\treturn (constructor: Constructor<any>) =>\r\n\t{\r\n\t\tcomponent = component || constructor.name;\r\n\t\tobjectview.OBVComponent[component] = constructor;\r\n\t};\r\n}\r\n\r\n/**\r\n * 标记objectview属性界面类\r\n */\r\nexport function OAVComponent(component?: string)\r\n{\r\n\treturn (constructor: Constructor<any>) =>\r\n\t{\r\n\t\tcomponent = component || constructor.name;\r\n\t\tobjectview.OAVComponent[component] = constructor;\r\n\t};\r\n}\r\n\r\n/**\r\n * objectview类装饰器\r\n */\r\nexport function ov<K extends keyof OVComponentParamMap>(param: { component?: K; componentParam?: OVComponentParamMap[K]; })\r\n{\r\n\treturn (constructor: Constructor<any>) =>\r\n\t{\r\n\t\tif (!Object.getOwnPropertyDescriptor(constructor.prototype, objectviewKey))\r\n\t\t{\r\n\t\t\tconstructor.prototype[objectviewKey] = {};\r\n\t\t}\r\n\t\tconst objectview: ClassDefinition = constructor.prototype[objectviewKey];\r\n\t\tobjectview.component = param.component as string;\r\n\t\tobjectview.componentParam = param.componentParam;\r\n\t};\r\n}\r\n\r\n// /**\r\n//  * objectview类装饰器\r\n//  */\r\n// export function obv<K extends keyof OBVComponentParam>(param: { name: string; component?: K; componentParam?: OBVComponentParam[K]; })\r\n// {\r\n//     return (constructor: Function) =>\r\n//     {\r\n//         if (!Object.getOwnPropertyDescriptor(constructor[\"prototype\"], OBJECTVIEW_KEY))\r\n//             constructor[\"prototype\"][OBJECTVIEW_KEY] = {};\r\n//         var objectview: ClassDefinition = constructor[\"prototype\"][OBJECTVIEW_KEY];\r\n//         var blockDefinitionVec: BlockDefinition[] = objectview.blockDefinitionVec = objectview.blockDefinitionVec || [];\r\n//         blockDefinitionVec.push({\r\n//             name: param.name,\r\n//             component: param.component,\r\n//             componentParam: param.componentParam,\r\n//         });\r\n//     }\r\n// }\r\n\r\nexport type OAVComponentParams = Partial<OAVComponentParamMap[keyof OAVComponentParamMap]> & {\r\n\r\n\t/**\r\n\t * 是否可编辑\r\n\t */\r\n\teditable?: boolean;\r\n\r\n\t/**\r\n\t * 所属块名称\r\n\t */\r\n\tblock?: string;\r\n\r\n\t/**\r\n\t * 提示信息\r\n\t */\r\n\ttooltip?: string;\r\n\r\n\t/**\r\n\t * 优先级，数字越小，显示越靠前，默认为0\r\n\t */\r\n\tpriority?: number;\r\n\r\n\t/**\r\n\t * 是否排除\r\n\t */\r\n\texclude?: boolean;\r\n};\r\n\r\n/**\r\n * objectview属性装饰器\r\n * @param param 参数\r\n */\r\nexport function oav(param?: OAVComponentParams)\r\n{\r\n\treturn (target: any, propertyKey: string) =>\r\n\t{\r\n\t\tobjectview.addOAV(target, propertyKey, param);\r\n\t};\r\n}\r\n\r\n/**\r\n * 对象界面\r\n */\r\nexport class ObjectView\r\n{\r\n\t/**\r\n\t * 默认基础类型对象界面类定义\r\n\t */\r\n\tdefaultBaseObjectViewClass = '';\r\n\t/**\r\n\t * 默认对象界面类定义\r\n\t */\r\n\tdefaultObjectViewClass = '';\r\n\t/**\r\n\t * 默认对象属性界面类定义\r\n\t */\r\n\tdefaultObjectAttributeViewClass = '';\r\n\t/**\r\n\t * 属性块默认界面\r\n\t */\r\n\tdefaultObjectAttributeBlockView = '';\r\n\t/**\r\n\t * 指定属性类型界面类定义字典（key:属性类名称,value:属性界面类定义）\r\n\t */\r\n\tdefaultTypeAttributeView = {};\r\n\tOAVComponent = {};\r\n\tOBVComponent = {};\r\n\tOVComponent = {};\r\n\tsetDefaultTypeAttributeView(type: string, component: AttributeTypeDefinition)\r\n\t{\r\n\t\tthis.defaultTypeAttributeView[type] = component;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取对象界面\r\n\t * @param object 用于生成界面的对象\r\n\t * @param param 参数\r\n\t */\r\n\tgetObjectView(object: any, param?: GetObjectViewParam): IObjectView\r\n\t{\r\n\t\tconst p: GetObjectViewParam = { autocreate: true, excludeAttrs: [] };\r\n\t\tObject.assign(p, param);\r\n\r\n\t\tconst classConfig = this.getObjectInfo(object, p.autocreate, p.excludeAttrs);\r\n\t\tclassConfig.editable = classConfig.editable === undefined ? true : classConfig.editable;\r\n\r\n\t\tObject.assign(classConfig, param);\r\n\r\n\t\t// 处理 exclude\r\n\t\tclassConfig.objectAttributeInfos = classConfig.objectAttributeInfos.filter((v) => !v.exclude);\r\n\t\tclassConfig.objectBlockInfos.forEach((v) =>\r\n\t\t{\r\n\t\t\tv.itemList = v.itemList.filter((vv) => !vv.exclude);\r\n\t\t});\r\n\r\n\t\tclassConfig.objectAttributeInfos.forEach((v) => { v.editable = v.editable && classConfig.editable; });\r\n\r\n\t\tif (objectIsEmpty(classConfig.component) || classConfig.component === '')\r\n\t\t{\r\n\t\t\t// 返回基础类型界面类定义\r\n\t\t\tif (!(classConfig.owner instanceof Object))\r\n\t\t\t{\r\n\t\t\t\tclassConfig.component = this.defaultBaseObjectViewClass;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t// 使用默认类型界面类定义\r\n\t\t\t\tclassConfig.component = this.defaultObjectViewClass;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst Cls = this.OVComponent[classConfig.component];\r\n\t\tconsole.assert(Cls !== null, `没有定义 ${classConfig.component} 对应的对象界面类，需要在 ${classConfig.component} 中使用@OVComponent()标记`);\r\n\t\tconst view = new Cls(classConfig);\r\n\r\n\t\treturn view;\r\n\t}\r\n\t/**\r\n\t * 获取属性界面\r\n\t *\r\n\t * @static\r\n\t * @param attributeViewInfo 属性界面信息\r\n\t * @returns                        属性界面\r\n\t *\r\n\t * @memberOf ObjectView\r\n\t */\r\n\tgetAttributeView(attributeViewInfo: AttributeViewInfo): IObjectAttributeView\r\n\t{\r\n\t\tif (objectIsEmpty(attributeViewInfo.component) || attributeViewInfo.component === '')\r\n\t\t{\r\n\t\t\tconst defaultViewClass = this.defaultTypeAttributeView[attributeViewInfo.type];\r\n\t\t\tconst tempComponent = defaultViewClass ? defaultViewClass.component : '';\r\n\t\t\tif (tempComponent !== null && tempComponent !== '')\r\n\t\t\t{\r\n\t\t\t\tattributeViewInfo.component = defaultViewClass.component;\r\n\t\t\t\tattributeViewInfo.componentParam = defaultViewClass.componentParam || attributeViewInfo.componentParam;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (objectIsEmpty(attributeViewInfo.component) || attributeViewInfo.component === '')\r\n\t\t{\r\n\t\t\t// 使用默认对象属性界面类定义\r\n\t\t\tattributeViewInfo.component = this.defaultObjectAttributeViewClass;\r\n\t\t}\r\n\r\n\t\tconst Cls = this.OAVComponent[attributeViewInfo.component];\r\n\t\tconsole.assert(Cls !== null, `没有定义 ${attributeViewInfo.component} 对应的属性界面类，需要在 ${attributeViewInfo.component} 中使用@OVAComponent()标记`);\r\n\t\tconst view = new Cls(attributeViewInfo);\r\n\r\n\t\treturn view;\r\n\t}\r\n\t/**\r\n\t * 获取块界面\r\n\t *\r\n\t * @static\r\n\t * @param blockViewInfo 块界面信息\r\n\t * @returns                块界面\r\n\t *\r\n\t * @memberOf ObjectView\r\n\t */\r\n\tgetBlockView(blockViewInfo: BlockViewInfo): IObjectBlockView\r\n\t{\r\n\t\tif (objectIsEmpty(blockViewInfo.component) || blockViewInfo.component === '')\r\n\t\t{\r\n\t\t\t// 返回默认对象属性界面类定义\r\n\t\t\tblockViewInfo.component = this.defaultObjectAttributeBlockView;\r\n\t\t}\r\n\r\n\t\tconst Cls = this.OBVComponent[blockViewInfo.component];\r\n\t\tconsole.assert(Cls !== null, `没有定义 ${blockViewInfo.component} 对应的块界面类，需要在 ${blockViewInfo.component} 中使用@OVBComponent()标记`);\r\n\t\tconst view = new Cls(blockViewInfo);\r\n\r\n\t\treturn view;\r\n\t}\r\n\r\n\taddOAV(target: any, propertyKey: string, param?: OAVComponentParams)\r\n\t{\r\n\t\tif (!Object.getOwnPropertyDescriptor(target, objectviewKey)) { target[objectviewKey] = {}; }\r\n\t\tconst objectview: ClassDefinition = target[objectviewKey] || {};\r\n\t\tconst attributeDefinitionVec: AttributeDefinition[] = objectview.attributeDefinitionVec = objectview.attributeDefinitionVec || [];\r\n\r\n\t\tconst attributeDefinition = Object.assign({ name: propertyKey }, param);\r\n\t\tattributeDefinitionVec.push(attributeDefinition);\r\n\t}\r\n\r\n\t/**\r\n\t * 获取对象信息\r\n\t * @param object 对象\r\n\t * @param autocreate 当对象没有注册属性时是否自动创建属性信息\r\n\t * @param excludeAttrs 排除属性列表\r\n\t * @return\r\n\t */\r\n\tgetObjectInfo(object: any, autocreate = true, excludeAttrs: string[] = []): ObjectViewInfo\r\n\t{\r\n\t\tif (typeof object === 'string' || typeof object === 'number' || typeof object === 'boolean')\r\n\t\t{\r\n\t\t\treturn {\r\n\t\t\t\tobjectAttributeInfos: [],\r\n\t\t\t\tobjectBlockInfos: [],\r\n\t\t\t\towner: object,\r\n\t\t\t\tcomponent: '',\r\n\t\t\t\tcomponentParam: undefined\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tlet classConfig = getInheritClassDefinition(object, autocreate);\r\n\r\n\t\tclassConfig = classConfig || {\r\n\t\t\tcomponent: '',\r\n\t\t\tcomponentParam: null,\r\n\t\t\tattributeDefinitionVec: [],\r\n\t\t\tblockDefinitionVec: [],\r\n\t\t};\r\n\r\n\t\tconst objectAttributeInfos: AttributeViewInfo[] = [];\r\n\t\tclassConfig.attributeDefinitionVec.forEach((attributeDefinition) =>\r\n\t\t{\r\n\t\t\tif (excludeAttrs.indexOf(attributeDefinition.name) === -1)\r\n\t\t\t{\r\n\t\t\t\tlet editable = attributeDefinition.editable === undefined ? true : attributeDefinition.editable;\r\n\t\t\t\teditable = editable && propertyIsWritable(object, attributeDefinition.name);\r\n\r\n\t\t\t\tconst obj: AttributeViewInfo = { owner: object, type: getAttributeType(object[attributeDefinition.name]) } as any;\r\n\t\t\t\tObject.assign(obj, attributeDefinition);\r\n\t\t\t\tobj.editable = editable;\r\n\t\t\t\tobjectAttributeInfos.push(obj);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfunction getAttributeType(attribute): string\r\n\t\t{\r\n\t\t\tif (objectIsEmpty(attribute))\r\n\t\t\t{\r\n\t\t\t\treturn 'null';\r\n\t\t\t}\r\n\t\t\tif (typeof attribute === 'number')\r\n\t\t\t{\r\n\t\t\t\treturn 'number';\r\n\t\t\t}\r\n\r\n\t\t\treturn attribute.constructor.name;\r\n\t\t}\r\n\r\n\t\tobjectAttributeInfos.forEach((v, i) => { v[tempIKey] = i; });\r\n\t\tobjectAttributeInfos.sort((a, b) =>\r\n\t\t\t((a.priority || 0) - (b.priority || 0)) || (a[tempIKey] - b[tempIKey]));\r\n\t\tobjectAttributeInfos.forEach((v, _i) => { delete v[tempIKey]; });\r\n\r\n\t\tconst objectInfo: ObjectViewInfo = {\r\n\t\t\tobjectAttributeInfos,\r\n\t\t\tobjectBlockInfos: getObjectBlockInfos(object, objectAttributeInfos, classConfig.blockDefinitionVec),\r\n\t\t\towner: object,\r\n\t\t\tcomponent: classConfig.component,\r\n\t\t\tcomponentParam: classConfig.componentParam\r\n\t\t};\r\n\r\n\t\treturn objectInfo;\r\n\t}\r\n}\r\n\r\n/**\r\n * 对象界面\r\n */\r\nexport const objectview = new ObjectView();\r\n\r\nfunction mergeClassDefinition(oldClassDefinition: ClassDefinition, newClassDefinition: ClassDefinition)\r\n{\r\n\tif (newClassDefinition.component && newClassDefinition.component.length > 0)\r\n\t{\r\n\t\toldClassDefinition.component = newClassDefinition.component;\r\n\t\toldClassDefinition.componentParam = newClassDefinition.componentParam;\r\n\t}\r\n\t// 合并属性\r\n\toldClassDefinition.attributeDefinitionVec = oldClassDefinition.attributeDefinitionVec || [];\r\n\tif (newClassDefinition.attributeDefinitionVec && newClassDefinition.attributeDefinitionVec.length > 0)\r\n\t{\r\n\t\tnewClassDefinition.attributeDefinitionVec.forEach((newAttributeDefinition) =>\r\n\t\t{\r\n\t\t\tlet isfound = false;\r\n\t\t\toldClassDefinition.attributeDefinitionVec.forEach((oldAttributeDefinition) =>\r\n\t\t\t{\r\n\t\t\t\tif (newAttributeDefinition && oldAttributeDefinition.name === newAttributeDefinition.name)\r\n\t\t\t\t{\r\n\t\t\t\t\tObject.assign(oldAttributeDefinition, newAttributeDefinition);\r\n\t\t\t\t\t//\r\n\t\t\t\t\tconst oldIndex = oldClassDefinition.attributeDefinitionVec.indexOf(oldAttributeDefinition);\r\n\t\t\t\t\toldClassDefinition.attributeDefinitionVec.splice(oldIndex, 1);\r\n\t\t\t\t\t//\r\n\t\t\t\t\toldClassDefinition.attributeDefinitionVec.push(oldAttributeDefinition);\r\n\t\t\t\t\tisfound = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (!isfound)\r\n\t\t\t{\r\n\t\t\t\tconst attributeDefinition: AttributeDefinition = {} as any;\r\n\t\t\t\tObject.assign(attributeDefinition, newAttributeDefinition);\r\n\t\t\t\toldClassDefinition.attributeDefinitionVec.push(attributeDefinition);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t// 合并块\r\n\toldClassDefinition.blockDefinitionVec = oldClassDefinition.blockDefinitionVec || [];\r\n\tif (newClassDefinition.blockDefinitionVec && newClassDefinition.blockDefinitionVec.length > 0)\r\n\t{\r\n\t\tnewClassDefinition.blockDefinitionVec.forEach((newBlockDefinition) =>\r\n\t\t{\r\n\t\t\tlet isfound = false;\r\n\t\t\toldClassDefinition.blockDefinitionVec.forEach((oldBlockDefinition) =>\r\n\t\t\t{\r\n\t\t\t\tif (newBlockDefinition && newBlockDefinition.name === oldBlockDefinition.name)\r\n\t\t\t\t{\r\n\t\t\t\t\tObject.assign(oldBlockDefinition, newBlockDefinition);\r\n\t\t\t\t\tisfound = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (!isfound)\r\n\t\t\t{\r\n\t\t\t\tconst blockDefinition: BlockDefinition = {} as any;\r\n\t\t\t\tObject.assign(blockDefinition, newBlockDefinition);\r\n\t\t\t\toldClassDefinition.blockDefinitionVec.push(blockDefinition);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction getInheritClassDefinition(object: any, autocreate = true)\r\n{\r\n\tconst classConfigVec: ClassDefinition[] = [];\r\n\tlet prototype = object;\r\n\twhile (prototype)\r\n\t{\r\n\t\tconst classConfig: ClassDefinition = prototype[objectviewKey];\r\n\t\tif (classConfig) { classConfigVec.push(classConfig); }\r\n\t\tprototype = prototype[protoKey];\r\n\t}\r\n\tlet resultclassConfig: ClassDefinition;\r\n\tif (classConfigVec.length > 0)\r\n\t{\r\n\t\tresultclassConfig = {} as any;\r\n\t\tfor (let i = classConfigVec.length - 1; i >= 0; i--)\r\n\t\t{\r\n\t\t\tmergeClassDefinition(resultclassConfig, classConfigVec[i]);\r\n\t\t}\r\n\t}\r\n\telse if (autocreate)\r\n\t{\r\n\t\tresultclassConfig = getDefaultClassConfig(object);\r\n\t}\r\n\r\n\treturn resultclassConfig;\r\n}\r\n\r\nfunction getDefaultClassConfig(object: any, filterReg = /(([a-zA-Z0-9])+|(\\d+))/)\r\n{\r\n\t//\r\n\tlet attributeNames: string[] = [];\r\n\tfor (const key in object)\r\n\t{\r\n\t\tconst result = filterReg.exec(key);\r\n\t\tif (result && result[0] === key)\r\n\t\t{\r\n\t\t\tconst value = object[key];\r\n\t\t\tif (value === undefined || value instanceof Function) { continue; }\r\n\t\t\tattributeNames.push(key);\r\n\t\t}\r\n\t}\r\n\tattributeNames = attributeNames.sort();\r\n\r\n\tconst attributeDefinitionVec: AttributeDefinition[] = [];\r\n\tattributeNames.forEach((element) =>\r\n\t{\r\n\t\tattributeDefinitionVec.push({\r\n\t\t\tname: element,\r\n\t\t\tblock: '',\r\n\t\t});\r\n\t});\r\n\r\n\tconst defaultClassConfig: ClassDefinition = {\r\n\t\tcomponent: '',\r\n\t\tattributeDefinitionVec,\r\n\t\tblockDefinitionVec: []\r\n\t};\r\n\r\n\treturn defaultClassConfig;\r\n}\r\n\r\n/**\r\n * 获取对象块信息列表\r\n * @param object 对象\r\n * @returns        对象块信息列表\r\n */\r\nfunction getObjectBlockInfos(object: any, objectAttributeInfos: AttributeViewInfo[], blockDefinitionVec?: BlockDefinition[]): BlockViewInfo[]\r\n{\r\n\tconst objectBlockInfos: BlockViewInfo[] = [];\r\n\tconst dic: { [blockName: string]: BlockViewInfo } = {};\r\n\tlet objectBlockInfo: BlockViewInfo;\r\n\r\n\t// 收集块信息\r\n\tlet i = 0;\r\n\tconst tempVec: BlockViewInfo[] = [];\r\n\tfor (i = 0; i < objectAttributeInfos.length; i++)\r\n\t{\r\n\t\tconst blockName = objectAttributeInfos[i].block || '';\r\n\t\tobjectBlockInfo = dic[blockName];\r\n\t\tif (objectIsEmpty(objectBlockInfo))\r\n\t\t{\r\n\t\t\tobjectBlockInfo = dic[blockName] = { name: blockName, owner: object, itemList: [] };\r\n\t\t\ttempVec.push(objectBlockInfo);\r\n\t\t}\r\n\t\tobjectBlockInfo.itemList.push(objectAttributeInfos[i]);\r\n\t}\r\n\r\n\t// 按快的默认顺序生成 块信息列表\r\n\tlet blockDefinition: BlockDefinition;\r\n\tconst pushDic = {};\r\n\r\n\tif (blockDefinitionVec)\r\n\t{\r\n\t\tfor (i = 0; i < blockDefinitionVec.length; i++)\r\n\t\t{\r\n\t\t\tblockDefinition = blockDefinitionVec[i];\r\n\t\t\tobjectBlockInfo = dic[blockDefinition.name];\r\n\t\t\tif (objectIsEmpty(objectBlockInfo))\r\n\t\t\t{\r\n\t\t\t\tobjectBlockInfo = {\r\n\t\t\t\t\tname: blockDefinition.name,\r\n\t\t\t\t\towner: object,\r\n\t\t\t\t\titemList: []\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tobjectBlockInfo.component = blockDefinition.component;\r\n\t\t\tobjectBlockInfo.componentParam = blockDefinition.componentParam;\r\n\t\t\tobjectBlockInfos.push(objectBlockInfo);\r\n\t\t\tpushDic[objectBlockInfo.name] = true;\r\n\t\t}\r\n\t}\r\n\t// 添加剩余的块信息\r\n\tfor (i = 0; i < tempVec.length; i++)\r\n\t{\r\n\t\tif (Boolean(pushDic[tempVec[i].name]) === false)\r\n\t\t{\r\n\t\t\tobjectBlockInfos.push(tempVec[i]);\r\n\t\t}\r\n\t}\r\n\r\n\treturn objectBlockInfos;\r\n}\r\n\r\n/**\r\n * OAV 组件参数映射\r\n * {key: OAV组件名称,value：组件参数类定义}\r\n */\r\nexport interface OAVComponentParamMap extends MixinsOAVComponentParamMap\r\n{\r\n\tOAVEnum: OAVEnumParam;\r\n}\r\n\r\n/**\r\n * OAVEnum 组件参数\r\n */\r\nexport interface OAVEnumParam\r\n{\r\n\tcomponent: 'OAVEnum';\r\n\r\n\tcomponentParam: {\r\n\t\t/**\r\n\t\t * 枚举类型\r\n\t\t */\r\n\t\tenumClass: any,\r\n\t}\r\n}\r\n\r\nexport interface OBVComponentParamMap\r\n{\r\n\t块组件名称: '块组件参数';\r\n\t[component: string]: any;\r\n}\r\n\r\nexport interface OVComponentParamMap\r\n{\r\n\t类组件名称: '类组件参数';\r\n\t[component: string]: any;\r\n}\r\n\r\n/**\r\n * 定义属性\r\n */\r\nexport interface AttributeDefinition\r\n{\r\n\t/**\r\n\t * 属性名称\r\n\t */\r\n\tname: string;\r\n\r\n\t/**\r\n\t * 是否可编辑\r\n\t */\r\n\teditable?: boolean;\r\n\r\n\t/**\r\n\t * 所属块名称\r\n\t */\r\n\tblock?: string;\r\n\r\n\t/**\r\n\t * 提示信息\r\n\t */\r\n\ttooltip?: string;\r\n\r\n\t/**\r\n\t * 组件\r\n\t */\r\n\tcomponent?: string;\r\n\r\n\t/**\r\n\t * 组件参数\r\n\t */\r\n\tcomponentParam?: any;\r\n\r\n\t/**\r\n\t * 优先级，数字越小，显示越靠前，默认为0\r\n\t */\r\n\tpriority?: number;\r\n\r\n\t/**\r\n\t * 是否排除\r\n\t */\r\n\texclude?: boolean;\r\n}\r\n\r\n/**\r\n * 定义特定属性类型默认界面\r\n */\r\nexport interface AttributeTypeDefinition\r\n{\r\n\t/**\r\n\t * 界面类\r\n\t */\r\n\tcomponent: string;\r\n\t/**\r\n\t * 组件参数\r\n\t */\r\n\tcomponentParam?: any;\r\n}\r\n\r\n/**\r\n * 块定义\r\n */\r\nexport interface BlockDefinition\r\n{\r\n\t/**\r\n\t * 块名称\r\n\t */\r\n\tname: string;\r\n\r\n\t/**\r\n\t * 组件\r\n\t */\r\n\tcomponent?: string;\r\n\r\n\t/**\r\n\t * 组件参数\r\n\t */\r\n\tcomponentParam?: any;\r\n}\r\n\r\n/**\r\n * ObjectView类配置\r\n */\r\nexport interface ClassDefinition\r\n{\r\n\t/**\r\n\t * 组件\r\n\t */\r\n\tcomponent?: string;\r\n\r\n\t/**\r\n\t * 组件参数\r\n\t */\r\n\tcomponentParam?: any;\r\n\r\n\t/**\r\n\t * 自定义对象属性定义字典（key:属性名,value:属性定义）\r\n\t */\r\n\tattributeDefinitionVec: AttributeDefinition[];\r\n\r\n\t/**\r\n\t * 自定义对象属性块界面类定义字典（key:属性块名称,value:自定义对象属性块界面类定义）\r\n\t */\r\n\tblockDefinitionVec: BlockDefinition[];\r\n}\r\n\r\n/**\r\n * 对象属性界面接口\r\n */\r\nexport interface IObjectAttributeView extends MixinsIObjectAttributeView\r\n{\r\n\t/**\r\n\t * 界面所属对象（空间）\r\n\t */\r\n\tspace: any;\r\n\r\n\t/**\r\n\t * 更新界面\r\n\t */\r\n\tupdateView(): void;\r\n\r\n\t/**\r\n\t * 属性名称\r\n\t */\r\n\tattributeName: string;\r\n\r\n\t/**\r\n\t * 属性值\r\n\t */\r\n\tattributeValue: any;\r\n\r\n\t/**\r\n\t * 对象属性界面\r\n\t */\r\n\tobjectView: IObjectView;\r\n\r\n\t/**\r\n\t * 对象属性块界面\r\n\t */\r\n\tobjectBlockView: IObjectBlockView;\r\n}\r\n\r\n/**\r\n * 对象属性块界面接口\r\n */\r\nexport interface IObjectBlockView extends MixinsIObjectBlockView\r\n{\r\n\t/**\r\n\t * 界面所属对象（空间）\r\n\t */\r\n\tspace: any;\r\n\r\n\t/**\r\n\t * 块名称\r\n\t */\r\n\tblockName: string;\r\n\r\n\t/**\r\n\t * 对象属性界面\r\n\t */\r\n\tobjectView: IObjectView;\r\n\r\n\t/**\r\n\t * 更新界面\r\n\t */\r\n\tupdateView(): void;\r\n\r\n\t/**\r\n\t * 获取属性界面\r\n\t * @param attributeName 属性名称\r\n\t */\r\n\tgetAttributeView(attributeName: string): IObjectAttributeView;\r\n}\r\n\r\n/**\r\n * 对象界面接口\r\n */\r\nexport interface IObjectView extends MixinsIObjectView\r\n{\r\n\t/**\r\n\t * 界面所属对象（空间）\r\n\t */\r\n\tspace: any;\r\n\r\n\t/**\r\n\t * 更新界面\r\n\t */\r\n\tupdateView(): void;\r\n\r\n\t/**\r\n\t * 获取块界面\r\n\t * @param blockName 块名称\r\n\t */\r\n\tgetblockView(blockName: string): IObjectBlockView;\r\n\r\n\t/**\r\n\t * 获取属性界面\r\n\t * @param attributeName 属性名称\r\n\t */\r\n\tgetAttributeView(attributeName: string): IObjectAttributeView;\r\n}\r\n\r\n/**\r\n * 对象属性信息\r\n */\r\nexport interface AttributeViewInfo\r\n{\r\n\t/**\r\n\t * 属性名称\r\n\t */\r\n\tname: string;\r\n\r\n\t/**\r\n\t * 属性类型\r\n\t */\r\n\ttype: string;\r\n\r\n\t/**\r\n\t * 是否可写\r\n\t */\r\n\teditable: boolean;\r\n\r\n\t/**\r\n\t * 所属块名称\r\n\t */\r\n\tblock?: string;\r\n\r\n\t/**\r\n\t * 提示信息\r\n\t */\r\n\ttooltip?: string;\r\n\r\n\t/**\r\n\t * 组件\r\n\t */\r\n\tcomponent?: string;\r\n\r\n\t/**\r\n\t * 组件参数\r\n\t */\r\n\tcomponentParam?: any;\r\n\r\n\t/**\r\n\t * 属性所属对象\r\n\t */\r\n\towner: any;\r\n\r\n\t/**\r\n\t * 优先级，数字越小，显示越靠前，默认为0\r\n\t */\r\n\tpriority?: number;\r\n\r\n\t/**\r\n\t * 是否排除\r\n\t */\r\n\texclude?: boolean;\r\n}\r\n\r\n/**\r\n * 对象属性块\r\n */\r\nexport interface BlockViewInfo\r\n{\r\n\t/**\r\n\t * 块名称\r\n\t */\r\n\tname: string;\r\n\r\n\t/**\r\n\t * 组件\r\n\t */\r\n\tcomponent?: string;\r\n\r\n\t/**\r\n\t * 组件参数\r\n\t */\r\n\tcomponentParam?: any;\r\n\r\n\t/**\r\n\t * 属性信息列表\r\n\t */\r\n\titemList: AttributeViewInfo[];\r\n\r\n\t/**\r\n\t * 属性拥有者\r\n\t */\r\n\towner: any;\r\n}\r\n\r\n/**\r\n * 对象信息\r\n */\r\nexport interface ObjectViewInfo\r\n{\r\n\t/**\r\n\t * 组件\r\n\t */\r\n\tcomponent?: string;\r\n\r\n\t/**\r\n\t * 组件参数\r\n\t */\r\n\tcomponentParam?: any;\r\n\r\n\t/**\r\n\t * 对象属性列表\r\n\t */\r\n\tobjectAttributeInfos: AttributeViewInfo[];\r\n\r\n\t/**\r\n\t * 对象块信息列表\r\n\t */\r\n\tobjectBlockInfos: BlockViewInfo[];\r\n\r\n\t/**\r\n\t * 保存类的一个实例，为了能够获取动态属性信息\r\n\t */\r\n\towner: any;\r\n\r\n\t/**\r\n\t * 是否可编辑\r\n\t */\r\n\teditable?: boolean;\r\n}\r\n\r\nexport type GetObjectViewParam = {\r\n\t/**\r\n\t * 当对象没有注册属性时是否自动创建属性信息\r\n\t */\r\n\tautocreate?: boolean,\r\n\t/**\r\n\t * 排除属性列表\r\n\t */\r\n\texcludeAttrs?: string[]\r\n\t/**\r\n\t * 是否可编辑\r\n\t */\r\n\teditable?: boolean;\r\n};\r\n\r\n/**\r\n * 属性是否可写\r\n * @param obj 对象\r\n * @param property 属性名称\r\n */\r\nfunction propertyIsWritable(obj: any, property: string): boolean\r\n{\r\n\tconst data = getPropertyDescriptor(obj, property);\r\n\tif (!data) return false;\r\n\tif (data.get && !data.set) return false;\r\n\r\n\treturn true;\r\n}\r\n\r\n/**\r\n * 从对象自身或者对象的原型中获取属性描述\r\n *\r\n * @param object 对象\r\n * @param property 属性名称\r\n */\r\nfunction getPropertyDescriptor(object: any, property: string): PropertyDescriptor | undefined\r\n{\r\n\tconst data = Object.getOwnPropertyDescriptor(object, property);\r\n\tif (data)\r\n\t{\r\n\t\treturn data;\r\n\t}\r\n\tconst prototype = Object.getPrototypeOf(object);\r\n\tif (prototype)\r\n\t{\r\n\t\treturn getPropertyDescriptor(prototype, property);\r\n\t}\r\n\r\n\treturn undefined;\r\n}\r\n\r\nconst tempIKey = '___tempI';\r\nconst protoKey = '__proto__';\r\nconst objectviewKey = '__objectview__';\r\n\r\n/**\r\n * 判断对象是否为null或者undefine\r\n *\r\n * @param obj\r\n * @returns\r\n */\r\nfunction objectIsEmpty(obj: any)\r\n{\r\n\tif (obj === undefined || obj === null)\r\n\t{ return true; }\r\n\r\n\treturn false;\r\n}\r\n","export { };\r\n\r\ndeclare global\r\n{\r\n    interface Array<T>\r\n    {\r\n        /**\r\n         * Determines whether an array includes a certain element, returning true or false as appropriate.\r\n         * @param searchElement The element to search for.\r\n         * @param fromIndex The position in this array at which to begin searching for searchElement.\r\n         */\r\n        includes(searchElement: T, fromIndex?: number): boolean;\r\n    }\r\n}\r\n\r\nif (!Array.prototype.includes)\r\n{\r\n    // eslint-disable-next-line no-extend-native\r\n    Object.defineProperty(Array.prototype, 'includes', {\r\n        configurable: true,\r\n        enumerable: false,\r\n        value(searchElement: any, fromIndex: number)\r\n        {\r\n            for (let i = fromIndex, n = this.length; i < n; i++)\r\n            {\r\n                if (searchElement === this[i]) return true;\r\n            }\r\n\r\n            return false;\r\n        },\r\n        writable: true,\r\n    });\r\n}\r\n","export class ArrayUtils\r\n{\r\n    /**\r\n      * 比较两个数组中元素是否相同\r\n      *\r\n      * @param array 被操作数组\r\n      * @param arr 用于比较的数组\r\n      */\r\n    static equal<T>(array: T[], arr: ArrayLike<T>): boolean\r\n    {\r\n        if (array.length !== arr.length) return false;\r\n        const keys = Object.keys(arr);\r\n        for (let i = 0, n = keys.length; i < n; i++)\r\n        {\r\n            const key = keys[i];\r\n            if (array[key] !== arr[key]) return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 连接一个或多个数组到自身\r\n     *\r\n     * @param array 被操作数组\r\n     * @param items 要添加到数组末尾的其他项。\r\n     * @returns 返回自身\r\n     */\r\n    static concatToSelf<T>(array: T[], ...items: (T | ConcatArray<T>)[]): T[]\r\n    {\r\n        let arr: T[] = [];\r\n        items.forEach((v) => { arr = arr.concat(v); });\r\n        arr.forEach((v) => array.push(v));\r\n\r\n        return array;\r\n    }\r\n\r\n    /**\r\n     * 使数组变得唯一，不存在两个相等的元素\r\n     *\r\n     * @param array 被操作数组\r\n     * @param compare 比较函数\r\n     */\r\n    static unique<T>(array: T[], compare = (a: T, b: T) => a === b): T[]\r\n    {\r\n        const keys = Object.keys(array);\r\n        const ids = keys.map((v) => Number(v)).filter((v) => !isNaN(v));\r\n        const deleteMap: { [id: number]: true } = {};\r\n        //\r\n        for (let i = 0, n = ids.length; i < n; i++)\r\n        {\r\n            const ki = ids[i];\r\n            if (deleteMap[ki]) continue;\r\n            for (let j = i + 1; j < n; j++)\r\n            {\r\n                const kj = ids[j];\r\n                if (compare(array[ki], array[kj])) deleteMap[kj] = true;\r\n            }\r\n        }\r\n        //\r\n        for (let i = ids.length - 1; i >= 0; i--)\r\n        {\r\n            const id = ids[i];\r\n            if (deleteMap[id]) array.splice(id, 1);\r\n        }\r\n\r\n        return array;\r\n    }\r\n\r\n    /**\r\n     * 使用b元素替换数组中第一个a元素。\r\n     *\r\n     * @param array 被操作数组\r\n     * @param a 被替换的元素\r\n     * @param b 用于替换的元素\r\n     * @param isAdd 当数组中没有找到a元素时，是否需要把b元素添加到数组尾部。默认值为true。\r\n     */\r\n    static replace<T>(array: T[], a: T, b: T, isAdd = true): T[]\r\n    {\r\n        let isreplace = false;\r\n        for (let i = 0; i < array.length; i++)\r\n        {\r\n            if (array[i] === a)\r\n            {\r\n                array[i] = b;\r\n                isreplace = true;\r\n                break;\r\n            }\r\n        }\r\n        if (!isreplace && isAdd) array.push(b);\r\n\r\n        return array;\r\n    }\r\n\r\n    /**\r\n     * 创建数组\r\n     * @param length 长度\r\n     * @param itemFunc 创建元素方法\r\n     */\r\n    static create<T>(length: number, itemFunc: (index: number) => T): T[]\r\n    {\r\n        const arr: T[] = [];\r\n        for (let i = 0; i < length; i++)\r\n        {\r\n            arr[i] = itemFunc(i);\r\n        }\r\n\r\n        return arr;\r\n    }\r\n\r\n    /**\r\n     * 二分查找,如果有多个则返回第一个\r\n     * @param array 数组\r\n     * @param target 寻找的目标\r\n     * @param compare 比较函数\r\n     * @param start 起始位置\r\n     * @param end 结束位置\r\n     * @returns          查找到目标时返回所在位置，否则返回-1\r\n     */\r\n    static binarySearch<T>(array: T[], target: T, compare: (a: T, b: T) => number, start?: number, end?: number): number\r\n    {\r\n        const insert = ArrayUtils.binarySearchInsert(array, target, compare, start, end);\r\n        if (array[insert] === target)\r\n        { return insert; }\r\n\r\n        return -1;\r\n    }\r\n    /**\r\n     * 二分查找插入位置,如果有多个则返回第一个\r\n     * @param array 数组\r\n     * @param target 寻找的目标\r\n     * @param compare 比较函数\r\n     * @param start 起始位置\r\n     * @param end 结束位置\r\n     * @returns          目标所在位置（如果该位置上不是目标对象，则该索引为该目标可插入的位置）\r\n     */\r\n    static binarySearchInsert<T>(array: T[], target: T, compare: (a: T, b: T) => number, start?: number, end?: number): number\r\n    {\r\n        if (start === undefined) start = 0;\r\n        if (end === undefined) end = array.length;\r\n        if (start === end)\r\n        { return start; }\r\n        if (compare(array[start], target) === 0)\r\n        {\r\n            return start;\r\n        }\r\n        const middle = ~~((start + end) / 2);\r\n        if (compare(array[middle], target) < 0)\r\n        {\r\n            start = middle + 1;\r\n        }\r\n        else\r\n        {\r\n            end = middle;\r\n        }\r\n\r\n        return ArrayUtils.binarySearchInsert(array, target, compare, start, end);\r\n    }\r\n\r\n    /**\r\n     * 判断数组是否唯一\r\n     *\r\n     * @param array 被检查数组\r\n     * @param compare 比较函数\r\n     */\r\n    static isUnique<T>(array: T[], compare = (a: T, b: T) => a === b): boolean\r\n    {\r\n        for (let i = array.length - 1; i >= 0; i--)\r\n        {\r\n            for (let j = 0; j < i; j++)\r\n            {\r\n                if (compare(array[i], array[j]))\r\n                {\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 删除元素\r\n     *\r\n     * @param array 被操作数组\r\n     * @param item 被删除元素\r\n     * @returns 被删除元素在数组中的位置\r\n     */\r\n    static deleteItem<T>(array: T[], item: T): number\r\n    {\r\n        const index = array.indexOf(item);\r\n        if (index !== -1) array.splice(index, 1);\r\n\r\n        return index;\r\n    }\r\n}\r\n\r\n","import { ArrayUtils } from './ArrayUtils';\r\nimport { gPartial } from './Types';\r\n\r\n/**\r\n * ObjectUtils.assignDeep 中 转换结果的函数定义\r\n */\r\ninterface AssignDeepHandler\r\n{\r\n    /**\r\n     *\r\n     * @param target 目标对象\r\n     * @param source 源数据\r\n     * @param key 属性名称\r\n     * @param replacers 转换函数\r\n     * @param deep 当前深度\r\n     */\r\n    (target: any, source: any, key: string, replacers: AssignDeepHandler[], deep: number): boolean;\r\n}\r\n\r\nexport class ObjectUtils\r\n{\r\n    /**\r\n     * 判断是否为基础类型 undefined,null,boolean,string,number\r\n     */\r\n    static isBaseType(object: any): boolean\r\n    {\r\n        // 基础类型\r\n        if (\r\n            object === undefined || object === null\r\n            || typeof object === 'boolean'\r\n            || typeof object === 'string'\r\n            || typeof object === 'number'\r\n        )\r\n        { return true; }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * 执行方法\r\n     *\r\n     * 用例：\r\n     * 1. 给一个新建的对象进行初始化\r\n     *\r\n     *  ``` startLifetime = ObjectUtils.runFunc(new MinMaxCurve(), (obj) => { obj.mode = MinMaxCurveMode.Constant; (<MinMaxCurveConstant>obj.minMaxCurve).value = 5; }); ```\r\n     *\r\n     * @param obj 对象\r\n     * @param func 被执行的方法\r\n     */\r\n    static runFunc<T>(obj: T, func: (obj: T) => void): T\r\n    {\r\n        func(obj);\r\n\r\n        return obj;\r\n    }\r\n\r\n    /**\r\n     * 判断是否为Object对象，构造函数是否为Object， 检测 ObjectUtils.constructor === Object\r\n     *\r\n     * @param object 用于判断的对象\r\n     */\r\n    static isObject(object: any): boolean\r\n    {\r\n        return object?.constructor.name === 'Object';\r\n    }\r\n\r\n    /**\r\n     * 获取对象对应属性上的值\r\n     *\r\n     * @param object 对象\r\n     * @param property 属性名称，可以是 \"a\" 或者 \"a.b\" 或者 [\"a\",\"b\"]\r\n     */\r\n    static getPropertyValue(object: any, property: string | string[]): any\r\n    {\r\n        if (typeof property === 'string') property = property.split('.');\r\n        let value = object;\r\n        const len = property.length;\r\n        for (let i = 0; i < len; i++)\r\n        {\r\n            if (ObjectUtils.objectIsEmpty(value)) return undefined;\r\n            value = value[property[i]];\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * 获取对象上属性链列表\r\n     *\r\n     * 例如 object值为{ a: { b: { c: 1 }, d: 2 } }时则返回 [\"a.b.c\",\"a.d\"]\r\n     *\r\n     * @param object 对象\r\n     */\r\n    static getPropertyChains(object: any): string[]\r\n    {\r\n        const result: string[] = [];\r\n        // 属性名称列表\r\n        const propertys = Object.keys(object);\r\n        // 属性所属对象列表\r\n        const hosts = new Array(propertys.length).fill(object);\r\n        // 父属性所在编号列表\r\n        const parentPropertyIndices = new Array(propertys.length).fill(-1);\r\n        // 处理到的位置\r\n        let index = 0;\r\n        while (index < propertys.length)\r\n        {\r\n            const host = hosts[index];\r\n            const cp = propertys[index];\r\n            const cv = host[cp];\r\n            let vks: string[];\r\n            if (ObjectUtils.objectIsEmpty(cv) || ObjectUtils.isBaseType(cv) || (vks = Object.keys(cv)).length === 0)\r\n            {\r\n                // 处理叶子属性\r\n                const ps = [cp];\r\n                let ci = index;\r\n                // 查找并组合属性链\r\n                while ((ci = parentPropertyIndices[ci]) !== -1)\r\n                {\r\n                    ps.push(propertys[ci]);\r\n                }\r\n                ps.reverse();\r\n                result.push(ps.join('.'));\r\n            }\r\n            else\r\n            {\r\n                // 处理中间属性\r\n                // eslint-disable-next-line no-loop-func\r\n                vks.forEach((k) =>\r\n                {\r\n                    propertys.push(k);\r\n                    hosts.push(cv);\r\n                    parentPropertyIndices.push(index);\r\n                });\r\n            }\r\n\r\n            index++;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * 浅赋值\r\n     * 从源数据取所有可枚举属性值赋值给目标对象\r\n     *\r\n     * @param target 目标对象\r\n     * @param source 源数据\r\n     */\r\n    static assignShallow<T>(target: T, source: Partial<T>): T\r\n    {\r\n        if (ObjectUtils.objectIsEmpty(source)) return target;\r\n        const keys = Object.keys(source);\r\n        keys.forEach((k) =>\r\n        {\r\n            target[k] = source[k];\r\n        });\r\n\r\n        return target;\r\n    }\r\n\r\n    /**\r\n     * 深度赋值\r\n     * 从源数据取所有子代可枚举属性值赋值给目标对象\r\n     *\r\n     * @param target 被赋值对象\r\n     * @param source 源数据\r\n     * @param handlers 处理函数列表，先于 ObjectUtils.assignDeepDefaultHandlers 执行。函数返回值为true表示该属性赋值已完成跳过默认属性赋值操作，否则执行默认属性赋值操作。执行在 ObjectUtils.DefaultAssignDeepReplacers 前。\r\n     * @param deep 赋值深度，deep<1时直接返回。\r\n     */\r\n    static assignDeep<T>(target: T, source: gPartial<T>, handlers: AssignDeepHandler[] = [], deep = Number.MAX_SAFE_INTEGER): T\r\n    {\r\n        if (ObjectUtils.objectIsEmpty(source)) return target;\r\n        if (deep < 1) return target;\r\n        const keys = Object.keys(source);\r\n        const concatHandlers = handlers.concat(ObjectUtils.assignDeepDefaultHandlers);\r\n        keys.forEach((k) =>\r\n        {\r\n            //\r\n            for (let i = 0; i < concatHandlers.length; i++)\r\n            {\r\n                if (concatHandlers[i](target, source, k, handlers, deep))\r\n                {\r\n                    return;\r\n                }\r\n            }\r\n            //\r\n            target[k] = source[k];\r\n        });\r\n\r\n        return target;\r\n    }\r\n\r\n    /**\r\n     * 深度比较两个对象子代可枚举属性值\r\n     *\r\n     * @param a 第一个对象\r\n     * @param b 第二个对象\r\n     */\r\n    static equalDeep<T>(a: T, b: T): boolean\r\n    {\r\n        if (a === b) return true;\r\n        if (ObjectUtils.isBaseType(a) || ObjectUtils.isBaseType(b)) return a === b;\r\n        if (typeof a === 'function' || typeof b === 'function') return a === b;\r\n        //\r\n        const akeys = Object.keys(a);\r\n        const bkeys = Object.keys(b);\r\n        if (!ArrayUtils.equal(akeys, bkeys)) return false;\r\n        if (Array.isArray(a) && Array.isArray(b)) return a.length === b.length;\r\n        // 检测所有属性\r\n        for (let i = 0; i < akeys.length; i++)\r\n        {\r\n            const element = akeys[i];\r\n            if (!ObjectUtils.equalDeep(a[element], b[element]))\r\n            {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 判断对象是否为null或者undefine\r\n     *\r\n     * @param obj\r\n     * @returns\r\n     */\r\n    static objectIsEmpty(obj: any)\r\n    {\r\n        return (obj === undefined || obj === null);\r\n    }\r\n\r\n    /**\r\n     * 从对象自身或者对象的原型中获取属性描述\r\n     *\r\n     * @param object 对象\r\n     * @param property 属性名称\r\n     */\r\n    static getPropertyDescriptor(object: any, property: string): PropertyDescriptor | undefined\r\n    {\r\n        const data = Object.getOwnPropertyDescriptor(object, property);\r\n        if (data)\r\n        {\r\n            return data;\r\n        }\r\n        const prototype = Object.getPrototypeOf(object);\r\n        if (prototype)\r\n        {\r\n            return ObjectUtils.getPropertyDescriptor(prototype, property);\r\n        }\r\n\r\n        return undefined;\r\n    }\r\n\r\n    /**\r\n     * 属性是否可写\r\n     * @param obj 对象\r\n     * @param property 属性名称\r\n     */\r\n    static propertyIsWritable(obj: any, property: string): boolean\r\n    {\r\n        const data = ObjectUtils.getPropertyDescriptor(obj, property);\r\n        if (!data) return false;\r\n        if (data.get && !data.set) return false;\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * ObjectUtils.assignDeep 中 默认转换结果的函数列表\r\n     */\r\n    static assignDeepDefaultHandlers: AssignDeepHandler[] = [\r\n        function (target, source, key)\r\n        {\r\n            if (target[key] === source[key]) return true;\r\n\r\n            return false;\r\n        },\r\n        function (target, source, key)\r\n        {\r\n            if (ObjectUtils.isBaseType(target[key]) || ObjectUtils.isBaseType(source[key]))\r\n            {\r\n                target[key] = source[key];\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        },\r\n        function (target, source, key, handlers, deep)\r\n        {\r\n            if (Array.isArray(source[key]) || ObjectUtils.isObject(source[key]))\r\n            {\r\n                ObjectUtils.assignDeep(target[key], source[key], handlers, deep - 1);\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        },\r\n    ];\r\n}\r\n","import { ObjectUtils } from './ObjectUtils';\r\nimport { Constructor } from './Types';\r\n\r\nexport const __class__ = '__class__';\r\n\r\n/**\r\n * 类工具\r\n */\r\nexport class ClassUtils\r\n{\r\n    classUtilsHandlers: Function[] = [];\r\n\r\n    /**\r\n     * 返回对象的类名。\r\n     * @param value 需要类名称的对象，可以将任何 JavaScript 值传递给此方法，包括所有可用的 JavaScript 类型、对象实例、原始类型\r\n     * （如number)和类对象\r\n     * @returns 包含类名称的字符串。\r\n     */\r\n    getQualifiedClassName(value: any): string\r\n    {\r\n        if (ObjectUtils.objectIsEmpty(value))\r\n        {\r\n            return 'null';\r\n        }\r\n\r\n        const classUtilsHandlers = classUtils.classUtilsHandlers;\r\n        if (classUtilsHandlers)\r\n        {\r\n            classUtilsHandlers.forEach((element) =>\r\n            {\r\n                element(value);\r\n            });\r\n        }\r\n\r\n        const prototype: any = value.prototype ? value.prototype : Object.getPrototypeOf(value);\r\n        // eslint-disable-next-line no-prototype-builtins\r\n        if (prototype.hasOwnProperty(__class__))\r\n        {\r\n            return prototype[__class__];\r\n        }\r\n\r\n        let className: string = prototype.constructor.name;\r\n        if (globalThis[className] === prototype.constructor)\r\n        {\r\n            return className;\r\n        }\r\n        // 在可能的命名空间内查找\r\n        for (let i = 0; i < _classNameSpaces.length; i++)\r\n        {\r\n            const tryClassName = `${_classNameSpaces[i]}.${className}`;\r\n            if (this.getDefinitionByName(tryClassName) === prototype.constructor)\r\n            {\r\n                className = tryClassName;\r\n                registerClass(prototype.constructor, className);\r\n\r\n                return className;\r\n            }\r\n        }\r\n        console.warn(`未在给出的命名空间 ${_classNameSpaces} 内找到 ${value}-${className} 的定义`);\r\n\r\n        return className;\r\n    }\r\n\r\n    /**\r\n     * 返回 name 参数指定的类的类对象引用。\r\n     * @param name 类的名称。\r\n     */\r\n    getDefinitionByName(name: string, readCache = true): any\r\n    {\r\n        if (name === 'null')\r\n        {\r\n            return null;\r\n        }\r\n        if (!name)\r\n        {\r\n            return null;\r\n        }\r\n        if (globalThis[name])\r\n        {\r\n            return globalThis[name];\r\n        }\r\n        if (readCache && _definitionCache[name])\r\n        {\r\n            return _definitionCache[name];\r\n        }\r\n\r\n        const paths = name.split('.');\r\n        const length = paths.length;\r\n        let definition = globalThis;\r\n        for (let i = 0; i < length; i++)\r\n        {\r\n            const path = paths[i];\r\n            definition = definition[path];\r\n            if (!definition)\r\n            {\r\n                return null;\r\n            }\r\n        }\r\n        _definitionCache[name] = definition;\r\n\r\n        return definition;\r\n    }\r\n\r\n    private defaultInstMap: { [className: string]: any } = {};\r\n\r\n    /**\r\n     * 获取默认实例\r\n     *\r\n     * @param name 类名称\r\n     */\r\n    getDefaultInstanceByName(name: string)\r\n    {\r\n        if (name === undefined)\r\n        {\r\n            return null;\r\n        }\r\n\r\n        let defaultInst = this.defaultInstMap[name];\r\n        if (defaultInst) return defaultInst;\r\n        //\r\n        defaultInst = this.defaultInstMap[name] = this.getInstanceByName(name);\r\n\r\n        // 冻结对象，防止被修改\r\n        Object.freeze(defaultInst);\r\n\r\n        return defaultInst;\r\n    }\r\n\r\n    /**\r\n     * 获取实例\r\n     *\r\n     * @param name 类名称\r\n     */\r\n    getInstanceByName(name: string)\r\n    {\r\n        const cls = this.getDefinitionByName(name);\r\n        console.assert(cls, `无法获取名称为 ${name} 的实例!`);\r\n        const instance = this.getInstanceByDefinition(cls);\r\n\r\n        return instance;\r\n    }\r\n\r\n    getInstanceByDefinition<T>(cls: Constructor<T>): T\r\n    {\r\n        console.assert(!!cls);\r\n        if (!cls) return undefined;\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore\r\n        if (cls.__create__)\r\n        {\r\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n            // @ts-ignore\r\n            return cls.__create__();\r\n        }\r\n\r\n        // eslint-disable-next-line new-cap\r\n        return new cls();\r\n    }\r\n\r\n    /**\r\n     * 新增反射对象所在的命名空间，使得getQualifiedClassName能够得到正确的结果\r\n     */\r\n    addClassNameSpace(namespace: string)\r\n    {\r\n        if (_classNameSpaces.indexOf(namespace) === -1)\r\n        {\r\n            _classNameSpaces.push(namespace);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * 类工具\r\n */\r\nexport const classUtils = new ClassUtils();\r\n\r\nconst _definitionCache = {};\r\nconst _classNameSpaces = ['feng3d'];\r\n\r\n/**\r\n * 为一个类定义注册类名\r\n * @param constructor 类定义\r\n * @param className 类名\r\n */\r\nexport function registerClass(constructor: Constructor<any>, className?: string): void\r\n{\r\n    const prototype = constructor.prototype;\r\n    if (!className)\r\n    {\r\n        className = prototype.constructor.name;\r\n    }\r\n    _definitionCache[className] = constructor;\r\n    Object.defineProperty(prototype, __class__, { value: className, writable: true, enumerable: false });\r\n}\r\n\r\n/**\r\n * 标记objectview对象界面类\r\n */\r\nexport function decoratorRegisterClass(className?: string)\r\n{\r\n    return (constructor: Constructor<any>) =>\r\n    {\r\n        registerClass(constructor, className);\r\n    };\r\n}\r\n\r\n","/**\r\n * 数据类型转换\r\n * TypeArray、ArrayBuffer、Blob、File、DataURL、canvas的相互转换\r\n * @see http://blog.csdn.net/yinwhm12/article/details/73482904\r\n */\r\nexport class DataTransform\r\n{\r\n    /**\r\n     * Blob to ArrayBuffer\r\n     */\r\n    blobToArrayBuffer(blob: Blob, callback: (arrayBuffer: ArrayBuffer) => void)\r\n    {\r\n        const reader = new FileReader();\r\n        reader.onload = function (e)\r\n        {\r\n            callback(e.target.result as ArrayBuffer);\r\n        };\r\n        reader.readAsArrayBuffer(blob);\r\n    }\r\n\r\n    /**\r\n     * ArrayBuffer to Blob\r\n     */\r\n    arrayBufferToBlob(arrayBuffer: ArrayBuffer)\r\n    {\r\n        const blob = new Blob([arrayBuffer]); // 注意必须包裹[]\r\n\r\n        return blob;\r\n    }\r\n\r\n    /**\r\n     * ArrayBuffer to Uint8\r\n     * Uint8数组可以直观的看到ArrayBuffer中每个字节（1字节 === 8位）的值。一般我们要将ArrayBuffer转成Uint类型数组后才能对其中的字节进行存取操作。\r\n     */\r\n    arrayBufferToUint8(arrayBuffer: ArrayBuffer)\r\n    {\r\n        const u8 = new Uint8Array(arrayBuffer);\r\n\r\n        return u8;\r\n    }\r\n\r\n    /**\r\n     * Uint8 to ArrayBuffer\r\n     * 我们Uint8数组可以直观的看到ArrayBuffer中每个字节（1字节 === 8位）的值。一般我们要将ArrayBuffer转成Uint类型数组后才能对其中的字节进行存取操作。\r\n     */\r\n    uint8ToArrayBuffer(uint8Array: Uint8Array)\r\n    {\r\n        const buffer = uint8Array.buffer as ArrayBuffer;\r\n\r\n        return buffer;\r\n    }\r\n\r\n    /**\r\n     * Array to ArrayBuffer\r\n     * @param array 例如：[0x15, 0xFF, 0x01, 0x00, 0x34, 0xAB, 0x11];\r\n     */\r\n    arrayToArrayBuffer(array: number[])\r\n    {\r\n        const uint8 = new Uint8Array(array);\r\n        const buffer = uint8.buffer as ArrayBuffer;\r\n\r\n        return buffer;\r\n    }\r\n\r\n    /**\r\n     * TypeArray to Array\r\n     */\r\n    uint8ArrayToArray(u8a: Uint8Array)\r\n    {\r\n        const arr: number[] = [];\r\n        for (let i = 0; i < u8a.length; i++)\r\n        {\r\n            arr.push(u8a[i]);\r\n        }\r\n\r\n        return arr;\r\n    }\r\n\r\n    /**\r\n     * canvas转换为dataURL\r\n     */\r\n    canvasToDataURL(canvas: HTMLCanvasElement, type: 'png' | 'jpeg' = 'png', quality = 1)\r\n    {\r\n        if (type === 'png') return canvas.toDataURL('image/png');\r\n\r\n        return canvas.toDataURL('image/jpeg', quality);\r\n    }\r\n\r\n    /**\r\n     * canvas转换为图片\r\n     */\r\n    canvasToImage(canvas: HTMLCanvasElement, type: 'png' | 'jpeg' = 'png', quality = 1, callback: (img: HTMLImageElement) => void)\r\n    {\r\n        const dataURL = this.canvasToDataURL(canvas, type, quality);\r\n        this.dataURLToImage(dataURL, callback);\r\n    }\r\n\r\n    /**\r\n     * File、Blob对象转换为dataURL\r\n     * File对象也是一个Blob对象，二者的处理相同。\r\n     */\r\n    blobToDataURL(blob: Blob, callback: (dataurl: string) => void)\r\n    {\r\n        const a = new FileReader();\r\n        a.onload = function (e)\r\n        {\r\n            callback(e.target.result as any);\r\n        };\r\n        a.readAsDataURL(blob);\r\n    }\r\n\r\n    /**\r\n     * dataURL转换为Blob对象\r\n     */\r\n    dataURLtoBlob(dataurl: string)\r\n    {\r\n        const arr = dataurl.split(','); const mime = (arr[0].match(/:(.*?);/))[1];\r\n        const bstr = atob(arr[1]); let n = bstr.length; const\r\n            u8arr = new Uint8Array(n);\r\n        while (n--)\r\n        {\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        const blob = new Blob([u8arr], { type: mime });\r\n\r\n        return blob;\r\n    }\r\n\r\n    /**\r\n     * dataURL图片数据转换为HTMLImageElement\r\n     * dataURL图片数据绘制到canvas\r\n     * 先构造Image对象，src为dataURL，图片onload之后绘制到canvas\r\n     */\r\n    dataURLDrawCanvas(dataurl: string, canvas: HTMLCanvasElement, callback: (img: HTMLImageElement) => void)\r\n    {\r\n        this.dataURLToImage(dataurl, (img) =>\r\n        {\r\n            // canvas.drawImage(img);\r\n            callback(img);\r\n        });\r\n    }\r\n\r\n    dataURLToArrayBuffer(dataurl: string, callback: (arraybuffer: ArrayBuffer) => void)\r\n    {\r\n        const blob = this.dataURLtoBlob(dataurl);\r\n        this.blobToArrayBuffer(blob, callback);\r\n    }\r\n\r\n    arrayBufferToDataURL(arrayBuffer: ArrayBuffer, callback: (dataurl: string) => void)\r\n    {\r\n        const blob = this.arrayBufferToBlob(arrayBuffer);\r\n        this.blobToDataURL(blob, callback);\r\n    }\r\n\r\n    dataURLToImage(dataurl: string, callback: (img: HTMLImageElement) => void)\r\n    {\r\n        const img = new Image();\r\n        img.onload = function ()\r\n        {\r\n            callback(img);\r\n        };\r\n        img.src = dataurl;\r\n    }\r\n\r\n    imageToDataURL(img: HTMLImageElement, quality = 1)\r\n    {\r\n        const canvas = this.imageToCanvas(img);\r\n        const dataurl = this.canvasToDataURL(canvas, 'png', quality);\r\n\r\n        return dataurl;\r\n    }\r\n\r\n    imageToCanvas(img: HTMLImageElement)\r\n    {\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = img.width;\r\n        canvas.height = img.height;\r\n        const ctxt = canvas.getContext('2d');\r\n        ctxt.drawImage(img, 0, 0);\r\n\r\n        return canvas;\r\n    }\r\n\r\n    imageToArrayBuffer(img: HTMLImageElement, callback: (arraybuffer: ArrayBuffer) => void)\r\n    {\r\n        if (img.arraybuffer)\r\n        {\r\n            callback(img.arraybuffer);\r\n\r\n            return;\r\n        }\r\n        const dataUrl = this.imageToDataURL(img);\r\n        this.dataURLToArrayBuffer(dataUrl, (arraybuffer) =>\r\n        {\r\n            img.arraybuffer = arraybuffer;\r\n            arraybuffer.image = img;\r\n            callback(arraybuffer);\r\n        });\r\n    }\r\n\r\n    imageDataToDataURL(imageData: ImageData, quality = 1)\r\n    {\r\n        const canvas = this.imageDataToCanvas(imageData);\r\n        const dataurl = this.canvasToDataURL(canvas, 'png', quality);\r\n\r\n        return dataurl;\r\n    }\r\n\r\n    imageDataToCanvas(imageData: ImageData)\r\n    {\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = imageData.width;\r\n        canvas.height = imageData.height;\r\n        const ctxt = canvas.getContext('2d');\r\n        ctxt.putImageData(imageData, 0, 0);\r\n\r\n        return canvas;\r\n    }\r\n\r\n    imagedataToImage(imageData: ImageData, quality = 1, callback: (img: HTMLImageElement) => void)\r\n    {\r\n        const dataUrl = this.imageDataToDataURL(imageData, quality);\r\n        this.dataURLToImage(dataUrl, callback);\r\n    }\r\n\r\n    arrayBufferToImage(arrayBuffer: ArrayBuffer, callback: (img: HTMLImageElement) => void)\r\n    {\r\n        if (arrayBuffer.image)\r\n        {\r\n            callback(arrayBuffer.image);\r\n\r\n            return;\r\n        }\r\n\r\n        this.arrayBufferToDataURL(arrayBuffer, (dataurl) =>\r\n        {\r\n            this.dataURLToImage(dataurl, (img) =>\r\n            {\r\n                img.arraybuffer = arrayBuffer;\r\n                arrayBuffer.image = img;\r\n                callback(img);\r\n            });\r\n        });\r\n    }\r\n\r\n    blobToText(blob: Blob, callback: (content: string) => void)\r\n    {\r\n        const a = new FileReader();\r\n        a.onload = function (e) { callback(e.target.result as any); };\r\n        a.readAsText(blob);\r\n    }\r\n\r\n    stringToArrayBuffer(str: string)\r\n    {\r\n        const uint8Array = this.stringToUint8Array(str);\r\n        const buffer = this.uint8ToArrayBuffer(uint8Array);\r\n\r\n        return buffer;\r\n    }\r\n\r\n    arrayBufferToString(arrayBuffer: ArrayBuffer, callback: (content: string) => void)\r\n    {\r\n        const blob = this.arrayBufferToBlob(arrayBuffer);\r\n        this.blobToText(blob, callback);\r\n    }\r\n\r\n    /**\r\n     * ArrayBuffer 转换为 对象\r\n     *\r\n     * @param arrayBuffer\r\n     * @param callback\r\n     */\r\n    arrayBufferToObject(arrayBuffer: ArrayBuffer, callback: (object: any) => void)\r\n    {\r\n        this.arrayBufferToString(arrayBuffer, (str) =>\r\n        {\r\n            const obj = JSON.parse(str);\r\n            callback(obj);\r\n        });\r\n    }\r\n\r\n    stringToUint8Array(str: string)\r\n    {\r\n        const utf8 = unescape(encodeURIComponent(str));\r\n        const uint8Array = new Uint8Array(utf8.split('').map(function (item)\r\n        {\r\n            return item.charCodeAt(0);\r\n        }));\r\n\r\n        return uint8Array;\r\n    }\r\n\r\n    uint8ArrayToString(arr: Uint8Array, callback: (str: string) => void)\r\n    {\r\n        // or [].slice.apply(arr)\r\n        // var utf8 = Array.from(arr).map(function (item)\r\n        const utf8 = [].slice.apply(arr).map(function (item)\r\n        {\r\n            return String.fromCharCode(item);\r\n        }).join('');\r\n\r\n        const str = decodeURIComponent(escape(utf8));\r\n        callback(str);\r\n    }\r\n}\r\n\r\n/**\r\n * 数据类型转换\r\n * TypeArray、ArrayBuffer、Blob、File、DataURL、canvas的相互转换\r\n * @see http://blog.csdn.net/yinwhm12/article/details/73482904\r\n */\r\nexport const dataTransform = new DataTransform();\r\n","export class MapUtils\r\n{\r\n    static getKeys<K, V>(map: Map<K, V>): K[]\r\n    {\r\n        const keys: any[] = [];\r\n        map.forEach((_v, k) =>\r\n        {\r\n            keys.push(k);\r\n        });\r\n\r\n        return keys;\r\n    }\r\n\r\n    static getValues<K, V>(map: Map<K, V>): V[]\r\n    {\r\n        const values: any[] = [];\r\n        map.forEach((v, _k) =>\r\n        {\r\n            values.push(v);\r\n        });\r\n\r\n        return values;\r\n    }\r\n}\r\n","declare global\r\n{\r\n    interface MixinsMathUtil\r\n    {\r\n\r\n    }\r\n}\r\n\r\nexport interface MathUtil extends MixinsMathUtil { }\r\n\r\nexport class MathUtil implements MixinsMathUtil\r\n{\r\n    /**\r\n     * 角度转弧度因子\r\n     */\r\n    DEG2RAD = Math.PI / 180;\r\n\r\n    /**\r\n     * 弧度转角度因子\r\n     */\r\n    RAD2DEG = 180 / Math.PI;\r\n\r\n    /**\r\n     * 默认精度\r\n     */\r\n    PRECISION = 1e-6;\r\n\r\n    /**\r\n     * 获取唯一标识符\r\n     * @see http://www.broofa.com/Tools/Math.uuid.htm\r\n     */\r\n    uuid = (function uuid(length = 36)\r\n    {\r\n        const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');\r\n        const id = new Array(length);\r\n        let rnd = 0; let\r\n            r = 0;\r\n\r\n        return function generateUUID()\r\n        {\r\n            for (let i = 0; i < length; i++)\r\n            {\r\n                if (i === 8 || i === 13 || i === 18 || i === 23)\r\n                {\r\n                    id[i] = '-';\r\n                }\r\n                else if (i === 14)\r\n                {\r\n                    id[i] = '4';\r\n                }\r\n                else\r\n                {\r\n                    if (rnd <= 0x02) rnd = 0x2000000 + (Math.random() * 0x1000000) | 0;\r\n                    r = rnd & 0xf;\r\n                    rnd = rnd >> 4;\r\n                    id[i] = chars[(i === 19) ? (r & 0x3) | 0x8 : r];\r\n                }\r\n            }\r\n\r\n            return id.join('');\r\n        };\r\n    })();\r\n\r\n    /**\r\n     * （夹紧）计算指定值到区间[edge0 ,edge1]最近的值\r\n     *\r\n     * @param value 指定值\r\n     * @param lowerlimit 区间下界\r\n     * @param upperlimit 区间上界\r\n     */\r\n    clamp(value: number, lowerlimit: number, upperlimit: number)\r\n    {\r\n        if ((value - lowerlimit) * (value - upperlimit) <= 0) return value;\r\n        if (value < lowerlimit) return lowerlimit < upperlimit ? lowerlimit : upperlimit;\r\n\r\n        return lowerlimit > upperlimit ? lowerlimit : upperlimit;\r\n    }\r\n\r\n    /**\r\n     * 计算欧几里得模（整数模） ((n % m) + m) % m\r\n     *\r\n     * @param n 被除数\r\n     * @param m 除数\r\n     * @see https://en.wikipedia.org/wiki/Modulo_operation\r\n     */\r\n    uclideanModulo(n: number, m: number)\r\n    {\r\n        return ((n % m) + m) % m;\r\n    }\r\n\r\n    /**\r\n     * 使 x 值从区间 <a1, a2> 线性映射到区间 <b1, b2>\r\n     *\r\n     * @param x 第一个区间中值\r\n     * @param a1 第一个区间起始值\r\n     * @param a2 第一个区间终止值\r\n     * @param b1 第二个区间起始值\r\n     * @param b2 第二个区间起始值\r\n     */\r\n    mapLinear(x: number, a1: number, a2: number, b1: number, b2: number)\r\n    {\r\n        return b1 + (x - a1) * (b2 - b1) / (a2 - a1);\r\n    }\r\n\r\n    /**\r\n     * 线性插值\r\n     *\r\n     * @param start 起始值\r\n     * @param end 终止值\r\n     * @param t 插值系数 [0 ,1]\r\n     *\r\n     * @see https://en.wikipedia.org/wiki/Linear_interpolation\r\n     */\r\n    lerp(start: number, end: number, t: number)\r\n    {\r\n        return (1 - t) * start + t * end;\r\n    }\r\n\r\n    /**\r\n     * 计算平滑值 3x^2 - 2x^3\r\n     *\r\n     * @param x\r\n     * @param min 最小值\r\n     * @param max 最大值\r\n     *\r\n     * @see http://en.wikipedia.org/wiki/Smoothstep\r\n     */\r\n    smoothstep(x: number, min: number, max: number)\r\n    {\r\n        if (x <= min) return 0;\r\n        if (x >= max) return 1;\r\n\r\n        x = (x - min) / (max - min);\r\n\r\n        return x * x * (3 - 2 * x);\r\n    }\r\n\r\n    /**\r\n     * 计算平滑值 6x^5 - 15x^4 + 10x^3\r\n     *\r\n     * @param x\r\n     * @param min 最小值\r\n     * @param max 最大值\r\n     */\r\n    smootherstep(x: number, min: number, max: number)\r\n    {\r\n        if (x <= min) return 0;\r\n        if (x >= max) return 1;\r\n\r\n        x = (x - min) / (max - min);\r\n\r\n        return x * x * x * (x * (x * 6 - 15) + 10);\r\n    }\r\n\r\n    /**\r\n     * 从<low, high>获取随机整数\r\n     *\r\n     * @param low 区间起始值\r\n     * @param high 区间终止值\r\n     */\r\n    randInt(low: number, high: number)\r\n    {\r\n        return low + Math.floor(Math.random() * (high - low + 1));\r\n    }\r\n\r\n    /**\r\n     * 从<low, high>获取随机浮点数\r\n     *\r\n     * @param low 区间起始值\r\n     * @param high 区间终止值\r\n     */\r\n    randFloat(low: number, high: number)\r\n    {\r\n        return low + Math.random() * (high - low);\r\n    }\r\n\r\n    /**\r\n     * 从<-range/2, range/2>获取随机浮点数\r\n     *\r\n     * @param range 范围\r\n     */\r\n    randFloatSpread(range: number)\r\n    {\r\n        return range * (0.5 - Math.random());\r\n    }\r\n\r\n    /**\r\n     * 角度转换为弧度\r\n     *\r\n     * @param degrees 角度\r\n     */\r\n    degToRad(degrees: number)\r\n    {\r\n        return degrees * this.DEG2RAD;\r\n    }\r\n\r\n    /**\r\n     * 弧度转换为角度\r\n     *\r\n     * @param radians 弧度\r\n     */\r\n    radToDeg(radians: number)\r\n    {\r\n        return radians * this.RAD2DEG;\r\n    }\r\n\r\n    /**\r\n     * 判断指定整数是否为2的幂\r\n     *\r\n     * @param value 整数\r\n     */\r\n    isPowerOfTwo(value: number)\r\n    {\r\n        return (value & (value - 1)) === 0 && value !== 0;\r\n    }\r\n\r\n    /**\r\n     * 获取离指定整数最近的2的幂\r\n     *\r\n     * @param value 整数\r\n     */\r\n    nearestPowerOfTwo(value: number)\r\n    {\r\n        return Math.pow(2, Math.round(Math.log(value) / Math.LN2));\r\n    }\r\n\r\n    /**\r\n     * 获取指定大于等于整数最小2的幂，3->4,5->8,17->32,33->64\r\n     *\r\n     * @param value 整数\r\n     */\r\n    nextPowerOfTwo(value: number)\r\n    {\r\n        value--;\r\n        value |= value >> 1;\r\n        value |= value >> 2;\r\n        value |= value >> 4;\r\n        value |= value >> 8;\r\n        value |= value >> 16;\r\n        value++;\r\n\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * 获取目标最近的值\r\n     *\r\n     * source增加或者减少整数倍precision后得到离target最近的值\r\n     *\r\n     * ```\r\n     * mathUtil.toRound(71,0,5);//运算结果为1\r\n     * ```\r\n     *\r\n     * @param source 初始值\r\n     * @param target 目标值\r\n     * @param precision 精度\r\n     */\r\n    toRound(source: number, target: number, precision = 360)\r\n    {\r\n        return source + Math.round((target - source) / precision) * precision;\r\n    }\r\n\r\n    /**\r\n     * 比较两个Number是否相等\r\n     *\r\n     * @param a 数字a\r\n     * @param b 数字b\r\n     * @param precision 进度\r\n     */\r\n    equals(a: number, b: number, precision?: number)\r\n    {\r\n        if (precision === undefined)\r\n        { precision = this.PRECISION; }\r\n\r\n        return Math.abs(a - b) < precision;\r\n    }\r\n\r\n    /**\r\n     * 计算最大公约数\r\n     *\r\n     * @param a 整数a\r\n     * @param b 整数b\r\n     *\r\n     * @see https://en.wikipedia.org/wiki/Greatest_common_divisor\r\n     */\r\n    gcd(a: number, b: number)\r\n    {\r\n        // eslint-disable-next-line no-empty\r\n        if (b) while ((a %= b) && (b %= a)) { }\r\n\r\n        return a + b;\r\n    }\r\n\r\n    /**\r\n     * 计算最小公倍数\r\n     * Least common multiple\r\n     *\r\n     * @param a 整数a\r\n     * @param b 整数b\r\n     *\r\n     * @see https://en.wikipedia.org/wiki/Least_common_multiple\r\n     */\r\n    lcm(a: number, b: number)\r\n    {\r\n        return a * b / this.gcd(a, b);\r\n    }\r\n}\r\n\r\nexport const mathUtil = new MathUtil();\r\n","/**\r\n * 构造函数\r\n */\r\nexport type Constructor<T> = (new (...args: any[]) => T);\r\n\r\n/**\r\n * 让T中以及所有键值中的所有键都是可选的\r\n */\r\nexport type gPartial<T> = {\r\n    [P in keyof T]?: gPartial<T[P]>;\r\n};\r\n\r\n/**\r\n * 获取T类型中除值为KT类型以外的所有键\r\n *\r\n * ```\r\n * class A\r\n * {\r\n *      a = 1;\r\n *      f(){}\r\n * }\r\n *\r\n * var a: NonTypePropertyNames<A, number>; //var a:\"f\"\r\n * var a1: NonTypePropertyNames<A, Function>; //var a:\"a\"\r\n *\r\n * ```\r\n */\r\nexport type NonTypePropertyNames<T, KT> = { [K in keyof T]: T[K] extends KT ? never : K }[keyof T];\r\n\r\n/**\r\n * 剔除T类型中值为KT类型的键\r\n * ```\r\n *     class A\r\n *     {\r\n *         a = 1;\r\n *         f(){}\r\n *     }\r\n *\r\n *     var a: NonTypePropertys<A, number>; //var a: Pick<A, \"f\">\r\n *     var a1: NonTypePropertys<A, Function>; //var a1: Pick<A, \"a\">\r\n * ```\r\n */\r\nexport type NonTypePropertys<T, KT> = Pick<T, NonTypePropertyNames<T, KT>>;\r\n\r\n/**\r\n * 选取T类型中值为KT类型的所有键\r\n *\r\n * ```\r\n *     class A\r\n *     {\r\n *         a = 1;\r\n *         f(){}\r\n *     }\r\n *\r\n *     var a: TypePropertyNames<A, number>; //var a: \"a\"\r\n *     var a1: TypePropertyNames<A, Function>; //var a1: \"f\"\r\n * ```\r\n */\r\nexport type TypePropertyNames<T, KT> = { [K in keyof T]: T[K] extends KT ? K : never }[keyof T];\r\n\r\n/**\r\n * 选取T类型中值为非函数类型的所有键\r\n */\r\n// eslint-disable-next-line @typescript-eslint/ban-types\r\nexport type PropertyNames<T> = NonTypePropertyNames<T, Function>;\r\n\r\n/**\r\n * 选取T类型中值为函数的所有键\r\n *\r\n * ```\r\n *     class A\r\n *     {\r\n *         a = 1;\r\n *         f(){}\r\n *     }\r\n *\r\n *     var a: FunctionPropertyNames<A>; //var a: \"f\"\r\n * ```\r\n */\r\n// eslint-disable-next-line @typescript-eslint/ban-types\r\nexport type FunctionPropertyNames<T> = TypePropertyNames<T, Function>;\r\n\r\n/**\r\n * 选取T类型中值为KT类型的键\r\n *\r\n * ```\r\n *     class A\r\n *     {\r\n *         a = 1;\r\n *         f() { }\r\n *     }\r\n *\r\n *     var a: TypePropertys<A, number>; //var a: Pick<A, \"a\">\r\n *     var a1: TypePropertys<A, Function>; //var a1: Pick<A, \"f\">\r\n * ```\r\n */\r\nexport type TypePropertys<T, KT> = Pick<T, TypePropertyNames<T, KT>>;\r\n\r\nexport type Lazy<T> = T | (() => T);\r\n\r\nexport type LazyObject<T> = { [P in keyof T]: Lazy<T[P]>; };\r\n\r\nexport const lazy = {\r\n    getvalue<T>(lazyItem: Lazy<T>): T\r\n    {\r\n        if (typeof lazyItem === 'function')\r\n        { return (lazyItem as any)(); }\r\n\r\n        return lazyItem;\r\n    }\r\n};\r\n\r\n/**\r\n * 可销毁对象\r\n */\r\nexport interface IDisposable\r\n{\r\n    /**\r\n     * 是否已销毁\r\n     */\r\n    readonly disposed: boolean;\r\n\r\n    /**\r\n     * 销毁\r\n     */\r\n    dispose(): void;\r\n}\r\n","import { gPartial, ObjectUtils, __class__, ArrayUtils, classUtils } from '@feng3d/polyfill';\r\n\r\n/**\r\n * 序列化装饰器\r\n *\r\n * 在属性定义前使用 @serialize 进行标记需要序列化\r\n *\r\n * @param target 序列化原型\r\n * @param propertyKey 序列化属性\r\n */\r\nexport function serialize(target: any, propertyKey: string)\r\n{\r\n    if (!Object.getOwnPropertyDescriptor(target, serializeKey))\r\n    {\r\n        Object.defineProperty(target, serializeKey, { value: [] });\r\n    }\r\n    const serializePropertys: string[] = target[serializeKey];\r\n\r\n    serializePropertys.push(propertyKey);\r\n}\r\n\r\n/**\r\n * 序列化属性函数\r\n *\r\n * 序列化对象时建议使用 serialization.serialize\r\n *\r\n * @param target 序列化后的对象，存放序列化后属性值的对象。\r\n * @param source 被序列化的对象，提供序列化前属性值的对象。\r\n * @param property 序列化属性名称\r\n */\r\nfunction propertyHandler<T extends HandlerParam>(target: any, source: any, property: string, param: T)\r\n{\r\n    const handlers = param.handlers;\r\n\r\n    for (let i = 0; i < handlers.length; i++)\r\n    {\r\n        if (handlers[i](target, source, property, param))\r\n        {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n// /**\r\n//  * 序列化属性函数\r\n//  *\r\n//  * 序列化对象时建议使用 serialization.serialize\r\n//  *\r\n//  * @param target 序列化后的对象，存放序列化后属性值的对象。\r\n//  * @param source 被序列化的对象，提供序列化前属性值的对象。\r\n//  * @param property 序列化属性名称\r\n//  * @param handlers 序列化属性函数列表\r\n//  * @param beforeHandler 在处理列表前执行\r\n//  * @param affterHandler 在处理列表后执行\r\n//  */\r\n// function propertyHandler(target: Object, source: Object, property: string, handlers: PropertyHandler[], serialization: Serialization)\r\n// {\r\n//     for (let i = 0; i < handlers.length; i++)\r\n//     {\r\n//         if (handlers[i](target, source, property, handlers, serialization))\r\n//         {\r\n//             return true;\r\n//         }\r\n//     }\r\n//     return true;\r\n// }\r\n\r\n// /**\r\n//  * 序列化属性函数\r\n//  *\r\n//  * 序列化对象时建议使用 serialization.serialize\r\n//  *\r\n//  * @param target 序列化后的对象，存放序列化后属性值的对象。\r\n//  * @param source 被序列化的对象，提供序列化前属性值的对象。\r\n//  * @param property 序列化属性名称\r\n//  * @param handlers 序列化属性函数列表\r\n//  */\r\n// function differentPropertyHandler(target: Object, source: Object, property: string, different: Object, handlers: DifferentPropertyHandler[], serialization: Serialization)\r\n// {\r\n//     for (let i = 0; i < handlers.length; i++)\r\n//     {\r\n//         if (handlers[i](target, source, property, different, handlers, serialization))\r\n//         {\r\n//             return true;\r\n//         }\r\n//     }\r\n//     return true;\r\n// }\r\n\r\n/**\r\n * 序列化属性函数项\r\n */\r\ninterface PropertyHandler<T extends HandlerParam>\r\n{\r\n    /**\r\n     * 序列化属性函数项\r\n     *\r\n     * @param target 序列化后的对象，存放序列化后属性值的对象。\r\n     * @param source 被序列化的对象，提供序列化前属性值的对象。\r\n     * @param property 序列化属性名称\r\n     * @param param 参数列表\r\n     *\r\n     * @returns 返回true时结束该属性后续处理。\r\n     */\r\n    (target: any, source: any, property: string, param: T): boolean;\r\n}\r\n\r\n// /**\r\n//  * 序列化属性函数项\r\n//  */\r\n// interface DifferentPropertyHandler\r\n// {\r\n//     /**\r\n//      * 序列化属性函数项\r\n//      *\r\n//      * @param target 序列化后的对象，存放序列化后属性值的对象。\r\n//      * @param source 被序列化的对象，提供序列化前属性值的对象。\r\n//      * @param property 序列化属性名称\r\n//      * @param handlers 序列化属性函数列表\r\n//      * @param serialization 序列化工具自身\r\n//      *\r\n//      * @returns 返回true时结束该属性后续处理。\r\n//      */\r\n//     (target: any, source: any, property: string, different: Object, handlers: DifferentPropertyHandler[], serialization: Serialization): boolean;\r\n// }\r\n\r\ninterface HandlerParam\r\n{\r\n    handlers: PropertyHandler<HandlerParam>[]\r\n    serialization: Serialization\r\n}\r\n\r\ninterface SerializeHandlerParam extends HandlerParam\r\n{\r\n    /**\r\n     * 已经被序列化的列表\r\n     *\r\n     * {key: 被序列化的对象，value：{target:序列化后数据所存储对象,property:序列化后数据所存在属性名称}}\r\n     *\r\n     * 用于处理序列化循环引用以及多次引用的对象\r\n     */\r\n    serializedMap: Map<any, { target: any, property: string }>;\r\n    handlers: PropertyHandler<SerializeHandlerParam>[];\r\n    root: any;\r\n    autoRefID: number;\r\n}\r\n\r\ninterface DeserializeHandlerParam extends HandlerParam\r\n{\r\n    refs: {\r\n        [refid: string]: {\r\n            target: any;\r\n            property: string;\r\n            refs: { target: any, property: string }[];\r\n        }\r\n    };\r\n}\r\n\r\ninterface DifferentHandlerParam extends HandlerParam\r\n{\r\n    handlers: PropertyHandler<DifferentHandlerParam>[];\r\n    /**\r\n     * 当前对象的不同数据\r\n     */\r\n    different: any;\r\n}\r\n\r\n/**\r\n * 序列化\r\n */\r\nexport class Serialization\r\n{\r\n    /**\r\n     * 是否忽略默认值\r\n     */\r\n    omitDefault = true;\r\n\r\n    /**\r\n     * 序列化函数列表\r\n     */\r\n    serializeHandlers: { priority: number, handler: PropertyHandler<SerializeHandlerParam> }[] = [];\r\n\r\n    /**\r\n     * 反序列化函数列表\r\n     */\r\n    deserializeHandlers: { priority: number, handler: PropertyHandler<DeserializeHandlerParam> }[] = [];\r\n\r\n    /**\r\n     * 比较差异函数列表\r\n     */\r\n    differentHandlers: { priority: number, handler: PropertyHandler<DifferentHandlerParam> }[] = [];\r\n\r\n    /**\r\n     * 设置函数列表\r\n     */\r\n    setValueHandlers: { priority: number, handler: PropertyHandler<HandlerParam> }[] = [];\r\n\r\n    /**\r\n     * 序列化对象\r\n     *\r\n     * 过程中使用 different与默认值作比较减少结果中的数据。\r\n     *\r\n     * @param target 被序列化的对象\r\n     *\r\n     * @returns 序列化后简单数据对象（由Object与Array组合可 JSON.stringify 的简单结构）\r\n     */\r\n    serialize<T>(target: T): gPartial<T>\r\n    {\r\n        //\r\n        const handlers = this.serializeHandlers.sort((a, b) => b.priority - a.priority).map((v) => v.handler);\r\n\r\n        const param: SerializeHandlerParam = {\r\n            handlers, serialization: this, root: target as any,\r\n            serializedMap: new Map(),\r\n            autoRefID: 1,\r\n        };\r\n\r\n        const result: any = {};\r\n\r\n        propertyHandler(result, { __root__: target }, rootKey, param);\r\n        const v = result[rootKey];\r\n\r\n        return v;\r\n    }\r\n\r\n    /**\r\n     * 删除 Json 对象中 CLASS_KEY 属性，防止被反序列化。\r\n     *\r\n     * @param obj\r\n     */\r\n    deleteClassKey(obj: any)\r\n    {\r\n        if (ObjectUtils.isBaseType(obj)) return;\r\n\r\n        delete obj[__class__];\r\n\r\n        for (const key in obj)\r\n        {\r\n            this.deleteClassKey(obj[key]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 反序列化对象为基础对象数据（由Object与Array组合）\r\n     *\r\n     * @param object 换为Json的对象\r\n     * @returns 反序列化后的数据\r\n     */\r\n    deserialize<T>(object: gPartial<T>): T\r\n    {\r\n        const handlers = this.deserializeHandlers.sort((a, b) => b.priority - a.priority).map((v) => v.handler);\r\n\r\n        const param: DeserializeHandlerParam = { handlers, serialization: this, refs: {} };\r\n\r\n        const result: any = {};\r\n\r\n        propertyHandler(result, { __root__: object }, rootKey, param);\r\n        const v = result[rootKey];\r\n\r\n        // 处理 循环引用以及多次引用\r\n        Object.keys(param.refs).forEach((refid) =>\r\n        {\r\n            const refs = param.refs[refid];\r\n            const value = refs.target[refs.property];\r\n\r\n            delete value[serializeIsRawKey];\r\n            delete value[serializeRefKey];\r\n            refs.refs.forEach((ref) =>\r\n            {\r\n                ref.target[ref.property] = value;\r\n            });\r\n        });\r\n\r\n        return v;\r\n    }\r\n\r\n    /**\r\n     * 比较两个对象的不同，提取出不同的数据(可能会经过反序列化处理)\r\n     *\r\n     * @param target 用于检测不同的数据\r\n     * @param source 模板（默认）数据\r\n     * @param different 比较得出的不同（简单结构）数据\r\n     *\r\n     * @returns 比较得出的不同数据（由Object与Array组合可 JSON.stringify 的简单结构）\r\n     */\r\n    different<T>(target: T, source: T): gPartial<T>\r\n    {\r\n        const handlers = this.differentHandlers.sort((a, b) => b.priority - a.priority).map((v) => v.handler);\r\n\r\n        const different = { __root__: {} };\r\n\r\n        const param: DifferentHandlerParam = { different, handlers, serialization: this };\r\n\r\n        propertyHandler({ __root__: target }, { __root__: source }, rootKey, param);\r\n\r\n        return different[rootKey];\r\n    }\r\n\r\n    /**\r\n     * 从数据对象中提取数据给目标对象赋值（可能会经过序列化处理）\r\n     *\r\n     * @param target 目标对象\r\n     * @param source 数据对象 可由Object与Array以及自定义类型组合\r\n     */\r\n    setValue<T>(target: T, source: gPartial<T>)\r\n    {\r\n        if (ObjectUtils.isBaseType(source) || target === source) return target;\r\n        const handlers = this.setValueHandlers.sort((a, b) => b.priority - a.priority).map((v) => v.handler);\r\n\r\n        const param: HandlerParam = { handlers, serialization: this };\r\n\r\n        propertyHandler({ __root__: target }, { __root__: source }, rootKey, param);\r\n\r\n        return target;\r\n    }\r\n\r\n    /**\r\n     * 克隆\r\n     * @param target 被克隆对象\r\n     */\r\n    clone<T>(target: T): T\r\n    {\r\n        return this.deserialize(this.serialize(target));\r\n    }\r\n}\r\n\r\n/**\r\n * 获取序列化属性列表\r\n */\r\nfunction getSerializableMembers(object: any, serializableMembers?: string[])\r\n{\r\n    serializableMembers = serializableMembers || [];\r\n    if (object[protoKey])\r\n    {\r\n        getSerializableMembers(object[protoKey], serializableMembers);\r\n    }\r\n    const serializePropertys = object[serializeKey];\r\n\r\n    if (serializePropertys) ArrayUtils.concatToSelf(serializableMembers, serializePropertys);\r\n    ArrayUtils.unique(serializableMembers);\r\n\r\n    return serializableMembers;\r\n}\r\n\r\nexport interface SerializationTempInfo\r\n{\r\n    loadingNum?: number;\r\n    onLoaded?: () => void;\r\n}\r\n\r\n/**\r\n * 默认序列化工具\r\n */\r\nexport const serialization = new Serialization();\r\n\r\nserialization.serializeHandlers.push(\r\n    // 基础类型\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property)\r\n        {\r\n            const spv = source[property];\r\n\r\n            if (ObjectUtils.isBaseType(spv))\r\n            {\r\n                target[property] = spv;\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 处理循环引用以及多次引用\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property, param)\r\n        {\r\n            const spv = source[property];\r\n\r\n            const serializedMap = param.serializedMap;\r\n\r\n            if (serializedMap.has(spv))\r\n            {\r\n                // 处理已经被序列化的对象\r\n                const value = param.serializedMap.get(spv);\r\n                const tpv = value.target[value.property];\r\n\r\n                if (!ObjectUtils.isBaseType(tpv))\r\n                {\r\n                    if (!tpv[serializeRefKey])\r\n                    {\r\n                        tpv[serializeRefKey] = param.autoRefID++;\r\n                        tpv[serializeIsRawKey] = true;\r\n                    }\r\n                    const newtpv: any = {};\r\n\r\n                    newtpv[serializeRefKey] = tpv[serializeRefKey];\r\n                    newtpv[serializeIsRefKey] = true;\r\n                    target[property] = newtpv;\r\n\r\n                    return true;\r\n                }\r\n            }\r\n            else\r\n            {\r\n                // 记录spv 序列化后的数据保存的位置\r\n                serializedMap.set(spv, { target, property });\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 处理方法\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property)\r\n        {\r\n            const spv = source[property];\r\n\r\n            if (spv && typeof spv === 'function')\r\n            {\r\n                const object: any = {};\r\n\r\n                object[__class__] = 'function';\r\n                object.data = spv.toString();\r\n                target[property] = object;\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 排除不支持序列化对象 serializable === false 时不进行序列化\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property)\r\n        {\r\n            const spv = source[property];\r\n\r\n            if (spv && spv.serializable === false)\r\n            {\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 自定义序列化函数\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property)\r\n        {\r\n            const spv = source[property];\r\n\r\n            if (spv && spv.serialize)\r\n            {\r\n                const object = {};\r\n\r\n                target[property] = object;\r\n                object[__class__] = classUtils.getQualifiedClassName(spv);\r\n                spv.serialize(object);\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 处理数组\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property, param)\r\n        {\r\n            const spv = source[property];\r\n\r\n            if (Array.isArray(spv))\r\n            {\r\n                const arr = target[property] || [];\r\n\r\n                target[property] = arr;\r\n                const keys = Object.keys(spv);\r\n\r\n                keys.forEach((v) =>\r\n                {\r\n                    propertyHandler(arr, spv, v, param);\r\n                });\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 处理普通Object\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property, param)\r\n        {\r\n            const spv = source[property];\r\n\r\n            if (ObjectUtils.isObject(spv))\r\n            {\r\n                const object = {};\r\n\r\n                target[property] = object;\r\n                const keys = Object.keys(spv);\r\n\r\n                keys.forEach((key) =>\r\n                {\r\n                    propertyHandler(object, spv, key, param);\r\n                });\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 使用默认序列化\r\n    {\r\n        priority: -10000,\r\n        handler(target, source, property, param)\r\n        {\r\n            const tpv = target[property];\r\n            const spv = source[property];\r\n\r\n            if (!param.serialization.omitDefault)\r\n            {\r\n                const object = {};\r\n\r\n                target[property] = object;\r\n                const className = classUtils.getQualifiedClassName(spv);\r\n                const keys = getSerializableMembers(spv);\r\n\r\n                keys.forEach((key) =>\r\n                {\r\n                    propertyHandler(object, spv, key, param);\r\n                });\r\n                object[__class__] = className;\r\n\r\n                return true;\r\n            }\r\n\r\n            // 执行默认忽略默认值\r\n            if (ObjectUtils.objectIsEmpty(tpv) || tpv.constructor !== spv.constructor)\r\n            {\r\n                const className = classUtils.getQualifiedClassName(spv);\r\n                // 获取或创建对象默认实例，把默认实例保存在构造函数上省去使用map保存。\r\n                let inst = spv.constructor.inst;\r\n\r\n                if (!inst)\r\n                {\r\n                    inst = spv.constructor.inst = new spv.constructor();\r\n                }\r\n                // .constructor 上的属性会被继承\r\n                if (!(inst instanceof spv.constructor))\r\n                {\r\n                    inst = spv.constructor.inst = new spv.constructor();\r\n                }\r\n                const diff: any = param.serialization.different(spv, inst);\r\n\r\n                diff[__class__] = className;\r\n                target[property] = diff;\r\n            }\r\n            else\r\n            {\r\n                const diff: any = param.serialization.different(spv, tpv);\r\n\r\n                if (diff)\r\n                {\r\n                    target[property] = diff;\r\n                }\r\n            }\r\n\r\n            return true;\r\n        }\r\n    },\r\n);\r\n\r\nserialization.deserializeHandlers = [\r\n    // 基础类型\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property)\r\n        {\r\n            const spv = source[property];\r\n\r\n            if (ObjectUtils.isBaseType(spv))\r\n            {\r\n                target[property] = spv;\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 处理循环引用以及多次引用\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property, param)\r\n        {\r\n            const spv = source[property];\r\n\r\n            const refs = param.refs;\r\n\r\n            if (spv[serializeRefKey] !== undefined)\r\n            {\r\n                const refid = spv[serializeRefKey];\r\n\r\n                const currentRef = refs[refid] = refs[refid] || { refs: [], target: null, property: null };\r\n\r\n                if (spv[serializeIsRawKey])\r\n                {\r\n                    currentRef.target = target;\r\n                    currentRef.property = property;\r\n                }\r\n                else\r\n                {\r\n                    currentRef.refs.push({ target, property });\r\n\r\n                    return true;\r\n                }\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 处理方法\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property)\r\n        {\r\n            const spv = source[property];\r\n\r\n            if (spv && spv[__class__] === 'function')\r\n            {\r\n                console.warn(`不支持序列化 function ${spv.data}`);\r\n                // target[property] = eval(`(${spv.data})`);\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 处理非原生Object对象\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property)\r\n        {\r\n            const spv = source[property];\r\n\r\n            if (!ObjectUtils.isObject(spv) && !Array.isArray(spv))\r\n            {\r\n                target[property] = spv;\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 处理数组\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property, param)\r\n        {\r\n            const spv = source[property];\r\n\r\n            if (Array.isArray(spv))\r\n            {\r\n                const arr = target[property] || [];\r\n                const keys = Object.keys(spv);\r\n\r\n                keys.forEach((key) =>\r\n                {\r\n                    propertyHandler(arr, spv, key, param);\r\n                });\r\n                target[property] = arr;\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 处理 没有类名称标记的 普通Object\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property, param)\r\n        {\r\n            const tpv = target[property];\r\n            const spv = source[property];\r\n\r\n            if (ObjectUtils.isObject(spv) && ObjectUtils.objectIsEmpty(spv[__class__]))\r\n            {\r\n                let obj = {};\r\n\r\n                if (tpv) obj = tpv;\r\n                //\r\n                const keys = Object.keys(spv);\r\n\r\n                keys.forEach((key) =>\r\n                {\r\n                    propertyHandler(obj, spv, key, param);\r\n                });\r\n                target[property] = obj;\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 处理自定义反序列化对象\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property)\r\n        {\r\n            const tpv = target[property];\r\n            const spv = source[property];\r\n            let inst = classUtils.getInstanceByName(spv[__class__]);\r\n            // 处理自定义反序列化对象\r\n\r\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n            // @ts-ignore\r\n            if (inst && inst.deserialize)\r\n            {\r\n                if (tpv && tpv.constructor === inst.constructor)\r\n                {\r\n                    inst = tpv;\r\n                }\r\n                // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n                // @ts-ignore\r\n                const result = inst.deserialize(spv);\r\n                if (result)\r\n                {\r\n                    inst = result;\r\n                }\r\n                target[property] = inst;\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 处理自定义对象的反序列化\r\n    {\r\n        priority: -10000,\r\n        handler(target, source, property, param)\r\n        {\r\n            const tpv = target[property];\r\n            const spv = source[property];\r\n            let inst = classUtils.getInstanceByName(spv[__class__]);\r\n\r\n            if (inst)\r\n            {\r\n                if (tpv && tpv.constructor === inst.constructor)\r\n                {\r\n                    inst = tpv;\r\n                }\r\n                // 默认反序列\r\n                const keys = Object.keys(spv);\r\n\r\n                keys.forEach((key) =>\r\n                {\r\n                    if (key !== __class__)\r\n                    { propertyHandler(inst, spv, key, param); }\r\n                });\r\n                target[property] = inst;\r\n\r\n                return true;\r\n            }\r\n            console.warn(`未处理`);\r\n\r\n            return false;\r\n        }\r\n    },\r\n];\r\n\r\nserialization.differentHandlers = [\r\n    // 相等对象\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property)\r\n        {\r\n            if (target[property] === source[property])\r\n            {\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 目标数据为null时\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property, param)\r\n        {\r\n            if (ObjectUtils.objectIsEmpty(source[property]))\r\n            {\r\n                param.different[property] = param.serialization.serialize(target[property]);\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 基础类型\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property, param)\r\n        {\r\n            const tpv = target[property];\r\n\r\n            if (ObjectUtils.isBaseType(tpv))\r\n            {\r\n                param.different[property] = tpv;\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 数组\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property, param)\r\n        {\r\n            const different = param.different;\r\n\r\n            const tpv = target[property];\r\n            const spv = source[property];\r\n\r\n            if (Array.isArray(tpv))\r\n            {\r\n                const keys = Object.keys(tpv);\r\n                const diff = [];\r\n                const newParam: DifferentHandlerParam = { different: diff, handlers: param.handlers, serialization: param.serialization };\r\n\r\n                keys.forEach((key) =>\r\n                {\r\n                    propertyHandler(tpv, spv, key, newParam);\r\n                });\r\n                if (Object.keys(diff).length > 0)\r\n                { different[property] = diff; }\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 不同对象类型\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property, param)\r\n        {\r\n            const tpv = target[property];\r\n            const spv = source[property];\r\n\r\n            if (spv.constructor !== tpv.constructor)\r\n            {\r\n                param.different[property] = param.serialization.serialize(tpv);\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 默认处理\r\n    {\r\n        priority: -10000,\r\n        handler(target, source, property, param)\r\n        {\r\n            const different = param.different;\r\n            const tpv = target[property];\r\n            const spv = source[property];\r\n\r\n            let keys = getSerializableMembers(tpv);\r\n\r\n            if (tpv.constructor === Object)\r\n            {\r\n                keys = Object.keys(tpv);\r\n            }\r\n\r\n            const diff = {};\r\n            const newParam: DifferentHandlerParam = { different: diff, handlers: param.handlers, serialization: param.serialization };\r\n\r\n            keys.forEach((v) =>\r\n            {\r\n                propertyHandler(tpv, spv, v, newParam);\r\n            });\r\n            if (Object.keys(diff).length > 0)\r\n            {\r\n                different[property] = diff;\r\n            }\r\n\r\n            return true;\r\n        }\r\n    },\r\n];\r\n\r\n/**\r\n * 设置函数列表\r\n */\r\nserialization.setValueHandlers = [\r\n    // 值相等时直接返回\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property, _handlers)\r\n        {\r\n            if (target[property] === source[property])\r\n            {\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 当原值等于null时直接反序列化赋值\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property, param)\r\n        {\r\n            const tpv = target[property];\r\n            const spv = source[property];\r\n\r\n            if (ObjectUtils.objectIsEmpty(tpv))\r\n            {\r\n                target[property] = param.serialization.deserialize(spv);\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 处理简单类型\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property)\r\n        {\r\n            const spv = source[property];\r\n\r\n            if (ObjectUtils.isBaseType(spv))\r\n            {\r\n                target[property] = spv;\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 处理数组\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property, param)\r\n        {\r\n            const tpv = target[property];\r\n            const spv = source[property];\r\n\r\n            if (Array.isArray(spv))\r\n            {\r\n                console.assert(!!tpv);\r\n                const keys = Object.keys(spv);\r\n\r\n                keys.forEach((key) =>\r\n                {\r\n                    propertyHandler(tpv, spv, key, param);\r\n                });\r\n                target[property] = tpv;\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 处理非 Object 类型数据\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property, param)\r\n        {\r\n            const spv = source[property];\r\n\r\n            if (!ObjectUtils.isObject(spv))\r\n            {\r\n                target[property] = param.serialization.deserialize(spv);\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 处理 Object 基础类型数据\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property, param)\r\n        {\r\n            const tpv = target[property];\r\n            const spv = source[property];\r\n\r\n            if (ObjectUtils.isObject(spv) && spv[__class__] === undefined)\r\n            {\r\n                console.assert(!!tpv);\r\n                const keys = Object.keys(spv);\r\n\r\n                keys.forEach((key) =>\r\n                {\r\n                    propertyHandler(tpv, spv, key, param);\r\n                });\r\n                target[property] = tpv;\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 处理自定义类型\r\n    {\r\n        priority: -10000,\r\n        handler(target, source, property, param)\r\n        {\r\n            const tpv = target[property];\r\n            const spv = source[property];\r\n\r\n            const targetClassName = classUtils.getQualifiedClassName(target[property]);\r\n            // 相同对象类型\r\n\r\n            if (targetClassName === spv[__class__])\r\n            {\r\n                const keys = Object.keys(spv);\r\n\r\n                keys.forEach((key) =>\r\n                {\r\n                    propertyHandler(tpv, spv, key, param);\r\n                });\r\n                target[property] = tpv;\r\n            }\r\n            else\r\n            {\r\n                // 不同对象类型\r\n                target[property] = param.serialization.deserialize(spv);\r\n            }\r\n\r\n            return true;\r\n        }\r\n    },\r\n];\r\n\r\n[Float32Array, Float64Array, Int8Array, Int16Array, Int32Array, Uint8Array, Uint16Array, Uint32Array, Uint8ClampedArray].forEach((element) =>\r\n{\r\n    element.prototype['serialize'] = function (object: { value: number[] })\r\n    {\r\n        object.value = Array.from(this);\r\n\r\n        return object;\r\n    };\r\n\r\n    element.prototype['deserialize'] = function (object: { value: number[] })\r\n    {\r\n        return new (this.constructor as any)(object.value);\r\n    };\r\n});\r\n\r\nconst serializeRefKey = '__serialize__Ref__';\r\nconst serializeIsRefKey = '__serialize__IsRef__';\r\nconst serializeIsRawKey = '__serialize__IsRaw__';\r\nconst rootKey = '__root__';\r\nconst protoKey = '__proto__';\r\nconst serializeKey = '_serialize__';\r\n","/**\r\n * 观察装饰器，观察被装饰属性的变化\r\n *\r\n * @param onChange 属性变化回调  例如参数为“onChange”时，回调将会调用this.onChange(property, oldValue, newValue)\r\n *\r\n * 使用@watch后会自动生成一个带\"_\"的属性，例如 属性\"a\"会生成\"_a\"\r\n *\r\n * 通过使用 eval 函数 生成出 与自己手动写的set get 一样的函数，性能已经接近 手动写的get set函数。\r\n *\r\n * 性能比Watcher.watch更加高效，但还是建议使用 Watcher.watch 替代 @watch ，由于 @watch 没有对onChange更好的约束 使用 时容易出现运行时报错。\r\n */\r\nexport function watch(onChange: string)\r\n{\r\n    return (target: any, property: string) =>\r\n    {\r\n        const key = `_${property}`;\r\n\r\n        console.assert(target[onChange], `在对象 ${target} 上找不到方法 ${onChange}`);\r\n\r\n        Object.defineProperty(target, property, {\r\n            get() { return this[key]; },\r\n            set(value)\r\n            {\r\n                if (this[key] === value)\r\n                {\r\n                    return;\r\n                }\r\n                const oldValue = this[key];\r\n\r\n                this[key] = value;\r\n                this[onChange](property, oldValue, value);\r\n            },\r\n            enumerable: true,\r\n            configurable: true,\r\n        });\r\n    };\r\n}\r\n\r\nexport class Watcher\r\n{\r\n    /**\r\n     * 监听对象属性的变化\r\n     *\r\n     * 注意：使用watch后获取该属性值的性能将会是原来的1/60，避免在运算密集处使用该函数。\r\n     *\r\n     * @param object 被监听对象\r\n     * @param property 被监听属性\r\n     * @param handler 变化回调函数 (object: T, property: string, oldValue: V) => void\r\n     * @param thisObject 变化回调函数 this值\r\n     */\r\n    watch<T, K extends PropertyNames<T>, V extends T[K]>(object: T, property: K, handler: (newValue: V, oldValue: V, object: T, property: string) => void, thisObject?: any)\r\n    {\r\n        if (!Object.getOwnPropertyDescriptor(object, __watchs__))\r\n        {\r\n            Object.defineProperty(object, __watchs__, {\r\n                value: {},\r\n                enumerable: false,\r\n                configurable: true,\r\n                writable: false,\r\n            });\r\n        }\r\n        const _property: string = property as any;\r\n        const watchs: Watchs = object[__watchs__];\r\n\r\n        if (!watchs[_property])\r\n        {\r\n            const oldPropertyDescriptor = Object.getOwnPropertyDescriptor(object, _property);\r\n\r\n            watchs[_property] = { value: object[_property], oldPropertyDescriptor, handlers: [] };\r\n            //\r\n            let data = getPropertyDescriptor(object, _property);\r\n\r\n            if (data && data.set && data.get)\r\n            {\r\n                data = { enumerable: data.enumerable, configurable: true, get: data.get, set: data.set };\r\n                const orgSet = data.set;\r\n\r\n                data.set = function (value)\r\n                {\r\n                    const oldValue = this[_property];\r\n\r\n                    if (oldValue !== value)\r\n                    {\r\n                        orgSet && orgSet.call(this, value);\r\n                        notifyListener(value, oldValue, this, _property);\r\n                    }\r\n                };\r\n            }\r\n            else if (!data || (!data.get && !data.set))\r\n            {\r\n                data = { enumerable: true, configurable: true };\r\n                data.get = function ()\r\n                {\r\n                    return this[__watchs__][_property].value;\r\n                };\r\n                data.set = function (value)\r\n                {\r\n                    const oldValue = this[__watchs__][_property].value;\r\n\r\n                    if (oldValue !== value)\r\n                    {\r\n                        this[__watchs__][_property].value = value;\r\n                        notifyListener(value, oldValue, this, _property);\r\n                    }\r\n                };\r\n            }\r\n            else\r\n            {\r\n                console.warn(`watch ${object} . ${_property} 失败！`);\r\n\r\n                return;\r\n            }\r\n            Object.defineProperty(object, _property, data);\r\n        }\r\n\r\n        const propertywatchs = watchs[_property];\r\n        const has = propertywatchs.handlers.reduce((v, item) => v || (item.handler === handler && item.thisObject === thisObject), false);\r\n\r\n        if (!has)\r\n        {\r\n            propertywatchs.handlers.push({ handler, thisObject });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 取消监听对象属性的变化\r\n     *\r\n     * @param object 被监听对象\r\n     * @param property 被监听属性\r\n     * @param handler 变化回调函数 (object: T, property: string, oldValue: V) => void\r\n     * @param thisObject 变化回调函数 this值\r\n     */\r\n    unwatch<T, K extends PropertyNames<T>, V extends T[K]>(object: T, property: K, handler?: (newValue: V, oldValue: V, object: T, property: string) => void, thisObject?: any)\r\n    {\r\n        const watchs: Watchs = object[__watchs__];\r\n\r\n        if (!watchs) return;\r\n        const _property: string = property as any;\r\n\r\n        if (watchs[_property])\r\n        {\r\n            const handlers = watchs[_property].handlers;\r\n\r\n            if (handler === undefined)\r\n            {\r\n                handlers.length = 0;\r\n            }\r\n            for (let i = handlers.length - 1; i >= 0; i--)\r\n            {\r\n                if (handlers[i].handler === handler && (handlers[i].thisObject === thisObject || thisObject === undefined))\r\n                {\r\n                    handlers.splice(i, 1);\r\n                }\r\n            }\r\n            if (handlers.length === 0)\r\n            {\r\n                const value = object[_property];\r\n\r\n                delete object[_property];\r\n                if (watchs[_property].oldPropertyDescriptor)\r\n                {\r\n                    Object.defineProperty(object, _property, watchs[_property].oldPropertyDescriptor);\r\n                }\r\n                object[_property] = value;\r\n                delete watchs[_property];\r\n            }\r\n            if (Object.keys(watchs).length === 0)\r\n            {\r\n                delete object[__watchs__];\r\n            }\r\n        }\r\n    }\r\n\r\n    private _binds: [any, string, () => void, any, string, () => void][] = [];\r\n\r\n    /**\r\n     * 绑定两个对象的指定属性，保存两个属性值同步。\r\n     *\r\n     * @param object0 第一个对象。\r\n     * @param property0 第一个对象的属性名称。\r\n     * @param object1 第二个对象。\r\n     * @param property1 第二个对象的属性名称。\r\n     */\r\n    bind<T0, T1, K0 extends PropertyNames<T0>, K1 extends PropertyNames<T1>>(object0: T0, property0: K0, object1: T1, property1: K1)\r\n    {\r\n        const fun0 = () =>\r\n        {\r\n            object1[property1] = object0[property0] as any;\r\n        };\r\n        const fun1 = () =>\r\n        {\r\n            object0[property0] = object1[property1] as any;\r\n        };\r\n\r\n        this.watch(object0, property0, fun0);\r\n        this.watch(object1, property1, fun1);\r\n\r\n        this._binds.push([object0, property0 as any, fun0, object1, property1 as any, fun1]);\r\n    }\r\n\r\n    /**\r\n     * 解除两个对象的指定属性的绑定。\r\n     *\r\n     * @param object0 第一个对象。\r\n     * @param property0 第一个对象的属性名称。\r\n     * @param object1 第二个对象。\r\n     * @param property1 第二个对象的属性名称。\r\n     */\r\n    unbind<T0, T1, K0 extends PropertyNames<T0>, K1 extends PropertyNames<T1>>(object0: T0, property0: K0, object1: T1, property1: K1)\r\n    {\r\n        const binds = this._binds;\r\n\r\n        for (let i = binds.length - 1; i >= 0; i--)\r\n        {\r\n            const v = binds[i];\r\n\r\n            if ((v[1] === property0 && v[4] === property1) || (v[1] === property1 && v[4] === property0))\r\n            {\r\n                if ((v[0] === object0 && v[3] === object1) || (v[0] === object1 && v[3] === object0))\r\n                {\r\n                    this.unwatch(v[0], v[1], v[2]);\r\n                    this.unwatch(v[3], v[4], v[5]);\r\n                    binds.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 监听对象属性链值变化\r\n     *\r\n     * @param object 被监听对象\r\n     * @param property 被监听属性 例如：\"a.b\"\r\n     * @param handler 变化回调函数 (newValue: any, oldValue: any, object: any, property: string) => void\r\n     * @param thisObject 变化回调函数 this值\r\n     */\r\n    watchchain(object: any, property: string, handler: (newValue: any, oldValue: any, object: any, property: string) => void, thisObject?: any)\r\n    {\r\n        const notIndex = property.indexOf('.');\r\n\r\n        if (notIndex === -1)\r\n        {\r\n            this.watch(object, property, handler, thisObject);\r\n\r\n            return;\r\n        }\r\n        if (!Object.getOwnPropertyDescriptor(object, __watchchains__))\r\n        {\r\n            Object.defineProperty(object, __watchchains__, { value: {}, enumerable: false, writable: false, configurable: true });\r\n        }\r\n        const watchchains: WatchChains = object[__watchchains__];\r\n\r\n        if (!watchchains[property])\r\n        {\r\n            watchchains[property] = [];\r\n        }\r\n\r\n        const propertywatchs = watchchains[property];\r\n        const has = propertywatchs.reduce((v, item) => v || (item.handler === handler && item.thisObject === thisObject), false);\r\n\r\n        if (!has)\r\n        {\r\n            // 添加下级监听链\r\n            const currentp = property.substr(0, notIndex);\r\n            const nextp = property.substr(notIndex + 1);\r\n\r\n            if (object[currentp])\r\n            {\r\n                this.watchchain(object[currentp], nextp, handler, thisObject);\r\n            }\r\n\r\n            // 添加链监听\r\n            const watchchainFun = (newValue: any, oldValue: any) =>\r\n            {\r\n                if (oldValue) this.unwatchchain(oldValue, nextp, handler, thisObject);\r\n                if (newValue) this.watchchain(newValue, nextp, handler, thisObject);\r\n                // 当更换对象且监听值发生改变时触发处理函数\r\n                const ov = getObjectPropertyValue(oldValue, nextp);\r\n                const nv = getObjectPropertyValue(newValue, nextp);\r\n\r\n                if (ov !== nv)\r\n                {\r\n                    handler.call(thisObject, nv, ov, newValue, nextp);\r\n                }\r\n            };\r\n\r\n            this.watch(object, currentp, watchchainFun);\r\n\r\n            // 记录链监听函数\r\n            propertywatchs.push({ handler, thisObject, watchchainFun });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 取消监听对象属性链值变化\r\n     *\r\n     * @param object 被监听对象\r\n     * @param property 被监听属性 例如：\"a.b\"\r\n     * @param handler 变化回调函数 (object: T, property: string, oldValue: V) => void\r\n     * @param thisObject 变化回调函数 this值\r\n     */\r\n    unwatchchain(object: any, property: string, handler?: (newValue: any, oldValue: any, object: any, property: string) => void, thisObject?: any)\r\n    {\r\n        const notIndex = property.indexOf('.');\r\n\r\n        if (notIndex === -1)\r\n        {\r\n            this.unwatch(object, property, handler, thisObject);\r\n\r\n            return;\r\n        }\r\n\r\n        const currentp = property.substr(0, notIndex);\r\n        const nextp = property.substr(notIndex + 1);\r\n\r\n        //\r\n        const watchchains: WatchChains = object[__watchchains__];\r\n\r\n        if (!watchchains || !watchchains[property]) return;\r\n\r\n        //\r\n        const propertywatchs = watchchains[property];\r\n\r\n        for (let i = propertywatchs.length - 1; i >= 0; i--)\r\n        {\r\n            const element = propertywatchs[i];\r\n\r\n            if (objectIsEmpty(handler) || (handler === element.handler && thisObject === element.thisObject))\r\n            {\r\n                // 删除下级监听链\r\n                if (object[currentp])\r\n                {\r\n                    this.unwatchchain(object[currentp], nextp, element.handler, element.thisObject);\r\n                }\r\n                // 删除链监听\r\n                this.unwatch(object, currentp, element.watchchainFun);\r\n                // 清理记录链监听函数\r\n                propertywatchs.splice(i, 1);\r\n            }\r\n        }\r\n        // 清理空列表\r\n        if (propertywatchs.length === 0) delete watchchains[property];\r\n        if (Object.keys(watchchains).length === 0)\r\n        {\r\n            delete object[__watchchains__];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 监听对象属性链值变化\r\n     *\r\n     * @param object 被监听对象\r\n     * @param property 被监听属性 例如：{a:{b:null,d:null}} 表示监听 object.a.b 与 object.a.d 值得变化，如果property===object时表示监听对象中所有叶子属性变化。\r\n     * @param handler 变化回调函数 (newValue: any, oldValue: any, host: any, property: string) => void\r\n     * @param thisObject 变化回调函数 this值\r\n     */\r\n    watchobject<T>(object: T, property: gPartial<T>, handler: (newValue: any, oldValue: any, host: any, property: string) => void, thisObject?: any)\r\n    {\r\n        const chains = getObjectPropertyChains(property);\r\n\r\n        chains.forEach((v) =>\r\n        {\r\n            this.watchchain(object, v, handler, thisObject);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 取消监听对象属性链值变化\r\n     *\r\n     * @param object 被监听对象\r\n     * @param property 被监听属性 例如：{a:{b:null,d:null}} 表示监听 object.a.b 与 object.a.d 值得变化，如果property===object时表示监听对象中所有叶子属性变化。\r\n     * @param handler 变化回调函数 newValue: any, oldValue: any, host: any, property: string => void\r\n     * @param thisObject 变化回调函数 this值\r\n     */\r\n    unwatchobject<T>(object: T, property: gPartial<T>, handler?: (newValue: any, oldValue: any, host: any, property: string) => void, thisObject?: any)\r\n    {\r\n        const chains = getObjectPropertyChains(property);\r\n\r\n        chains.forEach((v) =>\r\n        {\r\n            this.unwatchchain(object, v, handler, thisObject);\r\n        });\r\n    }\r\n}\r\n\r\nexport const watcher = new Watcher();\r\n\r\ninterface Watchs\r\n{\r\n    [property: string]: { value: any, oldPropertyDescriptor: any, handlers: { handler: (newValue: any, oldValue: any, host: any, property: string) => void, thisObject: any }[] };\r\n}\r\n\r\ninterface WatchChains\r\n{\r\n    [property: string]: { handler: (newValue: any, oldValue: any, host: any, property: string) => void, thisObject: any, watchchainFun: (newValue: any, oldValue: any, host: any, property: string) => void }[];\r\n}\r\n\r\nexport const __watchs__ = '__watchs__';\r\nexport const __watchchains__ = '__watchchains__';\r\n\r\nfunction notifyListener(newValue: any, oldValue: any, host: any, property: string): void\r\n{\r\n    const watchs: Watchs = host[__watchs__];\r\n    const handlers = watchs[property].handlers;\r\n\r\n    handlers.forEach((element) =>\r\n    {\r\n        element.handler.call(element.thisObject, newValue, oldValue, host, property);\r\n    });\r\n}\r\n\r\n/**\r\n * 让T中以及所有键值中的所有键都是可选的\r\n */\r\ntype gPartial<T> = {\r\n    [P in keyof T]?: gPartial<T[P]>;\r\n};\r\n\r\n/**\r\n * 从对象自身或者对象的原型中获取属性描述\r\n *\r\n * @param object 对象\r\n * @param property 属性名称\r\n */\r\nfunction getPropertyDescriptor(object: Object, property: string): PropertyDescriptor | undefined\r\n{\r\n    const data = Object.getOwnPropertyDescriptor(object, property);\r\n    if (data)\r\n    {\r\n        return data;\r\n    }\r\n    const prototype = Object.getPrototypeOf(object);\r\n    if (prototype)\r\n    {\r\n        return getPropertyDescriptor(prototype, property);\r\n    }\r\n\r\n    return undefined;\r\n}\r\n\r\n/**\r\n * 判断对象是否为null或者undefine\r\n *\r\n * @param obj\r\n * @returns\r\n */\r\nfunction objectIsEmpty(obj: any)\r\n{\r\n    if (obj === undefined || obj === null)\r\n    {\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n/**\r\n * 选取T类型中值为非函数类型的所有键\r\n */\r\ntype PropertyNames<T> = NonTypePropertyNames<T, Function>;\r\n\r\n/**\r\n * 获取T类型中除值为KT类型以外的所有键\r\n *\r\n * ```\r\n * class A\r\n * {\r\n *      a = 1;\r\n *      f(){}\r\n * }\r\n *\r\n * var a: NonTypePropertyNames<A, number>; //var a:\"f\"\r\n * var a1: NonTypePropertyNames<A, Function>; //var a:\"a\"\r\n *\r\n * ```\r\n */\r\ntype NonTypePropertyNames<T, KT> = { [K in keyof T]: T[K] extends KT ? never : K }[keyof T];\r\n\r\n/**\r\n * 获取对象对应属性上的值\r\n *\r\n * @param object 对象\r\n * @param property 属性名称，可以是 \"a\" 或者 \"a.b\" 或者 [\"a\",\"b\"]\r\n */\r\nfunction getObjectPropertyValue(object: Object, property: string | string[])\r\n{\r\n    if (typeof property === 'string') property = property.split('.');\r\n    let value = object;\r\n    for (let i = 0; i < property.length; i++)\r\n    {\r\n        if (objectIsEmpty(value)) return undefined;\r\n        value = value[property[i]];\r\n    }\r\n\r\n    return value;\r\n}\r\n\r\n/**\r\n * 获取对象上属性链列表\r\n *\r\n * 例如 object值为{ a: { b: { c: 1 }, d: 2 } }时则返回 [\"a.b.c\",\"a.d\"]\r\n *\r\n * @param object 对象\r\n */\r\nfunction getObjectPropertyChains(object: Object): string[]\r\n{\r\n    const result: string[] = [];\r\n    // 属性名称列表\r\n    const propertys = Object.keys(object);\r\n    // 属性所属对象列表\r\n    const hosts = new Array(propertys.length).fill(object);\r\n    // 父属性所在编号列表\r\n    const parentPropertyIndices = new Array(propertys.length).fill(-1);\r\n    // 处理到的位置\r\n    let index = 0;\r\n    while (index < propertys.length)\r\n    {\r\n        const host = hosts[index];\r\n        const cp = propertys[index];\r\n        const cv = host[cp];\r\n        let vks: string[];\r\n        if (objectIsEmpty(cv) || isBaseType(cv) || (vks = Object.keys(cv)).length === 0)\r\n        {\r\n            // 处理叶子属性\r\n            const ps = [cp];\r\n            let ci = index;\r\n            // 查找并组合属性链\r\n            while ((ci = parentPropertyIndices[ci]) !== -1)\r\n            {\r\n                ps.push(propertys[ci]);\r\n            }\r\n            ps.reverse();\r\n            result.push(ps.join('.'));\r\n        }\r\n        else\r\n        {\r\n            // 处理中间属性\r\n            // eslint-disable-next-line no-loop-func\r\n            vks.forEach((k) =>\r\n            {\r\n                propertys.push(k);\r\n                hosts.push(cv);\r\n                parentPropertyIndices.push(index);\r\n            });\r\n        }\r\n\r\n        index++;\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\n/**\r\n * 判断是否为基础类型 undefined,null,boolean,string,number\r\n */\r\nfunction isBaseType(object: any): boolean\r\n{\r\n    // 基础类型\r\n    if (\r\n        object === undefined || object === null\r\n        || typeof object === 'boolean'\r\n        || typeof object === 'string'\r\n        || typeof object === 'number'\r\n    )\r\n    { return true; }\r\n\r\n    return false;\r\n}\r\n\r\n","import { IEvent } from './IEvent';\r\nimport { IEventListener } from './IEventListener';\r\nimport { IEventTarget } from './IEventTarget';\r\n\r\n/**\r\n * 事件发射器\r\n */\r\nexport class EventEmitter<T = any>\r\n{\r\n    /**\r\n     * 目标与发射器映射。\r\n     */\r\n    private static targetEmitterMap = new Map<any, EventEmitter>();\r\n\r\n    /**\r\n     * 发射器与目标映射。\r\n     */\r\n    private static emitterTargetMap = new Map<EventEmitter, IEventTarget>();\r\n\r\n    /**\r\n     * 发射器与监听器映射。\r\n     */\r\n    private static emitterListenerMap = new Map<EventEmitter, ObjectListener>();\r\n\r\n    /**\r\n     * 获取事件发射器\r\n     * @param target\r\n     */\r\n    static getEventEmitter(target: any)\r\n    {\r\n        console.assert(target !== undefined && target !== null, `被监听对象无法为undefined或者null！`);\r\n        if (target instanceof EventEmitter)\r\n        {\r\n            return target;\r\n        }\r\n\r\n        return this.targetEmitterMap.get(target);\r\n    }\r\n\r\n    /**\r\n     * 获取事件发射器，当没有找到对应发射器时，返回新建的事件发射器。\r\n     * @param target\r\n     */\r\n    static getOrCreateEventEmitter(target: any)\r\n    {\r\n        let eventEmitter = this.getEventEmitter(target);\r\n\r\n        if (!eventEmitter)\r\n        {\r\n            eventEmitter = new EventEmitter(target);\r\n        }\r\n\r\n        return eventEmitter;\r\n    }\r\n\r\n    constructor(target?: any)\r\n    {\r\n        if (target === undefined)\r\n        {\r\n            target = this;\r\n        }\r\n        console.assert(!EventEmitter.targetEmitterMap.has(target), `同一个 ${target} 对象无法对应两个 EventEmitter！`);\r\n        EventEmitter.targetEmitterMap.set(target, this);\r\n        EventEmitter.emitterTargetMap.set(this, target);\r\n    }\r\n\r\n    /**\r\n     * 返回监听的事件类型列表。\r\n     */\r\n    eventNames<K extends keyof T & string>()\r\n    {\r\n        const names = Object.keys(EventEmitter.emitterListenerMap.get(this)) as K[];\r\n\r\n        return names;\r\n    }\r\n\r\n    /**\r\n     * 返回指定事件类型的监听数量。\r\n     *\r\n     * @param type 事件的类型。\r\n     */\r\n    listenerCount<K extends keyof T & string>(type: K): number\r\n    {\r\n        return EventEmitter.emitterListenerMap.get(this)?.[type]?.length || 0;\r\n    }\r\n\r\n    /**\r\n     * 监听一次事件后将会被移除\r\n     *\r\n     * @param type\t\t\t\t\t\t事件的类型。\r\n     * @param listener\t\t\t\t\t处理事件的侦听器函数。\r\n     * @param thisObject                listener函数作用域\r\n     * @param priority\t\t\t\t\t事件侦听器的优先级。数字越大，优先级越高。默认优先级为 0。\r\n     */\r\n    once<K extends keyof T & string>(type: K, listener: (event: IEvent<T[K]>) => void, thisObject?: any, priority = 0): this\r\n    {\r\n        this.on(type, listener, thisObject, priority, true);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 发射事件。\r\n     *\r\n     * 当事件重复流向一个对象时将不会被处理。\r\n     *\r\n     * @param event   事件对象\r\n     * @returns 返回事件是否被处理\r\n     */\r\n    emitEvent<K extends keyof T & string>(event: IEvent<T[K]>)\r\n    {\r\n        const currentTarget = EventEmitter.emitterTargetMap.get(this);\r\n\r\n        if (event.targets.indexOf(currentTarget) !== -1)\r\n        {\r\n            return event;\r\n        }\r\n\r\n        // 处理事件\r\n        const eventEmitter = EventEmitter.getOrCreateEventEmitter(currentTarget);\r\n        eventEmitter.handleEvent(event);\r\n\r\n        // 向平级分享事件\r\n        eventEmitter.handelEventShare(event);\r\n\r\n        // 向上级报告事件\r\n        eventEmitter.handelEventBubbles(event);\r\n\r\n        // 向下级广播事件\r\n        eventEmitter.handelEventBroadcast(event);\r\n\r\n        return event; // 当处理次数大于0时表示已被处理。\r\n    }\r\n\r\n    /**\r\n     * 发射事件。\r\n     *\r\n     * @param type 事件的类型。类型区分大小写。\r\n     * @param data 事件携带的自定义数据。\r\n     * @param bubbles 是否向上级报告事件。默认为`false`。\r\n     * @param broadcast 是否向下级广播事件。默认为`false`。\r\n     * @param share 是否向平级分享事件。默认为`true`。\r\n     *\r\n     * @returns 返回发射后的事件。\r\n     */\r\n    emit<K extends keyof T & string>(type: K, data?: T[K], bubbles = false, broadcast = false, share = true)\r\n    {\r\n        const event: IEvent<T[K]> = {\r\n            type,\r\n            data,\r\n            share,\r\n            bubbles,\r\n            broadcast,\r\n            target: undefined,\r\n            currentTarget: undefined,\r\n            isStopShare: false,\r\n            isStopBubbles: false,\r\n            isStopBroadcast: false,\r\n            isStopTransmit: false,\r\n            isStop: false,\r\n            targets: [],\r\n            handles: [],\r\n        };\r\n        this.emitEvent(event);\r\n\r\n        return event;\r\n    }\r\n\r\n    /**\r\n     * 将事件广播到下级对象中。\r\n     *\r\n     * @param type                      事件的类型。类型区分大小写。\r\n     * @param data                      事件携带的自定义数据。\r\n     *\r\n     * @returns 返回广播后的事件。\r\n     */\r\n    broadcast<K extends keyof T & string>(type: K, data?: T[K])\r\n    {\r\n        return this.emit(type, data, false, true);\r\n    }\r\n\r\n    /**\r\n     * 将事件冒泡到上级对象中。\r\n     *\r\n     * @param type                      事件的类型。类型区分大小写。\r\n     * @param data                      事件携带的自定义数据。\r\n     *\r\n     * @returns 返回冒泡后的事件。\r\n     */\r\n    bubbles<K extends keyof T & string>(type: K, data?: T[K])\r\n    {\r\n        return this.emit(type, data, true, false);\r\n    }\r\n\r\n    /**\r\n     * 检查 Event 对象是否为特定事件类型注册了任何侦听器.\r\n     *\r\n     * @param type\t\t事件的类型。\r\n     * @return \t\t\t如果指定类型的侦听器已注册，则值为 true；否则，值为 false。\r\n     */\r\n    has<K extends keyof T & string>(type: K): boolean\r\n    {\r\n        return this.listenerCount(type) > 0;\r\n    }\r\n\r\n    /**\r\n     * 为监听对象新增指定类型的事件监听。\r\n     *\r\n     * @param type\t\t\t\t\t\t事件的类型。\r\n     * @param listener\t\t\t\t\t处理事件的监听器函数。\r\n     * @param thisObject                监听器的上下文。可选。\r\n     * @param priority\t\t\t\t\t事件监听器的优先级。数字越大，优先级越高。默认为0。\r\n     * @param once                      值为true时在监听一次事件后该监听器将被移除。默认为false。\r\n     */\r\n    on<K extends keyof T & string>(type: K, listener: (event: IEvent<T[K]>) => void, thisObject?: any, priority = 0, once = false): this\r\n    {\r\n        if (listener === null) return this;\r\n\r\n        let objectListener = EventEmitter.emitterListenerMap.get(this);\r\n\r\n        if (!objectListener)\r\n        {\r\n            objectListener = { __anyEventType__: [] };\r\n            EventEmitter.emitterListenerMap.set(this, objectListener);\r\n        }\r\n\r\n        thisObject = thisObject || this;\r\n        const listeners: IEventListener[] = objectListener[type] = objectListener[type] || [];\r\n\r\n        let i = 0;\r\n\r\n        for (i = 0; i < listeners.length; i++)\r\n        {\r\n            const element = listeners[i];\r\n\r\n            if (element.listener === listener && element.thisObject === thisObject)\r\n            {\r\n                listeners.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n        listeners.push({ listener, thisObject, priority, once });\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 移除监听\r\n     *\r\n     * @param type\t\t\t\t\t\t事件的类型。可选。该值为空时所有被监听对象上的监听均将被移除。\r\n     * @param listener\t\t\t\t\t要删除的监听器对象。可选。该值为空时所有指定类型的监听均将被移除。\r\n     * @param thisObject                监听器的上下文。可选。\r\n     */\r\n    off<K extends keyof T & string>(type?: K, listener?: (event: IEvent<T[K]>) => void, thisObject?: any): this\r\n    {\r\n        if (!type)\r\n        {\r\n            EventEmitter.emitterListenerMap.delete(this);\r\n\r\n            return this;\r\n        }\r\n\r\n        const objectListener = EventEmitter.emitterListenerMap.get(this);\r\n\r\n        if (!objectListener) return this;\r\n\r\n        if (!listener)\r\n        {\r\n            delete objectListener[type];\r\n\r\n            return this;\r\n        }\r\n\r\n        thisObject = thisObject || this;\r\n\r\n        const listeners = objectListener[type];\r\n\r\n        if (listeners)\r\n        {\r\n            for (let i = listeners.length - 1; i >= 0; i--)\r\n            {\r\n                const element = listeners[i];\r\n\r\n                if (element.listener === listener && element.thisObject === thisObject)\r\n                {\r\n                    listeners.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n            if (listeners.length === 0)\r\n            {\r\n                delete objectListener[type];\r\n            }\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 移除所有监听\r\n     *\r\n     * @param type\t\t\t\t\t\t事件的类型。可选。该值为空时所有被监听对象上的监听均将被移除。\r\n     */\r\n    offAll<K extends keyof T & string>(type?: K)\r\n    {\r\n        this.off(type);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 监听对象的任意事件，该对象的任意事件都将触发该监听器的调用。\r\n     *\r\n     * @param listener                  处理事件的监听器函数。\r\n     * @param thisObject                监听器的上下文。可选。\r\n     * @param priority                  事件监听器的优先级。数字越大，优先级越高。默认为0。\r\n     * @param once                      值为true时在监听一次事件后该监听器将被移除。默认为false。\r\n     */\r\n    onAny<K extends keyof T & string>(listener: (event: IEvent<T[K]>) => void, thisObject?: any, priority = 0, once = false)\r\n    {\r\n        let objectListener = EventEmitter.emitterListenerMap.get(this);\r\n\r\n        if (!objectListener)\r\n        {\r\n            objectListener = { __anyEventType__: [] };\r\n            EventEmitter.emitterListenerMap.set(this, objectListener);\r\n        }\r\n\r\n        const listeners = objectListener.__anyEventType__;\r\n\r\n        let i = 0;\r\n\r\n        for (i = 0; i < listeners.length; i++)\r\n        {\r\n            const element = listeners[i];\r\n\r\n            if (element.listener === listener && element.thisObject === thisObject)\r\n            {\r\n                listeners.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n        listeners.push({ listener, thisObject, priority, once });\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 移除监听对象的任意事件。\r\n     *\r\n     * @param listener                  处理事件的监听器函数。\r\n     * @param thisObject                监听器的上下文。可选。\r\n     */\r\n    offAny<K extends keyof T & string>(listener?: (event: IEvent<T[K]>) => void, thisObject?: any)\r\n    {\r\n        const objectListener = EventEmitter.emitterListenerMap.get(this);\r\n\r\n        if (!listener)\r\n        {\r\n            if (objectListener)\r\n            {\r\n                objectListener.__anyEventType__.length = 0;\r\n            }\r\n\r\n            return;\r\n        }\r\n        if (objectListener)\r\n        {\r\n            const listeners = objectListener.__anyEventType__;\r\n\r\n            for (let i = listeners.length - 1; i >= 0; i--)\r\n            {\r\n                const element = listeners[i];\r\n\r\n                if (element.listener === listener && element.thisObject === thisObject)\r\n                {\r\n                    listeners.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 处理事件\r\n     * @param e 事件\r\n     */\r\n    protected handleEvent<K extends keyof T & string>(e: IEvent<T[K]>)\r\n    {\r\n        // 设置目标\r\n        const eventTarget = EventEmitter.emitterTargetMap.get(this);\r\n        e.target = e.target || eventTarget;\r\n        e.currentTarget = eventTarget;\r\n        e.targets.push(eventTarget);\r\n        //\r\n        const objectListener = EventEmitter.emitterListenerMap.get(this);\r\n\r\n        if (!objectListener) return;\r\n\r\n        let listeners = objectListener[e.type];\r\n\r\n        const callListeners: IEventListener[] = [];\r\n        if (listeners)\r\n        {\r\n            // 遍历调用事件回调函数\r\n            listeners.forEach((v) => callListeners.push(v));\r\n\r\n            for (let i = listeners.length - 1; i >= 0; i--)\r\n            {\r\n                if (listeners[i].once)\r\n                {\r\n                    listeners.splice(i, 1);\r\n                }\r\n            }\r\n            if (listeners.length === 0)\r\n            {\r\n                delete objectListener[e.type];\r\n            }\r\n        }\r\n        // Any_EVENT_Type\r\n        listeners = objectListener.__anyEventType__;\r\n        if (listeners)\r\n        {\r\n            // 遍历调用事件回调函数\r\n            listeners.forEach((v) => callListeners.push(v));\r\n\r\n            for (let i = listeners.length - 1; i >= 0; i--)\r\n            {\r\n                if (listeners[i].once)\r\n                {\r\n                    listeners.splice(i, 1);\r\n                }\r\n            }\r\n        }\r\n\r\n        // 按优先级从高到底排序进行执行监听器。\r\n        callListeners.sort((a, b) => b.priority - a.priority);\r\n        for (let i = 0; i < callListeners.length && !e.isStop; i++)\r\n        {\r\n            callListeners[i].listener.call(callListeners[i].thisObject, e);\r\n            e.handles.push(callListeners[i]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 向平级分享事件\r\n     *\r\n     * @param event 事件\r\n     */\r\n    protected handelEventShare<K extends keyof T & string>(event: IEvent<T[K]>)\r\n    {\r\n        if (!event.share || event.isStopShare || event.isStop || event.isStopTransmit) return;\r\n\r\n        const eventTarget = EventEmitter.emitterTargetMap.get(this);\r\n        if (typeof eventTarget?.getShareTargets === 'function')\r\n        {\r\n            const bubbleTargets = eventTarget.getShareTargets();\r\n            bubbleTargets?.forEach((v) =>\r\n            {\r\n                if (v === undefined || event.targets.indexOf(v) !== -1) return;\r\n\r\n                // 处理事件\r\n                const eventEmitter = EventEmitter.getOrCreateEventEmitter(v);\r\n                eventEmitter.handleEvent(event);\r\n                // 继续分享事件\r\n                eventEmitter.handelEventShare(event);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 向上级报告事件\r\n     *\r\n     * @param event 事件\r\n     */\r\n    protected handelEventBubbles<K extends keyof T & string>(event: IEvent<T[K]>)\r\n    {\r\n        if (!event.bubbles || event.isStopBubbles || event.isStop || event.isStopTransmit) return;\r\n\r\n        const eventTarget = EventEmitter.emitterTargetMap.get(this);\r\n        let bubbleTargets: IEventTarget[] = [];\r\n        if (typeof eventTarget?.getBubbleTargets === 'function')\r\n        {\r\n            bubbleTargets = eventTarget.getBubbleTargets();\r\n        }\r\n        else if (eventTarget['parent'])\r\n        {\r\n            bubbleTargets = [eventTarget['parent']];\r\n        }\r\n        bubbleTargets?.forEach((v) =>\r\n        {\r\n            if (v === undefined || event.targets.indexOf(v) !== -1) return;\r\n\r\n            // 处理事件\r\n            const eventEmitter = EventEmitter.getOrCreateEventEmitter(v);\r\n            eventEmitter.handleEvent(event);\r\n            // 向平级分享事件\r\n            eventEmitter.handelEventShare(event);\r\n            // 向上级报告事件\r\n            eventEmitter.handelEventBubbles(event);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 向下级广播事件\r\n     *\r\n     * @param event 事件\r\n     */\r\n    protected handelEventBroadcast<K extends keyof T & string>(event: IEvent<T[K]>)\r\n    {\r\n        if (!event.broadcast || event.isStopBroadcast || event.isStop || event.isStopTransmit) return;\r\n\r\n        const eventTarget = EventEmitter.emitterTargetMap.get(this);\r\n        let broadcastTargets: IEventTarget[] = [];\r\n        if (typeof eventTarget?.getBroadcastTargets === 'function')\r\n        {\r\n            broadcastTargets = eventTarget.getBroadcastTargets();\r\n        }\r\n        else if (eventTarget['children'] && Array.isArray(eventTarget['children']))\r\n        {\r\n            broadcastTargets = eventTarget['children'];\r\n        }\r\n        broadcastTargets?.forEach((v) =>\r\n        {\r\n            if (v === undefined || event.targets.indexOf(v) !== -1) return;\r\n\r\n            // 处理事件\r\n            const eventEmitter = EventEmitter.getOrCreateEventEmitter(v);\r\n            eventEmitter.handleEvent(event);\r\n            // 向平级分享事件\r\n            eventEmitter.handelEventShare(event);\r\n            // 继续向下级广播事件\r\n            eventEmitter.handelEventBroadcast(event);\r\n        });\r\n    }\r\n}\r\n\r\ninterface ObjectListener\r\n{\r\n    [type: string]: IEventListener[];\r\n    __anyEventType__: IEventListener[];\r\n}\r\n","import { EventEmitter } from './EventEmitter';\r\nimport { IEvent } from './IEvent';\r\n\r\n/**\r\n * 任意事件发射器。\r\n *\r\n * 可以为任何对象甚至基础类型发射事件。\r\n *\r\n * 可针对（除undefined、null、Symbol外）的任意对象（0, 1, true, false, \"1\", {}）发射事件\r\n */\r\nexport class AnyEmitter<O = any, T = any>\r\n{\r\n    /**\r\n     * Return an array listing the events for which the emitter has registered\r\n     * listeners.\r\n     */\r\n    eventNames(obj: O)\r\n    {\r\n        console.assert(obj !== undefined && obj !== null, `被监听对象无法为undefined或者null！`);\r\n        const names = EventEmitter.getEventEmitter(obj)?.eventNames() || [];\r\n\r\n        return names;\r\n    }\r\n\r\n    /**\r\n     * Return the number of listeners listening to a given event.\r\n     */\r\n    listenerCount<K extends keyof T & string>(obj: O, type: K)\r\n    {\r\n        console.assert(obj !== undefined && obj !== null, `被监听对象无法为undefined或者null！`);\r\n        const count = EventEmitter.getEventEmitter(obj)?.listenerCount(type) || 0;\r\n\r\n        return count;\r\n    }\r\n\r\n    /**\r\n     * 监听一次事件后将会被移除\r\n     * @param type\t\t\t\t\t\t事件的类型。\r\n     * @param listener\t\t\t\t\t处理事件的监听器函数。\r\n     * @param thisObject                listener函数作用域\r\n     * @param priority\t\t\t\t\t事件监听器的优先级。数字越大，优先级越高。默认为0。\r\n     */\r\n    once<K extends keyof T & string>(obj: O, type: K, listener: (event: IEvent<T[K]>) => void, thisObject = null, priority = 0)\r\n    {\r\n        console.assert(obj !== undefined && obj !== null, `被监听对象无法为undefined或者null！`);\r\n        EventEmitter.getOrCreateEventEmitter(obj).once(type, listener, thisObject, priority);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 发射事件\r\n     *\r\n     * 当事件重复流向一个对象时将不会被处理。\r\n     *\r\n     * @param event                 事件对象。\r\n     * @returns                 返回事件是否被该对象处理。\r\n     */\r\n    emitEvent<K extends keyof T & string>(obj: O, event: IEvent<T[K]>)\r\n    {\r\n        console.assert(obj !== undefined && obj !== null, `被监听对象无法为undefined或者null！`);\r\n        EventEmitter.getOrCreateEventEmitter(obj).emitEvent(event);\r\n\r\n        return event;\r\n    }\r\n\r\n    /**\r\n     * 将事件调度到事件流中. 事件目标是对其调用 emitEvent() 方法的 IEvent 对象。\r\n     *\r\n     * @param type 事件的类型。类型区分大小写。\r\n     * @param data 事件携带的自定义数据。\r\n     * @param bubbles 是否向上级报告事件。默认为`false`。\r\n     * @param broadcast 是否向下级广播事件。默认为`false`。\r\n     * @param share 是否向平级分享事件。默认为`true`。\r\n     */\r\n    emit<K extends keyof T & string>(obj: O, type: K, data?: T[K], bubbles = false, broadcast = false, share = true)\r\n    {\r\n        console.assert(obj !== undefined && obj !== null, `被监听对象无法为undefined或者null！`);\r\n        const event: IEvent<T[K]> = EventEmitter.getOrCreateEventEmitter(obj).emit(type, data, bubbles, broadcast, share);\r\n\r\n        return event;\r\n    }\r\n\r\n    /**\r\n     * 检查 被监听对象 是否为特定事件类型注册了任何监听器.\r\n     *\r\n     * @param obj                       被监听对象。\r\n     * @param type\t\t                事件的类型。\r\n     * @return \t\t\t                如果指定类型的监听器已注册，则值为 true；否则，值为 false。\r\n     */\r\n    has<K extends keyof T & string>(obj: O, type: K)\r\n    {\r\n        console.assert(obj !== undefined && obj !== null, `被监听对象无法为undefined或者null！`);\r\n        const result = EventEmitter.getEventEmitter(obj)?.has(type) || false;\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * 为监听对象新增指定类型的事件监听。\r\n     *\r\n     * @param obj                       被监听对象。\r\n     * @param type\t\t\t\t\t\t事件的类型。\r\n     * @param listener\t\t\t\t\t处理事件的监听器函数。\r\n     * @param thisObject                监听器的上下文。可选。\r\n     * @param priority\t\t\t\t\t事件监听器的优先级。数字越大，优先级越高。默认为0。\r\n     * @param once                      值为true时在监听一次事件后该监听器将被移除。默认为false。\r\n     */\r\n    on<K extends keyof T & string>(obj: O, type: K, listener: (event: IEvent<T[K]>) => any, thisObject?: any, priority = 0, once = false)\r\n    {\r\n        console.assert(obj !== undefined && obj !== null, `被监听对象无法为undefined或者null！`);\r\n        EventEmitter.getOrCreateEventEmitter(obj).on(type, listener, thisObject, priority, once);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 移除监听\r\n     *\r\n     * @param obj                       被监听对象。\r\n     * @param type\t\t\t\t\t\t事件的类型。可选。该值为空时所有被监听对象上的监听均将被移除。\r\n     * @param listener\t\t\t\t\t要删除的监听器对象。可选。该值为空时所有指定类型的监听均将被移除。\r\n     * @param thisObject                监听器的上下文。可选。\r\n     */\r\n    off<K extends keyof T & string>(obj: O, type?: K, listener?: (event: IEvent<T[K]>) => any, thisObject?: any)\r\n    {\r\n        console.assert(obj !== undefined && obj !== null, `被监听对象无法为undefined或者null！`);\r\n        EventEmitter.getEventEmitter(obj)?.off(type, listener, thisObject);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Remove all listeners, or those of the specified event.\r\n     */\r\n    offAll<K extends keyof T & string>(obj: O, type?: K)\r\n    {\r\n        console.assert(obj !== undefined && obj !== null, `被监听对象无法为undefined或者null！`);\r\n        EventEmitter.getEventEmitter(obj)?.offAll(type);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 监听对象的任意事件，该对象的任意事件都将触发该监听器的调用。\r\n     *\r\n     * @param obj                       被监听对象。\r\n     * @param listener                  处理事件的监听器函数。\r\n     * @param thisObject                监听器的上下文。可选。\r\n     * @param priority                  事件监听器的优先级。数字越大，优先级越高。默认为0。\r\n     * @param once                      值为true时在监听一次事件后该监听器将被移除。默认为false。\r\n     */\r\n    onAny<K extends keyof T & string>(obj: O, listener: (event: IEvent<T[K]>) => void, thisObject?: any, priority = 0, once = false)\r\n    {\r\n        console.assert(obj !== undefined && obj !== null, `被监听对象无法为undefined或者null！`);\r\n        EventEmitter.getOrCreateEventEmitter(obj).onAny(listener, thisObject, priority, once);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 移除监听对象的任意事件。\r\n     *\r\n     * @param obj                       被监听对象。\r\n     * @param listener                  处理事件的监听器函数。\r\n     * @param thisObject                监听器的上下文。可选。\r\n     */\r\n    offAny<K extends keyof T & string>(obj: O, listener?: (event: IEvent<T[K]>) => void, thisObject?: any)\r\n    {\r\n        console.assert(obj !== undefined && obj !== null, `被监听对象无法为undefined或者null！`);\r\n        EventEmitter.getEventEmitter(obj)?.offAny(listener, thisObject);\r\n\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * 事件\r\n */\r\nexport const anyEmitter = new AnyEmitter();\r\n","import { EventEmitter } from './EventEmitter';\r\n\r\ndeclare global\r\n{\r\n    /**\r\n     * 事件列表\r\n     */\r\n    export interface MixinsGlobalEvents\r\n    {\r\n    }\r\n}\r\n\r\n/**\r\n * 全局事件发射器。\r\n */\r\nexport const globalEmitter = new EventEmitter<MixinsGlobalEvents>();\r\n","import { AnyEmitter, anyEmitter } from './AnyEmitter';\r\n\r\n/**\r\n * 只针对Object的事件\r\n */\r\nexport const objectEmitter: AnyEmitter<any, ObjectEventType> = anyEmitter;\r\n\r\n/**\r\n * Object 事件类型\r\n */\r\nexport interface ObjectEventType\r\n{\r\n    /**\r\n     * 属性值变化\r\n     */\r\n    propertyValueChanged: { property: string, oldValue: any, newValue: any };\r\n}\r\n","/**\r\n * 方程求解\r\n *\r\n * 求解方程 f(x) == 0 在[a, b]上的解\r\n *\r\n * 参考：高等数学 第七版上册 第三章第八节 方程的近似解\r\n * 当f(x)在区间 [a, b] 上连续，且f(a) * f(b) <= 0 时，f(x)在区间 [a, b] 上至少存在一个解使得 f(x) == 0\r\n *\r\n * 当f(x)在区间 [a, b] 上连续，且 (f(a) - y) * (f(b) - y) < 0 时，f(x)在区间 [a, b] 上至少存在一个解使得 f(x) == y\r\n *\r\n * @author feng / http://feng3d.com 05/06/2018\r\n */\r\nexport class EquationSolving\r\n{\r\n    /**\r\n     * 获取数字的(正负)符号\r\n     * @param n 数字\r\n     */\r\n    private getSign(n: number)\r\n    {\r\n        return n > 0 ? '+' : '-';\r\n    }\r\n\r\n    /**\r\n     * 比较 a 与 b 是否相等\r\n     * @param a 值a\r\n     * @param b 值b\r\n     * @param precision 比较精度\r\n     */\r\n    private equalNumber(a: number, b: number, precision = 0.0000001)\r\n    {\r\n        return Math.abs(a - b) < precision;\r\n    }\r\n\r\n    /**\r\n     * 获取近似导函数 f'(x)\r\n     *\r\n     * 导函数定义\r\n     * f'(x) = (f(x + Δx) - f(x)) / Δx , Δx → 0\r\n     *\r\n     * 注：通过测试Δx不能太小，由于方程内存在x的n次方问题（比如0.000000000000001的10次方为0），过小会导致计算机计算进度不够反而导致求导不准确！\r\n     *\r\n     * 另外一种办法是还原一元多次函数，然后求出导函数。\r\n     *\r\n     * @param f 函数\r\n     * @param delta Δx，进过测试该值太小或者过大都会导致求导准确率降低（个人猜测是计算机计算精度问题导致）\r\n     */\r\n    getDerivative(f: (x) => number, delta = 0.000000001)\r\n    {\r\n        return (x) =>\r\n        {\r\n            const d = (f(x + delta) - f(x)) / delta;\r\n\r\n            return d;\r\n        };\r\n    }\r\n\r\n    /**\r\n     * 函数是否连续\r\n     * @param f 函数\r\n     */\r\n    isContinuous(_f: (x: number) => number)\r\n    {\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 方程 f(x) == 0 在 [a, b] 区间内是否有解\r\n     *\r\n     * 当f(x)在区间 [a, b] 上连续，且f(a) * f(b) <= 0 时，f(x)在区间 [a, b] 上至少存在一个解使得 f(x) == 0\r\n     *\r\n     * @param f 函数f(x)\r\n     * @param a 区间起点\r\n     * @param b 区间终点\r\n     * @param errorcallback  错误回调函数\r\n     *\r\n     * @returns 是否有解\r\n     */\r\n    hasSolution(f: (x) => number, a: number, b: number, errorcallback?: (err: Error) => void)\r\n    {\r\n        if (!this.isContinuous(f))\r\n        {\r\n            errorcallback && errorcallback(new Error(`函数 ${f} 在 [${a} ,${b}] 区间内不连续，无法为其求解！`));\r\n\r\n            return false;\r\n        }\r\n        const fa = f(a);\r\n        const fb = f(b);\r\n        if (fa * fb > 0)\r\n        {\r\n            errorcallback && errorcallback(new Error(`f(a) * f(b) 值为 ${fa * fb}，不满足 f(a) * f(b) <= 0，无法为其求解！`));\r\n\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 二分法 求解 f(x) == 0\r\n     *\r\n     * 通过区间中点作为边界来逐步缩小求解区间，最终获得解\r\n     *\r\n     * @param f 函数f(x)\r\n     * @param a 区间起点\r\n     * @param b 区间终点\r\n     * @param precision 求解精度\r\n     * @param errorcallback  错误回调函数\r\n     *\r\n     * @returns 不存在解时返回 undefined ，存在时返回 解\r\n     */\r\n    binary(f: (x: number) => number, a: number, b: number, precision = 0.0000001, errorcallback?: (err: Error) => void)\r\n    {\r\n        if (!this.hasSolution(f, a, b, errorcallback)) return undefined;\r\n\r\n        let fa = f(a);\r\n        let fb = f(b);\r\n        if (this.equalNumber(fa, 0, precision))\r\n        {\r\n            return a;\r\n        }\r\n        if (this.equalNumber(fb, 0, precision))\r\n        {\r\n            return b;\r\n        }\r\n\r\n        let x: number;\r\n        let fr: number;\r\n        do\r\n        {\r\n            x = (a + b) / 2;\r\n            fr = f(x);\r\n            if (fa * fr < 0)\r\n            {\r\n                b = x;\r\n                fb = fr;\r\n            }\r\n            else\r\n            {\r\n                a = x;\r\n                fa = fr;\r\n            }\r\n        } while (!this.equalNumber(fr, 0, precision));\r\n\r\n        return x;\r\n    }\r\n\r\n    /**\r\n     * 连线法 求解 f(x) == 0\r\n     *\r\n     * 连线法是我自己想的方法，自己取的名字，目前没有找到相应的资料（这方法大家都能够想得到。）\r\n     *\r\n     * 用曲线弧两端的连线来代替曲线弧与X轴交点作为边界来逐步缩小求解区间，最终获得解\r\n     *\r\n     * 通过 A，B两点连线与x轴交点来缩小求解区间最终获得解\r\n     *\r\n     * A，B两点直线方程 f(x) = f(a) + (f(b) - f(a)) / (b - a) * (x-a) ,求 f(x) == 0 解得 x = a - fa * (b - a)/ (fb - fa)\r\n     *\r\n     * @param f 函数f(x)\r\n     * @param a 区间起点\r\n     * @param b 区间终点\r\n     * @param precision 求解精度\r\n     * @param errorcallback  错误回调函数\r\n     *\r\n     * @returns 不存在解时返回 undefined ，存在时返回 解\r\n     */\r\n    line(f: (x: number) => number, a: number, b: number, precision = 0.0000001, errorcallback?: (err: Error) => void)\r\n    {\r\n        if (!this.hasSolution(f, a, b, errorcallback)) return undefined;\r\n\r\n        let fa = f(a);\r\n        let fb = f(b);\r\n        if (this.equalNumber(fa, 0, precision))\r\n        {\r\n            return a;\r\n        }\r\n        if (this.equalNumber(fb, 0, precision))\r\n        {\r\n            return b;\r\n        }\r\n        let x: number;\r\n        let fr: number;\r\n        do\r\n        {\r\n            //\r\n            x = a - fa * (b - a) / (fb - fa);\r\n            fr = f(x);\r\n            if (fa * fr < 0)\r\n            {\r\n                b = x;\r\n                fb = fr;\r\n            }\r\n            else\r\n            {\r\n                a = x;\r\n                fa = fr;\r\n            }\r\n        } while (!this.equalNumber(fr, 0, precision));\r\n\r\n        return x;\r\n    }\r\n\r\n    /**\r\n     * 切线法 求解 f(x) == 0\r\n     *\r\n     * 用曲线弧一端的切线来代替曲线弧，从而求出方程实根的近似解。\r\n     *\r\n     * 迭代公式： Xn+1 = Xn - f(Xn) / f'(Xn)\r\n     *\r\n     * #### 额外需求\r\n     * 1. f(x)在[a, b]上具有一阶导数 f'(x)\r\n     * 1. f'(x)在[a, b]上保持定号；意味着f(x)在[a, b]上单调\r\n     * 1. f''(x)在[a, b]上保持定号；意味着f'(x)在[a, b]上单调\r\n     *\r\n     * 切记，当无法满足这些额外要求时，该函数将找不到[a, b]上的解！！！！！！！！！！！\r\n     *\r\n     * @param f 函数f(x)\r\n     * @param f1 一阶导函数 f'(x)\r\n     * @param f2 二阶导函数 f''(x)\r\n     * @param a 区间起点\r\n     * @param b 区间终点\r\n     * @param precision 求解精度\r\n     * @param errorcallback  错误回调函数\r\n     *\r\n     * @returns 不存在解与无法使用该函数求解时返回 undefined ，否则返回 解\r\n     */\r\n    tangent(f: (x) => number, f1: (x) => number, f2: (x) => number, a: number, b: number, precision = 0.0000001, errorcallback?: (err: Error) => void)\r\n    {\r\n        if (!this.hasSolution(f, a, b, errorcallback)) return undefined;\r\n\r\n        const fa = f(a);\r\n        const fb = f(b);\r\n        if (this.equalNumber(fa, 0, precision))\r\n        {\r\n            return a;\r\n        }\r\n        if (this.equalNumber(fb, 0, precision))\r\n        {\r\n            return b;\r\n        }\r\n\r\n        const f1Sign = fb - fa; // f'(x)在[a, b]上保持的定号\r\n        const f1a = f1(a);\r\n        const f1b = f1(b);\r\n\r\n        // f'(x)在[a, b]上保持定号\r\n        if (f1a * f1Sign <= 0)\r\n        {\r\n            errorcallback && errorcallback(new Error(`[${a}, ${b}] 上存在解，由于f'(${a}) = ${f1a} 在[a, b]上没有保持定号 ${this.getSign(f1Sign)} ，无法使用切线法求解`));\r\n\r\n            return undefined;\r\n        }\r\n        if (f1b * f1Sign <= 0)\r\n        {\r\n            errorcallback && errorcallback(new Error(`[${a}, ${b}] 上存在解，由于f'(${b}) = ${f1b} 在[a, b]上没有保持定号 ${this.getSign(f1Sign)} ，无法使用切线法求解`));\r\n\r\n            return undefined;\r\n        }\r\n\r\n        const f2Sign = fb - fa; // f''(x)在[a, b]上保持的定号\r\n        const f2a = f2(a);\r\n        const f2b = f2(b);\r\n        // f''(x)在[a, b]上保持定号\r\n        if (f2a * f2Sign <= 0)\r\n        {\r\n            errorcallback && errorcallback(new Error(`[${a}, ${b}] 上存在解，由于f''(${a}) = ${f2a} 在[a, b]上没有保持定号 ${this.getSign(f2Sign)} ，无法使用切线法求解`));\r\n\r\n            return undefined;\r\n        }\r\n        if (f2b * f2Sign <= 0)\r\n        {\r\n            errorcallback && errorcallback(new Error(`[${a}, ${b}] 上存在解，由于f''(${b}) = ${f2b} 在[a, b]上没有保持定号 ${this.getSign(f2Sign)} ，无法使用切线法求解`));\r\n\r\n            return undefined;\r\n        }\r\n\r\n        let x: number;\r\n        if (f1Sign > 0)\r\n        {\r\n            if (f2Sign > 0)\r\n            { x = b; }\r\n            else\r\n            { x = a; }\r\n        }\r\n        else if (f2Sign > 0)\r\n        {\r\n            x = a;\r\n        }\r\n        else\r\n        {\r\n            x = b;\r\n        }\r\n\r\n        let fx: number;\r\n        do\r\n        {\r\n            fx = f(x);\r\n            const f1x = f1(x);\r\n            const f2x = f2(x);\r\n            // f'(x)在[a, b]上保持定号\r\n            if (f1x * f1Sign <= 0)\r\n            {\r\n                errorcallback && errorcallback(new Error(`[${a}, ${b}] 上存在解，由于f'(${x}) = ${f1x} 在[a, b]上没有保持定号 ${this.getSign(f1Sign)} ，无法使用切线法求解`));\r\n\r\n                return undefined;\r\n            }\r\n            // f''(x)在[a, b]上保持定号\r\n            if (f2x * f2Sign <= 0)\r\n            {\r\n                errorcallback && errorcallback(new Error(`[${a}, ${b}] 上存在解，由于f''(${x}) = ${f2x} 在[a, b]上没有保持定号 ${this.getSign(f2Sign)} ，无法使用切线法求解`));\r\n\r\n                return undefined;\r\n            }\r\n            // 迭代 Xn+1 = Xn - f(Xn) / f'(Xn)\r\n            x = x - fx / f1x;\r\n        } while (!this.equalNumber(fx, 0, precision));\r\n\r\n        return x;\r\n    }\r\n\r\n    /**\r\n     * 割线法（弦截法） 求解 f(x) == 0\r\n     *\r\n     * 使用 (f(Xn) - f(Xn-1)) / (Xn - Xn-1) 代替切线法迭代公式 Xn+1 = Xn - f(Xn) / f'(Xn) 中的 f'(x)\r\n     *\r\n     * 迭代公式：Xn+1 = Xn - f(Xn) * (Xn - Xn-1) / (f(Xn) - f(Xn-1));\r\n     *\r\n     * 用过点(Xn-1,f(Xn-1))和点(Xn,f(Xn))的割线来近似代替(Xn,f(Xn))处的切线，将这条割线与X轴交点的横坐标作为新的近似解。\r\n     *\r\n     * #### 额外需求\r\n     * 1. f(x)在[a, b]上具有一阶导数 f'(x)\r\n     * 1. f'(x)在[a, b]上保持定号；意味着f(x)在[a, b]上单调\r\n     * 1. f''(x)在[a, b]上保持定号；意味着f'(x)在[a, b]上单调\r\n     *\r\n     * 切记，当无法满足这些额外要求时，该函数将找不到[a, b]上的解！！！！！！！！！！！\r\n     *\r\n     * @param f 函数f(x)\r\n     * @param a 区间起点\r\n     * @param b 区间终点\r\n     * @param precision 求解精度\r\n     * @param errorcallback  错误回调函数\r\n     *\r\n     * @returns 不存在解与无法使用该函数求解时返回 undefined ，否则返回 解\r\n     */\r\n    secant(f: (x) => number, a: number, b: number, precision = 0.0000001, errorcallback?: (err: Error) => void)\r\n    {\r\n        if (!this.hasSolution(f, a, b, errorcallback)) return undefined;\r\n\r\n        const fa = f(a);\r\n        const fb = f(b);\r\n        if (this.equalNumber(fa, 0, precision))\r\n        {\r\n            return a;\r\n        }\r\n        if (this.equalNumber(fb, 0, precision))\r\n        {\r\n            return b;\r\n        }\r\n\r\n        // 此处创建近似导函数以及二次导函数，其实割线法使用在计算f'(x)困难时的，但是 getDerivative 方法解决了这个困难。。。。\r\n        const f1 = this.getDerivative(f, precision);\r\n        const f2 = this.getDerivative(f1, precision);\r\n\r\n        const f1Sign = fb - fa; // f'(x)在[a, b]上保持的定号\r\n        //\r\n        const f1a = f1(a);\r\n        const f1b = f1(b);\r\n\r\n        // f'(x)在[a, b]上保持定号\r\n        if (f1a * f1Sign <= 0)\r\n        {\r\n            errorcallback && errorcallback(new Error(`[${a}, ${b}] 上存在解，由于f'(${a}) = ${f1a} 在[a, b]上没有保持定号 ${this.getSign(f1Sign)} ，无法使用切线法求解`));\r\n\r\n            return undefined;\r\n        }\r\n        if (f1b * f1Sign <= 0)\r\n        {\r\n            errorcallback && errorcallback(new Error(`[${a}, ${b}] 上存在解，由于f'(${b}) = ${f1b} 在[a, b]上没有保持定号 ${this.getSign(f1Sign)} ，无法使用切线法求解`));\r\n\r\n            return undefined;\r\n        }\r\n\r\n        const f2Sign = fb - fa; // f''(x)在[a, b]上保持的定号\r\n        const f2a = f2(a);\r\n        const f2b = f2(b);\r\n        // f''(x)在[a, b]上保持定号\r\n        if (f2a * f2Sign <= 0)\r\n        {\r\n            errorcallback && errorcallback(new Error(`[${a}, ${b}] 上存在解，由于f''(${a}) = ${f2a} 在[a, b]上没有保持定号 ${this.getSign(f2Sign)} ，无法使用切线法求解`));\r\n\r\n            return undefined;\r\n        }\r\n        if (f2b * f2Sign <= 0)\r\n        {\r\n            errorcallback && errorcallback(new Error(`[${a}, ${b}] 上存在解，由于f''(${b}) = ${f2b} 在[a, b]上没有保持定号 ${this.getSign(f2Sign)} ，无法使用切线法求解`));\r\n\r\n            return undefined;\r\n        }\r\n\r\n        let x: number;\r\n        if (f1Sign > 0)\r\n        {\r\n            if (f2Sign > 0)\r\n            { x = b; }\r\n            else\r\n            { x = a; }\r\n        }\r\n        else if (f2Sign > 0)\r\n        {\r\n            x = a;\r\n        }\r\n        else\r\n        {\r\n            x = b;\r\n        }\r\n\r\n        // Xn-1\r\n        let xn1 = x;\r\n        let fxn1 = f(xn1);\r\n        // Xn\r\n        let xn = xn1 - precision * f2Sign / Math.abs(f2Sign);\r\n        let fxn = f(xn);\r\n        //\r\n        if (fxn * fxn1 < 0)\r\n        {\r\n            return xn;\r\n        }\r\n        // Xn+1\r\n        let xn$1: number;\r\n        do\r\n        {\r\n            const f1xn = f1(xn);\r\n            // f'(x)在[a, b]上保持定号\r\n            if (f1xn * f1Sign <= 0)\r\n            {\r\n                errorcallback && errorcallback(new Error(`[${a}, ${b}] 上存在解，由于f'(${xn}) = ${f1xn} 在[a, b]上没有保持定号 ${this.getSign(f1Sign)} ，无法使用切线法求解`));\r\n\r\n                return undefined;\r\n            }\r\n            const f2xn = f2(xn);\r\n            // f''(x)在[a, b]上保持定号\r\n            if (f2xn * f2Sign <= 0)\r\n            {\r\n                errorcallback && errorcallback(new Error(`[${a}, ${b}] 上存在解，由于f''(${xn}) = ${f2xn} 在[a, b]上没有保持定号 ${this.getSign(f2Sign)} ，无法使用切线法求解`));\r\n\r\n                return undefined;\r\n            }\r\n            // 迭代 Xn+1 = Xn - f(Xn) * (Xn - Xn-1) / (f(Xn) - f(Xn-1));\r\n            xn$1 = xn - fxn * (xn - xn1) / (fxn - fxn1);\r\n            //\r\n            xn1 = xn;\r\n            fxn1 = fxn;\r\n            xn = xn$1;\r\n            fxn = f(xn);\r\n        } while (!this.equalNumber(fxn, 0, precision));\r\n\r\n        return xn;\r\n    }\r\n}\r\n\r\n/**\r\n * 方程求解\r\n */\r\nexport const equationSolving = new EquationSolving();\r\n\r\n","import { equationSolving } from './EquationSolving';\r\n\r\n/**\r\n * Bézier曲线\r\n * @see https://en.wikipedia.org/wiki/B%C3%A9zier_curve\r\n *\r\n * @author feng / http://feng3d.com 03/06/2018\r\n */\r\nexport class Bezier\r\n{\r\n    /**\r\n     * 线性Bézier曲线\r\n     * 给定不同的点P0和P1，线性Bézier曲线就是这两个点之间的直线。曲线由下式给出\r\n     * ```\r\n     * B(t) = p0 + t * (p1 - p0) = (1 - t) * p0 + t * p1 , 0 <= t && t <= 1\r\n     * ```\r\n     * 相当于线性插值\r\n     *\r\n     * @param t 插值度\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     */\r\n    linear(t: number, p0: number, p1: number)\r\n    {\r\n        return p0 + t * (p1 - p0);\r\n        // return (1 - t) * p0 + t * p1;\r\n    }\r\n\r\n    /**\r\n     * 线性Bézier曲线关于t的导数\r\n     * @param t 插值度\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     */\r\n    linearDerivative(t: number, p0: number, p1: number)\r\n    {\r\n        return p1 - p0;\r\n    }\r\n\r\n    /**\r\n     * 线性Bézier曲线关于t的二阶导数\r\n     * @param _t 插值度\r\n     * @param _p0 点0\r\n     * @param _p1 点1\r\n     */\r\n    linearSecondDerivative(_t: number, _p0: number, _p1: number)\r\n    {\r\n        return 0;\r\n    }\r\n\r\n    /**\r\n     * 二次Bézier曲线\r\n     *\r\n     * 二次Bézier曲线是由函数B（t）跟踪的路径，给定点P0，P1和P2，\r\n     * ```\r\n     * B(t) = (1 - t) * ((1 - t) * p0 + t * p1) + t * ((1 - t) * p1 + t * p2) , 0 <= t && t <= 1\r\n     * ```\r\n     * 这可以解释为分别从P0到P1和从P1到P2的线性Bézier曲线上相应点的线性插值。重新排列前面的等式得出：\r\n     * ```\r\n     * B(t) = (1 - t) * (1 - t) * p0 + 2 * (1 - t) * t * p1 + t * t * p2 , 0 <= t && t <= 1\r\n     * ```\r\n     * Bézier曲线关于t的导数是\r\n     * ```\r\n     * B'(t) = 2 * (1 - t) * (p1 - p0) + 2 * t * (p2 - p1)\r\n     * ```\r\n     * 从中可以得出结论：在P0和P2处曲线的切线在P 1处相交。随着t从0增加到1，曲线沿P1的方向从P0偏离，然后从P1的方向弯曲到P2。\r\n     *\r\n     * Bézier曲线关于t的二阶导数是\r\n     * ```\r\n     * B''(t) = 2 * (p2 - 2 * p1 + p0)\r\n     * ```\r\n     *\r\n     * @param t 插值度\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     * @param p2 点2\r\n     */\r\n    quadratic(t: number, p0: number, p1: number, p2: number)\r\n    {\r\n        // return this.linear(t, this.linear(t, p0, p1), this.linear(t, p1, p2));\r\n        // return (1 - t) * ((1 - t) * p0 + t * p1) + t * ((1 - t) * p1 + t * p2);\r\n        return (1 - t) * (1 - t) * p0 + 2 * (1 - t) * t * p1 + t * t * p2;\r\n    }\r\n\r\n    /**\r\n     * 二次Bézier曲线关于t的导数\r\n     * @param t 插值度\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     * @param p2 点2\r\n     */\r\n    quadraticDerivative(t: number, p0: number, p1: number, p2: number)\r\n    {\r\n        // return 2 * this.linear(t, this.linearDerivative(t, p0, p1), this.linearDerivative(t, p1, p2));\r\n        return 2 * (1 - t) * (p1 - p0) + 2 * t * (p2 - p1);\r\n    }\r\n\r\n    /**\r\n     * 二次Bézier曲线关于t的二阶导数\r\n     * @param t 插值度\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     * @param p2 点2\r\n     */\r\n    quadraticSecondDerivative(t: number, p0: number, p1: number, p2: number)\r\n    {\r\n        // return 1 * 2 * this.linearDerivative(t, p1 - p0, p2 - p1)\r\n        // return 1 * 2 * ((p2 - p1) - (p1 - p0));\r\n        return 2 * (p2 - 2 * p1 + p0);\r\n    }\r\n\r\n    /**\r\n     * 立方Bézier曲线\r\n     *\r\n     * 平面中或高维空间中（其实一维也是成立的，这里就是使用一维计算）的四个点P0，P1，P2和P3定义了三次Bézier曲线。\r\n     * 曲线开始于P0朝向P1并且从P2的方向到达P3。通常不会通过P1或P2; 这些点只是为了提供方向信息。\r\n     * P1和P2之间的距离在转向P2之前确定曲线向P1移动的“多远”和“多快” 。\r\n     *\r\n     * 对于由点Pi，Pj和Pk定义的二次Bézier曲线，可以将Bpipjpk(t)写成三次Bézier曲线，它可以定义为两条二次Bézier曲线的仿射组合：\r\n     * ```\r\n     * B(t) = (1 - t) * Bp0p1p2(t) + t * Bp1p2p3(t) , 0 <= t && t <= 1\r\n     * ```\r\n     * 曲线的显式形式是：\r\n     * ```\r\n     * B(t) = (1 - t) * (1 - t) * (1 - t) * p0 + 3 * (1 - t) * (1 - t) * t * p1 + 3 * (1 - t) * t * t * p2 + t * t * t * p3 , 0 <= t && t <= 1\r\n     * ```\r\n     * 对于P1和P2的一些选择，曲线可以相交，或者包含尖点。\r\n     *\r\n     * 三次Bézier曲线相对于t的导数是\r\n     * ```\r\n     * B'(t) = 3 * (1 - t) * (1 - t) * (p1 - p0) + 6 * (1 - t) * t * (p2 - p1) + 3 * t * t * (p3 - p2);\r\n     * ```\r\n     * 三次Bézier曲线关于t的二阶导数是\r\n     * ```\r\n     * 6 * (1 - t) * (p2 - 2 * p1 + p0) + 6 * t * (p3 - 2 * p2 + p1);\r\n     * ```\r\n     *\r\n     * @param t 插值度\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     * @param p2 点2\r\n     * @param p3 点3\r\n     */\r\n    cubic(t: number, p0: number, p1: number, p2: number, p3: number)\r\n    {\r\n        // return this.linear(t, this.quadratic(t, p0, p1, p2), this.quadratic(t, p1, p2, p3));\r\n        return (1 - t) * (1 - t) * (1 - t) * p0 + 3 * (1 - t) * (1 - t) * t * p1 + 3 * (1 - t) * t * t * p2 + t * t * t * p3;\r\n    }\r\n\r\n    /**\r\n     * 三次Bézier曲线关于t的导数\r\n     * @param t 插值度\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     * @param p2 点2\r\n     * @param p3 点3\r\n     */\r\n    cubicDerivative(t: number, p0: number, p1: number, p2: number, p3: number)\r\n    {\r\n        // return 3 * this.linear(t, this.quadraticDerivative(t, p0, p1, p2), this.quadraticDerivative(t, p1, p2, p3));\r\n        return 3 * (1 - t) * (1 - t) * (p1 - p0) + 6 * (1 - t) * t * (p2 - p1) + 3 * t * t * (p3 - p2);\r\n    }\r\n\r\n    /**\r\n     * 三次Bézier曲线关于t的二阶导数\r\n     * @param t 插值度\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     * @param p2 点2\r\n     */\r\n    cubicSecondDerivative(t: number, p0: number, p1: number, p2: number, p3: number)\r\n    {\r\n        // return 3 * this.linear(t, this.quadraticSecondDerivative(t, p0, p1, p2), this.quadraticSecondDerivative(t, p1, p2, p3));\r\n        return 6 * (1 - t) * (p2 - 2 * p1 + p0) + 6 * t * (p3 - 2 * p2 + p1);\r\n    }\r\n\r\n    /**\r\n     * n次Bézier曲线\r\n     *\r\n     * 一般定义\r\n     *\r\n     * Bézier曲线可以定义为任意度n。\r\n     *\r\n     * @param t 插值度\r\n     * @param ps 点列表 ps.length == n+1\r\n     * @param processs 收集中间过程数据，可用作Bézier曲线动画数据\r\n     */\r\n    bn(t: number, ps: number[], processs: number[][] = null)\r\n    {\r\n        ps = ps.concat();\r\n        if (processs)\r\n        {\r\n            processs.push(ps.concat());\r\n        }\r\n        // n次Bézier递推\r\n        for (let i = ps.length - 1; i > 0; i--)\r\n        {\r\n            for (let j = 0; j < i; j++)\r\n            {\r\n                ps[j] = (1 - t) * ps[j] + t * ps[j + 1];\r\n            }\r\n            if (processs)\r\n            {\r\n                ps.length = ps.length - 1;\r\n                processs.push(ps.concat());\r\n            }\r\n        }\r\n\r\n        return ps[0];\r\n    }\r\n\r\n    /**\r\n     * n次Bézier曲线关于t的导数\r\n     *\r\n     * 一般定义\r\n     *\r\n     * Bézier曲线可以定义为任意度n。\r\n     *\r\n     * @param t 插值度\r\n     * @param ps 点列表 ps.length == n+1\r\n     */\r\n    bnDerivative(t: number, ps: number[])\r\n    {\r\n        if (ps.length < 2)\r\n        {\r\n            return 0;\r\n        }\r\n        ps = ps.concat();\r\n        // 进行\r\n        for (let i = 0, n = ps.length - 1; i < n; i++)\r\n        {\r\n            ps[i] = ps[i + 1] - ps[i];\r\n        }\r\n        //\r\n        ps.length = ps.length - 1;\r\n        const v = ps.length * this.bn(t, ps);\r\n\r\n        return v;\r\n    }\r\n\r\n    /**\r\n     * n次Bézier曲线关于t的二阶导数\r\n     *\r\n     * 一般定义\r\n     *\r\n     * Bézier曲线可以定义为任意度n。\r\n     *\r\n     * @param t 插值度\r\n     * @param ps 点列表 ps.length == n+1\r\n     */\r\n    bnSecondDerivative(t: number, ps: number[])\r\n    {\r\n        if (ps.length < 3)\r\n        {\r\n            return 0;\r\n        }\r\n        ps = ps.concat();\r\n        // 进行\r\n        for (let i = 0, n = ps.length - 1; i < n; i++)\r\n        {\r\n            ps[i] = ps[i + 1] - ps[i];\r\n        }\r\n        //\r\n        ps.length = ps.length - 1;\r\n        const v = ps.length * this.bnDerivative(t, ps);\r\n\r\n        return v;\r\n    }\r\n\r\n    /**\r\n     * n次Bézier曲线关于t的dn阶导数\r\n     *\r\n     * Bézier曲线可以定义为任意度n。\r\n     *\r\n     * @param t 插值度\r\n     * @param dn 求导次数\r\n     * @param ps 点列表     ps.length == n+1\r\n     */\r\n    bnND(t: number, dn: number, ps: number[])\r\n    {\r\n        if (ps.length < dn + 1)\r\n        {\r\n            return 0;\r\n        }\r\n        let factorial = 1;\r\n        ps = ps.concat();\r\n        for (let j = 0; j < dn; j++)\r\n        {\r\n            // 进行\r\n            for (let i = 0, n = ps.length - 1; i < n; i++)\r\n            {\r\n                ps[i] = ps[i + 1] - ps[i];\r\n            }\r\n            //\r\n            ps.length = ps.length - 1;\r\n            factorial *= ps.length;\r\n        }\r\n        const v = factorial * this.bn(t, ps);\r\n\r\n        return v;\r\n    }\r\n\r\n    /**\r\n     * 获取曲线在指定插值度上的值\r\n     * @param t 插值度\r\n     * @param ps 点列表\r\n     */\r\n    getValue(t: number, ps: number[]): number\r\n    {\r\n        if (ps.length === 2)\r\n        {\r\n            return this.linear(t, ps[0], ps[1]);\r\n        }\r\n        if (ps.length === 3)\r\n        {\r\n            return this.quadratic(t, ps[0], ps[1], ps[2]);\r\n        }\r\n        if (ps.length === 4)\r\n        {\r\n            return this.cubic(t, ps[0], ps[1], ps[2], ps[3]);\r\n        }\r\n\r\n        return this.bn(t, ps);\r\n        // var t1 = 1 - t;\r\n        // return t1 * t1 * t1 * ps[0] + 3 * t1 * t1 * t * ps[1] + 3 * t1 * t * t * ps[2] + t * t * t * ps[3];\r\n    }\r\n\r\n    /**\r\n     * 获取曲线在指定插值度上的导数(斜率)\r\n     * @param t 插值度\r\n     * @param ps 点列表\r\n     */\r\n    getDerivative(t: number, ps: number[]): number\r\n    {\r\n        if (ps.length === 2)\r\n        {\r\n            return this.linearDerivative(t, ps[0], ps[1]);\r\n        }\r\n        if (ps.length === 3)\r\n        {\r\n            return this.quadraticDerivative(t, ps[0], ps[1], ps[2]);\r\n        }\r\n        if (ps.length === 4)\r\n        {\r\n            return this.cubicDerivative(t, ps[0], ps[1], ps[2], ps[3]);\r\n        }\r\n\r\n        return this.bnDerivative(t, ps);\r\n        // return 3 * (1 - t) * (1 - t) * (ps[1] - ps[0]) + 6 * (1 - t) * t * (ps[2] - ps[1]) + 3 * t * t * (ps[3] - ps[2]);\r\n    }\r\n\r\n    /**\r\n     * 获取曲线在指定插值度上的二阶导数\r\n     * @param t 插值度\r\n     * @param ps 点列表\r\n     */\r\n    getSecondDerivative(t: number, ps: number[]): number\r\n    {\r\n        if (ps.length === 2)\r\n        {\r\n            return this.linearSecondDerivative(t, ps[0], ps[1]);\r\n        }\r\n        if (ps.length === 3)\r\n        {\r\n            return this.quadraticSecondDerivative(t, ps[0], ps[1], ps[2]);\r\n        }\r\n        if (ps.length === 4)\r\n        {\r\n            return this.cubicSecondDerivative(t, ps[0], ps[1], ps[2], ps[3]);\r\n        }\r\n\r\n        return this.bnSecondDerivative(t, ps);\r\n        // return 3 * (1 - t) * (1 - t) * (ps[1] - ps[0]) + 6 * (1 - t) * t * (ps[2] - ps[1]) + 3 * t * t * (ps[3] - ps[2]);\r\n    }\r\n\r\n    /**\r\n     * 查找区间内极值列表\r\n     *\r\n     * @param ps 点列表\r\n     * @param numSamples 采样次数，用于分段查找极值\r\n     * @param precision  查找精度\r\n     *\r\n     * @returns 极值列表 {} {ts: 极值插值度列表,vs: 极值值列表}\r\n     */\r\n    getExtremums(ps: number[], numSamples = 10, precision = 0.0000001)\r\n    {\r\n        const samples: number[] = [];\r\n        for (let i = 0; i <= numSamples; i++)\r\n        {\r\n            samples.push(this.getDerivative(i / numSamples, ps));\r\n        }\r\n        // 查找存在解的分段\r\n        //\r\n        const resultTs: number[] = [];\r\n        const resultVs: number[] = [];\r\n        for (let i = 0, n = numSamples; i < n; i++)\r\n        {\r\n            if (samples[i] * samples[i + 1] < 0)\r\n            {\r\n                const guessT = equationSolving.line((x) => this.getDerivative(x, ps), i / numSamples, (i + 1) / numSamples, precision);\r\n                resultTs.push(guessT);\r\n                resultVs.push(this.getValue(guessT, ps));\r\n            }\r\n        }\r\n\r\n        return { ts: resultTs, vs: resultVs };\r\n    }\r\n\r\n    /**\r\n     * 获取单调区间列表\r\n     * @returns {} {ts: 区间节点插值度列表,vs: 区间节点值列表}\r\n     */\r\n    getMonotoneIntervals(ps: number[], numSamples = 10, precision = 0.0000001)\r\n    {\r\n        // 区间内的单调区间\r\n        const monotoneIntervalTs = [0, 1];\r\n        const monotoneIntervalVs = [ps[0], ps[ps.length - 1]];\r\n        // 预先计算好极值\r\n        const extremums = this.getExtremums(ps, numSamples, precision);\r\n        for (let i = 0; i < extremums.ts.length; i++)\r\n        {\r\n            // 增加单调区间\r\n            monotoneIntervalTs.splice(i + 1, 0, extremums.ts[i]);\r\n            monotoneIntervalVs.splice(i + 1, 0, extremums.vs[i]);\r\n        }\r\n\r\n        return { ts: monotoneIntervalTs, vs: monotoneIntervalVs };\r\n    }\r\n\r\n    /**\r\n     * 获取目标值所在的插值度T\r\n     *\r\n     * @param targetV 目标值\r\n     * @param ps 点列表\r\n     * @param numSamples 分段数量，用于分段查找，用于解决寻找多个解、是否无解等问题；过少的分段可能会造成找不到存在的解决，过多的分段将会造成性能很差。\r\n     * @param precision  查找精度\r\n     *\r\n     * @returns 返回解数组\r\n     */\r\n    getTFromValue(targetV: number, ps: number[], numSamples = 10, precision = 0.0000001)\r\n    {\r\n        // 获取单调区间\r\n        const monotoneIntervals = this.getMonotoneIntervals(ps, numSamples, precision);\r\n        const monotoneIntervalTs = monotoneIntervals.ts;\r\n        const monotoneIntervalVs = monotoneIntervals.vs;\r\n\r\n        // 存在解的单调区间\r\n        const results: number[] = [];\r\n        // 遍历单调区间\r\n        for (let i = 0, n = monotoneIntervalVs.length - 1; i < n; i++)\r\n        {\r\n            if ((monotoneIntervalVs[i] - targetV) * (monotoneIntervalVs[i + 1] - targetV) <= 0)\r\n            {\r\n                const fx = (x) => this.getValue(x, ps) - targetV;\r\n\r\n                // 连线法\r\n                const result = equationSolving.line(fx, monotoneIntervalTs[i], monotoneIntervalTs[i + 1], precision);\r\n                results.push(result);\r\n            }\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    /**\r\n     * 分割曲线\r\n     *\r\n     * 在曲线插值度t位置分割为两条连接起来与原曲线完全重合的曲线\r\n     *\r\n     * @param t 分割位置（插值度）\r\n     * @param ps 被分割曲线点列表\r\n     * @returns 返回两条曲线组成的数组\r\n     */\r\n    split(t: number, ps: number[])\r\n    {\r\n        // 获取曲线的动画过程\r\n        const processs: number[][] = [];\r\n        bezier.bn(t, ps, processs);\r\n\r\n        // 第一条曲线\r\n        const fps: number[] = [];\r\n        // 第二条曲线\r\n        const sps: number[] = [];\r\n        // 使用当前t值进行分割曲线\r\n        for (let i = processs.length - 1; i >= 0; i--)\r\n        {\r\n            if (i === processs.length - 1)\r\n            {\r\n                // 添加关键点\r\n                fps.push(processs[i][0]);\r\n                fps.push(processs[i][0]);\r\n            }\r\n            else\r\n            {\r\n                // 添加左右控制点\r\n                fps.unshift(processs[i][0]);\r\n                sps.push(processs[i].pop());\r\n            }\r\n        }\r\n\r\n        return [fps, sps];\r\n    }\r\n\r\n    /**\r\n     * 合并曲线\r\n     *\r\n     * 合并两条连接的曲线为一条曲线并且可以还原为分割前的曲线\r\n     *\r\n     * @param fps 第一条曲线点列表\r\n     * @param sps 第二条曲线点列表\r\n     * @param mergeType 合并方式。mergeType = 0时进行还原合并，还原拆分之前的曲线；mergeType = 1时进行拟合合并，合并后的曲线会经过两条曲线的连接点；\r\n     */\r\n    merge(fps: number[], sps: number[], mergeType = 0)\r\n    {\r\n        fps = fps.concat();\r\n        sps = sps.concat();\r\n        const processs: number[][] = [];\r\n        let t: number;\r\n        // 上条曲线\r\n        let pps: number[];\r\n        // 当前曲线\r\n        let ps: number[];\r\n        for (let i = 0, n = fps.length; i < n; i++)\r\n        {\r\n            ps = processs[i] = [];\r\n            if (i === 0)\r\n            {\r\n                processs[i][0] = fps.pop();\r\n                sps.shift();\r\n            }\r\n            else if (i === 1)\r\n            {\r\n                // 计算t值\r\n                processs[i][0] = fps.pop();\r\n                processs[i][1] = sps.shift();\r\n                t = (processs[i - 1][0] - processs[i][0]) / (processs[i][1] - processs[i][0]);\r\n            }\r\n            else\r\n            {\r\n                pps = processs[i - 1];\r\n                // 前面增加点\r\n                const nfp = fps.pop();\r\n                // 后面增加点\r\n                const nsp = sps.shift();\r\n                // 从前往后计算\r\n                const ps0: number[] = [];\r\n                ps0[0] = nfp;\r\n                for (let j = 0, n = pps.length; j < n; j++)\r\n                {\r\n                    ps0[j + 1] = ps0[j] + (pps[j] - ps0[j]) / t;\r\n                }\r\n                // 从后往前计算\r\n                const ps1: number[] = [];\r\n                ps1[pps.length] = nsp;\r\n                for (let j = pps.length - 1; j >= 0; j--)\r\n                {\r\n                    ps1[j] = ps1[j + 1] - (ps1[j + 1] - pps[j]) / (1 - t);\r\n                }\r\n                // 拟合合并,合并前后两个方向的计算\r\n                if (mergeType === 1)\r\n                {\r\n                    for (let j = 0, n = ps0.length - 1; j <= n; j++)\r\n                    {\r\n                        ps[j] = (ps0[j] * (n - j) + ps1[j] * j) / n;\r\n                    }\r\n                }\r\n                else if (mergeType === 0)\r\n                {\r\n                    // 还原合并，前半段使用从前往后计算，后半段使用从后往前计算\r\n                    for (let j = 0, n = ps0.length - 1; j <= n; j++)\r\n                    {\r\n                        if (j < n / 2)\r\n                        {\r\n                            ps[j] = ps0[j];\r\n                        }\r\n                        else if (j > n / 2)\r\n                        {\r\n                            ps[j] = ps1[j];\r\n                        }\r\n                        else\r\n                        {\r\n                            ps[j] = (ps0[j] + ps1[j]) / 2;\r\n                        }\r\n                    }\r\n                }\r\n                else\r\n                {\r\n                    throw `合并类型 mergeType ${mergeType} 错误!`;\r\n                }\r\n            }\r\n        }\r\n\r\n        return processs.pop();\r\n    }\r\n\r\n    /**\r\n     * 获取曲线样本数据\r\n     *\r\n     * 这些点可用于连线来拟合曲线。\r\n     *\r\n     * @param ps 点列表\r\n     * @param num 采样次数 ，采样点分别为[0,1/num,2/num,....,(num-1)/num,1]\r\n     */\r\n    getSamples(ps: number[], num = 100)\r\n    {\r\n        const results: number[] = [];\r\n        for (let i = 0; i <= num; i++)\r\n        {\r\n            const p = this.getValue(i / num, ps);\r\n            results.push(p);\r\n        }\r\n\r\n        return results;\r\n    }\r\n}\r\n\r\n/**\r\n * Bézier曲线\r\n */\r\nexport const bezier = new Bezier();\r\n","/**\r\n * 高次函数\r\n *\r\n * 处理N次函数定义，求值，方程求解问题\r\n *\r\n * n次函数定义\r\n * f(x) = a0 * pow(x, n) + a1 * pow(x, n - 1) +.....+ an_1 * pow(x, 1) + an\r\n *\r\n * 0次 f(x) = a0;\r\n * 1次 f(x) = a0 * x + a1;\r\n * 2次 f(x) = a0 * x * x + a1 * x + a2;\r\n * ......\r\n *\r\n * @author feng / http://feng3d.com 05/06/2018\r\n */\r\nexport class HighFunction\r\n{\r\n    private as: number[];\r\n\r\n    /**\r\n     * 构建函数\r\n     * @param as 函数系数 a0-an 数组\r\n     */\r\n    constructor(as: number[])\r\n    {\r\n        this.as = as;\r\n    }\r\n\r\n    /**\r\n     * 获取函数 f(x) 的值\r\n     * @param x x坐标\r\n     */\r\n    getValue(x: number)\r\n    {\r\n        let v = 0;\r\n        const as = this.as;\r\n        for (let i = 0, n = as.length; i < n; i++)\r\n        {\r\n            v = v * x + as[i];\r\n        }\r\n\r\n        return v;\r\n    }\r\n}\r\n","/**\r\n * 构建线条几何数据\r\n *\r\n * @param lineData - The graphics object containing all the necessary properties\r\n * @param geometry - Geometry where to append output\r\n *\r\n * @see pixi.js https://github.com/pixijs/pixijs/blob/dev/packages/graphics/src/utils/buildLine.ts\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/setLineDash\r\n */\r\nexport function buildLineGeometry(lineData: {\r\n    /**\r\n     * Minimal distance between points that are considered different.\r\n     * Affects line tesselation.\r\n     *\r\n     * @default 1e-4\r\n     */\r\n    epsilon?: number;\r\n\r\n    /**\r\n     * 是否首尾相连。\r\n     *\r\n     * @default false\r\n     */\r\n    close?: boolean;\r\n\r\n    /**\r\n     * The style of the line.\r\n     */\r\n    lineStyle?: LineStyle;\r\n\r\n    /**\r\n     * The collection of points.\r\n     */\r\n    points: number[];\r\n}, geometry: {\r\n    /**\r\n     * An array of points to draw, 2 numbers per point\r\n     */\r\n    points: number[];\r\n    /**\r\n     * The indices of the vertices\r\n     */\r\n    indices: number[];\r\n} = { points: [], indices: [] })\r\n{\r\n    lineData = Object.assign({}, { epsilon: 1e-4, closeStroke: false }, lineData);\r\n    lineData.lineStyle = Object.assign({}, { width: 1, alignment: 0.5, cap: 'butt', join: 'miter', miterLimit: 10, dashedLinePatternUnit: 1 }, lineData.lineStyle);\r\n    //\r\n    const dashedLineData = transformDashedLine(lineData.points, lineData.lineStyle.dashedLinePatternUnit, lineData.lineStyle.dashedLinePattern);\r\n    dashedLineData.forEach((v) =>\r\n    {\r\n        lineData.points = v;\r\n        buildSingleLineGeometry(lineData, geometry);\r\n    });\r\n\r\nreturn geometry;\r\n}\r\n\r\n/**\r\n * Builds a line to draw using the polygon method.\r\n *\r\n * @param lineData - The graphics object containing all the necessary properties\r\n * @param geometry - Geometry where to append output\r\n *\r\n * @see pixi.js https://github.com/pixijs/pixijs/blob/dev/packages/graphics/src/utils/buildLine.ts\r\n */\r\nfunction buildSingleLineGeometry(lineData: {\r\n    /**\r\n     * Minimal distance between points that are considered different.\r\n     * Affects line tesselation.\r\n     *\r\n     * @default 1e-4\r\n     */\r\n    epsilon?: number;\r\n\r\n    /**\r\n     * 是否首尾相连。\r\n     *\r\n     * @default false\r\n     */\r\n    close?: boolean;\r\n\r\n    /**\r\n     * The style of the line.\r\n     */\r\n    lineStyle?: LineStyle;\r\n\r\n    /**\r\n     * The collection of points.\r\n     */\r\n    points: number[];\r\n}, geometry: {\r\n    /**\r\n     * An array of points to draw, 2 numbers per point\r\n     */\r\n    points: number[];\r\n    /**\r\n     * The indices of the vertices\r\n     */\r\n    indices: number[];\r\n} = { points: [], indices: [] })\r\n{\r\n    let points = lineData.points;\r\n    const eps = lineData.epsilon;\r\n\r\n    if (points.length === 0)\r\n    {\r\n        return geometry;\r\n    }\r\n\r\n    const style = lineData.lineStyle;\r\n\r\n    // get first and last point.. figure out the middle!\r\n    const firstPoint = { x: points[0], y: points[1] };\r\n    const lastPoint = { x: points[points.length - 2], y: points[points.length - 1] };\r\n    const closedShape = lineData.close;\r\n    const closedPath = Math.abs(firstPoint.x - lastPoint.x) < eps\r\n        && Math.abs(firstPoint.y - lastPoint.y) < eps;\r\n\r\n    // if the first point is the last point - gonna have issues :)\r\n    if (closedShape)\r\n    {\r\n        // need to clone as we are going to slightly modify the shape..\r\n        points = points.slice();\r\n\r\n        if (closedPath)\r\n        {\r\n            points.pop();\r\n            points.pop();\r\n            lastPoint.x = points[points.length - 2];\r\n            lastPoint.y = points[points.length - 1];\r\n        }\r\n\r\n        const midPointX = (firstPoint.x + lastPoint.x) * 0.5;\r\n        const midPointY = (lastPoint.y + firstPoint.y) * 0.5;\r\n\r\n        points.unshift(midPointX, midPointY);\r\n        points.push(midPointX, midPointY);\r\n    }\r\n\r\n    const verts = geometry.points;\r\n    const length = points.length / 2;\r\n    let indexCount = points.length;\r\n    const indexStart = verts.length / 2;\r\n\r\n    // Max. inner and outer width\r\n    const width = style.width / 2;\r\n    const widthSquared = width * width;\r\n    const miterLimitSquared = style.miterLimit * style.miterLimit;\r\n\r\n    /* Line segments of interest where (x1,y1) forms the corner. */\r\n    let x0 = points[0];\r\n    let y0 = points[1];\r\n    let x1 = points[2];\r\n    let y1 = points[3];\r\n    let x2 = 0;\r\n    let y2 = 0;\r\n\r\n    /* perp[?](x|y) = the line normal with magnitude lineWidth. */\r\n    let perpx = -(y0 - y1);\r\n    let perpy = x0 - x1;\r\n    let perp1x = 0;\r\n    let perp1y = 0;\r\n\r\n    let dist = Math.sqrt((perpx * perpx) + (perpy * perpy));\r\n\r\n    perpx /= dist;\r\n    perpy /= dist;\r\n    perpx *= width;\r\n    perpy *= width;\r\n\r\n    const ratio = style.alignment;\r\n    const innerWeight = (1 - ratio) * 2;\r\n    const outerWeight = ratio * 2;\r\n\r\n    if (!closedShape)\r\n    {\r\n        if (style.cap === 'round')\r\n        {\r\n            indexCount += round(\r\n                x0 - (perpx * (innerWeight - outerWeight) * 0.5),\r\n                y0 - (perpy * (innerWeight - outerWeight) * 0.5),\r\n                x0 - (perpx * innerWeight),\r\n                y0 - (perpy * innerWeight),\r\n                x0 + (perpx * outerWeight),\r\n                y0 + (perpy * outerWeight),\r\n                verts,\r\n                true,\r\n            ) + 2;\r\n        }\r\n        else if (style.cap === 'square')\r\n        {\r\n            indexCount += square(x0, y0, perpx, perpy, innerWeight, outerWeight, true, verts);\r\n        }\r\n    }\r\n\r\n    // Push first point (below & above vertices)\r\n    verts.push(\r\n        x0 - (perpx * innerWeight),\r\n        y0 - (perpy * innerWeight));\r\n    verts.push(\r\n        x0 + (perpx * outerWeight),\r\n        y0 + (perpy * outerWeight));\r\n\r\n    for (let i = 1; i < length - 1; ++i)\r\n    {\r\n        x0 = points[(i - 1) * 2];\r\n        y0 = points[((i - 1) * 2) + 1];\r\n\r\n        x1 = points[i * 2];\r\n        y1 = points[(i * 2) + 1];\r\n\r\n        x2 = points[(i + 1) * 2];\r\n        y2 = points[((i + 1) * 2) + 1];\r\n\r\n        perpx = -(y0 - y1);\r\n        perpy = x0 - x1;\r\n\r\n        dist = Math.sqrt((perpx * perpx) + (perpy * perpy));\r\n        perpx /= dist;\r\n        perpy /= dist;\r\n        perpx *= width;\r\n        perpy *= width;\r\n\r\n        perp1x = -(y1 - y2);\r\n        perp1y = x1 - x2;\r\n\r\n        dist = Math.sqrt((perp1x * perp1x) + (perp1y * perp1y));\r\n        perp1x /= dist;\r\n        perp1y /= dist;\r\n        perp1x *= width;\r\n        perp1y *= width;\r\n\r\n        /* d[x|y](0|1) = the component displacement between points p(0,1|1,2) */\r\n        const dx0 = x1 - x0;\r\n        const dy0 = y0 - y1;\r\n        const dx1 = x1 - x2;\r\n        const dy1 = y2 - y1;\r\n\r\n        /* +ve if internal angle counterclockwise, -ve if internal angle clockwise. */\r\n        const cross = (dy0 * dx1) - (dy1 * dx0);\r\n        const clockwise = (cross < 0);\r\n\r\n        /* Going nearly straight? */\r\n        if (Math.abs(cross) < 0.1)\r\n        {\r\n            verts.push(\r\n                x1 - (perpx * innerWeight),\r\n                y1 - (perpy * innerWeight));\r\n            verts.push(\r\n                x1 + (perpx * outerWeight),\r\n                y1 + (perpy * outerWeight));\r\n\r\n            continue;\r\n        }\r\n\r\n        /* p[x|y] is the miter point. pdist is the distance between miter point and p1. */\r\n        const c1 = ((-perpx + x0) * (-perpy + y1)) - ((-perpx + x1) * (-perpy + y0));\r\n        const c2 = ((-perp1x + x2) * (-perp1y + y1)) - ((-perp1x + x1) * (-perp1y + y2));\r\n        const px = ((dx0 * c2) - (dx1 * c1)) / cross;\r\n        const py = ((dy1 * c1) - (dy0 * c2)) / cross;\r\n        const pdist = ((px - x1) * (px - x1)) + ((py - y1) * (py - y1));\r\n\r\n        /* Inner miter point */\r\n        const imx = x1 + ((px - x1) * innerWeight);\r\n        const imy = y1 + ((py - y1) * innerWeight);\r\n        /* Outer miter point */\r\n        const omx = x1 - ((px - x1) * outerWeight);\r\n        const omy = y1 - ((py - y1) * outerWeight);\r\n\r\n        /* Is the inside miter point too far away, creating a spike? */\r\n        const smallerInsideSegmentSq = Math.min((dx0 * dx0) + (dy0 * dy0), (dx1 * dx1) + (dy1 * dy1));\r\n        const insideWeight = clockwise ? innerWeight : outerWeight;\r\n        const smallerInsideDiagonalSq = smallerInsideSegmentSq + (insideWeight * insideWeight * widthSquared);\r\n        const insideMiterOk = pdist <= smallerInsideDiagonalSq;\r\n\r\n        if (insideMiterOk)\r\n        {\r\n            if (style.join === 'bevel' || pdist / widthSquared > miterLimitSquared)\r\n            {\r\n                if (clockwise) /* rotating at inner angle */\r\n                {\r\n                    verts.push(imx, imy);// inner miter point\r\n                    verts.push(x1 + (perpx * outerWeight), y1 + (perpy * outerWeight));// first segment's outer vertex\r\n                    verts.push(imx, imy);// inner miter point\r\n                    verts.push(x1 + (perp1x * outerWeight), y1 + (perp1y * outerWeight));// second segment's outer vertex\r\n                }\r\n                else /* rotating at outer angle */\r\n                {\r\n                    verts.push(x1 - (perpx * innerWeight), y1 - (perpy * innerWeight));// first segment's inner vertex\r\n                    verts.push(omx, omy);// outer miter point\r\n                    verts.push(x1 - (perp1x * innerWeight), y1 - (perp1y * innerWeight));// second segment's outer vertex\r\n                    verts.push(omx, omy);// outer miter point\r\n                }\r\n\r\n                indexCount += 2;\r\n            }\r\n            else if (style.join === 'round')\r\n            {\r\n                if (clockwise) /* arc is outside */\r\n                {\r\n                    verts.push(imx, imy);\r\n                    verts.push(x1 + (perpx * outerWeight), y1 + (perpy * outerWeight));\r\n\r\n                    indexCount += round(\r\n                        x1, y1,\r\n                        x1 + (perpx * outerWeight), y1 + (perpy * outerWeight),\r\n                        x1 + (perp1x * outerWeight), y1 + (perp1y * outerWeight),\r\n                        verts, true\r\n                    ) + 4;\r\n\r\n                    verts.push(imx, imy);\r\n                    verts.push(x1 + (perp1x * outerWeight), y1 + (perp1y * outerWeight));\r\n                }\r\n                else /* arc is inside */\r\n                {\r\n                    verts.push(x1 - (perpx * innerWeight), y1 - (perpy * innerWeight));\r\n                    verts.push(omx, omy);\r\n\r\n                    indexCount += round(\r\n                        x1, y1,\r\n                        x1 - (perpx * innerWeight), y1 - (perpy * innerWeight),\r\n                        x1 - (perp1x * innerWeight), y1 - (perp1y * innerWeight),\r\n                        verts, false\r\n                    ) + 4;\r\n\r\n                    verts.push(x1 - (perp1x * innerWeight), y1 - (perp1y * innerWeight));\r\n                    verts.push(omx, omy);\r\n                }\r\n            }\r\n            else\r\n            {\r\n                verts.push(imx, imy);\r\n                verts.push(omx, omy);\r\n            }\r\n        }\r\n        else // inside miter is NOT ok\r\n        {\r\n            verts.push(x1 - (perpx * innerWeight), y1 - (perpy * innerWeight)); // first segment's inner vertex\r\n            verts.push(x1 + (perpx * outerWeight), y1 + (perpy * outerWeight)); // first segment's outer vertex\r\n            if (style.join === 'bevel' || pdist / widthSquared > miterLimitSquared)\r\n            {\r\n                // Nothing needed\r\n            }\r\n            else if (style.join === 'round')\r\n            {\r\n                if (clockwise) /* arc is outside */\r\n                {\r\n                    indexCount += round(\r\n                        x1, y1,\r\n                        x1 + (perpx * outerWeight), y1 + (perpy * outerWeight),\r\n                        x1 + (perp1x * outerWeight), y1 + (perp1y * outerWeight),\r\n                        verts, true\r\n                    ) + 2;\r\n                }\r\n                else /* arc is inside */\r\n                {\r\n                    indexCount += round(\r\n                        x1, y1,\r\n                        x1 - (perpx * innerWeight), y1 - (perpy * innerWeight),\r\n                        x1 - (perp1x * innerWeight), y1 - (perp1y * innerWeight),\r\n                        verts, false\r\n                    ) + 2;\r\n                }\r\n            }\r\n            else\r\n            {\r\n                if (clockwise)\r\n                {\r\n                    verts.push(omx, omy); // inner miter point\r\n                    verts.push(omx, omy); // inner miter point\r\n                }\r\n                else\r\n                {\r\n                    verts.push(imx, imy); // outer miter point\r\n                    verts.push(imx, imy); // outer miter point\r\n                }\r\n                indexCount += 2;\r\n            }\r\n            verts.push(x1 - (perp1x * innerWeight), y1 - (perp1y * innerWeight)); // second segment's inner vertex\r\n            verts.push(x1 + (perp1x * outerWeight), y1 + (perp1y * outerWeight)); // second segment's outer vertex\r\n            indexCount += 2;\r\n        }\r\n    }\r\n\r\n    x0 = points[(length - 2) * 2];\r\n    y0 = points[((length - 2) * 2) + 1];\r\n\r\n    x1 = points[(length - 1) * 2];\r\n    y1 = points[((length - 1) * 2) + 1];\r\n\r\n    perpx = -(y0 - y1);\r\n    perpy = x0 - x1;\r\n\r\n    dist = Math.sqrt((perpx * perpx) + (perpy * perpy));\r\n    perpx /= dist;\r\n    perpy /= dist;\r\n    perpx *= width;\r\n    perpy *= width;\r\n\r\n    verts.push(x1 - (perpx * innerWeight), y1 - (perpy * innerWeight));\r\n    verts.push(x1 + (perpx * outerWeight), y1 + (perpy * outerWeight));\r\n\r\n    if (!closedShape)\r\n    {\r\n        if (style.cap === 'round')\r\n        {\r\n            indexCount += round(\r\n                x1 - (perpx * (innerWeight - outerWeight) * 0.5),\r\n                y1 - (perpy * (innerWeight - outerWeight) * 0.5),\r\n                x1 - (perpx * innerWeight),\r\n                y1 - (perpy * innerWeight),\r\n                x1 + (perpx * outerWeight),\r\n                y1 + (perpy * outerWeight),\r\n                verts,\r\n                false\r\n            ) + 2;\r\n        }\r\n        else if (style.cap === 'square')\r\n        {\r\n            indexCount += square(x1, y1, perpx, perpy, innerWeight, outerWeight, false, verts);\r\n        }\r\n    }\r\n\r\n    const indices = geometry.indices;\r\n    const eps2 = lineData.epsilon * lineData.epsilon;\r\n\r\n    // indices.push(indexStart);\r\n    for (let i = indexStart; i < indexCount + indexStart - 2; ++i)\r\n    {\r\n        x0 = verts[(i * 2)];\r\n        y0 = verts[(i * 2) + 1];\r\n\r\n        x1 = verts[(i + 1) * 2];\r\n        y1 = verts[((i + 1) * 2) + 1];\r\n\r\n        x2 = verts[(i + 2) * 2];\r\n        y2 = verts[((i + 2) * 2) + 1];\r\n\r\n        /* Skip zero area triangles */\r\n        if (Math.abs((x0 * (y1 - y2)) + (x1 * (y2 - y0)) + (x2 * (y0 - y1))) < eps2)\r\n        {\r\n            continue;\r\n        }\r\n\r\n        indices.push(i, i + 1, i + 2);\r\n    }\r\n\r\nreturn geometry;\r\n}\r\n\r\n/**\r\n * 转换一条线条为一组线条构成的虚线条\r\n *\r\n * @param linePoints 线条顶点坐标列表\r\n * @param unit 虚线模式中单位长度，通常被设置为线条宽度\r\n * @param pattern 虚线模式\r\n * @returns 由一组线条构成的虚线条\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/setLineDash\r\n */\r\nfunction transformDashedLine(linePoints: number[], unit: number, pattern: number[] = [])\r\n{\r\n    if (!pattern || pattern.length === 0)\r\n    {\r\n        return [linePoints];\r\n    }\r\n    /**\r\n     * 当前虚线条中线条数据\r\n     */\r\n    let currentStepDashedLinePoints: number[] = [linePoints[0], linePoints[1]];\r\n    /**\r\n     * 虚线条数据\r\n     */\r\n    const dashedLinePoints: number[][] = [currentStepDashedLinePoints];\r\n    /**\r\n     * 模式索引\r\n     */\r\n    let patternIndex = 0;\r\n    /**\r\n     * 是否为填充的部分\r\n     */\r\n    let isFill = true;\r\n    /**\r\n     * 当前模式宽度\r\n     */\r\n    let currentPartternWidth = pattern[0] * unit;\r\n    /**\r\n     * 当前节点\r\n     */\r\n    let currentPoint: [number, number] = [linePoints[0], linePoints[1]];\r\n\r\n    for (let i = 2; i < linePoints.length; i += 2)\r\n    {\r\n        /**\r\n         * 线段下个节点\r\n         */\r\n        const nextPoint: [number, number] = [linePoints[i], linePoints[i + 1]];\r\n        /**\r\n         * 当前线条宽度\r\n         */\r\n        const currentSegmentWidth = Math.sqrt(\r\n            ((nextPoint[0] - currentPoint[0]) * (nextPoint[0] - currentPoint[0]))\r\n            + ((nextPoint[1] - currentPoint[1]) * (nextPoint[1] - currentPoint[1]))\r\n        );\r\n        /**\r\n         * 剩余线条宽度\r\n         */\r\n        let leftSegmentWidth = currentSegmentWidth;\r\n        while (leftSegmentWidth > 0 && currentPartternWidth > 0)\r\n        {\r\n            if (currentPartternWidth > leftSegmentWidth)\r\n            {\r\n                if (isFill)\r\n                {\r\n                    currentStepDashedLinePoints.push(nextPoint[0], nextPoint[1]);\r\n                }\r\n                currentPartternWidth = currentPartternWidth - leftSegmentWidth;\r\n                // 跳转到下个线段\r\n                leftSegmentWidth = 0;\r\n            }\r\n else if (currentPartternWidth === leftSegmentWidth)\r\n            {\r\n                if (isFill)\r\n                {\r\n                    currentStepDashedLinePoints.push(nextPoint[0], nextPoint[1]);\r\n                }\r\n                // 跳转到下个线段\r\n                leftSegmentWidth = 0;\r\n                // 跳转到下个模式\r\n                isFill = !isFill;\r\n                if (isFill)\r\n                {\r\n                    currentStepDashedLinePoints = [nextPoint[0], nextPoint[1]];\r\n                    dashedLinePoints.push(currentStepDashedLinePoints);\r\n                }\r\n                currentPartternWidth = pattern[++patternIndex % pattern.length] * unit;\r\n            }\r\n else\r\n            {\r\n                leftSegmentWidth = leftSegmentWidth - currentPartternWidth;\r\n                /**\r\n                 * 模式切割当前线段的位置\r\n                 */\r\n                const alpha = 1 - leftSegmentWidth / currentSegmentWidth;\r\n                const alphaX = currentPoint[0] + (alpha * (nextPoint[0] - currentPoint[0]));\r\n                const alphaY = currentPoint[1] + (alpha * (nextPoint[1] - currentPoint[1]));\r\n                if (isFill)\r\n                {\r\n                    currentStepDashedLinePoints.push(alphaX, alphaY);\r\n                }\r\n                // 跳转到下个模式\r\n                isFill = !isFill;\r\n                if (isFill)\r\n                {\r\n                    currentStepDashedLinePoints = [alphaX, alphaY];\r\n                    dashedLinePoints.push(currentStepDashedLinePoints);\r\n                }\r\n                currentPartternWidth = pattern[++patternIndex % pattern.length] * unit;\r\n            }\r\n        }\r\n        currentPoint = nextPoint;\r\n    }\r\n\r\nreturn dashedLinePoints;\r\n}\r\n\r\n/**\r\n * Buffers vertices to draw a square cap.\r\n *\r\n * Ignored from docs since it is not directly exposed.\r\n *\r\n * @ignore\r\n * @private\r\n * @param {number} x - X-coord of end point\r\n * @param {number} y - Y-coord of end point\r\n * @param {number} nx - X-coord of line normal pointing inside\r\n * @param {number} ny - Y-coord of line normal pointing inside\r\n * @param {Array<number>} verts - vertex buffer\r\n * @returns {}\r\n */\r\nfunction square(\r\n    x: number,\r\n    y: number,\r\n    nx: number,\r\n    ny: number,\r\n    innerWeight: number,\r\n    outerWeight: number,\r\n    clockwise: boolean, /* rotation for square (true at left end, false at right end) */\r\n    verts: Array<number>\r\n): number\r\n{\r\n    const ix = x - (nx * innerWeight);\r\n    const iy = y - (ny * innerWeight);\r\n    const ox = x + (nx * outerWeight);\r\n    const oy = y + (ny * outerWeight);\r\n\r\n    /* Rotate nx,ny for extension vector */\r\n    let exx; let\r\n        eyy;\r\n\r\n    if (clockwise)\r\n    {\r\n        exx = ny;\r\n        eyy = -nx;\r\n    }\r\n    else\r\n    {\r\n        exx = -ny;\r\n        eyy = nx;\r\n    }\r\n\r\n    /* [i|0]x,y extended at cap */\r\n    const eix = ix + exx;\r\n    const eiy = iy + eyy;\r\n    const eox = ox + exx;\r\n    const eoy = oy + eyy;\r\n\r\n    /* Square itself must be inserted clockwise*/\r\n    verts.push(eix, eiy);\r\n    verts.push(eox, eoy);\r\n\r\n    return 2;\r\n}\r\n\r\n/**\r\n * Buffers vertices to draw an arc at the line joint or cap.\r\n *\r\n * Ignored from docs since it is not directly exposed.\r\n *\r\n * @ignore\r\n * @private\r\n * @param {number} cx - X-coord of center\r\n * @param {number} cy - Y-coord of center\r\n * @param {number} sx - X-coord of arc start\r\n * @param {number} sy - Y-coord of arc start\r\n * @param {number} ex - X-coord of arc end\r\n * @param {number} ey - Y-coord of arc end\r\n * @param {Array<number>} verts - buffer of vertices\r\n * @param {boolean} clockwise - orientation of vertices\r\n * @returns {number} - no. of vertices pushed\r\n */\r\nfunction round(\r\n    cx: number,\r\n    cy: number,\r\n    sx: number,\r\n    sy: number,\r\n    ex: number,\r\n    ey: number,\r\n    verts: Array<number>,\r\n    clockwise: boolean, /* if not cap, then clockwise is turn of joint, otherwise rotation from angle0 to angle1 */\r\n): number\r\n{\r\n    const cx2p0x = sx - cx;\r\n    const cy2p0y = sy - cy;\r\n\r\n    let angle0 = Math.atan2(cx2p0x, cy2p0y);\r\n    let angle1 = Math.atan2(ex - cx, ey - cy);\r\n\r\n    if (clockwise && angle0 < angle1)\r\n    {\r\n        angle0 += Math.PI * 2;\r\n    }\r\n    else if (!clockwise && angle0 > angle1)\r\n    {\r\n        angle1 += Math.PI * 2;\r\n    }\r\n\r\n    let startAngle = angle0;\r\n    const angleDiff = angle1 - angle0;\r\n    const absAngleDiff = Math.abs(angleDiff);\r\n\r\n    /* if (absAngleDiff >= PI_LBOUND && absAngleDiff <= PI_UBOUND)\r\n    {\r\n        const r1x = cx - nxtPx;\r\n        const r1y = cy - nxtPy;\r\n\r\n        if (r1x === 0)\r\n        {\r\n            if (r1y > 0)\r\n            {\r\n                angleDiff = -angleDiff;\r\n            }\r\n        }\r\n        else if (r1x >= -GRAPHICS_CURVES.epsilon)\r\n        {\r\n            angleDiff = -angleDiff;\r\n        }\r\n    }*/\r\n\r\n    const radius = Math.sqrt((cx2p0x * cx2p0x) + (cy2p0y * cy2p0y));\r\n    const segCount = ((15 * absAngleDiff * Math.sqrt(radius) / Math.PI) >> 0) + 1;\r\n    const angleInc = angleDiff / segCount;\r\n\r\n    startAngle += angleInc;\r\n\r\n    if (clockwise)\r\n    {\r\n        verts.push(cx, cy);\r\n        verts.push(sx, sy);\r\n\r\n        for (let i = 1, angle = startAngle; i < segCount; i++, angle += angleInc)\r\n        {\r\n            verts.push(cx, cy);\r\n            verts.push(cx + ((Math.sin(angle) * radius)),\r\n                cy + ((Math.cos(angle) * radius)));\r\n        }\r\n\r\n        verts.push(cx, cy);\r\n        verts.push(ex, ey);\r\n    }\r\n    else\r\n    {\r\n        verts.push(sx, sy);\r\n        verts.push(cx, cy);\r\n\r\n        for (let i = 1, angle = startAngle; i < segCount; i++, angle += angleInc)\r\n        {\r\n            verts.push(cx + ((Math.sin(angle) * radius)),\r\n                cy + ((Math.cos(angle) * radius)));\r\n            verts.push(cx, cy);\r\n        }\r\n\r\n        verts.push(ex, ey);\r\n        verts.push(cx, cy);\r\n    }\r\n\r\n    return segCount * 2;\r\n}\r\n\r\n/**\r\n * Represents the line style for Graphics.\r\n */\r\ninterface LineStyle\r\n{\r\n    /**\r\n     * The width (thickness) of any lines drawn.\r\n     *\r\n     * @default 1\r\n     */\r\n    width?: number;\r\n\r\n    /**\r\n     * The alignment of any lines drawn (0.5 = middle, 1 = outer, 0 = inner). WebGL only.\r\n     *\r\n     * @default 0.5\r\n     */\r\n    alignment?: number;\r\n\r\n    /**\r\n     * Line cap style.\r\n     *\r\n     * 'butt': don't add any cap at line ends (leaves orthogonal edges)\r\n     *\r\n     * 'round': add semicircle at ends\r\n     *\r\n     * 'square': add square at end (like `BUTT` except more length at end)\r\n     *\r\n     * @default  'butt'\r\n     */\r\n    cap?: 'butt' | 'round' | 'square';\r\n\r\n    /**\r\n     * Line join style.\r\n     *\r\n     * 'miter': make a sharp corner where outer part of lines meet\r\n     *\r\n     * 'bevel': add a square butt at each end of line segment and fill the triangle at turn\r\n     *\r\n     * 'round': add an arc at the joint\r\n     *\r\n     * @default 'miter'\r\n     *\r\n     * @see https://graphicdesign.stackexchange.com/questions/59018/what-is-a-bevel-join-of-two-lines-exactly-illustrator\r\n     */\r\n    join?: 'miter' | 'bevel' | 'round';\r\n\r\n    /**\r\n     * Miter limit.\r\n     *\r\n     * @default 10\r\n     */\r\n    miterLimit?: number;\r\n\r\n    /**\r\n     * 虚线模式中单位长度，通常被设置为线条宽度\r\n     *\r\n     * @default 1\r\n     */\r\n    dashedLinePatternUnit?: number;\r\n\r\n    /**\r\n     * 虚线模式\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/setLineDash\r\n     */\r\n    dashedLinePattern?: number[];\r\n}\r\n","// The interface to get time information from Unity.\r\nexport class Time\r\n{\r\n    // The time this frame has started (RO). This is the time in seconds since the start of the game.\r\n    static get time(): number\r\n    {\r\n        throw `未实现`;\r\n    }\r\n\r\n    // The time this frame has started (RO). This is the time in seconds since the start of the game. Double precision version of time, please prefer to use it instead of single precision (float).\r\n    static get timeAsDouble()\r\n    {\r\n        return Time.time;\r\n    }\r\n\r\n    // The time this frame has started (RO). This is the time in seconds since the last level has been loaded.\r\n    static get timeSinceLevelLoad(): number\r\n    {\r\n        throw `未实现`;\r\n    }\r\n\r\n    // The time this frame has started (RO). This is the time in seconds since the last level has been loaded. Double precision version of timeSinceLevelLoad, please prefer to use it instead of single precision (float).\r\n    static get timeSinceLevelLoadAsDouble()\r\n    {\r\n        return Time.timeSinceLevelLoad;\r\n    }\r\n\r\n    // The time in seconds it took to complete the last frame (RO).\r\n    static get deltaTime(): number\r\n    {\r\n        throw `未实现`;\r\n    }\r\n\r\n    // The time the latest MonoBehaviour::pref::FixedUpdate has started (RO). This is the time in seconds since the start of the game.\r\n    static get fixedTime(): number\r\n    {\r\n        throw `未实现`;\r\n    }\r\n\r\n    // The time the latest MonoBehaviour::pref::FixedUpdate has started (RO). This is the time in seconds since the start of the game.\r\n    // Double precision version of unscaledTime, please prefer to use it instead of single precision (float).\r\n    static get fixedTimeAsDouble()\r\n    {\r\n        return Time.fixedTime;\r\n    }\r\n\r\n    // The cached real time (realTimeSinceStartup) at the start of this frame\r\n    static get unscaledTime(): number\r\n    {\r\n        throw `未实现`;\r\n    }\r\n\r\n    // The cached real time (realTimeSinceStartup) at the start of this frame. Double precision version of unscaledTime, please prefer to use it instead of single precision (float).\r\n    static get unscaledTimeAsDouble()\r\n    {\r\n        return Time.unscaledTime;\r\n    }\r\n\r\n    // The real time corresponding to this fixed frame\r\n    static get fixedUnscaledTime(): number\r\n    {\r\n        throw `未实现`;\r\n    }\r\n\r\n    // The real time corresponding to this fixed frame. Double precision version of unscaledTime, please prefer to use it instead of single precision (float).\r\n    static get fixedUnscaledTimeAsDouble()\r\n    {\r\n        return Time.fixedUnscaledTime;\r\n    }\r\n\r\n    // The delta time based upon the realTime\r\n    static get unscaledDeltaTime(): number\r\n    {\r\n        throw `未实现`;\r\n    }\r\n\r\n    // The delta time based upon the realTime\r\n    static get fixedUnscaledDeltaTime()\r\n    {\r\n        throw `未实现`;\r\n    }\r\n\r\n    // The interval in seconds at which physics and other fixed frame rate updates (like MonoBehaviour's MonoBehaviour::pref::FixedUpdate) are performed.\r\n    static fixedDeltaTime: number;\r\n\r\n    // The maximum time a frame can take. Physics and other fixed frame rate updates (like MonoBehaviour's MonoBehaviour::pref::FixedUpdate)\r\n    static maximumDeltaTime: number;\r\n\r\n    // A smoothed out Time.deltaTime (RO).\r\n    static get smoothDeltaTime(): number\r\n    {\r\n        throw `未实现`;\r\n    }\r\n\r\n    // The maximum time a frame can spend on particle updates. If the frame takes longer than this, then updates are split into multiple smaller updates.\r\n    static maximumParticleDeltaTime: number;\r\n\r\n    // The scale at which the time is passing. This can be used for slow motion effects.\r\n    static timeScale: number;\r\n\r\n    // The total number of frames that have passed (RO).\r\n    static get frameCount(): number\r\n    {\r\n        throw `未实现`;\r\n    }\r\n\r\n    // *undocumented*\r\n    static get renderedFrameCount(): number\r\n    {\r\n        throw `未实现`;\r\n    }\r\n\r\n    // The real time in seconds since the game started (RO).\r\n    static get realtimeSinceStartup(): number\r\n    {\r\n        throw `未实现`;\r\n    }\r\n\r\n    // The real time in seconds since the game started (RO). Double precision version of realtimeSinceStartup, please prefer to use it instead of single precision (float).\r\n    static get realtimeSinceStartupAsDouble()\r\n    {\r\n        return Time.realtimeSinceStartup;\r\n    }\r\n\r\n    // If /captureDeltaTime/ is set to a value larger than 0, time will advance by that increment.\r\n    static captureDeltaTime: number;\r\n\r\n    // /captureFramerate/ is a convenience (and backwards compatible) accessor for the reciprocal of /captureDeltaTime/ rounded to the nearest integer.\r\n    static get captureFramerate()\r\n    {\r\n        return Time.captureDeltaTime === 0.0 ? 0 : Math.round(1.0 / Time.captureDeltaTime);\r\n    }\r\n\r\n    static set captureFramerate(value)\r\n    {\r\n        Time.captureDeltaTime = value === 0 ? 0.0 : 1.0 / value;\r\n    }\r\n\r\n    // Returns true if inside a fixed time step callback such as FixedUpdate, otherwise false.\r\n    static get inFixedTimeStep(): boolean\r\n    {\r\n        throw `未实现`;\r\n    }\r\n}\r\n","import { Vector2 } from './geom/Vector2';\r\nimport { Time } from './Time';\r\n\r\nexport class Mathf\r\n{\r\n    /**\r\n     * Returns the sine of angle `f` in radians.\r\n     */\r\n    static Sin(f: number)\r\n    {\r\n        return Math.sin(f);\r\n    }\r\n\r\n    /**\r\n     * Returns the cosine of angle `f` in radians.\r\n     */\r\n    static Cos(f: number)\r\n    {\r\n        return Math.cos(f);\r\n    }\r\n\r\n    // Returns the tangent of angle /f/ in radians.\r\n    static Tan(f: number) { return Math.tan(f); }\r\n\r\n    // Returns the arc-sine of /f/ - the angle in radians whose sine is /f/.\r\n    static Asin(f: number) { return Math.asin(f); }\r\n\r\n    // Returns the arc-cosine of /f/ - the angle in radians whose cosine is /f/.\r\n    static Acos(f: number) { return Math.acos(f); }\r\n\r\n    // Returns the arc-tangent of /f/ - the angle in radians whose tangent is /f/.\r\n    static Atan(f: number) { return Math.atan(f); }\r\n\r\n    // Returns the angle in radians whose ::ref::Tan is @@y/x@@.\r\n    static Atan2(y: number, x: number) { return Math.atan2(y, x); }\r\n\r\n    // Returns square root of /f/.\r\n    static Sqrt(f: number) { return Math.sqrt(f); }\r\n\r\n    // Returns the absolute value of /f/.\r\n    static Abs(f: number) { return Math.abs(f); }\r\n\r\n    static Min(a: number, b: number): number;\r\n    // Returns the smallest of two or more values.\r\n    static Min(values: number[]): number;\r\n    static Min(...args: any[])\r\n    {\r\n        if (Array.isArray(args[0]))\r\n        {\r\n            const values = args[0];\r\n            const len = values.length;\r\n            if (len === 0)\r\n            {\r\n                return 0;\r\n            }\r\n            let m = values[0];\r\n            for (let i = 1; i < len; i++)\r\n            {\r\n                if (values[i] < m)\r\n                { m = values[i]; }\r\n            }\r\n\r\n            return m;\r\n        }\r\n        const a: number = args[0];\r\n        const b: number = args[1];\r\n\r\n        return a < b ? a : b;\r\n    }\r\n\r\n    static Max(a: number, b: number): number;\r\n    // Returns largest of two or more values.\r\n    static Max(values: number[]): number;\r\n    static Max(...args: any[])\r\n    {\r\n        if (Array.isArray(args[0]))\r\n        {\r\n            const values = args[0];\r\n            const len = values.length;\r\n            if (len === 0)\r\n            { return 0; }\r\n            let m = values[0];\r\n            for (let i = 1; i < len; i++)\r\n            {\r\n                if (values[i] > m)\r\n                { m = values[i]; }\r\n            }\r\n\r\n            return m;\r\n        }\r\n        const a: number = args[0];\r\n        const b: number = args[1];\r\n\r\n        return a > b ? a : b;\r\n    }\r\n\r\n    // Returns /f/ raised to power /p/.\r\n    static Pow(f: number, p: number) { return Math.pow(f, p); }\r\n\r\n    // Returns e raised to the specified power.\r\n    static Exp(power: number) { return Math.exp(power); }\r\n\r\n    // Returns the natural (base e) logarithm of a specified number.\r\n    static Log(f: number) { return Math.log(f); }\r\n\r\n    // Returns the base 10 logarithm of a specified number.\r\n    static Log10(f: number) { return Math.log10(f); }\r\n\r\n    // Returns the smallest integer greater to or equal to /f/.\r\n    static Ceil(f: number) { return Math.ceil(f); }\r\n\r\n    // Returns the largest integer smaller to or equal to /f/.\r\n    static Floor(f: number) { return Math.floor(f); }\r\n\r\n    // Returns /f/ rounded to the nearest integer.\r\n    static Round(f: number) { return Math.round(f); }\r\n\r\n    // Returns the smallest integer greater to or equal to /f/.\r\n    static CeilToInt(f: number) { return Math.ceil(f); }\r\n\r\n    // Returns the largest integer smaller to or equal to /f/.\r\n    static FloorToInt(f: number) { return Math.floor(f); }\r\n\r\n    // Returns /f/ rounded to the nearest integer.\r\n    static RoundToInt(f: number) { return Math.round(f); }\r\n\r\n    // Returns the sign of /f/.\r\n    static Sign(f: number) { return f >= 0 ? 1 : -1; }\r\n\r\n    // The infamous ''3.14159265358979...'' value (RO).\r\n    static readonly PI = Math.PI;\r\n\r\n    // A representation of positive infinity (RO).\r\n    static readonly Infinity = Infinity;\r\n\r\n    // A representation of negative infinity (RO).\r\n    static readonly NegativeInfinity = -Infinity;\r\n\r\n    // Degrees-to-radians conversion constant (RO).\r\n    static readonly Deg2Rad = Mathf.PI * 2 / 360;\r\n\r\n    // Radians-to-degrees conversion constant (RO).\r\n    static readonly Rad2Deg = 1 / Mathf.Deg2Rad;\r\n\r\n    // We cannot round to more decimals than 15 according to docs for System.Math.Round.\r\n    private static readonly kMaxDecimals = 15;\r\n\r\n    // A tiny floating point value (RO).\r\n    static readonly Epsilon = 1.401298e-45;\r\n\r\n    // Clamps a value between a minimum float and maximum float value.\r\n    static Clamp(value: number, min: number, max: number)\r\n    {\r\n        if (value < min)\r\n        { value = min; }\r\n        else if (value > max)\r\n        { value = max; }\r\n\r\n        return value;\r\n    }\r\n\r\n    // Clamps value between 0 and 1 and returns value\r\n    static Clamp01(value: number)\r\n    {\r\n        if (value < 0)\r\n        { return 0; }\r\n        else if (value > 1)\r\n        { return 1; }\r\n\r\n        return value;\r\n    }\r\n\r\n    // Interpolates between /a/ and /b/ by /t/. /t/ is clamped between 0 and 1.\r\n    static Lerp(a: number, b: number, t: number)\r\n    {\r\n        return a + (b - a) * Mathf.Clamp01(t);\r\n    }\r\n\r\n    // Interpolates between /a/ and /b/ by /t/ without clamping the interpolant.\r\n    static LerpUnclamped(a: number, b: number, t: number)\r\n    {\r\n        return a + (b - a) * t;\r\n    }\r\n\r\n    // Same as ::ref::Lerp but makes sure the values interpolate correctly when they wrap around 360 degrees.\r\n    static LerpAngle(a: number, b: number, t: number)\r\n    {\r\n        let delta = Mathf.Repeat((b - a), 360);\r\n        if (delta > 180)\r\n        { delta -= 360; }\r\n\r\n        return a + delta * Mathf.Clamp01(t);\r\n    }\r\n\r\n    // Moves a value /current/ towards /target/.\r\n    static MoveTowards(current: number, target: number, maxDelta: number)\r\n    {\r\n        if (Mathf.Abs(target - current) <= maxDelta)\r\n        { return target; }\r\n\r\n        return current + Mathf.Sign(target - current) * maxDelta;\r\n    }\r\n\r\n    // Same as ::ref::MoveTowards but makes sure the values interpolate correctly when they wrap around 360 degrees.\r\n    static MoveTowardsAngle(current: number, target: number, maxDelta: number)\r\n    {\r\n        const deltaAngle = Mathf.DeltaAngle(current, target);\r\n        if (-maxDelta < deltaAngle && deltaAngle < maxDelta)\r\n        { return target; }\r\n        target = current + deltaAngle;\r\n\r\n        return Mathf.MoveTowards(current, target, maxDelta);\r\n    }\r\n\r\n    // Interpolates between /min/ and /max/ with smoothing at the limits.\r\n    static SmoothStep(from: number, to: number, t: number)\r\n    {\r\n        t = Mathf.Clamp01(t);\r\n        t = -2.0 * t * t * t + 3.0 * t * t;\r\n\r\n        return to * t + from * (1 - t);\r\n    }\r\n\r\n    //* undocumented\r\n    static Gamma(value: number, absmax: number, gamma: number)\r\n    {\r\n        const negative = value < 0;\r\n        const absval = Mathf.Abs(value);\r\n        if (absval > absmax)\r\n        { return negative ? -absval : absval; }\r\n\r\n        const result = Mathf.Pow(absval / absmax, gamma) * absmax;\r\n\r\n        return negative ? -result : result;\r\n    }\r\n\r\n    // Compares two floating point values if they are similar.\r\n    static Approximately(a: number, b: number)\r\n    {\r\n        // If a or b is zero, compare that the other is less or equal to epsilon.\r\n        // If neither a or b are 0, then find an epsilon that is good for\r\n        // comparing numbers at the maximum magnitude of a and b.\r\n        // Floating points have about 7 significant digits, so\r\n        // 1.000001f can be represented while 1.0000001f is rounded to zero,\r\n        // thus we could use an epsilon of 0.000001f for comparing values close to 1.\r\n        // We multiply this epsilon by the biggest magnitude of a and b.\r\n        return Mathf.Abs(b - a) < Mathf.Max(0.000001 * Mathf.Max(Mathf.Abs(a), Mathf.Abs(b)), Mathf.Epsilon * 8);\r\n    }\r\n\r\n    static SmoothDamp(current: number, target: number, currentVelocity: number, smoothTime: number, maxSpeed: number)\r\n    {\r\n        const deltaTime = Time.deltaTime;\r\n\r\n        return Mathf.SmoothDamp2(current, target, currentVelocity, smoothTime, maxSpeed, deltaTime);\r\n    }\r\n\r\n    static SmoothDamp1(current: number, target: number, currentVelocity: number, smoothTime: number)\r\n    {\r\n        const deltaTime = Time.deltaTime;\r\n        const maxSpeed = Mathf.Infinity;\r\n\r\n        return Mathf.SmoothDamp2(current, target, currentVelocity, smoothTime, maxSpeed, deltaTime);\r\n    }\r\n\r\n    // Gradually changes a value towards a desired goal over time.\r\n    static SmoothDamp2(current: number, target: number, currentVelocity: number, smoothTime: number, maxSpeed = Mathf.Infinity, deltaTime = Time.deltaTime)\r\n    {\r\n        // Based on Game Programming Gems 4 Chapter 1.10\r\n        smoothTime = Mathf.Max(0.0001, smoothTime);\r\n        const omega = 2 / smoothTime;\r\n\r\n        const x = omega * deltaTime;\r\n        const exp = 1 / (1 + x + 0.48 * x * x + 0.235 * x * x * x);\r\n        let change = current - target;\r\n        const originalTo = target;\r\n\r\n        // Clamp maximum speed\r\n        const maxChange = maxSpeed * smoothTime;\r\n        change = Mathf.Clamp(change, -maxChange, maxChange);\r\n        target = current - change;\r\n\r\n        const temp = (currentVelocity + omega * change) * deltaTime;\r\n        currentVelocity = (currentVelocity - omega * temp) * exp;\r\n        let output = target + (change + temp) * exp;\r\n\r\n        // Prevent overshooting\r\n        if (originalTo - current > 0.0 === output > originalTo)\r\n        {\r\n            output = originalTo;\r\n            currentVelocity = (output - originalTo) / deltaTime;\r\n        }\r\n\r\n        return output;\r\n    }\r\n\r\n    static SmoothDampAngle(current: number, target: number, currentVelocity: number, smoothTime: number, maxSpeed: number)\r\n    {\r\n        const deltaTime = Time.deltaTime;\r\n\r\n        return Mathf.SmoothDampAngle2(current, target, currentVelocity, smoothTime, maxSpeed, deltaTime);\r\n    }\r\n\r\n    static SmoothDampAngle1(current: number, target: number, currentVelocity: number, smoothTime: number)\r\n    {\r\n        const deltaTime = Time.deltaTime;\r\n        const maxSpeed = Mathf.Infinity;\r\n\r\n        return Mathf.SmoothDampAngle2(current, target, currentVelocity, smoothTime, maxSpeed, deltaTime);\r\n    }\r\n\r\n    // Gradually changes an angle given in degrees towards a desired goal angle over time.\r\n    static SmoothDampAngle2(current: number, target: number, currentVelocity: number, smoothTime: number, maxSpeed = Mathf.Infinity, deltaTime = Time.deltaTime)\r\n    {\r\n        target = current + Mathf.DeltaAngle(current, target);\r\n\r\n        return Mathf.SmoothDamp2(current, target, currentVelocity, smoothTime, maxSpeed, deltaTime);\r\n    }\r\n\r\n    // Loops the value t, so that it is never larger than length and never smaller than 0.\r\n    static Repeat(t: number, length: number)\r\n    {\r\n        return Mathf.Clamp(t - Mathf.Floor(t / length) * length, 0.0, length);\r\n    }\r\n\r\n    // PingPongs the value t, so that it is never larger than length and never smaller than 0.\r\n    static PingPong(t: number, length: number)\r\n    {\r\n        t = Mathf.Repeat(t, length * 2);\r\n\r\n        return length - Mathf.Abs(t - length);\r\n    }\r\n\r\n    // Calculates the ::ref::Lerp parameter between of two values.\r\n    static InverseLerp(a: number, b: number, value: number)\r\n    {\r\n        if (a !== b)\r\n        {\r\n            return Mathf.Clamp01((value - a) / (b - a));\r\n        }\r\n\r\n        return 0.0;\r\n    }\r\n\r\n    // Calculates the shortest difference between two given angles.\r\n    static DeltaAngle(current: number, target: number)\r\n    {\r\n        let delta = Mathf.Repeat((target - current), 360.0);\r\n        if (delta > 180.0)\r\n        { delta -= 360.0; }\r\n\r\n        return delta;\r\n    }\r\n\r\n    // Infinite Line Intersection (line1 is p1-p2 and line2 is p3-p4)\r\n    static LineIntersection(p1: Vector2, p2: Vector2, p3: Vector2, p4: Vector2, result: Vector2)\r\n    {\r\n        const bx = p2.x - p1.x;\r\n        const by = p2.y - p1.y;\r\n        const dx = p4.x - p3.x;\r\n        const dy = p4.y - p3.y;\r\n        const bDotDPerp = bx * dy - by * dx;\r\n        if (bDotDPerp === 0)\r\n        {\r\n            return false;\r\n        }\r\n        const cx = p3.x - p1.x;\r\n        const cy = p3.y - p1.y;\r\n        const t = (cx * dy - cy * dx) / bDotDPerp;\r\n\r\n        result.x = p1.x + t * bx;\r\n        result.y = p1.y + t * by;\r\n\r\n        return true;\r\n    }\r\n\r\n    // Line Segment Intersection (line1 is p1-p2 and line2 is p3-p4)\r\n    static LineSegmentIntersection(p1: Vector2, p2: Vector2, p3: Vector2, p4: Vector2, result: Vector2)\r\n    {\r\n        const bx = p2.x - p1.x;\r\n        const by = p2.y - p1.y;\r\n        const dx = p4.x - p3.x;\r\n        const dy = p4.y - p3.y;\r\n        const bDotDPerp = bx * dy - by * dx;\r\n        if (bDotDPerp === 0)\r\n        {\r\n            return false;\r\n        }\r\n        const cx = p3.x - p1.x;\r\n        const cy = p3.y - p1.y;\r\n        const t = (cx * dy - cy * dx) / bDotDPerp;\r\n        if (t < 0 || t > 1)\r\n        {\r\n            return false;\r\n        }\r\n        const u = (cx * by - cy * bx) / bDotDPerp;\r\n        if (u < 0 || u > 1)\r\n        {\r\n            return false;\r\n        }\r\n\r\n        result.x = p1.x + t * bx;\r\n        result.y = p1.y + t * by;\r\n\r\n        return true;\r\n    }\r\n\r\n    // static RandomToLong(System.Random r)\r\n    // {\r\n    //     var buffer = new byte[8];\r\n    //     r.NextBytes(buffer);\r\n    //     return (long)(System.BitConverter.ToUInt64(buffer, 0) & System.Int64.MaxValue);\r\n    // }\r\n\r\n    // static ClampToFloat(value: number)\r\n    // {\r\n    //     if (Mathf.Infinity === value)\r\n    //         return Mathf.Infinity;\r\n\r\n    //     if (Mathf.NegativeInfinity === value)\r\n    //         return Mathf.NegativeInfinity;\r\n\r\n    //     if (value < float.MinValue)\r\n    //         return float.MinValue;\r\n\r\n    //     if (value > float.MaxValue)\r\n    //         return float.MaxValue;\r\n\r\n    //     return (float)value;\r\n    // }\r\n\r\n    // //         internal static int ClampToInt(long value)\r\n    // // {\r\n    // //     if (value < int.MinValue)\r\n    // //         return int.MinValue;\r\n\r\n    // //     if (value > int.MaxValue)\r\n    // //         return int.MaxValue;\r\n\r\n    // //     return (int)value;\r\n    // // }\r\n\r\n    static RoundToMultipleOf(value: number, roundingValue: number)\r\n    {\r\n        if (roundingValue === 0)\r\n        {\r\n            return value;\r\n        }\r\n\r\n        return Mathf.Round(value / roundingValue) * roundingValue;\r\n    }\r\n\r\n    static GetClosestPowerOfTen(positiveNumber: number)\r\n    {\r\n        if (positiveNumber <= 0)\r\n        {\r\n            return 1;\r\n        }\r\n\r\n        return Mathf.Pow(10, Mathf.RoundToInt(Mathf.Log10(positiveNumber)));\r\n    }\r\n\r\n    static GetNumberOfDecimalsForMinimumDifference(minDifference: number)\r\n    {\r\n        return Mathf.Clamp(-Mathf.FloorToInt(Mathf.Log10(Mathf.Abs(minDifference))), 0, Mathf.kMaxDecimals);\r\n    }\r\n\r\n    static GetNumberOfDecimalsForMinimumDifference1(minDifference: number)\r\n    {\r\n        return Math.max(0.0, -Math.floor(Math.log10(Math.abs(minDifference))));\r\n    }\r\n\r\n    // static RoundBasedOnMinimumDifference(valueToRound: number, minDifference: number)\r\n    // {\r\n    //     if (minDifference === 0)\r\n    //     {\r\n    //         return Mathf.DiscardLeastSignificantDecimal(valueToRound);\r\n    //     }\r\n\r\n    //     return Math.round(valueToRound, Mathf.GetNumberOfDecimalsForMinimumDifference(minDifference),\r\n    //         System.MidpointRounding.AwayFromZero);\r\n    // }\r\n\r\n    // static RoundBasedOnMinimumDifference1(valueToRound: number, minDifference: number)\r\n    // {\r\n    //     if (minDifference === 0)\r\n    //     {\r\n    //         return Mathf.DiscardLeastSignificantDecimal(valueToRound);\r\n    //     }\r\n\r\n    //     return Math.Round(valueToRound, Mathf.GetNumberOfDecimalsForMinimumDifference(minDifference),\r\n    //         System.MidpointRounding.AwayFromZero);\r\n    // }\r\n\r\n    // static DiscardLeastSignificantDecimal(v: number)\r\n    // {\r\n    //     const decimals = Mathf.Clamp((5 - Mathf.Log10(Mathf.Abs(v))), 0, Mathf.kMaxDecimals);\r\n\r\n    //     return Math.round(v, decimals, System.MidpointRounding.AwayFromZero);\r\n    // }\r\n\r\n    // static DiscardLeastSignificantDecimal1(v: number)\r\n    // {\r\n    //     const decimals = Math.max(0, (5 - Math.log10(Math.abs(v))));\r\n    //     try\r\n    //     {\r\n    //         return Math.Round(v, decimals);\r\n    //     }\r\n    //     catch (System.ArgumentOutOfRangeException)\r\n    //     {\r\n    //         // This can happen for very small numbers.\r\n    //         return 0;\r\n    //     }\r\n    // }\r\n}\r\n","import { mathUtil } from '@feng3d/polyfill';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { Mathf } from '../MathF';\r\nimport { Time } from '../Time';\r\nimport { Vector } from './Vector';\r\nimport { Vector3 } from './Vector3';\r\n\r\n/**\r\n * Representation of 2D vectors and points.\r\n */\r\n/**\r\n * 二维向量和点的表示。\r\n */\r\nexport class Vector2 implements Vector\r\n{\r\n    __class__: 'Vector2';\r\n\r\n    /**\r\n     * X component of the vector.\r\n     */\r\n    /**\r\n     * 向量的X分量。\r\n     */\r\n    @oav()\r\n    @serialize\r\n    x: number;\r\n\r\n    /**\r\n     * Y component of the vector.\r\n     */\r\n    /**\r\n     * 向量的Y分量。\r\n     */\r\n    @oav()\r\n    @serialize\r\n    y: number;\r\n\r\n    /**\r\n     * The length of this vector.\r\n     */\r\n    /**\r\n     * 向量的长度。\r\n     */\r\n    get length(): number\r\n    {\r\n        return Math.sqrt((this.x * this.x) + (this.y * this.y));\r\n    }\r\n\r\n    /**\r\n     * The squared length of this vector.\r\n     */\r\n    /**\r\n     * 向量长度的平方。\r\n     */\r\n    get lengthSquared(): number\r\n    {\r\n        return (this.x * this.x) + (this.y * this.y);\r\n    }\r\n\r\n    /**\r\n     * The length of this vector.\r\n     */\r\n    /**\r\n     * 向量的长度。\r\n     */\r\n    get magnitude()\r\n    {\r\n        return this.length;\r\n    }\r\n\r\n    /**\r\n     * The squared length of this vector.\r\n     */\r\n    /**\r\n     * 向量长度的平方。\r\n     */\r\n    get sqrMagnitude(): number\r\n    {\r\n        return (this.x * this.x) + (this.y * this.y);\r\n    }\r\n\r\n    /**\r\n     * 返回大小为 1 的此向量（只读）。\r\n     *\r\n     * 归一化后，向量保持相同的方向，但其长度为 1.0。\r\n     *\r\n     * 请注意，当前向量不变，并返回一个新的归一化向量。如果要对当前向量进行归一化，请使用Normalize函数。\r\n     *\r\n     * 如果向量太小而无法归一化，则将返回零向量。\r\n     */\r\n    /**\r\n     * Returns this vector with a magnitude of 1 (Read Only).\r\n     *\r\n     * When normalized, a vector keeps the same direction but its length is 1.0.\r\n     *\r\n     * Note that the current vector is unchanged and a new normalized vector is returned. If you want to normalize the current vector, use Normalize function.\r\n     *\r\n     * If the vector is too small to be normalized a zero vector will be returned.\r\n     */\r\n    get normalized()\r\n    {\r\n        const v = new Vector2(this.x, this.y);\r\n        v.normalize();\r\n\r\n        return v;\r\n    }\r\n\r\n    /**\r\n     * Constructs a new vector with given x, y components.\r\n     *\r\n     * @param x X component of the vector.\r\n     * @param y Y component of the vector.\r\n     */\r\n    /**\r\n     * 用给定的 x, y 分量构造一个新向量。\r\n     *\r\n     * @param x 向量的X分量。\r\n     * @param y 向量的Y分量。\r\n     */\r\n    constructor(x = 0, y = 0)\r\n    {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n\r\n    /**\r\n     * Set x and y components of an existing Vector2.\r\n     *\r\n     * @param x The new X component of the vector\r\n     * @param y The new Y component of the vector\r\n     */\r\n    /**\r\n     * 设置现有Vector2的x和y分量。\r\n     *\r\n     * @param x 向量的新的X分量\r\n     * @param y 向量的新的Y分量\r\n     */\r\n    set(x: number, y: number)\r\n    {\r\n        this.x = x;\r\n        this.y = y;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Determine if it is equal to the given vector.\r\n     *\r\n     * @param other the given vector.\r\n     * @param precision comparative precision.\r\n     * @returns Returns true if the given vector is exactly equal to this vector.\r\n     */\r\n    /**\r\n     * 判断与给定向量是否相等。\r\n     *\r\n     * @param other 给定的向量。\r\n     * @param precision 比较精度。\r\n     * @returns 如果给定向量完全等于该向量，则返回 true。\r\n     */\r\n    equals(other: Vector2, precision = mathUtil.PRECISION)\r\n    {\r\n        if (!mathUtil.equals(this.x - other.x, 0, precision))\r\n        {\r\n            return false;\r\n        }\r\n        if (!mathUtil.equals(this.y - other.y, 0, precision))\r\n        {\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Makes this vector have a magnitude of 1.\r\n     *\r\n     * When normalized, a vector keeps the same direction but its length is 1.0.\r\n     *\r\n     * Note that this function will change the current vector. If you want to keep the current vector unchanged, use normalized variable.\r\n     *\r\n     * If this vector is too small to be normalized it will be set to zero.\r\n     *\r\n     */\r\n    /**\r\n     * 使该向量的大小为 1。\r\n     *\r\n     * 归一化后，向量保持相同的方向，但其长度为 1.0。\r\n     *\r\n     * 请注意，此函数将更改当前向量。如果要保持当前向量不变，请使用归一化变量。\r\n     *\r\n     * 如果这个向量太小而无法归一化，它将被设置为零。\r\n     */\r\n    normalize()\r\n    {\r\n        const length = this.length;\r\n        if (this.length > Vector2.kEpsilon)\r\n        {\r\n            this.x /= length;\r\n            this.y /= length;\r\n        }\r\n        else\r\n        {\r\n            this.x = 0;\r\n            this.y = 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 克隆点对象\r\n     */\r\n    clone(): Vector2\r\n    {\r\n        return new Vector2(this.x, this.y);\r\n    }\r\n\r\n    /**\r\n     * 返回此向量的格式化字符串。\r\n     */\r\n    /**\r\n     * Returns a formatted string for this vector.\r\n     */\r\n    toString(): string\r\n    {\r\n        return `(${this.x}, ${this.y})`;\r\n    }\r\n\r\n    /**\r\n     * Shorthand for writing Vector2(0, 0).\r\n     */\r\n    /**\r\n     * 零向量`Vector2(0, 0)`。\r\n     */\r\n    static readonly zero = Object.freeze(new Vector2());\r\n\r\n    /**\r\n     * Shorthand for writing Vector2(1, 1).\r\n     */\r\n    /**\r\n     * 单元向量`Vector2(1, 1)`。\r\n     */\r\n    static readonly one = Object.freeze(new Vector2(1, 1));\r\n\r\n    /**\r\n     * Shorthand for writing Vector2(0, 1).\r\n     */\r\n    static readonly up = Object.freeze(new Vector2(0, 1));\r\n\r\n    /**\r\n     * Shorthand for writing Vector2(0, -1).\r\n     */\r\n    static readonly down = Object.freeze(new Vector2(0, -1));\r\n\r\n    /**\r\n     * Shorthand for writing Vector2(-1, 0).\r\n     */\r\n    static readonly left = Object.freeze(new Vector2(-1, 0));\r\n\r\n    /**\r\n     * Shorthand for writing Vector2(1, 0).\r\n     */\r\n    static readonly right = Object.freeze(new Vector2(1, 0));\r\n\r\n    /**\r\n     * Shorthand for writing Vector2(Infinity, Infinity).\r\n     */\r\n    static readonly positiveInfinity = Object.freeze(new Vector2(Infinity, Infinity));\r\n\r\n    /**\r\n     * Shorthand for writing Vector2(-Infinity, -Infinity).\r\n     */\r\n    static readonly negativeInfinity = Object.freeze(new Vector2(-Infinity, -Infinity));\r\n\r\n    /**\r\n     * 可允许误差。\r\n     */\r\n    static readonly kEpsilon = 0.00001;\r\n\r\n    /**\r\n     * 可允许误差平方。\r\n     */\r\n    static readonly kEpsilonNormalSqrt = 1e-15;\r\n\r\n    /**\r\n     * Linearly interpolates between vectors a and b by t.\r\n     *\r\n     * The parameter t is clamped to the range [0, 1].\r\n     *\r\n     * When t = 0 returns a.\r\n     * When t = 1 return b.\r\n     * When t = 0.5 returns the midpoint of a and b.\r\n     *\r\n     * @param a Start point.\r\n     * @param b End point.\r\n     * @param t Interpolated coefficient.\r\n     */\r\n    /**\r\n     * 返回起始向量`a`与终止向量`b`在`t`位置的线性插值。\r\n     *\r\n     * 参数`t`将被裁减到[0, 1]的范围内。\r\n     *\r\n     * 当 t = 0 时返回`a`.\r\n     * 当 t = 1 时返回`b`.\r\n     * 当 t = 0.5 时返回`a`与`b`的中间值.\r\n     *\r\n     * @param a 起始点。\r\n     * @param b 终止点。\r\n     * @param t 插值系数。\r\n     */\r\n    static Lerp(a: Vector2, b: Vector2, t: number)\r\n    {\r\n        t = mathUtil.clamp(t, 0, 1);\r\n\r\n        return new Vector2(\r\n            a.x + (b.x - a.x) * t,\r\n            a.y + (b.y - a.y) * t\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Linearly interpolates between vectors a and b by t.\r\n     *\r\n     * When t = 0 returns a.\r\n     * When t = 1 return b.\r\n     * When t = 0.5 returns the midpoint of a and b.\r\n     *\r\n     * @param a Start point.\r\n     * @param b End point.\r\n     * @param t Interpolated coefficient.\r\n     */\r\n    /**\r\n     * 返回起始向量`a`与终止向量`b`在`t`位置的线性插值。\r\n     *\r\n     * 当 t = 0 时返回`a`.\r\n     * 当 t = 1 时返回`b`.\r\n     * 当 t = 0.5 时返回`a`与`b`的中间值.\r\n     *\r\n     * @param a 起始点。\r\n     * @param b 终止点。\r\n     * @param t 插值系数。\r\n     */\r\n    static LerpUnclamped(a: Vector2, b: Vector2, t: number)\r\n    {\r\n        return new Vector2(\r\n            a.x + (b.x - a.x) * t,\r\n            a.y + (b.y - a.y) * t\r\n        );\r\n    }\r\n\r\n    // Moves a point /current/ towards /target/.\r\n    static MoveTowards(current: Vector2, target: Vector2, maxDistanceDelta: number)\r\n    {\r\n        // avoid vector ops because current scripting backends are terrible at inlining\r\n        const toVectorX = target.x - current.x;\r\n        const toVectorY = target.y - current.y;\r\n\r\n        const sqDist = toVectorX * toVectorX + toVectorY * toVectorY;\r\n\r\n        if (sqDist === 0 || (maxDistanceDelta >= 0 && sqDist <= maxDistanceDelta * maxDistanceDelta))\r\n        {\r\n            return target;\r\n        }\r\n\r\n        const dist = Math.sqrt(sqDist);\r\n\r\n        return new Vector2(current.x + toVectorX / dist * maxDistanceDelta,\r\n            current.y + toVectorY / dist * maxDistanceDelta);\r\n    }\r\n\r\n    // Multiplies two vectors component-wise.\r\n    static Scale(a: Vector2, b: Vector2)\r\n    {\r\n        return new Vector2(a.x * b.x, a.y * b.y);\r\n    }\r\n\r\n    static Reflect(inDirection: Vector2, inNormal: Vector2)\r\n    {\r\n        const factor = -2 * Vector2.Dot(inNormal, inDirection);\r\n\r\n        return new Vector2(factor * inNormal.x + inDirection.x, factor * inNormal.y + inDirection.y);\r\n    }\r\n\r\n    static Perpendicular(inDirection: Vector2)\r\n    {\r\n        return new Vector2(-inDirection.y, inDirection.x);\r\n    }\r\n\r\n    /**\r\n     * Dot Product of two vectors.\r\n     *\r\n     * For normalized vectors Dot returns 1 if they point in exactly the same direction; -1 if they point in completely opposite directions; and a number in between for other cases (e.g. Dot returns zero if vectors are perpendicular).\r\n     *\r\n     * @param lhs The left-hand vector.\r\n     * @param rhs The right-hand vector.\r\n     * @returns Dot Product of two vectors.\r\n     */\r\n    /**\r\n     * 两个向量的点乘值。\r\n     *\r\n     * 对于归一化向量，如果它们指向完全相同的方向，则 Dot 返回 1；如果它们指向完全相反的方向则返回 -1；其他情况返回-1与1之间的数字（例如，如果向量垂直，则 Dot 返回零）。\r\n     *\r\n     * @param lhs 左侧向量。\r\n     * @param rhs 右侧向量。\r\n     * @returns 两个向量的点乘值。\r\n     */\r\n    static Dot(lhs: Vector2, rhs: Vector2)\r\n    {\r\n        return lhs.x * rhs.x + lhs.y * rhs.y;\r\n    }\r\n\r\n    /**\r\n     * Gets the unsigned angle in degrees between from and to.\r\n     *\r\n     * The angle returned is the unsigned angle between the two vectors.\r\n     * Note: The angle returned will always be between 0 and 180 degrees, because the method returns the smallest angle between the vectors. That is, it will never return a reflex angle. Angles are calculated from world origin point (0,0,0) as the vertex.\r\n     *\r\n     * @param from \tThe vector from which the angular difference is measured.\r\n     * @param to The vector to which the angular difference is measured.\r\n     * @returns The unsigned angle in degrees between the two vectors.\r\n     */\r\n    /**\r\n     * 获取从起始向量和终止向量之间的无符号角度。\r\n     *\r\n     * 返回的角度是两个向量之间的无符号角度。\r\n     * 注意：返回的角度总是在 0 到 180 度之间，因为该方法返回向量之间的最小角度。也就是说，它永远不会返回反射角。角度是从世界原点 (0,0,0) 作为顶点计算的。\r\n     *\r\n     * @param from 测量角度差的起始向量。\r\n     * @param to 测量角度差的终止向量。\r\n     * @returns 两个向量之间的无符号角度，以度为单位。\r\n     */\r\n    static Angle(from: Vector2, to: Vector2)\r\n    {\r\n        // sqrt(a) * sqrt(b) = sqrt(a * b) -- valid for real numbers\r\n        const denominator = Math.sqrt(from.sqrMagnitude * to.sqrMagnitude);\r\n        if (denominator < Vector2.kEpsilonNormalSqrt)\r\n        {\r\n            return 0;\r\n        }\r\n\r\n        const dot = mathUtil.clamp(Vector2.Dot(from, to) / denominator, -1, 1);\r\n\r\n        return Math.acos(dot) * mathUtil.RAD2DEG;\r\n    }\r\n\r\n    static SignedAngle(from: Vector2, to: Vector2)\r\n    {\r\n        const unsignedAngle = Vector2.Angle(from, to);\r\n        const sign = Mathf.Sign(from.x * to.y - from.y * to.x);\r\n\r\n        return unsignedAngle * sign;\r\n    }\r\n\r\n    /**\r\n     * Returns the distance between a and b.\r\n     *\r\n     * @param a Start point.\r\n     * @param b End point.\r\n     * @returns The distance between a and b.\r\n     */\r\n    /**\r\n     * 返回两点的距离。\r\n     *\r\n     * @param a 起始点。\r\n     * @param b 终止点。\r\n     * @returns 两点的距离。\r\n     */\r\n    static Distance(a: Vector2, b: Vector2)\r\n    {\r\n        return a.distance(b);\r\n    }\r\n\r\n    /**\r\n     * Returns a copy of vector with its magnitude clamped to maxLength.\r\n     *\r\n     * @param vector Restricted vector.\r\n     * @param maxLength The maximum length to be restricted.\r\n     * @returns A copy of vector with its magnitude clamped to maxLength.\r\n     */\r\n    /**\r\n     * 返回其长度被限制最大值为`maxLength`的向量副本。\r\n     *\r\n     * @param vector 被限制的向量。\r\n     * @param maxLength 被限制的最大长度。\r\n     * @returns 限制后的向量副本。\r\n     */\r\n    static ClampMagnitude(vector: Vector2, maxLength: number)\r\n    {\r\n        const sqrMagnitude = vector.sqrMagnitude;\r\n        if (sqrMagnitude > maxLength * maxLength)\r\n        {\r\n            const mag = Math.sqrt(sqrMagnitude);\r\n\r\n            // these intermediate variables force the intermediate result to be\r\n            // of float precision. without this, the intermediate result can be of higher\r\n            // precision, which changes behavior.\r\n            const normalizedX = vector.x / mag;\r\n            const normalizedY = vector.y / mag;\r\n\r\n            return new Vector2(normalizedX * maxLength, normalizedY * maxLength);\r\n        }\r\n\r\n        return vector.clone();\r\n    }\r\n\r\n    // Returns a vector that is made from the smallest components of two vectors.\r\n    static Min(lhs: Vector2, rhs: Vector2)\r\n    {\r\n        return new Vector2(Mathf.Min(lhs.x, rhs.x), Mathf.Min(lhs.y, rhs.y));\r\n    }\r\n\r\n    // Returns a vector that is made from the largest components of two vectors.\r\n    static Max(lhs: Vector2, rhs: Vector2)\r\n    {\r\n        return new Vector2(Mathf.Max(lhs.x, rhs.x), Mathf.Max(lhs.y, rhs.y));\r\n    }\r\n\r\n    static SmoothDamp(current: Vector2, target: Vector2, currentVelocity: Vector2, smoothTime: number, maxSpeed: number)\r\n    {\r\n        const deltaTime = Time.deltaTime;\r\n\r\n        return Vector2.SmoothDamp2(current, target, currentVelocity, smoothTime, maxSpeed, deltaTime);\r\n    }\r\n\r\n    static SmoothDamp1(current: Vector2, target: Vector2, currentVelocity: Vector2, smoothTime: number)\r\n    {\r\n        const deltaTime = Time.deltaTime;\r\n        const maxSpeed = Mathf.Infinity;\r\n\r\n        return Vector2.SmoothDamp2(current, target, currentVelocity, smoothTime, maxSpeed, deltaTime);\r\n    }\r\n\r\n    static SmoothDamp2(current: Vector2, target: Vector2, currentVelocity: Vector2, smoothTime: number, maxSpeed = Mathf.Infinity, deltaTime = Time.deltaTime)\r\n    {\r\n        // Based on Game Programming Gems 4 Chapter 1.10\r\n        smoothTime = Mathf.Max(0.0001, smoothTime);\r\n        const omega = 2 / smoothTime;\r\n\r\n        const x = omega * deltaTime;\r\n        const exp = 1 / (1 + x + 0.48 * x * x + 0.235 * x * x * x);\r\n\r\n        let changeX = current.x - target.x;\r\n        let changeY = current.y - target.y;\r\n        const originalTo = target;\r\n\r\n        // Clamp maximum speed\r\n        const maxChange = maxSpeed * smoothTime;\r\n\r\n        const maxChangeSq = maxChange * maxChange;\r\n        const sqDist = changeX * changeX + changeY * changeY;\r\n        if (sqDist > maxChangeSq)\r\n        {\r\n            const mag = Mathf.Sqrt(sqDist);\r\n            changeX = changeX / mag * maxChange;\r\n            changeY = changeY / mag * maxChange;\r\n        }\r\n\r\n        target.x = current.x - changeX;\r\n        target.y = current.y - changeY;\r\n\r\n        const tempX = (currentVelocity.x + omega * changeX) * deltaTime;\r\n        const tempY = (currentVelocity.y + omega * changeY) * deltaTime;\r\n\r\n        currentVelocity.x = (currentVelocity.x - omega * tempX) * exp;\r\n        currentVelocity.y = (currentVelocity.y - omega * tempY) * exp;\r\n\r\n        let outputX = target.x + (changeX + tempX) * exp;\r\n        let outputY = target.y + (changeY + tempY) * exp;\r\n\r\n        // Prevent overshooting\r\n        const origMinusCurrentX = originalTo.x - current.x;\r\n        const origMinusCurrentY = originalTo.y - current.y;\r\n        const outMinusOrigX = outputX - originalTo.x;\r\n        const outMinusOrigY = outputY - originalTo.y;\r\n\r\n        if (origMinusCurrentX * outMinusOrigX + origMinusCurrentY * outMinusOrigY > 0)\r\n        {\r\n            outputX = originalTo.x;\r\n            outputY = originalTo.y;\r\n\r\n            currentVelocity.x = (outputX - originalTo.x) / deltaTime;\r\n            currentVelocity.y = (outputY - originalTo.y) / deltaTime;\r\n        }\r\n\r\n        return new Vector2(outputX, outputY);\r\n    }\r\n\r\n    /**\r\n     * 将一对极坐标转换为笛卡尔点坐标。\r\n     * @param len 极坐标对的长度。\r\n     * @param angle 极坐标对的角度（以弧度表示）。\r\n     */\r\n    static polar(len: number, angle: number): Vector2\r\n    {\r\n        return new Vector2(len * Math.cos(angle * mathUtil.RAD2DEG), len * Math.sin(angle * mathUtil.RAD2DEG));\r\n    }\r\n\r\n    /**\r\n     * 将另一个点的坐标添加到此点的坐标。\r\n     * @param v 要添加的点。\r\n     */\r\n    add(v: Vector2): Vector2\r\n    {\r\n        this.x += v.x;\r\n        this.y += v.y;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 将另一个点的坐标添加到此点的坐标以创建一个新点。\r\n     * @param v 要添加的点。\r\n     * @returns 新点。\r\n     */\r\n    addTo(v: Vector2, vout = new Vector2())\r\n    {\r\n        vout.x = this.x + v.x;\r\n        vout.y = this.y + v.y;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 从此点的坐标中减去另一个点的坐标以创建一个新点。\r\n     * @param v 要减去的点。\r\n     * @returns 新点。\r\n     */\r\n    sub(v: Vector2)\r\n    {\r\n        this.x -= v.x;\r\n        this.y -= v.y;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 减去向量返回新向量\r\n     * @param v 减去的向量\r\n     * @returns 返回的新向量\r\n     */\r\n    subTo(v: Vector2, vout = new Vector2())\r\n    {\r\n        vout.x = this.x - v.x;\r\n        vout.y = this.y - v.y;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 乘以向量\r\n     * @param v 向量\r\n     */\r\n    multiply(v: Vector2)\r\n    {\r\n        this.x *= v.x;\r\n        this.y *= v.y;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 乘以向量\r\n     * @param v 向量\r\n     * @param vout 输出向量\r\n     */\r\n    multiplyTo(v: Vector2, vout = new Vector2())\r\n    {\r\n        vout.x = this.x * v.x;\r\n        vout.y = this.y * v.y;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 除以向量\r\n     * @param v 向量\r\n     */\r\n    divide(v: Vector2)\r\n    {\r\n        this.x /= v.x;\r\n        this.y /= v.y;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 除以向量\r\n     * @param v 向量\r\n     * @param vout 输出向量\r\n     */\r\n    divideTo(v: Vector2, vout = new Vector2())\r\n    {\r\n        vout.x = this.x / v.x;\r\n        vout.y = this.y / v.y;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 将源 Vector2 对象中的所有点数据复制到调用方 Vector2 对象中。\r\n     * @param source 要从中复制数据的 Vector2 对象。\r\n     */\r\n    copy(source: Vector2)\r\n    {\r\n        this.x = source.x;\r\n        this.y = source.y;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 返回与目标点之间的距离。\r\n     * @param p 目标点\r\n     * @returns 与目标点之间的距离。\r\n     */\r\n    distance(p: Vector2)\r\n    {\r\n        const dx = this.x - p.x;\r\n        const dy = this.y - p.y;\r\n\r\n        return Math.sqrt((dx * dx) + (dy * dy));\r\n    }\r\n\r\n    /**\r\n     * 与目标点之间的距离平方\r\n     * @param p 目标点\r\n     */\r\n    distanceSquared(p: Vector3)\r\n    {\r\n        const dx = this.x - p.x;\r\n        const dy = this.y - p.y;\r\n\r\n        return (dx * dx) + (dy * dy);\r\n    }\r\n\r\n    /**\r\n     * 负向量\r\n     */\r\n    negate()\r\n    {\r\n        this.x *= -1;\r\n        this.y *= -1;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 倒数向量。\r\n     * (x,y) -> (1/x,1/y)\r\n     */\r\n    reciprocal()\r\n    {\r\n        this.x = 1 / this.x;\r\n        this.y = 1 / this.y;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 倒数向量。\r\n     * (x,y) -> (1/x,1/y)\r\n     */\r\n    reciprocalTo(out = new Vector2())\r\n    {\r\n        out.copy(this).reciprocal();\r\n\r\n        return out;\r\n    }\r\n\r\n    /**\r\n     * 按标量（大小）缩放当前的 Vector3 对象。\r\n     */\r\n    scaleNumber(s: number): Vector2\r\n    {\r\n        this.x *= s;\r\n        this.y *= s;\r\n\r\n        return this;\r\n    }\r\n    /**\r\n     * 按标量（大小）缩放当前的 Vector2 对象。\r\n     */\r\n    scaleNumberTo(s: number, vout = new Vector2())\r\n    {\r\n        return vout.copy(this).scaleNumber(s);\r\n    }\r\n\r\n    /**\r\n     * 缩放\r\n     * @param s 缩放量\r\n     */\r\n    scale(s: Vector2)\r\n    {\r\n        this.x *= s.x;\r\n        this.y *= s.y;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 缩放\r\n     * @param s 缩放量\r\n     */\r\n    scaleTo(s: Vector2, vout = new Vector2())\r\n    {\r\n        if (s === vout) s = s.clone();\r\n\r\n        return vout.copy(this).scale(s);\r\n    }\r\n\r\n    /**\r\n     * 按指定量偏移 Vector2 对象。dx 的值将添加到 x 的原始值中以创建新的 x 值。dy 的值将添加到 y 的原始值中以创建新的 y 值。\r\n     * @param dx 水平坐标 x 的偏移量。\r\n     * @param dy 水平坐标 y 的偏移量。\r\n     */\r\n    offset(dx: number, dy: number): Vector2\r\n    {\r\n        this.x += dx;\r\n        this.y += dy;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 插值到指定向量\r\n     * @param v 目标向量\r\n     * @param alpha 插值系数\r\n     * @returns 返回自身\r\n     */\r\n    lerp(p: Vector2, alpha: Vector2): Vector2\r\n    {\r\n        this.x += (p.x - this.x) * alpha.x;\r\n        this.y += (p.y - this.y) * alpha.y;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 插值到指定向量\r\n     * @param v 目标向量\r\n     * @param alpha 插值系数\r\n     * @returns 返回新向量\r\n     */\r\n    lerpTo(v: Vector2, alpha: Vector2, vout = new Vector2())\r\n    {\r\n        return vout.copy(this).lerp(v, alpha);\r\n    }\r\n\r\n    /**\r\n     * 插值到指定向量\r\n     * @param v 目标向量\r\n     * @param alpha 插值系数\r\n     * @returns 返回自身\r\n     */\r\n    lerpNumber(v: Vector2, alpha: number)\r\n    {\r\n        this.x += (v.x - this.x) * alpha;\r\n        this.y += (v.y - this.y) * alpha;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 插值到指定向量\r\n     * @param v 目标向量\r\n     * @param alpha 插值系数\r\n     * @returns 返回自身\r\n     */\r\n    lerpNumberTo(v: Vector2, alpha: number, vout = new Vector2())\r\n    {\r\n        return vout.copy(this).lerpNumber(v, alpha);\r\n    }\r\n\r\n    /**\r\n     * 夹紧？\r\n     * @param min 最小值\r\n     * @param max 最大值\r\n     */\r\n    clamp(min: Vector2, max: Vector2)\r\n    {\r\n        this.x = mathUtil.clamp(this.x, min.x, max.x);\r\n        this.y = mathUtil.clamp(this.y, min.y, max.y);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 夹紧？\r\n     * @param min 最小值\r\n     * @param max 最大值\r\n     */\r\n    clampTo(min: Vector2, max: Vector2, vout = new Vector2())\r\n    {\r\n        return vout.copy(this).clamp(min, max);\r\n    }\r\n\r\n    /**\r\n     * 取最小元素\r\n     * @param v 向量\r\n     */\r\n    min(v: Vector2)\r\n    {\r\n        this.x = Math.min(this.x, v.x);\r\n        this.y = Math.min(this.y, v.y);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 取最大元素\r\n     * @param v 向量\r\n     */\r\n    max(v: Vector2)\r\n    {\r\n        this.x = Math.max(this.x, v.x);\r\n        this.y = Math.max(this.y, v.y);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 各分量均取最近的整数\r\n     */\r\n    round()\r\n    {\r\n        this.x = Math.round(this.x);\r\n        this.y = Math.round(this.y);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 转换为数组\r\n     * @param array 数组\r\n     * @param offset 偏移\r\n     * @returns 返回数组\r\n     */\r\n    toArray(array: number[] = [], offset = 0)\r\n    {\r\n        array[offset] = this.x;\r\n        array[offset + 1] = this.y;\r\n\r\n        return array;\r\n    }\r\n}\r\n","import { oav } from '@feng3d/objectview';\r\nimport { mathUtil } from '@feng3d/polyfill';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { Mathf } from '../MathF';\r\nimport { Time } from '../Time';\r\nimport { Matrix3x3 } from './Matrix3x3';\r\nimport { Matrix4x4 } from './Matrix4x4';\r\nimport { Quaternion } from './Quaternion';\r\nimport { Vector } from './Vector';\r\nimport { Vector2 } from './Vector2';\r\nimport { Vector4 } from './Vector4';\r\n\r\nexport interface Vector3Like\r\n{\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n}\r\n\r\n/**\r\n * Vector3 类使用笛卡尔坐标 x、y 和 z 表示三维空间中的点或位置\r\n */\r\nexport class Vector3 implements Vector, Vector3Like\r\n{\r\n    __class__: 'feng3d.Vector3';\r\n\r\n    /**\r\n    * 定义为 Vector3 对象的 x 轴，坐标为 (1,0,0)。\r\n    */\r\n    static X_AXIS = Object.freeze(new Vector3(1, 0, 0));\r\n\r\n    /**\r\n    * 定义为 Vector3 对象的 y 轴，坐标为 (0,1,0)\r\n    */\r\n    static Y_AXIS = Object.freeze(new Vector3(0, 1, 0));\r\n\r\n    /**\r\n    * 定义为 Vector3 对象的 z 轴，坐标为 (0,0,1)\r\n    */\r\n    static Z_AXIS = Object.freeze(new Vector3(0, 0, 1));\r\n\r\n    /**\r\n     * 原点 Vector3(0,0,0)\r\n     */\r\n    static ZERO = Object.freeze(new Vector3());\r\n\r\n    /**\r\n     * Vector3(1, 1, 1)\r\n     */\r\n    static ONE = Object.freeze(new Vector3(1, 1, 1));\r\n\r\n    /**\r\n     * 从数组中初始化向量\r\n     * @param array 数组\r\n     * @param offset 偏移\r\n     * @returns 返回新向量\r\n     */\r\n    static fromArray(array: ArrayLike<number>, offset = 0)\r\n    {\r\n        return new Vector3().fromArray(array, offset);\r\n    }\r\n\r\n    /**\r\n     * 随机三维向量\r\n     *\r\n     * @param size 尺寸\r\n     * @param double 如果值为false，随机范围在[0,size],否则[-size,size]。默认为false。\r\n     */\r\n    static random(size = 1, double = false)\r\n    {\r\n        const v = new Vector3(Math.random(), Math.random(), Math.random());\r\n\r\n        if (double) v.scaleNumber(2).subNumber(1);\r\n        v.scaleNumber(size);\r\n\r\n        return v;\r\n    }\r\n\r\n    /**\r\n     * 从Vector2初始化\r\n     */\r\n    static fromVector2(vector: Vector2, z = 0)\r\n    {\r\n        return new Vector3().fromVector2(vector, z);\r\n    }\r\n\r\n    /**\r\n    * Vector3 对象中的第一个元素，例如，三维空间中某个点的 x 坐标。默认值为 0\r\n    */\r\n    @serialize\r\n    @oav()\r\n    x = 0;\r\n\r\n    /**\r\n     * Vector3 对象中的第二个元素，例如，三维空间中某个点的 y 坐标。默认值为 0\r\n     */\r\n    @serialize\r\n    @oav()\r\n    y = 0;\r\n\r\n    /**\r\n     * Vector3 对象中的第三个元素，例如，三维空间中某个点的 z 坐标。默认值为 0\r\n     */\r\n    @serialize\r\n    @oav()\r\n    z = 0;\r\n\r\n    /**\r\n    * 当前 Vector3 对象的长度（大小），即从原点 (0,0,0) 到该对象的 x、y 和 z 坐标的距离。w 属性将被忽略。单位矢量具有的长度或大小为一。\r\n    */\r\n    get length(): number\r\n    {\r\n        return Math.sqrt(this.lengthSquared);\r\n    }\r\n\r\n    /**\r\n    * 当前 Vector3 对象长度的平方，它是使用 x、y 和 z 属性计算出来的。w 属性将被忽略。尽可能使用 lengthSquared() 方法，而不要使用 Vector3.length() 方法的 Math.sqrt() 方法调用，后者速度较慢。\r\n    */\r\n    get lengthSquared(): number\r\n    {\r\n        return (this.x * this.x) + (this.y * this.y) + (this.z * this.z);\r\n    }\r\n\r\n    /**\r\n     * 创建 Vector3 对象的实例。如果未指定构造函数的参数，则将使用元素 (0,0,0,0) 创建 Vector3 对象。\r\n     * @param x 第一个元素，例如 x 坐标。\r\n     * @param y 第二个元素，例如 y 坐标。\r\n     * @param z 第三个元素，例如 z 坐标。\r\n     */\r\n    constructor(x = 0, y = 0, z = 0)\r\n    {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n    }\r\n\r\n    /**\r\n     * 将 Vector3 的成员设置为指定值\r\n     */\r\n    set(x: number, y: number, z: number)\r\n    {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 把所有分量都设为零\r\n     */\r\n    setZero()\r\n    {\r\n        this.x = this.y = this.z = 0;\r\n    }\r\n\r\n    /**\r\n     * 从Vector2初始化\r\n     */\r\n    fromVector2(vector: Vector2, z = 0)\r\n    {\r\n        this.x = vector.x;\r\n        this.y = vector.y;\r\n        this.z = z;\r\n\r\n        return this;\r\n    }\r\n\r\n    fromArray(array: ArrayLike<number>, offset = 0)\r\n    {\r\n        this.x = array[offset];\r\n        this.y = array[offset + 1];\r\n        this.z = array[offset + 2];\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 转换为Vector2\r\n     */\r\n    toVector2(vector = new Vector2())\r\n    {\r\n        return vector.set(this.x, this.y);\r\n    }\r\n\r\n    /**\r\n     * 加上指定向量\r\n     * @param v 加向量\r\n     */\r\n    add(v: Vector3)\r\n    {\r\n        this.x += v.x;\r\n        this.y += v.y;\r\n        this.z += v.z;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 加上指定向量得到新向量\r\n     * @param v 加向量\r\n     * @returns 返回新向量\r\n     */\r\n    addTo(v: Vector3, vout = new Vector3())\r\n    {\r\n        vout.x = this.x + v.x;\r\n        vout.y = this.y + v.y;\r\n        vout.z = this.z + v.z;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 减去向量\r\n     * @param a 减去的向量\r\n     * @returns 返回新向量\r\n     */\r\n    sub(a: Vector3)\r\n    {\r\n        this.x -= a.x;\r\n        this.y -= a.y;\r\n        this.z -= a.z;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 减去向量返回新向量\r\n     * @param v 减去的向量\r\n     * @returns 返回的新向量\r\n     */\r\n    subTo(v: Vector3, vout = new Vector3())\r\n    {\r\n        vout.x = this.x - v.x;\r\n        vout.y = this.y - v.y;\r\n        vout.z = this.z - v.z;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 乘以向量\r\n     * @param v 向量\r\n     */\r\n    multiply(v: Vector3)\r\n    {\r\n        this.x *= v.x;\r\n        this.y *= v.y;\r\n        this.z *= v.z;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 乘以向量\r\n     * @param v 向量\r\n     * @param vout 输出向量\r\n     */\r\n    multiplyTo(v: Vector3, vout = new Vector3())\r\n    {\r\n        vout.x = this.x * v.x;\r\n        vout.y = this.y * v.y;\r\n        vout.z = this.z * v.z;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 除以向量\r\n     * @param a 向量\r\n     */\r\n    divide(a: Vector3)\r\n    {\r\n        this.x /= a.x;\r\n        this.y /= a.y;\r\n        this.z /= a.z;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 除以向量\r\n     * @param a 向量\r\n     * @param vout 输出向量\r\n     */\r\n    divideTo(a: Vector3Like, vout = new Vector3())\r\n    {\r\n        vout.x = this.x / a.x;\r\n        vout.y = this.y / a.y;\r\n        vout.z = this.z / a.z;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 通过将当前 Vector3 对象的 x、y 和 z 元素与指定的 Vector3 对象的 x、y 和 z 元素进行比较，确定这两个对象是否相等。\r\n     */\r\n    equals(v: Vector3Like, precision = mathUtil.PRECISION)\r\n    {\r\n        if (!mathUtil.equals(this.x - v.x, 0, precision))\r\n        {\r\n            return false;\r\n        }\r\n        if (!mathUtil.equals(this.y - v.y, 0, precision))\r\n        {\r\n            return false;\r\n        }\r\n        if (!mathUtil.equals(this.z - v.z, 0, precision))\r\n        {\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 将源 Vector3 对象中的所有矢量数据复制到调用方 Vector3 对象中。\r\n     * @returns 要从中复制数据的 Vector3 对象。\r\n     */\r\n    copy(v: Vector3Like)\r\n    {\r\n        this.x = v.x;\r\n        this.y = v.y;\r\n        this.z = v.z;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 与目标点之间的距离\r\n     * @param p 目标点\r\n     */\r\n    distance(p: Vector3Like)\r\n    {\r\n        const dx = this.x - p.x;\r\n        const dy = this.y - p.y;\r\n        const dz = this.z - p.z;\r\n\r\n        return Math.sqrt((dx * dx) + (dy * dy) + (dz * dz));\r\n    }\r\n\r\n    /**\r\n     * 与目标点之间的距离平方\r\n     * @param p 目标点\r\n     */\r\n    distanceSquared(p: Vector3Like)\r\n    {\r\n        const dx = this.x - p.x;\r\n        const dy = this.y - p.y;\r\n        const dz = this.z - p.z;\r\n\r\n        return (dx * dx) + (dy * dy) + (dz * dz);\r\n    }\r\n\r\n    /**\r\n     * 通过将最前面的三个元素（x、y、z）除以矢量的长度可将 Vector3 对象转换为单位矢量。\r\n     */\r\n    normalize(thickness = 1)\r\n    {\r\n        let length = this.lengthSquared;\r\n\r\n        if (length > 0)\r\n        {\r\n            length = Math.sqrt(length);\r\n            const invLength = thickness / length;\r\n\r\n            this.x *= invLength;\r\n            this.y *= invLength;\r\n            this.z *= invLength;\r\n        }\r\n        else\r\n        {\r\n            // Make something up\r\n            this.x = 0;\r\n            this.y = 0;\r\n            this.z = 0;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Scale a vector and add it to this vector. Save the result in \"this\". (this = this + vector * scalar)\r\n     * @param scalar\r\n     * @param vector\r\n     */\r\n    addScaledVector(scalar: number, vector: Vector3)\r\n    {\r\n        this.x = this.x + (scalar * vector.x);\r\n        this.y = this.y + (scalar * vector.y);\r\n        this.z = this.z + (scalar * vector.z);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Scale a vector and add it to this vector. Save the result in \"target\". (target = this + vector * scalar)\r\n     * @param scalar\r\n     * @param vector\r\n     * @param target The vector to save the result in.\r\n     */\r\n    addScaledVectorTo(scalar: number, vector: Vector3Like, target = new Vector3())\r\n    {\r\n        target.x = this.x + (scalar * vector.x);\r\n        target.y = this.y + (scalar * vector.y);\r\n        target.z = this.z + (scalar * vector.z);\r\n\r\n        return target;\r\n    }\r\n\r\n    /**\r\n     * 叉乘向量\r\n     * @param a 向量\r\n     */\r\n    cross(a: Vector3Like): Vector3\r\n    {\r\n        return this.set((this.y * a.z) - (this.z * a.y), (this.z * a.x) - (this.x * a.z), (this.x * a.y) - (this.y * a.x));\r\n    }\r\n\r\n    /**\r\n     * 叉乘向量\r\n     * @param a 向量\r\n     * @param vout 输出向量\r\n     */\r\n    crossTo(a: Vector3Like, vout = new Vector3())\r\n    {\r\n        vout.x = (this.y * a.z) - (this.z * a.y);\r\n        vout.y = (this.z * a.x) - (this.x * a.z);\r\n        vout.z = (this.x * a.y) - (this.y * a.x);\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 如果当前 Vector3 对象和作为参数指定的 Vector3 对象均为单位顶点，此方法将返回这两个顶点之间所成角的余弦值。\r\n     */\r\n    dot(a: Vector3Like)\r\n    {\r\n        return (this.x * a.x) + (this.y * a.y) + (this.z * a.z);\r\n    }\r\n\r\n    /**\r\n     * 是否为零向量\r\n     */\r\n    isZero()\r\n    {\r\n        return this.x === 0 && this.y === 0 && this.z === 0;\r\n    }\r\n\r\n    tangents(t1: Vector3, t2: Vector3)\r\n    {\r\n        const norm = this.length;\r\n        if (norm > 0.0)\r\n        {\r\n            const n = new Vector3();\r\n            const inorm = 1 / norm;\r\n            n.set(this.x * inorm, this.y * inorm, this.z * inorm);\r\n            const randVec = new Vector3();\r\n            if (Math.abs(n.x) < 0.9)\r\n            {\r\n                randVec.set(1, 0, 0);\r\n                n.crossTo(randVec, t1);\r\n            }\r\n else\r\n            {\r\n                randVec.set(0, 1, 0);\r\n                n.crossTo(randVec, t1);\r\n            }\r\n            n.crossTo(t1, t2);\r\n        }\r\n else\r\n        {\r\n            // The normal length is zero, make something up\r\n            t1.set(1, 0, 0);\r\n            t2.set(0, 1, 0);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 检查一个向量是否接近零\r\n     *\r\n     * @param precision\r\n     */\r\n    almostZero(precision = mathUtil.PRECISION)\r\n    {\r\n        if (Math.abs(this.x) > precision\r\n            || Math.abs(this.y) > precision\r\n            || Math.abs(this.z) > precision)\r\n        {\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 检查这个向量是否与另一个向量反平行。\r\n     *\r\n     * @param v\r\n     * @param precision 设置为零以进行精确比较\r\n     */\r\n    isAntiparallelTo(v: Vector3, precision = mathUtil.PRECISION)\r\n    {\r\n        const t = new Vector3();\r\n\r\n        this.negateTo(t);\r\n\r\n        return t.equals(v, precision);\r\n    }\r\n\r\n    /**\r\n     * 加上标量\r\n     * @param n 标量\r\n     */\r\n    addNumber(n: number)\r\n    {\r\n        this.x += n;\r\n        this.y += n;\r\n        this.z += n;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 增加标量\r\n     * @param n 标量\r\n     */\r\n    addNumberTo(n: number, vout = new Vector3())\r\n    {\r\n        vout.x = this.x + n;\r\n        vout.y = this.y + n;\r\n        vout.z = this.z + n;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 减去标量\r\n     * @param n 标量\r\n     */\r\n    subNumber(n: number)\r\n    {\r\n        this.x -= n;\r\n        this.y -= n;\r\n        this.z -= n;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 减去标量\r\n     * @param n 标量\r\n     */\r\n    subNumberTo(n: number, vout = new Vector3())\r\n    {\r\n        vout.x = this.x - n;\r\n        vout.y = this.y - n;\r\n        vout.z = this.z - n;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 乘以标量\r\n     * @param n 标量\r\n     */\r\n    multiplyNumber(n: number)\r\n    {\r\n        this.x *= n;\r\n        this.y *= n;\r\n        this.z *= n;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 乘以标量\r\n     * @param n 标量\r\n     * @param vout 输出向量\r\n     */\r\n    multiplyNumberTo(n: number, vout = new Vector3())\r\n    {\r\n        vout.x = this.x * n;\r\n        vout.y = this.y * n;\r\n        vout.z = this.z * n;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 除以标量\r\n     * @param n 标量\r\n     */\r\n    divideNumber(n: number)\r\n    {\r\n        this.x /= n;\r\n        this.y /= n;\r\n        this.z /= n;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 除以标量\r\n     * @param n 标量\r\n     * @param vout 输出向量\r\n     */\r\n    divideNumberTo(n: number, vout = new Vector3())\r\n    {\r\n        vout.x = this.x / n;\r\n        vout.y = this.y / n;\r\n        vout.z = this.z / n;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 返回一个新 Vector3 对象，它是与当前 Vector3 对象完全相同的副本。\r\n     * @returns 一个新 Vector3 对象，它是当前 Vector3 对象的副本。\r\n     */\r\n    clone()\r\n    {\r\n        return new Vector3(this.x, this.y, this.z);\r\n    }\r\n\r\n    /**\r\n     * 负向量\r\n     * (a,b,c)->(-a,-b,-c)\r\n     */\r\n    negate()\r\n    {\r\n        this.x = -this.x;\r\n        this.y = -this.y;\r\n        this.z = -this.z;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 负向量\r\n     * (a,b,c)->(-a,-b,-c)\r\n     */\r\n    negateTo(vout = new Vector3())\r\n    {\r\n        vout.x = -this.x;\r\n        vout.y = -this.y;\r\n        vout.z = -this.z;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 倒向量\r\n     * (a,b,c)->(1/a,1/b,1/c)\r\n     */\r\n    inverse()\r\n    {\r\n        this.x = 1 / this.x;\r\n        this.y = 1 / this.y;\r\n        this.z = 1 / this.z;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 倒向量\r\n     * (a,b,c)->(1/a,1/b,1/c)\r\n     */\r\n    inverseTo(vout = new Vector3())\r\n    {\r\n        vout.x = 1 / this.x;\r\n        vout.y = 1 / this.y;\r\n        vout.z = 1 / this.z;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 得到这个向量长度为1\r\n     */\r\n    unit(target: Vector3 = new Vector3())\r\n    {\r\n        const x = this.x;\r\n        const y = this.y;\r\n        const z = this.z;\r\n        let ninv = (x * x) + (y * y) + (z * z);\r\n\r\n        if (ninv > 0.0)\r\n        {\r\n            ninv = Math.sqrt(ninv);\r\n\r\n            ninv = 1.0 / ninv;\r\n            target.x = x * ninv;\r\n            target.y = y * ninv;\r\n            target.z = z * ninv;\r\n        }\r\n        else\r\n        {\r\n            target.x = 1;\r\n            target.y = 0;\r\n            target.z = 0;\r\n        }\r\n\r\n        return target;\r\n    }\r\n\r\n    /**\r\n     * 按标量（大小）缩放当前的 Vector3 对象。\r\n     */\r\n    scaleNumber(s: number)\r\n    {\r\n        this.x *= s;\r\n        this.y *= s;\r\n        this.z *= s;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 按标量（大小）缩放当前的 Vector3 对象。\r\n     */\r\n    scaleNumberTo(s: number, vout = new Vector3())\r\n    {\r\n        vout.x = this.x * s;\r\n        vout.y = this.y * s;\r\n        vout.z = this.z * s;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 缩放\r\n     * @param s 缩放量\r\n     */\r\n    scale(s: Vector3)\r\n    {\r\n        this.x *= s.x;\r\n        this.y *= s.y;\r\n        this.z *= s.z;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 缩放\r\n     * @param s 缩放量\r\n     */\r\n    scaleTo(s: Vector3, vout = new Vector3())\r\n    {\r\n        vout.x = this.x * s.x;\r\n        vout.y = this.y * s.y;\r\n        vout.z = this.z * s.z;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 插值到指定向量\r\n     * @param v 目标向量\r\n     * @param alpha 插值系数\r\n     * @returns 返回自身\r\n     */\r\n    lerp(v: Vector3, alpha: Vector3)\r\n    {\r\n        this.x += (v.x - this.x) * alpha.x;\r\n        this.y += (v.y - this.y) * alpha.y;\r\n        this.z += (v.z - this.z) * alpha.z;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 插值到指定向量\r\n     * @param v 目标向量\r\n     * @param alpha 插值系数\r\n     * @returns 返回自身\r\n     */\r\n    lerpTo(v: Vector3, alpha: Vector3, vout = new Vector3())\r\n    {\r\n        vout.x = this.x + ((v.x - this.x) * alpha.x);\r\n        vout.y = this.y + ((v.y - this.y) * alpha.y);\r\n        vout.z = this.z + ((v.z - this.z) * alpha.z);\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 插值到指定向量\r\n     * @param v 目标向量\r\n     * @param alpha 插值系数\r\n     * @returns 返回自身\r\n     */\r\n    lerpNumber(v: Vector3, alpha: number)\r\n    {\r\n        this.x += (v.x - this.x) * alpha;\r\n        this.y += (v.y - this.y) * alpha;\r\n        this.z += (v.z - this.z) * alpha;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 插值到指定向量\r\n     * @param v 目标向量\r\n     * @param alpha 插值系数\r\n     * @returns 返回自身\r\n     */\r\n    lerpNumberTo(v: Vector3, alpha: number, vout = new Vector3())\r\n    {\r\n        vout.x = this.x + ((v.x - this.x) * alpha);\r\n        vout.y = this.y + ((v.y - this.y) * alpha);\r\n        vout.z = this.z + ((v.z - this.z) * alpha);\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 小于指定点\r\n     * @param p 点\r\n     */\r\n    less(p: Vector3)\r\n    {\r\n        return this.x < p.x && this.y < p.y && this.z < p.z;\r\n    }\r\n\r\n    /**\r\n     * 小于等于指定点\r\n     * @param p 点\r\n     */\r\n    lessequal(p: Vector3)\r\n    {\r\n        return this.x <= p.x && this.y <= p.y && this.z <= p.z;\r\n    }\r\n\r\n    /**\r\n     * 大于指定点\r\n     * @param p 点\r\n     */\r\n    greater(p: Vector3)\r\n    {\r\n        return this.x > p.x && this.y > p.y && this.z > p.z;\r\n    }\r\n\r\n    /**\r\n     * 大于等于指定点\r\n     * @param p 点\r\n     */\r\n    greaterequal(p: Vector3)\r\n    {\r\n        return this.x >= p.x && this.y >= p.y && this.z >= p.z;\r\n    }\r\n\r\n    /**\r\n     * 夹紧？\r\n     * @param min 最小值\r\n     * @param max 最大值\r\n     */\r\n    clamp(min: Vector3, max: Vector3)\r\n    {\r\n        this.x = mathUtil.clamp(this.x, min.x, max.x);\r\n        this.y = mathUtil.clamp(this.y, min.y, max.y);\r\n        this.z = mathUtil.clamp(this.z, min.z, max.z);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 夹紧？\r\n     * @param min 最小值\r\n     * @param max 最大值\r\n     */\r\n    clampTo(min: Vector3, max: Vector3, vout = new Vector3())\r\n    {\r\n        return vout.copy(this).clamp(min, max);\r\n    }\r\n\r\n    /**\r\n     * 取最小元素\r\n     * @param v 向量\r\n     */\r\n    min(v: Vector3)\r\n    {\r\n        this.x = Math.min(this.x, v.x);\r\n        this.y = Math.min(this.y, v.y);\r\n        this.z = Math.min(this.z, v.z);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 取最大元素\r\n     * @param v 向量\r\n     */\r\n    max(v: Vector3)\r\n    {\r\n        this.x = Math.max(this.x, v.x);\r\n        this.y = Math.max(this.y, v.y);\r\n        this.z = Math.max(this.z, v.z);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 反射\r\n     * @param normal\r\n     */\r\n    reflect(normal: Vector3)\r\n    {\r\n        return this.sub(normal.multiplyNumberTo(2 * this.dot(normal)));\r\n    }\r\n\r\n    /**\r\n     * 向下取整\r\n     */\r\n    floor()\r\n    {\r\n        this.x = Math.floor(this.x);\r\n        this.y = Math.floor(this.y);\r\n        this.z = Math.floor(this.z);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 向上取整\r\n     */\r\n    ceil()\r\n    {\r\n        this.x = Math.ceil(this.x);\r\n        this.y = Math.ceil(this.y);\r\n        this.z = Math.ceil(this.z);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 四舍五入\r\n     */\r\n    round()\r\n    {\r\n        this.x = Math.round(this.x);\r\n        this.y = Math.round(this.y);\r\n        this.z = Math.round(this.z);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 向0取整\r\n     */\r\n    roundToZero()\r\n    {\r\n        this.x = (this.x < 0) ? Math.ceil(this.x) : Math.floor(this.x);\r\n        this.y = (this.y < 0) ? Math.ceil(this.y) : Math.floor(this.y);\r\n        this.z = (this.z < 0) ? Math.ceil(this.z) : Math.floor(this.z);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 与指定向量是否平行\r\n     * @param v 向量\r\n     */\r\n    isParallel(v: Vector3, precision = mathUtil.PRECISION)\r\n    {\r\n        return mathUtil.equals(this.crossTo(v).lengthSquared, 0, precision);\r\n    }\r\n\r\n    /**\r\n     * 从向量中得到叉乘矩阵a_cross，使得a x b = a_cross * b = c\r\n     * @see http://www8.cs.umu.se/kurser/TDBD24/VT06/lectures/Lecture6.pdf\r\n     */\r\n    crossmat(this: Vector3, outMatrix: Matrix3x3)\r\n    {\r\n        outMatrix.set([0, -this.z, this.y,\r\n            this.z, 0, -this.x,\r\n            -this.y, this.x, 0]);\r\n\r\n        return outMatrix;\r\n    }\r\n\r\n    /**\r\n     * 应用四元素\r\n     * @param q 四元素\r\n     */\r\n    applyQuaternion(q: Quaternion)\r\n    {\r\n        const x = this.x;\r\n        const y = this.y;\r\n        const z = this.z;\r\n        const qx = q.x;\r\n        const qy = q.y;\r\n        const qz = q.z;\r\n        const qw = q.w;\r\n\r\n        // calculate quat * vector\r\n\r\n        const ix = (qw * x) + (qy * z) - (qz * y);\r\n        const iy = (qw * y) + (qz * x) - (qx * z);\r\n        const iz = (qw * z) + (qx * y) - (qy * x);\r\n        const iw = -(qx * x) - (qy * y) - (qz * z);\r\n\r\n        // calculate result * inverse quat\r\n\r\n        this.x = (ix * qw) + (iw * -qx) + (iy * -qz) - (iz * -qy);\r\n        this.y = (iy * qw) + (iw * -qy) + (iz * -qx) - (ix * -qz);\r\n        this.z = (iz * qw) + (iw * -qz) + (ix * -qy) - (iy * -qx);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 应用矩阵\r\n     * @param mat 矩阵\r\n     */\r\n    applyMatrix4x4(mat: Matrix4x4)\r\n    {\r\n        mat.transformPoint3(this, this);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 返回当前 Vector3 对象的字符串表示形式。\r\n     */\r\n    toString(): string\r\n    {\r\n        return `<${this.x}, ${this.y}, ${this.z}>`;\r\n    }\r\n\r\n    /**\r\n     * 转换为数组\r\n     * @param array 数组\r\n     * @param offset 偏移\r\n     * @returns 返回数组\r\n     */\r\n    toArray(array: number[] = [], offset = 0)\r\n    {\r\n        array[offset] = this.x;\r\n        array[offset + 1] = this.y;\r\n        array[offset + 2] = this.z;\r\n\r\n        return array;\r\n    }\r\n\r\n    /**\r\n     * 转换为Vector4\r\n     */\r\n    toVector4(vector4: Vector4)\r\n    {\r\n        vector4.x = this.x;\r\n        vector4.y = this.y;\r\n        vector4.z = this.z;\r\n\r\n        return vector4;\r\n    }\r\n\r\n    // *Undocumented*\r\n    static readonly kEpsilon = 0.00001;\r\n    // *Undocumented*\r\n    static readonly kEpsilonNormalSqrt = 1e-15;\r\n\r\n    // Linearly interpolates between two vectors.\r\n    static Lerp(a: Vector3, b: Vector3, t: number)\r\n    {\r\n        t = Mathf.Clamp01(t);\r\n\r\n        return new Vector3(\r\n            a.x + (b.x - a.x) * t,\r\n            a.y + (b.y - a.y) * t,\r\n            a.z + (b.z - a.z) * t\r\n        );\r\n    }\r\n\r\n    // Linearly interpolates between two vectors without clamping the interpolant\r\n    static LerpUnclamped(a: Vector3, b: Vector3, t: number)\r\n    {\r\n        return new Vector3(\r\n            a.x + (b.x - a.x) * t,\r\n            a.y + (b.y - a.y) * t,\r\n            a.z + (b.z - a.z) * t\r\n        );\r\n    }\r\n\r\n    // Moves a point /current/ in a straight line towards a /target/ point.\r\n    static MoveTowards(current: Vector3, target: Vector3, maxDistanceDelta: number)\r\n    {\r\n        // avoid vector ops because current scripting backends are terrible at inlining\r\n        const toVectorX = target.x - current.x;\r\n        const toVectorY = target.y - current.y;\r\n        const toVectorZ = target.z - current.z;\r\n\r\n        const sqdist = toVectorX * toVectorX + toVectorY * toVectorY + toVectorZ * toVectorZ;\r\n\r\n        if (sqdist === 0 || (maxDistanceDelta >= 0 && sqdist <= maxDistanceDelta * maxDistanceDelta))\r\n        {\r\n            return target;\r\n        }\r\n        const dist = Math.sqrt(sqdist);\r\n\r\n        return new Vector3(current.x + toVectorX / dist * maxDistanceDelta,\r\n            current.y + toVectorY / dist * maxDistanceDelta,\r\n            current.z + toVectorZ / dist * maxDistanceDelta);\r\n    }\r\n\r\n    static SmoothDamp(current: Vector3, target: Vector3, currentVelocity: Vector3, smoothTime: number, maxSpeed: number)\r\n    {\r\n        const deltaTime = Time.deltaTime;\r\n\r\n        return Vector3.SmoothDamp2(current, target, currentVelocity, smoothTime, maxSpeed, deltaTime);\r\n    }\r\n\r\n    static SmoothDamp1(current: Vector3, target: Vector3, currentVelocity: Vector3, smoothTime: number)\r\n    {\r\n        const deltaTime = Time.deltaTime;\r\n        const maxSpeed = Mathf.Infinity;\r\n\r\n        return Vector3.SmoothDamp2(current, target, currentVelocity, smoothTime, maxSpeed, deltaTime);\r\n    }\r\n\r\n    // Gradually changes a vector towards a desired goal over time.\r\n    static SmoothDamp2(current: Vector3, target: Vector3, currentVelocity: Vector3, smoothTime: number, maxSpeed = Mathf.Infinity, deltaTime = Time.deltaTime)\r\n    {\r\n        let outputX = 0;\r\n        let outputY = 0;\r\n        let outputZ = 0;\r\n\r\n        // Based on Game Programming Gems 4 Chapter 1.10\r\n        smoothTime = Mathf.Max(0.0001, smoothTime);\r\n        const omega = 2 / smoothTime;\r\n\r\n        const x = omega * deltaTime;\r\n        const exp = 1 / (1 + x + 0.48 * x * x + 0.235 * x * x * x);\r\n\r\n        let changeX = current.x - target.x;\r\n        let changeY = current.y - target.y;\r\n        let changeZ = current.z - target.z;\r\n        const originalTo = target;\r\n\r\n        // Clamp maximum speed\r\n        const maxChange = maxSpeed * smoothTime;\r\n\r\n        const maxChangeSq = maxChange * maxChange;\r\n        const sqrmag = changeX * changeX + changeY * changeY + changeZ * changeZ;\r\n        if (sqrmag > maxChangeSq)\r\n        {\r\n            const mag = Math.sqrt(sqrmag);\r\n            changeX = changeX / mag * maxChange;\r\n            changeY = changeY / mag * maxChange;\r\n            changeZ = changeZ / mag * maxChange;\r\n        }\r\n\r\n        target.x = current.x - changeX;\r\n        target.y = current.y - changeY;\r\n        target.z = current.z - changeZ;\r\n\r\n        const tempX = (currentVelocity.x + omega * changeX) * deltaTime;\r\n        const tempY = (currentVelocity.y + omega * changeY) * deltaTime;\r\n        const tempZ = (currentVelocity.z + omega * changeZ) * deltaTime;\r\n\r\n        currentVelocity.x = (currentVelocity.x - omega * tempX) * exp;\r\n        currentVelocity.y = (currentVelocity.y - omega * tempY) * exp;\r\n        currentVelocity.z = (currentVelocity.z - omega * tempZ) * exp;\r\n\r\n        outputX = target.x + (changeX + tempX) * exp;\r\n        outputY = target.y + (changeY + tempY) * exp;\r\n        outputZ = target.z + (changeZ + tempZ) * exp;\r\n\r\n        // Prevent overshooting\r\n        const origMinusCurrentX = originalTo.x - current.x;\r\n        const origMinusCurrentY = originalTo.y - current.y;\r\n        const origMinusCurrentZ = originalTo.z - current.z;\r\n        const outMinusOrigX = outputX - originalTo.x;\r\n        const outMinusOrigY = outputY - originalTo.y;\r\n        const outMinusOrigZ = outputZ - originalTo.z;\r\n\r\n        if (origMinusCurrentX * outMinusOrigX + origMinusCurrentY * outMinusOrigY + origMinusCurrentZ * outMinusOrigZ > 0)\r\n        {\r\n            outputX = originalTo.x;\r\n            outputY = originalTo.y;\r\n            outputZ = originalTo.z;\r\n\r\n            currentVelocity.x = (outputX - originalTo.x) / deltaTime;\r\n            currentVelocity.y = (outputY - originalTo.y) / deltaTime;\r\n            currentVelocity.z = (outputZ - originalTo.z) / deltaTime;\r\n        }\r\n\r\n        return new Vector3(outputX, outputY, outputZ);\r\n    }\r\n\r\n    // Multiplies two vectors component-wise.\r\n    static Scale(a: Vector3, b: Vector3)\r\n    {\r\n        return new Vector3(a.x * b.x, a.y * b.y, a.z * b.z);\r\n    }\r\n\r\n    // Cross Product of two vectors.\r\n    static Cross(lhs: Vector3, rhs: Vector3)\r\n    {\r\n        return new Vector3(\r\n            lhs.y * rhs.z - lhs.z * rhs.y,\r\n            lhs.z * rhs.x - lhs.x * rhs.z,\r\n            lhs.x * rhs.y - lhs.y * rhs.x);\r\n    }\r\n\r\n    // Reflects a vector off the plane defined by a normal.\r\n    static Reflect(inDirection: Vector3, inNormal: Vector3)\r\n    {\r\n        const factor = -2 * Vector3.Dot(inNormal, inDirection);\r\n\r\n        return new Vector3(factor * inNormal.x + inDirection.x,\r\n            factor * inNormal.y + inDirection.y,\r\n            factor * inNormal.z + inDirection.z);\r\n    }\r\n\r\n    // *undoc* --- we have normalized property now\r\n    static Normalize(value: Vector3)\r\n    {\r\n        const mag = Vector3.Magnitude(value);\r\n        if (mag > Vector3.kEpsilon)\r\n        {\r\n            return new Vector3(value.x / mag, value.y / mag, value.z / mag);\r\n        }\r\n\r\n        return Vector3.zero.clone();\r\n    }\r\n\r\n    // Makes this vector have a ::ref::magnitude of 1.\r\n    Normalize()\r\n    {\r\n        const mag = Vector3.Magnitude(this);\r\n        if (mag > Vector3.kEpsilon)\r\n        {\r\n            this.x = this.x / mag;\r\n            this.y = this.y / mag;\r\n            this.z = this.z / mag;\r\n        }\r\n        else\r\n        {\r\n            this.x = 0;\r\n            this.y = 0;\r\n            this.z = 0;\r\n        }\r\n    }\r\n\r\n    // Returns this vector with a ::ref::magnitude of 1 (RO).\r\n    get normalized()\r\n    {\r\n        return Vector3.Normalize(this);\r\n    }\r\n\r\n    // Dot Product of two vectors.\r\n    static Dot(lhs: Vector3, rhs: Vector3)\r\n    {\r\n        return lhs.x * rhs.x + lhs.y * rhs.y + lhs.z * rhs.z;\r\n    }\r\n\r\n    // Projects a vector onto another vector.\r\n    static Project(vector: Vector3, onNormal: Vector3)\r\n    {\r\n        const sqrMag = Vector3.Dot(onNormal, onNormal);\r\n        if (sqrMag < Mathf.Epsilon)\r\n        {\r\n            return Vector3.zero;\r\n        }\r\n        const dot = Vector3.Dot(vector, onNormal);\r\n\r\n        return new Vector3(onNormal.x * dot / sqrMag,\r\n            onNormal.y * dot / sqrMag,\r\n            onNormal.z * dot / sqrMag);\r\n    }\r\n\r\n    // Projects a vector onto a plane defined by a normal orthogonal to the plane.\r\n    static ProjectOnPlane(vector: Vector3, planeNormal: Vector3)\r\n    {\r\n        const sqrMag = Vector3.Dot(planeNormal, planeNormal);\r\n        if (sqrMag < Mathf.Epsilon)\r\n        {\r\n            return vector;\r\n        }\r\n        const dot = Vector3.Dot(vector, planeNormal);\r\n\r\n        return new Vector3(vector.x - planeNormal.x * dot / sqrMag,\r\n            vector.y - planeNormal.y * dot / sqrMag,\r\n            vector.z - planeNormal.z * dot / sqrMag);\r\n    }\r\n\r\n    // Returns the angle in degrees between /from/ and /to/. This is always the smallest\r\n    static Angle(from: Vector3, to: Vector3)\r\n    {\r\n        // sqrt(a) * sqrt(b) = sqrt(a * b) -- valid for real numbers\r\n        const denominator = Math.sqrt(from.sqrMagnitude * to.sqrMagnitude);\r\n        if (denominator < Vector3.kEpsilonNormalSqrt)\r\n        {\r\n            return 0;\r\n        }\r\n\r\n        const dot = Mathf.Clamp(Vector3.Dot(from, to) / denominator, -1, 1);\r\n\r\n        return (Math.acos(dot)) * Mathf.Rad2Deg;\r\n    }\r\n\r\n    // The smaller of the two possible angles between the two vectors is returned, therefore the result will never be greater than 180 degrees or smaller than -180 degrees.\r\n    // If you imagine the from and to vectors as lines on a piece of paper, both originating from the same point, then the /axis/ vector would point up out of the paper.\r\n    // The measured angle between the two vectors would be positive in a clockwise direction and negative in an anti-clockwise direction.\r\n    static SignedAngle(from: Vector3, to: Vector3, axis: Vector3)\r\n    {\r\n        const unsignedAngle = Vector3.Angle(from, to);\r\n\r\n        const crossX = from.y * to.z - from.z * to.y;\r\n        const crossY = from.z * to.x - from.x * to.z;\r\n        const crossZ = from.x * to.y - from.y * to.x;\r\n        const sign = Mathf.Sign(axis.x * crossX + axis.y * crossY + axis.z * crossZ);\r\n\r\n        return unsignedAngle * sign;\r\n    }\r\n\r\n    // Returns the distance between /a/ and /b/.\r\n    static Distance(a: Vector3, b: Vector3)\r\n    {\r\n        const diffX = a.x - b.x;\r\n        const diffY = a.y - b.y;\r\n        const diffZ = a.z - b.z;\r\n\r\n        return Math.sqrt(diffX * diffX + diffY * diffY + diffZ * diffZ);\r\n    }\r\n\r\n    // Returns a copy of /vector/ with its magnitude clamped to /maxLength/.\r\n    static ClampMagnitude(vector: Vector3, maxLength: number)\r\n    {\r\n        const sqrmag = vector.sqrMagnitude;\r\n        if (sqrmag > maxLength * maxLength)\r\n        {\r\n            const mag = Math.sqrt(sqrmag);\r\n            // these intermediate variables force the intermediate result to be\r\n            // of float precision. without this, the intermediate result can be of higher\r\n            // precision, which changes behavior.\r\n            const normalizedX = vector.x / mag;\r\n            const normalizedY = vector.y / mag;\r\n            const normalizedZ = vector.z / mag;\r\n\r\n            return new Vector3(normalizedX * maxLength, normalizedY * maxLength, normalizedZ * maxLength);\r\n        }\r\n\r\n        return vector;\r\n    }\r\n\r\n    // *undoc* --- there's a property now\r\n    static Magnitude(vector: Vector3)\r\n    {\r\n        return Math.sqrt(vector.x * vector.x + vector.y * vector.y + vector.z * vector.z);\r\n    }\r\n\r\n    // Returns the length of this vector (RO).\r\n    get magnitude()\r\n    {\r\n        const { x, y, z } = this;\r\n\r\n        return Math.sqrt(x * x + y * y + z * z);\r\n    }\r\n\r\n    // *undoc* --- there's a property now\r\n    static SqrMagnitude(vector: Vector3)\r\n    {\r\n        return vector.x * vector.x + vector.y * vector.y + vector.z * vector.z;\r\n    }\r\n\r\n    // Returns the squared length of this vector (RO).\r\n    get sqrMagnitude()\r\n    {\r\n        const { x, y, z } = this;\r\n\r\n        return x * x + y * y + z * z;\r\n    }\r\n\r\n    // Returns a vector that is made from the smallest components of two vectors.\r\n    static Min(lhs: Vector3, rhs: Vector3)\r\n    {\r\n        return new Vector3(Mathf.Min(lhs.x, rhs.x), Mathf.Min(lhs.y, rhs.y), Mathf.Min(lhs.z, rhs.z));\r\n    }\r\n\r\n    // Returns a vector that is made from the largest components of two vectors.\r\n    static Max(lhs: Vector3, rhs: Vector3)\r\n    {\r\n        return new Vector3(Mathf.Max(lhs.x, rhs.x), Mathf.Max(lhs.y, rhs.y), Mathf.Max(lhs.z, rhs.z));\r\n    }\r\n\r\n    static readonly zero = Object.freeze(new Vector3(0, 0, 0));\r\n    static readonly one = Object.freeze(new Vector3(1, 1, 1));\r\n    static readonly up = Object.freeze(new Vector3(0, 1, 0));\r\n    static readonly down = Object.freeze(new Vector3(0, -1, 0));\r\n    static readonly left = Object.freeze(new Vector3(-1, 0, 0));\r\n    static readonly right = Object.freeze(new Vector3(1, 0, 0));\r\n    static readonly forward = Object.freeze(new Vector3(0, 0, 1));\r\n    static readonly back = Object.freeze(new Vector3(0, 0, -1));\r\n    static readonly positiveInfinity = Object.freeze(new Vector3(Infinity, Infinity, Infinity));\r\n    static readonly negativeInfinity = Object.freeze(new Vector3(-Infinity, -Infinity, -Infinity));\r\n}\r\n","import { oav } from '@feng3d/objectview';\r\nimport { mathUtil } from '@feng3d/polyfill';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport type { Color4 } from './Color4';\r\nimport { Vector3 } from './geom/Vector3';\r\n\r\ndeclare global\r\n{\r\n    interface MixinsColor3\r\n    {\r\n\r\n    }\r\n}\r\n\r\nexport interface Color3 extends MixinsColor3 { }\r\n\r\n/**\r\n * 颜色\r\n */\r\nexport class Color3\r\n{\r\n    __class__: 'feng3d.Color3';\r\n\r\n    static WHITE = new Color3();\r\n    static BLACK = new Color3(0, 0, 0);\r\n\r\n    static fromUnit(color: number)\r\n    {\r\n        return new Color3().fromUnit(color);\r\n    }\r\n\r\n    static fromColor4(color4: Color4)\r\n    {\r\n        return new Color3(color4.r, color4.g, color4.b);\r\n    }\r\n\r\n    /**\r\n     * 红[0,1]\r\n     */\r\n    @oav()\r\n    @serialize\r\n    r = 1;\r\n\r\n    /**\r\n     * 绿[0,1]\r\n     */\r\n    @oav()\r\n    @serialize\r\n    g = 1;\r\n\r\n    /**\r\n     * 蓝[0,1]\r\n     */\r\n    @oav()\r\n    @serialize\r\n    b = 1;\r\n\r\n    /**\r\n     * 构建颜色\r\n     * @param r 红[0,1]\r\n     * @param g 绿[0,1]\r\n     * @param b 蓝[0,1]\r\n     */\r\n    constructor(r = 1, g = 1, b = 1)\r\n    {\r\n        this.r = r;\r\n        this.g = g;\r\n        this.b = b;\r\n    }\r\n\r\n    setTo(r: number, g: number, b: number)\r\n    {\r\n        this.r = r;\r\n        this.g = g;\r\n        this.b = b;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 通过\r\n     * @param color\r\n     */\r\n    fromUnit(color: number)\r\n    {\r\n        this.r = ((color >> 16) & 0xff) / 0xff;\r\n        this.g = ((color >> 8) & 0xff) / 0xff;\r\n        this.b = (color & 0xff) / 0xff;\r\n\r\n        return this;\r\n    }\r\n\r\n    toInt()\r\n    {\r\n        const value = ((this.r * 0xff) << 16) + ((this.g * 0xff) << 8) + (this.b * 0xff);\r\n\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * 输出16进制字符串\r\n     */\r\n    toHexString(): string\r\n    {\r\n        const intR = (this.r * 0xff) | 0;\r\n        const intG = (this.g * 0xff) | 0;\r\n        const intB = (this.b * 0xff) | 0;\r\n\r\n        return `#${Color3.ToHex(intR)}${Color3.ToHex(intG)}${Color3.ToHex(intB)}`;\r\n    }\r\n\r\n    /**\r\n     * 混合颜色\r\n     * @param color 混入的颜色\r\n     * @param rate 混入比例\r\n     */\r\n    mix(color: Color3, rate: number)\r\n    {\r\n        this.r = this.r * (1 - rate) + color.r * rate;\r\n        this.g = this.g * (1 - rate) + color.g * rate;\r\n        this.b = this.b * (1 - rate) + color.b * rate;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 混合颜色\r\n     * @param color 混入的颜色\r\n     * @param rate 混入比例\r\n     */\r\n    mixTo(color: Color3, rate: number, vout = new Color3())\r\n    {\r\n        return vout.copy(this).mix(color, rate);\r\n    }\r\n\r\n    /**\r\n     * 按标量（大小）缩放当前的 Color3 对象。\r\n     */\r\n    scale(s: number)\r\n    {\r\n        this.r *= s;\r\n        this.g *= s;\r\n        this.b *= s;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 按标量（大小）缩放当前的 Color3 对象。\r\n     */\r\n    scaleTo(s: number, vout = new Color3())\r\n    {\r\n        return vout.copy(this).scale(s);\r\n    }\r\n\r\n    /**\r\n     * 通过将当前 Color3 对象的 r、g 和 b 元素与指定的 Color3 对象的 r、g 和 b 元素进行比较，确定这两个对象是否相等。\r\n     */\r\n    equals(object: Color3, precision = mathUtil.PRECISION)\r\n    {\r\n        if (!mathUtil.equals(this.r - object.r, 0, precision))\r\n        { return false; }\r\n        if (!mathUtil.equals(this.g - object.g, 0, precision))\r\n        { return false; }\r\n        if (!mathUtil.equals(this.b - object.b, 0, precision))\r\n        { return false; }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 拷贝\r\n     */\r\n    copy(color: Color3)\r\n    {\r\n        this.r = color.r;\r\n        this.g = color.g;\r\n        this.b = color.b;\r\n\r\n        return this;\r\n    }\r\n\r\n    clone()\r\n    {\r\n        return new Color3(this.r, this.g, this.b);\r\n    }\r\n\r\n    toVector3(vector3 = new Vector3())\r\n    {\r\n        vector3.x = this.r;\r\n        vector3.y = this.g;\r\n        vector3.z = this.b;\r\n\r\n        return vector3;\r\n    }\r\n\r\n    /**\r\n     * 输出字符串\r\n     */\r\n    toString(): string\r\n    {\r\n        return `{R: ${this.r} G:${this.g} B:${this.b}}`;\r\n    }\r\n\r\n    /**\r\n     * 转换为数组\r\n     * @param array 数组\r\n     * @param offset 偏移\r\n     */\r\n    toArray(array: number[] = [], offset = 0)\r\n    {\r\n        array[offset] = this.r;\r\n        array[offset + 1] = this.g;\r\n        array[offset + 2] = this.b;\r\n\r\n        return array;\r\n    }\r\n\r\n    /**\r\n     * [0,15]数值转为16进制字符串\r\n     * param i  [0,15]数值\r\n     */\r\n    static ToHex(i: number): string\r\n    {\r\n        const str = i.toString(16);\r\n\r\n        if (i <= 0xf)\r\n        {\r\n            return (`0${str}`).toUpperCase();\r\n        }\r\n\r\n        return str.toUpperCase();\r\n    }\r\n}\r\n\r\nexport const ColorKeywords = {\r\n    aliceblue: 0xF0F8FF, antiquewhite: 0xFAEBD7, aqua: 0x00FFFF, aquamarine: 0x7FFFD4, azure: 0xF0FFFF,\r\n    beige: 0xF5F5DC, bisque: 0xFFE4C4, black: 0x000000, blanchedalmond: 0xFFEBCD, blue: 0x0000FF, blueviolet: 0x8A2BE2,\r\n    brown: 0xA52A2A, burlywood: 0xDEB887, cadetblue: 0x5F9EA0, chartreuse: 0x7FFF00, chocolate: 0xD2691E, coral: 0xFF7F50,\r\n    cornflowerblue: 0x6495ED, cornsilk: 0xFFF8DC, crimson: 0xDC143C, cyan: 0x00FFFF, darkblue: 0x00008B, darkcyan: 0x008B8B,\r\n    darkgoldenrod: 0xB8860B, darkgray: 0xA9A9A9, darkgreen: 0x006400, darkgrey: 0xA9A9A9, darkkhaki: 0xBDB76B, darkmagenta: 0x8B008B,\r\n    darkolivegreen: 0x556B2F, darkorange: 0xFF8C00, darkorchid: 0x9932CC, darkred: 0x8B0000, darksalmon: 0xE9967A, darkseagreen: 0x8FBC8F,\r\n    darkslateblue: 0x483D8B, darkslategray: 0x2F4F4F, darkslategrey: 0x2F4F4F, darkturquoise: 0x00CED1, darkviolet: 0x9400D3,\r\n    deeppink: 0xFF1493, deepskyblue: 0x00BFFF, dimgray: 0x696969, dimgrey: 0x696969, dodgerblue: 0x1E90FF, firebrick: 0xB22222,\r\n    floralwhite: 0xFFFAF0, forestgreen: 0x228B22, fuchsia: 0xFF00FF, gainsboro: 0xDCDCDC, ghostwhite: 0xF8F8FF, gold: 0xFFD700,\r\n    goldenrod: 0xDAA520, gray: 0x808080, green: 0x008000, greenyellow: 0xADFF2F, grey: 0x808080, honeydew: 0xF0FFF0, hotpink: 0xFF69B4,\r\n    indianred: 0xCD5C5C, indigo: 0x4B0082, ivory: 0xFFFFF0, khaki: 0xF0E68C, lavender: 0xE6E6FA, lavenderblush: 0xFFF0F5, lawngreen: 0x7CFC00,\r\n    lemonchiffon: 0xFFFACD, lightblue: 0xADD8E6, lightcoral: 0xF08080, lightcyan: 0xE0FFFF, lightgoldenrodyellow: 0xFAFAD2, lightgray: 0xD3D3D3,\r\n    lightgreen: 0x90EE90, lightgrey: 0xD3D3D3, lightpink: 0xFFB6C1, lightsalmon: 0xFFA07A, lightseagreen: 0x20B2AA, lightskyblue: 0x87CEFA,\r\n    lightslategray: 0x778899, lightslategrey: 0x778899, lightsteelblue: 0xB0C4DE, lightyellow: 0xFFFFE0, lime: 0x00FF00, limegreen: 0x32CD32,\r\n    linen: 0xFAF0E6, magenta: 0xFF00FF, maroon: 0x800000, mediumaquamarine: 0x66CDAA, mediumblue: 0x0000CD, mediumorchid: 0xBA55D3,\r\n    mediumpurple: 0x9370DB, mediumseagreen: 0x3CB371, mediumslateblue: 0x7B68EE, mediumspringgreen: 0x00FA9A, mediumturquoise: 0x48D1CC,\r\n    mediumvioletred: 0xC71585, midnightblue: 0x191970, mintcream: 0xF5FFFA, mistyrose: 0xFFE4E1, moccasin: 0xFFE4B5, navajowhite: 0xFFDEAD,\r\n    navy: 0x000080, oldlace: 0xFDF5E6, olive: 0x808000, olivedrab: 0x6B8E23, orange: 0xFFA500, orangered: 0xFF4500, orchid: 0xDA70D6,\r\n    palegoldenrod: 0xEEE8AA, palegreen: 0x98FB98, paleturquoise: 0xAFEEEE, palevioletred: 0xDB7093, papayawhip: 0xFFEFD5, peachpuff: 0xFFDAB9,\r\n    peru: 0xCD853F, pink: 0xFFC0CB, plum: 0xDDA0DD, powderblue: 0xB0E0E6, purple: 0x800080, rebeccapurple: 0x663399, red: 0xFF0000, rosybrown: 0xBC8F8F,\r\n    royalblue: 0x4169E1, saddlebrown: 0x8B4513, salmon: 0xFA8072, sandybrown: 0xF4A460, seagreen: 0x2E8B57, seashell: 0xFFF5EE,\r\n    sienna: 0xA0522D, silver: 0xC0C0C0, skyblue: 0x87CEEB, slateblue: 0x6A5ACD, slategray: 0x708090, slategrey: 0x708090, snow: 0xFFFAFA,\r\n    springgreen: 0x00FF7F, steelblue: 0x4682B4, tan: 0xD2B48C, teal: 0x008080, thistle: 0xD8BFD8, tomato: 0xFF6347, turquoise: 0x40E0D0,\r\n    violet: 0xEE82EE, wheat: 0xF5DEB3, white: 0xFFFFFF, whitesmoke: 0xF5F5F5, yellow: 0xFFFF00, yellowgreen: 0x9ACD32\r\n};\r\n\r\n","import { oav } from '@feng3d/objectview';\r\nimport { mathUtil } from '@feng3d/polyfill';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { Mathf } from '../MathF';\r\nimport { Matrix4x4 } from './Matrix4x4';\r\nimport { Vector3 } from './Vector3';\r\n\r\n/**\r\n * 四维向量\r\n */\r\nexport class Vector4\r\n{\r\n    __class__: 'feng3d.Vector4';\r\n\r\n    static fromArray(array: ArrayLike<number>, offset = 0)\r\n    {\r\n        return new Vector4().fromArray(array, offset);\r\n    }\r\n\r\n    static fromVector3(vector3: Vector3, w = 0)\r\n    {\r\n        return new Vector4().fromVector3(vector3, w);\r\n    }\r\n\r\n    static random()\r\n    {\r\n        return new Vector4(Math.random(), Math.random(), Math.random(), Math.random());\r\n    }\r\n\r\n    /**\r\n    * Vector4 对象中的第一个元素。默认值为 0\r\n    */\r\n    @serialize\r\n    @oav()\r\n    x = 0;\r\n\r\n    /**\r\n     * Vector4 对象中的第二个元素。默认值为 0\r\n     */\r\n    @serialize\r\n    @oav()\r\n    y = 0;\r\n\r\n    /**\r\n     * Vector4 对象中的第三个元素。默认值为 0\r\n     */\r\n    @serialize\r\n    @oav()\r\n    z = 0;\r\n\r\n    /**\r\n     * Vector4 对象的第四个元素。默认值为 0\r\n     */\r\n    @serialize\r\n    @oav()\r\n    w = 0;\r\n\r\n    /**\r\n     * 创建 Vector4 对象的实例。如果未指定构造函数的参数，则将使用元素 (0,0,0,0) 创建 Vector4 对象。\r\n     * @param x 第一个元素\r\n     * @param y 第二个元素\r\n     * @param z 第三个元素\r\n     * @param w 第四个元素\r\n     */\r\n    constructor(x = 0, y = 0, z = 0, w = 0)\r\n    {\r\n        this.set(x, y, z, w);\r\n    }\r\n\r\n    /**\r\n     * 初始化向量\r\n     * @param x 第一个元素\r\n     * @param y 第二个元素\r\n     * @param z 第三个元素\r\n     * @param w 第四个元素\r\n     * @returns 返回自身\r\n     */\r\n    set(x: number, y: number, z = 0, w = 0)\r\n    {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n        this.w = w;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 从数组初始化\r\n     * @param array 提供数据的数组\r\n     * @param offset 数组中起始位置\r\n     * @returns 返回自身\r\n     */\r\n    fromArray(array: ArrayLike<number>, offset = 0)\r\n    {\r\n        this.x = array[offset];\r\n        this.y = array[offset + 1];\r\n        this.z = array[offset + 2];\r\n        this.w = array[offset + 3];\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 从三维向量初始化\r\n     * @param vector3 三维向量\r\n     * @param w 向量第四个值\r\n     * @returns 返回自身\r\n     */\r\n    fromVector3(vector3: Vector3, w = 0)\r\n    {\r\n        this.x = vector3.x;\r\n        this.y = vector3.y;\r\n        this.z = vector3.z;\r\n        this.w = w;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 转换为三维向量\r\n     * @param v3 三维向量\r\n     */\r\n    toVector3(v3 = new Vector3())\r\n    {\r\n        v3.set(this.x, this.y, this.z);\r\n\r\n        return v3;\r\n    }\r\n\r\n    /**\r\n     * 转换为数组\r\n     * @param array 数组\r\n     * @param offset 偏移\r\n     */\r\n    toArray(array: number[] = [], offset = 0)\r\n    {\r\n        array[offset] = this.x;\r\n        array[offset + 1] = this.y;\r\n        array[offset + 2] = this.z;\r\n        array[offset + 3] = this.w;\r\n\r\n        return array;\r\n    }\r\n\r\n    /**\r\n     * 加上指定向量得到新向量\r\n     * @param v 加向量\r\n     * @returns 返回新向量\r\n     */\r\n    add(v: Vector4)\r\n    {\r\n        this.x += v.x;\r\n        this.y += v.y;\r\n        this.z += v.z;\r\n        this.w += v.w;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 加上指定向量得到新向量\r\n     * @param v 加向量\r\n     * @returns 返回新向量\r\n     */\r\n    addTo(v: Vector4, vout = new Vector4())\r\n    {\r\n        return vout.copy(this).add(v);\r\n    }\r\n\r\n    /**\r\n     * 克隆一个向量\r\n     * @returns 返回一个拷贝向量\r\n     */\r\n    clone()\r\n    {\r\n        return new Vector4(this.x, this.y, this.z, this.w);\r\n    }\r\n\r\n    /**\r\n     * 从指定向量拷贝数据\r\n     * @param v 被拷贝向量\r\n     * @returns 返回自身\r\n     */\r\n    copy(v: Vector4)\r\n    {\r\n        this.x = v.x;\r\n        this.y = v.y;\r\n        this.z = v.z;\r\n        this.w = v.w;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 减去指定向量\r\n     * @param v 减去的向量\r\n     * @returns 返回自身\r\n     */\r\n    sub(v: Vector4)\r\n    {\r\n        this.x -= v.x;\r\n        this.y -= v.y;\r\n        this.z -= v.z;\r\n        this.w -= v.w;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 减去指定向量\r\n     * @param v 减去的向量\r\n     * @returns 返回新向量\r\n     */\r\n    subTo(v: Vector4, vout = new Vector4())\r\n    {\r\n        return vout.copy(this).sub(v);\r\n    }\r\n\r\n    /**\r\n     * 乘以指定向量\r\n     * @param v 乘以的向量\r\n     * @returns 返回自身\r\n     */\r\n    multiply(v: Vector4)\r\n    {\r\n        this.x *= v.x;\r\n        this.y *= v.y;\r\n        this.z *= v.z;\r\n        this.w *= v.w;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 乘以指定向量\r\n     * @param v 乘以的向量\r\n     * @returns 返回新向量\r\n     */\r\n    multiplyTo(v: Vector4, vout = new Vector4())\r\n    {\r\n        return vout.copy(this).multiply(v);\r\n    }\r\n\r\n    /**\r\n     * 除以指定向量\r\n     * @param v 除以的向量\r\n     * @returns 返回自身\r\n     */\r\n    div(v: Vector4)\r\n    {\r\n        this.x /= v.x;\r\n        this.y /= v.y;\r\n        this.z /= v.z;\r\n        this.w /= v.w;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 除以指定向量\r\n     * @param v 除以的向量\r\n     * @returns 返回新向量\r\n     */\r\n    divTo(v: Vector4, vout = new Vector4())\r\n    {\r\n        return vout.copy(this).div(v);\r\n    }\r\n\r\n    /**\r\n     * 与指定向量比较是否相等\r\n     * @param v 比较的向量\r\n     * @param precision 允许误差\r\n     * @returns 相等返回true，否则false\r\n     */\r\n    equals(v: Vector4, precision = mathUtil.PRECISION)\r\n    {\r\n        if (!mathUtil.equals(this.x - v.x, 0, precision))\r\n        { return false; }\r\n        if (!mathUtil.equals(this.y - v.y, 0, precision))\r\n        { return false; }\r\n        if (!mathUtil.equals(this.z - v.z, 0, precision))\r\n        { return false; }\r\n        if (!mathUtil.equals(this.w - v.w, 0, precision))\r\n        { return false; }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 负向量\r\n     * @returns 返回自身\r\n     */\r\n    negate()\r\n    {\r\n        this.x = -this.x;\r\n        this.y = -this.y;\r\n        this.z = -this.z;\r\n        this.w = -this.w;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 负向量\r\n     * @returns 返回新向量\r\n     */\r\n    negateTo(vout = new Vector4())\r\n    {\r\n        return vout.copy(this).negate();\r\n    }\r\n\r\n    /**\r\n     * 缩放指定系数\r\n     * @param s 缩放系数\r\n     * @returns 返回自身\r\n     */\r\n    scale(s: number)\r\n    {\r\n        this.x *= s;\r\n        this.y *= s;\r\n        this.z *= s;\r\n        this.w *= s;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 缩放指定系数\r\n     * @param s 缩放系数\r\n     * @returns 返回新向量\r\n     */\r\n    scaleTo(s: number)\r\n    {\r\n        return this.clone().scale(s);\r\n    }\r\n\r\n    /**\r\n     * 如果当前 Vector4 对象和作为参数指定的 Vector4 对象均为单位顶点，此方法将返回这两个顶点之间所成角的余弦值。\r\n     */\r\n    dot(a: Vector4)\r\n    {\r\n        return (this.x * a.x) + (this.y * a.y) + (this.z * a.z) + (this.w * a.w);\r\n    }\r\n\r\n    /**\r\n     * 获取到指定向量的插值\r\n     * @param v 终点插值向量\r\n     * @param alpha 插值系数\r\n     * @returns 返回自身\r\n     */\r\n    lerp(v: Vector4, alpha: number)\r\n    {\r\n        this.x += (v.x - this.x) * alpha;\r\n        this.y += (v.y - this.y) * alpha;\r\n        this.z += (v.z - this.z) * alpha;\r\n        this.w += (v.w - this.w) * alpha;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 获取到指定向量的插值\r\n     * @param v 终点插值向量\r\n     * @param alpha 插值系数\r\n     * @returns 返回新向量\r\n     */\r\n    lerpTo(v: Vector4, alpha: number, vout = new Vector4())\r\n    {\r\n        return vout.copy(this).lerp(v, alpha);\r\n    }\r\n\r\n    /**\r\n     * 应用矩阵\r\n     * @param mat 矩阵\r\n     */\r\n    applyMatrix4x4(mat: Matrix4x4)\r\n    {\r\n        mat.transformVector4(this, this);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 返回当前 Vector4 对象的字符串表示形式。\r\n     */\r\n    toString(): string\r\n    {\r\n        return `<${this.x}, ${this.y}, ${this.z}, ${this.w}>`;\r\n    }\r\n\r\n    // Linearly interpolates between two vectors.\r\n    static Lerp(a: Vector4, b: Vector4, t: number)\r\n    {\r\n        t = Mathf.Clamp01(t);\r\n\r\n        return new Vector4(\r\n            a.x + (b.x - a.x) * t,\r\n            a.y + (b.y - a.y) * t,\r\n            a.z + (b.z - a.z) * t,\r\n            a.w + (b.w - a.w) * t\r\n        );\r\n    }\r\n\r\n    // Linearly interpolates between two vectors without clamping the interpolant\r\n    static LerpUnclamped(a: Vector4, b: Vector4, t: number)\r\n    {\r\n        return new Vector4(\r\n            a.x + (b.x - a.x) * t,\r\n            a.y + (b.y - a.y) * t,\r\n            a.z + (b.z - a.z) * t,\r\n            a.w + (b.w - a.w) * t\r\n        );\r\n    }\r\n\r\n    // Moves a point /current/ towards /target/.\r\n    static MoveTowards(current: Vector4, target: Vector4, maxDistanceDelta: number)\r\n    {\r\n        const toVectorX = target.x - current.x;\r\n        const toVectorY = target.y - current.y;\r\n        const toVectorZ = target.z - current.z;\r\n        const toVectorW = target.w - current.w;\r\n\r\n        const sqdist = (toVectorX * toVectorX + toVectorY * toVectorY + toVectorZ * toVectorZ + toVectorW * toVectorW);\r\n\r\n        if (sqdist === 0 || (maxDistanceDelta >= 0 && sqdist <= maxDistanceDelta * maxDistanceDelta))\r\n        {\r\n            return target;\r\n        }\r\n\r\n        const dist = Math.sqrt(sqdist);\r\n\r\n        return new Vector4(current.x + toVectorX / dist * maxDistanceDelta,\r\n            current.y + toVectorY / dist * maxDistanceDelta,\r\n            current.z + toVectorZ / dist * maxDistanceDelta,\r\n            current.w + toVectorW / dist * maxDistanceDelta);\r\n    }\r\n\r\n    // Multiplies two vectors component-wise.\r\n    static Scale(a: Vector4, b: Vector4)\r\n    {\r\n        return new Vector4(a.x * b.x, a.y * b.y, a.z * b.z, a.w * b.w);\r\n    }\r\n\r\n    // Multiplies every component of this vector by the same component of /scale/.\r\n    Scale(scale: Vector4)\r\n    {\r\n        this.x *= scale.x;\r\n        this.y *= scale.y;\r\n        this.z *= scale.z;\r\n        this.w *= scale.w;\r\n    }\r\n\r\n    // also required for being able to use Vector4s as keys in hash tables\r\n    Equals(other: Vector4)\r\n    {\r\n        return this.x === other.x && this.y === other.y && this.z === other.z && this.w === other.w;\r\n    }\r\n\r\n    // *undoc* --- we have normalized property now\r\n    static Normalize(a: Vector4)\r\n    {\r\n        const mag = Vector4.Magnitude(a);\r\n        if (mag > Vector4.kEpsilon)\r\n        {\r\n            return new Vector4(a.x / mag, a.y / mag, a.z / mag, a.w / mag);\r\n        }\r\n\r\n        return Vector4.zero.clone();\r\n    }\r\n\r\n    // Makes this vector have a ::ref::magnitude of 1.\r\n    Normalize()\r\n    {\r\n        const mag = Vector4.Magnitude(this);\r\n        if (mag > Vector4.kEpsilon)\r\n        {\r\n            this.x = this.x / mag;\r\n            this.y = this.y / mag;\r\n            this.z = this.z / mag;\r\n        }\r\n        else\r\n        {\r\n            this.x = 0;\r\n            this.y = 0;\r\n            this.z = 0;\r\n        }\r\n    }\r\n\r\n    // Returns this vector with a ::ref::magnitude of 1 (RO).\r\n    get normalized()\r\n    {\r\n        return Vector4.Normalize(this);\r\n    }\r\n\r\n    // Dot Product of two vectors.\r\n    static Dot(a: Vector4, b: Vector4)\r\n    {\r\n        return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;\r\n    }\r\n\r\n    // Projects a vector onto another vector.\r\n    static Project(a: Vector4, b: Vector4)\r\n    {\r\n        const scale = (Vector4.Dot(a, b) / Vector4.Dot(b, b));\r\n\r\n        return new Vector4(b.x * scale, b.y * scale, b.z * scale, b.w * scale);\r\n    }\r\n\r\n    // Returns the distance between /a/ and /b/.\r\n    static Distance(a: Vector4, b: Vector4)\r\n    {\r\n        return Vector4.Magnitude(a.clone().sub(b));\r\n    }\r\n\r\n    // *undoc* --- there's a property now\r\n    static Magnitude(a: Vector4)\r\n    {\r\n        return Math.sqrt(Vector4.Dot(a, a));\r\n    }\r\n\r\n    // Returns the length of this vector (RO).\r\n    get magnitude()\r\n    {\r\n        return Math.sqrt(Vector4.Dot(this, this));\r\n    }\r\n\r\n    // Returns the squared length of this vector (RO).\r\n    get sqrMagnitude()\r\n    {\r\n        return Vector4.Dot(this, this);\r\n    }\r\n\r\n    // Returns a vector that is made from the smallest components of two vectors.\r\n    static Min(lhs: Vector4, rhs: Vector4)\r\n    {\r\n        return new Vector4(Mathf.Min(lhs.x, rhs.x), Mathf.Min(lhs.y, rhs.y), Mathf.Min(lhs.z, rhs.z), Mathf.Min(lhs.w, rhs.w));\r\n    }\r\n\r\n    // Returns a vector that is made from the largest components of two vectors.\r\n    public static Max(lhs: Vector4, rhs: Vector4)\r\n    {\r\n        return new Vector4(Mathf.Max(lhs.x, rhs.x), Mathf.Max(lhs.y, rhs.y), Mathf.Max(lhs.z, rhs.z), Mathf.Max(lhs.w, rhs.w));\r\n    }\r\n\r\n    // Shorthand for writing @@Vector4(0,0,0,0)@@\r\n    static readonly zero = Object.freeze(new Vector4(0, 0, 0, 0));\r\n    // Shorthand for writing @@Vector4(1,1,1,1)@@\r\n    static readonly one = Object.freeze(new Vector4(1, 1, 1, 1));\r\n    // Shorthand for writing @@Vector3(float.PositiveInfinity, float.PositiveInfinity, float.PositiveInfinity)@@\r\n    static readonly positiveInfinity = Object.freeze(new Vector4(Infinity, Infinity, Infinity, Infinity));\r\n    // Shorthand for writing @@Vector3(float.NegativeInfinity, float.NegativeInfinity, float.NegativeInfinity)@@\r\n    static readonly negativeInfinity = Object.freeze(new Vector4(-Infinity, -Infinity, -Infinity, -Infinity));\r\n\r\n    // *undocumented*\r\n    static readonly kEpsilon = 0.00001;\r\n}\r\n","import { oav } from '@feng3d/objectview';\r\nimport { mathUtil } from '@feng3d/polyfill';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { Color3 } from './Color3';\r\nimport { Vector4 } from './geom/Vector4';\r\n\r\ndeclare global\r\n{\r\n    interface MixinsColor3\r\n    {\r\n        toColor4(color4?: Color4): Color4\r\n    }\r\n}\r\n\r\nColor3.prototype.toColor4 = function toColor4(color4 = new Color4())\r\n{\r\n    color4.r = this.r;\r\n    color4.g = this.g;\r\n    color4.b = this.b;\r\n\r\n    return color4;\r\n};\r\n\r\n/**\r\n * 颜色（包含透明度）\r\n */\r\nexport class Color4\r\n{\r\n    __class__: 'feng3d.Color4';\r\n\r\n    static readonly WHITE = Object.freeze(new Color4(1, 1, 1, 1));\r\n    static readonly BLACK = Object.freeze(new Color4(0, 0, 0, 1));\r\n\r\n    static fromUnit(color: number)\r\n    {\r\n        return new Color4().fromUnit(color);\r\n    }\r\n\r\n    static fromUnit24(color: number, a = 1)\r\n    {\r\n        return Color4.fromColor3(Color3.fromUnit(color), a);\r\n    }\r\n\r\n    static fromColor3(color3: Color3, a = 1)\r\n    {\r\n        return new Color4(color3.r, color3.g, color3.b, a);\r\n    }\r\n\r\n    /**\r\n     * 红[0,1]\r\n     */\r\n    @oav()\r\n    @serialize\r\n    r = 1;\r\n    /**\r\n     * 绿[0,1]\r\n     */\r\n    @oav()\r\n    @serialize\r\n    g = 1;\r\n    /**\r\n     * 蓝[0,1]\r\n     */\r\n    @oav()\r\n    @serialize\r\n    b = 1;\r\n    /**\r\n     * 透明度[0,1]\r\n     */\r\n    @oav()\r\n    @serialize\r\n    a = 1;\r\n\r\n    /**\r\n     * 构建颜色\r\n     * @param r 红[0,1]\r\n     * @param g 绿[0,1]\r\n     * @param b 蓝[0,1]\r\n     * @param a 透明度[0,1]\r\n     */\r\n    constructor(r = 1, g = 1, b = 1, a = 1)\r\n    {\r\n        this.r = r;\r\n        this.g = g;\r\n        this.b = b;\r\n        this.a = a;\r\n    }\r\n\r\n    setTo(r: number, g: number, b: number, a = 1)\r\n    {\r\n        this.r = r;\r\n        this.g = g;\r\n        this.b = b;\r\n        this.a = a;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 通过\r\n     * @param color\r\n     */\r\n    fromUnit(color: number)\r\n    {\r\n        this.a = ((color >> 24) & 0xff) / 0xff;\r\n        this.r = ((color >> 16) & 0xff) / 0xff;\r\n        this.g = ((color >> 8) & 0xff) / 0xff;\r\n        this.b = (color & 0xff) / 0xff;\r\n\r\n        return this;\r\n    }\r\n\r\n    fromUnit24(color: number, a = 1)\r\n    {\r\n        this.fromUnit(color);\r\n        this.a = a;\r\n\r\n        return this;\r\n    }\r\n\r\n    fromColor3(color3: Color3, a = 1)\r\n    {\r\n        this.r = color3.r;\r\n        this.g = color3.g;\r\n        this.b = color3.b;\r\n        this.a = a;\r\n\r\n        return this;\r\n    }\r\n\r\n    toInt()\r\n    {\r\n        const value = ((this.a * 0xff) << 24) + ((this.r * 0xff) << 16) + ((this.g * 0xff) << 8) + (this.b * 0xff);\r\n\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * 输出16进制字符串\r\n     */\r\n    toHexString()\r\n    {\r\n        const intR = (this.r * 0xff) | 0;\r\n        const intG = (this.g * 0xff) | 0;\r\n        const intB = (this.b * 0xff) | 0;\r\n        const intA = (this.a * 0xff) | 0;\r\n\r\n        return `#${Color3.ToHex(intA)}${Color3.ToHex(intR)}${Color3.ToHex(intG)}${Color3.ToHex(intB)}`;\r\n    }\r\n\r\n    /**\r\n     * 输出 RGBA 颜色值，例如 rgba(255,255,255,1)\r\n     */\r\n    toRGBA()\r\n    {\r\n        return `rgba(${this.r * 255},${this.g * 255},${this.b * 255},${this.a})`;\r\n    }\r\n\r\n    /**\r\n     * 混合颜色\r\n     * @param color 混入的颜色\r\n     * @param rate 混入比例\r\n     */\r\n    mix(color: Color4, rate = 0.5)\r\n    {\r\n        this.r = this.r * (1 - rate) + color.r * rate;\r\n        this.g = this.g * (1 - rate) + color.g * rate;\r\n        this.b = this.b * (1 - rate) + color.b * rate;\r\n        this.a = this.a * (1 - rate) + color.a * rate;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 混合颜色\r\n     * @param color 混入的颜色\r\n     * @param rate 混入比例\r\n     */\r\n    mixTo(color: Color4, rate: number, vout = new Color4())\r\n    {\r\n        return vout.copy(this).mix(color, rate);\r\n    }\r\n\r\n    /**\r\n     * 乘以指定颜色\r\n     * @param c 乘以的颜色\r\n     * @returns 返回自身\r\n     */\r\n    multiply(c: Color4)\r\n    {\r\n        this.r *= c.r;\r\n        this.g *= c.g;\r\n        this.b *= c.b;\r\n        this.a *= c.a;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 乘以指定颜色\r\n     * @param v 乘以的颜色\r\n     * @returns 返回新颜色\r\n     */\r\n    multiplyTo(v: Color4, vout = new Color4())\r\n    {\r\n        return vout.copy(this).multiply(v);\r\n    }\r\n\r\n    /**\r\n     * 乘以指定常量\r\n     *\r\n     * @param scale 缩放常量\r\n     * @returns 返回自身\r\n     */\r\n    multiplyNumber(scale: number)\r\n    {\r\n        this.r *= scale;\r\n        this.g *= scale;\r\n        this.b *= scale;\r\n        this.a *= scale;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 通过将当前 Color3 对象的 r、g 和 b 元素与指定的 Color3 对象的 r、g 和 b 元素进行比较，确定这两个对象是否相等。\r\n     */\r\n    equals(object: Color4, precision = mathUtil.PRECISION)\r\n    {\r\n        if (!mathUtil.equals(this.r - object.r, 0, precision))\r\n        { return false; }\r\n        if (!mathUtil.equals(this.g - object.g, 0, precision))\r\n        { return false; }\r\n        if (!mathUtil.equals(this.b - object.b, 0, precision))\r\n        { return false; }\r\n        if (!mathUtil.equals(this.a - object.a, 0, precision))\r\n        { return false; }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 拷贝\r\n     */\r\n    copy(color: Color4)\r\n    {\r\n        this.r = color.r;\r\n        this.g = color.g;\r\n        this.b = color.b;\r\n        this.a = color.a;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 输出字符串\r\n     */\r\n    toString(): string\r\n    {\r\n        return `{R: ${this.r} G:${this.g} B:${this.b} A:${this.a}}`;\r\n    }\r\n\r\n    toColor3(color = new Color3())\r\n    {\r\n        color.r = this.r;\r\n        color.g = this.g;\r\n        color.b = this.b;\r\n\r\n        return color;\r\n    }\r\n\r\n    toVector4(vector4 = new Vector4())\r\n    {\r\n        vector4.x = this.r;\r\n        vector4.y = this.g;\r\n        vector4.z = this.b;\r\n        vector4.w = this.a;\r\n\r\n        return vector4;\r\n    }\r\n\r\n    /**\r\n     * 转换为数组\r\n     * @param array 数组\r\n     * @param offset 偏移\r\n     */\r\n    toArray(array: number[] = [], offset = 0)\r\n    {\r\n        array[offset] = this.r;\r\n        array[offset + 1] = this.g;\r\n        array[offset + 2] = this.b;\r\n        array[offset + 3] = this.a;\r\n\r\n        return array;\r\n    }\r\n\r\n    /**\r\n     * 克隆\r\n     */\r\n    clone()\r\n    {\r\n        return new Color4(this.r, this.g, this.b, this.a);\r\n    }\r\n\r\n    /**\r\n     * 随机`Color4`\r\n     *\r\n     * @param randomAlpha 透明值是否随机\r\n     */\r\n    random(randomAlpha = false)\r\n    {\r\n        this.r = Math.random();\r\n        this.g = Math.random();\r\n        this.b = Math.random();\r\n        if (randomAlpha)\r\n        {\r\n            this.a = Math.random();\r\n        }\r\n\r\n        return this;\r\n    }\r\n}\r\n","/**\r\n * 动画曲线Wrap模式，处理超出范围情况\r\n */\r\nexport enum WrapMode\r\n{\r\n    /**\r\n     * 夹紧; 0>-<1\r\n     */\r\n    Clamp = 1,\r\n    /**\r\n     * 循环; 0->1,0->1\r\n     */\r\n    Loop = 2,\r\n    /**\r\n     * 来回循环; 0->1,1->0\r\n     */\r\n    PingPong = 4,\r\n\r\n    /**\r\n     * When time reaches the end of the animation clip, the clip will automatically stop playing and time will be reset to beginning of the clip.\r\n     */\r\n    Once,\r\n\r\n    /**\r\n     * Reads the default repeat mode set higher up.\r\n     */\r\n    Default,\r\n}\r\n","import { equationSolving } from '@feng3d/bezier';\r\n\r\n/**\r\n * Bézier曲线\r\n * @see https://en.wikipedia.org/wiki/B%C3%A9zier_curve\r\n * @author feng / http://feng3d.com 03/06/2018\r\n */\r\nexport class BezierCurve\r\n{\r\n    /**\r\n     * 线性Bézier曲线\r\n     * 给定不同的点P0和P1，线性Bézier曲线就是这两个点之间的直线。曲线由下式给出\r\n     * ```\r\n     * B(t) = p0 + t * (p1 - p0) = (1 - t) * p0 + t * p1 , 0 <= t && t <= 1\r\n     * ```\r\n     * 相当于线性插值\r\n     *\r\n     * @param t 插值度\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     */\r\n    linear(t: number, p0: number, p1: number)\r\n    {\r\n        return p0 + t * (p1 - p0);\r\n        // return (1 - t) * p0 + t * p1;\r\n    }\r\n\r\n    /**\r\n     * 线性Bézier曲线关于t的导数\r\n     * @param t 插值度\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     */\r\n    linearDerivative(t: number, p0: number, p1: number)\r\n    {\r\n        return p1 - p0;\r\n    }\r\n\r\n    /**\r\n     * 线性Bézier曲线关于t的二阶导数\r\n     * @param _t 插值度\r\n     * @param _p0 点0\r\n     * @param _p1 点1\r\n     */\r\n    linearSecondDerivative(_t: number, _p0: number, _p1: number)\r\n    {\r\n        return 0;\r\n    }\r\n\r\n    /**\r\n     * 二次Bézier曲线\r\n     *\r\n     * 二次Bézier曲线是由函数B（t）跟踪的路径，给定点P0，P1和P2，\r\n     * ```\r\n     * B(t) = (1 - t) * ((1 - t) * p0 + t * p1) + t * ((1 - t) * p1 + t * p2) , 0 <= t && t <= 1\r\n     * ```\r\n     * 这可以解释为分别从P0到P1和从P1到P2的线性Bézier曲线上相应点的线性插值。重新排列前面的等式得出：\r\n     * ```\r\n     * B(t) = (1 - t) * (1 - t) * p0 + 2 * (1 - t) * t * p1 + t * t * p2 , 0 <= t && t <= 1\r\n     * ```\r\n     * Bézier曲线关于t的导数是\r\n     * ```\r\n     * B'(t) = 2 * (1 - t) * (p1 - p0) + 2 * t * (p2 - p1)\r\n     * ```\r\n     * 从中可以得出结论：在P0和P2处曲线的切线在P 1处相交。随着t从0增加到1，曲线沿P1的方向从P0偏离，然后从P1的方向弯曲到P2。\r\n     *\r\n     * Bézier曲线关于t的二阶导数是\r\n     * ```\r\n     * B''(t) = 2 * (p2 - 2 * p1 + p0)\r\n     * ```\r\n     *\r\n     * @param t 插值度\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     * @param p2 点2\r\n     */\r\n    quadratic(t: number, p0: number, p1: number, p2: number)\r\n    {\r\n        // return this.linear(t, this.linear(t, p0, p1), this.linear(t, p1, p2));\r\n        // return (1 - t) * ((1 - t) * p0 + t * p1) + t * ((1 - t) * p1 + t * p2);\r\n        return (1 - t) * (1 - t) * p0 + 2 * (1 - t) * t * p1 + t * t * p2;\r\n    }\r\n\r\n    /**\r\n     * 二次Bézier曲线关于t的导数\r\n     * @param t 插值度\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     * @param p2 点2\r\n     */\r\n    quadraticDerivative(t: number, p0: number, p1: number, p2: number)\r\n    {\r\n        // return 2 * this.linear(t, this.linearDerivative(t, p0, p1), this.linearDerivative(t, p1, p2));\r\n        return 2 * (1 - t) * (p1 - p0) + 2 * t * (p2 - p1);\r\n    }\r\n\r\n    /**\r\n     * 二次Bézier曲线关于t的二阶导数\r\n     * @param t 插值度\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     * @param p2 点2\r\n     */\r\n    quadraticSecondDerivative(t: number, p0: number, p1: number, p2: number)\r\n    {\r\n        // return 1 * 2 * this.linearDerivative(t, p1 - p0, p2 - p1)\r\n        // return 1 * 2 * ((p2 - p1) - (p1 - p0));\r\n        return 2 * (p2 - 2 * p1 + p0);\r\n    }\r\n\r\n    /**\r\n     * 立方Bézier曲线\r\n     *\r\n     * 平面中或高维空间中（其实一维也是成立的，这里就是使用一维计算）的四个点P0，P1，P2和P3定义了三次Bézier曲线。\r\n     * 曲线开始于P0朝向P1并且从P2的方向到达P3。通常不会通过P1或P2; 这些点只是为了提供方向信息。\r\n     * P1和P2之间的距离在转向P2之前确定曲线向P1移动的“多远”和“多快” 。\r\n     *\r\n     * 对于由点Pi，Pj和Pk定义的二次Bézier曲线，可以将Bpipjpk(t)写成三次Bézier曲线，它可以定义为两条二次Bézier曲线的仿射组合：\r\n     * ```\r\n     * B(t) = (1 - t) * Bp0p1p2(t) + t * Bp1p2p3(t) , 0 <= t && t <= 1\r\n     * ```\r\n     * 曲线的显式形式是：\r\n     * ```\r\n     * B(t) = (1 - t) * (1 - t) * (1 - t) * p0 + 3 * (1 - t) * (1 - t) * t * p1 + 3 * (1 - t) * t * t * p2 + t * t * t * p3 , 0 <= t && t <= 1\r\n     * ```\r\n     * 对于P1和P2的一些选择，曲线可以相交，或者包含尖点。\r\n     *\r\n     * 三次Bézier曲线相对于t的导数是\r\n     * ```\r\n     * B'(t) = 3 * (1 - t) * (1 - t) * (p1 - p0) + 6 * (1 - t) * t * (p2 - p1) + 3 * t * t * (p3 - p2);\r\n     * ```\r\n     * 三次Bézier曲线关于t的二阶导数是\r\n     * ```\r\n     * 6 * (1 - t) * (p2 - 2 * p1 + p0) + 6 * t * (p3 - 2 * p2 + p1);\r\n     * ```\r\n     *\r\n     * @param t 插值度\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     * @param p2 点2\r\n     * @param p3 点3\r\n     */\r\n    cubic(t: number, p0: number, p1: number, p2: number, p3: number)\r\n    {\r\n        // return this.linear(t, this.quadratic(t, p0, p1, p2), this.quadratic(t, p1, p2, p3));\r\n        return (1 - t) * (1 - t) * (1 - t) * p0 + 3 * (1 - t) * (1 - t) * t * p1 + 3 * (1 - t) * t * t * p2 + t * t * t * p3;\r\n    }\r\n\r\n    /**\r\n     * 三次Bézier曲线关于t的导数\r\n     * @param t 插值度\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     * @param p2 点2\r\n     * @param p3 点3\r\n     */\r\n    cubicDerivative(t: number, p0: number, p1: number, p2: number, p3: number)\r\n    {\r\n        // return 3 * this.linear(t, this.quadraticDerivative(t, p0, p1, p2), this.quadraticDerivative(t, p1, p2, p3));\r\n        return 3 * (1 - t) * (1 - t) * (p1 - p0) + 6 * (1 - t) * t * (p2 - p1) + 3 * t * t * (p3 - p2);\r\n    }\r\n\r\n    /**\r\n     * 三次Bézier曲线关于t的二阶导数\r\n     * @param t 插值度\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     * @param p2 点2\r\n     */\r\n    cubicSecondDerivative(t: number, p0: number, p1: number, p2: number, p3: number)\r\n    {\r\n        // return 3 * this.linear(t, this.quadraticSecondDerivative(t, p0, p1, p2), this.quadraticSecondDerivative(t, p1, p2, p3));\r\n        return 6 * (1 - t) * (p2 - 2 * p1 + p0) + 6 * t * (p3 - 2 * p2 + p1);\r\n    }\r\n\r\n    /**\r\n     * n次Bézier曲线\r\n     *\r\n     * 一般定义\r\n     *\r\n     * Bézier曲线可以定义为任意度n。\r\n     *\r\n     * @param t 插值度\r\n     * @param ps 点列表 ps.length === n+1\r\n     * @param processs 收集中间过程数据，可用作Bézier曲线动画数据\r\n     */\r\n    bn(t: number, ps: number[], processs: number[][] = null)\r\n    {\r\n        ps = ps.concat();\r\n        if (processs)\r\n        { processs.push(ps.concat()); }\r\n        // n次Bézier递推\r\n        for (let i = ps.length - 1; i > 0; i--)\r\n        {\r\n            for (let j = 0; j < i; j++)\r\n            {\r\n                ps[j] = (1 - t) * ps[j] + t * ps[j + 1];\r\n            }\r\n            if (processs)\r\n            {\r\n                ps.length = ps.length - 1;\r\n                processs.push(ps.concat());\r\n            }\r\n        }\r\n\r\n        return ps[0];\r\n    }\r\n\r\n    /**\r\n     * n次Bézier曲线关于t的导数\r\n     *\r\n     * 一般定义\r\n     *\r\n     * Bézier曲线可以定义为任意度n。\r\n     *\r\n     * @param t 插值度\r\n     * @param ps 点列表 ps.length === n+1\r\n     */\r\n    bnDerivative(t: number, ps: number[])\r\n    {\r\n        if (ps.length < 2)\r\n        { return 0; }\r\n        ps = ps.concat();\r\n        // 进行\r\n        for (let i = 0, n = ps.length - 1; i < n; i++)\r\n        {\r\n            ps[i] = ps[i + 1] - ps[i];\r\n        }\r\n        //\r\n        ps.length = ps.length - 1;\r\n        const v = ps.length * this.bn(t, ps);\r\n\r\n        return v;\r\n    }\r\n\r\n    /**\r\n     * n次Bézier曲线关于t的二阶导数\r\n     *\r\n     * 一般定义\r\n     *\r\n     * Bézier曲线可以定义为任意度n。\r\n     *\r\n     * @param t 插值度\r\n     * @param ps 点列表 ps.length === n+1\r\n     */\r\n    bnSecondDerivative(t: number, ps: number[])\r\n    {\r\n        if (ps.length < 3)\r\n        { return 0; }\r\n        ps = ps.concat();\r\n        // 进行\r\n        for (let i = 0, n = ps.length - 1; i < n; i++)\r\n        {\r\n            ps[i] = ps[i + 1] - ps[i];\r\n        }\r\n        //\r\n        ps.length = ps.length - 1;\r\n        const v = ps.length * this.bnDerivative(t, ps);\r\n\r\n        return v;\r\n    }\r\n\r\n    /**\r\n     * n次Bézier曲线关于t的dn阶导数\r\n     *\r\n     * Bézier曲线可以定义为任意度n。\r\n     *\r\n     * @param t 插值度\r\n     * @param dn 求导次数\r\n     * @param ps 点列表     ps.length === n+1\r\n     */\r\n    bnND(t: number, dn: number, ps: number[])\r\n    {\r\n        if (ps.length < dn + 1)\r\n        { return 0; }\r\n        let factorial = 1;\r\n\r\n        ps = ps.concat();\r\n        for (let j = 0; j < dn; j++)\r\n        {\r\n            // 进行\r\n            for (let i = 0, n = ps.length - 1; i < n; i++)\r\n            {\r\n                ps[i] = ps[i + 1] - ps[i];\r\n            }\r\n            //\r\n            ps.length = ps.length - 1;\r\n            factorial *= ps.length;\r\n        }\r\n        const v = factorial * this.bn(t, ps);\r\n\r\n        return v;\r\n    }\r\n\r\n    /**\r\n     * 获取曲线在指定插值度上的值\r\n     * @param t 插值度\r\n     * @param ps 点列表\r\n     */\r\n    getValue(t: number, ps: number[]): number\r\n    {\r\n        if (ps.length === 2)\r\n        {\r\n            return this.linear(t, ps[0], ps[1]);\r\n        }\r\n        if (ps.length === 3)\r\n        {\r\n            return this.quadratic(t, ps[0], ps[1], ps[2]);\r\n        }\r\n        if (ps.length === 4)\r\n        {\r\n            return this.cubic(t, ps[0], ps[1], ps[2], ps[3]);\r\n        }\r\n\r\n        return this.bn(t, ps);\r\n        // var t1 = 1 - t;\r\n        // return t1 * t1 * t1 * ps[0] + 3 * t1 * t1 * t * ps[1] + 3 * t1 * t * t * ps[2] + t * t * t * ps[3];\r\n    }\r\n\r\n    /**\r\n     * 获取曲线在指定插值度上的导数(斜率)\r\n     * @param t 插值度\r\n     * @param ps 点列表\r\n     */\r\n    getDerivative(t: number, ps: number[]): number\r\n    {\r\n        if (ps.length === 2)\r\n        {\r\n            return this.linearDerivative(t, ps[0], ps[1]);\r\n        }\r\n        if (ps.length === 3)\r\n        {\r\n            return this.quadraticDerivative(t, ps[0], ps[1], ps[2]);\r\n        }\r\n        if (ps.length === 4)\r\n        {\r\n            return this.cubicDerivative(t, ps[0], ps[1], ps[2], ps[3]);\r\n        }\r\n\r\n        return this.bnDerivative(t, ps);\r\n        // return 3 * (1 - t) * (1 - t) * (ps[1] - ps[0]) + 6 * (1 - t) * t * (ps[2] - ps[1]) + 3 * t * t * (ps[3] - ps[2]);\r\n    }\r\n\r\n    /**\r\n     * 获取曲线在指定插值度上的二阶导数\r\n     * @param t 插值度\r\n     * @param ps 点列表\r\n     */\r\n    getSecondDerivative(t: number, ps: number[]): number\r\n    {\r\n        if (ps.length === 2)\r\n        {\r\n            return this.linearSecondDerivative(t, ps[0], ps[1]);\r\n        }\r\n        if (ps.length === 3)\r\n        {\r\n            return this.quadraticSecondDerivative(t, ps[0], ps[1], ps[2]);\r\n        }\r\n        if (ps.length === 4)\r\n        {\r\n            return this.cubicSecondDerivative(t, ps[0], ps[1], ps[2], ps[3]);\r\n        }\r\n\r\n        return this.bnSecondDerivative(t, ps);\r\n        // return 3 * (1 - t) * (1 - t) * (ps[1] - ps[0]) + 6 * (1 - t) * t * (ps[2] - ps[1]) + 3 * t * t * (ps[3] - ps[2]);\r\n    }\r\n\r\n    /**\r\n     * 查找区间内极值列表\r\n     *\r\n     * @param ps 点列表\r\n     * @param numSamples 采样次数，用于分段查找极值\r\n     * @param precision 查找精度\r\n     *\r\n     * @returns 极值列表 {} {ts: 极值插值度列表,vs: 极值值列表}\r\n     */\r\n    getExtremums(ps: number[], numSamples = 10, precision = 0.0000001)\r\n    {\r\n        const samples: number[] = [];\r\n\r\n        for (let i = 0; i <= numSamples; i++)\r\n        {\r\n            samples.push(this.getDerivative(i / numSamples, ps));\r\n        }\r\n        // 查找存在解的分段\r\n        //\r\n        const resultTs: number[] = [];\r\n        const resultVs: number[] = [];\r\n\r\n        for (let i = 0, n = numSamples; i < n; i++)\r\n        {\r\n            if (samples[i] * samples[i + 1] < 0)\r\n            {\r\n                const guessT = equationSolving.line((x) => this.getDerivative(x, ps), i / numSamples, (i + 1) / numSamples, precision);\r\n\r\n                resultTs.push(guessT);\r\n                resultVs.push(this.getValue(guessT, ps));\r\n            }\r\n        }\r\n\r\n        return { ts: resultTs, vs: resultVs };\r\n    }\r\n\r\n    /**\r\n     * 获取单调区间列表\r\n     *\r\n     * @param ps\r\n     * @param numSamples\r\n     * @param precision\r\n     * @returns ts: 区间结点插值度列表,vs: 区间结点值列表\r\n     */\r\n    getMonotoneIntervals(ps: number[], numSamples = 10, precision = 0.0000001)\r\n    {\r\n        // 区间内的单调区间\r\n        const monotoneIntervalTs = [0, 1];\r\n        const monotoneIntervalVs = [ps[0], ps[ps.length - 1]];\r\n        // 预先计算好极值\r\n        const extremums = this.getExtremums(ps, numSamples, precision);\r\n\r\n        for (let i = 0; i < extremums.ts.length; i++)\r\n        {\r\n            // 增加单调区间\r\n            monotoneIntervalTs.splice(i + 1, 0, extremums.ts[i]);\r\n            monotoneIntervalVs.splice(i + 1, 0, extremums.vs[i]);\r\n        }\r\n\r\n        return { ts: monotoneIntervalTs, vs: monotoneIntervalVs };\r\n    }\r\n\r\n    /**\r\n     * 获取目标值所在的插值度T\r\n     *\r\n     * @param targetV 目标值\r\n     * @param ps 点列表\r\n     * @param numSamples 分段数量，用于分段查找，用于解决寻找多个解、是否无解等问题；过少的分段可能会造成找不到存在的解决，过多的分段将会造成性能很差。\r\n     * @param precision 查找精度\r\n     *\r\n     * @returns 返回解数组\r\n     */\r\n    getTFromValue(targetV: number, ps: number[], numSamples = 10, precision = 0.0000001)\r\n    {\r\n        // 获取单调区间\r\n        const monotoneIntervals = this.getMonotoneIntervals(ps, numSamples, precision);\r\n        const monotoneIntervalTs = monotoneIntervals.ts;\r\n        const monotoneIntervalVs = monotoneIntervals.vs;\r\n\r\n        // 存在解的单调区间\r\n        const results: number[] = [];\r\n        // 遍历单调区间\r\n\r\n        for (let i = 0, n = monotoneIntervalVs.length - 1; i < n; i++)\r\n        {\r\n            if ((monotoneIntervalVs[i] - targetV) * (monotoneIntervalVs[i + 1] - targetV) <= 0)\r\n            {\r\n                const fx = (x) => this.getValue(x, ps) - targetV;\r\n\r\n                // 连线法\r\n                const result = equationSolving.line(fx, monotoneIntervalTs[i], monotoneIntervalTs[i + 1], precision);\r\n\r\n                results.push(result);\r\n            }\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    /**\r\n     * 分割曲线\r\n     *\r\n     * 在曲线插值度t位置分割为两条连接起来与原曲线完全重合的曲线\r\n     *\r\n     * @param t 分割位置（插值度）\r\n     * @param ps 被分割曲线点列表\r\n     * @returns 返回两条曲线组成的数组\r\n     */\r\n    split(t: number, ps: number[])\r\n    {\r\n        // 获取曲线的动画过程\r\n        const processs: number[][] = [];\r\n\r\n        bezierCurve.bn(t, ps, processs);\r\n\r\n        // 第一条曲线\r\n        const fps: number[] = [];\r\n        // 第二条曲线\r\n        const sps: number[] = [];\r\n        // 使用当前t值进行分割曲线\r\n\r\n        for (let i = processs.length - 1; i >= 0; i--)\r\n        {\r\n            if (i === processs.length - 1)\r\n            {\r\n                // 添加关键点\r\n                fps.push(processs[i][0]);\r\n                fps.push(processs[i][0]);\r\n            }\r\n            else\r\n            {\r\n                // 添加左右控制点\r\n                fps.unshift(processs[i][0]);\r\n                sps.push(processs[i].pop());\r\n            }\r\n        }\r\n\r\n        return [fps, sps];\r\n    }\r\n\r\n    /**\r\n     * 合并曲线\r\n     *\r\n     * 合并两条连接的曲线为一条曲线并且可以还原为分割前的曲线\r\n     *\r\n     * @param fps 第一条曲线点列表\r\n     * @param sps 第二条曲线点列表\r\n     * @param mergeType 合并方式。mergeType = 0时进行还原合并，还原拆分之前的曲线；mergeType = 1时进行拟合合并，合并后的曲线会经过两条曲线的连接点；\r\n     */\r\n    merge(fps: number[], sps: number[], mergeType = 0)\r\n    {\r\n        fps = fps.concat();\r\n        sps = sps.concat();\r\n        const processs: number[][] = [];\r\n        let t: number;\r\n        // 上条曲线\r\n        let pps: number[];\r\n        // 当前曲线\r\n        let ps: number[];\r\n\r\n        for (let i = 0, n = fps.length; i < n; i++)\r\n        {\r\n            ps = processs[i] = [];\r\n            if (i === 0)\r\n            {\r\n                processs[i][0] = fps.pop();\r\n                sps.shift();\r\n            }\r\n            else if (i === 1)\r\n            {\r\n                // 计算t值\r\n                processs[i][0] = fps.pop();\r\n                processs[i][1] = sps.shift();\r\n                t = (processs[i - 1][0] - processs[i][0]) / (processs[i][1] - processs[i][0]);\r\n            }\r\n            else\r\n            {\r\n                pps = processs[i - 1];\r\n                // 前面增加点\r\n                const nfp = fps.pop();\r\n                // 后面增加点\r\n                const nsp = sps.shift();\r\n                // 从前往后计算\r\n                const ps0: number[] = [];\r\n\r\n                ps0[0] = nfp;\r\n                for (let j = 0, n = pps.length; j < n; j++)\r\n                {\r\n                    ps0[j + 1] = ps0[j] + (pps[j] - ps0[j]) / t;\r\n                }\r\n                // 从后往前计算\r\n                const ps1: number[] = [];\r\n\r\n                ps1[pps.length] = nsp;\r\n                for (let j = pps.length - 1; j >= 0; j--)\r\n                {\r\n                    ps1[j] = ps1[j + 1] - (ps1[j + 1] - pps[j]) / (1 - t);\r\n                }\r\n                // 拟合合并,合并前后两个方向的计算\r\n                if (mergeType === 1)\r\n                {\r\n                    for (let j = 0, n = ps0.length - 1; j <= n; j++)\r\n                    {\r\n                        ps[j] = (ps0[j] * (n - j) + ps1[j] * j) / n;\r\n                    }\r\n                }\r\n                else if (mergeType === 0)\r\n                {\r\n                    // 还原合并，前半段使用从前往后计算，后半段使用从后往前计算\r\n                    for (let j = 0, n = ps0.length - 1; j <= n; j++)\r\n                    {\r\n                        if (j < n / 2)\r\n                        {\r\n                            ps[j] = ps0[j];\r\n                        }\r\n                        else if (j > n / 2)\r\n                        {\r\n                            ps[j] = ps1[j];\r\n                        }\r\n                        else\r\n                        {\r\n                            ps[j] = (ps0[j] + ps1[j]) / 2;\r\n                        }\r\n                    }\r\n                }\r\n                else\r\n                {\r\n                    console.error(`合并类型 mergeType ${mergeType} 错误!`);\r\n                }\r\n            }\r\n        }\r\n\r\n        return processs.pop();\r\n    }\r\n\r\n    /**\r\n     * 获取曲线样本数据\r\n     *\r\n     * 这些点可用于连线来拟合曲线。\r\n     *\r\n     * @param ps 点列表\r\n     * @param num 采样次数 ，采样点分别为[0,1/num,2/num,....,(num-1)/num,1]\r\n     */\r\n    getSamples(ps: number[], num = 100)\r\n    {\r\n        const results: { t: number, v: number }[] = [];\r\n\r\n        for (let i = 0; i <= num; i++)\r\n        {\r\n            const t = i / num;\r\n            const p = this.getValue(t, ps);\r\n\r\n            results.push({ t, v: p });\r\n        }\r\n\r\n        return results;\r\n    }\r\n}\r\n\r\n/**\r\n * Bézier曲线\r\n */\r\nexport const bezierCurve = new BezierCurve();\r\n","import { mathUtil } from '@feng3d/polyfill';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { AnimationCurveKeyframe } from './AnimationCurveKeyframe';\r\nimport { bezierCurve } from './BezierCurve';\r\nimport { WrapMode } from './WrapMode';\r\n\r\n/**\r\n * 动画曲线\r\n *\r\n * 基于时间轴的连续三阶Bézier曲线\r\n */\r\nexport class AnimationCurve\r\n{\r\n    __class__: 'feng3d.AnimationCurve';\r\n\r\n    /**\r\n     * 最大tan值，超出该值后将会变成分段\r\n     */\r\n    maxtan = 1000;\r\n\r\n    /**\r\n     * The behaviour of the animation before the first keyframe.\r\n     *\r\n     * 在第一个关键帧之前的动画行为。\r\n     */\r\n    @serialize\r\n    preWrapMode = WrapMode.Clamp;\r\n\r\n    /**\r\n     * The behaviour of the animation after the last keyframe.\r\n     *\r\n     * 动画在最后一个关键帧之后的行为。\r\n     */\r\n    @serialize\r\n    postWrapMode = WrapMode.Clamp;\r\n\r\n    /**\r\n     * All keys defined in the animation curve.\r\n     *\r\n     * 动画曲线上所有关键字定义。\r\n     *\r\n     * 注： 该值已对时间排序，否则赋值前请使用 sort((a, b) => a.time - b.time) 进行排序\r\n     */\r\n    @serialize\r\n    keys: AnimationCurveKeyframe[] = [{ time: 0, value: 1, inTangent: 0, outTangent: 0 }];\r\n\r\n    /**\r\n     * 关键点数量\r\n     */\r\n    get numKeys()\r\n    {\r\n        return this.keys.length;\r\n    }\r\n\r\n    /**\r\n     * 添加关键点\r\n     *\r\n     * 添加关键点后将会执行按t进行排序\r\n     *\r\n     * @param key 关键点\r\n     */\r\n    addKey(key: AnimationCurveKeyframe)\r\n    {\r\n        this.keys.push(key);\r\n        this.sort();\r\n    }\r\n\r\n    /**\r\n     * 关键点排序\r\n     *\r\n     * 当移动关键点或者新增关键点时需要再次排序\r\n     */\r\n    sort()\r\n    {\r\n        this.keys.sort((a, b) => a.time - b.time);\r\n    }\r\n\r\n    /**\r\n     * 删除关键点\r\n     * @param key 关键点\r\n     */\r\n    deleteKey(key: AnimationCurveKeyframe)\r\n    {\r\n        const index = this.keys.indexOf(key);\r\n\r\n        if (index !== -1)\r\n        { this.keys.splice(index, 1); }\r\n    }\r\n\r\n    /**\r\n     * 获取关键点\r\n     * @param index 索引\r\n     */\r\n    getKey(index: number)\r\n    {\r\n        return this.keys[index];\r\n    }\r\n\r\n    /**\r\n     * 获取关键点索引\r\n     * @param key 关键点\r\n     */\r\n    indexOfKeys(key: AnimationCurveKeyframe)\r\n    {\r\n        return this.keys.indexOf(key);\r\n    }\r\n\r\n    /**\r\n     * 获取曲线上点信息\r\n     * @param t 时间轴的位置 [0,1]\r\n     */\r\n    getPoint(t: number): AnimationCurveKeyframe\r\n    {\r\n        let wrapMode = WrapMode.Clamp;\r\n\r\n        let min = 0;\r\n        let max = 1;\r\n\r\n        if (this.keys.length > 0)\r\n        {\r\n            min = this.keys[0].time;\r\n        }\r\n        if (this.keys.length > 1)\r\n        {\r\n            max = this.keys[this.keys.length - 1].time;\r\n        }\r\n        const cycle = max - min;\r\n        const dcycle = 2 * cycle;\r\n\r\n        if (t < min)\r\n        { wrapMode = this.preWrapMode; }\r\n        else if (t > max)\r\n        { wrapMode = this.postWrapMode; }\r\n\r\n        switch (wrapMode)\r\n        {\r\n            case WrapMode.Clamp:\r\n                t = mathUtil.clamp(t, min, max);\r\n                break;\r\n            case WrapMode.Loop:\r\n                t = ((t - min) % cycle + cycle) % cycle + min;\r\n                break;\r\n            case WrapMode.PingPong:\r\n                t = ((t - min) % dcycle + dcycle) % dcycle + min;\r\n                if (t > max)\r\n                {\r\n                    t = max - (t - max);\r\n                }\r\n                break;\r\n        }\r\n\r\n        const keys = this.keys;\r\n        const maxtan = this.maxtan;\r\n        let value = 0; let tangent = 0; let\r\n            isfind = false;\r\n\r\n        for (let i = 0, n = keys.length; i < n; i++)\r\n        {\r\n            // 使用 bezierCurve 进行采样曲线点\r\n            const key = keys[i];\r\n            const prekey = keys[i - 1];\r\n\r\n            if (i > 0 && prekey.time <= t && t <= key.time)\r\n            {\r\n                const xstart = prekey.time;\r\n                const ystart = prekey.value;\r\n                const tanstart = prekey.outTangent;\r\n                const xend = key.time;\r\n                const yend = key.value;\r\n                const tanend = key.inTangent;\r\n\r\n                if (maxtan > Math.abs(tanstart) && maxtan > Math.abs(tanend))\r\n                {\r\n                    const ct = (t - prekey.time) / (key.time - prekey.time);\r\n                    const sys = [ystart, ystart + tanstart * (xend - xstart) / 3, yend - tanend * (xend - xstart) / 3, yend];\r\n                    const fy = bezierCurve.getValue(ct, sys);\r\n\r\n                    isfind = true;\r\n                    value = fy;\r\n                    tangent = bezierCurve.getDerivative(ct, sys) / (xend - xstart);\r\n                    break;\r\n                }\r\n                else\r\n                {\r\n                    isfind = true;\r\n                    value = prekey.value;\r\n                    tangent = 0;\r\n                    break;\r\n                }\r\n            }\r\n            if (i === 0 && t <= key.time)\r\n            {\r\n                isfind = true;\r\n                value = key.value;\r\n                tangent = 0;\r\n                break;\r\n            }\r\n            if (i === n - 1 && t >= key.time)\r\n            {\r\n                isfind = true;\r\n                value = key.value;\r\n                tangent = 0;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (keys.length === 0) return { time: t, value: 0, inTangent: 0, outTangent: 0 };\r\n\r\n        console.assert(isfind);\r\n\r\n        return { time: t, value, inTangent: tangent, outTangent: tangent };\r\n    }\r\n\r\n    /**\r\n     * 获取值\r\n     * @param t 时间轴的位置 [0,1]\r\n     */\r\n    getValue(t: number)\r\n    {\r\n        const point = this.getPoint(t);\r\n\r\n        if (!point) return 0;\r\n\r\n        return point.value;\r\n    }\r\n\r\n    /**\r\n     * 查找关键点\r\n     * @param t 时间轴的位置 [0,1]\r\n     * @param y 值\r\n     * @param precision 查找精度\r\n     */\r\n    findKey(t: number, y: number, precision: number)\r\n    {\r\n        const keys = this.keys;\r\n\r\n        for (let i = 0; i < keys.length; i++)\r\n        {\r\n            if (Math.abs(keys[i].time - t) < precision && Math.abs(keys[i].value - y) < precision)\r\n            {\r\n                return keys[i];\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * 添加曲线上的关键点\r\n     *\r\n     * 如果该点在曲线上，则添加关键点\r\n     *\r\n     * @param time 时间轴的位置 [0,1]\r\n     * @param value 值\r\n     * @param precision 查找精度\r\n     */\r\n    addKeyAtCurve(time: number, value: number, precision: number)\r\n    {\r\n        const point = this.getPoint(time);\r\n\r\n        if (Math.abs(value - point.value) < precision)\r\n        {\r\n            this.keys.push(point);\r\n            this.keys.sort((a, b) => a.time - b.time);\r\n\r\n            return point;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * 获取曲线样本数据\r\n     *\r\n     * 这些点可用于连线来拟合曲线。\r\n     *\r\n     * @param num 采样次数 ，采样点分别为[0,1/num,2/num,....,(num-1)/num,1]\r\n     */\r\n    getSamples(num = 100)\r\n    {\r\n        const results: AnimationCurveKeyframe[] = [];\r\n\r\n        for (let i = 0; i <= num; i++)\r\n        {\r\n            const p = this.getPoint(i / num);\r\n\r\n            results.push(p);\r\n        }\r\n\r\n        return results;\r\n    }\r\n}\r\n","/**\r\n * 曲线模式\r\n */\r\nexport enum MinMaxCurveMode\r\n{\r\n    /**\r\n     * Use a single constant for the MinMaxCurve.\r\n     *\r\n     * 使用单个常数。\r\n     */\r\n    Constant = 0,\r\n    /**\r\n     * Use a single curve for the MinMaxCurve.\r\n     *\r\n     * 使用一条曲线\r\n     */\r\n    Curve = 1,\r\n    /**\r\n     * Use a random value between 2 constants for the MinMaxCurve.\r\n     *\r\n     * 在两个常量之间使用一个随机值\r\n     */\r\n    TwoConstants = 3,\r\n    /**\r\n     * Use a random value between 2 curves for the MinMaxCurve.\r\n     *\r\n     * 在两条曲线之间使用一个随机值。\r\n     */\r\n    TwoCurves = 2,\r\n}\r\n","import { serialize } from '@feng3d/serialization';\r\nimport { Vector3 } from '../geom/Vector3';\r\nimport { AnimationCurve } from './AnimationCurve';\r\n\r\n/**\r\n * Vector3 曲线\r\n */\r\nexport class AnimationCurveVector3\r\n{\r\n    /**\r\n     * X 轴曲线\r\n     */\r\n    @serialize\r\n    xCurve = new AnimationCurve();\r\n\r\n    /**\r\n     * Y 轴曲线\r\n     */\r\n    @serialize\r\n    yCurve = new AnimationCurve();\r\n\r\n    /**\r\n     * Z 轴曲线\r\n     */\r\n    @serialize\r\n    zCurve = new AnimationCurve();\r\n\r\n    /**\r\n     * 获取值\r\n     * @param time 时间\r\n     */\r\n    getValue(time: number)\r\n    {\r\n        return new Vector3(this.xCurve.getValue(time), this.yCurve.getValue(time), this.zCurve.getValue(time));\r\n    }\r\n}\r\n","import { mathUtil } from '@feng3d/polyfill';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { AnimationCurve } from './AnimationCurve';\r\nimport { MinMaxCurveMode } from './MinMaxCurveMode';\r\n\r\n/**\r\n * 最大最小曲线\r\n */\r\nexport class MinMaxCurve\r\n{\r\n    __class__: 'feng3d.MinMaxCurve';\r\n\r\n    /**\r\n     * 模式\r\n     */\r\n    @serialize\r\n    mode = MinMaxCurveMode.Constant;\r\n\r\n    /**\r\n     * Set the constant value.\r\n     *\r\n     * 设置常数值。\r\n     */\r\n    @serialize\r\n    constant = 0;\r\n\r\n    /**\r\n     * Set a constant for the lower bound.\r\n     *\r\n     * 为下界设置一个常数。\r\n     */\r\n    @serialize\r\n    constantMin = 0;\r\n\r\n    /**\r\n     * Set a constant for the upper bound.\r\n     *\r\n     * 为上界设置一个常数。\r\n     */\r\n    @serialize\r\n    constantMax = 0;\r\n\r\n    /**\r\n     * Set the curve.\r\n     *\r\n     * 设置曲线。\r\n     */\r\n    @serialize\r\n    curve = new AnimationCurve();\r\n\r\n    /**\r\n     * Set a curve for the lower bound.\r\n     *\r\n     * 为下界设置一条曲线。\r\n     */\r\n    @serialize\r\n    curveMin = new AnimationCurve();\r\n\r\n    /**\r\n     * Set a curve for the upper bound.\r\n     *\r\n     * 为上界设置一条曲线。\r\n     */\r\n    @serialize\r\n    curveMax = new AnimationCurve();\r\n\r\n    /**\r\n     * Set a multiplier to be applied to the curves.\r\n     *\r\n     * 设置一个乘数应用于曲线。\r\n     */\r\n    @serialize\r\n    curveMultiplier = 1;\r\n\r\n    /**\r\n     * 是否在编辑器中只显示Y轴 0-1 区域，例如 lifetime 为非负，需要设置为true\r\n     */\r\n    @serialize\r\n    between0And1 = false;\r\n\r\n    /**\r\n     * 获取值\r\n     * @param time 时间\r\n     */\r\n    getValue(time: number, randomBetween: number = Math.random())\r\n    {\r\n        switch (this.mode)\r\n        {\r\n            case MinMaxCurveMode.Constant:\r\n                return this.constant;\r\n            case MinMaxCurveMode.Curve:\r\n                return this.curve.getValue(time) * this.curveMultiplier;\r\n            case MinMaxCurveMode.TwoConstants:\r\n                return mathUtil.lerp(this.constantMin, this.constantMax, randomBetween);\r\n            case MinMaxCurveMode.TwoCurves:\r\n                return mathUtil.lerp(this.curveMin.getValue(time), this.curveMax.getValue(time), randomBetween) * this.curveMultiplier;\r\n        }\r\n\r\n        return this.constant;\r\n    }\r\n}\r\n","import { mathUtil } from '@feng3d/polyfill';\r\n\r\ndeclare global\r\n{\r\n    interface MixinsMathUtil\r\n    {\r\n        /**\r\n         * 引擎中使用的坐标系统，默认左手坐标系统。\r\n         *\r\n         * three.js 右手坐标系统。\r\n         * playcanvas 右手坐标系统。\r\n         * unity    左手坐标系统。\r\n         */\r\n        DefaultCoordinateSystem: CoordinateSystem;\r\n    }\r\n}\r\n\r\n/**\r\n * 坐标系统类型\r\n */\r\nexport enum CoordinateSystem\r\n{\r\n    /**\r\n     * 默认坐标系统，左手坐标系统\r\n     */\r\n    LEFT_HANDED,\r\n\r\n    /**\r\n     * 右手坐标系统\r\n     */\r\n    RIGHT_HANDED,\r\n}\r\n\r\nmathUtil.DefaultCoordinateSystem = CoordinateSystem.LEFT_HANDED;\r\n","/**\r\n * 点与面的相对位置\r\n */\r\nexport enum PlaneClassification\r\n{\r\n    /**\r\n     * 在平面后面\r\n     */\r\n    BACK = 0,\r\n    /**\r\n     * 在平面前面\r\n     */\r\n    FRONT = 1,\r\n\r\n    /**\r\n     * 与平面相交\r\n     */\r\n    INTERSECT = 2,\r\n}\r\n","import { mathUtil } from '@feng3d/polyfill';\r\n\r\ndeclare global\r\n{\r\n    interface MixinsMathUtil\r\n    {\r\n        /**\r\n         * 引擎中使用的旋转顺序。\r\n         *\r\n         * unity YXZ\r\n         * playcanvas ZYX\r\n         * three.js XYZ\r\n         */\r\n        DefaultRotationOrder: RotationOrder;\r\n    }\r\n}\r\n\r\n/**\r\n * 欧拉角的旋转顺序。\r\n *\r\n * 如果顺序为XYZ，则依次按 ZYZ 轴旋转。为什么循序与定义相反？因为three.js中都这么定义，他们为什么这么定义就不清楚了。\r\n */\r\nexport enum RotationOrder\r\n{\r\n    /**\r\n     * 依次按 ZYX 轴旋转。\r\n     *\r\n     * three.js默认旋转顺序。\r\n     */\r\n    XYZ = 0,\r\n    /**\r\n     * 依次按 YXZ 轴旋转。\r\n     */\r\n    ZXY = 1,\r\n    /**\r\n     * 依次按 XYZ 轴旋转。\r\n     *\r\n     * playcanvas默认旋转顺序。\r\n     */\r\n    ZYX = 2,\r\n    /**\r\n     * 依次按 ZXY 轴旋转。\r\n     *\r\n     * unity默认旋转顺序。\r\n     */\r\n    YXZ = 3,\r\n    /**\r\n     * 依次按 XZY 轴旋转。\r\n     */\r\n    YZX = 4,\r\n    /**\r\n     * 依次按 YZX 轴旋转。\r\n     */\r\n    XZY = 5,\r\n}\r\n\r\nmathUtil.DefaultRotationOrder = RotationOrder.YXZ;\r\n","import { serialize } from '@feng3d/serialization';\r\nimport { Vector3 } from '../geom/Vector3';\r\nimport { MinMaxCurve } from './MinMaxCurve';\r\n\r\nexport class MinMaxCurveVector3\r\n{\r\n    /**\r\n     * x 曲线\r\n     */\r\n    @serialize\r\n    xCurve = new MinMaxCurve();\r\n\r\n    /**\r\n     * y 曲线\r\n     */\r\n    @serialize\r\n    yCurve = new MinMaxCurve();\r\n\r\n    /**\r\n     * z 曲线\r\n     */\r\n    @serialize\r\n    zCurve = new MinMaxCurve();\r\n\r\n    /**\r\n     * 获取值\r\n     * @param time 时间\r\n     */\r\n    getValue(time: number, randomBetween: number = Math.random())\r\n    {\r\n        return new Vector3(this.xCurve.getValue(time, randomBetween), this.yCurve.getValue(time, randomBetween), this.zCurve.getValue(time, randomBetween));\r\n    }\r\n}\r\n","import { mathUtil } from '@feng3d/polyfill';\r\nimport { Matrix4x4 } from './Matrix4x4';\r\nimport { Vector3 } from './Vector3';\r\n\r\nexport interface Line3 extends MixinsLine3 { }\r\n\r\n/**\r\n * 3d直线\r\n */\r\nexport class Line3\r\n{\r\n    /**\r\n     * 根据直线上两点初始化直线\r\n     * @param p0 Vector3\r\n     * @param p1 Vector3\r\n     */\r\n    static fromPoints(p0: Vector3, p1: Vector3)\r\n    {\r\n        return new Line3().fromPoints(p0, p1);\r\n    }\r\n\r\n    /**\r\n     * 根据直线某点与方向初始化直线\r\n     * @param position 直线上某点\r\n     * @param direction 直线的方向\r\n     */\r\n    static fromPosAndDir(position: Vector3, direction: Vector3)\r\n    {\r\n        return new Line3().fromPosAndDir(position, direction);\r\n    }\r\n\r\n    /**\r\n     * 随机直线，比如用于单元测试\r\n     */\r\n    static random()\r\n    {\r\n        return new Line3(Vector3.random(), Vector3.random());\r\n    }\r\n\r\n    /**\r\n     * 直线上某一点\r\n     */\r\n    origin: Vector3;\r\n\r\n    /**\r\n     * 直线方向(已标准化)\r\n     */\r\n    direction: Vector3;\r\n\r\n    /**\r\n     * 根据直线某点与方向创建直线\r\n     * @param origin 直线上某点\r\n     * @param direction 直线的方向\r\n     */\r\n    constructor(origin?: Vector3, direction?: Vector3)\r\n    {\r\n        this.origin = origin ? origin : new Vector3();\r\n        this.direction = (direction ? direction : new Vector3(0, 0, 1)).normalize();\r\n    }\r\n\r\n    /**\r\n     * 根据直线上两点初始化直线\r\n     * @param p0 Vector3\r\n     * @param p1 Vector3\r\n     */\r\n    fromPoints(p0: Vector3, p1: Vector3)\r\n    {\r\n        this.origin = p0;\r\n        this.direction = p1.subTo(p0).normalize();\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 根据直线某点与方向初始化直线\r\n     * @param position 直线上某点\r\n     * @param direction 直线的方向\r\n     */\r\n    fromPosAndDir(position: Vector3, direction: Vector3)\r\n    {\r\n        this.origin = position;\r\n        this.direction = direction.normalize();\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 获取直线上的一个点\r\n     * @param length 与原点距离\r\n     */\r\n    getPoint(length = 0, vout = new Vector3())\r\n    {\r\n        return vout.copy(this.direction).scaleNumber(length).add(this.origin);\r\n    }\r\n\r\n    /**\r\n     * 获取指定z值的点\r\n     * @param z z值\r\n     * @param vout 目标点（输出）\r\n     * @returns 目标点\r\n     */\r\n    getPointWithZ(z: number, vout = new Vector3())\r\n    {\r\n        return this.getPoint((z - this.origin.z) / this.direction.z, vout);\r\n    }\r\n\r\n    /**\r\n     * 指定点到该直线距离\r\n     * @param point 指定点\r\n     */\r\n    distanceWithPoint(point: Vector3)\r\n    {\r\n        return this.closestPointWithPoint(point).sub(point).length;\r\n    }\r\n\r\n    /**\r\n     * 与指定点最近点的系数\r\n     * @param point 点\r\n     */\r\n    closestPointParameterWithPoint(point: Vector3)\r\n    {\r\n        return point.subTo(this.origin).dot(this.direction);\r\n    }\r\n\r\n    /**\r\n     * 与指定点最近的点\r\n     * @param point 点\r\n     * @param vout 输出点\r\n     */\r\n    closestPointWithPoint(point: Vector3, vout = new Vector3())\r\n    {\r\n        const t = this.closestPointParameterWithPoint(point);\r\n\r\n        return this.getPoint(t, vout);\r\n    }\r\n\r\n    /**\r\n     * 判定点是否在直线上\r\n     * @param point 点\r\n     * @param precision 精度\r\n     */\r\n    onWithPoint(point: Vector3, precision = mathUtil.PRECISION)\r\n    {\r\n        if (mathUtil.equals(this.distanceWithPoint(point), 0, precision))\r\n        { return true; }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * 与直线相交\r\n     * @param line3D 直线\r\n     */\r\n    intersectWithLine3D(line3D: Line3)\r\n    {\r\n        // 处理相等\r\n        if (this.equals(line3D))\r\n        { return this.clone(); }\r\n        // 处理平行\r\n        if (this.direction.isParallel(line3D.direction))\r\n        { return null; }\r\n\r\n        const plane = this.getPlane();\r\n        const point = plane.intersectWithLine3(line3D) as Vector3;\r\n\r\n        if (this.onWithPoint(point))\r\n        { return point; }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * 应用矩阵\r\n     * @param mat 矩阵\r\n     */\r\n    applyMatri4x4(mat: Matrix4x4)\r\n    {\r\n        mat.transformPoint3(this.origin, this.origin);\r\n        mat.transformVector3(this.direction, this.direction);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 与指定向量比较是否相等\r\n     * @param v 比较的向量\r\n     * @param precision 允许误差\r\n     * @returns 相等返回true，否则false\r\n     */\r\n    equals(line: Line3, precision = mathUtil.PRECISION)\r\n    {\r\n        if (!this.onWithPoint(line.origin, precision))\r\n        {\r\n            return false;\r\n        }\r\n        if (!this.onWithPoint(line.origin.addTo(line.direction), precision))\r\n        {\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 拷贝\r\n     * @param line 直线\r\n     */\r\n    copy(line: Line3)\r\n    {\r\n        this.origin.copy(line.origin);\r\n        this.direction.copy(line.direction);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 克隆\r\n     */\r\n    clone()\r\n    {\r\n        return new Line3().copy(this);\r\n    }\r\n}\r\n","import { mathUtil } from '@feng3d/polyfill';\r\nimport { PlaneClassification } from '../enums/PlaneClassification';\r\nimport { Line3 } from './Line3';\r\nimport { Vector3 } from './Vector3';\r\n\r\ndeclare global\r\n{\r\n    interface MixinsLine3\r\n    {\r\n        /**\r\n         * 获取经过该直线的平面\r\n         */\r\n        getPlane(plane?: Plane): Plane;\r\n    }\r\n}\r\n\r\n/**\r\n * 平面\r\n *\r\n * ax+by+cz+d=0\r\n */\r\nexport class Plane\r\n{\r\n    /**\r\n     * 通过3顶点定义一个平面\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     * @param p2 点2\r\n     */\r\n    static fromPoints(p0: Vector3, p1: Vector3, p2: Vector3)\r\n    {\r\n        return new Plane().fromPoints(p0, p1, p2);\r\n    }\r\n\r\n    /**\r\n     * 根据法线与点定义平面\r\n     * @param normal 平面法线\r\n     * @param point 平面上任意一点\r\n     */\r\n    static fromNormalAndPoint(normal: Vector3, point: Vector3)\r\n    {\r\n        return new Plane().fromNormalAndPoint(normal, point);\r\n    }\r\n\r\n    /**\r\n     * 随机平面\r\n     */\r\n    static random()\r\n    {\r\n        const normal = Vector3.random().normalize();\r\n\r\n        return new Plane(normal.x, normal.y, normal.z, Math.random());\r\n    }\r\n\r\n    /**\r\n     * 平面A系数\r\n     * <p>同样也是面法线x尺寸</p>\r\n     */\r\n    a: number;\r\n\r\n    /**\r\n     * 平面B系数\r\n     * <p>同样也是面法线y尺寸</p>\r\n     */\r\n    b: number;\r\n\r\n    /**\r\n     * 平面C系数\r\n     * <p>同样也是面法线z尺寸</p>\r\n     */\r\n    c: number;\r\n\r\n    /**\r\n     * 平面D系数\r\n     * <p>同样也是原点到平面的距离</p>\r\n     */\r\n    d: number;\r\n\r\n    /**\r\n     * 创建一个平面\r\n     * @param a A系数\r\n     * @param b B系数\r\n     * @param c C系数\r\n     * @param d D系数\r\n     */\r\n    constructor(a = 0, b = 1, c = 0, d = 0)\r\n    {\r\n        this.a = a;\r\n        this.b = b;\r\n        this.c = c;\r\n        this.d = d;\r\n    }\r\n\r\n    /**\r\n     * 设置\r\n     *\r\n     * @param a A系数\r\n     * @param b B系数\r\n     * @param c C系数\r\n     * @param d D系数\r\n     */\r\n    set(a: number, b: number, c: number, d: number)\r\n    {\r\n        this.a = a;\r\n        this.b = b;\r\n        this.c = c;\r\n        this.d = d;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 原点在平面上的投影\r\n     * @param vout 输出点\r\n     */\r\n    getOrigin(vout = new Vector3())\r\n    {\r\n        return this.projectPoint(new Vector3(), vout);\r\n    }\r\n\r\n    /**\r\n     * 平面上随机点\r\n     * @param vout 输出点\r\n     */\r\n    randomPoint(vout = new Vector3())\r\n    {\r\n        return this.getOrigin(vout).add(this.getNormal().cross(Vector3.random()));\r\n    }\r\n\r\n    /**\r\n     * 法线\r\n     */\r\n    getNormal(vout = new Vector3())\r\n    {\r\n        return vout.set(this.a, this.b, this.c);\r\n    }\r\n\r\n    /**\r\n     * 通过3顶点定义一个平面\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     * @param p2 点2\r\n     */\r\n    fromPoints(p0: Vector3, p1: Vector3, p2: Vector3)\r\n    {\r\n        // p1.subTo(p0, v0);\r\n        // p2.subTo(p1, v1);\r\n        // var normal = v0.crossTo(v1).normalize();\r\n        const normal = p1.subTo(p0).crossTo(p2.subTo(p1)).normalize();\r\n\r\n        this.a = normal.x;\r\n        this.b = normal.y;\r\n        this.c = normal.z;\r\n        this.d = -normal.dot(p0);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 根据法线与点定义平面\r\n     * @param normal 平面法线\r\n     * @param point 平面上任意一点\r\n     */\r\n    fromNormalAndPoint(normal: Vector3, point: Vector3)\r\n    {\r\n        normal = normal.clone().normalize();\r\n        this.a = normal.x;\r\n        this.b = normal.y;\r\n        this.c = normal.z;\r\n        this.d = -normal.dot(point);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 计算点与平面的距离\r\n     * @param p 点\r\n     * @returns        距离\r\n     */\r\n    distanceWithPoint(p: Vector3)\r\n    {\r\n        return (this.a * p.x) + (this.b * p.y) + (this.c * p.z) + this.d;\r\n    }\r\n\r\n    /**\r\n     * 点是否在平面上\r\n     * @param p 点\r\n     */\r\n    onWithPoint(p: Vector3, precision = mathUtil.PRECISION)\r\n    {\r\n        return mathUtil.equals(this.distanceWithPoint(p), 0, precision);\r\n    }\r\n\r\n    /**\r\n     * 顶点分类\r\n     * <p>把顶点分为后面、前面、相交三类</p>\r\n     * @param p 顶点\r\n     * @returns         顶点类型 PlaneClassification.BACK,PlaneClassification.FRONT,PlaneClassification.INTERSECT\r\n     */\r\n    classifyPoint(p: Vector3, precision = mathUtil.PRECISION)\r\n    {\r\n        const len = this.distanceWithPoint(p);\r\n\r\n        if (mathUtil.equals(len, 0, precision))\r\n        { return PlaneClassification.INTERSECT; }\r\n        if (len < 0)\r\n        { return PlaneClassification.BACK; }\r\n\r\n        return PlaneClassification.FRONT;\r\n    }\r\n\r\n    /**\r\n     * 判定与直线是否平行\r\n     * @param line3D\r\n     */\r\n    parallelWithLine3D(line3D: Line3, precision = mathUtil.PRECISION)\r\n    {\r\n        if (mathUtil.equals(line3D.direction.dot(this.getNormal()), 0, precision))\r\n        { return true; }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * 判定与平面是否平行\r\n     * @param plane3D\r\n     */\r\n    parallelWithPlane3D(plane3D: Plane, precision = mathUtil.PRECISION)\r\n    {\r\n        if (plane3D.getNormal().isParallel(this.getNormal(), precision))\r\n        { return true; }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * 获取与直线交点\r\n     *\r\n     * @see 3D数学基础：图形与游戏开发 P269\r\n     */\r\n    intersectWithLine3(line: Line3)\r\n    {\r\n        const n = this.getNormal();\r\n        const d = line.direction;\r\n        const dn = d.dot(n);\r\n\r\n        if (mathUtil.equals(dn, 0))\r\n        {\r\n            // 处理直线在平面内\r\n            if (this.onWithPoint(line.origin))\r\n            { return line.clone(); }\r\n\r\n            return null;\r\n        }\r\n        const t = (-this.d - line.origin.dot(n)) / dn;\r\n        const cp = line.getPoint(t);\r\n\r\n        return cp;\r\n    }\r\n\r\n    /**\r\n     * 获取与平面相交直线\r\n     * @param plane3D\r\n     */\r\n    intersectWithPlane3D(plane3D: Plane)\r\n    {\r\n        if (this.parallelWithPlane3D(plane3D))\r\n        { return null; }\r\n        const direction = this.getNormal().crossTo(plane3D.getNormal());\r\n        const a0 = this.a;\r\n        const b0 = this.b;\r\n        const c0 = this.c;\r\n        const d0 = this.d;\r\n        const a1 = plane3D.a;\r\n        const b1 = plane3D.b;\r\n        const c1 = plane3D.c;\r\n        const d1 = plane3D.d;\r\n\r\n        let x: number;\r\n        let y: number;\r\n        let z: number;\r\n        // 解 方程组 a0*x+b0*y+c0*z+d0=0;a1*x+b1*y+c1*z+d1=0;\r\n\r\n        if ((b1 * c0) - (b0 * c1) !== 0)\r\n        {\r\n            x = 0;\r\n            y = (-(c0 * d1) + (c1 * d0) + (((a0 * c1) - (a1 * c0)) * x)) / ((b1 * c0) - (b0 * c1));\r\n            z = (-(b1 * d0) + (b0 * d1) + (((a1 * b0) - (a0 * b1)) * x)) / ((b1 * c0) - (b0 * c1));\r\n        }\r\n        else if ((a0 * c1) - (a1 * c0) !== 0)\r\n        {\r\n            y = 0;\r\n            x = (-(c1 * d0) + (c0 * d1) + (((b1 * c0) - (b0 * c1)) * y)) / ((a0 * c1) - (a1 * c0));\r\n            z = (-(a0 * d1) + (a1 * d0) + (((a1 * b0) - (a0 * b1)) * y)) / ((a0 * c1) - (a1 * c0));\r\n        }\r\n        else if ((a1 * b0) - (a0 * b1) !== 0)\r\n        {\r\n            z = 0;\r\n            x = (-(b0 * d1) + (b1 * d0) + (((b1 * c0) - (b0 * c1)) * z)) / ((a1 * b0) - (a0 * b1));\r\n            y = (-(a1 * d0) + (a0 * d1) + (((a0 * c1) - (a1 * c0)) * z)) / ((a1 * b0) - (a0 * b1));\r\n        }\r\n        else\r\n        {\r\n            throw '无法计算平面相交结果';\r\n        }\r\n\r\n        return new Line3(new Vector3(x, y, z), direction);\r\n    }\r\n\r\n    /**\r\n     * 标准化\r\n     */\r\n    normalize()\r\n    {\r\n        const a = this.a;\r\n        const b = this.b;\r\n        const c = this.c;\r\n        const d = this.d;\r\n\r\n        const s = (a * a) + (b * b) + (c * c);\r\n\r\n        if (s > 0)\r\n        {\r\n            const invLen = 1 / Math.sqrt(s);\r\n\r\n            this.a = a * invLen;\r\n            this.b = b * invLen;\r\n            this.c = c * invLen;\r\n            this.d = d * invLen;\r\n        }\r\n        else\r\n        {\r\n            console.warn(`无效平面 ${this}`);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 翻转平面\r\n     */\r\n    negate()\r\n    {\r\n        this.a = -this.a;\r\n        this.b = -this.b;\r\n        this.c = -this.c;\r\n        this.d = -this.d;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 点到平面的投影\r\n     * @param point\r\n     */\r\n    projectPoint(point: Vector3, vout = new Vector3())\r\n    {\r\n        return this.getNormal(vout).scaleNumber(-this.distanceWithPoint(point)).add(point);\r\n    }\r\n\r\n    /**\r\n     * 与指定点最近的点\r\n     * @param point 点\r\n     * @param vout 输出点\r\n     */\r\n    closestPointWithPoint(point: Vector3, vout = new Vector3())\r\n    {\r\n        return this.projectPoint(point, vout);\r\n    }\r\n\r\n    /**\r\n     * 与其他两平面相交于一点\r\n     *\r\n     * @param plane0\r\n     * @param plane1\r\n     *\r\n     * @see 3D数学基础：图形与游戏开发 P271\r\n     */\r\n    intersectWithTwoPlane3D(plane0: Plane, plane1: Plane)\r\n    {\r\n        const n1 = plane0.getNormal();\r\n        const n2 = plane1.getNormal();\r\n        const n3 = this.getNormal();\r\n\r\n        const d1 = -plane0.d;\r\n        const d2 = -plane1.d;\r\n        const d3 = -this.d;\r\n\r\n        const n1xn2 = n1.crossTo(n2);\r\n        const n2xn3 = n2.crossTo(n3);\r\n        const n3xn1 = n3.crossTo(n1);\r\n\r\n        let m = n1xn2.dot(n3);\r\n\r\n        if (mathUtil.equals(m, 0))\r\n        {\r\n            // 不存在交点或者不存在唯一的交点\r\n            return null;\r\n        }\r\n        m = 1 / m;\r\n        const p = n2xn3.scaleNumberTo(d1).add(n3xn1.scaleNumber(d2)).add(n1xn2.scaleNumber(d3)).scaleNumber(m);\r\n\r\n        return p;\r\n    }\r\n\r\n    /**\r\n     * 与指定平面是否相等\r\n     *\r\n     * @param plane\r\n     * @param precision\r\n     */\r\n    equals(plane: Plane, precision = mathUtil.PRECISION)\r\n    {\r\n        if (!mathUtil.equals(this.a - plane.a, 0, precision))\r\n        { return false; }\r\n        if (!mathUtil.equals(this.b - plane.b, 0, precision))\r\n        { return false; }\r\n        if (!mathUtil.equals(this.c - plane.c, 0, precision))\r\n        { return false; }\r\n        if (!mathUtil.equals(this.d - plane.d, 0, precision))\r\n        { return false; }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 复制\r\n     */\r\n    copy(plane: Plane)\r\n    {\r\n        this.a = plane.a;\r\n        this.b = plane.b;\r\n        this.c = plane.c;\r\n        this.d = plane.d;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 克隆\r\n     */\r\n    clone()\r\n    {\r\n        return new Plane().copy(this);\r\n    }\r\n\r\n    /**\r\n     * 输出字符串\r\n     */\r\n    toString(): string\r\n    {\r\n        return `Plane3D [this.a:${this.a}, this.b:${this.b}, this.c:${this.c}, this.d:${this.d}]`;\r\n    }\r\n}\r\n// var v0 = new Vector3();\r\n// var v1 = new Vector3();\r\n// var v2 = new Vector3();\r\n\r\nLine3.prototype.getPlane = function getPlane(plane = new Plane())\r\n{\r\n    return plane.fromNormalAndPoint(Vector3.random().cross(this.direction), this.origin);\r\n};\r\n","import { mathUtil } from '@feng3d/polyfill';\r\nimport { Line3 } from './Line3';\r\nimport { Vector3 } from './Vector3';\r\n\r\n/**\r\n * 3D线段\r\n */\r\nexport class Segment3\r\n{\r\n    /**\r\n     * 初始化线段\r\n     * @param p0\r\n     * @param p1\r\n     */\r\n    static fromPoints(p0: Vector3, p1: Vector3)\r\n    {\r\n        return new Segment3(p0, p1);\r\n    }\r\n\r\n    /**\r\n     * 随机线段\r\n     */\r\n    static random()\r\n    {\r\n        return new Segment3(Vector3.random(), Vector3.random());\r\n    }\r\n\r\n    /**\r\n     * 线段起点\r\n     */\r\n    p0: Vector3;\r\n    /**\r\n     * 线段终点\r\n     */\r\n    p1: Vector3;\r\n\r\n    constructor(p0 = new Vector3(), p1 = new Vector3())\r\n    {\r\n        this.p0 = p0;\r\n        this.p1 = p1;\r\n    }\r\n\r\n    /**\r\n     * 线段长度\r\n     */\r\n    getLength()\r\n    {\r\n        return Math.sqrt(this.getLengthSquared());\r\n    }\r\n\r\n    /**\r\n     * 线段长度的平方\r\n     */\r\n    getLengthSquared()\r\n    {\r\n        return this.p0.distanceSquared(this.p1);\r\n    }\r\n\r\n    /**\r\n     * 获取线段所在直线\r\n     */\r\n    getLine(line = new Line3())\r\n    {\r\n        return line.fromPoints(this.p0.clone(), this.p1.clone());\r\n    }\r\n\r\n    /**\r\n     * 获取指定位置上的点，当position=0时返回p0，当position=1时返回p1\r\n     * @param position 线段上的位置\r\n     */\r\n    getPoint(position: number, pout = new Vector3()): Vector3\r\n    {\r\n        const newPoint: Vector3 = pout.copy(this.p0).add(this.p1.subTo(this.p0).scaleNumber(position));\r\n\r\n        return newPoint;\r\n    }\r\n\r\n    /**\r\n     * 判定点是否在线段上\r\n     * @param point\r\n     */\r\n    onWithPoint(point: Vector3, precision = mathUtil.PRECISION)\r\n    {\r\n        return mathUtil.equals(this.getPointDistance(point), 0, precision);\r\n    }\r\n\r\n    /**\r\n     * 判定点是否投影在线段上\r\n     * @param point\r\n     */\r\n    projectOnWithPoint(point: Vector3)\r\n    {\r\n        let position = this.getPositionByPoint(point);\r\n\r\n        position = Number(position.toFixed(6));\r\n\r\n        return position >= 0 && position <= 1;\r\n    }\r\n\r\n    /**\r\n     * 获取点在线段上的位置，当点投影在线段上p0位置时返回0，当点投影在线段p1上时返回1\r\n     * @param point 点\r\n     */\r\n    getPositionByPoint(point: Vector3)\r\n    {\r\n        const vec = this.p1.subTo(this.p0);\r\n        const position = point.subTo(this.p0).dot(vec) / vec.lengthSquared;\r\n\r\n        return position;\r\n    }\r\n\r\n    /**\r\n     * 获取直线到点的法线（线段到点垂直方向）\r\n     * @param point 点\r\n     */\r\n    getNormalWithPoint(point: Vector3)\r\n    {\r\n        const direction = this.p1.subTo(this.p0);\r\n        const l1 = point.subTo(this.p0);\r\n        const n = direction.crossTo(l1).crossTo(direction).normalize();\r\n\r\n        return n;\r\n    }\r\n\r\n    /**\r\n     * 指定点到该线段距离，如果投影点不在线段上时，该距离为指定点到最近的线段端点的距离\r\n     * @param point 指定点\r\n     */\r\n    getPointDistanceSquare(point: Vector3)\r\n    {\r\n        const position = this.getPositionByPoint(point);\r\n\r\n        let lengthSquared: number;\r\n\r\n        if (position <= 0)\r\n        {\r\n            lengthSquared = point.subTo(this.p0).lengthSquared;\r\n        }\r\n        else if (position >= 1)\r\n        {\r\n            lengthSquared = point.subTo(this.p1).lengthSquared;\r\n        }\r\n        else\r\n        {\r\n            const s0 = point.subTo(this.p0).lengthSquared;\r\n            const s1 = position * position * this.p1.subTo(this.p0).lengthSquared;\r\n\r\n            lengthSquared = Math.abs(s0 - s1);\r\n        }\r\n\r\n        return lengthSquared;\r\n    }\r\n\r\n    /**\r\n     * 指定点到该线段距离，如果投影点不在线段上时，该距离为指定点到最近的线段端点的距离\r\n     * @param point 指定点\r\n     */\r\n    getPointDistance(point: Vector3)\r\n    {\r\n        let v = this.getPointDistanceSquare(point);\r\n\r\n        v = Math.sqrt(v);\r\n\r\n        return v;\r\n    }\r\n\r\n    /**\r\n     * 与直线相交\r\n     * @param line 直线\r\n     */\r\n    intersectionWithLine(line: Line3)\r\n    {\r\n        const l = this.getLine();\r\n        const r = l.intersectWithLine3D(line);\r\n\r\n        if (!r) return null;\r\n        if (r instanceof Line3)\r\n        { return this.clone(); }\r\n        if (this.onWithPoint(r))\r\n        { return r; }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * 与线段相交\r\n     * @param segment 直线\r\n     */\r\n    intersectionWithSegment(segment: Segment3)\r\n    {\r\n        const r = this.intersectionWithLine(segment.getLine());\r\n\r\n        if (!r) return null;\r\n        if (r instanceof Segment3)\r\n        {\r\n            const ps = [this.p0, this.p1].map((p) =>\r\n                segment.clampPoint(p));\r\n\r\n            if (this.onWithPoint(ps[0]))\r\n            { return Segment3.fromPoints(ps[0], ps[1]); }\r\n\r\n            return null;\r\n        }\r\n        if (this.onWithPoint(r))\r\n        { return r; }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * 与指定点最近的点\r\n     * @param point 点\r\n     * @param vout 输出点\r\n     */\r\n    closestPointWithPoint(point: Vector3, vout = new Vector3())\r\n    {\r\n        this.getLine().closestPointWithPoint(point, vout);\r\n        if (this.onWithPoint(vout))\r\n        { return vout; }\r\n        if (point.distanceSquared(this.p0) < point.distanceSquared(this.p1))\r\n        { return vout.copy(this.p0); }\r\n\r\n        return vout.copy(this.p1);\r\n    }\r\n\r\n    /**\r\n     * 把点压缩到线段内\r\n     */\r\n    clampPoint(point: Vector3, pout = new Vector3())\r\n    {\r\n        return this.getPoint(mathUtil.clamp(this.getPositionByPoint(point), 0, 1), pout);\r\n    }\r\n\r\n    /**\r\n     * 判定线段是否相等\r\n     */\r\n    equals(segment: Segment3)\r\n    {\r\n        return (this.p0.equals(segment.p0) && this.p1.equals(segment.p1)) || (this.p0.equals(segment.p1) && this.p1.equals(segment.p0));\r\n    }\r\n\r\n    /**\r\n     * 复制\r\n     */\r\n    copy(segment: Segment3)\r\n    {\r\n        this.p0.copy(segment.p0);\r\n        this.p1.copy(segment.p1);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 克隆\r\n     */\r\n    clone()\r\n    {\r\n        return new Segment3().copy(this);\r\n    }\r\n}\r\n","import { mathUtil } from '@feng3d/polyfill';\r\nimport { Line3 } from './Line3';\r\nimport { Plane } from './Plane';\r\nimport { Segment3 } from './Segment3';\r\nimport { Vector3 } from './Vector3';\r\n\r\n/**\r\n * 三角形\r\n */\r\nexport class Triangle3\r\n{\r\n    /**\r\n     * 通过3顶点定义一个三角形\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     * @param p2 点2\r\n     */\r\n    static fromPoints(p0: Vector3, p1: Vector3, p2: Vector3)\r\n    {\r\n        return new Triangle3().fromPoints(p0, p1, p2);\r\n    }\r\n\r\n    /**\r\n     * 从顶点数据初始化三角形\r\n     * @param positions 顶点数据\r\n     */\r\n    static fromPositions(positions: number[])\r\n    {\r\n        return new Triangle3().fromPositions(positions);\r\n    }\r\n\r\n    /**\r\n     * 随机三角形\r\n     * @param size 尺寸\r\n     */\r\n    static random(size = 1)\r\n    {\r\n        return new Triangle3(Vector3.random(size), Vector3.random(size), Vector3.random(size));\r\n    }\r\n\r\n    /**\r\n     * 三角形0号点\r\n     */\r\n    p0: Vector3;\r\n    /**\r\n     * 三角形1号点\r\n     */\r\n    p1: Vector3;\r\n    /**\r\n     * 三角形2号点\r\n     */\r\n    p2: Vector3;\r\n\r\n    /**\r\n     * 构造三角形\r\n     *\r\n     * @param p0 三角形0号点\r\n     * @param p1 三角形1号点\r\n     * @param p2 三角形2号点\r\n     */\r\n    constructor(p0 = new Vector3(), p1 = new Vector3(), p2 = new Vector3())\r\n    {\r\n        this.p0 = p0;\r\n        this.p1 = p1;\r\n        this.p2 = p2;\r\n    }\r\n\r\n    /**\r\n     * 三角形三个点\r\n     */\r\n    getPoints()\r\n    {\r\n        return [this.p0, this.p1, this.p2];\r\n    }\r\n\r\n    /**\r\n     * 三边\r\n     */\r\n    getSegments()\r\n    {\r\n        return [Segment3.fromPoints(this.p0, this.p1), Segment3.fromPoints(this.p1, this.p2), Segment3.fromPoints(this.p2, this.p0)];\r\n    }\r\n\r\n    /**\r\n     * 三角形所在平面\r\n     */\r\n    getPlane3d(pout = new Plane())\r\n    {\r\n        return pout.fromPoints(this.p0, this.p1, this.p2);\r\n    }\r\n\r\n    /**\r\n     * 获取法线\r\n     */\r\n    getNormal(vout = new Vector3())\r\n    {\r\n        return vout.copy(this.p1).sub(this.p0).cross(this.p2.subTo(this.p1)).normalize();\r\n    }\r\n\r\n    /**\r\n     * 重心,三条中线相交的点叫做重心。\r\n     */\r\n    getBarycenter(pout = new Vector3())\r\n    {\r\n        return pout.copy(this.p0).add(this.p1).add(this.p2).scaleNumber(1 / 3);\r\n    }\r\n\r\n    /**\r\n     * 外心，外切圆心,三角形三边的垂直平分线的交点，称为三角形外心。\r\n     * @see https://baike.baidu.com/item/%E4%B8%89%E8%A7%92%E5%BD%A2%E4%BA%94%E5%BF%83/218867\r\n     */\r\n    getCircumcenter(pout = new Vector3())\r\n    {\r\n        const a = this.p2.subTo(this.p1);\r\n        const b = this.p0.subTo(this.p2);\r\n        const c = this.p1.subTo(this.p0);\r\n        const d = 2 * c.crossTo(a).lengthSquared;\r\n        const a0 = -a.dot(a) * c.dot(b) / d;\r\n        const b0 = -b.dot(b) * c.dot(a) / d;\r\n        const c0 = -c.dot(c) * b.dot(a) / d;\r\n\r\n        return pout.copy(this.p0).scaleNumber(a0).add(this.p1.scaleNumberTo(b0)).add(this.p2.scaleNumberTo(c0));\r\n    }\r\n\r\n    /**\r\n     * 内心，内切圆心,三角形内心为三角形三条内角平分线的交点。\r\n     * @see https://baike.baidu.com/item/%E4%B8%89%E8%A7%92%E5%BD%A2%E4%BA%94%E5%BF%83/218867\r\n     */\r\n    getInnercenter(pout = new Vector3())\r\n    {\r\n        const a = this.p2.subTo(this.p1).length;\r\n        const b = this.p0.subTo(this.p2).length;\r\n        const c = this.p1.subTo(this.p0).length;\r\n\r\n        return pout.copy(this.p0).scaleNumber(a).add(this.p1.scaleNumberTo(b)).add(this.p2.scaleNumberTo(c))\r\n            .scaleNumber(1 / (a + b + c));\r\n    }\r\n\r\n    /**\r\n     * 垂心，三角形三边上的三条高或其延长线交于一点，称为三角形垂心。\r\n     * @see https://baike.baidu.com/item/%E4%B8%89%E8%A7%92%E5%BD%A2%E4%BA%94%E5%BF%83/218867\r\n     */\r\n    getOrthocenter(pout = new Vector3())\r\n    {\r\n        const a = this.p2.subTo(this.p1);\r\n        const b = this.p0.subTo(this.p2);\r\n        const c = this.p1.subTo(this.p0);\r\n        const a0 = a.dot(b) * a.dot(c);\r\n        const b0 = b.dot(c) * b.dot(a);\r\n        const c0 = c.dot(a) * c.dot(b);\r\n\r\n        return pout.copy(this.p0).scaleNumber(a0).add(this.p1.scaleNumberTo(b0)).add(this.p2.scaleNumberTo(c0))\r\n            .scaleNumber(1 / (a0 + b0 + c0));\r\n    }\r\n\r\n    /**\r\n     * 通过3顶点定义一个三角形\r\n     * @param p0 点0\r\n     * @param p1 点1\r\n     * @param p2 点2\r\n     */\r\n    fromPoints(p0: Vector3, p1: Vector3, p2: Vector3)\r\n    {\r\n        this.p0 = p0;\r\n        this.p1 = p1;\r\n        this.p2 = p2;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 从顶点数据初始化三角形\r\n     * @param positions 顶点数据\r\n     */\r\n    fromPositions(positions: number[])\r\n    {\r\n        this.p0.set(positions[0], positions[1], positions[2]);\r\n        this.p1.set(positions[3], positions[4], positions[5]);\r\n        this.p2.set(positions[6], positions[7], positions[8]);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 获取三角形内的点\r\n     * @param p 三点的权重（重心坐标系坐标）\r\n     * @param pout 输出点\r\n     */\r\n    getPoint(p: Vector3, pout = new Vector3())\r\n    {\r\n        return pout.copy(this.p0).scaleNumber(p.x).add(this.p1.scaleNumberTo(p.y)).add(this.p2.scaleNumberTo(p.z));\r\n    }\r\n\r\n    /**\r\n     * 获取三角形内随机点\r\n     * @param pout 输出点\r\n     */\r\n    randomPoint(pout = new Vector3())\r\n    {\r\n        const a = Math.random();\r\n        const b = Math.random() * (1 - a);\r\n        const c = 1 - a - b;\r\n\r\n        return this.getPoint(new Vector3(a, b, c), pout);\r\n    }\r\n\r\n    /**\r\n     * 获取与直线相交，当直线与三角形不相交时返回null\r\n     */\r\n    intersectionWithLine(line: Line3)\r\n    {\r\n        const plane3d = this.getPlane3d();\r\n        const cross = plane3d.intersectWithLine3(line);\r\n\r\n        if (!cross)\r\n        { return null; }\r\n        if (cross instanceof Vector3)\r\n        {\r\n            if (this.onWithPoint(cross))\r\n            { return cross; }\r\n\r\n            return null;\r\n        }\r\n\r\n        // 直线分别于三边相交\r\n        let crossSegment: Segment3 = null;\r\n        const ps = this.getSegments().reduce((v: Vector3[], segment) =>\r\n        {\r\n            const r = segment.intersectionWithLine(line);\r\n\r\n            if (!r)\r\n            { return v; }\r\n            if (r instanceof Segment3)\r\n            {\r\n                crossSegment = r;\r\n\r\n                return v;\r\n            }\r\n            v.push(r);\r\n\r\n            return v;\r\n        }, []);\r\n\r\n        if (crossSegment)\r\n        { return crossSegment; }\r\n        if (ps.length === 0)\r\n        { return null; }\r\n        if (ps.length === 1)\r\n        { return ps[0]; }\r\n        if (ps[0].equals(ps[1]))\r\n        {\r\n            return ps[0];\r\n        }\r\n\r\n        return Segment3.fromPoints(ps[0], ps[1]);\r\n    }\r\n\r\n    /**\r\n     * 获取与线段相交\r\n     */\r\n    intersectionWithSegment(segment: Segment3)\r\n    {\r\n        const r = this.intersectionWithLine(segment.getLine());\r\n\r\n        if (!r) return null;\r\n        if (r instanceof Vector3)\r\n        {\r\n            if (segment.onWithPoint(r))\r\n            { return r; }\r\n\r\n            return null;\r\n        }\r\n        const p0 = segment.clampPoint(r.p0);\r\n        const p1 = segment.clampPoint(r.p1);\r\n\r\n        if (!r.onWithPoint(p0))\r\n        { return null; }\r\n        if (p0.equals(p1))\r\n        { return p0; }\r\n\r\n        return Segment3.fromPoints(p0, p1);\r\n    }\r\n\r\n    /**\r\n     * 判定点是否在三角形上\r\n     * @param p 点\r\n     * @param precision 精度，如果距离小于精度则判定为在三角形上\r\n     */\r\n    onWithPoint(p: Vector3, precision = mathUtil.PRECISION)\r\n    {\r\n        const p0 = this.p0;\r\n        const p1 = this.p1;\r\n        const p2 = this.p2;\r\n\r\n        // 判断点是否在平面上\r\n        const dot = p0.subTo(p1).cross(p1.subTo(p2)).dot(p.subTo(p0));\r\n\r\n        if (!mathUtil.equals(dot, 0, precision))\r\n        { return false; }\r\n\r\n        // 求点的重心坐标系坐标\r\n        const bp = this.getBarycentricCoordinates(p);\r\n\r\n        // 当重心坐标系坐标任意分量小于0表示点在三角形外\r\n        precision = -precision;\r\n        if (bp.x < precision || bp.y < precision || bp.z < precision)\r\n        { return false; }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 求给出点的重心坐标系坐标\r\n     *\r\n     * @param p 点\r\n     * @param bp 用于接收重心坐标系坐标\r\n     *\r\n     * @returns 重心坐标系坐标\r\n     *\r\n     * @see 3D数学基础：图形与游戏开发 P252 P249\r\n     */\r\n    getBarycentricCoordinates(p: Vector3, bp = new Vector3())\r\n    {\r\n        const p0x = this.p0.x;\r\n        const p0y = this.p0.y;\r\n        const p0z = this.p0.z;\r\n        const p1x = this.p1.x;\r\n        const p1y = this.p1.y;\r\n        const p1z = this.p1.z;\r\n        const p2x = this.p2.x;\r\n        const p2y = this.p2.y;\r\n        const p2z = this.p2.z;\r\n\r\n        const d1x = p1x - p0x;\r\n        const d1y = p1y - p0y;\r\n        const d1z = p1z - p0z;\r\n        const d2x = p2x - p1x;\r\n        const d2y = p2y - p1y;\r\n        const d2z = p2z - p1z;\r\n\r\n        const nx = (d1y * d2z) - (d1z * d2y);\r\n        const ny = (d1z * d2x) - (d1x * d2z);\r\n        const nz = (d1x * d2y) - (d1y * d2x);\r\n\r\n        let u1: number;\r\n        let u2: number;\r\n        let u3: number;\r\n        let u4: number;\r\n        let v1: number;\r\n        let v2: number;\r\n        let v3: number;\r\n        let v4: number;\r\n\r\n        if ((Math.abs(nx) >= Math.abs(ny)) && (Math.abs(nx) >= Math.abs(nz)))\r\n        {\r\n            u1 = p0y - p2y;\r\n            u2 = p1y - p2y;\r\n            u3 = p.y - p0y;\r\n            u4 = p.y - p2y;\r\n            v1 = p0z - p2z;\r\n            v2 = p1z - p2z;\r\n            v3 = p.z - p0z;\r\n            v4 = p.z - p2z;\r\n        }\r\n        else if (Math.abs(ny) >= Math.abs(nz))\r\n        {\r\n            u1 = p0z - p2z;\r\n            u2 = p1z - p2z;\r\n            u3 = p.z - p0z;\r\n            u4 = p.z - p2z;\r\n            v1 = p0x - p2x;\r\n            v2 = p1x - p2x;\r\n            v3 = p.x - p0x;\r\n            v4 = p.x - p2x;\r\n        }\r\n        else\r\n        {\r\n            u1 = p0x - p2x;\r\n            u2 = p1x - p2x;\r\n            u3 = p.x - p0x;\r\n            u4 = p.x - p2x;\r\n            v1 = p0y - p2y;\r\n            v2 = p1y - p2y;\r\n            v3 = p.y - p0y;\r\n            v4 = p.y - p2y;\r\n        }\r\n        const denom = (v1 * u2) - (v2 * u1);\r\n        // if (mathUtil.equals(denom, 0))\r\n        // {\r\n        //     return null;\r\n        // }\r\n        const oneOverDenom = 1 / denom;\r\n\r\n        bp.x = ((v4 * u2) - (v2 * u4)) * oneOverDenom;\r\n        bp.y = ((v1 * u3) - (v3 * u1)) * oneOverDenom;\r\n        bp.z = 1 - bp.x - bp.y;\r\n\r\n        return bp;\r\n    }\r\n\r\n    /**\r\n     * 获取指定点分别占三个点的混合值\r\n     */\r\n    blendWithPoint(p: Vector3)\r\n    {\r\n        const n = this.p1.subTo(this.p0).crossTo(this.p2.subTo(this.p1));\r\n        const area = n.length;\r\n\r\n        n.normalize();\r\n        //\r\n        const n0 = this.p1.subTo(p).crossTo(this.p2.subTo(this.p1));\r\n        const area0 = n0.length;\r\n\r\n        n0.normalize();\r\n        const b0 = area0 / area * n.dot(n0);\r\n        //\r\n        const n1 = this.p2.subTo(p).crossTo(this.p0.subTo(this.p2));\r\n        const area1 = n1.length;\r\n\r\n        n1.normalize();\r\n        const b1 = area1 / area * n.dot(n1);\r\n        //\r\n        const n2 = this.p0.subTo(p).crossTo(this.p1.subTo(this.p0));\r\n        const area2 = n2.length;\r\n\r\n        n2.normalize();\r\n        const b2 = area2 / area * n.dot(n2);\r\n\r\n        return new Vector3(b0, b1, b2);\r\n    }\r\n\r\n    /**\r\n     * 与指定点最近的点\r\n     * @param point 点\r\n     * @param vout 输出点\r\n     */\r\n    closestPointWithPoint(point: Vector3, vout = new Vector3())\r\n    {\r\n        this.getPlane3d().closestPointWithPoint(point, vout);\r\n        if (this.onWithPoint(vout))\r\n        { return vout; }\r\n        const p = this.getSegments().map((s) =>\r\n        {\r\n            const p = s.closestPointWithPoint(point);\r\n\r\n            return { point: p, d: point.distanceSquared(p) };\r\n        }).sort((a, b) => a.d - b.d)[0].point;\r\n\r\n        return vout.copy(p);\r\n    }\r\n\r\n    /**\r\n     * 与点最近距离\r\n     * @param point 点\r\n     */\r\n    distanceWithPoint(point: Vector3)\r\n    {\r\n        return this.closestPointWithPoint(point).distance(point);\r\n    }\r\n\r\n    /**\r\n     * 与点最近距离平方\r\n     * @param point 点\r\n     */\r\n    distanceSquaredWithPoint(point: Vector3)\r\n    {\r\n        return this.closestPointWithPoint(point).distanceSquared(point);\r\n    }\r\n\r\n    /**\r\n     * 用点分解（切割）三角形\r\n     */\r\n    decomposeWithPoint(p: Vector3)\r\n    {\r\n        if (!this.onWithPoint(p))\r\n        { return [this]; }\r\n        if (this.p0.equals(p) || this.p1.equals(p) || this.p2.equals(p))\r\n        { return [this]; }\r\n        if (Segment3.fromPoints(this.p0, this.p1).onWithPoint(p))\r\n        { return [Triangle3.fromPoints(this.p0, p, this.p2), Triangle3.fromPoints(p, this.p1, this.p2)]; }\r\n        if (Segment3.fromPoints(this.p1, this.p2).onWithPoint(p))\r\n        { return [Triangle3.fromPoints(this.p1, p, this.p0), Triangle3.fromPoints(p, this.p2, this.p0)]; }\r\n        if (Segment3.fromPoints(this.p2, this.p0).onWithPoint(p))\r\n        { return [Triangle3.fromPoints(this.p2, p, this.p1), Triangle3.fromPoints(p, this.p0, this.p1)]; }\r\n\r\n        return [Triangle3.fromPoints(p, this.p0, this.p1), Triangle3.fromPoints(p, this.p1, this.p2), Triangle3.fromPoints(p, this.p2, this.p0)];\r\n    }\r\n\r\n    /**\r\n     * 用点分解（切割）三角形\r\n     */\r\n    decomposeWithPoints(ps: Vector3[])\r\n    {\r\n        // 遍历顶点分割三角形\r\n        const ts = ps.reduce((v: Triangle3[], p) =>\r\n        {\r\n            // 使用点分割所有三角形\r\n            v = v.reduce((v0: Triangle3[], t) =>\r\n                v0.concat(t.decomposeWithPoint(p)), []);\r\n\r\n            return v;\r\n        }, [this]);\r\n\r\n        return ts;\r\n    }\r\n\r\n    /**\r\n     * 用线段分解（切割）三角形\r\n     * @param segment 线段\r\n     */\r\n    decomposeWithSegment(segment: Segment3)\r\n    {\r\n        const r = this.intersectionWithSegment(segment);\r\n\r\n        if (!r) return [this];\r\n        if (r instanceof Vector3)\r\n        {\r\n            return this.decomposeWithPoint(r);\r\n        }\r\n        const ts = this.decomposeWithPoints([r.p0, r.p1]);\r\n\r\n        return ts;\r\n    }\r\n\r\n    /**\r\n     * 用直线分解（切割）三角形\r\n     * @param line 直线\r\n     */\r\n    decomposeWithLine(line: Line3)\r\n    {\r\n        const r = this.intersectionWithLine(line);\r\n\r\n        if (!r) return [this];\r\n        if (r instanceof Vector3)\r\n        {\r\n            return this.decomposeWithPoint(r);\r\n        }\r\n        const ts = this.decomposeWithPoints([r.p0, r.p1]);\r\n\r\n        return ts;\r\n    }\r\n\r\n    /**\r\n     * 面积\r\n     */\r\n    area()\r\n    {\r\n        return this.p1.subTo(this.p0).crossTo(this.p2.subTo(this.p1)).length * 0.5;\r\n    }\r\n\r\n    /**\r\n     * 栅格化，点阵化为XYZ轴间距为1的点阵\r\n     */\r\n    rasterize()\r\n    {\r\n        const aabb = {\r\n            min: this.p0.clone().min(this.p1).min(this.p2),\r\n            max: this.p0.clone().max(this.p1).max(this.p2),\r\n        };\r\n\r\n        aabb.min.round();\r\n        aabb.max.round();\r\n        const point = new Vector3();\r\n        const result: number[] = [];\r\n\r\n        for (let x = aabb.min.x; x <= aabb.max.x; x++)\r\n        {\r\n            for (let y = aabb.min.y; y <= aabb.max.y; y++)\r\n            {\r\n                for (let z = aabb.min.z; z <= aabb.max.z; z++)\r\n                {\r\n                    // 判定是否在三角形上\r\n                    const onTri = this.onWithPoint(point.set(x, y, z), 0.5);\r\n\r\n                    if (onTri)\r\n                    {\r\n                        result.push(x, y, z);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * 平移\r\n     * @param v 向量\r\n     */\r\n    translateVector3(v: Vector3)\r\n    {\r\n        this.p0.add(v);\r\n        this.p1.add(v);\r\n        this.p2.add(v);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 缩放\r\n     * @param v 缩放量\r\n     */\r\n    scaleVector3(v: Vector3)\r\n    {\r\n        this.p0.scale(v);\r\n        this.p1.scale(v);\r\n        this.p2.scale(v);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 自定义栅格化为点阵\r\n     * @param voxelSize 体素尺寸，点阵XYZ轴间距\r\n     * @param origin 原点，点阵中的某点正处于原点上，因此可以用作体素范围内的偏移\r\n     */\r\n    rasterizeCustom(voxelSize = new Vector3(1, 1, 1), origin = new Vector3())\r\n    {\r\n        const tri = this.clone().translateVector3(origin.negateTo()).scaleVector3(voxelSize.inverseTo());\r\n        const ps = tri.rasterize();\r\n        const vec = new Vector3();\r\n        const result: { xi: number, yi: number, zi: number, xv: number, yv: number, zv: number }[] = [];\r\n\r\n        ps.forEach((v, i) =>\r\n        {\r\n            if (i % 3 === 0)\r\n            {\r\n                vec.set(ps[i], ps[i + 1], ps[i + 2]).scale(voxelSize).add(origin);\r\n                result.push({ xi: ps[i], yi: ps[i + 1], zi: ps[i + 2], xv: vec.x, yv: vec.y, zv: vec.z });\r\n            }\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * 复制\r\n     * @param triangle 三角形\r\n     */\r\n    copy(triangle: Triangle3)\r\n    {\r\n        this.p0.copy(triangle.p0);\r\n        this.p1.copy(triangle.p1);\r\n        this.p2.copy(triangle.p2);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 克隆\r\n     */\r\n    clone()\r\n    {\r\n        return new Triangle3().copy(this);\r\n    }\r\n\r\n    /**\r\n     * 判断指定点是否在三角形内\r\n     *\r\n     * @param p0 三角形0号点\r\n     * @param p1 三角形1号点\r\n     * @param p2 三角形2号点\r\n     * @param p 指定点\r\n     */\r\n    static containsPoint(p0: Vector3, p1: Vector3, p2: Vector3, p: Vector3)\r\n    {\r\n        return new Triangle3(p0, p1, p2).onWithPoint(p);\r\n    }\r\n}\r\n","import { Matrix4x4 } from './Matrix4x4';\r\nimport { Plane } from './Plane';\r\nimport { Sphere } from './Sphere';\r\nimport { Triangle3 } from './Triangle3';\r\nimport { Vector3 } from './Vector3';\r\n\r\n/**\r\n * 轴向对称包围盒\r\n */\r\nexport class Box3\r\n{\r\n    /**\r\n     * 从一组顶点初始化包围盒\r\n     * @param positions 坐标数据列表\r\n     */\r\n    static formPositions(positions: number[])\r\n    {\r\n        return new Box3().formPositions(positions);\r\n    }\r\n\r\n    /**\r\n     * 从一组点初始化包围盒\r\n     * @param ps 点列表\r\n     */\r\n    static fromPoints(ps: Vector3[])\r\n    {\r\n        return new Box3().fromPoints(ps);\r\n    }\r\n\r\n    /**\r\n     * 随机包围盒\r\n     */\r\n    static random()\r\n    {\r\n        const min = Vector3.random();\r\n        const max = Vector3.random().add(min);\r\n\r\n        return new Box3(min, max);\r\n    }\r\n\r\n    /**\r\n     * 最小点\r\n     */\r\n    min: Vector3;\r\n    /**\r\n     * 最大点\r\n     */\r\n    max: Vector3;\r\n\r\n    /**\r\n     * 获取中心点\r\n     * @param vout 输出向量\r\n     */\r\n    getCenter(vout = new Vector3())\r\n    {\r\n        return vout.copy(this.min).add(this.max).scaleNumber(0.5);\r\n    }\r\n\r\n    /**\r\n     * 尺寸\r\n     */\r\n    getSize(vout = new Vector3())\r\n    {\r\n        return this.isEmpty() ? vout.set(0, 0, 0) : this.max.subTo(this.min, vout);\r\n    }\r\n\r\n    /**\r\n     * 创建包围盒\r\n     * @param min 最小点\r\n     * @param max 最大点\r\n     */\r\n    constructor(min = new Vector3(Number(Infinity), Number(Infinity), Number(Infinity)), max = new Vector3(-Infinity, -Infinity, -Infinity))\r\n    {\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n\r\n    /**\r\n     * 初始化包围盒\r\n     * @param min 最小值\r\n     * @param max 最大值\r\n     */\r\n    init(min: Vector3, max: Vector3)\r\n    {\r\n        this.min = min;\r\n        this.max = max;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 缩放包围盒\r\n     *\r\n     * @param s 缩放系数\r\n     */\r\n    scale(s: Vector3)\r\n    {\r\n        this.min.scale(s);\r\n        this.max.scale(s);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 转换为包围盒八个角所在点列表\r\n     */\r\n    toPoints(points?: Vector3[])\r\n    {\r\n        if (!points)\r\n        {\r\n            points = [\r\n                new Vector3(),\r\n                new Vector3(),\r\n                new Vector3(),\r\n                new Vector3(),\r\n                new Vector3(),\r\n                new Vector3(),\r\n                new Vector3(),\r\n                new Vector3(),\r\n            ];\r\n        }\r\n\r\n        const min = this.min;\r\n        const max = this.max;\r\n\r\n        points[0].set(min.x, min.y, min.z);\r\n        points[1].set(max.x, min.y, min.z);\r\n        points[2].set(min.x, max.y, min.z);\r\n        points[3].set(min.x, min.y, max.z);\r\n        points[4].set(min.x, max.y, max.z);\r\n        points[5].set(max.x, min.y, max.z);\r\n        points[6].set(max.x, max.y, min.z);\r\n        points[7].set(max.x, max.y, max.z);\r\n\r\n        return points;\r\n    }\r\n\r\n    /**\r\n     * 从一组顶点初始化包围盒\r\n     * @param positions 坐标数据列表\r\n     */\r\n    formPositions(positions: number[])\r\n    {\r\n        let minX = Number(Infinity);\r\n        let minY = Number(Infinity);\r\n        let minZ = Number(Infinity);\r\n\r\n        let maxX = -Infinity;\r\n        let maxY = -Infinity;\r\n        let maxZ = -Infinity;\r\n\r\n        for (let i = 0, l = positions.length; i < l; i += 3)\r\n        {\r\n            const x = positions[i];\r\n            const y = positions[i + 1];\r\n            const z = positions[i + 2];\r\n\r\n            if (x < minX) minX = x;\r\n            if (y < minY) minY = y;\r\n            if (z < minZ) minZ = z;\r\n\r\n            if (x > maxX) maxX = x;\r\n            if (y > maxY) maxY = y;\r\n            if (z > maxZ) maxZ = z;\r\n        }\r\n\r\n        this.min.set(minX, minY, minZ);\r\n        this.max.set(maxX, maxY, maxZ);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 从一组点初始化包围盒\r\n     * @param ps 点列表\r\n     */\r\n    fromPoints(ps: Vector3[])\r\n    {\r\n        this.empty();\r\n        ps.forEach((element) =>\r\n        {\r\n            this.expandByPoint(element);\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 包围盒内随机点\r\n     */\r\n    randomPoint(pout = new Vector3())\r\n    {\r\n        return pout.copy(this.min).lerp(this.max, Vector3.random());\r\n    }\r\n\r\n    /**\r\n     * 使用点扩张包围盒\r\n     * @param point 点\r\n     */\r\n    expandByPoint(point: Vector3)\r\n    {\r\n        this.min.min(point);\r\n        this.max.max(point);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 应用矩阵\r\n     * @param mat 矩阵\r\n     *\r\n     * @todo 优化\r\n     * @see 3D数学基础：图形与游戏开发 P288 AABB::setToTransformedBox\r\n     */\r\n    applyMatrix(mat: Matrix4x4)\r\n    {\r\n        if (this.isEmpty()) return this;\r\n\r\n        const points = this.toPoints().map((v) => v.applyMatrix4x4(mat));\r\n        this.fromPoints(points);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 应用矩阵\r\n     * @param mat 矩阵\r\n     */\r\n    applyMatrixTo(mat: Matrix4x4, out = new Box3())\r\n    {\r\n        return out.copy(this).applyMatrix(mat);\r\n    }\r\n\r\n    /**\r\n     *\r\n     */\r\n    clone(): Box3\r\n    {\r\n        return new Box3(this.min.clone(), this.max.clone());\r\n    }\r\n\r\n    /**\r\n     * 是否包含指定点\r\n     * @param p 点\r\n     */\r\n    containsPoint(p: Vector3)\r\n    {\r\n        return this.min.lessequal(p) && this.max.greaterequal(p);\r\n    }\r\n\r\n    /**\r\n     * 是否包含包围盒\r\n     * @param aabb 包围盒\r\n     */\r\n    contains(aabb: Box3)\r\n    {\r\n        return this.min.lessequal(aabb.min) && this.max.greaterequal(aabb.max);\r\n    }\r\n\r\n    /**\r\n     * 拷贝\r\n     * @param aabb 包围盒\r\n     */\r\n    copy(aabb: Box3)\r\n    {\r\n        this.min.copy(aabb.min);\r\n        this.max.copy(aabb.max);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 比较包围盒是否相等\r\n     * @param aabb 包围盒\r\n     */\r\n    equals(aabb: Box3)\r\n    {\r\n        return this.min.equals(aabb.min) && this.max.equals(aabb.max);\r\n    }\r\n\r\n    /**\r\n     * 平移\r\n     *\r\n     * @param offset 偏移量\r\n     */\r\n    translate(offset: Vector3)\r\n    {\r\n        this.min.add(offset);\r\n        this.max.add(offset);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 膨胀包围盒\r\n     * @param dx x方向膨胀量\r\n     * @param dy y方向膨胀量\r\n     * @param dz z方向膨胀量\r\n     */\r\n    inflate(dx: number, dy: number, dz: number)\r\n    {\r\n        this.min.x -= dx / 2;\r\n        this.min.y -= dy / 2;\r\n        this.min.z -= dz / 2;\r\n        this.max.x += dx / 2;\r\n        this.max.y += dy / 2;\r\n        this.max.z += dz / 2;\r\n    }\r\n\r\n    /**\r\n     * 膨胀包围盒\r\n     * @param delta 膨胀量\r\n     */\r\n    inflatePoint(delta: Vector3)\r\n    {\r\n        delta = delta.scaleNumberTo(0.5);\r\n        this.min.sub(delta);\r\n        this.max.add(delta);\r\n    }\r\n\r\n    /**\r\n     * 与包围盒相交\r\n     * @param aabb 包围盒\r\n     */\r\n    intersection(aabb: Box3)\r\n    {\r\n        const min = this.min.clampTo(aabb.min, aabb.max);\r\n        const max = this.max.clampTo(aabb.min, aabb.max);\r\n\r\n        if (this.containsPoint(min))\r\n        {\r\n            this.min.copy(min);\r\n            this.max.copy(max);\r\n\r\n            return this;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * 与包围盒相交\r\n     * @param aabb 包围盒\r\n     */\r\n    intersectionTo(aabb: Box3, out = new Box3())\r\n    {\r\n        return out.copy(this).intersection(aabb);\r\n    }\r\n\r\n    /**\r\n     * 包围盒是否相交\r\n     * @param aabb 包围盒\r\n     */\r\n    intersects(aabb: Box3)\r\n    {\r\n        const b = this.intersectionTo(aabb);\r\n        const c = b.getCenter();\r\n\r\n        return this.containsPoint(c) && aabb.containsPoint(c);\r\n    }\r\n\r\n    /**\r\n     * 与射线相交\r\n     * @param position 射线起点\r\n     * @param direction 射线方向\r\n     * @param outTargetNormal 相交处法线\r\n     * @returns 起点到包围盒距离\r\n     *\r\n     * @todo 可用以下方法优化？\r\n     * @see 3D数学基础：图形与游戏开发 P290\r\n     */\r\n    rayIntersection(position: Vector3, direction: Vector3, outTargetNormal?: Vector3)\r\n    {\r\n        if (this.isEmpty())\r\n        { return Number.MAX_VALUE; }\r\n        if (this.containsPoint(position))\r\n        { return 0; }\r\n\r\n        const halfExtentsX = (this.max.x - this.min.x) / 2;\r\n        const halfExtentsY = (this.max.y - this.min.y) / 2;\r\n        const halfExtentsZ = (this.max.z - this.min.z) / 2;\r\n\r\n        const centerX = this.min.x + halfExtentsX;\r\n        const centerY = this.min.y + halfExtentsY;\r\n        const centerZ = this.min.z + halfExtentsZ;\r\n\r\n        const px = position.x - centerX;\r\n        const py = position.y - centerY;\r\n        const pz = position.z - centerZ;\r\n\r\n        const vx = direction.x;\r\n        const vy = direction.y;\r\n        const vz = direction.z;\r\n\r\n        let ix: number;\r\n        let iy: number;\r\n        let iz: number;\r\n        let rayEntryDistance = Number.MAX_VALUE;\r\n\r\n        // 射线与平面相交测试\r\n        let intersects = false;\r\n\r\n        if (vx < 0)\r\n        {\r\n            rayEntryDistance = (halfExtentsX - px) / vx;\r\n            if (rayEntryDistance > 0)\r\n            {\r\n                iy = py + rayEntryDistance * vy;\r\n                iz = pz + rayEntryDistance * vz;\r\n                if (iy > -halfExtentsY && iy < halfExtentsY && iz > -halfExtentsZ && iz < halfExtentsZ)\r\n                {\r\n                    if (outTargetNormal)\r\n                    {\r\n                        outTargetNormal.x = 1;\r\n                        outTargetNormal.y = 0;\r\n                        outTargetNormal.z = 0;\r\n                    }\r\n\r\n                    intersects = true;\r\n                }\r\n            }\r\n        }\r\n        if (!intersects && vx > 0)\r\n        {\r\n            rayEntryDistance = (-halfExtentsX - px) / vx;\r\n            if (rayEntryDistance > 0)\r\n            {\r\n                iy = py + rayEntryDistance * vy;\r\n                iz = pz + rayEntryDistance * vz;\r\n                if (iy > -halfExtentsY && iy < halfExtentsY && iz > -halfExtentsZ && iz < halfExtentsZ)\r\n                {\r\n                    if (outTargetNormal)\r\n                    {\r\n                        outTargetNormal.x = -1;\r\n                        outTargetNormal.y = 0;\r\n                        outTargetNormal.z = 0;\r\n                    }\r\n                    intersects = true;\r\n                }\r\n            }\r\n        }\r\n        if (!intersects && vy < 0)\r\n        {\r\n            rayEntryDistance = (halfExtentsY - py) / vy;\r\n            if (rayEntryDistance > 0)\r\n            {\r\n                ix = px + rayEntryDistance * vx;\r\n                iz = pz + rayEntryDistance * vz;\r\n                if (ix > -halfExtentsX && ix < halfExtentsX && iz > -halfExtentsZ && iz < halfExtentsZ)\r\n                {\r\n                    if (outTargetNormal)\r\n                    {\r\n                        outTargetNormal.x = 0;\r\n                        outTargetNormal.y = 1;\r\n                        outTargetNormal.z = 0;\r\n                    }\r\n                    intersects = true;\r\n                }\r\n            }\r\n        }\r\n        if (!intersects && vy > 0)\r\n        {\r\n            rayEntryDistance = (-halfExtentsY - py) / vy;\r\n            if (rayEntryDistance > 0)\r\n            {\r\n                ix = px + rayEntryDistance * vx;\r\n                iz = pz + rayEntryDistance * vz;\r\n                if (ix > -halfExtentsX && ix < halfExtentsX && iz > -halfExtentsZ && iz < halfExtentsZ)\r\n                {\r\n                    if (outTargetNormal)\r\n                    {\r\n                        outTargetNormal.x = 0;\r\n                        outTargetNormal.y = -1;\r\n                        outTargetNormal.z = 0;\r\n                    }\r\n                    intersects = true;\r\n                }\r\n            }\r\n        }\r\n        if (!intersects && vz < 0)\r\n        {\r\n            rayEntryDistance = (halfExtentsZ - pz) / vz;\r\n            if (rayEntryDistance > 0)\r\n            {\r\n                ix = px + rayEntryDistance * vx;\r\n                iy = py + rayEntryDistance * vy;\r\n                if (iy > -halfExtentsY && iy < halfExtentsY && ix > -halfExtentsX && ix < halfExtentsX)\r\n                {\r\n                    if (outTargetNormal)\r\n                    {\r\n                        outTargetNormal.x = 0;\r\n                        outTargetNormal.y = 0;\r\n                        outTargetNormal.z = 1;\r\n                    }\r\n                    intersects = true;\r\n                }\r\n            }\r\n        }\r\n        if (!intersects && vz > 0)\r\n        {\r\n            rayEntryDistance = (-halfExtentsZ - pz) / vz;\r\n            if (rayEntryDistance > 0)\r\n            {\r\n                ix = px + rayEntryDistance * vx;\r\n                iy = py + rayEntryDistance * vy;\r\n                if (iy > -halfExtentsY && iy < halfExtentsY && ix > -halfExtentsX && ix < halfExtentsX)\r\n                {\r\n                    if (outTargetNormal)\r\n                    {\r\n                        outTargetNormal.x = 0;\r\n                        outTargetNormal.y = 0;\r\n                        outTargetNormal.z = -1;\r\n                    }\r\n                    intersects = true;\r\n                }\r\n            }\r\n        }\r\n\r\n        return intersects ? rayEntryDistance : Number.MAX_VALUE;\r\n    }\r\n\r\n    /**\r\n     * 获取包围盒上距离指定点最近的点\r\n     *\r\n     * @param point 指定点\r\n     * @param target 存储最近的点\r\n     */\r\n    closestPointToPoint(point: Vector3, target = new Vector3())\r\n    {\r\n        return this.clampPoint(point, target);\r\n    }\r\n\r\n    /**\r\n     * 清空包围盒\r\n     */\r\n    empty()\r\n    {\r\n        this.min.x = this.min.y = this.min.z = Number(Infinity);\r\n        this.max.x = this.max.y = this.max.z = -Infinity;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 是否为空\r\n     * 当体积为0时为空\r\n     */\r\n    isEmpty()\r\n    {\r\n        return (this.max.x < this.min.x) || (this.max.y < this.min.y) || (this.max.z < this.min.z);\r\n    }\r\n\r\n    /**\r\n     * 偏移\r\n     * @param dx x轴偏移\r\n     * @param dy y轴偏移\r\n     * @param dz z轴偏移\r\n     */\r\n    offset(dx: number, dy: number, dz: number)\r\n    {\r\n        return this.offsetPosition(new Vector3(dx, dy, dz));\r\n    }\r\n\r\n    /**\r\n     * 偏移\r\n     * @param position 偏移量\r\n     */\r\n    offsetPosition(position: Vector3)\r\n    {\r\n        this.min.add(position);\r\n        this.max.add(position);\r\n\r\n        return this;\r\n    }\r\n\r\n    toString(): string\r\n    {\r\n        return `[AABB] (min=${this.min.toString()}, max=${this.max.toString()})`;\r\n    }\r\n\r\n    /**\r\n     * 联合包围盒\r\n     * @param aabb 包围盒\r\n     */\r\n    union(aabb: Box3)\r\n    {\r\n        this.min.min(aabb.min);\r\n        this.max.max(aabb.max);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 是否与球相交\r\n     * @param sphere 球\r\n     */\r\n    intersectsSphere(sphere: Sphere)\r\n    {\r\n        const closestPoint = new Vector3();\r\n\r\n        this.clampPoint(sphere.center, closestPoint);\r\n\r\n        return closestPoint.distanceSquared(sphere.center) <= (sphere.radius * sphere.radius);\r\n    }\r\n\r\n    /**\r\n     * 夹紧？\r\n     *\r\n     * @param point 点\r\n     * @param out 输出点\r\n     */\r\n    clampPoint(point: Vector3, out = new Vector3())\r\n    {\r\n        return out.copy(point).clamp(this.min, this.max);\r\n    }\r\n\r\n    /**\r\n     * 是否与平面相交\r\n     * @param plane 平面\r\n     */\r\n    intersectsPlane(plane: Plane)\r\n    {\r\n        let min = Infinity;\r\n        let max = -Infinity;\r\n\r\n        this.toPoints().forEach((p) =>\r\n        {\r\n            const d = plane.distanceWithPoint(p);\r\n\r\n            min = d < min ? d : min;\r\n            max = d > min ? d : min;\r\n        });\r\n\r\n        return min < 0 && max > 0;\r\n    }\r\n\r\n    /**\r\n     * 是否与三角形相交\r\n     * @param triangle 三角形\r\n     */\r\n    intersectsTriangle(triangle: Triangle3)\r\n    {\r\n        if (this.isEmpty())\r\n        {\r\n            return false;\r\n        }\r\n        // 计算包围盒中心和区段\r\n        const center = this.getCenter();\r\n        const extents = this.max.subTo(center);\r\n\r\n        // 把三角形顶点转换包围盒空间\r\n        const v0 = triangle.p0.subTo(center);\r\n        const v1 = triangle.p1.subTo(center);\r\n        const v2 = triangle.p2.subTo(center);\r\n\r\n        // 计算三边向量\r\n        const f0 = v1.subTo(v0);\r\n        const f1 = v2.subTo(v1);\r\n        const f2 = v0.subTo(v2);\r\n\r\n        // 测试三边向量分别所在三个轴面上的法线\r\n        let axes = [\r\n            0, -f0.z, f0.y, 0, -f1.z, f1.y, 0, -f2.z, f2.y,\r\n            f0.z, 0, -f0.x, f1.z, 0, -f1.x, f2.z, 0, -f2.x,\r\n            -f0.y, f0.x, 0, -f1.y, f1.x, 0, -f2.y, f2.x, 0\r\n        ];\r\n\r\n        if (!satForAxes(axes, v0, v1, v2, extents))\r\n        {\r\n            return false;\r\n        }\r\n\r\n        // 测试三个面法线\r\n        axes = [1, 0, 0, 0, 1, 0, 0, 0, 1];\r\n        if (!satForAxes(axes, v0, v1, v2, extents))\r\n        {\r\n            return false;\r\n        }\r\n        // 检测三角形面法线\r\n        const triangleNormal = f0.crossTo(f1);\r\n\r\n        axes = [triangleNormal.x, triangleNormal.y, triangleNormal.z];\r\n\r\n        return satForAxes(axes, v0, v1, v2, extents);\r\n    }\r\n\r\n    /**\r\n    * 是否与指定长方体相交\r\n    *\r\n    * @param box3 长方体\r\n    */\r\n    overlaps(box3: Box3)\r\n    {\r\n        const l1 = this.min;\r\n        const u1 = this.max;\r\n        const l2 = box3.min;\r\n        const u2 = box3.max;\r\n\r\n        //      l2        u2\r\n        //      |---------|\r\n        // |--------|\r\n        // l1       u1\r\n\r\n        const overlapsX = ((l2.x <= u1.x && u1.x <= u2.x) || (l1.x <= u2.x && u2.x <= u1.x));\r\n        const overlapsY = ((l2.y <= u1.y && u1.y <= u2.y) || (l1.y <= u2.y && u2.y <= u1.y));\r\n        const overlapsZ = ((l2.z <= u1.z && u1.z <= u2.z) || (l1.z <= u2.z && u2.z <= u1.z));\r\n\r\n        return overlapsX && overlapsY && overlapsZ;\r\n    }\r\n\r\n    /**\r\n     * 转换为三角形列表\r\n     */\r\n    toTriangles(triangles: Triangle3[] = [])\r\n    {\r\n        const min = this.min;\r\n        const max = this.max;\r\n\r\n        triangles.push(\r\n            // 前\r\n            Triangle3.fromPoints(new Vector3(min.x, min.y, min.z), new Vector3(min.x, max.y, min.z), new Vector3(max.x, max.y, min.z)),\r\n            Triangle3.fromPoints(new Vector3(min.x, min.y, min.z), new Vector3(max.x, max.y, min.z), new Vector3(max.x, min.y, min.z)),\r\n            // 后\r\n            Triangle3.fromPoints(new Vector3(min.x, min.y, max.z), new Vector3(max.x, min.y, max.z), new Vector3(min.x, max.y, max.z)),\r\n            Triangle3.fromPoints(new Vector3(max.x, min.y, max.z), new Vector3(max.x, max.y, max.z), new Vector3(min.x, max.y, max.z)),\r\n            // 右\r\n            Triangle3.fromPoints(new Vector3(max.x, min.y, min.z), new Vector3(max.x, max.y, min.z), new Vector3(max.x, max.y, max.z)),\r\n            Triangle3.fromPoints(new Vector3(max.x, min.y, min.z), new Vector3(max.x, max.y, max.z), new Vector3(max.x, min.y, max.z)),\r\n            // 左\r\n            Triangle3.fromPoints(new Vector3(min.x, min.y, max.z), new Vector3(min.x, max.y, min.z), new Vector3(min.x, min.y, min.z)),\r\n            Triangle3.fromPoints(new Vector3(min.x, min.y, max.z), new Vector3(min.x, max.y, max.z), new Vector3(min.x, max.y, min.z)),\r\n            // 上\r\n            Triangle3.fromPoints(new Vector3(min.x, max.y, min.z), new Vector3(max.x, max.y, max.z), new Vector3(max.x, max.y, min.z)),\r\n            Triangle3.fromPoints(new Vector3(min.x, max.y, min.z), new Vector3(min.x, max.y, max.z), new Vector3(max.x, max.y, max.z)),\r\n            // 下\r\n            Triangle3.fromPoints(new Vector3(min.x, min.y, min.z), new Vector3(max.x, min.y, min.z), new Vector3(min.x, min.y, max.z)),\r\n            Triangle3.fromPoints(new Vector3(max.x, min.y, min.z), new Vector3(max.x, min.y, max.z), new Vector3(min.x, min.y, max.z)),\r\n        );\r\n\r\n        return triangles;\r\n    }\r\n}\r\n\r\n/**\r\n * 判断三角形三个点是否可能与包围盒在指定轴（列表）上投影相交\r\n *\r\n * @param axes\r\n * @param v0\r\n * @param v1\r\n * @param v2\r\n * @param extents\r\n */\r\nfunction satForAxes(axes: number[], v0: Vector3, v1: Vector3, v2: Vector3, extents: Vector3)\r\n{\r\n    for (let i = 0, j = axes.length - 3; i <= j; i += 3)\r\n    {\r\n        const testAxis = Vector3.fromArray(axes, i);\r\n        // 投影包围盒到指定轴的长度\r\n        const r = extents.x * Math.abs(testAxis.x) + extents.y * Math.abs(testAxis.y) + extents.z * Math.abs(testAxis.z);\r\n        // 投影三角形的三个点到指定轴\r\n        const p0 = v0.dot(testAxis);\r\n        const p1 = v1.dot(testAxis);\r\n        const p2 = v2.dot(testAxis);\r\n        // 三个点在包围盒投影外同侧\r\n\r\n        if (Math.min(p0, p1, p2) > r || Math.max(p0, p1, p2) < -r)\r\n        {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\r\n","import { Matrix4x4 } from './Matrix4x4';\r\nimport { Quaternion } from './Quaternion';\r\nimport { Vector3 } from './Vector3';\r\n\r\ntype NmberArray9 = [\r\n    number, number, number,\r\n    number, number, number,\r\n    number, number, number,\r\n];\r\n\r\n/**\r\n * Matrix3x3 类表示一个转换矩阵，该矩阵确定二维 (2D) 显示对象的位置和方向。\r\n * 该矩阵可以执行转换功能，包括平移（沿 x 和 y 轴重新定位）、旋转和缩放（调整大小）。\r\n * ```\r\n *  ---                                   ---\r\n *  |   scaleX      0         0    |   x轴\r\n *  |     0       scaleY      0    |   y轴\r\n *  |     tx        ty        1    |   平移\r\n *  ---                                   ---\r\n *\r\n *  ---                                   ---\r\n *  |     0         1         2    |   x轴\r\n *  |     3         4         5    |   y轴\r\n *  |     6         7         8    |   平移\r\n *  ---                                   ---\r\n * ```\r\n */\r\nexport class Matrix3x3\r\n{\r\n    /**\r\n     * 长度为9的向量，包含所有的矩阵元素\r\n     */\r\n    elements: NmberArray9;\r\n\r\n    /**\r\n     * 构建3x3矩阵\r\n     *\r\n     * @param elements 九个元素的数组\r\n     */\r\n    constructor(elements: NmberArray9 = [\r\n        1, 0, 0,\r\n        0, 1, 0,\r\n        0, 0, 1])\r\n    {\r\n        this.elements = elements;\r\n    }\r\n\r\n    set(elements: NmberArray9)\r\n    {\r\n        this.elements = elements;\r\n    }\r\n\r\n    /**\r\n     * 设置矩阵为单位矩阵\r\n     */\r\n    identity()\r\n    {\r\n        const e = this.elements;\r\n\r\n        e[0] = 1;\r\n        e[1] = 0;\r\n        e[2] = 0;\r\n\r\n        e[3] = 0;\r\n        e[4] = 1;\r\n        e[5] = 0;\r\n\r\n        e[6] = 0;\r\n        e[7] = 0;\r\n        e[8] = 1;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 将所有元素设置为0\r\n     */\r\n    setZero()\r\n    {\r\n        const e = this.elements;\r\n\r\n        e[0] = 0;\r\n        e[1] = 0;\r\n        e[2] = 0;\r\n        e[3] = 0;\r\n        e[4] = 0;\r\n        e[5] = 0;\r\n        e[6] = 0;\r\n        e[7] = 0;\r\n        e[8] = 0;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 根据一个 Vector3 设置矩阵对角元素\r\n     *\r\n     * @param vec3\r\n     */\r\n    setTrace(vec3: Vector3)\r\n    {\r\n        const e = this.elements;\r\n\r\n        e[0] = vec3.x;\r\n        e[4] = vec3.y;\r\n        e[8] = vec3.z;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 获取矩阵对角元素\r\n     */\r\n    getTrace(target = new Vector3())\r\n    {\r\n        const e = this.elements;\r\n\r\n        target.x = e[0];\r\n        target.y = e[4];\r\n        target.z = e[8];\r\n\r\n        return target;\r\n    }\r\n\r\n    /**\r\n     * 矩阵向量乘法\r\n     *\r\n     * @param v 要乘以的向量\r\n     * @param target 目标保存结果\r\n     */\r\n    vmult(v: Vector3, target = new Vector3())\r\n    {\r\n        const e = this.elements;\r\n        const x = v.x;\r\n        const y = v.y;\r\n        const z = v.z;\r\n\r\n        target.x = e[0] * x + e[1] * y + e[2] * z;\r\n        target.y = e[3] * x + e[4] * y + e[5] * z;\r\n        target.z = e[6] * x + e[7] * y + e[8] * z;\r\n\r\n        return target;\r\n    }\r\n\r\n    /**\r\n     * 矩阵标量乘法\r\n     * @param s\r\n     */\r\n    smult(s: number)\r\n    {\r\n        for (let i = 0; i < this.elements.length; i++)\r\n        {\r\n            this.elements[i] *= s;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 矩阵乘法\r\n     * @param m 要从左边乘的矩阵。\r\n     */\r\n    mmult(m: Matrix3x3, target = new Matrix3x3())\r\n    {\r\n        for (let i = 0; i < 3; i++)\r\n        {\r\n            for (let j = 0; j < 3; j++)\r\n            {\r\n                let sum = 0.0;\r\n\r\n                for (let k = 0; k < 3; k++)\r\n                {\r\n                    sum += m.elements[i + k * 3] * this.elements[k + j * 3];\r\n                }\r\n                target.elements[i + j * 3] = sum;\r\n            }\r\n        }\r\n\r\n        return target;\r\n    }\r\n\r\n    /**\r\n     * 缩放矩阵的每一列\r\n     *\r\n     * @param v\r\n     */\r\n    scale(v: Vector3, target = new Matrix3x3())\r\n    {\r\n        const e = this.elements;\r\n        const t = target.elements;\r\n\r\n        for (let i = 0; i !== 3; i++)\r\n        {\r\n            t[3 * i + 0] = v.x * e[3 * i + 0];\r\n            t[3 * i + 1] = v.y * e[3 * i + 1];\r\n            t[3 * i + 2] = v.z * e[3 * i + 2];\r\n        }\r\n\r\n        return target;\r\n    }\r\n\r\n    /**\r\n     * 解决Ax = b\r\n     *\r\n     * @param b 右手边\r\n     * @param target 结果\r\n     */\r\n    solve(b: Vector3, target = new Vector3())\r\n    {\r\n        // Construct equations\r\n        const nr = 3; // num rows\r\n        const nc = 4; // num cols\r\n        const eqns: number[] = [];\r\n\r\n        let i: number;\r\n        for (i = 0; i < nr * nc; i++)\r\n        {\r\n            eqns.push(0);\r\n        }\r\n        let j: number;\r\n\r\n        for (i = 0; i < 3; i++)\r\n        {\r\n            for (j = 0; j < 3; j++)\r\n            {\r\n                eqns[i + nc * j] = this.elements[i + 3 * j];\r\n            }\r\n        }\r\n        eqns[3 + 4 * 0] = b.x;\r\n        eqns[3 + 4 * 1] = b.y;\r\n        eqns[3 + 4 * 2] = b.z;\r\n\r\n        // 计算矩阵的右上三角型——高斯消去法\r\n        let n = 3; const k = n; let\r\n            np;\r\n        const kp = 4; // num rows\r\n        let p: number;\r\n\r\n        do\r\n        {\r\n            i = k - n;\r\n            if (eqns[i + nc * i] === 0)\r\n            {\r\n                // the pivot is null, swap lines\r\n                for (j = i + 1; j < k; j++)\r\n                {\r\n                    if (eqns[i + nc * j] !== 0)\r\n                    {\r\n                        np = kp;\r\n                        do\r\n                        { // do ligne( i ) = ligne( i ) + ligne( k )\r\n                            p = kp - np;\r\n                            eqns[p + nc * i] += eqns[p + nc * j];\r\n                        } while (--np);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            if (eqns[i + nc * i] !== 0)\r\n            {\r\n                for (j = i + 1; j < k; j++)\r\n                {\r\n                    const multiplier = eqns[i + nc * j] / eqns[i + nc * i];\r\n\r\n                    np = kp;\r\n                    do\r\n                    { // do ligne( k ) = ligne( k ) - multiplier * ligne( i )\r\n                        p = kp - np;\r\n                        eqns[p + nc * j] = p <= i ? 0 : eqns[p + nc * j] - eqns[p + nc * i] * multiplier;\r\n                    } while (--np);\r\n                }\r\n            }\r\n        } while (--n);\r\n\r\n        // Get the solution\r\n        target.z = eqns[2 * nc + 3] / eqns[2 * nc + 2];\r\n        target.y = (eqns[Number(nc) + 3] - eqns[Number(nc) + 2] * target.z) / eqns[Number(nc) + 1];\r\n        target.x = (eqns[0 * nc + 3] - eqns[0 * nc + 2] * target.z - eqns[0 * nc + 1] * target.y) / eqns[0 * nc + 0];\r\n\r\n        if (isNaN(target.x) || isNaN(target.y) || isNaN(target.z) || target.x === Infinity || target.y === Infinity || target.z === Infinity)\r\n        {\r\n            throw `Could not solve equation! Got x=[${target.toString()}], b=[${b.toString()}], A=[${this.toString()}]`;\r\n        }\r\n\r\n        return target;\r\n    }\r\n\r\n    /**\r\n     * 获取指定行列元素值\r\n     *\r\n     * @param row\r\n     * @param column\r\n     */\r\n    getElement(row: number, column: number)\r\n    {\r\n        return this.elements[column + 3 * row];\r\n    }\r\n\r\n    /**\r\n     * 设置指定行列元素值\r\n     *\r\n     * @param row\r\n     * @param column\r\n     * @param value\r\n     */\r\n    setElement(row: number, column: number, value: number)\r\n    {\r\n        this.elements[column + 3 * row] = value;\r\n    }\r\n\r\n    /**\r\n     * 将另一个矩阵复制到这个矩阵对象中\r\n     *\r\n     * @param source\r\n     */\r\n    copy(source: Matrix3x3)\r\n    {\r\n        for (let i = 0; i < source.elements.length; i++)\r\n        {\r\n            this.elements[i] = source.elements[i];\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 返回矩阵的字符串表示形式\r\n     */\r\n    toString()\r\n    {\r\n        let r = '';\r\n        const sep = ',';\r\n\r\n        for (let i = 0; i < 9; i++)\r\n        {\r\n            r += this.elements[i] + sep;\r\n        }\r\n\r\n        return r;\r\n    }\r\n\r\n    /**\r\n     * 逆矩阵\r\n     */\r\n    reverse()\r\n    {\r\n        // Construct equations\r\n        const nr = 3; // num rows\r\n        const nc = 6; // num cols\r\n        const eqns = [];\r\n\r\n        let i: number;\r\n        let j: number;\r\n        for (let i = 0; i < nr * nc; i++)\r\n        {\r\n            eqns.push(0);\r\n        }\r\n\r\n        for (i = 0; i < 3; i++)\r\n        {\r\n            for (j = 0; j < 3; j++)\r\n            {\r\n                eqns[i + nc * j] = this.elements[i + 3 * j];\r\n            }\r\n        }\r\n        eqns[3 + 6 * 0] = 1;\r\n        eqns[3 + 6 * 1] = 0;\r\n        eqns[3 + 6 * 2] = 0;\r\n        eqns[4 + 6 * 0] = 0;\r\n        eqns[4 + 6 * 1] = 1;\r\n        eqns[4 + 6 * 2] = 0;\r\n        eqns[5 + 6 * 0] = 0;\r\n        eqns[5 + 6 * 1] = 0;\r\n        eqns[5 + 6 * 2] = 1;\r\n\r\n        // Compute right upper triangular version of the matrix - Gauss elimination\r\n        let n = 3; const k = n; let\r\n            np: number;\r\n        const kp = nc; // num rows\r\n        let p: number;\r\n\r\n        do\r\n        {\r\n            i = k - n;\r\n            if (eqns[i + nc * i] === 0)\r\n            {\r\n                // the pivot is null, swap lines\r\n                for (j = i + 1; j < k; j++)\r\n                {\r\n                    if (eqns[i + nc * j] !== 0)\r\n                    {\r\n                        np = kp;\r\n                        do\r\n                        { // do line( i ) = line( i ) + line( k )\r\n                            p = kp - np;\r\n                            eqns[p + nc * i] += eqns[p + nc * j];\r\n                        } while (--np);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            if (eqns[i + nc * i] !== 0)\r\n            {\r\n                for (j = i + 1; j < k; j++)\r\n                {\r\n                    const multiplier = eqns[i + nc * j] / eqns[i + nc * i];\r\n\r\n                    np = kp;\r\n                    do\r\n                    { // do line( k ) = line( k ) - multiplier * line( i )\r\n                        p = kp - np;\r\n                        eqns[p + nc * j] = p <= i ? 0 : eqns[p + nc * j] - eqns[p + nc * i] * multiplier;\r\n                    } while (--np);\r\n                }\r\n            }\r\n        } while (--n);\r\n\r\n        // eliminate the upper left triangle of the matrix\r\n        i = 2;\r\n        do\r\n        {\r\n            j = i - 1;\r\n            do\r\n            {\r\n                const multiplier = eqns[i + nc * j] / eqns[i + nc * i];\r\n\r\n                np = nc;\r\n                do\r\n                {\r\n                    p = nc - np;\r\n                    eqns[p + nc * j] = eqns[p + nc * j] - eqns[p + nc * i] * multiplier;\r\n                } while (--np);\r\n            } while (j--);\r\n        } while (--i);\r\n\r\n        // operations on the diagonal\r\n        i = 2;\r\n        do\r\n        {\r\n            const multiplier = 1 / eqns[i + nc * i];\r\n\r\n            np = nc;\r\n            do\r\n            {\r\n                p = nc - np;\r\n                eqns[p + nc * i] = eqns[p + nc * i] * multiplier;\r\n            } while (--np);\r\n        } while (i--);\r\n\r\n        i = 2;\r\n        do\r\n        {\r\n            j = 2;\r\n            do\r\n            {\r\n                p = eqns[nr + j + nc * i];\r\n                if (isNaN(p) || p === Infinity)\r\n                {\r\n                    throw `Could not reverse! A=[${this.toString()}]`;\r\n                }\r\n                this.setElement(i, j, p);\r\n            } while (j--);\r\n        } while (i--);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 逆矩阵\r\n     */\r\n    reverseTo(target = new Matrix3x3())\r\n    {\r\n        return target.copy(this).reverse();\r\n    }\r\n\r\n    /**\r\n     * 从四元数设置矩阵\r\n     *\r\n     * @param q\r\n     */\r\n    setRotationFromQuaternion(q: Quaternion)\r\n    {\r\n        const x = q.x; const y = q.y; const z = q.z; const w = q.w;\r\n        const x2 = x + x; const y2 = y + y; const z2 = z + z;\r\n        const xx = x * x2; const xy = x * y2; const xz = x * z2;\r\n        const yy = y * y2; const yz = y * z2; const zz = z * z2;\r\n        const wx = w * x2; const wy = w * y2; const wz = w * z2;\r\n        const e = this.elements;\r\n\r\n        e[3 * 0 + 0] = 1 - (yy + zz);\r\n        e[3 * 0 + 1] = xy - wz;\r\n        e[3 * 0 + 2] = xz + wy;\r\n\r\n        e[3 * 1 + 0] = xy + wz;\r\n        e[3 * 1 + 1] = 1 - (xx + zz);\r\n        e[3 * 1 + 2] = yz - wx;\r\n\r\n        e[3 * 2 + 0] = xz - wy;\r\n        e[3 * 2 + 1] = yz + wx;\r\n        e[3 * 2 + 2] = 1 - (xx + yy);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 转置矩阵\r\n     */\r\n    transpose()\r\n    {\r\n        const Mt = this.elements;\r\n        const M = this.elements.concat();\r\n\r\n        for (let i = 0; i !== 3; i++)\r\n        {\r\n            for (let j = 0; j !== 3; j++)\r\n            {\r\n                Mt[3 * i + j] = M[3 * j + i];\r\n            }\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 转置矩阵\r\n     */\r\n    transposeTo(target = new Matrix3x3())\r\n    {\r\n        return target.copy(this).transpose();\r\n    }\r\n\r\n    formMatrix4x4(matrix4x4: Matrix4x4)\r\n    {\r\n        const arr4 = matrix4x4.elements;\r\n        const arr3 = this.elements;\r\n\r\n        arr3[0] = arr4[0];\r\n        arr3[1] = arr4[1];\r\n        arr3[2] = arr4[2];\r\n\r\n        arr3[3] = arr4[4];\r\n        arr3[4] = arr4[5];\r\n        arr3[5] = arr4[6];\r\n\r\n        arr3[6] = arr4[8];\r\n        arr3[7] = arr4[9];\r\n        arr3[8] = arr4[10];\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 转换为4x4矩阵\r\n     *\r\n     * @param outMatrix4x4 4x4矩阵\r\n     */\r\n    toMatrix4x4(outMatrix4x4: Matrix4x4)\r\n    {\r\n        const outdata = outMatrix4x4.elements;\r\n        const indata = this.elements;\r\n\r\n        outdata[0] = indata[0];\r\n        outdata[1] = indata[1];\r\n        outdata[2] = 0;\r\n        outdata[3] = 0;\r\n\r\n        outdata[4] = indata[3];\r\n        outdata[5] = indata[4];\r\n        outdata[6] = 0;\r\n        outdata[7] = 0;\r\n\r\n        outdata[8] = 0;\r\n        outdata[9] = 0;\r\n        outdata[10] = 1;\r\n        outdata[11] = 0;\r\n\r\n        outdata[12] = indata[6];\r\n        outdata[13] = indata[7];\r\n        outdata[14] = 0;\r\n        outdata[15] = 1;\r\n\r\n        return outMatrix4x4;\r\n    }\r\n\r\n    /**\r\n     * 转换为数组\r\n     * @param array 数组\r\n     * @param offset 偏移\r\n     */\r\n    toArray(array: number[] = [], offset = 0)\r\n    {\r\n        this.elements.forEach((v, i) =>\r\n        {\r\n            array[offset + i] = v;\r\n        });\r\n\r\n        return array;\r\n    }\r\n}\r\n","import { mathUtil } from '@feng3d/polyfill';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { RotationOrder } from '../enums/RotationOrder';\r\nimport type { Matrix4x4 } from './Matrix4x4';\r\nimport { Vector3 } from './Vector3';\r\n\r\ndeclare global\r\n{\r\n    interface MixinsQuaternion\r\n    {\r\n\r\n    }\r\n}\r\n\r\nexport interface Quaternion extends MixinsQuaternion { }\r\n\r\n/**\r\n * 可用于表示旋转的四元数对象\r\n */\r\nexport class Quaternion\r\n{\r\n    static fromArray(array: ArrayLike<number>, offset = 0)\r\n    {\r\n        return new Quaternion().fromArray(array, offset);\r\n    }\r\n\r\n    /**\r\n     * 随机四元数\r\n     */\r\n    static random()\r\n    {\r\n        return new Quaternion().fromEuler(Math.PI * 2 * Math.random(), Math.PI * 2 * Math.random(), Math.PI * 2 * Math.random());\r\n    }\r\n\r\n    /**\r\n     * 虚基向量i的乘子\r\n     */\r\n    @serialize\r\n    x = 0;\r\n\r\n    /**\r\n     * 虚基向量j的乘子\r\n     */\r\n    @serialize\r\n    y = 0;\r\n\r\n    /**\r\n     * 虚基向量k的乘子\r\n     */\r\n    @serialize\r\n    z = 0;\r\n\r\n    /**\r\n     * 实部的乘数\r\n     */\r\n    @serialize\r\n    w = 1;\r\n\r\n    /**\r\n     * 四元数描述三维空间中的旋转。四元数的数学定义为Q = x*i + y*j + z*k + w，其中(i,j,k)为虚基向量。(x,y,z)可以看作是一个与旋转轴相关的向量，而实际的乘法器w与旋转量相关。\r\n     *\r\n     * @param x 虚基向量i的乘子\r\n     * @param y 虚基向量j的乘子\r\n     * @param z 虚基向量k的乘子\r\n     * @param w 实部的乘数\r\n     */\r\n    constructor(x = 0, y = 0, z = 0, w = 1)\r\n    {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n        this.w = w;\r\n    }\r\n\r\n    /**\r\n     * 返回四元数对象的大小\r\n     */\r\n    get magnitude(): number\r\n    {\r\n        return Math.sqrt((this.w * this.w) + (this.x * this.x) + (this.y * this.y) + (this.z * this.z));\r\n    }\r\n\r\n    /**\r\n     * 设置四元数的值。\r\n     *\r\n     * @param x 虚基向量i的乘子\r\n     * @param y 虚基向量j的乘子\r\n     * @param z 虚基向量k的乘子\r\n     * @param w 实部的乘数\r\n     */\r\n    set(x = 0, y = 0, z = 0, w = 1)\r\n    {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n        this.w = w;\r\n\r\n        return this;\r\n    }\r\n\r\n    fromArray(array: ArrayLike<number>, offset = 0)\r\n    {\r\n        this.x = array[offset];\r\n        this.y = array[offset + 1];\r\n        this.z = array[offset + 2];\r\n        this.w = array[offset + 3];\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 转换为数组\r\n     *\r\n     * @param array\r\n     * @param offset\r\n     */\r\n    toArray(array?: number[], offset = 0)\r\n    {\r\n        array = array || [];\r\n        array[offset] = this.x;\r\n        array[offset + 1] = this.y;\r\n        array[offset + 2] = this.z;\r\n        array[offset + 3] = this.w;\r\n\r\n        return array;\r\n    }\r\n\r\n    /**\r\n     * 四元数乘法\r\n     *\r\n     * @param q\r\n     * @param this\r\n     */\r\n    mult(q: Quaternion)\r\n    {\r\n        const ax = this.x;\r\n        const ay = this.y;\r\n        const az = this.z;\r\n        const aw = this.w;\r\n        const bx = q.x;\r\n        const by = q.y;\r\n        const bz = q.z;\r\n        const bw = q.w;\r\n\r\n        this.x = (ax * bw) + (aw * bx) + (ay * bz) - (az * by);\r\n        this.y = (ay * bw) + (aw * by) + (az * bx) - (ax * bz);\r\n        this.z = (az * bw) + (aw * bz) + (ax * by) - (ay * bx);\r\n        this.w = (aw * bw) - (ax * bx) - (ay * by) - (az * bz);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 四元数乘法\r\n     *\r\n     * @param q\r\n     * @param target\r\n     */\r\n    multTo(q: Quaternion, target = new Quaternion())\r\n    {\r\n        return target.copy(this).mult(q);\r\n    }\r\n\r\n    /**\r\n     * 获取逆四元数（共轭四元数）\r\n     */\r\n    inverse()\r\n    {\r\n        this.x = -this.x;\r\n        this.y = -this.y;\r\n        this.z = -this.z;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 获取逆四元数（共轭四元数）\r\n     *\r\n     * @param target\r\n     */\r\n    inverseTo(target = new Quaternion())\r\n    {\r\n        return target.copy(this).inverse();\r\n    }\r\n\r\n    multiplyVector(vector: Vector3, target = new Quaternion())\r\n    {\r\n        const x2 = vector.x;\r\n        const y2 = vector.y;\r\n        const z2 = vector.z;\r\n\r\n        target.w = -(this.x * x2) - (this.y * y2) - (this.z * z2);\r\n        target.x = (this.w * x2) + (this.y * z2) - (this.z * y2);\r\n        target.y = (this.w * y2) - (this.x * z2) + (this.z * x2);\r\n        target.z = (this.w * z2) + (this.x * y2) - (this.y * x2);\r\n\r\n        return target;\r\n    }\r\n\r\n    /**\r\n     * 用表示给定绕向量旋转的值填充四元数对象。\r\n     *\r\n     * @param axis 要绕其旋转的轴\r\n     * @param angle 以弧度为单位的旋转角度。\r\n     */\r\n    fromAxisAngle(axis: Vector3, angle: number)\r\n    {\r\n        const sinA = Math.sin(angle / 2);\r\n        const cosA = Math.cos(angle / 2);\r\n\r\n        this.x = axis.x * sinA;\r\n        this.y = axis.y * sinA;\r\n        this.z = axis.z * sinA;\r\n        this.w = cosA;\r\n        this.normalize();\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 将四元数转换为轴/角表示形式\r\n     *\r\n     * @param targetAxis 要重用的向量对象，用于存储轴\r\n     * @returns 一个数组，第一个元素是轴，第二个元素是弧度\r\n     */\r\n    toAxisAngle(targetAxis = new Vector3())\r\n    {\r\n        this.normalize(); // 如果w>1 acos和sqrt会产生错误，那么如果四元数被标准化，就不会发生这种情况\r\n        const angle = 2 * Math.acos(this.w);\r\n        const s = Math.sqrt(1 - (this.w * this.w)); // 假设四元数归一化了，那么w小于1，所以项总是正的。\r\n\r\n        if (s < 0.001)\r\n        { // 为了避免除以零，s总是正的，因为是根号\r\n            // 如果s接近于零，那么轴的方向就不重要了\r\n            targetAxis.x = this.x; // 如果轴归一化很重要，则用x=1替换;y = z = 0;\r\n            targetAxis.y = this.y;\r\n            targetAxis.z = this.z;\r\n        }\r\n        else\r\n        {\r\n            targetAxis.x = this.x / s; // 法线轴\r\n            targetAxis.y = this.y / s;\r\n            targetAxis.z = this.z / s;\r\n        }\r\n\r\n        return [targetAxis, angle];\r\n    }\r\n\r\n    /**\r\n     * 给定两个单位向量，设置四元数值。得到的旋转将是将u旋转到v所需要的旋转。\r\n     *\r\n     * @param u 表示起始方向的单位向量。\r\n     * @param v 表示终止方向的单位向量。\r\n     */\r\n    fromUnitVectors(u: Vector3, v: Vector3)\r\n    {\r\n        let r = u.dot(v) + 1;\r\n\r\n        if (r < mathUtil.PRECISION)\r\n        {\r\n            r = 0;\r\n\r\n            if (Math.abs(u.x) > Math.abs(u.z))\r\n            {\r\n                this.x = -u.y;\r\n                this.y = u.x;\r\n                this.z = 0;\r\n                this.w = r;\r\n            }\r\n            else\r\n            {\r\n                this.x = 0;\r\n                this.y = -u.z;\r\n                this.z = u.y;\r\n                this.w = r;\r\n            }\r\n        }\r\n        else\r\n        {\r\n            const a = u.crossTo(v);\r\n\r\n            this.x = a.x;\r\n            this.y = a.y;\r\n            this.z = a.z;\r\n            this.w = r;\r\n        }\r\n        this.normalize();\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 与目标四元数之间进行球面内插，提供了具有恒定角度变化率的旋转之间的内插。\r\n     * @param qb 目标四元素\r\n     * @param t 插值权值，一个介于0和1之间的值。\r\n     */\r\n    slerp(qb: Quaternion, t: number)\r\n    {\r\n        if (t === 0) return this;\r\n        if (t === 1) return this.copy(qb);\r\n\r\n        const x = this.x;\r\n        const y = this.y;\r\n        const z = this.z;\r\n        const w = this.w;\r\n\r\n        // http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/\r\n\r\n        let cosHalfTheta = (w * qb.w) + (x * qb.x) + (y * qb.y) + (z * qb.z);\r\n\r\n        if (cosHalfTheta < 0)\r\n        {\r\n            this.w = -qb.w;\r\n            this.x = -qb.x;\r\n            this.y = -qb.y;\r\n            this.z = -qb.z;\r\n\r\n            cosHalfTheta = -cosHalfTheta;\r\n        }\r\n        else\r\n        {\r\n            this.copy(qb);\r\n        }\r\n\r\n        if (cosHalfTheta >= 1.0)\r\n        {\r\n            this.w = w;\r\n            this.x = x;\r\n            this.y = y;\r\n            this.z = z;\r\n\r\n            return this;\r\n        }\r\n\r\n        const sqrSinHalfTheta = 1.0 - (cosHalfTheta * cosHalfTheta);\r\n\r\n        if (sqrSinHalfTheta <= Number.EPSILON)\r\n        {\r\n            const s = 1 - t;\r\n\r\n            this.w = (s * w) + (t * this.w);\r\n            this.x = (s * x) + (t * this.x);\r\n            this.y = (s * y) + (t * this.y);\r\n            this.z = (s * z) + (t * this.z);\r\n\r\n            this.normalize();\r\n\r\n            return this;\r\n        }\r\n\r\n        const sinHalfTheta = Math.sqrt(sqrSinHalfTheta);\r\n        const halfTheta = Math.atan2(sinHalfTheta, cosHalfTheta);\r\n        const ratioA = Math.sin((1 - t) * halfTheta) / sinHalfTheta;\r\n        const ratioB = Math.sin(t * halfTheta) / sinHalfTheta;\r\n\r\n        this.w = ((w * ratioA) + (this.w * ratioB));\r\n        this.x = ((x * ratioA) + (this.x * ratioB));\r\n        this.y = ((y * ratioA) + (this.y * ratioB));\r\n        this.z = ((z * ratioA) + (this.z * ratioB));\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 与目标四元数之间进行球面内插，提供了具有恒定角度变化率的旋转之间的内插。\r\n     * @param qb 目标四元素\r\n     * @param t 插值权值，一个介于0和1之间的值。\r\n     * @param out 保存插值结果\r\n     */\r\n    slerpTo(qb: Quaternion, t: number, out = new Quaternion())\r\n    {\r\n        if (qb === out) qb = qb.clone();\r\n\r\n        return out.copy(this).slerp(qb, t);\r\n    }\r\n\r\n    /**\r\n     * 线性求插值\r\n     * @param qa 第一个四元素\r\n     * @param qb 第二个四元素\r\n     * @param t 权重\r\n     */\r\n    lerp(qa: Quaternion, qb: Quaternion, t: number)\r\n    {\r\n        const w1 = qa.w;\r\n        const x1 = qa.x;\r\n        const y1 = qa.y;\r\n        const z1 = qa.z;\r\n        let w2 = qb.w;\r\n        let x2 = qb.x;\r\n        let y2 = qb.y;\r\n        let z2 = qb.z;\r\n\r\n        // shortest direction\r\n        if ((w1 * w2) + (x1 * x2) + (y1 * y2) + (z1 * z2) < 0)\r\n        {\r\n            w2 = -w2;\r\n            x2 = -x2;\r\n            y2 = -y2;\r\n            z2 = -z2;\r\n        }\r\n\r\n        this.w = w1 + (t * (w2 - w1));\r\n        this.x = x1 + (t * (x2 - x1));\r\n        this.y = y1 + (t * (y2 - y1));\r\n        this.z = z1 + (t * (z2 - z1));\r\n\r\n        const len = 1.0 / Math.sqrt((this.w * this.w) + (this.x * this.x) + (this.y * this.y) + (this.z * this.z));\r\n\r\n        this.w *= len;\r\n        this.x *= len;\r\n        this.y *= len;\r\n        this.z *= len;\r\n    }\r\n\r\n    /**\r\n     * Fills a target Vector3 object with the Euler angles that form the rotation represented by this quaternion.\r\n     * @param target An optional Vector3 object to contain the Euler angles. If not provided, a new object is created.\r\n     * @returns The Vector3 containing the Euler angles.\r\n     */\r\n    toEulerAngles(target?: Vector3): Vector3\r\n    {\r\n        target = target || new Vector3();\r\n        target.x = Math.atan2(2 * ((this.w * this.x) + (this.y * this.z)), 1 - (2 * ((this.x * this.x) + (this.y * this.y))));\r\n        let asinvalue = 2 * ((this.w * this.y) - (this.z * this.x));\r\n        // 防止超出范围，获取NaN值\r\n\r\n        asinvalue = Math.max(-1, Math.min(asinvalue, 1));\r\n        target.y = Math.asin(asinvalue);\r\n        target.z = Math.atan2(2 * ((this.w * this.z) + (this.x * this.y)), 1 - (2 * ((this.y * this.y) + (this.z * this.z))));\r\n\r\n        return target;\r\n    }\r\n\r\n    /**\r\n     * 四元数归一化\r\n     */\r\n    normalize(val = 1)\r\n    {\r\n        let l = (this.x * this.x) + (this.y * this.y) + (this.z * this.z) + (this.w * this.w);\r\n\r\n        if (l === 0)\r\n        {\r\n            this.x = 0;\r\n            this.y = 0;\r\n            this.z = 0;\r\n            this.w = 1;\r\n        }\r\n        else\r\n        {\r\n            l = Math.sqrt(l);\r\n            l = val / l;\r\n            this.x *= l;\r\n            this.y *= l;\r\n            this.z *= l;\r\n            this.w *= l;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 四元数归一化的近似。当quat已经几乎标准化时，效果最好。\r\n     *\r\n     * @see http://jsperf.com/fast-quaternion-normalization\r\n     * @author unphased, https://github.com/unphased\r\n     */\r\n    normalizeFast()\r\n    {\r\n        const f = (3.0 - ((this.x * this.x) + (this.y * this.y) + (this.z * this.z) + (this.w * this.w))) / 2.0;\r\n\r\n        if (f === 0)\r\n        {\r\n            this.x = 0;\r\n            this.y = 0;\r\n            this.z = 0;\r\n            this.w = 0;\r\n        }\r\n        else\r\n        {\r\n            this.x *= f;\r\n            this.y *= f;\r\n            this.z *= f;\r\n            this.w *= f;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 转换为可读格式\r\n     */\r\n    toString()\r\n    {\r\n        return `{this.x:${this.x} this.y:${this.y} this.z:${this.z} this.w:${this.w}}`;\r\n    }\r\n\r\n    /**\r\n     * 从矩阵初始化四元素\r\n     *\r\n     * @param matrix 矩阵\r\n     */\r\n    fromMatrix(matrix: Matrix4x4)\r\n    {\r\n        const v: Vector3 = matrix.toTRS()[1];\r\n\r\n        this.fromEuler(v.x, v.y, v.z);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 克隆\r\n     */\r\n    clone()\r\n    {\r\n        return new Quaternion(this.x, this.y, this.z, this.w);\r\n    }\r\n\r\n    /**\r\n     * 旋转一个顶点\r\n     *\r\n     * @param point 被旋转的顶点\r\n     * @param target 旋转结果\r\n     */\r\n    rotatePoint(point: Vector3, target = new Vector3())\r\n    {\r\n        const x2 = point.x;\r\n        const y2 = point.y;\r\n        const z2 = point.z;\r\n\r\n        // p*q'\r\n        const w1 = -(this.x * x2) - (this.y * y2) - (this.z * z2);\r\n        const x1 = (this.w * x2) + (this.y * z2) - (this.z * y2);\r\n        const y1 = (this.w * y2) - (this.x * z2) + (this.z * x2);\r\n        const z1 = (this.w * z2) + (this.x * y2) - (this.y * x2);\r\n\r\n        target.x = -(w1 * this.x) + (x1 * this.w) - (y1 * this.z) + (z1 * this.y);\r\n        target.y = -(w1 * this.y) + (x1 * this.z) + (y1 * this.w) - (z1 * this.x);\r\n        target.z = -(w1 * this.z) - (x1 * this.y) + (y1 * this.x) + (z1 * this.w);\r\n\r\n        return target;\r\n    }\r\n\r\n    /**\r\n     * 旋转一个绝对方向四元数给定一个角速度和一个时间步长\r\n     *\r\n     * @param angularVelocity\r\n     * @param dt\r\n     * @param angularFactor\r\n     */\r\n    integrate(angularVelocity: Vector3, dt: number, angularFactor: Vector3)\r\n    {\r\n        const ax = angularVelocity.x * angularFactor.x;\r\n        const ay = angularVelocity.y * angularFactor.y;\r\n        const az = angularVelocity.z * angularFactor.z;\r\n        const bx = this.x;\r\n        const by = this.y;\r\n        const bz = this.z;\r\n        const bw = this.w;\r\n\r\n        const halfDt = dt * 0.5;\r\n\r\n        this.x += halfDt * ((ax * bw) + (ay * bz) - (az * by));\r\n        this.y += halfDt * ((ay * bw) + (az * bx) - (ax * bz));\r\n        this.z += halfDt * ((az * bw) + (ax * by) - (ay * bx));\r\n        this.w += halfDt * (-(ax * bx) - (ay * by) - (az * bz));\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 旋转一个绝对方向四元数给定一个角速度和一个时间步长\r\n     *\r\n     * @param angularVelocity\r\n     * @param dt\r\n     * @param angularFactor\r\n     * @param target\r\n     */\r\n    integrateTo(angularVelocity: Vector3, dt: number, angularFactor: Vector3, target = new Quaternion())\r\n    {\r\n        return target.copy(this).integrate(angularVelocity, dt, angularFactor);\r\n    }\r\n\r\n    /**\r\n     * 将源的值复制到此四元数\r\n     *\r\n     * @param q 要复制的四元数\r\n     */\r\n    copy(q: Quaternion)\r\n    {\r\n        this.x = q.x;\r\n        this.y = q.y;\r\n        this.z = q.z;\r\n        this.w = q.w;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Multiply the quaternion by a vector\r\n     * @param v\r\n     * @param target Optional\r\n     */\r\n    vmult(v: Vector3, target = new Vector3())\r\n    {\r\n        const x = v.x;\r\n        const y = v.y;\r\n        const z = v.z;\r\n\r\n        const qx = this.x;\r\n        const qy = this.y;\r\n        const qz = this.z;\r\n        const qw = this.w;\r\n\r\n        // q*v\r\n        const ix = (qw * x) + (qy * z) - (qz * y);\r\n        const iy = (qw * y) + (qz * x) - (qx * z);\r\n        const iz = (qw * z) + (qx * y) - (qy * x);\r\n        const iw = -(qx * x) - (qy * y) - (qz * z);\r\n\r\n        target.x = (ix * qw) + (iw * -qx) + (iy * -qz) - (iz * -qy);\r\n        target.y = (iy * qw) + (iw * -qy) + (iz * -qx) - (ix * -qz);\r\n        target.z = (iz * qw) + (iw * -qz) + (ix * -qy) - (iy * -qx);\r\n\r\n        return target;\r\n    }\r\n\r\n    /**\r\n     * Convert the quaternion to euler angle representation. Order: YZX, as this page describes: http://www.euclideanspace.com/maths/standards/index.htm\r\n     * @param target\r\n     * @param order Three-character string e.g. \"YZX\", which also is default.\r\n     */\r\n    toEuler(target: Vector3, order = 'YZX')\r\n    {\r\n        let heading: number;\r\n        let attitude: number;\r\n        let bank: number;\r\n        let test: number;\r\n        const x = this.x;\r\n        const y = this.y;\r\n        const z = this.z;\r\n        const w = this.w;\r\n\r\n        switch (order)\r\n        {\r\n            case 'YZX':\r\n                test = (x * y) + (z * w);\r\n\r\n                if (test > 0.499)\r\n                { // singularity at north pole\r\n                    heading = 2 * Math.atan2(x, w);\r\n                    attitude = Math.PI / 2;\r\n                    bank = 0;\r\n                }\r\n                if (test < -0.499)\r\n                { // singularity at south pole\r\n                    heading = -2 * Math.atan2(x, w);\r\n                    attitude = -Math.PI / 2;\r\n                    bank = 0;\r\n                }\r\n                if (isNaN(heading))\r\n                {\r\n                    const sqx = x * x;\r\n                    const sqy = y * y;\r\n                    const sqz = z * z;\r\n\r\n                    heading = Math.atan2((2 * y * w) - (2 * x * z), 1 - (2 * sqy) - (2 * sqz)); // Heading\r\n                    attitude = Math.asin(2 * test); // attitude\r\n                    bank = Math.atan2((2 * x * w) - (2 * y * z), 1 - (2 * sqx) - (2 * sqz)); // bank\r\n                }\r\n                break;\r\n            default:\r\n                throw new Error(`Euler order ${order} not supported yet.`);\r\n        }\r\n\r\n        target.y = heading;\r\n        target.z = attitude;\r\n        target.x = bank;\r\n    }\r\n\r\n    /**\r\n     * 从欧拉角初始化四元素。\r\n     *\r\n     * @param x 围绕X轴旋转角度。\r\n     * @param y 围绕Y轴旋转角度。\r\n     * @param z 围绕Z轴旋转角度。\r\n     * @param order X、Y、Z轴旋顺序。\r\n     *\r\n     * @see http://www.mathworks.com/matlabcentral/fileexchange/20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/content/SpinCalc.m\r\n     */\r\n    fromEuler(x: number, y: number, z: number, order: RotationOrder = mathUtil.DefaultRotationOrder)\r\n    {\r\n        // 角度转换为弧度\r\n        x = x * mathUtil.DEG2RAD;\r\n        y = y * mathUtil.DEG2RAD;\r\n        z = z * mathUtil.DEG2RAD;\r\n\r\n        const cosX = Math.cos(x / 2);\r\n        const coxY = Math.cos(y / 2);\r\n        const cosZ = Math.cos(z / 2);\r\n        const sinX = Math.sin(x / 2);\r\n        const sinY = Math.sin(y / 2);\r\n        const sinZ = Math.sin(z / 2);\r\n\r\n        if (order === RotationOrder.XYZ)\r\n        {\r\n            this.x = (sinX * coxY * cosZ) + (cosX * sinY * sinZ);\r\n            this.y = (cosX * sinY * cosZ) - (sinX * coxY * sinZ);\r\n            this.z = (cosX * coxY * sinZ) + (sinX * sinY * cosZ);\r\n            this.w = (cosX * coxY * cosZ) - (sinX * sinY * sinZ);\r\n        }\r\n        else if (order === RotationOrder.YXZ)\r\n        {\r\n            this.x = (sinX * coxY * cosZ) + (cosX * sinY * sinZ);\r\n            this.y = (cosX * sinY * cosZ) - (sinX * coxY * sinZ);\r\n            this.z = (cosX * coxY * sinZ) - (sinX * sinY * cosZ);\r\n            this.w = (cosX * coxY * cosZ) + (sinX * sinY * sinZ);\r\n        }\r\n        else if (order === RotationOrder.ZXY)\r\n        {\r\n            this.x = (sinX * coxY * cosZ) - (cosX * sinY * sinZ);\r\n            this.y = (cosX * sinY * cosZ) + (sinX * coxY * sinZ);\r\n            this.z = (cosX * coxY * sinZ) + (sinX * sinY * cosZ);\r\n            this.w = (cosX * coxY * cosZ) - (sinX * sinY * sinZ);\r\n        }\r\n        else if (order === RotationOrder.ZYX)\r\n        {\r\n            this.x = (sinX * coxY * cosZ) - (cosX * sinY * sinZ);\r\n            this.y = (cosX * sinY * cosZ) + (sinX * coxY * sinZ);\r\n            this.z = (cosX * coxY * sinZ) - (sinX * sinY * cosZ);\r\n            this.w = (cosX * coxY * cosZ) + (sinX * sinY * sinZ);\r\n        }\r\n        else if (order === RotationOrder.YZX)\r\n        {\r\n            this.x = (sinX * coxY * cosZ) + (cosX * sinY * sinZ);\r\n            this.y = (cosX * sinY * cosZ) + (sinX * coxY * sinZ);\r\n            this.z = (cosX * coxY * sinZ) - (sinX * sinY * cosZ);\r\n            this.w = (cosX * coxY * cosZ) - (sinX * sinY * sinZ);\r\n        }\r\n        else if (order === RotationOrder.XZY)\r\n        {\r\n            this.x = (sinX * coxY * cosZ) - (cosX * sinY * sinZ);\r\n            this.y = (cosX * sinY * cosZ) - (sinX * coxY * sinZ);\r\n            this.z = (cosX * coxY * sinZ) + (sinX * sinY * cosZ);\r\n            this.w = (cosX * coxY * cosZ) + (sinX * sinY * sinZ);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 与指定四元素比较是否相等。\r\n     *\r\n     * @param v 比较的向量。\r\n     * @param precision 允许误差。\r\n     * @returns 相等返回true，否则false。\r\n     */\r\n    equals(v: Quaternion, precision = mathUtil.PRECISION)\r\n    {\r\n        // 四元素与四元素的负值等价。 {1,2,3,4} === {-1,-2,-3,-4}\r\n        if (this.x * v.x > 0)\r\n        {\r\n            if (!mathUtil.equals(this.x - v.x, 0, precision))\r\n            {\r\n                return false;\r\n            }\r\n            if (!mathUtil.equals(this.y - v.y, 0, precision))\r\n            {\r\n                return false;\r\n            }\r\n            if (!mathUtil.equals(this.z - v.z, 0, precision))\r\n            {\r\n                return false;\r\n            }\r\n            if (!mathUtil.equals(this.w - v.w, 0, precision))\r\n            {\r\n                return false;\r\n            }\r\n        }\r\n        else\r\n        {\r\n            if (!mathUtil.equals(this.x + v.x, 0, precision))\r\n            {\r\n                return false;\r\n            }\r\n            if (!mathUtil.equals(this.y + v.y, 0, precision))\r\n            {\r\n                return false;\r\n            }\r\n            if (!mathUtil.equals(this.z + v.z, 0, precision))\r\n            {\r\n                return false;\r\n            }\r\n            if (!mathUtil.equals(this.w + v.w, 0, precision))\r\n            {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n}\r\n","import { Line3 } from './Line3';\r\n\r\n/**\r\n * 3D射线\r\n */\r\nexport class Ray3 extends Line3\r\n{\r\n}\r\n","import { mathUtil } from '@feng3d/polyfill';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { RotationOrder } from '../enums/RotationOrder';\r\nimport { Matrix3x3 } from './Matrix3x3';\r\nimport { Plane } from './Plane';\r\nimport { Quaternion } from './Quaternion';\r\nimport { Ray3 } from './Ray3';\r\nimport { Vector3 } from './Vector3';\r\nimport { Vector4 } from './Vector4';\r\n\r\ndeclare global\r\n{\r\n    interface MixinsQuaternion\r\n    {\r\n        toMatrix(target?: Matrix4x4): Matrix4x4\r\n    }\r\n}\r\n\r\n/**\r\n * 转换为矩阵\r\n *\r\n * @param target\r\n */\r\nQuaternion.prototype.toMatrix = function toMatrix(this: Quaternion, target = new Matrix4x4())\r\n{\r\n    const elements = target.elements;\r\n    const { x, y, z, w } = this;\r\n    //\r\n    const xy2 = 2 * x * y;\r\n    const xz2 = 2 * x * z;\r\n    const xw2 = 2 * x * w;\r\n    const yz2 = 2 * y * z;\r\n    const yw2 = 2 * y * w;\r\n    const zw2 = 2 * z * w;\r\n    const xx = x * x;\r\n    const yy = y * y;\r\n    const zz = z * z;\r\n    const ww = w * w;\r\n\r\n    elements[0] = xx - yy - zz + ww;\r\n    elements[4] = xy2 - zw2;\r\n    elements[8] = xz2 + yw2;\r\n    elements[12] = 0;\r\n    elements[1] = xy2 + zw2;\r\n    elements[5] = -xx + yy - zz + ww;\r\n    elements[9] = yz2 - xw2;\r\n    elements[13] = 0;\r\n    elements[2] = xz2 - yw2;\r\n    elements[6] = yz2 + xw2;\r\n    elements[10] = -xx - yy + zz + ww;\r\n    elements[14] = 0;\r\n    elements[3] = 0;\r\n    elements[7] = 0;\r\n    elements[11] = 0;\r\n    elements[15] = 1;\r\n\r\n    return target;\r\n};\r\n\r\ntype NmberArray16 = [\r\n    number, number, number, number,\r\n    number, number, number, number,\r\n    number, number, number, number,\r\n    number, number, number, number,\r\n];\r\n\r\n/**\r\n * Matrix4x4 类表示一个转换矩阵，该矩阵确定三维 (3D) 显示对象的位置和方向。\r\n * 该矩阵可以执行转换功能，包括平移（沿 x、y 和 z 轴重新定位）、旋转和缩放（调整大小）。\r\n * Matrix4x4 类还可以执行透视投影，这会将 3D 坐标空间中的点映射到二维 (2D) 视图。\r\n * ```\r\n *  ---                                   ---\r\n *  |   scaleX      0         0       0     |   x轴\r\n *  |     0       scaleY      0       0     |   y轴\r\n *  |     0         0       scaleZ    0     |   z轴\r\n *  |     tx        ty        tz      1     |   平移\r\n *  ---                                   ---\r\n *\r\n *  ---                                   ---\r\n *  |     0         1         2        3    |   x轴\r\n *  |     4         5         6        7    |   y轴\r\n *  |     8         9         10       11   |   z轴\r\n *  |     12        13        14       15   |   平移\r\n *  ---                                   ---\r\n * ```\r\n *\r\n * @see https://help.adobe.com/zh_CN/FlashPlatform/reference/actionscript/3/flash/geom/Matrix3D.html\r\n * @see https://github.com/mrdoob/three.js/blob/dev/src/math/Matrix4.js\r\n * @see https://docs.unity3d.com/ScriptReference/Matrix4x4.html\r\n */\r\nexport class Matrix4x4\r\n{\r\n    /**\r\n     * 通过位移旋转缩放重组矩阵\r\n     *\r\n     * @param position 位移\r\n     * @param rotation 旋转角度，按照指定旋转顺序旋转角度。\r\n     * @param scale 缩放。\r\n     * @param order 旋转顺序。\r\n     */\r\n    static fromTRS(position: Vector3, rotation: Vector3, scale: Vector3, order = mathUtil.DefaultRotationOrder)\r\n    {\r\n        return new Matrix4x4().fromTRS(position, rotation, scale, order);\r\n    }\r\n\r\n    /**\r\n     * 从轴与旋转角度创建矩阵\r\n     *\r\n     * @param axis 旋转轴\r\n     * @param degrees 角度\r\n     */\r\n    static fromAxisRotate(axis: Vector3, degrees: number)\r\n    {\r\n        return new Matrix4x4().fromAxisRotate(axis, degrees);\r\n    }\r\n\r\n    /**\r\n     * 从欧拉角旋转角度初始化矩阵。\r\n     *\r\n     * @param rx 用于沿 x 轴旋转对象的角度。\r\n     * @param ry 用于沿 y 轴旋转对象的角度。\r\n     * @param rz 用于沿 z 轴旋转对象的角度。\r\n     * @param order 绕轴旋转的顺序。\r\n     */\r\n    static fromRotation(rx: number, ry: number, rz: number, order = mathUtil.DefaultRotationOrder): Matrix4x4\r\n    {\r\n        return new Matrix4x4().fromRotation(rx, ry, rz, order);\r\n    }\r\n\r\n    /**\r\n     * 从四元素初始化矩阵。\r\n     *\r\n     * @param q 四元素\r\n     */\r\n    static fromQuaternion(q: Quaternion)\r\n    {\r\n        return new Matrix4x4().fromQuaternion(q);\r\n    }\r\n\r\n    /**\r\n     * 创建缩放矩阵\r\n     * @param sx 用于沿 x 轴缩放对象的乘数。\r\n     * @param sy 用于沿 y 轴缩放对象的乘数。\r\n     * @param sz 用于沿 z 轴缩放对象的乘数。\r\n     */\r\n    static fromScale(sx: number, sy: number, sz: number)\r\n    {\r\n        const rotationMat = new Matrix4x4([//\r\n            sx, 0.0, 0.0, 0, //\r\n            0.0, sy, 0.0, 0, //\r\n            0.0, 0.0, sz, 0, //\r\n            0.0, 0.0, 0.0, 1//\r\n        ]);\r\n\r\n        return rotationMat;\r\n    }\r\n\r\n    /**\r\n     * 创建位移矩阵\r\n     * @param x 沿 x 轴的增量平移。\r\n     * @param y 沿 y 轴的增量平移。\r\n     * @param z 沿 z 轴的增量平移。\r\n     */\r\n    static fromPosition(x: number, y: number, z: number)\r\n    {\r\n        const rotationMat: Matrix4x4 = new Matrix4x4([//\r\n            1, 0, 0, 0, //\r\n            0, 1, 0, 0, //\r\n            0, 0, 1, 0, //\r\n            x, y, z, 1//\r\n        ]);\r\n\r\n        return rotationMat;\r\n    }\r\n\r\n    /**\r\n     * 一个由 16 个数字组成的矢量，其中，每四个元素可以是 4x4 矩阵的一列。\r\n     */\r\n    @serialize\r\n    elements: NmberArray16;\r\n\r\n    /**\r\n     * 获取位移\r\n     *\r\n     * @param value 用于存储位移信息的向量\r\n     */\r\n    getPosition(value = new Vector3())\r\n    {\r\n        value.x = this.elements[12];\r\n        value.y = this.elements[13];\r\n        value.z = this.elements[14];\r\n\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * 设置位移\r\n     *\r\n     * @param value 位移\r\n     */\r\n    setPosition(value: Vector3)\r\n    {\r\n        this.elements[12] = value.x;\r\n        this.elements[13] = value.y;\r\n        this.elements[14] = value.z;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 获取欧拉旋转角度。\r\n     *\r\n     * @param rotation 欧拉旋转角度。\r\n     * @param order 绕轴旋转的顺序。\r\n     */\r\n    getRotation(rotation = new Vector3(), order = mathUtil.DefaultRotationOrder)\r\n    {\r\n        this.toTRS(new Vector3(), rotation, new Vector3(), order);\r\n\r\n        return rotation;\r\n    }\r\n\r\n    /**\r\n     * 设置欧拉旋转角度。\r\n     *\r\n     * @param rotation 欧拉旋转角度。\r\n     * @param order 绕轴旋转的顺序。\r\n     */\r\n    setRotation(rotation: Vector3, order = mathUtil.DefaultRotationOrder)\r\n    {\r\n        const p = new Vector3();\r\n        const r = new Vector3();\r\n        const s = new Vector3();\r\n\r\n        this.toTRS(p, r, s, order);\r\n        r.copy(rotation);\r\n        this.fromTRS(p, r, s);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 获取缩放值。\r\n     *\r\n     * @param scale 用于存储缩放值的向量。\r\n     */\r\n    getScale(scale = new Vector3())\r\n    {\r\n        const rawData = this.elements;\r\n        const v = new Vector3();\r\n\r\n        scale.x = v.set(rawData[0], rawData[1], rawData[2]).length;\r\n        scale.y = v.set(rawData[4], rawData[5], rawData[6]).length;\r\n        scale.z = v.set(rawData[8], rawData[9], rawData[10]).length;\r\n\r\n        return scale;\r\n    }\r\n\r\n    /**\r\n     * 获取缩放值。\r\n     *\r\n     * @param scale 缩放值。\r\n     */\r\n    setScale(scale: Vector3)\r\n    {\r\n        const oldS = this.getScale();\r\n\r\n        const te = this.elements;\r\n        const sx = scale.x / oldS.x;\r\n        const sy = scale.y / oldS.y;\r\n        const sz = scale.z / oldS.z;\r\n\r\n        te[0] *= sx;\r\n        te[1] *= sx;\r\n        te[2] *= sx;\r\n        te[4] *= sy;\r\n        te[5] *= sy;\r\n        te[6] *= sy;\r\n        te[8] *= sz;\r\n        te[9] *= sz;\r\n        te[10] *= sz;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 一个用于确定矩阵是否可逆的数字。如果值为0则不可逆。\r\n     */\r\n    get determinant()\r\n    {\r\n        return (//\r\n            (((this.elements[0] * this.elements[5]) - (this.elements[4] * this.elements[1])) * ((this.elements[10] * this.elements[15]) - (this.elements[14] * this.elements[11]))) //\r\n            - (((this.elements[0] * this.elements[9]) - (this.elements[8] * this.elements[1])) * ((this.elements[6] * this.elements[15]) - (this.elements[14] * this.elements[7]))) //\r\n            + (((this.elements[0] * this.elements[13]) - (this.elements[12] * this.elements[1])) * ((this.elements[6] * this.elements[11]) - (this.elements[10] * this.elements[7]))) //\r\n            + (((this.elements[4] * this.elements[9]) - (this.elements[8] * this.elements[5])) * ((this.elements[2] * this.elements[15]) - (this.elements[14] * this.elements[3]))) //\r\n            - (((this.elements[4] * this.elements[13]) - (this.elements[12] * this.elements[5])) * ((this.elements[2] * this.elements[11]) - (this.elements[10] * this.elements[3]))) //\r\n            + (((this.elements[8] * this.elements[13]) - (this.elements[12] * this.elements[9])) * ((this.elements[2] * this.elements[7]) - (this.elements[6] * this.elements[3])))//\r\n        );\r\n    }\r\n\r\n    /**\r\n     * 获取X轴向量\r\n     *\r\n     * @param out 保存X轴向量\r\n     */\r\n    getAxisX(out = new Vector3())\r\n    {\r\n        return out.set(this.elements[0], this.elements[1], this.elements[2]);\r\n    }\r\n\r\n    /**\r\n     * 设置X轴向量\r\n     *\r\n     * @param vector X轴向量\r\n     */\r\n    setAxisX(vector = new Vector3())\r\n    {\r\n        this.elements[0] = vector.x;\r\n        this.elements[1] = vector.y;\r\n        this.elements[2] = vector.z;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 获取Y轴向量\r\n     *\r\n     * @param out 保存Y轴向量\r\n     */\r\n    getAxisY(out = new Vector3())\r\n    {\r\n        return out.set(this.elements[4], this.elements[5], this.elements[6]);\r\n    }\r\n\r\n    /**\r\n     * 设置Y轴向量\r\n     *\r\n     * @param vector X轴向量\r\n     */\r\n    setAxisY(vector = new Vector3())\r\n    {\r\n        this.elements[4] = vector.x;\r\n        this.elements[5] = vector.y;\r\n        this.elements[6] = vector.z;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 获取Z轴向量\r\n     *\r\n     * @param out 保存Z轴向量\r\n     */\r\n    getAxisZ(out = new Vector3())\r\n    {\r\n        return out.set(this.elements[8], this.elements[9], this.elements[10]);\r\n    }\r\n\r\n    /**\r\n     * 创建 Matrix4x4 对象。\r\n     * @param rawData 一个由 16 个数字组成的矢量，其中，每四个元素可以是 4x4 矩阵的一列。\r\n     */\r\n    constructor(rawData: NmberArray16 = [\r\n        1, 0, 0, 0, //\r\n        0, 1, 0, 0, //\r\n        0, 0, 1, 0, //\r\n        0, 0, 0, 1, //\r\n    ])\r\n    {\r\n        this.elements = rawData;\r\n    }\r\n\r\n    /**\r\n     * 从欧拉角旋转角度初始化矩阵。\r\n     *\r\n     * @param rx 用于沿 x 轴旋转对象的角度。\r\n     * @param ry 用于沿 y 轴旋转对象的角度。\r\n     * @param rz 用于沿 z 轴旋转对象的角度。\r\n     * @param order 绕轴旋转的顺序。\r\n     */\r\n    fromRotation(rx: number, ry: number, rz: number, order = mathUtil.DefaultRotationOrder)\r\n    {\r\n        this.fromTRS(new Vector3(), new Vector3(rx, ry, rz), new Vector3(1, 1, 1), order);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 从四元素初始化矩阵。\r\n     *\r\n     * @param q 四元素\r\n     */\r\n    fromQuaternion(q: Quaternion)\r\n    {\r\n        q.toMatrix(this);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 从轴与旋转角度创建矩阵\r\n     *\r\n     * @param axis 旋转轴\r\n     * @param degrees 角度\r\n     */\r\n    fromAxisRotate(axis: Vector3, degrees: number)\r\n    {\r\n        const n = axis.clone();\r\n\r\n        n.normalize();\r\n        const q = degrees * Math.PI / 180;\r\n\r\n        const sinq = Math.sin(q);\r\n        const cosq = Math.cos(q);\r\n        const lcosq = 1 - cosq;\r\n\r\n        const arr = [//\r\n            (n.x * n.x * lcosq) + cosq, (n.x * n.y * lcosq) + (n.z * sinq), (n.x * n.z * lcosq) - (n.y * sinq), 0, //\r\n            (n.x * n.y * lcosq) - (n.z * sinq), (n.y * n.y * lcosq) + cosq, (n.y * n.z * lcosq) + (n.x * sinq), 0, //\r\n            (n.x * n.z * lcosq) + (n.y * sinq), (n.y * n.z * lcosq) - (n.x * sinq), (n.z * n.z * lcosq) + cosq, 0, //\r\n            0, 0, 0, 1//\r\n        ];\r\n\r\n        arr.forEach((v, i) =>\r\n        {\r\n            this.elements[i] = v;\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 通过将另一个 Matrix4x4 对象与当前 Matrix4x4 对象相乘来后置一个矩阵。\r\n     */\r\n    append(lhs: Matrix4x4)\r\n    {\r\n        const m111 = this.elements[0];\r\n        const m121 = this.elements[4];\r\n        const m131 = this.elements[8];\r\n        const m141 = this.elements[12];\r\n        const m112 = this.elements[1];\r\n        const m122 = this.elements[5];\r\n        const m132 = this.elements[9];\r\n        const m142 = this.elements[13];\r\n        const m113 = this.elements[2];\r\n        const m123 = this.elements[6];\r\n        const m133 = this.elements[10];\r\n        const m143 = this.elements[14];\r\n        const m114 = this.elements[3];\r\n        const m124 = this.elements[7];\r\n        const m134 = this.elements[11];\r\n        const m144 = this.elements[15];\r\n\r\n        const m211 = lhs.elements[0];\r\n        const m221 = lhs.elements[4];\r\n        const m231 = lhs.elements[8];\r\n        const m241 = lhs.elements[12];\r\n        const m212 = lhs.elements[1];\r\n        const m222 = lhs.elements[5];\r\n        const m232 = lhs.elements[9];\r\n        const m242 = lhs.elements[13];\r\n        const m213 = lhs.elements[2];\r\n        const m223 = lhs.elements[6];\r\n        const m233 = lhs.elements[10];\r\n        const m243 = lhs.elements[14];\r\n        const m214 = lhs.elements[3];\r\n        const m224 = lhs.elements[7];\r\n        const m234 = lhs.elements[11];\r\n        const m244 = lhs.elements[15];\r\n\r\n        this.elements[0] = (m111 * m211) + (m112 * m221) + (m113 * m231) + (m114 * m241);\r\n        this.elements[1] = (m111 * m212) + (m112 * m222) + (m113 * m232) + (m114 * m242);\r\n        this.elements[2] = (m111 * m213) + (m112 * m223) + (m113 * m233) + (m114 * m243);\r\n        this.elements[3] = (m111 * m214) + (m112 * m224) + (m113 * m234) + (m114 * m244);\r\n\r\n        this.elements[4] = (m121 * m211) + (m122 * m221) + (m123 * m231) + (m124 * m241);\r\n        this.elements[5] = (m121 * m212) + (m122 * m222) + (m123 * m232) + (m124 * m242);\r\n        this.elements[6] = (m121 * m213) + (m122 * m223) + (m123 * m233) + (m124 * m243);\r\n        this.elements[7] = (m121 * m214) + (m122 * m224) + (m123 * m234) + (m124 * m244);\r\n\r\n        this.elements[8] = (m131 * m211) + (m132 * m221) + (m133 * m231) + (m134 * m241);\r\n        this.elements[9] = (m131 * m212) + (m132 * m222) + (m133 * m232) + (m134 * m242);\r\n        this.elements[10] = (m131 * m213) + (m132 * m223) + (m133 * m233) + (m134 * m243);\r\n        this.elements[11] = (m131 * m214) + (m132 * m224) + (m133 * m234) + (m134 * m244);\r\n\r\n        this.elements[12] = (m141 * m211) + (m142 * m221) + (m143 * m231) + (m144 * m241);\r\n        this.elements[13] = (m141 * m212) + (m142 * m222) + (m143 * m232) + (m144 * m242);\r\n        this.elements[14] = (m141 * m213) + (m142 * m223) + (m143 * m233) + (m144 * m243);\r\n        this.elements[15] = (m141 * m214) + (m142 * m224) + (m143 * m234) + (m144 * m244);\r\n\r\n        // eslint-disable-next-line use-isnan\r\n        console.assert((this.elements[0] !== NaN) && (this.elements[4] !== NaN) && (this.elements[8] !== NaN) && (this.elements[12] !== NaN));\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 在 Matrix4x4 对象上后置一个增量旋转。\r\n     * @param axis 旋转轴\r\n     * @param degrees 角度\r\n     * @param pivotPoint 旋转中心点\r\n     */\r\n    appendRotation(axis: Vector3, degrees: number, pivotPoint?: Vector3)\r\n    {\r\n        const rotationMat = Matrix4x4.fromAxisRotate(axis, degrees);\r\n\r\n        if (pivotPoint)\r\n        {\r\n            this.appendTranslation(-pivotPoint.x, -pivotPoint.y, -pivotPoint.z);\r\n        }\r\n\r\n        this.append(rotationMat);\r\n\r\n        if (pivotPoint)\r\n        {\r\n            this.appendTranslation(pivotPoint.x, pivotPoint.y, pivotPoint.z);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 在 Matrix4x4 对象上后置一个增量缩放，沿 x、y 和 z 轴改变位置。\r\n     * @param sx 用于沿 x 轴缩放对象的乘数。\r\n     * @param sy 用于沿 y 轴缩放对象的乘数。\r\n     * @param sz 用于沿 z 轴缩放对象的乘数。\r\n     */\r\n    appendScale(sx: number, sy: number, sz: number)\r\n    {\r\n        const scaleMat = Matrix4x4.fromScale(sx, sy, sz);\r\n\r\n        this.append(scaleMat);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 在 Matrix4x4 对象上后置一个增量平移，沿 x、y 和 z 轴重新定位。\r\n     * @param x 沿 x 轴的增量平移。\r\n     * @param y 沿 y 轴的增量平移。\r\n     * @param z 沿 z 轴的增量平移。\r\n     */\r\n    appendTranslation(x: number, y: number, z: number)\r\n    {\r\n        const m = this.elements;\r\n\r\n        m[0] += x * m[3];\r\n        m[4] += x * m[7];\r\n        m[8] += x * m[11];\r\n        m[12] += x * m[15];\r\n        m[1] += y * m[3];\r\n        m[5] += y * m[7];\r\n        m[9] += y * m[11];\r\n        m[13] += y * m[15];\r\n        m[2] += z * m[3];\r\n        m[6] += z * m[7];\r\n        m[10] += z * m[11];\r\n        m[14] += z * m[15];\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 返回一个新 Matrix4x4 对象，它是与当前 Matrix4x4 对象完全相同的副本。\r\n     */\r\n    clone()\r\n    {\r\n        const matrix = new Matrix4x4();\r\n\r\n        matrix.copy(this);\r\n\r\n        return matrix;\r\n    }\r\n\r\n    /**\r\n     * 将源 Matrix4x4 对象中的所有矩阵数据复制到调用方 Matrix4x4 对象中。\r\n     * @param source 要从中复制数据的 Matrix4x4 对象。\r\n     */\r\n    copy(source: Matrix4x4)\r\n    {\r\n        for (let i = 0; i < 16; i++)\r\n        {\r\n            this.elements[i] = source.elements[i];\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 从数组中初始化\r\n     *\r\n     * @param array 包含矩阵数据的数组\r\n     * @param index 数组中的起始位置\r\n     * @param transpose 是否转置\r\n     */\r\n    fromArray(array: number[], index = 0, transpose = false)\r\n    {\r\n        if (array.length - index < 16)\r\n        {\r\n            throw new Error('vector参数数据长度不够！');\r\n        }\r\n        for (let i = 0; i < 16; i++)\r\n        {\r\n            this.elements[i] = array[index + i];\r\n        }\r\n        if (transpose)\r\n        {\r\n            this.transpose();\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 将矩阵数据转换为数组\r\n     *\r\n     * @param array 保存矩阵数据的数组\r\n     * @param index 数组中的起始位置\r\n     * @param transpose 是否转置\r\n     */\r\n    toArray(array: number[] | Float32Array = [], index = 0, transpose = false)\r\n    {\r\n        if (transpose)\r\n        {\r\n            this.transpose();\r\n        }\r\n        for (let i = 0; i < 16; i++)\r\n        {\r\n            array[i + index] = this.elements[i];\r\n        }\r\n        if (transpose)\r\n        {\r\n            this.transpose();\r\n        }\r\n\r\n        return array;\r\n    }\r\n\r\n    /**\r\n     * 随机矩阵。\r\n     */\r\n    random()\r\n    {\r\n        this.fromTRS(Vector3.random(), Vector3.random(), Vector3.random());\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 通过位移旋转缩放重组矩阵\r\n     *\r\n     * @param position 位移\r\n     * @param rotation 旋转角度，按照指定旋转顺序旋转角度。\r\n     * @param scale 缩放。\r\n     * @param order 旋转顺序。\r\n     */\r\n    fromTRS(position: Vector3, rotation: Vector3, scale: Vector3, order = mathUtil.DefaultRotationOrder)\r\n    {\r\n        const m = this.elements;\r\n        //\r\n\r\n        m[11] = 0;\r\n        m[15] = 1;\r\n        //\r\n        rotation = rotation.scaleNumberTo(mathUtil.DEG2RAD);\r\n        const px = position.x;\r\n        const py = position.y;\r\n        const pz = position.z;\r\n        const rx = rotation.x;\r\n        const ry = rotation.y;\r\n        const rz = rotation.z;\r\n        const sx = scale.x;\r\n        const sy = scale.y;\r\n        const sz = scale.z;\r\n        //\r\n\r\n        m[12] = px;\r\n        m[13] = py;\r\n        m[14] = pz;\r\n        //\r\n        const cosX = Math.cos(rx);\r\n        const sinX = Math.sin(rx);\r\n        const cosY = Math.cos(ry);\r\n        const sinY = Math.sin(ry);\r\n        const cosZ = Math.cos(rz);\r\n        const sinZ = Math.sin(rz);\r\n\r\n        if (order === RotationOrder.XYZ)\r\n        {\r\n            const ae = cosX * cosZ;\r\n            const af = cosX * sinZ;\r\n            const be = sinX * cosZ;\r\n            const bf = sinX * sinZ;\r\n\r\n            m[0] = cosY * cosZ;\r\n            m[4] = -cosY * sinZ;\r\n            m[8] = sinY;\r\n\r\n            m[1] = af + (be * sinY);\r\n            m[5] = ae - (bf * sinY);\r\n            m[9] = -sinX * cosY;\r\n\r\n            m[2] = bf - (ae * sinY);\r\n            m[6] = be + (af * sinY);\r\n            m[10] = cosX * cosY;\r\n        }\r\n        else if (order === RotationOrder.YXZ)\r\n        {\r\n            const ce = cosY * cosZ;\r\n            const cf = cosY * sinZ;\r\n            const de = sinY * cosZ;\r\n            const df = sinY * sinZ;\r\n\r\n            m[0] = ce + (df * sinX);\r\n            m[4] = (de * sinX) - cf;\r\n            m[8] = cosX * sinY;\r\n\r\n            m[1] = cosX * sinZ;\r\n            m[5] = cosX * cosZ;\r\n            m[9] = -sinX;\r\n\r\n            m[2] = (cf * sinX) - de;\r\n            m[6] = df + (ce * sinX);\r\n            m[10] = cosX * cosY;\r\n        }\r\n        else if (order === RotationOrder.ZXY)\r\n        {\r\n            const ce = cosY * cosZ;\r\n            const cf = cosY * sinZ;\r\n            const de = sinY * cosZ;\r\n            const df = sinY * sinZ;\r\n\r\n            m[0] = ce - (df * sinX);\r\n            m[4] = -cosX * sinZ;\r\n            m[8] = de + (cf * sinX);\r\n\r\n            m[1] = cf + (de * sinX);\r\n            m[5] = cosX * cosZ;\r\n            m[9] = df - (ce * sinX);\r\n\r\n            m[2] = -cosX * sinY;\r\n            m[6] = sinX;\r\n            m[10] = cosX * cosY;\r\n        }\r\n        else if (order === RotationOrder.ZYX)\r\n        {\r\n            const ae = cosX * cosZ;\r\n            const af = cosX * sinZ;\r\n            const be = sinX * cosZ;\r\n            const bf = sinX * sinZ;\r\n\r\n            m[0] = cosY * cosZ;\r\n            m[4] = (be * sinY) - af;\r\n            m[8] = (ae * sinY) + bf;\r\n\r\n            m[1] = cosY * sinZ;\r\n            m[5] = (bf * sinY) + ae;\r\n            m[9] = (af * sinY) - be;\r\n\r\n            m[2] = -sinY;\r\n            m[6] = sinX * cosY;\r\n            m[10] = cosX * cosY;\r\n        }\r\n        else if (order === RotationOrder.YZX)\r\n        {\r\n            const ac = cosX * cosY;\r\n            const ad = cosX * sinY;\r\n            const bc = sinX * cosY;\r\n            const bd = sinX * sinY;\r\n\r\n            m[0] = cosY * cosZ;\r\n            m[4] = bd - (ac * sinZ);\r\n            m[8] = (bc * sinZ) + ad;\r\n\r\n            m[1] = sinZ;\r\n            m[5] = cosX * cosZ;\r\n            m[9] = -sinX * cosZ;\r\n\r\n            m[2] = -sinY * cosZ;\r\n            m[6] = (ad * sinZ) + bc;\r\n            m[10] = ac - (bd * sinZ);\r\n        }\r\n        else if (order === RotationOrder.XZY)\r\n        {\r\n            const ac = cosX * cosY;\r\n            const ad = cosX * sinY;\r\n            const bc = sinX * cosY;\r\n            const bd = sinX * sinY;\r\n\r\n            m[0] = cosY * cosZ;\r\n            m[4] = -sinZ;\r\n            m[8] = sinY * cosZ;\r\n\r\n            m[1] = (ac * sinZ) + bd;\r\n            m[5] = cosX * cosZ;\r\n            m[9] = (ad * sinZ) - bc;\r\n\r\n            m[2] = (bc * sinZ) - ad;\r\n            m[6] = sinX * cosZ;\r\n            m[10] = (bd * sinZ) + ac;\r\n        }\r\n        else\r\n        {\r\n            console.error(`初始化矩阵时错误旋转顺序 ${order}`);\r\n        }\r\n        //\r\n        m[0] *= sx;\r\n        m[1] *= sx;\r\n        m[2] *= sx;\r\n        m[4] *= sy;\r\n        m[5] *= sy;\r\n        m[6] *= sy;\r\n        m[8] *= sz;\r\n        m[9] *= sz;\r\n        m[10] *= sz;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 把矩阵分解为位移旋转缩放。\r\n     *\r\n     * @param position 位移\r\n     * @param rotation 旋转角度，按照指定旋转顺序旋转。\r\n     * @param scale 缩放。\r\n     * @param order 旋转顺序。\r\n     */\r\n    toTRS(position = new Vector3(), rotation = new Vector3(), scale = new Vector3(), order = mathUtil.DefaultRotationOrder)\r\n    {\r\n        const clamp = mathUtil.clamp;\r\n        //\r\n        const m = this.elements;\r\n        let m11 = m[0];\r\n        let m12 = m[4];\r\n        let m13 = m[8];\r\n        let m21 = m[1];\r\n        let m22 = m[5];\r\n        let m23 = m[9];\r\n        let m31 = m[2];\r\n        let m32 = m[6];\r\n        let m33 = m[10];\r\n        //\r\n\r\n        position.x = m[12];\r\n        position.y = m[13];\r\n        position.z = m[14];\r\n        //\r\n        scale.x = Math.sqrt((m11 * m11) + (m21 * m21) + (m31 * m31));\r\n        m11 /= scale.x;\r\n        m21 /= scale.x;\r\n        m31 /= scale.x;\r\n        scale.y = Math.sqrt((m12 * m12) + (m22 * m22) + (m32 * m32));\r\n        m12 /= scale.y;\r\n        m22 /= scale.y;\r\n        m32 /= scale.y;\r\n        scale.z = Math.sqrt((m13 * m13) + (m23 * m23) + (m33 * m33));\r\n        m13 /= scale.z;\r\n        m23 /= scale.z;\r\n        m33 /= scale.z;\r\n        //\r\n        if (order === RotationOrder.XYZ)\r\n        {\r\n            rotation.y = Math.asin(clamp(m13, -1, 1));\r\n            if (Math.abs(m13) < 0.9999999)\r\n            {\r\n                rotation.x = Math.atan2(-m23, m33);\r\n                rotation.z = Math.atan2(-m12, m11);\r\n            }\r\n            else\r\n            {\r\n                rotation.x = Math.atan2(m32, m22);\r\n                rotation.z = 0;\r\n            }\r\n        }\r\n        else if (order === RotationOrder.YXZ)\r\n        {\r\n            rotation.x = Math.asin(-clamp(m23, -1, 1));\r\n            if (Math.abs(m23) < 0.9999999)\r\n            {\r\n                rotation.y = Math.atan2(m13, m33);\r\n                rotation.z = Math.atan2(m21, m22);\r\n            }\r\n            else\r\n            {\r\n                rotation.y = Math.atan2(-m31, m11);\r\n                rotation.z = 0;\r\n            }\r\n        }\r\n        else if (order === RotationOrder.ZXY)\r\n        {\r\n            rotation.x = Math.asin(clamp(m32, -1, 1));\r\n            if (Math.abs(m32) < 0.9999999)\r\n            {\r\n                rotation.y = Math.atan2(-m31, m33);\r\n                rotation.z = Math.atan2(-m12, m22);\r\n            }\r\n            else\r\n            {\r\n                rotation.y = 0;\r\n                rotation.z = Math.atan2(m21, m11);\r\n            }\r\n        }\r\n        else if (order === RotationOrder.ZYX)\r\n        {\r\n            rotation.y = Math.asin(-clamp(m31, -1, 1));\r\n            if (Math.abs(m31) < 0.9999999)\r\n            {\r\n                rotation.x = Math.atan2(m32, m33);\r\n                rotation.z = Math.atan2(m21, m11);\r\n            }\r\n            else\r\n            {\r\n                rotation.x = 0;\r\n                rotation.z = Math.atan2(-m12, m22);\r\n            }\r\n        }\r\n        else if (order === RotationOrder.YZX)\r\n        {\r\n            rotation.z = Math.asin(clamp(m21, -1, 1));\r\n            if (Math.abs(m21) < 0.9999999)\r\n            {\r\n                rotation.x = Math.atan2(-m23, m22);\r\n                rotation.y = Math.atan2(-m31, m11);\r\n            }\r\n            else\r\n            {\r\n                rotation.x = 0;\r\n                rotation.y = Math.atan2(m13, m33);\r\n            }\r\n        }\r\n        else if (order === RotationOrder.XZY)\r\n        {\r\n            rotation.z = Math.asin(-clamp(m12, -1, 1));\r\n            if (Math.abs(m12) < 0.9999999)\r\n            {\r\n                rotation.x = Math.atan2(m32, m22);\r\n                rotation.y = Math.atan2(m13, m11);\r\n            }\r\n            else\r\n            {\r\n                rotation.x = Math.atan2(-m23, m33);\r\n                rotation.y = 0;\r\n            }\r\n        }\r\n        else\r\n        {\r\n            console.error(`初始化矩阵时错误旋转顺序 ${order}`);\r\n        }\r\n        rotation.scaleNumber(mathUtil.RAD2DEG);\r\n\r\n        return [position, rotation, scale];\r\n    }\r\n\r\n    /**\r\n     * 将当前矩阵转换为恒等或单位矩阵。\r\n     */\r\n    identity()\r\n    {\r\n        const m = this.elements;\r\n\r\n        m[0] = 1;\r\n        m[1] = 0;\r\n        m[2] = 0;\r\n        m[3] = 0;\r\n        m[4] = 0;\r\n        m[5] = 1;\r\n        m[6] = 0;\r\n        m[7] = 0;\r\n        m[8] = 0;\r\n        m[9] = 0;\r\n        m[10] = 1;\r\n        m[11] = 0;\r\n        m[12] = 0;\r\n        m[13] = 0;\r\n        m[14] = 0;\r\n        m[15] = 1;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 反转当前矩阵。逆矩阵\r\n     * @returns      如果成功反转矩阵，则返回 该矩阵。\r\n     */\r\n    invert()\r\n    {\r\n        let d = this.determinant;\r\n\r\n        if (d === 0)\r\n        {\r\n            console.error('无法获取逆矩阵');\r\n\r\n            return this;\r\n        }\r\n        d = 1 / d;\r\n\r\n        const m = this.elements;\r\n\r\n        const m11 = m[0]; const m21 = m[4];\r\n        const m31 = m[8]; const m41 = m[12];\r\n        const m12 = m[1]; const m22 = m[5];\r\n        const m32 = m[9]; const m42 = m[13];\r\n        const m13 = m[2]; const m23 = m[6];\r\n        const m33 = m[10]; const m43 = m[14];\r\n        const m14 = m[3]; const m24 = m[7]; const m34 = m[11]; const m44 = m[15];\r\n\r\n        m[0] = d * (m22 * (m33 * m44 - m43 * m34) - m32 * (m23 * m44 - m43 * m24) + m42 * (m23 * m34 - m33 * m24));\r\n        m[1] = -d * (m12 * (m33 * m44 - m43 * m34) - m32 * (m13 * m44 - m43 * m14) + m42 * (m13 * m34 - m33 * m14));\r\n        m[2] = d * (m12 * (m23 * m44 - m43 * m24) - m22 * (m13 * m44 - m43 * m14) + m42 * (m13 * m24 - m23 * m14));\r\n        m[3] = -d * (m12 * (m23 * m34 - m33 * m24) - m22 * (m13 * m34 - m33 * m14) + m32 * (m13 * m24 - m23 * m14));\r\n        m[4] = -d * (m21 * (m33 * m44 - m43 * m34) - m31 * (m23 * m44 - m43 * m24) + m41 * (m23 * m34 - m33 * m24));\r\n        m[5] = d * (m11 * (m33 * m44 - m43 * m34) - m31 * (m13 * m44 - m43 * m14) + m41 * (m13 * m34 - m33 * m14));\r\n        m[6] = -d * (m11 * (m23 * m44 - m43 * m24) - m21 * (m13 * m44 - m43 * m14) + m41 * (m13 * m24 - m23 * m14));\r\n        m[7] = d * (m11 * (m23 * m34 - m33 * m24) - m21 * (m13 * m34 - m33 * m14) + m31 * (m13 * m24 - m23 * m14));\r\n        m[8] = d * (m21 * (m32 * m44 - m42 * m34) - m31 * (m22 * m44 - m42 * m24) + m41 * (m22 * m34 - m32 * m24));\r\n        m[9] = -d * (m11 * (m32 * m44 - m42 * m34) - m31 * (m12 * m44 - m42 * m14) + m41 * (m12 * m34 - m32 * m14));\r\n        m[10] = d * (m11 * (m22 * m44 - m42 * m24) - m21 * (m12 * m44 - m42 * m14) + m41 * (m12 * m24 - m22 * m14));\r\n        m[11] = -d * (m11 * (m22 * m34 - m32 * m24) - m21 * (m12 * m34 - m32 * m14) + m31 * (m12 * m24 - m22 * m14));\r\n        m[12] = -d * (m21 * (m32 * m43 - m42 * m33) - m31 * (m22 * m43 - m42 * m23) + m41 * (m22 * m33 - m32 * m23));\r\n        m[13] = d * (m11 * (m32 * m43 - m42 * m33) - m31 * (m12 * m43 - m42 * m13) + m41 * (m12 * m33 - m32 * m13));\r\n        m[14] = -d * (m11 * (m22 * m43 - m42 * m23) - m21 * (m12 * m43 - m42 * m13) + m41 * (m12 * m23 - m22 * m13));\r\n        m[15] = d * (m11 * (m22 * m33 - m32 * m23) - m21 * (m12 * m33 - m32 * m13) + m31 * (m12 * m23 - m22 * m13));\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 通过将当前 Matrix4x4 对象与另一个 Matrix4x4 对象相乘来前置一个矩阵。得到的结果将合并两个矩阵转换。\r\n     * @param rhs 个右侧矩阵，它与当前 Matrix4x4 对象相乘。\r\n     */\r\n    prepend(rhs: Matrix4x4)\r\n    {\r\n        const mat = this.clone();\r\n\r\n        this.copy(rhs);\r\n        this.append(mat);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 在 Matrix4x4 对象上前置一个增量旋转。在将 Matrix4x4 对象应用于显示对象时，矩阵会在 Matrix4x4 对象中先执行旋转，然后再执行其他转换。\r\n     * @param axis 旋转的轴或方向。常见的轴为 X_AXIS (Vector3(1,0,0))、Y_AXIS (Vector3(0,1,0)) 和 Z_AXIS (Vector3(0,0,1))。此矢量的长度应为 1。\r\n     * @param degrees 旋转的角度。\r\n     * @param pivotPoint 一个用于确定旋转中心的点。对象的默认轴点为该对象的注册点。\r\n     */\r\n    prependRotation(axis: Vector3, degrees: number, _pivotPoint: Vector3 = new Vector3())\r\n    {\r\n        const rotationMat = Matrix4x4.fromAxisRotate(axis, degrees);\r\n\r\n        this.prepend(rotationMat);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 在 Matrix4x4 对象上前置一个增量缩放，沿 x、y 和 z 轴改变位置。在将 Matrix4x4 对象应用于显示对象时，矩阵会在 Matrix4x4 对象中先执行缩放更改，然后再执行其他转换。\r\n     * @param xScale 用于沿 x 轴缩放对象的乘数。\r\n     * @param yScale 用于沿 y 轴缩放对象的乘数。\r\n     * @param zScale 用于沿 z 轴缩放对象的乘数。\r\n     */\r\n    prependScale(xScale: number, yScale: number, zScale: number)\r\n    {\r\n        const scaleMat = Matrix4x4.fromScale(xScale, yScale, zScale);\r\n\r\n        this.prepend(scaleMat);\r\n\r\n        return this;\r\n    }\r\n\r\n    prependScale1(xScale: number, yScale: number, zScale: number)\r\n    {\r\n        const m = this.elements;\r\n\r\n        m[0] *= xScale;\r\n        m[1] *= xScale;\r\n        m[2] *= xScale;\r\n        m[4] *= yScale;\r\n        m[5] *= yScale;\r\n        m[6] *= yScale;\r\n        m[8] *= zScale;\r\n        m[9] *= zScale;\r\n        m[10] *= zScale;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 在 Matrix4x4 对象上前置一个增量平移，沿 x、y 和 z 轴重新定位。在将 Matrix4x4 对象应用于显示对象时，矩阵会在 Matrix4x4 对象中先执行平移更改，然后再执行其他转换。\r\n     * @param x 沿 x 轴的增量平移。\r\n     * @param y 沿 y 轴的增量平移。\r\n     * @param z 沿 z 轴的增量平移。\r\n     */\r\n    prependTranslation(x: number, y: number, z: number)\r\n    {\r\n        const translationMat = Matrix4x4.fromPosition(x, y, z);\r\n\r\n        this.prepend(translationMat);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * X轴方向移动\r\n     * @param distance 移动距离\r\n     */\r\n    moveRight(distance: number)\r\n    {\r\n        const direction = this.getAxisX();\r\n\r\n        direction.normalize();\r\n        direction.scaleNumber(distance);\r\n        this.setPosition(this.getPosition().addTo(direction));\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Y轴方向移动\r\n     * @param distance 移动距离\r\n     */\r\n    moveUp(distance: number)\r\n    {\r\n        const direction = this.getAxisY();\r\n\r\n        direction.scaleNumber(distance);\r\n        this.setPosition(this.getPosition().addTo(direction));\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Z轴方向移动\r\n     * @param distance 移动距离\r\n     */\r\n    moveForward(distance: number)\r\n    {\r\n        const direction = this.getAxisZ();\r\n\r\n        direction.scaleNumber(distance);\r\n        this.setPosition(this.getPosition().addTo(direction));\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 使用转换矩阵将 Vector3 对象从一个空间坐标转换到另一个空间坐标。\r\n     * @param vin 一个容纳要转换的坐标的 Vector3 对象。\r\n     * @returns  一个包含转换后的坐标的 Vector3 对象。\r\n     */\r\n    transformPoint3(vin: Vector3, vout = new Vector3())\r\n    {\r\n        const m = this.elements;\r\n        const m0 = m[0];\r\n        const m1 = m[1];\r\n        const m2 = m[2];\r\n        const m4 = m[4];\r\n        const m5 = m[5];\r\n        const m6 = m[6];\r\n        const m8 = m[8];\r\n        const m9 = m[9];\r\n        const m10 = m[10];\r\n        const m12 = m[12];\r\n        const m13 = m[13];\r\n        const m14 = m[14];\r\n\r\n        const x = vin.x;\r\n        const y = vin.y;\r\n        const z = vin.z;\r\n\r\n        vout.x = x * m0 + y * m4 + z * m8 + m12;\r\n        vout.y = x * m1 + y * m5 + z * m9 + m13;\r\n        vout.z = x * m2 + y * m6 + z * m10 + m14;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 变换Vector3向量\r\n     *\r\n     * 与变换点不同，并不会受到矩阵平移分量的影响。\r\n     *\r\n     * @param vin 被变换的向量\r\n     * @param vout 变换后的向量\r\n     */\r\n    transformVector3(vin: Vector3, vout = new Vector3())\r\n    {\r\n        const m = this.elements;\r\n        const m0 = m[0];\r\n        const m1 = m[1];\r\n        const m2 = m[2];\r\n        const m4 = m[4];\r\n        const m5 = m[5];\r\n        const m6 = m[6];\r\n        const m8 = m[8];\r\n        const m9 = m[9];\r\n        const m10 = m[10];\r\n\r\n        const x = vin.x;\r\n        const y = vin.y;\r\n        const z = vin.z;\r\n\r\n        vout.x = x * m0 + y * m4 + z * m8;\r\n        vout.y = x * m1 + y * m5 + z * m9;\r\n        vout.z = x * m2 + y * m6 + z * m10;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 变换Vector4向量\r\n     *\r\n     * @param vin 被变换的向量\r\n     * @param vout 变换后的向量\r\n     */\r\n    transformVector4(vin: Vector4, vout = new Vector4())\r\n    {\r\n        const m = this.elements;\r\n        const m0 = m[0];\r\n        const m1 = m[1];\r\n        const m2 = m[2];\r\n        const m3 = m[3];\r\n        const m4 = m[4];\r\n        const m5 = m[5];\r\n        const m6 = m[6];\r\n        const m7 = m[7];\r\n        const m8 = m[8];\r\n        const m9 = m[9];\r\n        const m10 = m[10];\r\n        const m11 = m[11];\r\n        const m12 = m[12];\r\n        const m13 = m[13];\r\n        const m14 = m[14];\r\n        const m15 = m[15];\r\n\r\n        const x = vin.x;\r\n        const y = vin.y;\r\n        const z = vin.z;\r\n        const w = vin.w;\r\n\r\n        vout.x = x * m0 + y * m4 + z * m8 + w * m12;\r\n        vout.y = x * m1 + y * m5 + z * m9 + w * m13;\r\n        vout.z = x * m2 + y * m6 + z * m10 + w * m14;\r\n        vout.w = x * m3 + y * m7 + z * m11 + w * m15;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 变换坐标数组数据\r\n     *\r\n     * @param vin 被变换坐标数组数据\r\n     * @param vout 变换后的坐标数组数据\r\n     */\r\n    transformPoints(vin: number[], vout: number[] = [])\r\n    {\r\n        const m = this.elements;\r\n        const m0 = m[0];\r\n        const m1 = m[1];\r\n        const m2 = m[2];\r\n        const m4 = m[4];\r\n        const m5 = m[5];\r\n        const m6 = m[6];\r\n        const m8 = m[8];\r\n        const m9 = m[9];\r\n        const m10 = m[10];\r\n        const m12 = m[12];\r\n        const m13 = m[13];\r\n        const m14 = m[14];\r\n\r\n        for (let i = 0; i < vin.length; i += 3)\r\n        {\r\n            const x = vin[i];\r\n            const y = vin[i + 1];\r\n            const z = vin[i + 2];\r\n\r\n            vout[i] = x * m0 + y * m4 + z * m8 + m12;\r\n            vout[i + 1] = x * m1 + y * m5 + z * m9 + m13;\r\n            vout[i + 2] = x * m2 + y * m6 + z * m10 + m14;\r\n        }\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 变换旋转角度\r\n     *\r\n     * @param vin 被变换的旋转角度\r\n     * @param vout 变换后的旋转角度\r\n     */\r\n    transformRotation(vin: Vector3, vout = new Vector3())\r\n    {\r\n        // 转换旋转\r\n        const rotationMatrix = Matrix4x4.fromRotation(vin.x, vin.y, vin.z);\r\n\r\n        rotationMatrix.append(this);\r\n        const newrotation = rotationMatrix.toTRS()[1];\r\n        let rx = newrotation.x; let ry = newrotation.y; let\r\n            rz = newrotation.z;\r\n        const v = Math.round((rx - vin.x) / 180);\r\n\r\n        if (v % 2 !== 0)\r\n        {\r\n            rx += 180;\r\n            ry = 180 - ry;\r\n            rz += 180;\r\n        }\r\n        //\r\n        const toRound = (a: number, b: number, c = 360) =>\r\n            Math.round((b - a) / c) * c + a;\r\n\r\n        rx = toRound(rx, vin.x);\r\n        ry = toRound(ry, vin.y);\r\n        rz = toRound(rz, vin.z);\r\n        //\r\n        vout.x = rx;\r\n        vout.y = ry;\r\n        vout.z = rz;\r\n\r\n        return vout;\r\n    }\r\n\r\n    /**\r\n     * 使用转换矩阵将 Ray3 对象从一个空间坐标转换到另一个空间坐标。\r\n     *\r\n     * @param inRay 被转换的Ray3。\r\n     * @param outRay 转换后的Ray3。\r\n     * @returns 转换后的Ray3。\r\n     */\r\n    transformRay(inRay: Ray3, outRay = new Ray3())\r\n    {\r\n        this.transformPoint3(inRay.origin, outRay.origin);\r\n        this.transformVector3(inRay.direction, outRay.direction);\r\n\r\n        return outRay;\r\n    }\r\n\r\n    /**\r\n     * 将当前 Matrix4x4 对象转换为一个矩阵，并将互换其中的行和列。\r\n     */\r\n    transpose()\r\n    {\r\n        const m = this.elements;\r\n        let tmp: number;\r\n\r\n        tmp = m[1]; m[1] = m[4]; m[4] = tmp;\r\n        tmp = m[2]; m[2] = m[8]; m[8] = tmp;\r\n        tmp = m[6]; m[6] = m[9]; m[9] = tmp;\r\n\r\n        tmp = m[3]; m[3] = m[12]; m[12] = tmp;\r\n        tmp = m[7]; m[7] = m[13]; m[13] = tmp;\r\n        tmp = m[11]; m[11] = m[14]; m[14] = tmp;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 比较矩阵是否相等\r\n     */\r\n    equals(matrix: Matrix4x4, precision = mathUtil.PRECISION)\r\n    {\r\n        const r2 = matrix.elements;\r\n\r\n        for (let i = 0; i < 16; ++i)\r\n        {\r\n            if (!mathUtil.equals(this.elements[i] - r2[i], 0, precision))\r\n            {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 看向目标位置\r\n     * @param target 目标位置\r\n     * @param upAxis 向上朝向\r\n     */\r\n    lookAt(target: Vector3, upAxis?: Vector3)\r\n    {\r\n        // 获取位移，缩放，在变换过程位移与缩放不变\r\n        const vec = this.toTRS();\r\n        const position = vec[0];\r\n        const scale = vec[2];\r\n\r\n        //\r\n        const xAxis = new Vector3();\r\n        const yAxis = new Vector3();\r\n        const zAxis = new Vector3();\r\n\r\n        upAxis = upAxis || Vector3.Y_AXIS;\r\n\r\n        zAxis.x = target.x - position.x;\r\n        zAxis.y = target.y - position.y;\r\n        zAxis.z = target.z - position.z;\r\n        zAxis.normalize();\r\n\r\n        xAxis.x = upAxis.y * zAxis.z - upAxis.z * zAxis.y;\r\n        xAxis.y = upAxis.z * zAxis.x - upAxis.x * zAxis.z;\r\n        xAxis.z = upAxis.x * zAxis.y - upAxis.y * zAxis.x;\r\n        xAxis.normalize();\r\n\r\n        if (xAxis.lengthSquared < 0.005)\r\n        {\r\n            xAxis.x = upAxis.y;\r\n            xAxis.y = upAxis.x;\r\n            xAxis.z = 0;\r\n            xAxis.normalize();\r\n        }\r\n\r\n        yAxis.x = zAxis.y * xAxis.z - zAxis.z * xAxis.y;\r\n        yAxis.y = zAxis.z * xAxis.x - zAxis.x * xAxis.z;\r\n        yAxis.z = zAxis.x * xAxis.y - zAxis.y * xAxis.x;\r\n\r\n        this.elements[0] = scale.x * xAxis.x;\r\n        this.elements[1] = scale.x * xAxis.y;\r\n        this.elements[2] = scale.x * xAxis.z;\r\n        this.elements[3] = 0;\r\n\r\n        this.elements[4] = scale.y * yAxis.x;\r\n        this.elements[5] = scale.y * yAxis.y;\r\n        this.elements[6] = scale.y * yAxis.z;\r\n        this.elements[7] = 0;\r\n\r\n        this.elements[8] = scale.z * zAxis.x;\r\n        this.elements[9] = scale.z * zAxis.y;\r\n        this.elements[10] = scale.z * zAxis.z;\r\n        this.elements[11] = 0;\r\n\r\n        this.elements[12] = position.x;\r\n        this.elements[13] = position.y;\r\n        this.elements[14] = position.z;\r\n        this.elements[15] = 1;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 获取XYZ轴中最大缩放值\r\n     */\r\n    getMaxScaleOnAxis()\r\n    {\r\n        const m = this.elements;\r\n        const scaleXSq = m[0] * m[0] + m[1] * m[1] + m[2] * m[2];\r\n        const scaleYSq = m[4] * m[4] + m[5] * m[5] + m[6] * m[6];\r\n        const scaleZSq = m[8] * m[8] + m[9] * m[9] + m[10] * m[10];\r\n\r\n        return Math.sqrt(Math.max(scaleXSq, scaleYSq, scaleZSq));\r\n    }\r\n\r\n    /**\r\n     * 初始化正射投影矩阵\r\n     * @param left 可视空间左边界\r\n     * @param right 可视空间右边界\r\n     * @param top 可视空间上边界\r\n     * @param bottom 可视空间下边界\r\n     * @param near 可视空间近边界\r\n     * @param far 可视空间远边界\r\n     *\r\n     * 可视空间的八个顶点分别被投影到立方体 [(-1, -1, -1), (1, 1, 1)] 八个顶点上\r\n     *\r\n     * 将长方体 [(left, bottom, near), (right, top, far)] 投影至立方体 [(-1, -1, -1), (1, 1, 1)] 中\r\n     */\r\n    setOrtho(left: number, right: number, top: number, bottom: number, near: number, far: number)\r\n    {\r\n        const m = this.elements;\r\n\r\n        m[0] = 2 / (right - left); m[4] = 0; /**/ m[8] = 0; /**/ m[12] = -(right + left) / (right - left);//\r\n        m[1] = 0; /**/ m[5] = 2 / (top - bottom); m[9] = 0;/**/ m[13] = -(top + bottom) / (top - bottom);//\r\n        m[2] = 0; /**/ m[6] = 0; /**/ m[10] = 2 / (far - near); m[14] = -(far + near) / (far - near);//\r\n        m[3] = 0; /**/ m[7] = 0; /**/ m[11] = 0; /**/ m[15] = 1;//\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 初始化透视投影矩阵\r\n     * @param fov 垂直视角，视锥体顶面和底面间的夹角，必须大于0 （角度）\r\n     * @param aspect 近裁剪面的宽高比\r\n     * @param near 视锥体近边界\r\n     * @param far 视锥体远边界\r\n     *\r\n     * 视锥体的八个顶点分别被投影到立方体 [(-1, -1, -1), (1, 1, 1)] 八个顶点上\r\n     */\r\n    setPerspectiveFromFOV(fov: number, aspect: number, near: number, far: number)\r\n    {\r\n        const m = this.elements;\r\n\r\n        const tanfov2 = Math.tan(fov * Math.PI / 360);\r\n\r\n        m[0] = 1 / (aspect * tanfov2); m[4] = 0; /**/ m[8] = 0; /**/ m[12] = 0;//\r\n        m[1] = 0; /**/ m[5] = 1 / tanfov2; m[9] = 0;/**/ m[13] = 0;//\r\n        m[2] = 0; /**/ m[6] = 0; /**/ m[10] = (far + near) / (far - near); m[14] = -2 * (far * near) / (far - near);//\r\n        m[3] = 0; /**/ m[7] = 0; /**/ m[11] = 1; /**/ m[15] = 0;//\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 初始化透视投影矩阵\r\n     * @param left 可视空间左边界\r\n     * @param right 可视空间右边界\r\n     * @param top 可视空间上边界\r\n     * @param bottom 可视空间下边界\r\n     * @param near 可视空间近边界\r\n     * @param far 可视空间远边界\r\n     *\r\n     * 可视空间的八个顶点分别被投影到立方体 [(-1, -1, -1), (1, 1, 1)] 八个顶点上\r\n     *\r\n     * 将长方体 [(left, bottom, near), (right, top, far)] 投影至立方体 [(-1, -1, -1), (1, 1, 1)] 中\r\n     */\r\n    setPerspective(left: number, right: number, top: number, bottom: number, near: number, far: number)\r\n    {\r\n        const m = this.elements;\r\n\r\n        m[0] = 2 * near / (right - left); m[4] = 0; /**/ m[8] = 0; /**/ m[12] = 0;//\r\n        m[1] = 0; /**/ m[5] = 2 * near / (top - bottom); m[9] = 0;/**/ m[13] = 0;//\r\n        m[2] = 0; /**/ m[6] = 0; /**/ m[10] = (far + near) / (far - near); m[14] = -2 * (far * near) / (far - near);//\r\n        m[3] = 0; /**/ m[7] = 0; /**/ m[11] = 1; /**/ m[15] = 0;//\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 转换为3x3矩阵\r\n     *\r\n     * @param out 3x3矩阵\r\n     */\r\n    toMatrix3x3(out = new Matrix3x3())\r\n    {\r\n        const outdata = out.elements;\r\n        const indata = this.elements;\r\n\r\n        outdata[0] = indata[0];\r\n        outdata[1] = indata[1];\r\n        outdata[2] = 0;\r\n\r\n        outdata[3] = indata[4];\r\n        outdata[4] = indata[5];\r\n        outdata[5] = 0;\r\n\r\n        outdata[6] = indata[12];\r\n        outdata[7] = indata[13];\r\n        outdata[8] = 1;\r\n\r\n        return out;\r\n    }\r\n\r\n    /**\r\n     * 以字符串返回矩阵的值\r\n     */\r\n    toString(): string\r\n    {\r\n        return `Matrix4x4 [${this.elements.toString()}]`;\r\n    }\r\n\r\n    // Get a column of the matrix.\r\n    GetColumn(index: number)\r\n    {\r\n        const [\r\n            m00, m10, m20, m30,\r\n            m01, m11, m21, m31,\r\n            m02, m12, m22, m32,\r\n            m03, m13, m23, m33,\r\n        ] = this.elements;\r\n        switch (index)\r\n        {\r\n            case 0: return new Vector4(m00, m10, m20, m30);\r\n            case 1: return new Vector4(m01, m11, m21, m31);\r\n            case 2: return new Vector4(m02, m12, m22, m32);\r\n            case 3: return new Vector4(m03, m13, m23, m33);\r\n            default:\r\n                throw 'Invalid column index!';\r\n        }\r\n    }\r\n\r\n    // Returns a row of the matrix.\r\n    GetRow(index: number)\r\n    {\r\n        const [\r\n            m00, m10, m20, m30,\r\n            m01, m11, m21, m31,\r\n            m02, m12, m22, m32,\r\n            m03, m13, m23, m33,\r\n        ] = this.elements;\r\n        switch (index)\r\n        {\r\n            case 0: return new Vector4(m00, m01, m02, m03);\r\n            case 1: return new Vector4(m10, m11, m12, m13);\r\n            case 2: return new Vector4(m20, m21, m22, m23);\r\n            case 3: return new Vector4(m30, m31, m32, m33);\r\n            default:\r\n                throw `Invalid row index!`;\r\n        }\r\n    }\r\n\r\n    // Sets a column of the matrix.\r\n    SetColumn(index: number, column: Vector4)\r\n    {\r\n        this.elements[0 + index * 4] = column.x;\r\n        this.elements[1 + index * 4] = column.y;\r\n        this.elements[2 + index * 4] = column.z;\r\n        this.elements[3 + index * 4] = column.w;\r\n    }\r\n\r\n    // Sets a row of the matrix.\r\n    SetRow(index: number, row: Vector4)\r\n    {\r\n        this.elements[index + 0 * 4] = row.x;\r\n        this.elements[index + 1 * 4] = row.y;\r\n        this.elements[index + 2 * 4] = row.z;\r\n        this.elements[index + 3 * 4] = row.w;\r\n    }\r\n\r\n    // Transforms a position by this matrix, with a perspective divide. (generic)\r\n    MultiplyPoint(point: Vector3, res = new Vector3())\r\n    {\r\n        let w: number;\r\n        const [\r\n            m00, m10, m20, m30,\r\n            m01, m11, m21, m31,\r\n            m02, m12, m22, m32,\r\n            m03, m13, m23, m33,\r\n        ] = this.elements;\r\n        res.x = m00 * point.x + m01 * point.y + m02 * point.z + m03;\r\n        res.y = m10 * point.x + m11 * point.y + m12 * point.z + m13;\r\n        res.z = m20 * point.x + m21 * point.y + m22 * point.z + m23;\r\n        w = m30 * point.x + m31 * point.y + m32 * point.z + m33;\r\n\r\n        w = 1 / w;\r\n        res.x *= w;\r\n        res.y *= w;\r\n        res.z *= w;\r\n\r\n        return res;\r\n    }\r\n\r\n    // Transforms a position by this matrix, without a perspective divide. (fast)\r\n    MultiplyPoint3x4(point: Vector3, res = new Vector3())\r\n    {\r\n        const [\r\n            m00, m10, m20, ,\r\n            m01, m11, m21, ,\r\n            m02, m12, m22, ,\r\n            m03, m13, m23, ,\r\n        ] = this.elements;\r\n        res.x = m00 * point.x + m01 * point.y + m02 * point.z + m03;\r\n        res.y = m10 * point.x + m11 * point.y + m12 * point.z + m13;\r\n        res.z = m20 * point.x + m21 * point.y + m22 * point.z + m23;\r\n\r\n        return res;\r\n    }\r\n\r\n    // Transforms a direction by this matrix.\r\n    MultiplyVector(vector: Vector3, res = new Vector3())\r\n    {\r\n        const [\r\n            m00, m10, m20, ,\r\n            m01, m11, m21, ,\r\n            m02, m12, m22, ,\r\n            , , , ,\r\n        ] = this.elements;\r\n        res.x = m00 * vector.x + m01 * vector.y + m02 * vector.z;\r\n        res.y = m10 * vector.x + m11 * vector.y + m12 * vector.z;\r\n        res.z = m20 * vector.x + m21 * vector.y + m22 * vector.z;\r\n\r\n        return res;\r\n    }\r\n\r\n    // Transforms a plane by this matrix.\r\n    TransformPlane(plane: Plane, result = new Plane())\r\n    {\r\n        const ittrans = this.clone().invert();\r\n        const [\r\n            m00, m10, m20, m30,\r\n            m01, m11, m21, m31,\r\n            m02, m12, m22, m32,\r\n            m03, m13, m23, m33,\r\n        ] = ittrans.elements;\r\n\r\n        const { a, b, c, d } = plane;\r\n\r\n        // note: a transpose is part of this transformation\r\n        result.a = m00 * a + m10 * b + m20 * c + m30 * d;\r\n        result.b = m01 * a + m11 * b + m21 * c + m31 * d;\r\n        result.c = m02 * a + m12 * b + m22 * c + m32 * d;\r\n        result.d = m03 * a + m13 * b + m23 * c + m33 * d;\r\n\r\n        return result;\r\n    }\r\n\r\n    // Creates a scaling matrix.\r\n    static Scale(vector: Vector3, m = new Matrix4x4())\r\n    {\r\n        m.elements = [\r\n            vector.x, 0, 0, 0,\r\n            0, vector.y, 0, 0,\r\n            0, 0, vector.z, 0,\r\n            0, 0, 0, 1,\r\n        ];\r\n\r\n        return m;\r\n    }\r\n\r\n    // Creates a translation matrix.\r\n    static Translate(vector: Vector3, m = new Matrix4x4())\r\n    {\r\n        m.elements = [\r\n            1, 0, 0, 0,\r\n            0, 1, 0, 0,\r\n            0, 0, 1, 0,\r\n            vector.x, vector.y, vector.z, 1,\r\n        ];\r\n\r\n        return m;\r\n    }\r\n\r\n    // Creates a rotation matrix. Note: Assumes unit quaternion\r\n    static Rotate(q: Quaternion, m = new Matrix4x4())\r\n    {\r\n        // Precalculate coordinate products\r\n        const x = q.x * 2.0;\r\n        const y = q.y * 2.0;\r\n        const z = q.z * 2.0;\r\n        const xx = q.x * x;\r\n        const yy = q.y * y;\r\n        const zz = q.z * z;\r\n        const xy = q.x * y;\r\n        const xz = q.x * z;\r\n        const yz = q.y * z;\r\n        const wx = q.w * x;\r\n        const wy = q.w * y;\r\n        const wz = q.w * z;\r\n\r\n        // Calculate 3x3 matrix from orthonormal basis\r\n        m.elements = [\r\n            1.0 - (yy + zz), xy + wz, xz - wy, 0.0,\r\n            xy - wz, 1.0 - (xx + zz), yz + wx, 0.0,\r\n            xz + wy, yz - wx, 1.0 - (xx + yy), 0.0,\r\n            0.0, 0.0, 0.0, 1.0\r\n        ];\r\n\r\n        return m;\r\n    }\r\n\r\n    // Returns a matrix with all elements set to zero (RO).\r\n    static readonly zero = new Matrix4x4(\r\n        [\r\n            0, 0, 0, 0,\r\n            0, 0, 0, 0,\r\n            0, 0, 0, 0,\r\n            0, 0, 0, 0,\r\n        ]);\r\n\r\n    // Returns the identity matrix (RO).\r\n    static readonly identity = new Matrix4x4(\r\n        [\r\n            1, 0, 0, 0,\r\n            0, 1, 0, 0,\r\n            0, 0, 1, 0,\r\n            0, 0, 0, 1,\r\n        ]);\r\n\r\n    get rotation()\r\n    {\r\n        const quaternion = new Quaternion().fromMatrix(this);\r\n\r\n        return quaternion;\r\n    }\r\n\r\n    get lossyScale()\r\n    {\r\n        return this.getScale();\r\n    }\r\n\r\n    get isIdentity()\r\n    {\r\n        const elements0 = this.elements;\r\n        const elements1 = Matrix4x4.identity.elements;\r\n\r\n        for (let i = 0; i < elements0.length; i++)\r\n        {\r\n            if (!mathUtil.equals(elements0[i], elements1[i]))\r\n            {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n}\r\n","/**\r\n * 渐变模式\r\n */\r\nexport enum GradientMode\r\n{\r\n    /**\r\n     * 混合\r\n     */\r\n    Blend,\r\n    /**\r\n     * 阶梯\r\n     */\r\n    Fixed\r\n}\r\n","import { mathUtil } from '@feng3d/polyfill';\r\nimport { RotationOrder } from '../enums/RotationOrder';\r\nimport { Matrix4x4 } from './Matrix4x4';\r\nimport { Quaternion } from './Quaternion';\r\nimport { Vector3 } from './Vector3';\r\n\r\n/**\r\n * 欧拉角\r\n *\r\n * 由特定的顺序分别围绕X、Y、Z三个轴进行旋转。\r\n *\r\n * @see https://github.com/mrdoob/three.js/blob/dev/src/math/Euler.js\r\n */\r\nexport class Euler\r\n{\r\n    /**\r\n     * 围绕X轴旋转角度。\r\n     */\r\n    x: number;\r\n\r\n    /**\r\n     * 围绕Y轴旋转角度。\r\n     */\r\n    y: number;\r\n\r\n    /**\r\n     * 围绕Z轴旋转角度。\r\n     */\r\n    z: number;\r\n\r\n    /**\r\n     * X、Y、Z轴旋顺序。\r\n     */\r\n    order: RotationOrder;\r\n\r\n    /**\r\n     * 构建欧拉角。\r\n     *\r\n     * @param x 围绕X轴旋转角度。\r\n     * @param y 围绕Y轴旋转角度。\r\n     * @param z 围绕Z轴旋转角度。\r\n     * @param order X、Y、Z轴旋顺序。\r\n     */\r\n    constructor(x = 0, y = 0, z = 0, order = mathUtil.DefaultRotationOrder)\r\n    {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n        this.order = order;\r\n    }\r\n\r\n    /**\r\n     * 设置欧拉角初始值。\r\n     *\r\n     * @param x 围绕X轴旋转角度。\r\n     * @param y 围绕Y轴旋转角度。\r\n     * @param z 围绕Z轴旋转角度。\r\n     * @param order X、Y、Z轴旋顺序。\r\n     */\r\n    set(x: number, y: number, z: number, order?: RotationOrder)\r\n    {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n        if (order !== undefined)\r\n        {\r\n            this.order = order;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 随机欧拉角。\r\n     */\r\n    random()\r\n    {\r\n        this.x = Math.random() * 360;\r\n        this.y = Math.random() * 360;\r\n        this.z = Math.random() * 360;\r\n        this.order = mathUtil.randInt(0, 5);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 克隆欧拉角。\r\n     */\r\n    clone()\r\n    {\r\n        return new Euler(this.x, this.y, this.z, this.order);\r\n    }\r\n\r\n    /**\r\n     * 从旋转矩阵初始化欧拉角。\r\n     *\r\n     * @param rotationMatrix 仅包含旋转的矩阵。\r\n     * @param order X、Y、Z轴旋顺序。\r\n     * @returns 从旋转矩阵初始化的欧拉角。\r\n     */\r\n    fromRotationMatrix(rotationMatrix: Matrix4x4, order?: RotationOrder)\r\n    {\r\n        const te = rotationMatrix.elements;\r\n        const m11 = te[0];\r\n        const m12 = te[4];\r\n        const m13 = te[8];\r\n        const m21 = te[1];\r\n        const m22 = te[5];\r\n        const m23 = te[9];\r\n        const m31 = te[2];\r\n        const m32 = te[6];\r\n        const m33 = te[10];\r\n\r\n        if (order === undefined)\r\n        {\r\n            order = this.order;\r\n        }\r\n\r\n        let x: number;\r\n        let y: number;\r\n        let z: number;\r\n\r\n        switch (order)\r\n        {\r\n            case RotationOrder.XYZ:\r\n                y = Math.asin(mathUtil.clamp(m13, -1, 1));\r\n                if (Math.abs(m13) < 0.9999999)\r\n                {\r\n                    x = Math.atan2(-m23, m33);\r\n                    z = Math.atan2(-m12, m11);\r\n                }\r\n                else\r\n                {\r\n                    x = Math.atan2(m32, m22);\r\n                    z = 0;\r\n                }\r\n                break;\r\n            case RotationOrder.YXZ:\r\n                x = Math.asin(-mathUtil.clamp(m23, -1, 1));\r\n                if (Math.abs(m23) < 0.9999999)\r\n                {\r\n                    y = Math.atan2(m13, m33);\r\n                    z = Math.atan2(m21, m22);\r\n                }\r\n                else\r\n                {\r\n                    y = Math.atan2(-m31, m11);\r\n                    z = 0;\r\n                }\r\n                break;\r\n\r\n            case RotationOrder.ZXY:\r\n                x = Math.asin(mathUtil.clamp(m32, -1, 1));\r\n                if (Math.abs(m32) < 0.9999999)\r\n                {\r\n                    y = Math.atan2(-m31, m33);\r\n                    z = Math.atan2(-m12, m22);\r\n                }\r\n                else\r\n                {\r\n                    y = 0;\r\n                    z = Math.atan2(m21, m11);\r\n                }\r\n                break;\r\n\r\n            case RotationOrder.ZYX:\r\n                y = Math.asin(-mathUtil.clamp(m31, -1, 1));\r\n                if (Math.abs(m31) < 0.9999999)\r\n                {\r\n                    x = Math.atan2(m32, m33);\r\n                    z = Math.atan2(m21, m11);\r\n                }\r\n                else\r\n                {\r\n                    x = 0;\r\n                    z = Math.atan2(-m12, m22);\r\n                }\r\n                break;\r\n            case RotationOrder.YZX:\r\n                z = Math.asin(mathUtil.clamp(m21, -1, 1));\r\n                if (Math.abs(m21) < 0.9999999)\r\n                {\r\n                    x = Math.atan2(-m23, m22);\r\n                    y = Math.atan2(-m31, m11);\r\n                }\r\n                else\r\n                {\r\n                    x = 0;\r\n                    y = Math.atan2(m13, m33);\r\n                }\r\n                break;\r\n\r\n            case RotationOrder.XZY:\r\n                z = Math.asin(-mathUtil.clamp(m12, -1, 1));\r\n                if (Math.abs(m12) < 0.9999999)\r\n                {\r\n                    x = Math.atan2(m32, m22);\r\n                    y = Math.atan2(m13, m11);\r\n                }\r\n                else\r\n                {\r\n                    x = Math.atan2(-m23, m33);\r\n                    y = 0;\r\n                }\r\n                break;\r\n            default:\r\n                console.warn(`THREE.Euler: .fromRotationMatrix() encountered an unknown order: ${order}`);\r\n        }\r\n\r\n        this.x = x * mathUtil.RAD2DEG;\r\n        this.y = y * mathUtil.RAD2DEG;\r\n        this.z = z * mathUtil.RAD2DEG;\r\n        this.order = order;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 从四元素初始化欧拉角。\r\n     *\r\n     * @param q 四元素。\r\n     * @param order X、Y、Z轴旋顺序。\r\n     * @returns 初始化后的四元素。\r\n     */\r\n    fromQuaternion(q: Quaternion, order?: RotationOrder)\r\n    {\r\n        if (order === undefined)\r\n        {\r\n            order = this.order;\r\n        }\r\n\r\n        const matrix = new Matrix4x4();\r\n        matrix.fromQuaternion(q);\r\n\r\n        return this.fromRotationMatrix(matrix, order);\r\n    }\r\n\r\n    /**\r\n     * 从三个轴的旋转角度初始化四元素。\r\n     *\r\n     * @param v 存储X、Y、Z轴旋转量的向量。\r\n     * @param order X、Y、Z轴旋顺序。\r\n     * @returns 初始化后的四元素。\r\n     */\r\n    fromVector3(v: Vector3, order?: RotationOrder)\r\n    {\r\n        if (order === undefined)\r\n        {\r\n            order = this.order;\r\n        }\r\n\r\n        return this.set(v.x, v.y, v.z, order);\r\n    }\r\n\r\n    /**\r\n     * 在不改变旋转量的情况下更换X、Y、Z轴旋顺序。\r\n     *\r\n     * @param newOrder 新的X、Y、Z轴旋顺序。\r\n     * @returns 重置旋转角度。\r\n     */\r\n    reorder(newOrder: RotationOrder)\r\n    {\r\n        const quaternion = new Quaternion();\r\n\r\n        quaternion.fromEuler(this.x, this.y, this.z, this.order);\r\n\r\n        return this.fromQuaternion(quaternion, newOrder);\r\n    }\r\n\r\n    /**\r\n     * 判断与指定欧拉角是否相等。\r\n     *\r\n     * @param euler 被比较的欧拉角。\r\n     * @returns 如果值为true则两个欧拉角相等，否则不相等。\r\n     */\r\n    equals(euler: Euler)\r\n    {\r\n        return (euler.x === this.x) && (euler.y === this.y) && (euler.z === this.z) && (euler.order === this.order);\r\n    }\r\n\r\n    /**\r\n     * 从数组初始化欧拉角。\r\n     *\r\n     * @param array 存储X、Y、Z轴旋角度以及旋转顺序的数组。\r\n     * @param offset 数组中存储便宜位置。\r\n     * @returns 初始化后的四元素。\r\n     */\r\n    fromArray(array: number[], offset = 0)\r\n    {\r\n        this.x = array[offset];\r\n        this.y = array[offset + 1];\r\n        this.z = array[offset + 2];\r\n        this.order = array[offset + 3];\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 转换为存储X、Y、Z轴旋转角度以及旋转顺序的数组。\r\n     *\r\n     * @param array 存储X、Y、Z轴旋转角度以及旋转顺序的数组。\r\n     * @param offset 数组中存储便宜位置。\r\n     * @returns 存储X、Y、Z轴旋转角度以及旋转顺序的数组。\r\n     */\r\n    toArray(array: number[] = [], offset = 0)\r\n    {\r\n        array[offset] = this.x;\r\n        array[offset + 1] = this.y;\r\n        array[offset + 2] = this.z;\r\n        array[offset + 3] = this.order;\r\n\r\n        return array;\r\n    }\r\n\r\n    /**\r\n     * 转换为存储X、Y、Z轴旋转角度的向量。\r\n     *\r\n     * @param vector3 存储X、Y、Z轴旋转角度的向量。\r\n     * @returns 存储X、Y、Z轴旋转角度的向量。\r\n     */\r\n    toVector3(vector3 = new Vector3())\r\n    {\r\n        vector3.set(this.x, this.y, this.z);\r\n\r\n        return vector3;\r\n    }\r\n}\r\n","import { mathUtil } from '@feng3d/polyfill';\r\nimport { Box3 } from './Box3';\r\nimport { Matrix4x4 } from './Matrix4x4';\r\nimport { Plane } from './Plane';\r\nimport { Sphere } from './Sphere';\r\nimport { Vector3 } from './Vector3';\r\n\r\n/**\r\n * 截头锥体\r\n *\r\n * Frustums are used to determine what is inside the camera's field of view. They help speed up the rendering process.\r\n *\r\n * Frustums用于确定摄像机的视场范围。它们有助于加速渲染过程。\r\n *\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author bhouston / http://clara.io\r\n */\r\nexport class Frustum\r\n{\r\n    planes: Plane[];\r\n\r\n    /**\r\n     * 初始化截头锥体\r\n     *\r\n     * @param p0\r\n     * @param p1\r\n     * @param p2\r\n     * @param p3\r\n     * @param p4\r\n     * @param p5\r\n     */\r\n    constructor(p0 = new Plane(), p1 = new Plane(), p2 = new Plane(), p3 = new Plane(), p4 = new Plane(), p5 = new Plane())\r\n    {\r\n        this.planes = [\r\n            p0, p1, p2, p3, p4, p5\r\n        ];\r\n    }\r\n\r\n    set(p0: Plane, p1: Plane, p2: Plane, p3: Plane, p4: Plane, p5: Plane)\r\n    {\r\n        const planes = this.planes;\r\n\r\n        planes[0].copy(p0);\r\n        planes[1].copy(p1);\r\n        planes[2].copy(p2);\r\n        planes[3].copy(p3);\r\n        planes[4].copy(p4);\r\n        planes[5].copy(p5);\r\n\r\n        return this;\r\n    }\r\n\r\n    clone()\r\n    {\r\n        return new Frustum().copy(this);\r\n    }\r\n\r\n    copy(frustum: Frustum)\r\n    {\r\n        const planes = this.planes;\r\n\r\n        for (let i = 0; i < 6; i++)\r\n        {\r\n            planes[i].copy(frustum.planes[i]);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 从矩阵初始化\r\n     *\r\n     * @param matrix4x4 矩阵\r\n     */\r\n    fromMatrix(matrix4x4: Matrix4x4)\r\n    {\r\n        const planes = this.planes;\r\n        const me = matrix4x4.elements;\r\n        const me0 = me[0]; const me1 = me[1]; const me2 = me[2]; const\r\n            me3 = me[3];\r\n        const me4 = me[4]; const me5 = me[5]; const me6 = me[6]; const\r\n            me7 = me[7];\r\n        const me8 = me[8]; const me9 = me[9]; const me10 = me[10]; const\r\n            me11 = me[11];\r\n        const me12 = me[12]; const me13 = me[13]; const me14 = me[14]; const\r\n            me15 = me[15];\r\n\r\n        planes[0].set(me3 - me0, me7 - me4, me11 - me8, me15 - me12).normalize();\r\n        planes[1].set(me3 + me0, me7 + me4, me11 + me8, me15 + me12).normalize();\r\n        planes[2].set(me3 + me1, me7 + me5, me11 + me9, me15 + me13).normalize();\r\n        planes[3].set(me3 - me1, me7 - me5, me11 - me9, me15 - me13).normalize();\r\n        planes[4].set(me3 - me2, me7 - me6, me11 - me10, me15 - me14).normalize();\r\n        planes[5].set(me3 + me2, me7 + me6, me11 + me10, me15 + me14).normalize();\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 是否与球体相交\r\n     *\r\n     * @param sphere 球体\r\n     */\r\n    intersectsSphere(sphere: Sphere)\r\n    {\r\n        const planes = this.planes;\r\n        const center = sphere.center;\r\n        const negRadius = -sphere.radius;\r\n\r\n        for (let i = 0; i < 6; i++)\r\n        {\r\n            const distance = planes[i].distanceWithPoint(center);\r\n\r\n            if (distance < negRadius)\r\n            {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 是否与长方体相交\r\n     *\r\n     * @param box 长方体\r\n     */\r\n    intersectsBox(box: Box3)\r\n    {\r\n        const planes = this.planes;\r\n\r\n        const temp = new Vector3();\r\n\r\n        for (let i = 0; i < 6; i++)\r\n        {\r\n            const plane = planes[i];\r\n\r\n            // corner at max distance\r\n            const normal = plane.getNormal();\r\n\r\n            temp.x = normal.x > 0 ? box.max.x : box.min.x;\r\n            temp.y = normal.y > 0 ? box.max.y : box.min.y;\r\n            temp.z = normal.z > 0 ? box.max.z : box.min.z;\r\n\r\n            if (plane.distanceWithPoint(temp) < 0)\r\n            {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 与点是否相交\r\n     *\r\n     * @param point\r\n     */\r\n    containsPoint(point: Vector3, precision = mathUtil.PRECISION)\r\n    {\r\n        const planes = this.planes;\r\n\r\n        for (let i = 0; i < 6; i++)\r\n        {\r\n            if (planes[i].distanceWithPoint(point) < -precision)\r\n            {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n}\r\n","import { Vector2 } from './Vector2';\r\n\r\nexport interface IRectangle\r\n{\r\n    /**\r\n     * 矩形左上角的 x 坐标。\r\n     * @default 0\r\n     */\r\n    x: number;\r\n\r\n    /**\r\n     * 矩形左上角的 y 坐标。\r\n     * @default 0\r\n     */\r\n    y: number;\r\n\r\n    /**\r\n     * 矩形的宽度。\r\n     * @default 0\r\n     */\r\n    width: number;\r\n\r\n    /**\r\n     * 矩形的高度。\r\n     * @default 0\r\n     */\r\n    height: number;\r\n}\r\n\r\n/**\r\n * 矩形\r\n *\r\n * Rectangle 对象是按其位置（由它左上角的点 (x, y) 确定）以及宽度和高度定义的区域。<br/>\r\n * Rectangle 类的 x、y、width 和 height 属性相互独立；更改一个属性的值不会影响其他属性。\r\n * 但是，right 和 bottom 属性与这四个属性是整体相关的。例如，如果更改 right 属性的值，则 width\r\n * 属性的值将发生变化；如果更改 bottom 属性，则 height 属性的值将发生变化。\r\n */\r\nexport class Rectangle\r\n{\r\n    /**\r\n     * 创建一个新 Rectangle 对象，其左上角由 x 和 y 参数指定，并具有指定的 width 和 height 参数。\r\n     * @param x 矩形左上角的 x 坐标。\r\n     * @param y 矩形左上角的 y 坐标。\r\n     * @param width 矩形的宽度（以像素为单位）。\r\n     * @param height 矩形的高度（以像素为单位）。\r\n     */\r\n    constructor(x = 0, y = 0, width = 0, height = 0)\r\n    {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.width = width;\r\n        this.height = height;\r\n    }\r\n\r\n    /**\r\n     * 矩形左上角的 x 坐标。\r\n     * @default 0\r\n     */\r\n    x: number;\r\n\r\n    /**\r\n     * 矩形左上角的 y 坐标。\r\n     * @default 0\r\n     */\r\n    y: number;\r\n\r\n    /**\r\n     * 矩形的宽度（以像素为单位）。\r\n     * @default 0\r\n     */\r\n    width: number;\r\n    /**\r\n     * 矩形的高度（以像素为单位）。\r\n     * @default 0\r\n     */\r\n    height: number;\r\n\r\n    /**\r\n     * x 和 width 属性的和。\r\n     */\r\n    get right(): number\r\n    {\r\n        return this.x + this.width;\r\n    }\r\n\r\n    set right(value: number)\r\n    {\r\n        this.width = value - this.x;\r\n    }\r\n\r\n    /**\r\n     * y 和 height 属性的和。\r\n     */\r\n    get bottom(): number\r\n    {\r\n        return this.y + this.height;\r\n    }\r\n\r\n    set bottom(value: number)\r\n    {\r\n        this.height = value - this.y;\r\n    }\r\n\r\n    /**\r\n     * 矩形左上角的 x 坐标。更改 Rectangle 对象的 left 属性对 y 和 height 属性没有影响。但是，它会影响 width 属性，而更改 x 值不会影响 width 属性。\r\n     * left 属性的值等于 x 属性的值。\r\n     */\r\n    get left(): number\r\n    {\r\n        return this.x;\r\n    }\r\n\r\n    set left(value: number)\r\n    {\r\n        this.width += this.x - value;\r\n        this.x = value;\r\n    }\r\n\r\n    /**\r\n     * 矩形左上角的 y 坐标。更改 Rectangle 对象的 top 属性对 x 和 width 属性没有影响。但是，它会影响 height 属性，而更改 y 值不会影响 height 属性。<br/>\r\n     * top 属性的值等于 y 属性的值。\r\n     */\r\n    get top(): number\r\n    {\r\n        return this.y;\r\n    }\r\n\r\n    set top(value: number)\r\n    {\r\n        this.height += this.y - value;\r\n        this.y = value;\r\n    }\r\n\r\n    /**\r\n     * 由该点的 x 和 y 坐标确定的 Rectangle 对象左上角的位置。\r\n     */\r\n    get topLeft(): Vector2\r\n    {\r\n        return new Vector2(this.left, this.top);\r\n    }\r\n\r\n    set topLeft(value: Vector2)\r\n    {\r\n        this.top = value.y;\r\n        this.left = value.x;\r\n    }\r\n\r\n    /**\r\n     * 由 right 和 bottom 属性的值确定的 Rectangle 对象的右下角的位置。\r\n     */\r\n    get bottomRight(): Vector2\r\n    {\r\n        return new Vector2(this.right, this.bottom);\r\n    }\r\n\r\n    set bottomRight(value: Vector2)\r\n    {\r\n        this.bottom = value.y;\r\n        this.right = value.x;\r\n    }\r\n\r\n    /**\r\n     * 中心点\r\n     */\r\n    get center()\r\n    {\r\n        return new Vector2(this.x + (this.width / 2), this.y + (this.height / 2));\r\n    }\r\n\r\n    /**\r\n     * 将源 Rectangle 对象中的所有矩形数据复制到调用方 Rectangle 对象中。\r\n     * @param sourceRect 要从中复制数据的 Rectangle 对象。\r\n     */\r\n    copyFrom(sourceRect: IRectangle): Rectangle\r\n    {\r\n        this.x = sourceRect.x;\r\n        this.y = sourceRect.y;\r\n        this.width = sourceRect.width;\r\n        this.height = sourceRect.height;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 将 Rectangle 的成员设置为指定值\r\n     * @param x 矩形左上角的 x 坐标。\r\n     * @param y 矩形左上角的 y 坐标。\r\n     * @param width 矩形的宽度（以像素为单位）。\r\n     * @param height 矩形的高度（以像素为单位）。\r\n     */\r\n    init(x: number, y: number, width: number, height: number): Rectangle\r\n    {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.width = width;\r\n        this.height = height;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 确定由此 Rectangle 对象定义的矩形区域内是否包含指定的点。\r\n     * @param x 检测点的x轴\r\n     * @param y 检测点的y轴\r\n     * @returns 如果检测点位于矩形内，返回true，否则，返回false\r\n     */\r\n    contains(x: number, y: number): boolean\r\n    {\r\n        return this.x <= x\r\n            && this.x + this.width >= x\r\n            && this.y <= y\r\n            && this.y + this.height >= y;\r\n    }\r\n\r\n    /**\r\n     * 如果在 toIntersect 参数中指定的 Rectangle 对象与此 Rectangle 对象相交，则返回交集区域作为 Rectangle 对象。如果矩形不相交，\r\n     * 则此方法返回一个空的 Rectangle 对象，其属性设置为 0。\r\n     * @param toIntersect 要对照比较以查看其是否与此 Rectangle 对象相交的 Rectangle 对象。\r\n     * @returns 等于交集区域的 Rectangle 对象。如果该矩形不相交，则此方法返回一个空的 Rectangle 对象；即，其 x、y、width 和\r\n     * height 属性均设置为 0 的矩形。\r\n     */\r\n    intersection(toIntersect: Rectangle): Rectangle\r\n    {\r\n        if (!this.intersects(toIntersect))\r\n        { return new Rectangle(); }\r\n\r\n        const i: Rectangle = new Rectangle();\r\n\r\n        if (this.x > toIntersect.x)\r\n        {\r\n            i.x = this.x;\r\n            i.width = toIntersect.x - this.x + toIntersect.width;\r\n\r\n            if (i.width > this.width)\r\n            { i.width = this.width; }\r\n        }\r\n        else\r\n        {\r\n            i.x = toIntersect.x;\r\n            i.width = this.x - toIntersect.x + this.width;\r\n\r\n            if (i.width > toIntersect.width)\r\n            { i.width = toIntersect.width; }\r\n        }\r\n\r\n        if (this.y > toIntersect.y)\r\n        {\r\n            i.y = this.y;\r\n            i.height = toIntersect.y - this.y + toIntersect.height;\r\n\r\n            if (i.height > this.height)\r\n            { i.height = this.height; }\r\n        }\r\n        else\r\n        {\r\n            i.y = toIntersect.y;\r\n            i.height = this.y - toIntersect.y + this.height;\r\n\r\n            if (i.height > toIntersect.height)\r\n            { i.height = toIntersect.height; }\r\n        }\r\n\r\n        return i;\r\n    }\r\n\r\n    /**\r\n     * 按指定量增加 Rectangle 对象的大小（以像素为单位）\r\n     * 保持 Rectangle 对象的中心点不变，使用 dx 值横向增加它的大小，使用 dy 值纵向增加它的大小。\r\n     * @param dx Rectangle 对象横向增加的值。\r\n     * @param dy Rectangle 对象纵向增加的值。\r\n     */\r\n    inflate(dx: number, dy: number): void\r\n    {\r\n        this.x -= dx;\r\n        this.width += 2 * dx;\r\n        this.y -= dy;\r\n        this.height += 2 * dy;\r\n    }\r\n\r\n    /**\r\n     * 确定在 toIntersect 参数中指定的对象是否与此 Rectangle 对象相交。此方法检查指定的 Rectangle\r\n     * 对象的 x、y、width 和 height 属性，以查看它是否与此 Rectangle 对象相交。\r\n     * @param toIntersect 要与此 Rectangle 对象比较的 Rectangle 对象。\r\n     * @returns 如果两个矩形相交，返回true，否则返回false\r\n     */\r\n    intersects(toIntersect: Rectangle): boolean\r\n    {\r\n        return Math.max(this.x, toIntersect.x) <= Math.min(this.right, toIntersect.right)\r\n            && Math.max(this.y, toIntersect.y) <= Math.min(this.bottom, toIntersect.bottom);\r\n    }\r\n\r\n    /**\r\n     * 确定此 Rectangle 对象是否为空。\r\n     * @returns 如果 Rectangle 对象的宽度或高度小于等于 0，则返回 true 值，否则返回 false。\r\n     */\r\n    isEmpty(): boolean\r\n    {\r\n        return this.width <= 0 || this.height <= 0;\r\n    }\r\n\r\n    /**\r\n     * 将 Rectangle 对象的所有属性设置为 0。\r\n     */\r\n    setEmpty(): void\r\n    {\r\n        this.x = 0;\r\n        this.y = 0;\r\n        this.width = 0;\r\n        this.height = 0;\r\n    }\r\n\r\n    /**\r\n     * 返回一个新的 Rectangle 对象，其 x、y、width 和 height 属性的值与原始 Rectangle 对象的对应值相同。\r\n     * @returns 新的 Rectangle 对象，其 x、y、width 和 height 属性的值与原始 Rectangle 对象的对应值相同。\r\n     */\r\n    clone(): Rectangle\r\n    {\r\n        return new Rectangle(this.x, this.y, this.width, this.height);\r\n    }\r\n\r\n    /**\r\n     * 确定由此 Rectangle 对象定义的矩形区域内是否包含指定的点。\r\n     * 此方法与 Rectangle.contains() 方法类似，只不过它采用 Point 对象作为参数。\r\n     * @param point 包含点对象\r\n     * @returns 如果包含，返回true，否则返回false\r\n     */\r\n    containsPoint(point: Vector2): boolean\r\n    {\r\n        if (this.x < point.x\r\n            && this.x + this.width > point.x\r\n            && this.y < point.y\r\n            && this.y + this.height > point.y)\r\n        {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * 确定此 Rectangle 对象内是否包含由 rect 参数指定的 Rectangle 对象。\r\n     * 如果一个 Rectangle 对象完全在另一个 Rectangle 的边界内，我们说第二个 Rectangle 包含第一个 Rectangle。\r\n     * @param rect 所检查的 Rectangle 对象\r\n     * @returns 如果此 Rectangle 对象包含您指定的 Rectangle 对象，则返回 true 值，否则返回 false。\r\n     */\r\n    containsRect(rect: Rectangle): boolean\r\n    {\r\n        const r1 = rect.x + rect.width;\r\n        const b1 = rect.y + rect.height;\r\n        const r2 = this.x + this.width;\r\n        const b2 = this.y + this.height;\r\n\r\n        return (rect.x >= this.x) && (rect.x < r2) && (rect.y >= this.y) && (rect.y < b2) && (r1 > this.x) && (r1 <= r2) && (b1 > this.y) && (b1 <= b2);\r\n    }\r\n\r\n    /**\r\n     * 确定在 toCompare 参数中指定的对象是否等于此 Rectangle 对象。\r\n     * 此方法将某个对象的 x、y、width 和 height 属性与此 Rectangle 对象所对应的相同属性进行比较。\r\n     * @param toCompare 要与此 Rectangle 对象进行比较的矩形。\r\n     * @returns 如果对象具有与此 Rectangle 对象完全相同的 x、y、width 和 height 属性值，则返回 true 值，否则返回 false。\r\n     */\r\n    equals(toCompare: Rectangle): boolean\r\n    {\r\n        if (this === toCompare)\r\n        {\r\n            return true;\r\n        }\r\n\r\n        return this.x === toCompare.x && this.y === toCompare.y\r\n            && this.width === toCompare.width && this.height === toCompare.height;\r\n    }\r\n\r\n    /**\r\n     * 增加 Rectangle 对象的大小。此方法与 Rectangle.inflate() 方法类似，只不过它采用 Point 对象作为参数。\r\n     */\r\n    inflatePoint(point: Vector2): void\r\n    {\r\n        this.inflate(point.x, point.y);\r\n    }\r\n\r\n    /**\r\n     * 按指定量调整 Rectangle 对象的位置（由其左上角确定）。\r\n     * @param dx 将 Rectangle 对象的 x 值移动此数量。\r\n     * @param dy 将 Rectangle 对象的 t 值移动此数量。\r\n     */\r\n    offset(dx: number, dy: number): void\r\n    {\r\n        this.x += dx;\r\n        this.y += dy;\r\n    }\r\n\r\n    /**\r\n     * 将 Point 对象用作参数来调整 Rectangle 对象的位置。此方法与 Rectangle.offset() 方法类似，只不过它采用 Point 对象作为参数。\r\n     * @param point 要用于偏移此 Rectangle 对象的 Point 对象。\r\n     */\r\n    offsetPoint(point: Vector2): void\r\n    {\r\n        this.offset(point.x, point.y);\r\n    }\r\n\r\n    /**\r\n     * 生成并返回一个字符串，该字符串列出 Rectangle 对象的水平位置和垂直位置以及高度和宽度。\r\n     * @returns 一个字符串，它列出了 Rectangle 对象的下列各个属性的值：x、y、width 和 height。\r\n     */\r\n    toString(): string\r\n    {\r\n        return `(x=${this.x}, y=${this.y}, width=${this.width}, height=${this.height})`;\r\n    }\r\n\r\n    /**\r\n     * 通过填充两个矩形之间的水平和垂直空间，将这两个矩形组合在一起以创建一个新的 Rectangle 对象。\r\n     * @param toUnion 要添加到此 Rectangle 对象的 Rectangle 对象。\r\n     * @returns 充当两个矩形的联合的新 Rectangle 对象。\r\n     */\r\n    union(toUnion: Rectangle): Rectangle\r\n    {\r\n        const result = this.clone();\r\n\r\n        if (toUnion.isEmpty())\r\n        {\r\n            return result;\r\n        }\r\n        if (result.isEmpty())\r\n        {\r\n            result.copyFrom(toUnion);\r\n\r\n            return result;\r\n        }\r\n        const l = Math.min(result.x, toUnion.x);\r\n        const t = Math.min(result.y, toUnion.y);\r\n\r\n        result.init(l, t,\r\n            Math.max(result.right, toUnion.right) - l,\r\n            Math.max(result.bottom, toUnion.bottom) - t);\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param point 点\r\n     * @param pout 输出点\r\n     */\r\n    clampPoint(point: Vector2, pout = new Vector2())\r\n    {\r\n        return pout.copy(point).clamp(this.topLeft, this.bottomRight);\r\n    }\r\n\r\n    /**\r\n     * The size of the Rectangle object, expressed as a Point object with the\r\n     * values of the <code>width</code> and <code>height</code> properties.\r\n     */\r\n    public get size(): Vector2\r\n    {\r\n        return new Vector2(this.width, this.height);\r\n    }\r\n}\r\n","import { Box3 } from './Box3';\r\nimport { Matrix4x4 } from './Matrix4x4';\r\nimport { Plane } from './Plane';\r\nimport { Vector3 } from './Vector3';\r\n\r\n/**\r\n * 球\r\n */\r\nexport class Sphere\r\n{\r\n    /**\r\n     * 从一组点初始化球\r\n     * @param points 点列表\r\n     */\r\n    static fromPoints(points: Vector3[])\r\n    {\r\n        return new Sphere().fromPoints(points);\r\n    }\r\n\r\n    /**\r\n     * 从一组顶点初始化球\r\n     * @param positions 坐标数据列表\r\n     */\r\n    static fromPositions(positions: number[])\r\n    {\r\n        return new Sphere().fromPositions(positions);\r\n    }\r\n\r\n    /**\r\n     * 球心\r\n     */\r\n    center: Vector3;\r\n\r\n    /**\r\n     * 半径\r\n     */\r\n    radius: number;\r\n\r\n    /**\r\n     * Create a Sphere with ABCD coefficients\r\n     */\r\n    constructor(center = new Vector3(), radius = 0)\r\n    {\r\n        this.center = center;\r\n        this.radius = radius;\r\n    }\r\n\r\n    /**\r\n     * 与射线相交\r\n     * @param position 射线起点\r\n     * @param direction 射线方向\r\n     * @param targetNormal 目标法线\r\n     * @returns 射线起点到交点的距离\r\n     */\r\n    rayIntersection(position: Vector3, direction: Vector3, targetNormal: Vector3): number\r\n    {\r\n        if (this.containsPoint(position))\r\n        { return 0; }\r\n\r\n        const px: number = position.x - this.center.x;\r\n        const py: number = position.y - this.center.y;\r\n        const pz: number = position.z - this.center.z;\r\n        const vx: number = direction.x;\r\n        const vy: number = direction.y;\r\n        const vz: number = direction.z;\r\n        let rayEntryDistance: number;\r\n\r\n        const a: number = (vx * vx) + (vy * vy) + (vz * vz);\r\n        const b: number = 2 * ((px * vx) + (py * vy) + (pz * vz));\r\n        const c: number = (px * px) + (py * py) + (pz * pz) - (this.radius * this.radius);\r\n        const det: number = (b * b) - (4 * a * c);\r\n\r\n        if (det >= 0)\r\n        { // ray goes through sphere\r\n            const sqrtDet: number = Math.sqrt(det);\r\n\r\n            rayEntryDistance = (-b - sqrtDet) / (2 * a);\r\n            if (rayEntryDistance >= 0)\r\n            {\r\n                targetNormal.x = px + (rayEntryDistance * vx);\r\n                targetNormal.y = py + (rayEntryDistance * vy);\r\n                targetNormal.z = pz + (rayEntryDistance * vz);\r\n                targetNormal.normalize();\r\n\r\n                return rayEntryDistance;\r\n            }\r\n        }\r\n\r\n        // ray misses sphere\r\n        return -1;\r\n    }\r\n\r\n    /**\r\n     * 是否包含指定点\r\n     * @param position 点\r\n     */\r\n    containsPoint(position: Vector3): boolean\r\n    {\r\n        return position.subTo(this.center).lengthSquared <= this.radius * this.radius;\r\n    }\r\n\r\n    /**\r\n     * 从一组点初始化球\r\n     * @param points 点列表\r\n     */\r\n    fromPoints(points: Vector3[])\r\n    {\r\n        const box = new Box3();\r\n        const center = this.center;\r\n\r\n        box.fromPoints(points).getCenter(center);\r\n        let maxRadiusSq = 0;\r\n\r\n        for (let i = 0, n = points.length; i < n; i++)\r\n        {\r\n            maxRadiusSq = Math.max(maxRadiusSq, center.distanceSquared(points[i]));\r\n        }\r\n        this.radius = Math.sqrt(maxRadiusSq);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 从一组顶点初始化球\r\n     * @param positions 坐标数据列表\r\n     */\r\n    fromPositions(positions: number[])\r\n    {\r\n        const box = new Box3();\r\n        const v = new Vector3();\r\n        const center = this.center;\r\n\r\n        box.formPositions(positions).getCenter(center);\r\n        let maxRadiusSq = 0;\r\n\r\n        for (let i = 0, n = positions.length; i < n; i += 3)\r\n        {\r\n            maxRadiusSq = Math.max(maxRadiusSq, center.distanceSquared(v.set(positions[i], positions[i + 1], positions[i + 2])));\r\n        }\r\n        this.radius = Math.sqrt(maxRadiusSq);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 拷贝\r\n     */\r\n    copy(sphere: Sphere)\r\n    {\r\n        this.center.copy(sphere.center);\r\n        this.radius = sphere.radius;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 克隆\r\n     */\r\n    clone()\r\n    {\r\n        return new Sphere().copy(this);\r\n    }\r\n\r\n    /**\r\n     * 是否为空\r\n     */\r\n    isEmpty()\r\n    {\r\n        return this.radius <= 0;\r\n    }\r\n\r\n    /**\r\n     * 点到球的距离\r\n     * @param point 点\r\n     */\r\n    distanceToPoint(point: Vector3)\r\n    {\r\n        return point.distance(this.center) - this.radius;\r\n    }\r\n\r\n    /**\r\n     * 与指定球是否相交\r\n     */\r\n    intersectsSphere(sphere: Sphere)\r\n    {\r\n        const radiusSum = this.radius + sphere.radius;\r\n\r\n        return sphere.center.distanceSquared(this.center) <= radiusSum * radiusSum;\r\n    }\r\n\r\n    /**\r\n     * 是否与盒子相交\r\n     * @param box 盒子\r\n     */\r\n    intersectsBox(box: Box3)\r\n    {\r\n        return box.intersectsSphere(this);\r\n    }\r\n\r\n    /**\r\n     * 是否与平面相交\r\n     * @param plane 平面\r\n     */\r\n    intersectsPlane(plane: Plane)\r\n    {\r\n        return Math.abs(plane.distanceWithPoint(this.center)) <= this.radius;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param point 点\r\n     * @param pout 输出点\r\n     */\r\n    clampPoint(point: Vector3, pout = new Vector3())\r\n    {\r\n        const deltaLengthSq = this.center.distanceSquared(point);\r\n\r\n        pout.copy(point);\r\n        if (deltaLengthSq > (this.radius * this.radius))\r\n        {\r\n            pout.sub(this.center).normalize();\r\n            pout.scaleNumber(this.radius).add(this.center);\r\n        }\r\n\r\n        return pout;\r\n    }\r\n\r\n    /**\r\n     * 获取包围盒\r\n     */\r\n    getBoundingBox(box = new Box3())\r\n    {\r\n        box.init(this.center.subNumberTo(this.radius), this.center.addNumberTo(this.radius));\r\n\r\n        return box;\r\n    }\r\n\r\n    /**\r\n     * 应用矩阵\r\n     * @param matrix 矩阵\r\n     */\r\n    applyMatrix4(matrix: Matrix4x4)\r\n    {\r\n        this.center.applyMatrix4x4(matrix);\r\n        this.radius = this.radius * matrix.getMaxScaleOnAxis();\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 平移\r\n     * @param offset 偏移量\r\n     */\r\n    translate(offset: Vector3)\r\n    {\r\n        this.center.add(offset);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 是否相等\r\n     * @param sphere 球\r\n     */\r\n    equals(sphere: Sphere)\r\n    {\r\n        return sphere.center.equals(this.center) && (sphere.radius === this.radius);\r\n    }\r\n\r\n    toString(): string\r\n    {\r\n        return `Sphere [center:${this.center.toString()}, radius:${this.radius}]`;\r\n    }\r\n}\r\n","import { ArrayUtils } from '@feng3d/polyfill';\r\nimport { Box3 } from './Box3';\r\nimport { Line3 } from './Line3';\r\nimport { Segment3 } from './Segment3';\r\nimport { Triangle3 } from './Triangle3';\r\nimport { Vector3 } from './Vector3';\r\n\r\n/**\r\n * 由三角形构成的几何体\r\n * ### 限定：\r\n *  * 只包含三角形，不存在四边形等其他多边形\r\n *  *\r\n */\r\nexport class TriangleGeometry\r\n{\r\n    /**\r\n     * 从盒子初始化\r\n     * @param box 盒子\r\n     */\r\n    static fromBox(box: Box3)\r\n    {\r\n        return new TriangleGeometry().fromBox(box);\r\n    }\r\n\r\n    triangles: Triangle3[];\r\n\r\n    constructor(triangles: Triangle3[] = [])\r\n    {\r\n        this.triangles = triangles;\r\n    }\r\n\r\n    /**\r\n     * 从盒子初始化\r\n     * @param box 盒子\r\n     */\r\n    fromBox(box: Box3)\r\n    {\r\n        this.triangles.length = 0;\r\n        box.toTriangles(this.triangles);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 获取所有顶点，去除重复顶点\r\n     */\r\n    getPoints()\r\n    {\r\n        const ps = this.triangles.reduce((v: Vector3[], t) => v.concat(t.getPoints()), []);\r\n\r\n        ArrayUtils.unique(ps, (a, b) => a.equals(b));\r\n\r\n        return ps;\r\n    }\r\n\r\n    /**\r\n     * 是否闭合\r\n     * 方案：获取所有三角形的线段，当每条线段（a,b）都存在且仅有一条与之相对于的线段（b，a）时几何体闭合\r\n     */\r\n    isClosed()\r\n    {\r\n        // 获取所有线段\r\n        const ss = this.triangles.reduce((ss: Segment3[], t) => ss.concat(t.getSegments()), []);\r\n        // 当每条线段（a,b）都存在与之相对于的线段（b，a）时几何体闭合\r\n        const r = ss.every((s) => ss.filter((s0) => s.p0.equals(s0.p1) && s.p1.equals(s0.p0)).length === 1);\r\n\r\n        return r;\r\n    }\r\n\r\n    /**\r\n     * 包围盒\r\n     */\r\n    getBox(box = new Box3())\r\n    {\r\n        return box.fromPoints(this.getPoints());\r\n    }\r\n\r\n    /**\r\n     * 与指定点最近的点\r\n     * @param point 点\r\n     * @param vout 输出点\r\n     */\r\n    closestPointWithPoint(point: Vector3, vout = new Vector3())\r\n    {\r\n        // 计算指定点到所有平面的距离，并按距离排序\r\n        const r = this.triangles.map((t) =>\r\n        {\r\n            const p = t.closestPointWithPoint(point);\r\n\r\n            return { p, d: point.distanceSquared(p) };\r\n        }).sort((a, b) => a.d - b.d);\r\n\r\n        return vout.copy(r[0].p);\r\n    }\r\n\r\n    /**\r\n     * 给指定点分类\r\n     * @param p 点\r\n     * @returns 点相对于几何体位置；0:在几何体表面上，1：在几何体外，-1：在几何体内\r\n     * 方案：当指定点不在几何体上时，在几何体上找到距离指定点最近点，最近点到给定点形成的向量与最近点所在面（当最近点在多个面上时取点乘摸最大的面）法线点乘大于0时给定点在几何体内，否则在几何体外。\r\n     */\r\n    classifyPoint(p: Vector3)\r\n    {\r\n        if (!this.isClosed())\r\n        { return 1; }\r\n\r\n        // 是否在表面\r\n        const onface = this.triangles.reduce((v, t) =>\r\n            v || t.onWithPoint(p), false);\r\n\r\n        if (onface) return 0;\r\n\r\n        // 最近点\r\n        const cp = this.closestPointWithPoint(p);\r\n        // 到最近点的向量\r\n        const cpv = cp.subTo(p);\r\n        // 最近点所在平面\r\n        const cts = this.triangles.filter((t) => t.onWithPoint(cp));\r\n        // 最近点向量与所在平面方向相同则点在几何体内\r\n        const v = cts.map((t) => t.getNormal().dot(cpv)).sort((a, b) => Math.abs(b) - Math.abs(a))[0];\r\n\r\n        if (v > 0)\r\n        { return -1; }\r\n\r\n        return 1;\r\n    }\r\n\r\n    /**\r\n     * 是否包含指定点\r\n     * @param p 点\r\n     */\r\n    containsPoint(p: Vector3)\r\n    {\r\n        return this.classifyPoint(p) <= 0;\r\n    }\r\n\r\n    /**\r\n     * 给指定线段分类\r\n     * @param segment 线段\r\n     * @returns 线段相对于几何体位置；0:在几何体表面上，1：在几何体外，-1：在几何体内，2：横跨几何体\r\n     */\r\n    classifySegment(segment: Segment3)\r\n    {\r\n        // 线段与几何体不相交时\r\n        const r = this.intersectionWithSegment(segment);\r\n\r\n        if (!r)\r\n        {\r\n            if (this.classifyPoint(segment.p0) > 0)\r\n            { return 1; }\r\n\r\n            return -1;\r\n        }\r\n        // 相交多条线段时 横跨\r\n        if (r.segments.length > 1)\r\n        { return 2; }\r\n        if (r.segments.length === 1)\r\n        {\r\n            // 相交线段相对 几何体的位置\r\n            const pc = [r.segments[0].p0, r.segments[0].p1].map((p) => this.classifyPoint(p));\r\n\r\n            if (pc[0] * pc[1] < 0) return 2;\r\n            if (pc[0] + pc[1] === 0) return 0;\r\n            if (pc[0] + pc[1] < 0) return -1;\r\n\r\n            return 1;\r\n        }\r\n        // 相交于点\r\n        if (r.points.length)\r\n        {\r\n            throw `未实现`;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 给指定三角形分类\r\n     * @param triangle 三角形\r\n     * @returns 三角形相对于几何体位置；0:在几何体表面上，1：在几何体外，-1：在几何体内\r\n     */\r\n    classifyTriangle(_triangle: Triangle3)\r\n    {\r\n        throw `未实现`;\r\n    }\r\n\r\n    /**\r\n     * 与直线碰撞\r\n     * @param line3d 直线\r\n     */\r\n    intersectionWithLine(line3d: Line3)\r\n    {\r\n        // 线段与三角形碰撞\r\n        const ss: Segment3[] = [];\r\n        let ps: Vector3[] = [];\r\n\r\n        this.triangles.forEach((t) =>\r\n        {\r\n            const r = t.intersectionWithLine(line3d);\r\n\r\n            if (!r) return;\r\n            if (r instanceof Segment3)\r\n            {\r\n                ss.push(r);\r\n\r\n                return;\r\n            }\r\n            ps.push(r);\r\n        });\r\n\r\n        // 清除相同的线段\r\n        ArrayUtils.unique(ss, (a, b) => a.equals(b));\r\n        // 删除在相交线段上的交点\r\n        ps = ps.filter((p) => ss.every((s) => !s.onWithPoint(p)));\r\n        // 清除相同点\r\n        ArrayUtils.unique(ps, (a, b) => a.equals(b));\r\n        if (ss.length + ps.length === 0)\r\n        { return null; }\r\n\r\n        return { segments: ss, points: ps };\r\n    }\r\n\r\n    /**\r\n     * 与线段相交\r\n     * @param segment 线段\r\n     * @returns 不相交时返回null，相交时返回 碰撞线段列表与碰撞点列表\r\n     */\r\n    intersectionWithSegment(segment: Segment3)\r\n    {\r\n        const line = segment.getLine();\r\n        const r = this.intersectionWithLine(line);\r\n\r\n        if (!r) return null;\r\n        const ps = r.points = r.points.filter((p) => segment.onWithPoint(p));\r\n\r\n        r.segments = r.segments.reduce((v: Segment3[], s) =>\r\n        {\r\n            const p0 = segment.clampPoint(s.p0);\r\n            const p1 = segment.clampPoint(s.p1);\r\n\r\n            if (!s.onWithPoint(p0))\r\n            { return v; }\r\n            if (p0.equals(p1))\r\n            {\r\n                ps.push(p0);\r\n\r\n                return v;\r\n            }\r\n            v.push(Segment3.fromPoints(p0, p1));\r\n\r\n            return v;\r\n        }, []);\r\n\r\n        if (r.segments.length + r.points.length === 0)\r\n        { return null; }\r\n\r\n        return r;\r\n    }\r\n\r\n    /**\r\n     * 分解三角形\r\n     * @param triangle 三角形\r\n     */\r\n    decomposeTriangle(_triangle: Triangle3)\r\n    {\r\n        throw `未实现`;\r\n    }\r\n\r\n    /**\r\n     * 拷贝\r\n     */\r\n    copy(triangleGeometry: TriangleGeometry)\r\n    {\r\n        this.triangles = triangleGeometry.triangles.map((t) => t.clone());\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 克隆\r\n     */\r\n    clone()\r\n    {\r\n        return new TriangleGeometry().copy(this);\r\n    }\r\n}\r\n","import { mathUtil } from '@feng3d/polyfill';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { Color3 } from '../Color3';\r\nimport { Color4 } from '../Color4';\r\nimport { GradientAlphaKey } from './GradientAlphaKey';\r\nimport { GradientColorKey } from './GradientColorKey';\r\nimport { GradientMode } from './GradientMode';\r\n\r\n/**\r\n * 颜色渐变\r\n */\r\nexport class Gradient\r\n{\r\n    __class__: 'feng3d.Gradient';\r\n\r\n    /**\r\n     * 渐变模式\r\n     */\r\n    @serialize\r\n    mode = GradientMode.Blend;\r\n\r\n    /**\r\n     * 在渐变中定义的所有alpha键。\r\n     *\r\n     * 注： 该值已对时间排序，否则赋值前请使用 sort((a, b) => a.time - b.time) 进行排序\r\n     */\r\n    @serialize\r\n    alphaKeys: GradientAlphaKey[] = [{ alpha: 1, time: 0 }, { alpha: 1, time: 1 }];\r\n\r\n    /**\r\n     * 在渐变中定义的所有color键。\r\n     *\r\n     * 注： 该值已对时间排序，否则赋值前请使用 sort((a, b) => a.time - b.time) 进行排序\r\n     */\r\n    @serialize\r\n    colorKeys: GradientColorKey[] = [{ color: new Color3(1, 1, 1), time: 0 }, { color: new Color3(1, 1, 1), time: 1 }];\r\n\r\n    /**\r\n     * 从颜色列表初始化\r\n     * @param colors 颜色列表\r\n     * @param times\r\n     */\r\n    fromColors(colors: number[], times?: number[])\r\n    {\r\n        if (!times)\r\n        {\r\n            times = [];\r\n            for (let i = 0; i < colors.length; i++)\r\n            {\r\n                times[i] = i / (colors.length - 1);\r\n            }\r\n        }\r\n\r\n        const colors1 = colors.map((v) => new Color3().fromUnit(v));\r\n\r\n        for (let i = 0; i < colors1.length; i++)\r\n        {\r\n            this.colorKeys[i] = { color: colors1[i], time: times[i] };\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 获取值\r\n     * @param time 时间\r\n     */\r\n    getValue(time: number)\r\n    {\r\n        const alpha = this.getAlpha(time);\r\n        const color = this.getColor(time);\r\n\r\n        return new Color4(color.r, color.g, color.b, alpha);\r\n    }\r\n\r\n    /**\r\n     * 获取透明度\r\n     * @param time 时间\r\n     */\r\n    getAlpha(time: number)\r\n    {\r\n        const alphaKeys = this.alphaKeys;\r\n\r\n        if (alphaKeys.length === 1) return alphaKeys[0].alpha;\r\n        if (time <= alphaKeys[0].time) return alphaKeys[0].alpha;\r\n        if (time >= alphaKeys[alphaKeys.length - 1].time) return alphaKeys[alphaKeys.length - 1].alpha;\r\n\r\n        for (let i = 0, n = alphaKeys.length - 1; i < n; i++)\r\n        {\r\n            const t = alphaKeys[i].time;\r\n            const v = alphaKeys[i].alpha;\r\n            const nt = alphaKeys[i + 1].time;\r\n            const nv = alphaKeys[i + 1].alpha;\r\n\r\n            if (time === t) return v;\r\n            if (time === nt) return nv;\r\n            if (t < time && time < nt)\r\n            {\r\n                if (this.mode === GradientMode.Fixed) return nv;\r\n\r\n                return mathUtil.mapLinear(time, t, nt, v, nv);\r\n            }\r\n        }\r\n\r\n        return 1;\r\n    }\r\n\r\n    /**\r\n     * 获取透明度\r\n     * @param time 时间\r\n     */\r\n    getColor(time: number)\r\n    {\r\n        const colorKeys = this.colorKeys;\r\n\r\n        if (colorKeys.length === 1) return colorKeys[0].color;\r\n        if (time <= colorKeys[0].time) return colorKeys[0].color;\r\n        if (time >= colorKeys[colorKeys.length - 1].time) return colorKeys[colorKeys.length - 1].color;\r\n\r\n        for (let i = 0, n = colorKeys.length - 1; i < n; i++)\r\n        {\r\n            const t = colorKeys[i].time;\r\n            const v = colorKeys[i].color;\r\n            const nt = colorKeys[i + 1].time;\r\n            const nv = colorKeys[i + 1].color;\r\n\r\n            if (time === t) return v;\r\n            if (time === nt) return nv;\r\n            if (t < time && time < nt)\r\n            {\r\n                if (this.mode === GradientMode.Fixed) return nv;\r\n\r\n                return v.mixTo(nv, (time - t) / (nt - t));\r\n            }\r\n        }\r\n\r\n        return new Color3();\r\n    }\r\n}\r\n","/**\r\n * 最大最小颜色渐变模式\r\n */\r\nexport enum MinMaxGradientMode\r\n{\r\n    /**\r\n     * Use a single color for the MinMaxGradient.\r\n     *\r\n     * 使用单一颜色的。\r\n     */\r\n    Color = 0,\r\n\r\n    /**\r\n     * Use a single color gradient for the MinMaxGradient.\r\n     *\r\n     * 使用单一颜色渐变。\r\n     */\r\n    Gradient = 1,\r\n\r\n    /**\r\n     * Use a random value between 2 colors for the MinMaxGradient.\r\n     *\r\n     * 在两种颜色之间使用一个随机值。\r\n     */\r\n    TwoColors = 2,\r\n\r\n    /**\r\n     * Use a random value between 2 color gradients for the MinMaxGradient.\r\n     *\r\n     * 在两个颜色梯度之间使用一个随机值。\r\n     */\r\n    TwoGradients = 3,\r\n\r\n    /**\r\n     * Define a list of colors in the MinMaxGradient, to be chosen from at random.\r\n     *\r\n     * 在一个颜色列表中随机选择。\r\n     */\r\n    RandomColor = 4\r\n}\r\n","import { serialize } from '@feng3d/serialization';\r\nimport { Color4 } from '../Color4';\r\nimport { Gradient } from './Gradient';\r\nimport { MinMaxGradientMode } from './MinMaxGradientMode';\r\n\r\n/**\r\n * 最大最小颜色渐变\r\n */\r\nexport class MinMaxGradient\r\n{\r\n    __class__: 'feng3d.MinMaxGradient';\r\n\r\n    /**\r\n     * Set the mode that the min-max gradient will use to evaluate colors.\r\n     *\r\n     * 设置最小-最大梯度将用于评估颜色的模式。\r\n     */\r\n    @serialize\r\n    mode = MinMaxGradientMode.Color;\r\n\r\n    /**\r\n     * Set a constant color.\r\n     *\r\n     * 常量颜色值\r\n     */\r\n    @serialize\r\n    color = new Color4();\r\n\r\n    /**\r\n     * Set a constant color for the lower bound.\r\n     *\r\n     * 为下界设置一个常量颜色。\r\n     */\r\n    @serialize\r\n    colorMin = new Color4();\r\n\r\n    /**\r\n     * Set a constant color for the upper bound.\r\n     *\r\n     * 为上界设置一个常量颜色。\r\n     */\r\n    @serialize\r\n    colorMax = new Color4();\r\n\r\n    /**\r\n     * Set the gradient.\r\n     *\r\n     * 设置渐变。\r\n     */\r\n    @serialize\r\n    gradient = new Gradient();\r\n\r\n    /**\r\n     * Set a gradient for the lower bound.\r\n     *\r\n     * 为下界设置一个渐变。\r\n     */\r\n    @serialize\r\n    gradientMin = new Gradient();\r\n\r\n    /**\r\n     * Set a gradient for the upper bound.\r\n     *\r\n     * 为上界设置一个渐变。\r\n     */\r\n    @serialize\r\n    gradientMax = new Gradient();\r\n\r\n    /**\r\n     * 获取值\r\n     * @param time 时间\r\n     */\r\n    getValue(time: number, randomBetween: number = Math.random())\r\n    {\r\n        let min: Color4;\r\n        let max: Color4;\r\n        let v: Color4;\r\n\r\n        switch (this.mode)\r\n        {\r\n            case MinMaxGradientMode.Color:\r\n                return this.color;\r\n            case MinMaxGradientMode.Gradient:\r\n                return this.gradient.getValue(time);\r\n            case MinMaxGradientMode.TwoColors:\r\n                return this.colorMin.mixTo(this.colorMax, randomBetween);\r\n            case MinMaxGradientMode.TwoGradients:\r\n                min = this.gradientMin.getValue(time);\r\n                max = this.gradientMax.getValue(time);\r\n                v = min.mixTo(max, randomBetween);\r\n\r\n                return v;\r\n            case MinMaxGradientMode.RandomColor:\r\n                v = this.gradient.getValue(randomBetween);\r\n\r\n                return v;\r\n        }\r\n\r\n        return this.color;\r\n    }\r\n}\r\n","/**\r\n * 柏林噪音\r\n *\r\n * 用于生产随机的噪音贴图\r\n *\r\n * @see http://staffwww.itn.liu.se/~stegu/simplexnoise/simplexnoise.pdf\r\n * @see https://mrl.nyu.edu/~perlin/noise/\r\n * @see https://gitee.com/feng3d_admin/noise\r\n */\r\nexport class Noise\r\n{\r\n    /**\r\n     * 构建柏林噪音\r\n     *\r\n     * @param seed 随机种子\r\n     */\r\n    constructor(seed = 0)\r\n    {\r\n        this.seed = seed;\r\n    }\r\n\r\n    /**\r\n     * 1D 经典噪音\r\n     *\r\n     * @param x X轴数值\r\n     */\r\n    perlin1(x: number)\r\n    {\r\n        const perm = this._p;\r\n\r\n        // Find unit grid cell containing point\r\n        let X = Math.floor(x);\r\n\r\n        // Get relative xyz coordinates of point within that cell\r\n        x = x - X;\r\n\r\n        // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n        X = X & 255;\r\n        // Calculate a set of eight hashed gradient indices\r\n        const gi00 = perm[X] % 2;\r\n        const gi10 = perm[X + 1] % 2;\r\n\r\n        // Calculate noise contributions from each of the eight corners\r\n        const n00 = dot1(grad1[gi00], x);\r\n        const n10 = dot1(grad1[gi10], x - 1);\r\n        // Compute the fade curve value for each of x, y\r\n        const u = fade(x);\r\n        // Interpolate along x the contributions from each of the corners\r\n        const nx0 = mix(n00, n10, u);\r\n\r\n        return nx0;\r\n    }\r\n\r\n    /**\r\n     * 2D 经典噪音\r\n     *\r\n     * @param x X轴数值\r\n     * @param y Y轴数值\r\n     */\r\n    perlin2(x: number, y: number)\r\n    {\r\n        const perm = this._p;\r\n\r\n        // Find unit grid cell containing point\r\n        let X = Math.floor(x);\r\n        let Y = Math.floor(y);\r\n\r\n        // Get relative xyz coordinates of point within that cell\r\n        x = x - X;\r\n        y = y - Y;\r\n\r\n        // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n        X = X & 255;\r\n        Y = Y & 255;\r\n        // Calculate a set of eight hashed gradient indices\r\n        const gi00 = perm[X + perm[Y]] % 4;\r\n        const gi10 = perm[X + 1 + perm[Y]] % 4;\r\n        const gi01 = perm[X + perm[Y + 1]] % 4;\r\n        const gi11 = perm[X + 1 + perm[Y + 1]] % 4;\r\n\r\n        // Calculate noise contributions from each of the eight corners\r\n        const n00 = dot2(grad2[gi00], x, y);\r\n        const n10 = dot2(grad2[gi10], x - 1, y);\r\n        const n01 = dot2(grad2[gi01], x, y - 1);\r\n        const n11 = dot2(grad2[gi11], x - 1, y - 1);\r\n        // Compute the fade curve value for each of x, y\r\n        const u = fade(x);\r\n        const v = fade(y);\r\n        // Interpolate along x the contributions from each of the corners\r\n        const nx0 = mix(n00, n10, u);\r\n        const nx1 = mix(n01, n11, u);\r\n        // Interpolate the four results along y\r\n        const nxy = mix(nx0, nx1, v);\r\n\r\n        return nxy;\r\n    }\r\n\r\n    /**\r\n     * 3D 经典噪音\r\n     *\r\n     * @param x X轴数值\r\n     * @param y Y轴数值\r\n     * @param z Z轴数值\r\n     */\r\n    perlin3(x: number, y: number, z: number)\r\n    {\r\n        const perm = this._p;\r\n\r\n        // Find unit grid cell containing point\r\n        let X = Math.floor(x);\r\n        let Y = Math.floor(y);\r\n        let Z = Math.floor(z);\r\n\r\n        // Get relative xyz coordinates of point within that cell\r\n        x = x - X;\r\n        y = y - Y;\r\n        z = z - Z;\r\n\r\n        // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n        X = X & 255;\r\n        Y = Y & 255;\r\n        Z = Z & 255;\r\n        // Calculate a set of eight hashed gradient indices\r\n        const gi000 = perm[X + perm[Y + perm[Z]]] % 12;\r\n        const gi100 = perm[X + 1 + perm[Y + perm[Z]]] % 12;\r\n        const gi010 = perm[X + perm[Y + 1 + perm[Z]]] % 12;\r\n        const gi110 = perm[X + 1 + perm[Y + 1 + perm[Z]]] % 12;\r\n        const gi001 = perm[X + perm[Y + perm[Z + 1]]] % 12;\r\n        const gi101 = perm[X + 1 + perm[Y + perm[Z + 1]]] % 12;\r\n        const gi011 = perm[X + perm[Y + 1 + perm[Z + 1]]] % 12;\r\n        const gi111 = perm[X + 1 + perm[Y + 1 + perm[Z + 1]]] % 12;\r\n\r\n        // Calculate noise contributions from each of the eight corners\r\n        const n000 = dot(grad3[gi000], x, y, z);\r\n        const n100 = dot(grad3[gi100], x - 1, y, z);\r\n        const n010 = dot(grad3[gi010], x, y - 1, z);\r\n        const n110 = dot(grad3[gi110], x - 1, y - 1, z);\r\n        const n001 = dot(grad3[gi001], x, y, z - 1);\r\n        const n101 = dot(grad3[gi101], x - 1, y, z - 1);\r\n        const n011 = dot(grad3[gi011], x, y - 1, z - 1);\r\n        const n111 = dot(grad3[gi111], x - 1, y - 1, z - 1);\r\n        // Compute the fade curve value for each of x, y, z\r\n        const u = fade(x);\r\n        const v = fade(y);\r\n        const w = fade(z);\r\n        // Interpolate along x the contributions from each of the corners\r\n        const nx00 = mix(n000, n100, u);\r\n        const nx01 = mix(n001, n101, u);\r\n        const nx10 = mix(n010, n110, u);\r\n        const nx11 = mix(n011, n111, u);\r\n        // Interpolate the four results along y\r\n        const nxy0 = mix(nx00, nx10, v);\r\n        const nxy1 = mix(nx01, nx11, v);\r\n        // Interpolate the two last results along z\r\n        const nxyz = mix(nxy0, nxy1, w);\r\n\r\n        return nxyz;\r\n    }\r\n\r\n    /**\r\n     * N阶经典噪音\r\n     *\r\n     * 如果是1D，2D，3D噪音，最好选用对于函数，perlinN中存在for循环因此效率比perlin3等性能差3到5（8）倍！\r\n     *\r\n     * 满足以下运算\r\n     * perlinN(x) === perlin1(x)\r\n     * perlinN(x,y) === perlin2(x,y)\r\n     * perlinN(x,y,z) === perlin3(x,y,z)\r\n     *\r\n     * @param ps 每个轴的数值\r\n     */\r\n    perlinN(...ps: number[])\r\n    {\r\n        const perm = this._p;\r\n\r\n        const n = ps.length;\r\n\r\n        // 在格子内对应每个轴的位置\r\n        const pp: number[] = [];\r\n        // 所属格子对应每个轴的索引\r\n        const PS: number[] = [];\r\n        // 在格子内对应每个轴的混合权重\r\n        const PF: number[] = [];\r\n\r\n        for (let i = 0; i < n; i++)\r\n        {\r\n            let p = ps[i];\r\n            // 找到所属单元格\r\n            let P = Math.floor(p);\r\n\r\n            // 获取所在单元格内的位置\r\n            p = p - P;\r\n\r\n            // 单元格以255为周期\r\n            P = P & 255;\r\n\r\n            //\r\n            pp[i] = p;\r\n            PS[i] = P;\r\n\r\n            // 分别计算每个轴的混合度\r\n            PF[i] = fade(p);\r\n        }\r\n\r\n        //\r\n        const gradN = createGrad(n);\r\n        // 边的数量\r\n        const numEdge = gradN.length;\r\n        // if (n > 1)\r\n        // {\r\n        //     console.assert(numEdge === Math.pow(2, n - 1) * n, `边的数量不对！`)\r\n        // }\r\n        //\r\n        const bits = getBits(n);\r\n        const dns: number[] = [];\r\n        //\r\n\r\n        for (let i = 0, len = bits.length; i < len; i++)\r\n        {\r\n            const bit = bits[i];\r\n            let bitn = bit.length;\r\n            // 计算索引\r\n            let gi = 0;\r\n\r\n            while (bitn > 0)\r\n            {\r\n                bitn--;\r\n                gi = perm[PS[bitn] + bit[bitn] + gi];\r\n                // if (isNaN(gi))\r\n                //     debugger;\r\n            }\r\n            // 获取 grad\r\n            const grad = gradN[gi % numEdge];\r\n\r\n            bitn = bit.length;\r\n            // 计算点乘 dot运算\r\n            let dn = 0;\r\n\r\n            while (bitn > 0)\r\n            {\r\n                bitn--;\r\n                dn += grad[bitn] * (pp[bitn] - bit[bitn]);\r\n            }\r\n            dns[i] = dn;\r\n        }\r\n        // 进行插值\r\n        for (let i = 0; i < n; i++)\r\n        {\r\n            // 每次前后两个插值\r\n            for (let j = 0, len = dns.length; j < len; j += 2)\r\n            {\r\n                dns[j / 2] = mix(dns[j], dns[j + 1], PF[i]);\r\n            }\r\n            // 每波插值后 长度减半\r\n            dns.length = dns.length >> 1;\r\n        }\r\n        // console.assert(dns.length === 1, `结果长度不对！`)\r\n\r\n        return dns[0];\r\n    }\r\n\r\n    /**\r\n     * This isn't a very good seeding function, but it works ok. It supports 2^16\r\n     * different seed values. Write something better if you need more seeds.\r\n     */\r\n    get seed()\r\n    {\r\n        return this._seed;\r\n    }\r\n    set seed(v)\r\n    {\r\n        this._seed = v;\r\n\r\n        const p = this._p;\r\n\r\n        if (v > 0 && v < 1)\r\n        {\r\n            // Scale the seed out\r\n            v *= 65536;\r\n        }\r\n\r\n        v = Math.floor(v);\r\n        if (v < 256)\r\n        {\r\n            v |= v << 8;\r\n        }\r\n\r\n        for (let i = 0; i < 256; i++)\r\n        {\r\n            let v0: number;\r\n\r\n            if (i & 1)\r\n            {\r\n                v0 = permutation[i] ^ (v & 255);\r\n            }\r\n            else\r\n            {\r\n                v0 = permutation[i] ^ ((v >> 8) & 255);\r\n            }\r\n\r\n            p[i] = p[i + 256] = v0;\r\n        }\r\n    }\r\n    private _seed = 0;\r\n    private _p: number[] = [];\r\n}\r\n\r\n/**\r\n *\r\n * @param n\r\n *\r\n * len = 2^(n-1) * n\r\n */\r\nexport function createGrad(n: number): number[][]\r\n{\r\n    if (createGradCache[n]) return createGradCache[n];\r\n\r\n    const gradBase = createGradBase(n - 1);\r\n    let grad: number[][] = [];\r\n\r\n    if (n > 1)\r\n    {\r\n        for (let i = n - 1; i >= 0; i--)\r\n        {\r\n            for (let j = 0; j < gradBase.length; j++)\r\n            {\r\n                const item = gradBase[j].concat();\r\n\r\n                item.splice(i, 0, 0);\r\n                grad.push(item);\r\n            }\r\n        }\r\n    }\r\n    else\r\n    {\r\n        grad = gradBase;\r\n    }\r\n    createGradCache[n] = grad;\r\n\r\n    return grad;\r\n}\r\n\r\nconst createGradCache: { [n: number]: number[][] } = {};\r\n\r\nfunction createGradBase(n: number): number[][]\r\n{\r\n    if (n < 2)\r\n    {\r\n        return [\r\n            [1], [-1],\r\n        ];\r\n    }\r\n    const grad = createGradBase(n - 1);\r\n\r\n    for (let i = 0, len = grad.length; i < len; i++)\r\n    {\r\n        const item = grad[i];\r\n\r\n        grad[i] = item.concat(1);\r\n        grad[i + len] = item.concat(-1);\r\n    }\r\n\r\n    return grad;\r\n}\r\n\r\nexport function getBits(n: number): number[][]\r\n{\r\n    if (getBitsChace[n]) return getBitsChace[n];\r\n\r\n    if (n < 2)\r\n    {\r\n        return [\r\n            [0], [1],\r\n        ];\r\n    }\r\n    const grad = getBits(n - 1);\r\n\r\n    for (let i = 0, len = grad.length; i < len; i++)\r\n    {\r\n        const item = grad[i];\r\n\r\n        grad[i] = item.concat(0);\r\n        grad[i + len] = item.concat(1);\r\n    }\r\n    getBitsChace[n] = grad;\r\n\r\n    return grad;\r\n}\r\nconst getBitsChace: { [n: number]: number[][] } = {};\r\n\r\nconst grad1 = [\r\n    [1], [-1],\r\n];\r\nconst grad2 = [\r\n    [1, 0], [-1, 0],\r\n    [0, 1], [0, -1],\r\n];\r\nconst grad3 = [\r\n    [1, 1, 0], [-1, 1, 0], [1, -1, 0], [-1, -1, 0],\r\n    [1, 0, 1], [-1, 0, 1], [1, 0, -1], [-1, 0, -1],\r\n    [0, 1, 1], [0, -1, 1], [0, 1, -1], [0, -1, -1]\r\n];\r\nconst permutation = [\r\n    151, 160, 137, 91, 90, 15,\r\n    131, 13, 201, 95, 96, 53, 194, 233, 7, 225, 140, 36, 103, 30, 69, 142, 8, 99, 37, 240, 21, 10, 23,\r\n    190, 6, 148, 247, 120, 234, 75, 0, 26, 197, 62, 94, 252, 219, 203, 117, 35, 11, 32, 57, 177, 33,\r\n    88, 237, 149, 56, 87, 174, 20, 125, 136, 171, 168, 68, 175, 74, 165, 71, 134, 139, 48, 27, 166,\r\n    77, 146, 158, 231, 83, 111, 229, 122, 60, 211, 133, 230, 220, 105, 92, 41, 55, 46, 245, 40, 244,\r\n    102, 143, 54, 65, 25, 63, 161, 1, 216, 80, 73, 209, 76, 132, 187, 208, 89, 18, 169, 200, 196,\r\n    135, 130, 116, 188, 159, 86, 164, 100, 109, 198, 173, 186, 3, 64, 52, 217, 226, 250, 124, 123,\r\n    5, 202, 38, 147, 118, 126, 255, 82, 85, 212, 207, 206, 59, 227, 47, 16, 58, 17, 182, 189, 28, 42,\r\n    223, 183, 170, 213, 119, 248, 152, 2, 44, 154, 163, 70, 221, 153, 101, 155, 167, 43, 172, 9,\r\n    129, 22, 39, 253, 19, 98, 108, 110, 79, 113, 224, 232, 178, 185, 112, 104, 218, 246, 97, 228,\r\n    251, 34, 242, 193, 238, 210, 144, 12, 191, 179, 162, 241, 81, 51, 145, 235, 249, 14, 239, 107,\r\n    49, 192, 214, 31, 181, 199, 106, 157, 184, 84, 204, 176, 115, 121, 50, 45, 127, 4, 150, 254,\r\n    138, 236, 205, 93, 222, 114, 67, 29, 24, 72, 243, 141, 128, 195, 78, 66, 215, 61, 156, 180\r\n];\r\n\r\nfunction dot(g: number[], x: number, y: number, z: number)\r\n{\r\n    return g[0] * x + g[1] * y + g[2] * z;\r\n}\r\nfunction dot2(g: number[], x: number, y: number)\r\n{\r\n    return g[0] * x + g[1] * y;\r\n}\r\nfunction dot1(g: number[], x: number)\r\n{\r\n    return g[0] * x;\r\n}\r\nfunction mix(a: number, b: number, t: number)\r\n{\r\n    return (1 - t) * a + t * b;\r\n}\r\nfunction fade(t: number)\r\n{\r\n    return t * t * t * (t * (t * 6 - 15) + 10);\r\n}\r\n\r\n/**\r\n * 噪音\r\n */\r\nexport const noise = new Noise();\r\n","import { mathUtil } from '@feng3d/polyfill';\r\nimport { Matrix4x4 } from '../../geom/Matrix4x4';\r\nimport { Vector } from '../../geom/Vector';\r\nimport { Vector3 } from '../../geom/Vector3';\r\n\r\n/**\r\n * An extensible curve object which contains methods for interpolation\r\n */\r\nexport class Curve<T extends Vector>\r\n{\r\n    /**\r\n     * This value determines the amount of divisions when calculating the cumulative segment lengths of a curve via .getLengths.\r\n     * To ensure precision when using methods like .getSpacedPoints, it is recommended to increase .arcLengthDivisions if the curve is very large.\r\n     */\r\n    arcLengthDivisions = 200;\r\n\r\n    needsUpdate = false;\r\n\r\n    cacheArcLengths: number[];\r\n\r\n    getResolution(divisions: number): number\r\n    {\r\n        return divisions;\r\n    }\r\n\r\n    /**\r\n     * Virtual base class method to overwrite and implement in subclasses\r\n     *\r\n     * - t [0 .. 1]\r\n     * Returns a vector for point t of the curve where t is between 0 and 1\r\n     */\r\n    getPoint(_t?: number, _optionalTarget?: T): T\r\n    {\r\n        console.warn('Curve: .getPoint() not implemented.');\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Get point at relative position in curve according to arc length\r\n     * Returns a vector for point at relative position in curve according to arc length\r\n     *\r\n     * @param u [0 .. 1]\r\n     * @param optionalTarget\r\n     */\r\n    getPointAt(u: number, optionalTarget?: T)\r\n    {\r\n        const t = this.getUtoTmapping(u);\r\n\r\n        return this.getPoint(t, optionalTarget);\r\n    }\r\n\r\n    /**\r\n     * Get sequence of points using getPoint( t )\r\n     */\r\n    getPoints(divisions = 5)\r\n    {\r\n        const points: T[] = [];\r\n\r\n        for (let d = 0; d <= divisions; d++)\r\n        {\r\n            points.push(this.getPoint(d / divisions));\r\n        }\r\n\r\n        return points;\r\n    }\r\n\r\n    /**\r\n     * Get sequence of equi-spaced points using getPointAt( u )\r\n     */\r\n    getSpacedPoints(divisions: number)\r\n    {\r\n        if (divisions === undefined) divisions = 5;\r\n        const points = [];\r\n\r\n        for (let d = 0; d <= divisions; d++)\r\n        {\r\n            points.push(this.getPointAt(d / divisions));\r\n        }\r\n\r\n        return points;\r\n    }\r\n\r\n    /**\r\n     * Get total curve arc length\r\n     */\r\n    getLength()\r\n    {\r\n        const lengths = this.getLengths();\r\n\r\n        return lengths[lengths.length - 1];\r\n    }\r\n\r\n    /**\r\n     * Get list of cumulative segment lengths\r\n     */\r\n    getLengths(divisions?: number)\r\n    {\r\n        if (divisions === undefined) divisions = this.arcLengthDivisions;\r\n\r\n        if (this.cacheArcLengths && (this.cacheArcLengths.length === divisions + 1) && !this.needsUpdate)\r\n        {\r\n            return this.cacheArcLengths;\r\n        }\r\n\r\n        this.needsUpdate = false;\r\n\r\n        const cache: number[] = [];\r\n        let current: T; let\r\n            last = this.getPoint(0);\r\n        let sum = 0;\r\n\r\n        cache.push(0);\r\n\r\n        for (let p = 1; p <= divisions; p++)\r\n        {\r\n            current = this.getPoint(p / divisions);\r\n            sum += current.distance(last);\r\n            cache.push(sum);\r\n            last = current;\r\n        }\r\n\r\n        this.cacheArcLengths = cache;\r\n\r\n        return cache;\r\n    }\r\n\r\n    /**\r\n     * Update the cumlative segment distance cache\r\n     */\r\n    updateArcLengths()\r\n    {\r\n        this.needsUpdate = true;\r\n        this.getLengths();\r\n    }\r\n\r\n    /**\r\n     * Given u ( 0 .. 1 ), get a t to find p. This gives you points which are equi distance\r\n     */\r\n    getUtoTmapping(u: number, distance?: number)\r\n    {\r\n        const arcLengths = this.getLengths();\r\n\r\n        let i = 0;\r\n        const il = arcLengths.length;\r\n\r\n        let targetArcLength: number; // The targeted u distance value to get\r\n\r\n        if (distance)\r\n        {\r\n            targetArcLength = distance;\r\n        }\r\n        else\r\n        {\r\n            targetArcLength = u * arcLengths[il - 1];\r\n        }\r\n\r\n        // binary search for the index with largest value smaller than target u distance\r\n        let low = 0;\r\n        let high = il - 1;\r\n        let comparison: number;\r\n\r\n        while (low <= high)\r\n        {\r\n            i = Math.floor(low + ((high - low) / 2)); // less likely to overflow, though probably not issue here, JS doesn't really have integers, all numbers are floats\r\n            comparison = arcLengths[i] - targetArcLength;\r\n            if (comparison < 0)\r\n            {\r\n                low = i + 1;\r\n            }\r\n            else if (comparison > 0)\r\n            {\r\n                high = i - 1;\r\n            }\r\n            else\r\n            {\r\n                high = i;\r\n                break;\r\n            }\r\n        }\r\n\r\n        i = high;\r\n\r\n        if (arcLengths[i] === targetArcLength)\r\n        {\r\n            return i / (il - 1);\r\n        }\r\n\r\n        // we could get finer grain at lengths, or use simple interpolation between two points\r\n        const lengthBefore = arcLengths[i];\r\n        const lengthAfter = arcLengths[i + 1];\r\n\r\n        const segmentLength = lengthAfter - lengthBefore;\r\n\r\n        // determine where we are between the 'before' and 'after' points\r\n        const segmentFraction = (targetArcLength - lengthBefore) / segmentLength;\r\n\r\n        // add that fractional amount to t\r\n        const t = (i + segmentFraction) / (il - 1);\r\n\r\n        return t;\r\n    }\r\n\r\n    /**\r\n     * Returns a unit vector tangent at t. If the subclassed curve do not implement its tangent derivation, 2 points a small delta apart will be used to find its gradient which seems to give a reasonable approximation\r\n     * getTangent(t: number, optionalTarget?: T): T;\r\n     */\r\n    getTangent(t: number, optionalTarget: T): T\r\n    {\r\n        const delta = 0.0001;\r\n        let t1 = t - delta;\r\n        let t2 = t + delta;\r\n\r\n        // Capping in case of danger\r\n\r\n        if (t1 < 0) t1 = 0;\r\n        if (t2 > 1) t2 = 1;\r\n\r\n        const pt1 = this.getPoint(t1);\r\n        const pt2 = this.getPoint(t2);\r\n\r\n        const tangent = optionalTarget;\r\n\r\n        tangent.copy(pt2).sub(pt1).normalize();\r\n\r\n        return tangent;\r\n    }\r\n\r\n    /**\r\n     * Returns tangent at equidistance point u on the curve\r\n     * getTangentAt(u: number, optionalTarget?: T): T;\r\n     */\r\n    getTangentAt(u: number, optionalTarget: T)\r\n    {\r\n        const t = this.getUtoTmapping(u);\r\n\r\n        return this.getTangent(t, optionalTarget);\r\n    }\r\n\r\n    computeFrenetFrames(segments: number, closed: boolean)\r\n    {\r\n        // see http://www.cs.indiana.edu/pub/techreports/TR425.pdf\r\n\r\n        const normal = new Vector3();\r\n\r\n        const tangents: Vector3[] = [];\r\n        const normals: Vector3[] = [];\r\n        const binormals: Vector3[] = [];\r\n\r\n        const vec = new Vector3();\r\n        const mat = new Matrix4x4();\r\n\r\n        // compute the tangent vectors for each segment on the curve\r\n\r\n        const curve3: Curve<Vector3> = this as any;\r\n\r\n        for (let i = 0; i <= segments; i++)\r\n        {\r\n            const u = i / segments;\r\n\r\n            tangents[i] = curve3.getTangentAt(u, new Vector3());\r\n            tangents[i].normalize();\r\n        }\r\n\r\n        // select an initial normal vector perpendicular to the first tangent vector,\r\n        // and in the direction of the minimum tangent xyz component\r\n        normals[0] = new Vector3();\r\n        binormals[0] = new Vector3();\r\n        let min = Number.MAX_VALUE;\r\n        const tx = Math.abs(tangents[0].x);\r\n        const ty = Math.abs(tangents[0].y);\r\n        const tz = Math.abs(tangents[0].z);\r\n\r\n        if (tx <= min)\r\n        {\r\n            min = tx;\r\n            normal.set(1, 0, 0);\r\n        }\r\n\r\n        if (ty <= min)\r\n        {\r\n            min = ty;\r\n            normal.set(0, 1, 0);\r\n        }\r\n\r\n        if (tz <= min)\r\n        {\r\n            normal.set(0, 0, 1);\r\n        }\r\n\r\n        tangents[0].crossTo(normal, vec).normalize();\r\n        tangents[0].crossTo(vec, normals[0]);\r\n        tangents[0].crossTo(normals[0], binormals[0]);\r\n\r\n        // compute the slowly-varying normal and binormal vectors for each segment on the curve\r\n        for (let i = 1; i <= segments; i++)\r\n        {\r\n            normals[i] = normals[i - 1].clone();\r\n            binormals[i] = binormals[i - 1].clone();\r\n            tangents[i - 1].crossTo(tangents[i], vec);\r\n\r\n            if (vec.length > Number.EPSILON)\r\n            {\r\n                vec.normalize();\r\n\r\n                const theta = Math.acos(mathUtil.clamp(tangents[i - 1].dot(tangents[i]), -1, 1)); // clamp for floating pt errors\r\n\r\n                mat.fromAxisRotate(vec, theta * mathUtil.RAD2DEG);\r\n                mat.transformPoint3(normals[i], normals[i]);\r\n            }\r\n\r\n            tangents[i].crossTo(normals[i], binormals[i]);\r\n        }\r\n\r\n        // if the curve is closed, postprocess the vectors so the first and last normal vectors are the same\r\n\r\n        if (closed === true)\r\n        {\r\n            let theta = Math.acos(mathUtil.clamp(normals[0].dot(normals[segments]), -1, 1));\r\n\r\n            theta /= segments;\r\n\r\n            if (tangents[0].dot(normals[0].crossTo(normals[segments], vec)) > 0)\r\n            {\r\n                theta = -theta;\r\n            }\r\n\r\n            for (let i = 1; i <= segments; i++)\r\n            {\r\n                // twist a little...\r\n                mat.fromAxisRotate(tangents[i], theta * i * mathUtil.RAD2DEG).transformPoint3(normals[i], normals[i]);\r\n                tangents[i].crossTo(normals[i], binormals[i]);\r\n            }\r\n        }\r\n\r\n        return {\r\n            tangents,\r\n            normals,\r\n            binormals\r\n        };\r\n    }\r\n}\r\n","import { Vector2 } from '../../geom/Vector2';\r\nimport { Curve } from '../core/Curve';\r\n\r\nexport class LineCurve2 extends Curve<Vector2>\r\n{\r\n    v1: Vector2;\r\n    v2: Vector2;\r\n\r\n    constructor(v1 = new Vector2(), v2 = new Vector2())\r\n    {\r\n        super();\r\n        this.v1 = v1;\r\n        this.v2 = v2;\r\n    }\r\n\r\n    getResolution(_divisions: number): number\r\n    {\r\n        return 1;\r\n    }\r\n\r\n    getPoint(t: number, optionalTarget: Vector2)\r\n    {\r\n        const point = optionalTarget || new Vector2();\r\n\r\n        if (t === 1)\r\n        {\r\n            point.copy(this.v2);\r\n        }\r\n        else\r\n        {\r\n            point.copy(this.v2).sub(this.v1);\r\n            point.scaleNumber(t).add(this.v1);\r\n        }\r\n\r\n        return point;\r\n    }\r\n\r\n    // Line curve is linear, so we can overwrite default getPointAt\r\n    getPointAt(u: number, optionalTarget: Vector2)\r\n    {\r\n        return this.getPoint(u, optionalTarget);\r\n    }\r\n\r\n    getTangent(t: number, optionalTarget = new Vector2())\r\n    {\r\n        const tangent = optionalTarget;\r\n\r\n        tangent.copy(this.v2).sub(this.v1).normalize();\r\n\r\n        return tangent;\r\n    }\r\n}\r\n","import { Vector } from '../../geom/Vector';\r\nimport { LineCurve2 } from '../curves/LineCurve2';\r\nimport { Curve } from './Curve';\r\n\r\n/**\r\n * Curved Path - a curve path is simply a array of connected\r\n * curves, but retains the api of a curve\r\n */\r\nexport class CurvePath<T extends Vector> extends Curve<T>\r\n{\r\n    curves: Curve<T>[] = [];\r\n    autoClose = false; // Automatically closes the path\r\n    cacheLengths: number[];\r\n\r\n    add(curve: Curve<T>)\r\n    {\r\n        this.curves.push(curve);\r\n    }\r\n\r\n    closePath()\r\n    {\r\n        // Add a line curve if start and end of lines are not connected\r\n        const startPoint = this.curves[0].getPoint(0);\r\n        const endPoint = this.curves[this.curves.length - 1].getPoint(1);\r\n\r\n        if (!startPoint.equals(endPoint))\r\n        {\r\n            this.curves.push(new LineCurve2(endPoint as any, startPoint as any) as any);\r\n        }\r\n    }\r\n\r\n    // To get accurate point with reference to\r\n    // entire path distance at time t,\r\n    // following has to be done:\r\n\r\n    // 1. Length of each sub path have to be known\r\n    // 2. Locate and identify type of curve\r\n    // 3. Get t for the curve\r\n    // 4. Return curve.getPointAt(t')\r\n\r\n    getPoint(t: number)\r\n    {\r\n        const d = t * this.getLength();\r\n        const curveLengths = this.getCurveLengths();\r\n        let i = 0;\r\n\r\n        // To think about boundaries points.\r\n        while (i < curveLengths.length)\r\n        {\r\n            if (curveLengths[i] >= d)\r\n            {\r\n                const diff = curveLengths[i] - d;\r\n                const curve = this.curves[i];\r\n\r\n                const segmentLength = curve.getLength();\r\n                const u = segmentLength === 0 ? 0 : 1 - (diff / segmentLength);\r\n\r\n                return curve.getPointAt(u);\r\n            }\r\n            i++;\r\n        }\r\n\r\n        return null; // loop where sum !== 0, sum > d , sum+1 <d\r\n    }\r\n\r\n    // We cannot use the default Curve getPoint() with getLength() because in\r\n    // Curve, getLength() depends on getPoint() but in CurvePath\r\n    // getPoint() depends on getLength\r\n\r\n    getLength()\r\n    {\r\n        const lens = this.getCurveLengths();\r\n\r\n        return lens[lens.length - 1];\r\n    }\r\n\r\n    // cacheLengths must be recalculated.\r\n    updateArcLengths()\r\n    {\r\n        this.needsUpdate = true;\r\n        this.cacheLengths = null;\r\n        this.getCurveLengths();\r\n    }\r\n\r\n    // Compute lengths and cache them\r\n    // We cannot overwrite getLengths() because UtoT mapping uses it.\r\n    getCurveLengths()\r\n    {\r\n        // We use cache values if curves and cache array are same length\r\n        if (this.cacheLengths && this.cacheLengths.length === this.curves.length)\r\n        {\r\n            return this.cacheLengths;\r\n        }\r\n\r\n        // Get length of sub-curve\r\n        // Push sums into cached array\r\n        const lengths: number[] = [];\r\n        let sums = 0;\r\n\r\n        for (let i = 0, l = this.curves.length; i < l; i++)\r\n        {\r\n            sums += this.curves[i].getLength();\r\n            lengths.push(sums);\r\n        }\r\n        this.cacheLengths = lengths;\r\n\r\n        return lengths;\r\n    }\r\n\r\n    getSpacedPoints(divisions = 40)\r\n    {\r\n        const points: T[] = [];\r\n\r\n        for (let i = 0; i <= divisions; i++)\r\n        {\r\n            points.push(this.getPoint(i / divisions));\r\n        }\r\n\r\n        if (this.autoClose)\r\n        {\r\n            points.push(points[0]);\r\n        }\r\n\r\n        return points;\r\n    }\r\n\r\n    getPoints(divisions = 12)\r\n    {\r\n        const points: T[] = [];\r\n        let last: T;\r\n\r\n        for (let i = 0, curves = this.curves; i < curves.length; i++)\r\n        {\r\n            const curve = curves[i];\r\n            const resolution = curve.getResolution(divisions);\r\n            const pts = curve.getPoints(resolution);\r\n\r\n            for (let j = 0; j < pts.length; j++)\r\n            {\r\n                const point = pts[j];\r\n\r\n                if (last && last.equals(point)) continue; // ensures no consecutive points are duplicates\r\n                points.push(point);\r\n                last = point;\r\n            }\r\n        }\r\n\r\n        if (this.autoClose && points.length > 1 && !points[points.length - 1].equals(points[0]))\r\n        {\r\n            points.push(points[0]);\r\n        }\r\n\r\n        return points;\r\n    }\r\n}\r\n","import { ObjectUtils } from '@feng3d/polyfill';\r\n\r\n/**\r\n * Port from https://github.com/mapbox/earcut (v2.2.2)\r\n */\r\nexport class Earcut\r\n{\r\n    /**\r\n     * 三角化形状\r\n     *\r\n     * @param data 形状顶点数据\r\n     * @param holeIndices 空洞的起始顶点索引列表\r\n     * @param dim 相邻顶点数据之间的步长\r\n     */\r\n    static triangulate(data: number[], holeIndices: number[], dim = 2)\r\n    {\r\n        // 判断是否有孔洞\r\n        const hasHoles = holeIndices && holeIndices.length;\r\n        // 获取形状轮廓顶点数量\r\n        const outerLen = hasHoles ? holeIndices[0] * dim : data.length;\r\n        // 初始化形状轮廓顶点链表\r\n        let outerNode = linkedList(data, 0, outerLen, dim, true);\r\n        // 三角索引\r\n        const triangles: number[] = [];\r\n\r\n        // 没有节点、只有一个或者两个节点不构成三角形时直接返回\r\n        if (!outerNode || outerNode.next === outerNode.prev) return triangles;\r\n\r\n        let minX: number;\r\n        let minY: number;\r\n        let maxX: number;\r\n        let maxY: number;\r\n        let x: number;\r\n        let y: number;\r\n        let invSize: number;\r\n\r\n        // 消除孔洞\r\n        if (hasHoles) outerNode = eliminateHoles(data, holeIndices, outerNode, dim);\r\n\r\n        // if the shape is not too simple, we'll use z-order curve hash later; calculate polygon bbox\r\n        // 如果形状比较复杂，将使用z顺序曲线哈希;计算多边形bbox\r\n        if (data.length > 80 * dim)\r\n        {\r\n            minX = maxX = data[0];\r\n            minY = maxY = data[1];\r\n\r\n            // 统计最大最小X轴与Y轴坐标\r\n            for (let i = dim; i < outerLen; i += dim)\r\n            {\r\n                x = data[i];\r\n                y = data[i + 1];\r\n                if (x < minX) minX = x;\r\n                if (y < minY) minY = y;\r\n                if (x > maxX) maxX = x;\r\n                if (y > maxY) maxY = y;\r\n            }\r\n\r\n            // minX, minY and invSize are later used to node3d coords into integers for z-order calculation\r\n            // 计算尺寸的倒数，用于后面运算\r\n            invSize = Math.max(maxX - minX, maxY - minY);\r\n            invSize = invSize !== 0 ? 1 / invSize : 0;\r\n        }\r\n\r\n        earcutLinked(outerNode, triangles, dim, minX, minY, invSize);\r\n\r\n        return triangles;\r\n    }\r\n}\r\n\r\n/**\r\n * create a circular doubly linked list from polygon points in the specified winding order\r\n *\r\n * 以指定的绕线顺序从多边形点创建一个循环的双重链表\r\n *\r\n * @param data 多边形顶点数据\r\n * @param start 起始顶点索引\r\n * @param end 终止顶点索引\r\n * @param dim 相邻顶点数据之间的步长\r\n * @param clockwise 是否顺时针方向\r\n */\r\nfunction linkedList(data: number[], start: number, end: number, dim: number, clockwise: boolean)\r\n{\r\n    let i: number; let\r\n        last: Node;\r\n\r\n    // 按照指定时钟方向建立链表\r\n    if (clockwise === (signedArea(data, start, end, dim) > 0))\r\n    {\r\n        for (i = start; i < end; i += dim) last = insertNode(i, data[i], data[i + 1], last);\r\n    }\r\n    else\r\n    {\r\n        for (i = end - dim; i >= start; i -= dim) last = insertNode(i, data[i], data[i + 1], last);\r\n    }\r\n\r\n    // 去除头尾相同节点\r\n    if (last && equals(last, last.next))\r\n    {\r\n        removeNode(last);\r\n        last = last.next;\r\n    }\r\n\r\n    return last;\r\n}\r\n\r\n/**\r\n * 消除共线与重复节点\r\n *\r\n * @param start 遍历检测起始节点\r\n * @param end 遍历检测终止节点\r\n */\r\nfunction filterPoints(start: Node, end?: Node)\r\n{\r\n    if (!start) return start;\r\n    if (!end) end = start;\r\n\r\n    let p = start;\r\n    let again: boolean;\r\n\r\n    do\r\n    {\r\n        again = false;\r\n\r\n        // 判断重复节点与共线节点\r\n        if (!p.steiner && (equals(p, p.next) || area(p.prev, p, p.next) === 0))\r\n        {\r\n            removeNode(p);\r\n            p = end = p.prev;\r\n            if (p === p.next) break;\r\n            again = true;\r\n        }\r\n        else\r\n        {\r\n            p = p.next;\r\n        }\r\n    } while (again || p !== end);\r\n\r\n    return end;\r\n}\r\n\r\n/**\r\n * main ear slicing loop which triangulates a polygon (given as a linked list)\r\n *\r\n * 主耳切割循环三角化多边形（由链表表示）\r\n *\r\n * @param ear 被三角化的多边形链表\r\n * @param triangles 三角化后的顶点索引数组\r\n * @param dim 相邻顶点数据之间的步长\r\n * @param minX 包围盒X轴最小值\r\n * @param minY 包围盒Y轴最小值\r\n * @param invSize 包围盒尺寸倒数\r\n * @param pass\r\n */\r\nfunction earcutLinked(ear: Node, triangles: number[], dim: number, minX: number, minY: number, invSize: number, pass?: number)\r\n{\r\n    if (!ear) return;\r\n\r\n    // interlink polygon nodes in z-order\r\n    // 使用z-order连接多边形结点\r\n    if (!pass && invSize) indexCurve(ear, minX, minY, invSize);\r\n\r\n    let stop = ear;\r\n    let prev: Node; let\r\n        next: Node;\r\n\r\n    // iterate through ears, slicing them one by one\r\n    while (ear.prev !== ear.next)\r\n    {\r\n        prev = ear.prev;\r\n        next = ear.next;\r\n\r\n        if (invSize ? isEarHashed(ear, minX, minY, invSize) : isEar(ear))\r\n        {\r\n            // cut off the triangle\r\n            triangles.push(prev.i / dim);\r\n            triangles.push(ear.i / dim);\r\n            triangles.push(next.i / dim);\r\n\r\n            removeNode(ear);\r\n\r\n            // skipping the next vertex leads to less sliver triangles\r\n            ear = next.next;\r\n            stop = next.next;\r\n\r\n            continue;\r\n        }\r\n\r\n        ear = next;\r\n\r\n        // if we looped through the whole remaining polygon and can't find any more ears\r\n        if (ear === stop)\r\n        {\r\n            // try filtering points and slicing again\r\n            if (!pass)\r\n            {\r\n                earcutLinked(filterPoints(ear), triangles, dim, minX, minY, invSize, 1);\r\n\r\n                // if this didn't work, try curing all small self-intersections locally\r\n            }\r\n            else if (pass === 1)\r\n            {\r\n                ear = cureLocalIntersections(filterPoints(ear), triangles, dim);\r\n                earcutLinked(ear, triangles, dim, minX, minY, invSize, 2);\r\n\r\n                // as a last resort, try splitting the remaining polygon into two\r\n            }\r\n            else if (pass === 2)\r\n            {\r\n                splitEarcut(ear, triangles, dim, minX, minY, invSize);\r\n            }\r\n\r\n            break;\r\n        }\r\n    }\r\n}\r\n\r\n// check whether a polygon node forms a valid ear with adjacent nodes\r\nfunction isEar(ear: Node)\r\n{\r\n    const a = ear.prev;\r\n    const b = ear;\r\n    const c = ear.next;\r\n\r\n    if (area(a, b, c) >= 0) return false; // reflex, can't be an ear\r\n\r\n    // now make sure we don't have other points inside the potential ear\r\n    let p = ear.next.next;\r\n\r\n    while (p !== ear.prev)\r\n    {\r\n        if (pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y)\r\n            && area(p.prev, p, p.next) >= 0) return false;\r\n        p = p.next;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nfunction isEarHashed(ear: Node, minX: number, minY: number, invSize: number)\r\n{\r\n    const a = ear.prev;\r\n    const b = ear;\r\n    const c = ear.next;\r\n\r\n    if (area(a, b, c) >= 0) return false; // reflex, can't be an ear\r\n\r\n    // triangle bbox; min & max are calculated like this for speed\r\n    const minTX = a.x < b.x ? (a.x < c.x ? a.x : c.x) : (b.x < c.x ? b.x : c.x);\r\n    const minTY = a.y < b.y ? (a.y < c.y ? a.y : c.y) : (b.y < c.y ? b.y : c.y);\r\n    const maxTX = a.x > b.x ? (a.x > c.x ? a.x : c.x) : (b.x > c.x ? b.x : c.x);\r\n    const maxTY = a.y > b.y ? (a.y > c.y ? a.y : c.y) : (b.y > c.y ? b.y : c.y);\r\n\r\n    // z-order range for the current triangle bbox;\r\n    const minZ = zOrder(minTX, minTY, minX, minY, invSize);\r\n    const maxZ = zOrder(maxTX, maxTY, minX, minY, invSize);\r\n\r\n    let p = ear.prevZ;\r\n    let n = ear.nextZ;\r\n\r\n    // look for points inside the triangle in both directions\r\n    while (p && p.z >= minZ && n && n.z <= maxZ)\r\n    {\r\n        if (p !== ear.prev && p !== ear.next\r\n            && pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y)\r\n            && area(p.prev, p, p.next) >= 0) return false;\r\n        p = p.prevZ;\r\n\r\n        if (n !== ear.prev && n !== ear.next\r\n            && pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, n.x, n.y)\r\n            && area(n.prev, n, n.next) >= 0) return false;\r\n        n = n.nextZ;\r\n    }\r\n\r\n    // look for remaining points in decreasing z-order\r\n    while (p && p.z >= minZ)\r\n    {\r\n        if (p !== ear.prev && p !== ear.next\r\n            && pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y)\r\n            && area(p.prev, p, p.next) >= 0) return false;\r\n        p = p.prevZ;\r\n    }\r\n\r\n    // look for remaining points in increasing z-order\r\n    while (n && n.z <= maxZ)\r\n    {\r\n        if (n !== ear.prev && n !== ear.next\r\n            && pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, n.x, n.y)\r\n            && area(n.prev, n, n.next) >= 0) return false;\r\n        n = n.nextZ;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n// go through all polygon nodes and cure small local self-intersections\r\nfunction cureLocalIntersections(start: Node, triangles: number[], dim: number)\r\n{\r\n    let p = start;\r\n\r\n    do\r\n    {\r\n        const a = p.prev;\r\n        const b = p.next.next;\r\n\r\n        if (!equals(a, b) && intersects(a, p, p.next, b) && locallyInside(a, b) && locallyInside(b, a))\r\n        {\r\n            triangles.push(a.i / dim);\r\n            triangles.push(p.i / dim);\r\n            triangles.push(b.i / dim);\r\n\r\n            // remove two nodes involved\r\n            // 移除两个有问题的节点\r\n            removeNode(p);\r\n            removeNode(p.next);\r\n\r\n            p = start = b;\r\n        }\r\n        p = p.next;\r\n    } while (p !== start);\r\n\r\n    return filterPoints(p);\r\n}\r\n\r\n// try splitting polygon into two and triangulate them independently\r\nfunction splitEarcut(start: Node, triangles: number[], dim: number, minX: number, minY: number, invSize: number)\r\n{\r\n    // look for a valid diagonal that divides the polygon into two\r\n    let a = start;\r\n\r\n    do\r\n    {\r\n        let b = a.next.next;\r\n\r\n        while (b !== a.prev)\r\n        {\r\n            if (a.i !== b.i && isValidDiagonal(a, b))\r\n            {\r\n                // split the polygon in two by the diagonal\r\n                let c = splitPolygon(a, b);\r\n\r\n                // filter colinear points around the cuts\r\n                a = filterPoints(a, a.next);\r\n                c = filterPoints(c, c.next);\r\n\r\n                // run earcut on each half\r\n                earcutLinked(a, triangles, dim, minX, minY, invSize);\r\n                earcutLinked(c, triangles, dim, minX, minY, invSize);\r\n\r\n                return;\r\n            }\r\n\r\n            b = b.next;\r\n        }\r\n        a = a.next;\r\n    } while (a !== start);\r\n}\r\n\r\n/**\r\n * link every hole into the outer loop, producing a single-ring polygon without holes\r\n *\r\n * 将每个孔连接到外环，产生一个没有孔的单环多边形\r\n *\r\n * @param data 形状顶点数据\r\n * @param holeIndices 空洞的起始顶点索引列表\r\n * @param outerNode 形状轮廓链表\r\n * @param dim 相邻顶点数据之间的步长\r\n */\r\nfunction eliminateHoles(data: number[], holeIndices: number[], outerNode: Node, dim: number)\r\n{\r\n    // 孔洞链表数组\r\n    const queue: Node[] = [];\r\n    let i: number;\r\n    let len: number;\r\n    let start: number;\r\n    let end: number;\r\n    let list: Node;\r\n\r\n    // 遍历构建孔洞链表数组\r\n    for (i = 0, len = holeIndices.length; i < len; i++)\r\n    {\r\n        // 获取当前孔洞起始与结束索引\r\n        start = holeIndices[i] * dim;\r\n        end = i < len - 1 ? holeIndices[i + 1] * dim : data.length;\r\n        // 构建孔洞链表\r\n        list = linkedList(data, start, end, dim, false);\r\n        if (list === list.next) list.steiner = true;\r\n        // 把孔洞链表中最左边（X值最小）的节点存放到数组中\r\n        queue.push(getLeftmost(list));\r\n    }\r\n    // 从左到右排序孔洞链表数组\r\n    queue.sort(compareX);\r\n\r\n    // process holes from left to right\r\n    // 从左到右消除孔洞链表\r\n    for (i = 0; i < queue.length; i++)\r\n    {\r\n        // 消除孔洞列表\r\n        eliminateHole(queue[i], outerNode);\r\n        // 处理连接外轮廓与孔洞后出现的重复点与共线\r\n        outerNode = filterPoints(outerNode, outerNode.next);\r\n    }\r\n\r\n    return outerNode;\r\n}\r\n\r\nfunction compareX(a: Node, b: Node)\r\n{\r\n    return a.x - b.x;\r\n}\r\n\r\n/**\r\n * find a bridge between vertices that connects hole with an outer ring and and link it\r\n * 找到一个桥梁连接外轮廓与孔洞\r\n *\r\n * @param hole 孔洞链表\r\n * @param outerNode 外轮廓链表\r\n */\r\nfunction eliminateHole(hole: Node, outerNode: Node)\r\n{\r\n    // 查找与hole节点构成桥梁的外轮廓节点\r\n    outerNode = findHoleBridge(hole, outerNode);\r\n    if (outerNode)\r\n    {\r\n        // 构建外轮廓与孔洞桥梁\r\n        const b = splitPolygon(outerNode, hole);\r\n\r\n        // filter collinear points around the cuts\r\n        filterPoints(outerNode, outerNode.next);\r\n        filterPoints(b, b.next);\r\n    }\r\n}\r\n\r\n/**\r\n * David Eberly's algorithm for finding a bridge between hole and outer polygon\r\n *\r\n * 使用David Eberly算法找到孔洞与外轮廓之间的桥梁\r\n *\r\n * @param hole 孔洞链表\r\n * @param outerNode 外轮廓链表\r\n */\r\nfunction findHoleBridge(hole: Node, outerNode: Node)\r\n{\r\n    let p = outerNode;\r\n    const hx = hole.x;\r\n    const hy = hole.y;\r\n    let qx = -Infinity; let\r\n        m: Node;\r\n\r\n    // find a segment intersected by a ray from the hole's leftmost point to the left;\r\n    // segment's endpoint with lesser x will be potential connection point\r\n    do\r\n    {\r\n        if (hy <= p.y && hy >= p.next.y && p.next.y !== p.y)\r\n        {\r\n            const x = p.x + ((hy - p.y) * (p.next.x - p.x) / (p.next.y - p.y));\r\n\r\n            if (x <= hx && x > qx)\r\n            {\r\n                qx = x;\r\n                if (x === hx)\r\n                {\r\n                    if (hy === p.y) return p;\r\n                    if (hy === p.next.y) return p.next;\r\n                }\r\n                m = p.x < p.next.x ? p : p.next;\r\n            }\r\n        }\r\n        p = p.next;\r\n    } while (p !== outerNode);\r\n\r\n    if (!m) return null;\r\n    if (hx === qx) return m; // hole touches outer segment; pick leftmost endpoint\r\n\r\n    // look for points inside the triangle of hole point, segment intersection and endpoint;\r\n    // if there are no points found, we have a valid connection;\r\n    // otherwise choose the point of the minimum angle with the ray as connection point\r\n    const stop = m;\r\n    const mx = m.x;\r\n    const my = m.y;\r\n    let tanMin = Infinity; let\r\n        tan: number;\r\n\r\n    p = m;\r\n    do\r\n    {\r\n        if (hx >= p.x && p.x >= mx && hx !== p.x\r\n            && pointInTriangle(hy < my ? hx : qx, hy, mx, my, hy < my ? qx : hx, hy, p.x, p.y))\r\n        {\r\n            tan = Math.abs(hy - p.y) / (hx - p.x); // tangential\r\n            if (locallyInside(p, hole) && (tan < tanMin || (tan === tanMin && (p.x > m.x || (p.x === m.x && sectorContainsSector(m, p))))))\r\n            {\r\n                m = p;\r\n                tanMin = tan;\r\n            }\r\n        }\r\n        p = p.next;\r\n    } while (p !== stop);\r\n\r\n    return m;\r\n}\r\n\r\n/**\r\n * whether sector in vertex m contains sector in vertex p in the same coordinates\r\n *\r\n * 判断在相同坐标系下第一个节点的扇形区域是否包含第二个节点的扇形区域。\r\n *\r\n * @param m 第一个节点\r\n * @param p 第二个节点\r\n *\r\n * @todo 没懂\r\n */\r\nfunction sectorContainsSector(m: Node, p: Node)\r\n{\r\n    return area(m.prev, m, p.prev) < 0 && area(p.next, m, m.next) < 0;\r\n}\r\n\r\n/**\r\n * interlink polygon nodes in z-order\r\n *\r\n * 以z顺序连接多边形节点\r\n *\r\n * @param start 起始节点\r\n * @param minX 包围盒X轴最小值\r\n * @param minY 包围盒Y轴最小值\r\n * @param invSize 包围盒尺寸的倒数\r\n */\r\nfunction indexCurve(start: Node, minX: number, minY: number, invSize: number)\r\n{\r\n    let p = start;\r\n\r\n    do\r\n    {\r\n        if (ObjectUtils.objectIsEmpty(p.z)) p.z = zOrder(p.x, p.y, minX, minY, invSize);\r\n        p.prevZ = p.prev;\r\n        p.nextZ = p.next;\r\n        p = p.next;\r\n    } while (p !== start);\r\n\r\n    p.prevZ.nextZ = null;\r\n    p.prevZ = null;\r\n\r\n    // 根据z的大小对链表进行排序\r\n    sortLinked(p);\r\n}\r\n\r\n/**\r\n * Simon Tatham's linked list merge sort algorithm\r\n *\r\n * 链表归并排序算法\r\n *\r\n * @see http://www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html\r\n *\r\n * @param list 链表\r\n */\r\nfunction sortLinked(list: Node)\r\n{\r\n    let i: number;\r\n    let p: Node;\r\n    let q: Node;\r\n    let e: Node;\r\n    let tail: Node;\r\n    let numMerges: number;\r\n    let pSize: number;\r\n    let qSize: number;\r\n    let inSize = 1;\r\n\r\n    do\r\n    {\r\n        p = list;\r\n        list = null;\r\n        tail = null;\r\n        numMerges = 0;\r\n\r\n        while (p)\r\n        {\r\n            numMerges++;\r\n            q = p;\r\n            pSize = 0;\r\n            for (i = 0; i < inSize; i++)\r\n            {\r\n                pSize++;\r\n                q = q.nextZ;\r\n                if (!q) break;\r\n            }\r\n\r\n            qSize = inSize;\r\n\r\n            while (pSize > 0 || (qSize > 0 && q))\r\n            {\r\n                if (pSize !== 0 && (qSize === 0 || !q || p.z <= q.z))\r\n                {\r\n                    e = p;\r\n                    p = p.nextZ;\r\n                    pSize--;\r\n                }\r\n                else\r\n                {\r\n                    e = q;\r\n                    q = q.nextZ;\r\n                    qSize--;\r\n                }\r\n\r\n                if (tail) tail.nextZ = e;\r\n                else list = e;\r\n\r\n                e.prevZ = tail;\r\n                tail = e;\r\n            }\r\n\r\n            p = q;\r\n        }\r\n\r\n        tail.nextZ = null;\r\n        inSize *= 2;\r\n    } while (numMerges > 1);\r\n\r\n    return list;\r\n}\r\n\r\n/**\r\n * z-order of a point given coords and inverse of the longer side of data bbox\r\n *\r\n * 把x与y分别映射到包围盒中位置(0,1)再映射到(0,(1<<15)-1)，最后把x与y的值进行相互穿插组成32位数字\r\n *\r\n * @todo 为什么使用这种运算？不明觉厉！\r\n *\r\n * @param x X轴坐标\r\n * @param y Y轴坐标\r\n * @param minX 包围盒X轴最小值\r\n * @param minY 包围盒Y轴最小值\r\n * @param invSize 包围盒尺寸倒数\r\n *\r\n * @see https://en.wikipedia.org/wiki/Z-order_curve\r\n */\r\nfunction zOrder(x: number, y: number, minX: number, minY: number, invSize: number)\r\n{\r\n    // coords are transformed into non-negative 15-bit integer range\r\n    // 坐标被转换为非负的15位整数范围\r\n    // 把x与y约束在(0,1)范围后在映射到(0,32767)\r\n    x = 32767 * (x - minX) * invSize;\r\n    y = 32767 * (y - minY) * invSize;\r\n\r\n    // 把16位中每一位前面插入一个0转换为32位，例如 0111111111111111（0xffff） -> 00010101010101010101010101010101（0x55555555）\r\n    x = (x | (x << 8)) & 0x00FF00FF;\r\n    x = (x | (x << 4)) & 0x0F0F0F0F;\r\n    x = (x | (x << 2)) & 0x33333333;\r\n    x = (x | (x << 1)) & 0x55555555;\r\n\r\n    y = (y | (y << 8)) & 0x00FF00FF;\r\n    y = (y | (y << 4)) & 0x0F0F0F0F;\r\n    y = (y | (y << 2)) & 0x33333333;\r\n    y = (y | (y << 1)) & 0x55555555;\r\n\r\n    //\r\n    return x | (y << 1);\r\n}\r\n\r\n/**\r\n * find the leftmost node of a polygon ring\r\n *\r\n * 查找一个X值最小的节点\r\n *\r\n * @param start 查找起始节点\r\n */\r\nfunction getLeftmost(start: Node)\r\n{\r\n    let p = start;\r\n    let leftmost = start;\r\n\r\n    do\r\n    {\r\n        if (p.x < leftmost.x || (p.x === leftmost.x && p.y < leftmost.y)) leftmost = p;\r\n        p = p.next;\r\n    } while (p !== start);\r\n\r\n    return leftmost;\r\n}\r\n\r\n/**\r\n * check if a point lies within a convex triangle\r\n *\r\n * 检查一个点是否位于一个正向三角形内\r\n *\r\n * @param ax 三角形第一个点的X轴坐标\r\n * @param ay 三角形第一个点的Y轴坐标\r\n * @param bx 三角形第二个点的X轴坐标\r\n * @param by 三角形第二个点的Y轴坐标\r\n * @param cx 三角形第三个点的X轴坐标\r\n * @param cy 三角形第三个点的Y轴坐标\r\n * @param px 被检查点的X轴坐标\r\n * @param py 被检查点的Y轴坐标\r\n */\r\nfunction pointInTriangle(ax: number, ay: number, bx: number, by: number, cx: number, cy: number, px: number, py: number)\r\n{\r\n    return ((cx - px) * (ay - py)) - ((ax - px) * (cy - py)) >= 0\r\n        && ((ax - px) * (by - py)) - ((bx - px) * (ay - py)) >= 0\r\n        && ((bx - px) * (cy - py)) - ((cx - px) * (by - py)) >= 0;\r\n}\r\n\r\n/**\r\n * check if a diagonal between two polygon nodes is valid (lies in polygon interior)\r\n *\r\n * 检查两个多边形节点之间的对角线是否有效(位于多边形内部)\r\n *\r\n * @param a 多边形顶点a\r\n * @param b 多边形顶点b\r\n */\r\nfunction isValidDiagonal(a: Node, b: Node)\r\n{\r\n    return a.next.i !== b.i && a.prev.i !== b.i && !intersectsPolygon(a, b) // dones't intersect other edges\r\n        && (locallyInside(a, b) && locallyInside(b, a) && middleInside(a, b) // locally visible\r\n            // eslint-disable-next-line no-mixed-operators\r\n            && (area(a.prev, a, b.prev) || area(a, b.prev, b)) // does not create opposite-facing sectors\r\n            // eslint-disable-next-line no-mixed-operators\r\n            || equals(a, b) && area(a.prev, a, a.next) > 0 && area(b.prev, b, b.next) > 0); // special zero-length case\r\n}\r\n\r\n/**\r\n * signed area of a triangle\r\n *\r\n * 计算三角形的带符号面积\r\n *\r\n * @param p 三角形第一个点\r\n * @param q 三角形第二个点\r\n * @param r 三角形第三个点\r\n */\r\nfunction area(p: { x: number, y: number }, q: { x: number, y: number }, r: { x: number, y: number })\r\n{\r\n    return ((q.y - p.y) * (r.x - q.x)) - ((q.x - p.x) * (r.y - q.y));\r\n}\r\n\r\n/**\r\n * check if two points are equal\r\n *\r\n * 判断两个点是否相等\r\n *\r\n * @param p1 第一个点\r\n * @param p2 第二个点\r\n */\r\nfunction equals(p1: { x: number, y: number }, p2: { x: number, y: number })\r\n{\r\n    return p1.x === p2.x && p1.y === p2.y;\r\n}\r\n\r\n/**\r\n * check if two segments intersect\r\n *\r\n * 检查两条线段是否相交\r\n *\r\n * @param p1 第一条线段起点\r\n * @param q1 第一条线段终点\r\n * @param p2 第二条线段起点\r\n * @param q2 第二条线段终点\r\n */\r\nfunction intersects(p1: { x: number, y: number }, q1: { x: number, y: number }, p2: { x: number, y: number }, q2: { x: number, y: number })\r\n{\r\n    const o1 = sign(area(p1, q1, p2));\r\n    const o2 = sign(area(p1, q1, q2));\r\n    const o3 = sign(area(p2, q2, p1));\r\n    const o4 = sign(area(p2, q2, q1));\r\n\r\n    // 正常相交情况\r\n    if (o1 !== o2 && o3 !== o4) return true; // general case\r\n\r\n    // 处理4种3点共线情况\r\n    if (o1 === 0 && onSegment(p1, p2, q1)) return true; // p1, q1 and p2 are collinear and p2 lies on p1q1\r\n    if (o2 === 0 && onSegment(p1, q2, q1)) return true; // p1, q1 and q2 are collinear and q2 lies on p1q1\r\n    if (o3 === 0 && onSegment(p2, p1, q2)) return true; // p2, q2 and p1 are collinear and p1 lies on p2q2\r\n    if (o4 === 0 && onSegment(p2, q1, q2)) return true; // p2, q2 and q1 are collinear and q1 lies on p2q2\r\n\r\n    return false;\r\n}\r\n\r\n/**\r\n * for collinear points p, q, r, check if point q lies on segment pr\r\n *\r\n * 对于共线点p, q, r，检查点q是否在线段pr上\r\n *\r\n * @param p 线段起点\r\n * @param q 被检测的点\r\n * @param r 线段中点\r\n */\r\nfunction onSegment(p: { x: number, y: number }, q: { x: number, y: number }, r: { x: number, y: number })\r\n{\r\n    return q.x <= Math.max(p.x, r.x) && q.x >= Math.min(p.x, r.x) && q.y <= Math.max(p.y, r.y) && q.y >= Math.min(p.y, r.y);\r\n}\r\n\r\n/**\r\n * 取数字符号\r\n *\r\n * @param num 数字\r\n */\r\nfunction sign(num: number)\r\n{\r\n    return num > 0 ? 1 : num < 0 ? -1 : 0;\r\n}\r\n\r\n/**\r\n * check if a polygon diagonal intersects any polygon segments\r\n *\r\n * 检查一个多边形的对角线是否与任何多边形线段相交\r\n *\r\n * @param a 第一个节点\r\n * @param b 第二个节点\r\n */\r\nfunction intersectsPolygon(a: Node, b: Node)\r\n{\r\n    let p = a;\r\n\r\n    do\r\n    {\r\n        // 排除与对角线ab连接的边进行相交测试\r\n        if (p.i !== a.i && p.next.i !== a.i && p.i !== b.i && p.next.i !== b.i\r\n            && intersects(p, p.next, a, b)) return true;\r\n        p = p.next;\r\n    } while (p !== a);\r\n\r\n    return false;\r\n}\r\n\r\n/**\r\n * check if a polygon diagonal is locally inside the polygon\r\n *\r\n * 检查多边形的对角线是否局部位于多边形内部\r\n *\r\n * 判断出ab对角线是否从a点进入多边形内部，从而判断出对角线ab是否局部位于多边形内部。\r\n *\r\n * @param a 第一个节点\r\n * @param b 第二个节点\r\n *\r\n * @todo locallyOutside?\r\n */\r\nfunction locallyInside(a: Node, b: Node)\r\n{\r\n    return area(a.prev, a, a.next) < 0 // 判断a为多边形凸点或者凹点\r\n        ? area(a, b, a.next) >= 0 && area(a, a.prev, b) >= 0 // 判断a为凸点情况\r\n        : area(a, b, a.prev) < 0 || area(a, a.next, b) < 0; // 判断a为凹点情况\r\n}\r\n\r\n/**\r\n * check if the middle point of a polygon diagonal is inside the polygon\r\n *\r\n * 检查两个节点的对角线中点是否在多边形内部\r\n *\r\n * @param a 第一个节点\r\n * @param b 第二个节点\r\n */\r\nfunction middleInside(a: Node, b: Node)\r\n{\r\n    let p = a;\r\n    let inside = false;\r\n    const px = (a.x + b.x) / 2;\r\n    const py = (a.y + b.y) / 2;\r\n\r\n    do\r\n    {\r\n        // 以该点为起点作一条朝向正X轴方向的射线，计算与多边形的边相交的次数，奇数次表示在多边形内部，否则在外部。\r\n        if (((p.y > py) !== (p.next.y > py)) && p.next.y !== p.y\r\n            && (px < ((p.next.x - p.x) * (py - p.y) / (p.next.y - p.y)) + p.x))\r\n        { inside = !inside; }\r\n        p = p.next;\r\n    } while (p !== a);\r\n\r\n    return inside;\r\n}\r\n\r\n/**\r\n * link two polygon vertices with a bridge; if the vertices belong to the same ring, it splits polygon into two;\r\n * if one belongs to the outer ring and another to a hole, it merges it into a single ring\r\n *\r\n * 用桥连接两个多边形顶点; 如果顶点属于同一个环，它将多边形一分为二;\r\n * 如果一个属于外环，另一个属于洞，它合并成一个环。\r\n *\r\n * @param a 外环节点\r\n * @param b 内环节点\r\n */\r\nfunction splitPolygon(a: Node, b: Node)\r\n{\r\n    const a2 = new Node(a.i, a.x, a.y);\r\n    const b2 = new Node(b.i, b.x, b.y);\r\n    const an = a.next;\r\n    const bp = b.prev;\r\n\r\n    a.next = b;\r\n    b.prev = a;\r\n\r\n    a2.next = an;\r\n    an.prev = a2;\r\n\r\n    b2.next = a2;\r\n    a2.prev = b2;\r\n\r\n    bp.next = b2;\r\n    b2.prev = bp;\r\n\r\n    return b2;\r\n}\r\n\r\n/**\r\n * create a node and optionally link it with previous one (in a circular doubly linked list)\r\n *\r\n * 创建一个节点，并可选地与上一个节点链接(在双向循环链表中)\r\n *\r\n * @param i 在顶点数组中的索引\r\n * @param x 节点所在X轴坐标\r\n * @param y 节点所在Y轴坐标\r\n * @param last 双向循环链表中最后一个节点\r\n */\r\nfunction insertNode(i: number, x: number, y: number, last: Node)\r\n{\r\n    const p = new Node(i, x, y);\r\n\r\n    if (!last)\r\n    {\r\n        p.prev = p;\r\n        p.next = p;\r\n    }\r\n    else\r\n    {\r\n        p.next = last.next;\r\n        p.prev = last;\r\n        last.next.prev = p;\r\n        last.next = p;\r\n    }\r\n\r\n    return p;\r\n}\r\n\r\n/**\r\n * 移除节点\r\n *\r\n * @param p 被移除的节点\r\n */\r\nfunction removeNode(p: Node)\r\n{\r\n    p.next.prev = p.prev;\r\n    p.prev.next = p.next;\r\n\r\n    if (p.prevZ) p.prevZ.nextZ = p.nextZ;\r\n    if (p.nextZ) p.nextZ.prevZ = p.prevZ;\r\n}\r\n\r\nclass Node\r\n{\r\n    /**\r\n     * 在顶点数组中的索引\r\n     */\r\n    i: number;\r\n\r\n    /**\r\n     * 节点所在X轴坐标\r\n     */\r\n    x: number;\r\n\r\n    /**\r\n     * 节点所在Y轴坐标\r\n     */\r\n    y: number;\r\n\r\n    /**\r\n     * z-order curve value\r\n     */\r\n    z: number = null;\r\n\r\n    /**\r\n     * previous node in z-order\r\n     */\r\n    prevZ: Node = null;\r\n\r\n    /**\r\n     * next node in z-order\r\n     */\r\n    nextZ: Node = null;\r\n\r\n    /**\r\n     * 多边形环中的前一个顶点节点\r\n     */\r\n    prev: Node = null;\r\n\r\n    /**\r\n     * 多边形环中的下一个顶点节点\r\n     */\r\n    next: Node = null;\r\n\r\n    /**\r\n     * 否为 Steiner Point?\r\n     *\r\n     * @todo 没理解\r\n     * @see https://en.wikipedia.org/wiki/Steiner_point_(triangle)\r\n     */\r\n    steiner = false;\r\n\r\n    constructor(i: number, x: number, y: number)\r\n    {\r\n        this.i = i;\r\n\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n}\r\n\r\n/**\r\n * 求有符号的多边形面积总和。正面时面积为正值，否则为负值。\r\n *\r\n * @param data 多边形顶点数据\r\n * @param start 顶点起始索引\r\n * @param end 顶点终止索引\r\n * @param dim 是否顺时针方向\r\n */\r\nfunction signedArea(data: number[], start: number, end: number, dim: number)\r\n{\r\n    let sum = 0;\r\n\r\n    for (let i = start, j = end - dim; i < end; i += dim)\r\n    {\r\n        sum += (data[j] - data[i]) * (data[i + 1] + data[j + 1]);\r\n        j = i;\r\n    }\r\n\r\n    return sum;\r\n}\r\n\r\n","import { Vector2 } from '../geom/Vector2';\r\nimport { Earcut } from './Earcut';\r\n\r\nexport class ShapeUtils\r\n{\r\n    /**\r\n     * 计算多边形面积\r\n     * @param contour 多边形轮廓，使用顶点数组表示。\r\n     */\r\n    static area(contour: Vector2[])\r\n    {\r\n        const n = contour.length;\r\n        let a = 0.0;\r\n\r\n        for (let p = n - 1, q = 0; q < n; p = q++)\r\n        {\r\n            a += (contour[p].x * contour[q].y) - (contour[q].x * contour[p].y);\r\n        }\r\n\r\n        return a * 0.5;\r\n    }\r\n\r\n    /**\r\n     * 判断多边形是否为顺时针方向\r\n     *\r\n     * @param contour 多边形轮廓，使用顶点数组表示。\r\n     */\r\n    static isClockWise(contour: Vector2[])\r\n    {\r\n        return ShapeUtils.area(contour) < 0;\r\n    }\r\n\r\n    /**\r\n     * 三角化多边形\r\n     *\r\n     * @param contour 多边形轮廓，使用顶点数组表示。\r\n     * @param holes 孔洞多边形数组，每个孔洞多边形使用顶点数组表示。\r\n     */\r\n    static triangulateShape(contour: Vector2[], holes: Vector2[][])\r\n    {\r\n        const vertices: number[] = []; // flat array of vertices like [ x0,y0, x1,y1, x2,y2, ... ]\r\n        const holeIndices: number[] = []; // array of hole indices\r\n        const faces: number[][] = []; // final array of vertex indices like [ [ a,b,d ], [ b,c,d ] ]\r\n\r\n        removeDupEndPts(contour);\r\n        addContour(vertices, contour);\r\n\r\n        //\r\n        let holeIndex = contour.length;\r\n\r\n        holes.forEach(removeDupEndPts);\r\n\r\n        for (let i = 0; i < holes.length; i++)\r\n        {\r\n            holeIndices.push(holeIndex);\r\n            holeIndex += holes[i].length;\r\n            addContour(vertices, holes[i]);\r\n        }\r\n        //\r\n        const triangles = Earcut.triangulate(vertices, holeIndices);\r\n\r\n        //\r\n        for (let i = 0; i < triangles.length; i += 3)\r\n        {\r\n            faces.push(triangles.slice(i, i + 3));\r\n        }\r\n\r\n        return faces;\r\n    }\r\n}\r\n\r\nfunction removeDupEndPts(points: Vector2[])\r\n{\r\n    const l = points.length;\r\n\r\n    if (l > 2 && points[l - 1].equals(points[0]))\r\n    {\r\n        points.pop();\r\n    }\r\n}\r\n\r\nfunction addContour(vertices: number[], contour: Vector2[])\r\n{\r\n    for (let i = 0; i < contour.length; i++)\r\n    {\r\n        vertices.push(contour[i].x);\r\n        vertices.push(contour[i].y);\r\n    }\r\n}\r\n\r\n","/**\r\n * Bezier Curves formulas obtained from\r\n * http://en.wikipedia.org/wiki/Bézier_curve\r\n */\r\nexport class Interpolations\r\n{\r\n    static CatmullRom(t: number, p0: number, p1: number, p2: number, p3: number)\r\n    {\r\n        const v0 = (p2 - p0) * 0.5;\r\n        const v1 = (p3 - p1) * 0.5;\r\n        const t2 = t * t;\r\n        const t3 = t * t2;\r\n\r\n        return (((2 * p1) - (2 * p2) + v0 + v1) * t3) + (((-3 * p1) + (3 * p2) - (2 * v0) - v1) * t2) + (v0 * t) + p1;\r\n    }\r\n\r\n    static QuadraticBezier(t: number, p0: number, p1: number, p2: number)\r\n    {\r\n        return QuadraticBezierP0(t, p0) + QuadraticBezierP1(t, p1)\r\n            + QuadraticBezierP2(t, p2);\r\n    }\r\n\r\n    static CubicBezier(t: number, p0: number, p1: number, p2: number, p3: number)\r\n    {\r\n        return CubicBezierP0(t, p0) + CubicBezierP1(t, p1) + CubicBezierP2(t, p2)\r\n            + CubicBezierP3(t, p3);\r\n    }\r\n}\r\n\r\nfunction QuadraticBezierP0(t: number, p: number)\r\n{\r\n    const k = 1 - t;\r\n\r\n    return k * k * p;\r\n}\r\n\r\nfunction QuadraticBezierP1(t: number, p: number)\r\n{\r\n    return 2 * (1 - t) * t * p;\r\n}\r\n\r\nfunction QuadraticBezierP2(t: number, p: number)\r\n{\r\n    return t * t * p;\r\n}\r\n\r\nfunction CubicBezierP0(t: number, p: number)\r\n{\r\n    const k = 1 - t;\r\n\r\n    return k * k * k * p;\r\n}\r\n\r\nfunction CubicBezierP1(t: number, p: number)\r\n{\r\n    const k = 1 - t;\r\n\r\n    return 3 * k * k * t * p;\r\n}\r\n\r\nfunction CubicBezierP2(t: number, p: number)\r\n{\r\n    return 3 * (1 - t) * t * t * p;\r\n}\r\n\r\nfunction CubicBezierP3(t: number, p: number)\r\n{\r\n    return t * t * t * p;\r\n}\r\n","import { Vector2 } from '../../geom/Vector2';\r\nimport { Curve } from '../core/Curve';\r\nimport { Interpolations } from '../core/Interpolations';\r\n\r\nexport class CubicBezierCurve2 extends Curve<Vector2>\r\n{\r\n    v0: Vector2;\r\n    v1: Vector2;\r\n    v2: Vector2;\r\n    v3: Vector2;\r\n\r\n    constructor(v0 = new Vector2(), v1 = new Vector2(), v2 = new Vector2(), v3 = new Vector2())\r\n    {\r\n        super();\r\n\r\n        this.v0 = v0;\r\n        this.v1 = v1;\r\n        this.v2 = v2;\r\n        this.v3 = v3;\r\n    }\r\n\r\n    getPoint(t: number, optionalTarget = new Vector2())\r\n    {\r\n        const point = optionalTarget;\r\n\r\n        const v0 = this.v0;\r\n        const v1 = this.v1;\r\n        const v2 = this.v2;\r\n        const v3 = this.v3;\r\n\r\n        point.set(\r\n            Interpolations.CubicBezier(t, v0.x, v1.x, v2.x, v3.x),\r\n            Interpolations.CubicBezier(t, v0.y, v1.y, v2.y, v3.y)\r\n        );\r\n\r\n        return point;\r\n    }\r\n}\r\n","import { Vector2 } from '../../geom/Vector2';\r\nimport { Curve } from '../core/Curve';\r\n\r\nexport class EllipseCurve2 extends Curve<Vector2>\r\n{\r\n    aX: number;\r\n    aY: number;\r\n    xRadius: number;\r\n    yRadius: number;\r\n    aStartAngle: number;\r\n    aEndAngle: number;\r\n    aClockwise: boolean;\r\n    aRotation: number;\r\n\r\n    constructor(aX = 0, aY = 0, xRadius = 1, yRadius = 1, aStartAngle = 0, aEndAngle = 2 * Math.PI, aClockwise = false, aRotation = 0)\r\n    {\r\n        super();\r\n\r\n        this.aX = aX;\r\n        this.aY = aY;\r\n\r\n        this.xRadius = xRadius;\r\n        this.yRadius = yRadius;\r\n\r\n        this.aStartAngle = aStartAngle;\r\n        this.aEndAngle = aEndAngle;\r\n\r\n        this.aClockwise = aClockwise;\r\n\r\n        this.aRotation = aRotation;\r\n    }\r\n\r\n    getResolution(divisions: number): number\r\n    {\r\n        return divisions * 2;\r\n    }\r\n\r\n    getPoint(t: number, optionalTarget = new Vector2())\r\n    {\r\n        const point = optionalTarget;\r\n\r\n        const twoPi = Math.PI * 2;\r\n        let deltaAngle = this.aEndAngle - this.aStartAngle;\r\n        const samePoints = Math.abs(deltaAngle) < Number.EPSILON;\r\n\r\n        // ensures that deltaAngle is 0 .. 2 PI\r\n        while (deltaAngle < 0) deltaAngle += twoPi;\r\n        while (deltaAngle > twoPi) deltaAngle -= twoPi;\r\n\r\n        if (deltaAngle < Number.EPSILON)\r\n        {\r\n            if (samePoints)\r\n            {\r\n                deltaAngle = 0;\r\n            }\r\n            else\r\n            {\r\n                deltaAngle = twoPi;\r\n            }\r\n        }\r\n\r\n        if (this.aClockwise === true && !samePoints)\r\n        {\r\n            if (deltaAngle === twoPi)\r\n            {\r\n                deltaAngle = -twoPi;\r\n            }\r\n            else\r\n            {\r\n                deltaAngle = deltaAngle - twoPi;\r\n            }\r\n        }\r\n\r\n        const angle = this.aStartAngle + (t * deltaAngle);\r\n        let x = this.aX + (this.xRadius * Math.cos(angle));\r\n        let y = this.aY + (this.yRadius * Math.sin(angle));\r\n\r\n        if (this.aRotation !== 0)\r\n        {\r\n            const cos = Math.cos(this.aRotation);\r\n            const sin = Math.sin(this.aRotation);\r\n\r\n            const tx = x - this.aX;\r\n            const ty = y - this.aY;\r\n\r\n            // Rotate the point about the center of the ellipse.\r\n            x = (tx * cos) - (ty * sin) + this.aX;\r\n            y = (tx * sin) + (ty * cos) + this.aY;\r\n        }\r\n        point.set(x, y);\r\n\r\n        return point;\r\n    }\r\n}\r\n\r\n","import { Vector2 } from '../../geom/Vector2';\r\nimport { Curve } from '../core/Curve';\r\nimport { Interpolations } from '../core/Interpolations';\r\n\r\nexport class QuadraticBezierCurve2 extends Curve<Vector2>\r\n{\r\n    v0: Vector2;\r\n    v1: Vector2;\r\n    v2: Vector2;\r\n\r\n    constructor(v0 = new Vector2(), v1 = new Vector2(), v2 = new Vector2())\r\n    {\r\n        super();\r\n\r\n        this.v0 = v0;\r\n        this.v1 = v1;\r\n        this.v2 = v2;\r\n    }\r\n\r\n    getPoint(t: number, optionalTarget = new Vector2())\r\n    {\r\n        const point = optionalTarget;\r\n        const v0 = this.v0;\r\n        const v1 = this.v1;\r\n        const v2 = this.v2;\r\n\r\n        point.set(\r\n            Interpolations.QuadraticBezier(t, v0.x, v1.x, v2.x),\r\n            Interpolations.QuadraticBezier(t, v0.y, v1.y, v2.y)\r\n        );\r\n\r\n        return point;\r\n    }\r\n}\r\n","import { Vector2 } from '../../geom/Vector2';\r\nimport { Curve } from '../core/Curve';\r\nimport { Interpolations } from '../core/Interpolations';\r\n\r\nexport class SplineCurve2 extends Curve<Vector2>\r\n{\r\n    points: Vector2[];\r\n\r\n    constructor(points: Vector2[] = [])\r\n    {\r\n        super();\r\n        this.points = points;\r\n    }\r\n\r\n    getResolution(divisions: number): number\r\n    {\r\n        return divisions * this.points.length;\r\n    }\r\n\r\n    getPoint(t: number, optionalTarget: Vector2)\r\n    {\r\n        const point = optionalTarget || new Vector2();\r\n\r\n        const points = this.points;\r\n        const p = (points.length - 1) * t;\r\n\r\n        const intPoint = Math.floor(p);\r\n        const weight = p - intPoint;\r\n\r\n        const p0 = points[intPoint === 0 ? intPoint : intPoint - 1];\r\n        const p1 = points[intPoint];\r\n        const p2 = points[intPoint > points.length - 2 ? points.length - 1 : intPoint + 1];\r\n        const p3 = points[intPoint > points.length - 3 ? points.length - 1 : intPoint + 2];\r\n\r\n        point.set(\r\n            Interpolations.CatmullRom(weight, p0.x, p1.x, p2.x, p3.x),\r\n            Interpolations.CatmullRom(weight, p0.y, p1.y, p2.y, p3.y)\r\n        );\r\n\r\n        return point;\r\n    }\r\n}\r\n","import { Vector2 } from '../../geom/Vector2';\r\nimport { CubicBezierCurve2 } from '../curves/CubicBezierCurve2';\r\nimport { EllipseCurve2 } from '../curves/EllipseCurve2';\r\nimport { LineCurve2 } from '../curves/LineCurve2';\r\nimport { QuadraticBezierCurve2 } from '../curves/QuadraticBezierCurve2';\r\nimport { SplineCurve2 } from '../curves/SplineCurve2';\r\nimport { CurvePath } from './CurvePath';\r\n\r\nexport class Path2 extends CurvePath<Vector2>\r\n{\r\n    currentPoint: Vector2;\r\n\r\n    constructor(points?: Vector2[])\r\n    {\r\n        super();\r\n        this.currentPoint = new Vector2();\r\n        if (points)\r\n        {\r\n            this.fromPoints(points);\r\n        }\r\n    }\r\n\r\n    fromPoints(points: Vector2[])\r\n    {\r\n        this.moveTo(points[0].x, points[0].y);\r\n        for (let i = 1, l = points.length; i < l; i++)\r\n        {\r\n            this.lineTo(points[i].x, points[i].y);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    moveTo(x: number, y: number)\r\n    {\r\n        this.currentPoint.set(x, y); // TODO consider referencing vectors instead of copying?\r\n\r\n        return this;\r\n    }\r\n\r\n    lineTo(x: number, y: number)\r\n    {\r\n        const curve = new LineCurve2(this.currentPoint.clone(), new Vector2(x, y));\r\n\r\n        this.curves.push(curve);\r\n\r\n        this.currentPoint.set(x, y);\r\n\r\n        return this;\r\n    }\r\n\r\n    quadraticCurveTo(aCPx: number, aCPy: number, aX: number, aY: number)\r\n    {\r\n        const curve = new QuadraticBezierCurve2(\r\n            this.currentPoint.clone(),\r\n            new Vector2(aCPx, aCPy),\r\n            new Vector2(aX, aY)\r\n        );\r\n\r\n        this.curves.push(curve);\r\n\r\n        this.currentPoint.set(aX, aY);\r\n\r\n        return this;\r\n    }\r\n\r\n    bezierCurveTo(aCP1x: number, aCP1y: number, aCP2x: number, aCP2y: number, aX: number, aY: number)\r\n    {\r\n        const curve = new CubicBezierCurve2(\r\n            this.currentPoint.clone(),\r\n            new Vector2(aCP1x, aCP1y),\r\n            new Vector2(aCP2x, aCP2y),\r\n            new Vector2(aX, aY)\r\n        );\r\n\r\n        this.curves.push(curve);\r\n\r\n        this.currentPoint.set(aX, aY);\r\n\r\n        return this;\r\n    }\r\n\r\n    splineThru(pts: Vector2[])\r\n    {\r\n        const npts = [this.currentPoint.clone()].concat(pts);\r\n\r\n        const curve = new SplineCurve2(npts);\r\n\r\n        this.curves.push(curve);\r\n\r\n        this.currentPoint.copy(pts[pts.length - 1]);\r\n\r\n        return this;\r\n    }\r\n\r\n    arc(aX = 0, aY = 0, aRadius = 1, aStartAngle = 0, aEndAngle = 2 * Math.PI, aClockwise = false)\r\n    {\r\n        const x0 = this.currentPoint.x;\r\n        const y0 = this.currentPoint.y;\r\n\r\n        this.absarc(aX + x0, aY + y0, aRadius,\r\n            aStartAngle, aEndAngle, aClockwise);\r\n\r\n        return this;\r\n    }\r\n\r\n    absarc(aX = 0, aY = 0, aRadius = 1, aStartAngle = 0, aEndAngle = 2 * Math.PI, aClockwise = false)\r\n    {\r\n        this.absellipse(aX, aY, aRadius, aRadius, aStartAngle, aEndAngle, aClockwise);\r\n\r\n        return this;\r\n    }\r\n\r\n    ellipse(aX = 0, aY = 0, xRadius = 1, yRadius = 1, aStartAngle = 0, aEndAngle = 2 * Math.PI, aClockwise = false, aRotation = 0)\r\n    {\r\n        const x0 = this.currentPoint.x;\r\n        const y0 = this.currentPoint.y;\r\n\r\n        this.absellipse(aX + x0, aY + y0, xRadius, yRadius, aStartAngle, aEndAngle, aClockwise, aRotation);\r\n\r\n        return this;\r\n    }\r\n\r\n    absellipse(aX = 0, aY = 0, xRadius = 1, yRadius = 1, aStartAngle = 0, aEndAngle = 2 * Math.PI, aClockwise = false, aRotation = 0)\r\n    {\r\n        const curve = new EllipseCurve2(aX, aY, xRadius, yRadius, aStartAngle, aEndAngle, aClockwise, aRotation);\r\n\r\n        if (this.curves.length > 0)\r\n        {\r\n            // if a previous curve is present, attempt to join\r\n            const firstPoint = curve.getPoint(0);\r\n\r\n            if (!firstPoint.equals(this.currentPoint))\r\n            {\r\n                this.lineTo(firstPoint.x, firstPoint.y);\r\n            }\r\n        }\r\n\r\n        this.curves.push(curve);\r\n\r\n        const lastPoint = curve.getPoint(1);\r\n\r\n        this.currentPoint.copy(lastPoint);\r\n\r\n        return this;\r\n    }\r\n}\r\n","import { Vector2 } from '../../geom/Vector2';\r\nimport { Earcut } from '../Earcut';\r\nimport { Path2 } from './Path2';\r\n\r\nexport class Shape2 extends Path2\r\n{\r\n    holes: Path2[];\r\n\r\n    constructor(points?: Vector2[])\r\n    {\r\n        super(points);\r\n\r\n        this.holes = [];\r\n    }\r\n\r\n    getPointsHoles(divisions: number)\r\n    {\r\n        const holesPts: Vector2[][] = [];\r\n\r\n        for (let i = 0, l = this.holes.length; i < l; i++)\r\n        {\r\n            holesPts[i] = this.holes[i].getPoints(divisions);\r\n        }\r\n\r\n        return holesPts;\r\n    }\r\n\r\n    // get points of shape and holes (keypoints based on segments parameter)\r\n    extractPoints(divisions: number)\r\n    {\r\n        return {\r\n            shape: this.getPoints(divisions),\r\n            holes: this.getPointsHoles(divisions)\r\n        };\r\n    }\r\n\r\n    extractArray(divisions?: number)\r\n    {\r\n        const result = this.extractPoints(divisions);\r\n        //\r\n        const points = result.shape.reduce((pv: number[], cv) =>\r\n        {\r\n            pv.push(cv.x, cv.y);\r\n\r\n            return pv;\r\n        }, []);\r\n        const holes = result.holes.reduce((pv: number[][], cv) =>\r\n        {\r\n            const arr = cv.reduce((pv1: number[], cv1) =>\r\n            {\r\n                pv1.push(cv1.x, cv1.y);\r\n\r\n                return pv1;\r\n            }, []);\r\n\r\n            pv.push(arr);\r\n\r\n            return pv;\r\n        }, []);\r\n\r\n        return { points, holes };\r\n    }\r\n\r\n    triangulate(geometry: { points: number[], indices: number[] } = { points: [], indices: [] })\r\n    {\r\n        const result = this.extractArray();\r\n        //\r\n\r\n        Shape2.triangulate(result.points, result.holes, geometry);\r\n\r\n        return geometry;\r\n    }\r\n\r\n    static triangulate(points: number[], holes: number[][] = [], geometry: { points: number[], indices: number[] } = { points: [], indices: [] })\r\n    {\r\n        const verts = geometry.points;\r\n        const indices = geometry.indices;\r\n\r\n        if (points.length >= 6)\r\n        {\r\n            const holeArray: number[] = [];\r\n            // Process holes..\r\n\r\n            for (let i = 0; i < holes.length; i++)\r\n            {\r\n                const hole = holes[i];\r\n\r\n                holeArray.push(points.length / 2);\r\n                points = points.concat(hole);\r\n            }\r\n\r\n            // sort color\r\n            const triangles = Earcut.triangulate(points, holeArray, 2);\r\n\r\n            if (!triangles)\r\n            {\r\n                return;\r\n            }\r\n\r\n            const vertPos = verts.length / 2;\r\n\r\n            for (let i = 0; i < triangles.length; i += 3)\r\n            {\r\n                indices.push(triangles[i] + vertPos);\r\n                indices.push(triangles[i + 1] + vertPos);\r\n                indices.push(triangles[i + 2] + vertPos);\r\n            }\r\n\r\n            for (let i = 0; i < points.length; i++)\r\n            {\r\n                verts.push(points[i]);\r\n            }\r\n        }\r\n\r\n        return geometry;\r\n    }\r\n}\r\n","import { Color4 } from '../../Color4';\r\nimport { Vector2 } from '../../geom/Vector2';\r\nimport { ShapeUtils } from '../ShapeUtils';\r\nimport { Path2 } from './Path2';\r\nimport { Shape2 } from './Shape2';\r\n\r\nexport class ShapePath2\r\n{\r\n    color = new Color4();\r\n    subPaths: Path2[] = [];\r\n    currentPath: Path2;\r\n\r\n    constructor()\r\n    {\r\n        this.subPaths = [];\r\n        this.currentPath = null;\r\n    }\r\n\r\n    moveTo(x: number, y: number)\r\n    {\r\n        this.currentPath = new Path2();\r\n        this.subPaths.push(this.currentPath);\r\n        this.currentPath.moveTo(x, y);\r\n\r\n        return this;\r\n    }\r\n\r\n    lineTo(x: number, y: number)\r\n    {\r\n        this.currentPath.lineTo(x, y);\r\n\r\n        return this;\r\n    }\r\n\r\n    quadraticCurveTo(aCPx: number, aCPy: number, aX: number, aY: number)\r\n    {\r\n        this.currentPath.quadraticCurveTo(aCPx, aCPy, aX, aY);\r\n\r\n        return this;\r\n    }\r\n\r\n    bezierCurveTo(aCP1x: number, aCP1y: number, aCP2x: number, aCP2y: number, aX: number, aY: number)\r\n    {\r\n        this.currentPath.bezierCurveTo(aCP1x, aCP1y, aCP2x, aCP2y, aX, aY);\r\n\r\n        return this;\r\n    }\r\n\r\n    splineThru(pts: Vector2[])\r\n    {\r\n        this.currentPath.splineThru(pts);\r\n\r\n        return this;\r\n    }\r\n\r\n    closePath()\r\n    {\r\n        this.currentPath.closePath();\r\n    }\r\n\r\n    toShapes(isCCW = false, noHoles = false)\r\n    {\r\n        /**\r\n         * 转换没有孔的路径为形状\r\n         *\r\n         * @param inSubpaths\r\n         */\r\n        function toShapesNoHoles(inSubpaths: Path2[])\r\n        {\r\n            const shapes: Shape2[] = [];\r\n\r\n            for (let i = 0, l = inSubpaths.length; i < l; i++)\r\n            {\r\n                const tmpPath = inSubpaths[i];\r\n\r\n                const tmpShape = new Shape2();\r\n\r\n                tmpShape.curves = tmpPath.curves;\r\n\r\n                shapes.push(tmpShape);\r\n            }\r\n\r\n            return shapes;\r\n        }\r\n\r\n        /**\r\n         * 判断点是否在多边形内\r\n         * @param inPt\r\n         * @param inPolygon\r\n         */\r\n        function isPointInsidePolygon(inPt: Vector2, inPolygon: Vector2[])\r\n        {\r\n            const polyLen = inPolygon.length;\r\n\r\n            // inPt on polygon contour => immediate success    or\r\n            // toggling of inside/outside at every single! intersection point of an edge\r\n            //  with the horizontal line through inPt, left of inPt\r\n            //  not counting lowerY endpoints of edges and whole edges on that line\r\n            let inside = false;\r\n\r\n            for (let p = polyLen - 1, q = 0; q < polyLen; p = q++)\r\n            {\r\n                let edgeLowPt = inPolygon[p];\r\n                let edgeHighPt = inPolygon[q];\r\n\r\n                let edgeDx = edgeHighPt.x - edgeLowPt.x;\r\n                let edgeDy = edgeHighPt.y - edgeLowPt.y;\r\n\r\n                if (Math.abs(edgeDy) > Number.EPSILON)\r\n                {\r\n                    // not parallel\r\n                    if (edgeDy < 0)\r\n                    {\r\n                        edgeLowPt = inPolygon[q]; edgeDx = -edgeDx;\r\n                        edgeHighPt = inPolygon[p]; edgeDy = -edgeDy;\r\n                    }\r\n\r\n                    if ((inPt.y < edgeLowPt.y) || (inPt.y > edgeHighPt.y)) continue;\r\n\r\n                    if (inPt.y === edgeLowPt.y)\r\n                    {\r\n                        if (inPt.x === edgeLowPt.x) return true; // inPt is on contour ?\r\n                        // continue;                // no intersection or edgeLowPt => doesn't count !!!\r\n                    }\r\n                    else\r\n                    {\r\n                        const perpEdge = (edgeDy * (inPt.x - edgeLowPt.x)) - (edgeDx * (inPt.y - edgeLowPt.y));\r\n\r\n                        if (perpEdge === 0) return true; // inPt is on contour ?\r\n                        if (perpEdge < 0) continue;\r\n                        inside = !inside; // true intersection left of inPt\r\n                    }\r\n                }\r\n                else\r\n                {\r\n                    // parallel or collinear\r\n                    if (inPt.y !== edgeLowPt.y) continue; // parallel\r\n                    // edge lies on the same horizontal line as inPt\r\n                    if (((edgeHighPt.x <= inPt.x) && (inPt.x <= edgeLowPt.x))\r\n                        || ((edgeLowPt.x <= inPt.x) && (inPt.x <= edgeHighPt.x))) return true; // inPt: Point on contour !\r\n                    // continue;\r\n                }\r\n            }\r\n\r\n            return inside;\r\n        }\r\n\r\n        const subPaths = this.subPaths;\r\n\r\n        if (subPaths.length === 0) return [];\r\n\r\n        // 处理无孔形状\r\n        if (noHoles === true) return toShapesNoHoles(subPaths);\r\n\r\n        let solid: boolean;\r\n        let tmpPath: Path2;\r\n        let tmpShape: Shape2;\r\n        const shapes: Shape2[] = [];\r\n\r\n        if (subPaths.length === 1)\r\n        {\r\n            tmpPath = subPaths[0];\r\n            tmpShape = new Shape2();\r\n            tmpShape.curves = tmpPath.curves;\r\n            shapes.push(tmpShape);\r\n\r\n            return shapes;\r\n        }\r\n\r\n        // 第一个是否为空\r\n        let holesFirst = !ShapeUtils.isClockWise(subPaths[0].getPoints());\r\n\r\n        if (isCCW)// 判断是否为孔\r\n        {\r\n            holesFirst = !holesFirst;\r\n        }\r\n\r\n        // console.log(\"Holes first\", holesFirst);\r\n\r\n        const betterShapeHoles: { h: Path2, p: Vector2 }[][] = [];\r\n        const newShapes: { s: Shape2, p: Vector2[] }[] = [];\r\n        let newShapeHoles: { h: Path2, p: Vector2 }[][] = [];\r\n        let mainIdx = 0;\r\n        let tmpPoints: Vector2[];\r\n\r\n        newShapes[mainIdx] = undefined;\r\n        newShapeHoles[mainIdx] = [];\r\n\r\n        for (let i = 0, l = subPaths.length; i < l; i++)\r\n        {\r\n            tmpPath = subPaths[i];\r\n            tmpPoints = tmpPath.getPoints();\r\n            solid = ShapeUtils.isClockWise(tmpPoints);\r\n            if (isCCW)// 判断是否为实线\r\n            {\r\n                solid = !solid;\r\n            }\r\n\r\n            if (solid)\r\n            {\r\n                if ((!holesFirst) && (newShapes[mainIdx])) mainIdx++;\r\n\r\n                newShapes[mainIdx] = { s: new Shape2(), p: tmpPoints };\r\n                newShapes[mainIdx].s.curves = tmpPath.curves;\r\n\r\n                if (holesFirst) mainIdx++;\r\n                newShapeHoles[mainIdx] = [];\r\n                // console.log('cw', i);\r\n            }\r\n            else\r\n            {\r\n                newShapeHoles[mainIdx].push({ h: tmpPath, p: tmpPoints[0] });\r\n                // console.log('ccw', i);\r\n            }\r\n        }\r\n\r\n        // only Holes? -> probably all Shapes with wrong orientation\r\n        if (!newShapes[0]) return toShapesNoHoles(subPaths);\r\n\r\n        if (newShapes.length > 1)\r\n        {\r\n            let ambiguous = false;\r\n            const toChange = [];\r\n\r\n            for (let sIdx = 0, sLen = newShapes.length; sIdx < sLen; sIdx++)\r\n            {\r\n                betterShapeHoles[sIdx] = [];\r\n            }\r\n\r\n            for (let sIdx = 0, sLen = newShapes.length; sIdx < sLen; sIdx++)\r\n            {\r\n                const sho = newShapeHoles[sIdx];\r\n\r\n                for (let hIdx = 0; hIdx < sho.length; hIdx++)\r\n                {\r\n                    const ho = sho[hIdx];\r\n                    let holeUnassigned = true;\r\n\r\n                    for (let s2Idx = 0; s2Idx < newShapes.length; s2Idx++)\r\n                    {\r\n                        if (isPointInsidePolygon(ho.p, newShapes[s2Idx].p))\r\n                        {\r\n                            if (sIdx !== s2Idx) toChange.push({ froms: sIdx, tos: s2Idx, hole: hIdx });\r\n                            if (holeUnassigned)\r\n                            {\r\n                                holeUnassigned = false;\r\n                                betterShapeHoles[s2Idx].push(ho);\r\n                            }\r\n                            else\r\n                            {\r\n                                ambiguous = true;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if (holeUnassigned)\r\n                    {\r\n                        betterShapeHoles[sIdx].push(ho);\r\n                    }\r\n                }\r\n            }\r\n            // console.log(\"ambiguous: \", ambiguous);\r\n\r\n            if (toChange.length > 0)\r\n            {\r\n                // console.log(\"to change: \", toChange);\r\n                if (!ambiguous) newShapeHoles = betterShapeHoles;\r\n            }\r\n        }\r\n\r\n        let tmpHoles: { h: Path2; p: Vector2; }[];\r\n\r\n        for (let i = 0, il = newShapes.length; i < il; i++)\r\n        {\r\n            tmpShape = newShapes[i].s;\r\n            shapes.push(tmpShape);\r\n            tmpHoles = newShapeHoles[i];\r\n\r\n            for (let j = 0, jl = tmpHoles.length; j < jl; j++)\r\n            {\r\n                tmpShape.holes.push(tmpHoles[j].h);\r\n            }\r\n        }\r\n\r\n        // console.log(\"shape\", shapes);\r\n        return shapes;\r\n    }\r\n}\r\n","import { Shape2 } from './Shape2';\r\nimport { ShapePath2 } from './ShapePath2';\r\n\r\nexport class Font\r\n{\r\n    data: FontData;\r\n    isCCW = false;\r\n    private charGeometryCache: {\r\n        [char: string]: {\r\n            geometry: {\r\n                points: number[];\r\n                indices: number[];\r\n            };\r\n            width: number;\r\n        }\r\n    } = {};\r\n\r\n    constructor(data: FontData)\r\n    {\r\n        this.data = data;\r\n    }\r\n\r\n    generateShapes(text: string, size: number, lineHeight?: number, align: 'left' | 'center' | 'right' = 'left'): Shape2[]\r\n    {\r\n        if (size === undefined)\r\n        {\r\n            size = 100;\r\n        }\r\n        if (lineHeight === undefined)\r\n        {\r\n            lineHeight = size * 1.25;\r\n        }\r\n\r\n        const shapes: Shape2[] = [];\r\n        const paths = createPaths(text, size, lineHeight, this.data, align);\r\n\r\n        for (let p = 0, pl = paths.length; p < pl; p++)\r\n        {\r\n            const pathShapes = paths[p].toShapes(this.isCCW);\r\n\r\n            for (let i = 0, il = pathShapes.length; i < il; i++)\r\n            {\r\n                shapes.push(pathShapes[i]);\r\n            }\r\n        }\r\n\r\n        return shapes;\r\n    }\r\n\r\n    generateCharGeometry(char: string, geometry: { points: number[], indices: number[] } = { points: [], indices: [] })\r\n    {\r\n        if (this.charGeometryCache[char])\r\n        {\r\n            return this.charGeometryCache[char];\r\n        }\r\n        const { path, offsetX } = createPath(char, 1, 0, 0, this.data);\r\n        const shapes = path.toShapes(this.isCCW);\r\n\r\n        for (let i = 0, n = shapes.length; i < n; i++)\r\n        {\r\n            shapes[i].triangulate(geometry);\r\n        }\r\n\r\n        this.charGeometryCache[char] = { geometry, width: offsetX };\r\n\r\n        return this.charGeometryCache[char];\r\n    }\r\n\r\n    calculateGeometry(text: string, fontSize: number, lineHeight?: number, align: 'left' | 'center' | 'right' = 'left', textBaseline: 'alphabetic' | 'top' | 'middle' | 'bottom' = 'alphabetic', tabCharWidth = 128)\r\n    {\r\n        if (lineHeight === undefined)\r\n        {\r\n            lineHeight = fontSize * 1.25;\r\n        }\r\n        lineHeight = lineHeight / fontSize * this.data.unitsPerEm;\r\n\r\n        const textInfo = calculateTextInfo(this, text, tabCharWidth);\r\n        const { vertices, indices } = calculateTextStyle(textInfo, fontSize, lineHeight, align, textBaseline);\r\n        const { normals, uvs } = calculateNormalUV(vertices);\r\n\r\n        return { vertices, normals, uvs, indices };\r\n    }\r\n}\r\n\r\nfunction createPaths(text: string, size: number, lineHeight: number, data: FontData, align: 'left' | 'center' | 'right' = 'left'): ShapePath2[]\r\n{\r\n    const scale = size / data.unitsPerEm;\r\n    const paths: ShapePath2[] = [];\r\n    let offsetX = 0;\r\n    let offsetY = 0;\r\n\r\n    const lines = text.split('\\n');\r\n\r\n    const lineWidths: number[] = [];\r\n    let maxLineWidth = 0;\r\n\r\n    for (let i = 0, ni = lines.length; i < ni; i++)\r\n    {\r\n        const lineStr = lines[i];\r\n\r\n        if (i > 0)\r\n        {\r\n            offsetX = 0;\r\n        }\r\n        const chars = Array.from ? Array.from(lineStr) : String(lineStr).split(''); // see #13988\r\n\r\n        for (let j = 0, nj = chars.length; j < nj; j++)\r\n        {\r\n            const char = chars[j];\r\n\r\n            if (char.charCodeAt(0) === 9)\r\n            {\r\n                offsetX += 20;\r\n            }\r\n            else\r\n            {\r\n                const glyph = data.glyphs[char] || data.glyphs['?'];\r\n\r\n                if (glyph)\r\n                {\r\n                    offsetX += glyph.ha * scale;\r\n                }\r\n            }\r\n        }\r\n        lineWidths[i] = offsetX;\r\n        maxLineWidth = Math.max(maxLineWidth, offsetX);\r\n    }\r\n\r\n    for (let i = 0, ni = lines.length; i < ni; i++)\r\n    {\r\n        const lineStr = lines[i];\r\n\r\n        offsetX = 0;\r\n        offsetY = -lineHeight * i;\r\n        if (align === 'center')\r\n        {\r\n            offsetX = (maxLineWidth - lineWidths[i]) / 2;\r\n        }\r\n        else if (align === 'right')\r\n        {\r\n            offsetX = maxLineWidth - lineWidths[i];\r\n        }\r\n\r\n        const chars = Array.from ? Array.from(lineStr) : String(lineStr).split(''); // see #13988\r\n\r\n        for (let j = 0, nj = chars.length; j < nj; j++)\r\n        {\r\n            const char = chars[j];\r\n\r\n            if (char.charCodeAt(0) === 9)\r\n            {\r\n                offsetX += 20;\r\n            }\r\n            else\r\n            {\r\n                const ret = createPath(char, scale, offsetX, offsetY, data);\r\n\r\n                offsetX += ret.offsetX;\r\n                paths.push(ret.path);\r\n            }\r\n        }\r\n    }\r\n\r\n    return paths;\r\n}\r\n\r\nfunction createPath(char: string, scale: number, offsetX: number, offsetY: number, data: FontData)\r\n{\r\n    const glyph = data.glyphs[char] || data.glyphs['?'];\r\n\r\n    if (!glyph)\r\n    {\r\n        console.error(`    Font: character \"${char}\" does not exists in font family ${data.familyName}.`);\r\n\r\n        return;\r\n    }\r\n\r\n    const path = new ShapePath2();\r\n\r\n    let x: number;\r\n    let y: number;\r\n    let cpx: number;\r\n    let cpy: number;\r\n    let cpx1: number;\r\n    let cpy1: number;\r\n    let cpx2: number;\r\n    let cpy2: number;\r\n\r\n    if (glyph.o)\r\n    {\r\n        const outline = glyph._cachedOutline || (glyph._cachedOutline = glyph.o.split(' '));\r\n\r\n        for (let i = 0, l = outline.length; i < l;)\r\n        {\r\n            const action = outline[i++];\r\n\r\n            switch (action)\r\n            {\r\n                case 'm': // moveTo\r\n                    x = (outline[i++] * scale) + offsetX;\r\n                    y = (outline[i++] * scale) + offsetY;\r\n                    path.moveTo(x, y);\r\n                    break;\r\n                case 'l': // lineTo\r\n                    x = (outline[i++] * scale) + offsetX;\r\n                    y = (outline[i++] * scale) + offsetY;\r\n                    path.lineTo(x, y);\r\n                    break;\r\n                case 'q': // quadraticCurveTo\r\n                    cpx = (outline[i++] * scale) + offsetX;\r\n                    cpy = (outline[i++] * scale) + offsetY;\r\n                    cpx1 = (outline[i++] * scale) + offsetX;\r\n                    cpy1 = (outline[i++] * scale) + offsetY;\r\n                    path.quadraticCurveTo(cpx1, cpy1, cpx, cpy);\r\n                    break;\r\n                case 'b': // bezierCurveTo\r\n                    cpx = (outline[i++] * scale) + offsetX;\r\n                    cpy = (outline[i++] * scale) + offsetY;\r\n                    cpx1 = (outline[i++] * scale) + offsetX;\r\n                    cpy1 = (outline[i++] * scale) + offsetY;\r\n                    cpx2 = (outline[i++] * scale) + offsetX;\r\n                    cpy2 = (outline[i++] * scale) + offsetY;\r\n                    path.bezierCurveTo(cpx1, cpy1, cpx2, cpy2, cpx, cpy);\r\n                    break;\r\n                case 'z':\r\n                    path.closePath();\r\n                    break;\r\n                default:\r\n                    console.assert(action.trim() === '');\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    return { offsetX: glyph.ha * scale, path };\r\n}\r\n\r\nexport interface Glyph\r\n{\r\n    ha: number,\r\n    // eslint-disable-next-line camelcase\r\n    x_min: number,\r\n    // eslint-disable-next-line camelcase\r\n    x_max: number,\r\n    o: string,\r\n    _cachedOutline?: any[]\r\n}\r\n\r\ninterface FontData\r\n{\r\n    glyphs: { [index: string]: Glyph },\r\n    unitsPerEm: number,\r\n    ascender: number,\r\n    descender: number,\r\n    underlinePosition: number,\r\n    underlineThickness: number,\r\n    familyName: string,\r\n    boundingBox: {\r\n        yMin: number,\r\n        xMin: number,\r\n        yMax: number,\r\n        xMax: number,\r\n    }\r\n}\r\n\r\nfunction calculateTextInfo(font: Font, text: string, tabCharWidth: number)\r\n{\r\n    const textInfo: TextInfo = { text, font, width: 0, numVertices: 0, numIndices: 0, lines: [] };\r\n    //\r\n    const lines = text.split('\\n');\r\n\r\n    for (let i = 0, ni = lines.length; i < ni; i++)\r\n    {\r\n        textInfo.lines[i] = { text: lines[i], width: 0, numVertices: 0, numIndices: 0, chars: [] };\r\n        const lineItem = textInfo.lines[i];\r\n\r\n        if (i > 0)\r\n        {\r\n            lineItem.width = 0;\r\n        }\r\n        const chars = Array.from ? Array.from(lineItem.text) : String(lineItem.text).split(''); // see #13988\r\n\r\n        for (let j = 0, nj = chars.length; j < nj; j++)\r\n        {\r\n            const char = chars[j];\r\n\r\n            if (char === '\\t')\r\n            {\r\n                lineItem.width += tabCharWidth;\r\n            }\r\n            else\r\n            {\r\n                const charVertices = font.generateCharGeometry(char);\r\n                const charItem = lineItem.chars[j] = {\r\n                    text: char,\r\n                    width: charVertices.width,\r\n                    offsetX: lineItem.width,\r\n                    offsetVertices: textInfo.numVertices,\r\n                    offsetIndices: textInfo.numIndices,\r\n                    numVertices: charVertices.geometry.points.length,\r\n                    numIndices: charVertices.geometry.indices.length,\r\n                    geometry: charVertices.geometry,\r\n                };\r\n\r\n                lineItem.width += charItem.width;\r\n                lineItem.numVertices += charItem.numVertices;\r\n                lineItem.numIndices += charItem.numIndices;\r\n                textInfo.numVertices += charItem.numVertices;\r\n                textInfo.numIndices += charItem.numIndices;\r\n            }\r\n        }\r\n        textInfo.width = Math.max(textInfo.width, lineItem.width);\r\n    }\r\n\r\n    return textInfo;\r\n}\r\n\r\nfunction calculateTextStyle(textInfo: TextInfo, fontSize: number, lineHeight: number, align: string, textBaseline: string)\r\n{\r\n    const { unitsPerEm, ascender, descender } = textInfo.font.data;\r\n    const scale = fontSize / unitsPerEm;\r\n    const vertices = new Float32Array(textInfo.numVertices / 2 * 3);\r\n    const indices = new Uint32Array(textInfo.numIndices);\r\n\r\n    let baselineOffsetY = 0;\r\n\r\n    if (textBaseline === 'top')\r\n    {\r\n        baselineOffsetY = ascender;\r\n    }\r\n    else if (textBaseline === 'bottom')\r\n    {\r\n        baselineOffsetY = descender;\r\n    }\r\n    else if (textBaseline === 'middle')\r\n    {\r\n        baselineOffsetY = (ascender + descender) / 2;\r\n    }\r\n    else if (textBaseline === 'alphabetic')\r\n    {\r\n        baselineOffsetY = 0;\r\n    }\r\n\r\n    //\r\n    const { lines, width: maxLineWidth } = textInfo;\r\n\r\n    for (let i = 0, ni = lines.length; i < ni; i++)\r\n    {\r\n        const { width: lineWidth, chars } = lines[i];\r\n        let alignOffsetX = 0;\r\n        const offsetY = -lineHeight * i;\r\n\r\n        if (align === 'center')\r\n        {\r\n            alignOffsetX = (maxLineWidth - lineWidth) / 2;\r\n        }\r\n        else if (align === 'right')\r\n        {\r\n            alignOffsetX = maxLineWidth - lineWidth;\r\n        }\r\n\r\n        for (let j = 0, nj = chars.length; j < nj; j++)\r\n        {\r\n            const charItem = chars[j];\r\n\r\n            if (!charItem)\r\n            {\r\n                continue;\r\n            }\r\n            const { offsetX: charOffsetX, offsetVertices, offsetIndices, geometry } = charItem;\r\n\r\n            updateCharGeometry({\r\n                offsetX: alignOffsetX + charOffsetX, offsetY: offsetY - baselineOffsetY, scale,\r\n                targetVertices: vertices, targetIndices: indices,\r\n                offsetVertices, offsetIndices,\r\n                sourceVertices: geometry.points, sourceIndices: geometry.indices\r\n            });\r\n        }\r\n    }\r\n\r\n    return { vertices, indices };\r\n\r\n    function updateCharGeometry({\r\n        offsetX, offsetY, scale,\r\n        targetVertices, targetIndices,\r\n        offsetVertices, offsetIndices,\r\n        sourceVertices, sourceIndices,\r\n    }: {\r\n        offsetX: number, offsetY: number, scale: number,\r\n        targetVertices: Float32Array, targetIndices: Uint32Array,\r\n        offsetVertices: number, offsetIndices: number,\r\n        sourceVertices: number[], sourceIndices: number[],\r\n    })\r\n    {\r\n        let offsetVertices3 = offsetVertices / 2 * 3;\r\n        let offsetVertices2 = 0;\r\n\r\n        for (let i = 0, n = sourceVertices.length / 2; i < n; i++)\r\n        {\r\n            targetVertices[offsetVertices3++] = (sourceVertices[offsetVertices2++] + offsetX) * scale;\r\n            targetVertices[offsetVertices3++] = -(sourceVertices[offsetVertices2++] + offsetY) * scale;\r\n            targetVertices[offsetVertices3++] = 0;\r\n        }\r\n\r\n        const offsetVerticesIndex = offsetVertices / 2;\r\n\r\n        for (let i = 0, n = sourceIndices.length; i < n; i++)\r\n        {\r\n            targetIndices[offsetIndices + i] = sourceIndices[i] + offsetVerticesIndex;\r\n        }\r\n    }\r\n}\r\n\r\nfunction calculateNormalUV(vertices: Float32Array)\r\n{\r\n    const normals = new Float32Array(vertices.length);\r\n    const uvs = new Float32Array(vertices.length / 3 * 2);\r\n    let verticesIndex = 0;\r\n    let normalsIndex = 0;\r\n    let uvsIndex = 0;\r\n\r\n    for (let i = 0, n = vertices.length / 3; i < n; i++)\r\n    {\r\n        uvs[uvsIndex++] = vertices[verticesIndex++];\r\n        uvs[uvsIndex++] = vertices[verticesIndex++];\r\n        verticesIndex++;\r\n        //\r\n        normals[normalsIndex++] = 0;\r\n        normals[normalsIndex++] = 0;\r\n        normals[normalsIndex++] = 1;\r\n    }\r\n\r\n    return { normals, uvs };\r\n}\r\n\r\ninterface TextInfo\r\n{\r\n    text: string,\r\n    font: Font,\r\n    width: number,\r\n    numVertices: number,\r\n    numIndices: number,\r\n    lines: {\r\n        text: string,\r\n        width: number,\r\n        numVertices: number,\r\n        numIndices: number,\r\n        chars: {\r\n            text: string,\r\n            width: number;\r\n            offsetX: number,\r\n            offsetVertices: number,\r\n            offsetIndices: number,\r\n            numVertices: number,\r\n            numIndices: number,\r\n            geometry: {\r\n                points: number[];\r\n                indices: number[];\r\n            },\r\n        }[]\r\n    }[],\r\n}\r\n\r\n","import { EllipseCurve2 } from './EllipseCurve2';\r\n\r\nexport class ArcCurve2 extends EllipseCurve2\r\n{\r\n    constructor(aX = 0, aY = 0, aRadius = 1, aStartAngle = 0, aEndAngle = 2 * Math.PI, aClockwise = false)\r\n    {\r\n        super(aX, aY, aRadius, aRadius, aStartAngle, aEndAngle, aClockwise);\r\n    }\r\n}\r\n","/**\r\n * A GLenum specifying the intended usage pattern of the data store for optimization purposes.\r\n *\r\n * 指定数据存储区的使用方法。\r\n *\r\n * @see https://developer.mozilla.org/zh-CN/docs/Web/API/WebGLRenderingContext/bufferData\r\n */\r\nexport enum AttributeUsage\r\n{\r\n    /**\r\n     * The contents are intended to be specified once by the application, and used many times as the source for WebGL drawing and image specification commands.\r\n     *\r\n     * 内容由应用程序指定一次，并多次用作WebGL绘图和图像规范命令的源。\r\n     *\r\n     * 缓冲区的内容可能经常使用，而不会经常更改。内容被写入缓冲区，但不被读取。\r\n     */\r\n    STATIC_DRAW = 'STATIC_DRAW',\r\n    /**\r\n     * The contents are intended to be respecified repeatedly by the application, and used many times as the source for WebGL drawing and image specification commands.\r\n     *\r\n     * 这些内容将由应用程序反复重新指定，并多次用作WebGL绘图和图像规范命令的源。\r\n     */\r\n    DYNAMIC_DRAW = 'DYNAMIC_DRAW',\r\n    /**\r\n     * The contents are intended to be specified once by the application, and used at most a few times as the source for WebGL drawing and image specification commands.\r\n     *\r\n     * 内容由应用程序指定一次，最多几次用作WebGL绘图和图像规范命令的源。\r\n     */\r\n    STREAM_DRAW = 'STREAM_DRAW',\r\n}\r\n","/**\r\n * GL 数组数据类型\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\r\n */\r\nexport enum GLArrayType\r\n{\r\n    /**\r\n     * signed 8-bit integer, with values in [-128, 127]\r\n     */\r\n    BYTE = 'BYTE',\r\n    /**\r\n     *  signed 16-bit integer, with values in [-32768, 32767]\r\n     */\r\n    SHORT = 'SHORT',\r\n    /**\r\n     * unsigned 8-bit integer, with values in [0, 255]\r\n     */\r\n    UNSIGNED_BYTE = 'UNSIGNED_BYTE',\r\n    /**\r\n     * unsigned 16-bit integer, with values in [0, 65535]\r\n     */\r\n    UNSIGNED_SHORT = 'UNSIGNED_SHORT',\r\n    /**\r\n     * 32-bit floating point number\r\n     */\r\n    FLOAT = 'FLOAT',\r\n    UNSIGNED_INT = 'UNSIGNED_INT',\r\n    /**\r\n     * using a WebGL 2 context\r\n     * 16-bit floating point number\r\n     */\r\n    HALF_FLOAT = 'HALF_FLOAT',\r\n}\r\n","import { Vector3 } from '../../geom/Vector3';\r\nimport { Curve } from '../core/Curve';\r\n\r\n/**\r\n * Centripetal CatmullRom Curve - which is useful for avoiding\r\n * cusps and self-intersections in non-uniform catmull rom curves.\r\n * http://www.cemyuksel.com/research/catmullrom_param/catmullrom.pdf\r\n *\r\n * curve.type accepts centripetal(default), chordal and catmullrom\r\n * curve.tension is used for catmullrom which defaults to 0.5\r\n */\r\nexport class CatmullRomCurve3 extends Curve<Vector3>\r\n{\r\n    isCatmullRomCurve3 = true;\r\n\r\n    points: Vector3[];\r\n    closed: boolean;\r\n    curveType: string;\r\n    tension: number;\r\n\r\n    constructor(points: Vector3[] = [], closed = false, curveType = 'centripetal', tension = 0.5)\r\n    {\r\n        super();\r\n\r\n        this.points = points;\r\n        this.closed = closed;\r\n        this.curveType = curveType;\r\n        this.tension = tension;\r\n    }\r\n\r\n    getPoint(t: number, optionalTarget = new Vector3())\r\n    {\r\n        const point = optionalTarget;\r\n\r\n        const points = this.points;\r\n        const l = points.length;\r\n\r\n        const p = (l - (this.closed ? 0 : 1)) * t;\r\n        let intPoint = Math.floor(p);\r\n        let weight = p - intPoint;\r\n\r\n        if (this.closed)\r\n        {\r\n            intPoint += intPoint > 0 ? 0 : (Math.floor(Math.abs(intPoint) / l) + 1) * l;\r\n        }\r\n        else if (weight === 0 && intPoint === l - 1)\r\n        {\r\n            intPoint = l - 2;\r\n            weight = 1;\r\n        }\r\n\r\n        let p0: Vector3; let\r\n            p3: Vector3; // 4 points (p1 & p2 defined below)\r\n\r\n        if (this.closed || intPoint > 0)\r\n        {\r\n            p0 = points[(intPoint - 1) % l];\r\n        }\r\n        else\r\n        {\r\n            // extrapolate first point\r\n            tmp.copy(points[0]).sub(points[1]).add(points[0]);\r\n            p0 = tmp;\r\n        }\r\n\r\n        const p1 = points[intPoint % l];\r\n        const p2 = points[(intPoint + 1) % l];\r\n\r\n        if (this.closed || intPoint + 2 < l)\r\n        {\r\n            p3 = points[(intPoint + 2) % l];\r\n        }\r\n        else\r\n        {\r\n            // extrapolate last point\r\n            tmp.copy(points[l - 1]).sub(points[l - 2]).add(points[l - 1]);\r\n            p3 = tmp;\r\n        }\r\n\r\n        if (this.curveType === 'centripetal' || this.curveType === 'chordal')\r\n        {\r\n            // init Centripetal / Chordal Catmull-Rom\r\n            const pow = this.curveType === 'chordal' ? 0.5 : 0.25;\r\n            let dt0 = Math.pow(p0.distanceSquared(p1), pow);\r\n            let dt1 = Math.pow(p1.distanceSquared(p2), pow);\r\n            let dt2 = Math.pow(p2.distanceSquared(p3), pow);\r\n\r\n            // safety check for repeated points\r\n            if (dt1 < 1e-4) dt1 = 1.0;\r\n            if (dt0 < 1e-4) dt0 = dt1;\r\n            if (dt2 < 1e-4) dt2 = dt1;\r\n\r\n            px.initNonuniformCatmullRom(p0.x, p1.x, p2.x, p3.x, dt0, dt1, dt2);\r\n            py.initNonuniformCatmullRom(p0.y, p1.y, p2.y, p3.y, dt0, dt1, dt2);\r\n            pz.initNonuniformCatmullRom(p0.z, p1.z, p2.z, p3.z, dt0, dt1, dt2);\r\n        }\r\n        else if (this.curveType === 'catmullrom')\r\n        {\r\n            px.initCatmullRom(p0.x, p1.x, p2.x, p3.x, this.tension);\r\n            py.initCatmullRom(p0.y, p1.y, p2.y, p3.y, this.tension);\r\n            pz.initCatmullRom(p0.z, p1.z, p2.z, p3.z, this.tension);\r\n        }\r\n\r\n        point.set(\r\n            px.calc(weight),\r\n            py.calc(weight),\r\n            pz.calc(weight)\r\n        );\r\n\r\n        return point;\r\n    }\r\n}\r\n\r\n/*\r\nBased on an optimized c++ solution in\r\n - http://stackoverflow.com/questions/9489736/catmull-rom-curve-with-no-cusps-and-no-self-intersections/\r\n - http://ideone.com/NoEbVM\r\n\r\nThis CubicPoly class could be used for reusing some variables and calculations,\r\nbut for three.js curve use, it could be possible inlined and flatten into a single function call\r\nwhich can be placed in CurveUtils.\r\n*/\r\nclass CubicPoly\r\n{\r\n    c0 = 0;\r\n    c1 = 0;\r\n    c2 = 0;\r\n    c3 = 0;\r\n\r\n    /*\r\n     * Compute coefficients for a cubic polynomial\r\n     *   p(s) = c0 + c1*s + c2*s^2 + c3*s^3\r\n     * such that\r\n     *   p(0) = x0, p(1) = x1\r\n     *  and\r\n     *   p'(0) = t0, p'(1) = t1.\r\n     */\r\n    init(x0: number, x1: number, t0: number, t1: number)\r\n    {\r\n        this.c0 = x0;\r\n        this.c1 = t0;\r\n        this.c2 = (-3 * x0) + (3 * x1) - (2 * t0) - t1;\r\n        this.c3 = (2 * x0) - (2 * x1) + t0 + t1;\r\n    }\r\n\r\n    initCatmullRom(x0: number, x1: number, x2: number, x3: number, tension: number)\r\n    {\r\n        this.init(x1, x2, tension * (x2 - x0), tension * (x3 - x1));\r\n    }\r\n\r\n    initNonuniformCatmullRom(x0: number, x1: number, x2: number, x3: number, dt0: number, dt1: number, dt2: number)\r\n    {\r\n        // compute tangents when parameterized in [t1,t2]\r\n        let t1 = ((x1 - x0) / dt0) - ((x2 - x0) / (dt0 + dt1)) + ((x2 - x1) / dt1);\r\n        let t2 = ((x2 - x1) / dt1) - ((x3 - x1) / (dt1 + dt2)) + ((x3 - x2) / dt2);\r\n\r\n        // rescale tangents for parametrization in [0,1]\r\n        t1 *= dt1;\r\n        t2 *= dt1;\r\n\r\n        this.init(x1, x2, t1, t2);\r\n    }\r\n\r\n    calc(t: number)\r\n    {\r\n        const t2 = t * t;\r\n        const t3 = t2 * t;\r\n\r\n        return this.c0 + (this.c1 * t) + (this.c2 * t2) + (this.c3 * t3);\r\n    }\r\n}\r\n\r\n//\r\nconst tmp = new Vector3();\r\nconst px = new CubicPoly();\r\nconst py = new CubicPoly();\r\nconst pz = new CubicPoly();\r\n","import { Vector3 } from '../../geom/Vector3';\r\nimport { Curve } from '../core/Curve';\r\nimport { Interpolations } from '../core/Interpolations';\r\n\r\nexport class CubicBezierCurve3 extends Curve<Vector3>\r\n{\r\n    v0: Vector3;\r\n    v1: Vector3;\r\n    v2: Vector3;\r\n    v3: Vector3;\r\n\r\n    constructor(v0 = new Vector3(), v1 = new Vector3(), v2 = new Vector3(), v3 = new Vector3())\r\n    {\r\n        super();\r\n\r\n        this.v0 = v0;\r\n        this.v1 = v1;\r\n        this.v2 = v2;\r\n        this.v3 = v3;\r\n    }\r\n\r\n    getPoint(t: number, optionalTarget = new Vector3())\r\n    {\r\n        const point = optionalTarget;\r\n\r\n        const v0 = this.v0;\r\n        const v1 = this.v1;\r\n        const v2 = this.v2;\r\n        const v3 = this.v3;\r\n\r\n        point.set(\r\n            Interpolations.CubicBezier(t, v0.x, v1.x, v2.x, v3.x),\r\n            Interpolations.CubicBezier(t, v0.y, v1.y, v2.y, v3.y),\r\n            Interpolations.CubicBezier(t, v0.z, v1.z, v2.z, v3.z)\r\n        );\r\n\r\n        return point;\r\n    }\r\n}\r\n","import { Vector3 } from '../../geom/Vector3';\r\nimport { Curve } from '../core/Curve';\r\n\r\nexport class LineCurve3 extends Curve<Vector3>\r\n{\r\n    v1: Vector3;\r\n    v2: Vector3;\r\n\r\n    constructor(v1 = new Vector3(), v2 = new Vector3())\r\n    {\r\n        super();\r\n\r\n        this.v1 = v1;\r\n        this.v2 = v2;\r\n    }\r\n\r\n    getResolution(_divisions: number): number\r\n    {\r\n        return 1;\r\n    }\r\n\r\n    getPoint(t: number, optionalTarget = new Vector3())\r\n    {\r\n        const point = optionalTarget;\r\n\r\n        if (t === 1)\r\n        {\r\n            point.copy(this.v2);\r\n        }\r\n        else\r\n        {\r\n            point.copy(this.v2).sub(this.v1);\r\n            point.multiplyNumber(t).add(this.v1);\r\n        }\r\n\r\n        return point;\r\n    }\r\n\r\n    // Line curve is linear, so we can overwrite default getPointAt\r\n\r\n    getPointAt(u: number, optionalTarget = new Vector3())\r\n    {\r\n        return this.getPoint(u, optionalTarget);\r\n    }\r\n}\r\n\r\n","import { Vector3 } from '../../geom/Vector3';\r\nimport { Curve } from '../core/Curve';\r\nimport { Interpolations } from '../core/Interpolations';\r\n\r\nexport class QuadraticBezierCurve3 extends Curve<Vector3>\r\n{\r\n    v0: Vector3;\r\n    v1: Vector3;\r\n    v2: Vector3;\r\n\r\n    constructor(v0 = new Vector3(), v1 = new Vector3(), v2 = new Vector3())\r\n    {\r\n        super();\r\n\r\n        this.v0 = v0;\r\n        this.v1 = v1;\r\n        this.v2 = v2;\r\n    }\r\n\r\n    getPoint(t: number, optionalTarget = new Vector3())\r\n    {\r\n        const point = optionalTarget;\r\n\r\n        const v0 = this.v0;\r\n        const v1 = this.v1;\r\n        const v2 = this.v2;\r\n\r\n        point.set(\r\n            Interpolations.QuadraticBezier(t, v0.x, v1.x, v2.x),\r\n            Interpolations.QuadraticBezier(t, v0.y, v1.y, v2.y),\r\n            Interpolations.QuadraticBezier(t, v0.z, v1.z, v2.z)\r\n        );\r\n\r\n        return point;\r\n    }\r\n}\r\n","import { TextureDataType } from '../gl/enums/TextureDataType';\r\nimport { TextureFormat } from '../gl/enums/TextureFormat';\r\nimport { TextureMagFilter } from '../gl/enums/TextureMagFilter';\r\nimport { TextureMinFilter } from '../gl/enums/TextureMinFilter';\r\nimport { TextureType } from '../gl/enums/TextureType';\r\nimport { TextureWrap } from '../gl/enums/TextureWrap';\r\nimport { GL } from '../gl/GL';\r\nimport { WebGLRenderer } from '../WebGLRenderer';\r\n\r\nexport interface Texture\r\n{\r\n    /**\r\n     * 纹理类型\r\n     */\r\n    textureType: TextureType;\r\n\r\n    /**\r\n     * 格式\r\n     */\r\n    format: TextureFormat;\r\n\r\n    /**\r\n     * 数据类型\r\n     */\r\n    type: TextureDataType;\r\n\r\n    /**\r\n     * 是否生成mipmap\r\n     */\r\n    generateMipmap: boolean;\r\n\r\n    /**\r\n     * 对图像进行Y轴反转。默认值为false\r\n     */\r\n    flipY: boolean;\r\n\r\n    /**\r\n     * 将图像RGB颜色值得每一个分量乘以A。默认为false\r\n     */\r\n    premulAlpha: boolean;\r\n\r\n    minFilter: TextureMinFilter;\r\n\r\n    magFilter: TextureMagFilter;\r\n\r\n    /**\r\n     * 表示x轴的纹理的回环方式，就是当纹理的宽度小于需要贴图的平面的宽度的时候，平面剩下的部分应该p以何种方式贴图的问题。\r\n     */\r\n    wrapS: TextureWrap;\r\n\r\n    /**\r\n     * 表示y轴的纹理回环方式。 magFilter和minFilter表示过滤的方式，这是OpenGL的基本概念，我将在下面讲一下，目前你不用担心它的使用。当您不设置的时候，它会取默认值，所以，我们这里暂时不理睬他。\r\n     */\r\n    wrapT: TextureWrap;\r\n\r\n    /**\r\n     * 各向异性过滤。使用各向异性过滤能够使纹理的效果更好，但是会消耗更多的内存、CPU、GPU时间。默认为0。\r\n     */\r\n    anisotropy: number;\r\n\r\n    /**\r\n     * 当前使用的贴图数据\r\n     */\r\n    activePixels: TexImageSource | TexImageSource[];\r\n\r\n    /**\r\n     * 是否为渲染目标纹理\r\n     */\r\n    isRenderTarget: boolean;\r\n\r\n    OFFSCREEN_WIDTH: number;\r\n\r\n    OFFSCREEN_HEIGHT: number;\r\n\r\n    /**\r\n     * 是否失效，值为true时重新创建 WebGLTexture\r\n     */\r\n    invalid: boolean;\r\n}\r\n\r\nexport class Texture\r\n{\r\n    /**\r\n     *\r\n     * @param gl\r\n     * @param data\r\n     * @returns\r\n     */\r\n    static active(gl: GL, data: Texture)\r\n    {\r\n        const texture = this.getTexture(gl, data);\r\n\r\n        const textureType = gl[data.textureType];\r\n\r\n        // 绑定纹理\r\n        gl.bindTexture(textureType, texture);\r\n        // 设置纹理参数\r\n        gl.texParameteri(textureType, gl.TEXTURE_MIN_FILTER, gl[data.minFilter]);\r\n        gl.texParameteri(textureType, gl.TEXTURE_MAG_FILTER, gl[data.magFilter]);\r\n        gl.texParameteri(textureType, gl.TEXTURE_WRAP_S, gl[data.wrapS]);\r\n        gl.texParameteri(textureType, gl.TEXTURE_WRAP_T, gl[data.wrapT]);\r\n\r\n        //\r\n        gl.texParameterfAnisotropy(textureType, data.anisotropy);\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * 获取顶点属性缓冲\r\n     * @param data 数据\r\n     */\r\n    static getTexture(gl: GL, data: Texture)\r\n    {\r\n        if (data.invalid)\r\n        {\r\n            this.clear(data);\r\n            data.invalid = false;\r\n        }\r\n        let texture = gl.cache.textures.get(data);\r\n        if (!texture)\r\n        {\r\n            texture = gl.createTexture(); // Create a texture object\r\n            if (!texture)\r\n            {\r\n                console.error('createTexture 失败！');\r\n                throw '';\r\n            }\r\n            gl.cache.textures.set(data, texture);\r\n\r\n            //\r\n            const textureType = gl[data.textureType];\r\n            const format = gl[data.format];\r\n            const type = gl[data.type];\r\n\r\n            // 设置图片y轴方向\r\n            gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, data.flipY ? 1 : 0);\r\n            gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, data.premulAlpha ? 1 : 0);\r\n            // 绑定纹理\r\n            gl.bindTexture(textureType, texture);\r\n            // 设置纹理图片\r\n            switch (textureType)\r\n            {\r\n                case gl.TEXTURE_CUBE_MAP:\r\n                    const pixels: TexImageSource[] = data.activePixels as any;\r\n                    const faces = [\r\n                        gl.TEXTURE_CUBE_MAP_POSITIVE_X, gl.TEXTURE_CUBE_MAP_POSITIVE_Y, gl.TEXTURE_CUBE_MAP_POSITIVE_Z,\r\n                        gl.TEXTURE_CUBE_MAP_NEGATIVE_X, gl.TEXTURE_CUBE_MAP_NEGATIVE_Y, gl.TEXTURE_CUBE_MAP_NEGATIVE_Z\r\n                    ];\r\n                    for (let i = 0; i < faces.length; i++)\r\n                    {\r\n                        if (data.isRenderTarget)\r\n                        {\r\n                            gl.texImage2D(faces[i], 0, format, data.OFFSCREEN_WIDTH, data.OFFSCREEN_HEIGHT, 0, format, type, null);\r\n                        }\r\n                        else\r\n                        {\r\n                            gl.texImage2D(faces[i], 0, format, format, type, pixels[i]);\r\n                        }\r\n                    }\r\n                    break;\r\n                case gl.TEXTURE_2D:\r\n                    const _pixel: TexImageSource = data.activePixels as any;\r\n                    if (data.isRenderTarget)\r\n                    {\r\n                        gl.texImage2D(textureType, 0, format, data.OFFSCREEN_WIDTH, data.OFFSCREEN_HEIGHT, 0, format, type, null);\r\n                    }\r\n                    else\r\n                    {\r\n                        gl.texImage2D(textureType, 0, format, format, type, _pixel);\r\n                    }\r\n                    break;\r\n                default:\r\n                    throw '';\r\n            }\r\n            if (data.generateMipmap)\r\n            {\r\n                gl.generateMipmap(textureType);\r\n            }\r\n        }\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * 清除纹理\r\n     *\r\n     * @param data\r\n     */\r\n    static clear(data: Texture)\r\n    {\r\n        WebGLRenderer.glList.forEach((gl) =>\r\n        {\r\n            const tex = gl.cache.textures.get(data);\r\n            if (tex)\r\n            {\r\n                gl.deleteTexture(tex);\r\n                gl.cache.textures.delete(data);\r\n            }\r\n        });\r\n    }\r\n}\r\n","/**\r\n * 混合方法\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/blendEquation\r\n */\r\nexport enum BlendEquation\r\n{\r\n    /**\r\n     * 源 + 目标\r\n     *\r\n     *  source + destination\r\n     */\r\n    FUNC_ADD = 'FUNC_ADD',\r\n\r\n    /**\r\n     * 源 - 目标\r\n     *\r\n     * source - destination\r\n     */\r\n    FUNC_SUBTRACT = 'FUNC_SUBTRACT',\r\n\r\n    /**\r\n     * 目标 - 源\r\n     *\r\n     * destination - source\r\n     */\r\n    FUNC_REVERSE_SUBTRACT = 'FUNC_REVERSE_SUBTRACT',\r\n\r\n    /**\r\n     * 源与目标的最小值，当开启 EXT_blend_minmax 扩展时生效。\r\n     *\r\n     * When using the EXT_blend_minmax extension:\r\n     * Minimum of source and destination\r\n     */\r\n    MIN_EXT = 'MIN_EXT',\r\n\r\n    /**\r\n     * 源与目标的最大值，当开启 EXT_blend_minmax 扩展时生效。\r\n     *\r\n     * When using the EXT_blend_minmax extension:\r\n     * Maximum of source and destination.\r\n     */\r\n    MAX_EXT = 'MAX_EXT',\r\n\r\n    /**\r\n     * 源与目标的最小值，在 WebGL 2 中可使用。\r\n     *\r\n     * using a WebGL 2 context\r\n     * Minimum of source and destination\r\n     */\r\n    MIN = 'MIN',\r\n\r\n    /**\r\n     * 源与目标的最大值，在 WebGL 2 中可使用。\r\n     *\r\n     * using a WebGL 2 context\r\n     * Maximum of source and destination.\r\n     */\r\n    MAX = 'MAX',\r\n}\r\n","/**\r\n * 混合因子（R分量系数，G分量系数，B分量系数）\r\n *\r\n * 混合颜色的公式可以这样描述：color(RGBA) = (sourceColor * sfactor) + (destinationColor * dfactor)。这里的 RGBA 值均在0与1之间。\r\n *\r\n * The formula for the blending color can be described like this: color(RGBA) = (sourceColor * sfactor) + (destinationColor * dfactor). The RBGA values are between 0 and 1.\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/blendFunc\r\n */\r\nexport enum BlendFactor\r\n{\r\n    /**\r\n     * Factor: 0,0,0,0\r\n     *\r\n     * 把所有颜色都乘以0。\r\n     *\r\n     * Multiplies all colors by 0.\r\n     */\r\n    ZERO = 'ZERO',\r\n\r\n    /**\r\n     * Factor: 1,1,1,1\r\n     *\r\n     * 把所有颜色都乘以1。\r\n     *\r\n     * Multiplies all colors by 1.\r\n     */\r\n    ONE = 'ONE',\r\n\r\n    /**\r\n     * Factor: Rs, Gs, Bs, As\r\n     *\r\n     * 将所有颜色乘以源颜色。\r\n     *\r\n     * Multiplies all colors by the source colors.\r\n     */\r\n    SRC_COLOR = 'SRC_COLOR',\r\n\r\n    /**\r\n     * Factor: 1-Rs, 1-Gs, 1-Bs, 1-As\r\n     *\r\n     * 将所有颜色乘以1减去每个源颜色。\r\n     *\r\n     * Multiplies all colors by 1 minus each source color.\r\n     */\r\n    ONE_MINUS_SRC_COLOR = 'ONE_MINUS_SRC_COLOR',\r\n\r\n    /**\r\n     * Factor: Rd, Gd, Bd, Ad\r\n     *\r\n     * 将所有颜色乘以目标颜色。\r\n     *\r\n     * Multiplies all colors by the destination color.\r\n     */\r\n    DST_COLOR = 'DST_COLOR',\r\n\r\n    /**\r\n     * Factor: 1-Rd, 1-Gd, 1-Bd, 1-Ad\r\n     *\r\n     * 将所有颜色乘以1减去每个目标颜色。\r\n     *\r\n     * Multiplies all colors by 1 minus each destination color.\r\n     */\r\n    ONE_MINUS_DST_COLOR = 'ONE_MINUS_DST_COLOR',\r\n\r\n    /**\r\n     * Factor: As, As, As, As\r\n     *\r\n     * 将所有颜色乘以源alpha值。\r\n     *\r\n     * Multiplies all colors by the source alpha value.\r\n     */\r\n    SRC_ALPHA = 'SRC_ALPHA',\r\n\r\n    /**\r\n     * Factor: 1-As, 1-As, 1-As, 1-As\r\n     *\r\n     * 将所有颜色乘以1减去源alpha值。\r\n     *\r\n     * Multiplies all colors by 1 minus the source alpha value.\r\n     */\r\n    ONE_MINUS_SRC_ALPHA = 'ONE_MINUS_SRC_ALPHA',\r\n\r\n    /**\r\n     * Factor: Ad, Ad, Ad, Ad\r\n     *\r\n     * 将所有颜色乘以目标alpha值。\r\n     *\r\n     * Multiplies all colors by the destination alpha value.\r\n     */\r\n    DST_ALPHA = 'DST_ALPHA',\r\n\r\n    /**\r\n     * Factor: 1-Ad, 1-Ad, 1-Ad, 1-Ad\r\n     *\r\n     * 将所有颜色乘以1减去目标alpha值。\r\n     *\r\n     * Multiplies all colors by 1 minus the destination alpha value.\r\n     */\r\n    ONE_MINUS_DST_ALPHA = 'ONE_MINUS_DST_ALPHA',\r\n\r\n    /**\r\n     * Factor: Rc, Gc, Bc, Ac\r\n     *\r\n     * 将所有颜色乘以一个常数颜色。\r\n     *\r\n     * Multiplies all colors by a constant color.\r\n     */\r\n    CONSTANT_COLOR = 'CONSTANT_COLOR',\r\n\r\n    /**\r\n     * Factor: 1-Rc, 1-Gc, 1-Bc, 1-Ac\r\n     *\r\n     * 所有颜色乘以1减去一个常数颜色。\r\n     *\r\n     * Multiplies all colors by 1 minus a constant color.\r\n     */\r\n    ONE_MINUS_CONSTANT_COLOR = 'ONE_MINUS_CONSTANT_COLOR',\r\n\r\n    /**\r\n     * Factor: Ac, Ac, Ac, Ac\r\n     *\r\n     * 将所有颜色乘以一个常量alpha值。\r\n     *\r\n     * Multiplies all colors by a constant alpha value.\r\n     */\r\n    CONSTANT_ALPHA = 'CONSTANT_ALPHA',\r\n\r\n    /**\r\n     * Factor: 1-Ac, 1-Ac, 1-Ac, 1-Ac\r\n     *\r\n     * 将所有颜色乘以1减去一个常数alpha值。\r\n     *\r\n     * Multiplies all colors by 1 minus a constant alpha value.\r\n     */\r\n    ONE_MINUS_CONSTANT_ALPHA = 'ONE_MINUS_CONSTANT_ALPHA',\r\n\r\n    /**\r\n     * Factor: min(As, 1 - Ad), min(As, 1 - Ad), min(As, 1 - Ad), 1\r\n     *\r\n     * 将RGB颜色乘以源alpha值与1减去目标alpha值的较小值。alpha值乘以1。\r\n     *\r\n     * Multiplies the RGB colors by the smaller of either the source alpha value or the value of 1 minus the destination alpha value. The alpha value is multiplied by 1.\r\n     */\r\n    SRC_ALPHA_SATURATE = 'SRC_ALPHA_SATURATE',\r\n}\r\n","/**\r\n * 决定给WebGLRenderingContext.colorMask何种参数。\r\n */\r\nexport enum ColorMask\r\n{\r\n    NONE = 0,\r\n    R = 1,\r\n    G = 2,\r\n    B = 4,\r\n    A = 8,\r\n    RGB = R | G | B,\r\n    /**\r\n     *\r\n     */\r\n    RGBA = R | G | B | A,\r\n}\r\n","/**\r\n * 裁剪面枚举\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/cullFace\r\n */\r\nexport enum CullFace\r\n{\r\n    /**\r\n     * 关闭裁剪面\r\n     */\r\n    NONE = 'NONE',\r\n    /**\r\n     * 正面\r\n     */\r\n    FRONT = 'FRONT',\r\n    /**\r\n     * 背面\r\n     */\r\n    BACK = 'BACK',\r\n    /**\r\n     * 正面与背面\r\n     */\r\n    FRONT_AND_BACK = 'FRONT_AND_BACK',\r\n}\r\n","/**\r\n * 指定深度比较函数的枚举，该函数设置绘制像素的条件，默认 LESS，如果传入值小于深度缓冲区值则通过。\r\n *\r\n * A GLenum specifying the depth comparison function, which sets the conditions under which the pixel will be drawn. The default value is gl.LESS.\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/depthFunc\r\n */\r\nexport enum DepthFunc\r\n{\r\n    /**\r\n     * 总是不通过。\r\n     *\r\n     * never pass.\r\n     */\r\n    NEVER = 'NEVER',\r\n\r\n    /**\r\n     * 如果传入值小于深度缓冲区值则通过。\r\n     *\r\n     * pass if the incoming value is less than the depth buffer value.\r\n     */\r\n    LESS = 'LESS',\r\n\r\n    /**\r\n     * 如果传入值等于深度缓冲区值则通过。\r\n     *\r\n     * pass if the incoming value equals the the depth buffer value.\r\n     */\r\n    EQUAL = 'EQUAL',\r\n\r\n    /**\r\n     * 如果传入值小于或等于深度缓冲区值则通过。\r\n     *\r\n     * pass if the incoming value is less than or equal to the depth buffer value.\r\n     */\r\n    LEQUAL = 'LEQUAL',\r\n\r\n    /**\r\n     * 如果传入值大于深度缓冲区值则通过。。\r\n     *\r\n     * pass if the incoming value is greater than the depth buffer value.\r\n     */\r\n    GREATER = 'GREATER',\r\n\r\n    /**\r\n     * 如果传入值不等于深度缓冲区值则通过。\r\n     *\r\n     * pass if the incoming value is not equal to the depth buffer value.\r\n     */\r\n    NOTEQUAL = 'NOTEQUAL',\r\n\r\n    /**\r\n     * 如果传入值大于或等于深度缓冲区值则通过。\r\n     *\r\n     * pass if the incoming value is greater than or equal to the depth buffer value.\r\n     */\r\n    GEQUAL = 'GEQUAL',\r\n\r\n    /**\r\n     * 总是通过。\r\n     *\r\n     * always pass.\r\n     */\r\n    ALWAYS = 'ALWAYS',\r\n}\r\n","/**\r\n * 正面方向枚举\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/frontFace\r\n */\r\nexport enum FrontFace\r\n{\r\n    /**\r\n     * 顺时钟方向\r\n     *\r\n     * Clock-wise winding.\r\n     */\r\n    CW = 'CW',\r\n    /**\r\n     * 逆时钟方向\r\n     *\r\n     *  Counter-clock-wise winding.\r\n     */\r\n    CCW = 'CCW',\r\n}\r\n","/**\r\n * 渲染模式，描述绘制图元的类型。\r\n *\r\n * A GLenum specifying the type primitive to render.\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/drawElements\r\n */\r\nexport enum RenderMode\r\n{\r\n    /**\r\n     * 绘制单个点。\r\n     *\r\n     * gl.POINTS: Draws a single dot.\r\n     */\r\n    POINTS = 'POINTS',\r\n\r\n    /**\r\n     * 绘制循环连线。\r\n     *\r\n     * gl.LINE_LOOP: Draws a straight line to the next vertex, and connects the last vertex back to the first.\r\n     */\r\n    LINE_LOOP = 'LINE_LOOP',\r\n\r\n    /**\r\n     * 绘制连线\r\n     *\r\n     * gl.LINE_STRIP: Draws a straight line to the next vertex.\r\n     */\r\n    LINE_STRIP = 'LINE_STRIP',\r\n\r\n    /**\r\n     * 每两个顶点绘制一条线段。\r\n     *\r\n     * gl.LINES: Draws a line between a pair of vertices.\r\n     */\r\n    LINES = 'LINES',\r\n\r\n    /**\r\n     * 每三个顶点绘制一个三角形。\r\n     *\r\n     * gl.TRIANGLES: Draws a triangle for a group of three vertices.\r\n     */\r\n    TRIANGLES = 'TRIANGLES',\r\n\r\n    /**\r\n     * 绘制三角形条带。\r\n     *\r\n     * gl.TRIANGLE_STRIP\r\n     * @see https://en.wikipedia.org/wiki/Triangle_strip\r\n     */\r\n    TRIANGLE_STRIP = 'TRIANGLE_STRIP',\r\n\r\n    /**\r\n     * 绘制三角扇形。\r\n     *\r\n     * gl.TRIANGLE_FAN\r\n     * @see https://en.wikipedia.org/wiki/Triangle_fan\r\n     */\r\n    TRIANGLE_FAN = 'TRIANGLE_FAN',\r\n}\r\n","/**\r\n * A GLenum specifying the test function. The default function is gl.ALWAYS.\r\n *\r\n * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/stencilFunc\r\n */\r\nexport enum StencilFunc\r\n{\r\n    /**\r\n     * 总是不通过。\r\n     *\r\n     * Never pass.\r\n     */\r\n    NEVER = 'NEVER',\r\n\r\n    /**\r\n     * 如果 (ref & mask) <  (stencil & mask) 则通过。\r\n     *\r\n     * Pass if (ref & mask) <  (stencil & mask).\r\n     */\r\n    LESS = 'LESS',\r\n\r\n    /**\r\n     * 如果 (ref & mask) = (stencil & mask) 则通过。\r\n     *\r\n     * Pass if (ref & mask) = (stencil & mask).\r\n     */\r\n    EQUAL = 'EQUAL',\r\n\r\n    /**\r\n     * 如果 (ref & mask) <= (stencil & mask) 则通过。\r\n     *\r\n     * Pass if (ref & mask) <= (stencil & mask).\r\n     */\r\n    LEQUAL = 'LEQUAL',\r\n\r\n    /**\r\n     * 如果 (ref & mask) > (stencil & mask) 则通过。\r\n     *\r\n     * Pass if (ref & mask) > (stencil & mask).\r\n     */\r\n    GREATER = 'GREATER',\r\n\r\n    /**\r\n     * 如果 (ref & mask) != (stencil & mask) 则通过。\r\n     *\r\n     * Pass if (ref & mask) != (stencil & mask).\r\n     */\r\n    NOTEQUAL = 'NOTEQUAL',\r\n\r\n    /**\r\n     * 如果 (ref & mask) >= (stencil & mask) 则通过。\r\n     *\r\n     * Pass if (ref & mask) >= (stencil & mask).\r\n     */\r\n    GEQUAL = 'GEQUAL',\r\n\r\n    /**\r\n     * 总是通过。\r\n     *\r\n     * Always pass.\r\n     */\r\n    ALWAYS = 'ALWAYS',\r\n}\r\n","/**\r\n * The WebGLRenderingContext.stencilOp() method of the WebGL API sets both the front and back-facing stencil test actions.\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/stencilOp\r\n */\r\nexport enum StencilOp\r\n{\r\n    /**\r\n     * 保持当前值。\r\n     *\r\n     * Keeps the current value.\r\n     */\r\n    KEEP = 'KEEP',\r\n\r\n    /**\r\n     * 设置模板缓冲值为0.\r\n     *\r\n     * Sets the stencil buffer value to 0.\r\n     */\r\n    ZERO = 'ZERO',\r\n\r\n    /**\r\n     * 将模板缓冲区的值设置为WebGLRenderingContext.stencilFunc()指定的参考值。\r\n     *\r\n     * Sets the stencil buffer value to the reference value as specified by WebGLRenderingContext.stencilFunc().\r\n     */\r\n    REPLACE = 'REPLACE',\r\n\r\n    /**\r\n     * 增加当前模板缓冲区的值。最大到可表示的无符号值的最大值。\r\n     *\r\n     * Increments the current stencil buffer value. Clamps to the maximum representable unsigned value.\r\n     */\r\n    INCR = 'INCR',\r\n\r\n    /**\r\n     * 增加当前模板缓冲区的值。当增加最大的可表示无符号值时，将模板缓冲区值包装为零。\r\n     *\r\n     * Increments the current stencil buffer value. Wraps stencil buffer value to zero when incrementing the maximum representable unsigned value.\r\n     */\r\n    INCR_WRAP = 'INCR_WRAP',\r\n\r\n    /**\r\n     * 递减当前模板缓冲区的值。最小为0。\r\n     *\r\n     * Decrements the current stencil buffer value. Clamps to 0.\r\n     */\r\n    DECR = 'DECR',\r\n\r\n    /**\r\n     * 递减当前模板缓冲区的值。当模板缓冲区值减为0时，将模板缓冲区值包装为可表示的最大无符号值。\r\n     *\r\n     * Decrements the current stencil buffer value. Wraps stencil buffer value to the maximum representable unsigned value when decrementing a stencil buffer value of 0.\r\n     */\r\n    DECR_WRAP = 'DECR_WRAP',\r\n\r\n    /**\r\n     * 按位反转当前模板缓冲区值。\r\n     *\r\n     * Inverts the current stencil buffer value bitwise.\r\n     */\r\n    INVERT = 'INVERT',\r\n}\r\n","import { Attribute } from '../data/Attribute';\r\nimport { FrameBuffer } from '../data/FrameBuffer';\r\nimport { Index } from '../data/Index';\r\nimport { CompileShaderResult } from '../data/Shader';\r\nimport { Texture } from '../data/Texture';\r\nimport { RenderBuffer } from '../RenderBuffer';\r\nimport { GL } from './GL';\r\n\r\ndeclare global\r\n{\r\n    interface MixinsGLCache\r\n    {\r\n\r\n    }\r\n}\r\n\r\nexport interface GLCache extends MixinsGLCache { }\r\n\r\n/**\r\n * GL 缓存\r\n */\r\nexport class GLCache\r\n{\r\n    compileShaderResults: { [key: string]: CompileShaderResult } = {};\r\n\r\n    private _gl: GL;\r\n\r\n    /**\r\n     * 此处用于缓存，需要获取有效数据请调用 Attribute.getBuffer\r\n     */\r\n    textures = new Map<Texture, WebGLTexture>();\r\n\r\n    /**\r\n     * 此处用于缓存，需要获取有效数据请调用 Attribute.getBuffer\r\n     */\r\n    attributes = new Map<Attribute, WebGLBuffer>();\r\n\r\n    /**\r\n     * 此处用于缓存，需要获取有效数据请调用 Attribute.getBuffer\r\n     */\r\n    indices = new Map<Index, WebGLBuffer>();\r\n\r\n    /**\r\n     * 此处用于缓存，需要获取有效数据请调用 Attribute.getBuffer\r\n     */\r\n    renderBuffers = new Map<RenderBuffer, WebGLBuffer>();\r\n\r\n    /**\r\n     * 此处用于缓存，需要获取有效数据请调用 Attribute.getBuffer\r\n     */\r\n    frameBuffers = new Map<FrameBuffer, WebGLFramebuffer>();\r\n\r\n    constructor(gl: GL)\r\n    {\r\n        gl.cache = this;\r\n        this._gl = gl;\r\n    }\r\n}\r\n","import { GL } from './GL';\r\n\r\n/**\r\n * WEBGL 支持功能\r\n *\r\n * @see https://webglreport.com\r\n * @see http://html5test.com\r\n */\r\nexport class GLCapabilities\r\n{\r\n    /**\r\n     * 是否为 WebGL2\r\n     */\r\n    isWebGL2: boolean;\r\n\r\n    /**\r\n     * 纹理各向异性过滤最大值\r\n     */\r\n    maxAnisotropy: number;\r\n\r\n    /**\r\n     * 支持最大纹理数量\r\n     */\r\n    maxTextures: number;\r\n\r\n    /**\r\n     * 支持最大顶点纹理数量\r\n     */\r\n    maxVertexTextures: number;\r\n\r\n    /**\r\n     * 支持最大纹理尺寸\r\n     */\r\n    maxTextureSize: number;\r\n\r\n    /**\r\n     * 支持最大立方体贴图尺寸\r\n     */\r\n    maxCubemapSize: number;\r\n\r\n    /**\r\n     * 支持属性数量\r\n     */\r\n    maxAttributes: number;\r\n\r\n    /**\r\n     * 顶点着色器支持最大 Uniform 数量\r\n     */\r\n    maxVertexUniforms: number;\r\n\r\n    /**\r\n     * 支持最大shader之间传递的变量数\r\n     */\r\n    maxVaryings: number;\r\n\r\n    /**\r\n     * 片段着色器支持最大 Uniform 数量\r\n     */\r\n    maxFragmentUniforms: number;\r\n\r\n    /**\r\n     * 是否支持顶点纹理\r\n     */\r\n    vertexTextures: boolean;\r\n\r\n    /**\r\n     * 是否支持浮点类型片段着色器纹理\r\n     */\r\n    floatFragmentTextures: boolean;\r\n\r\n    /**\r\n     * 是否支持浮点类型顶点着色器纹理\r\n     */\r\n    floatVertexTextures: boolean;\r\n\r\n    /**\r\n     * Shader中支持浮点类型的最高精度\r\n     */\r\n    maxPrecision: 'highp' | 'mediump' | 'lowp';\r\n\r\n    /**\r\n     *\r\n     */\r\n    maxSamples: number;\r\n\r\n    /**\r\n     * 支持模板的位数\r\n     */\r\n    stencilBits: number;\r\n\r\n    constructor(gl: GL)\r\n    {\r\n        gl.capabilities = this;\r\n        function getMaxPrecision(precision)\r\n        {\r\n            if (precision === 'highp')\r\n            {\r\n                if (gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_FLOAT).precision > 0\r\n                    && gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT).precision > 0)\r\n                {\r\n                    return 'highp';\r\n                }\r\n                precision = 'mediump';\r\n            }\r\n            if (precision === 'mediump')\r\n            {\r\n                if (gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_FLOAT).precision > 0\r\n                    && gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT).precision > 0)\r\n                {\r\n                    return 'mediump';\r\n                }\r\n            }\r\n\r\n            return 'lowp';\r\n        }\r\n\r\n        this.isWebGL2 = false;\r\n        let gl2: WebGL2RenderingContext = null;\r\n        if (typeof WebGL2RenderingContext !== 'undefined' && gl instanceof WebGL2RenderingContext)\r\n        {\r\n            gl2 = gl;\r\n            this.isWebGL2 = true;\r\n        }\r\n        if (gl.extensions.EXT_texture_filter_anisotropic)\r\n        {\r\n            this.maxAnisotropy = gl.getParameter(gl.extensions.EXT_texture_filter_anisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT);\r\n        }\r\n        else\r\n        {\r\n            this.maxAnisotropy = 0;\r\n        }\r\n        this.maxPrecision = getMaxPrecision('highp');\r\n\r\n        this.maxTextures = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\r\n        this.maxVertexTextures = gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);\r\n        this.maxTextureSize = gl.getParameter(gl.MAX_TEXTURE_SIZE);\r\n        this.maxCubemapSize = gl.getParameter(gl.MAX_CUBE_MAP_TEXTURE_SIZE);\r\n\r\n        this.maxAttributes = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\r\n        this.maxVertexUniforms = gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS);\r\n        this.maxVaryings = gl.getParameter(gl.MAX_VARYING_VECTORS);\r\n        this.maxFragmentUniforms = gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS);\r\n\r\n        this.vertexTextures = this.maxVertexTextures > 0;\r\n        this.floatFragmentTextures = this.isWebGL2 || !!gl.getExtension('OES_texture_float');\r\n        this.floatVertexTextures = this.vertexTextures && this.floatFragmentTextures;\r\n\r\n        this.maxSamples = this.isWebGL2 ? gl.getParameter(gl2.MAX_SAMPLES) : 0;\r\n        this.stencilBits = gl.getParameter(gl.STENCIL_BITS);\r\n    }\r\n}\r\n","/* eslint-disable camelcase */\r\nimport { GL } from './GL';\r\n\r\n/**\r\n * GL扩展\r\n */\r\nexport class GLExtension\r\n{\r\n    ANGLE_instanced_arrays: ANGLE_instanced_arrays;\r\n    EXT_blend_minmax: EXT_blend_minmax;\r\n    EXT_color_buffer_half_float: any;\r\n    EXT_frag_depth: EXT_frag_depth;\r\n    EXT_sRGB: EXT_sRGB;\r\n    EXT_shader_texture_lod: EXT_shader_texture_lod;\r\n    EXT_texture_filter_anisotropic: EXT_texture_filter_anisotropic;\r\n    OES_element_index_uint: OES_element_index_uint;\r\n    OES_standard_derivatives: OES_standard_derivatives;\r\n    OES_texture_float: OES_texture_float;\r\n    OES_texture_float_linear: OES_texture_float_linear;\r\n    OES_texture_half_float: OES_texture_half_float;\r\n    OES_texture_half_float_linear: OES_texture_half_float_linear;\r\n    OES_vertex_array_object: OES_vertex_array_object;\r\n    WEBGL_color_buffer_float: WEBGL_color_buffer_float;\r\n    WEBGL_compressed_texture_atc: any;\r\n    WEBGL_compressed_texture_etc1: any;\r\n    WEBGL_compressed_texture_pvrtc: any;\r\n    WEBGL_compressed_texture_s3tc: WEBGL_compressed_texture_s3tc;\r\n    WEBGL_debug_renderer_info: WEBGL_debug_renderer_info;\r\n    WEBGL_debug_shaders: WEBGL_debug_shaders;\r\n    WEBGL_depth_texture: WEBGL_depth_texture;\r\n    WEBGL_draw_buffers: WEBGL_draw_buffers;\r\n    WEBGL_lose_context: any;\r\n\r\n    constructor(gl: GL)\r\n    {\r\n        console.assert(!gl.extensions, `${gl} ${gl.extensions} 存在！`);\r\n        gl.extensions = this;\r\n\r\n        this.initExtensions(gl);\r\n        this.cacheGLQuery(gl);\r\n        this.wrap(gl);\r\n    }\r\n\r\n    private initExtensions(gl: GL)\r\n    {\r\n        this.ANGLE_instanced_arrays = gl.getExtension('ANGLE_instanced_arrays');\r\n        this.EXT_blend_minmax = gl.getExtension('EXT_blend_minmax');\r\n        if (this.EXT_blend_minmax)\r\n        {\r\n            gl['MIN_EXT'] = this.EXT_blend_minmax.MIN_EXT;\r\n            gl['MAX_EXT'] = this.EXT_blend_minmax.MAX_EXT;\r\n        }\r\n        this.EXT_color_buffer_half_float = gl.getExtension('EXT_color_buffer_half_float');\r\n        this.EXT_frag_depth = gl.getExtension('EXT_frag_depth');\r\n        this.EXT_sRGB = gl.getExtension('EXT_sRGB');\r\n        this.EXT_shader_texture_lod = gl.getExtension('EXT_shader_texture_lod');\r\n        this.EXT_texture_filter_anisotropic = gl.getExtension('EXT_texture_filter_anisotropic') || gl.getExtension('MOZ_EXT_texture_filter_anisotropic') || gl.getExtension('WEBKIT_EXT_texture_filter_anisotropic');\r\n        this.OES_element_index_uint = gl.getExtension('OES_element_index_uint');\r\n        this.OES_standard_derivatives = gl.getExtension('OES_standard_derivatives');\r\n        this.OES_texture_float = gl.getExtension('OES_texture_float');\r\n        this.OES_texture_float_linear = gl.getExtension('OES_texture_float_linear');\r\n        this.OES_texture_half_float = gl.getExtension('OES_texture_half_float');\r\n        this.OES_texture_half_float_linear = gl.getExtension('OES_texture_half_float_linear');\r\n        this.OES_vertex_array_object = gl.getExtension('OES_vertex_array_object');\r\n        this.WEBGL_color_buffer_float = gl.getExtension('WEBGL_color_buffer_float');\r\n        this.WEBGL_compressed_texture_atc = gl.getExtension('WEBGL_compressed_texture_atc') || gl.getExtension('WEBKIT_WEBGL_compressed_texture_atc');\r\n        this.WEBGL_compressed_texture_etc1 = gl.getExtension('WEBGL_compressed_texture_etc1');\r\n        this.WEBGL_compressed_texture_pvrtc = gl.getExtension('WEBGL_compressed_texture_pvrtc') || gl.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc');\r\n        this.WEBGL_compressed_texture_s3tc = gl.getExtension('WEBGL_compressed_texture_s3tc') || gl.getExtension('MOZ_WEBGL_compressed_texture_s3tc') || gl.getExtension('WEBKIT_WEBGL_compressed_texture_s3tc');\r\n        this.WEBGL_debug_renderer_info = gl.getExtension('WEBGL_debug_renderer_info');\r\n        this.WEBGL_debug_shaders = gl.getExtension('WEBGL_debug_shaders');\r\n        this.WEBGL_depth_texture = gl.getExtension('WEBGL_depth_texture') || gl.getExtension('MOZ_WEBGL_depth_texture') || gl.getExtension('WEBKIT_WEBGL_depth_texture');\r\n        this.WEBGL_draw_buffers = gl.getExtension('WEBGL_draw_buffers');\r\n        this.WEBGL_lose_context = gl.getExtension('WEBGL_lose_context') || gl.getExtension('WEBKIT_WEBGL_lose_context') || gl.getExtension('MOZ_WEBGL_lose_context');\r\n    }\r\n\r\n    /**\r\n     * 缓存GL查询\r\n     * @param gl GL实例\r\n     */\r\n    private cacheGLQuery(gl: GL)\r\n    {\r\n        const oldGetExtension = gl.getExtension;\r\n        gl.getExtension = function (name: string)\r\n        {\r\n            if (!gl.extensions[name])\r\n            {\r\n                // eslint-disable-next-line prefer-rest-params\r\n                gl.extensions[name] = oldGetExtension.apply(gl, arguments);\r\n            }\r\n\r\n            return gl.extensions[name];\r\n        };\r\n    }\r\n\r\n    private wrap(gl: GL)\r\n    {\r\n        if (!gl.texParameterfAnisotropy)\r\n        {\r\n            gl.texParameterfAnisotropy = (target, anisotropy) =>\r\n            {\r\n                if (anisotropy <= 0) return;\r\n\r\n                if (gl.extensions.EXT_texture_filter_anisotropic)\r\n                {\r\n                    if (anisotropy > gl.capabilities.maxAnisotropy)\r\n                    {\r\n                        anisotropy = gl.capabilities.maxAnisotropy;\r\n                        console.warn(`${anisotropy} 超出 maxAnisotropy 的最大值 ${gl.capabilities.maxAnisotropy} ！,使用最大值替换。`);\r\n                    }\r\n                    gl.texParameterf(target, gl.extensions.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT, anisotropy);\r\n                }\r\n                else\r\n                {\r\n                    console.warn('浏览器不支持各向异性过滤（anisotropy）特性！');\r\n                }\r\n            };\r\n        }\r\n\r\n        //\r\n        if (!gl.vertexAttribDivisor)\r\n        {\r\n            gl.vertexAttribDivisor = (index, divisor) =>\r\n            {\r\n                if (gl.extensions.ANGLE_instanced_arrays)\r\n                {\r\n                    gl.extensions.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(index, divisor);\r\n                }\r\n                else\r\n                {\r\n                    console.warn(`浏览器 不支持 drawElementsInstanced ！`);\r\n                }\r\n            };\r\n        }\r\n        if (!gl.drawElementsInstanced)\r\n        {\r\n            gl.drawElementsInstanced = (mode, count, type, offset, instanceCount) =>\r\n            {\r\n                if (gl.extensions.ANGLE_instanced_arrays)\r\n                {\r\n                    gl.extensions.ANGLE_instanced_arrays.drawElementsInstancedANGLE(mode, count, type, offset, instanceCount);\r\n                }\r\n                else\r\n                {\r\n                    console.warn(`浏览器 不支持 drawElementsInstanced ！`);\r\n                }\r\n            };\r\n        }\r\n        if (!gl.drawArraysInstanced)\r\n        {\r\n            gl.drawArraysInstanced = (mode, first, count, instanceCount) =>\r\n            {\r\n                if (gl.extensions.ANGLE_instanced_arrays)\r\n                {\r\n                    gl.extensions.ANGLE_instanced_arrays.drawArraysInstancedANGLE(mode, first, count, instanceCount);\r\n                }\r\n                else\r\n                {\r\n                    console.warn(`浏览器 不支持 drawArraysInstanced ！`);\r\n                }\r\n            };\r\n        }\r\n    }\r\n}\r\n","/* eslint-disable no-new */\r\nimport { lazy } from '@feng3d/polyfill';\r\nimport { Attribute } from './data/Attribute';\r\nimport { RenderAtomic, RenderAtomicData } from './data/RenderAtomic';\r\nimport { AttributeInfo, UniformInfo } from './data/Shader';\r\nimport { Texture } from './data/Texture';\r\nimport { Uniforms } from './data/Uniform';\r\nimport { GL } from './gl/GL';\r\nimport { GLCache } from './gl/GLCache';\r\nimport { GLCapabilities } from './gl/GLCapabilities';\r\nimport { GLExtension } from './gl/GLExtension';\r\n\r\n/**\r\n * WEBGL 渲染器\r\n *\r\n * 所有渲染都由该渲染器执行\r\n */\r\nexport class WebGLRenderer\r\n{\r\n    static glList: GL[] = [];\r\n\r\n    gl: GL;\r\n    private preActiveAttributes: number[] = [];\r\n\r\n    constructor(canvas: HTMLCanvasElement, contextAttributes?: WebGLContextAttributes)\r\n    {\r\n        const contextIds = ['webgl2', 'webgl', 'experimental-webgl', 'webkit-3d', 'moz-webgl'];\r\n        // var contextIds = [\"webgl\"];\r\n        let gl: GL = <any>null;\r\n        for (let i = 0; i < contextIds.length; ++i)\r\n        {\r\n            try\r\n            {\r\n                gl = <any>canvas.getContext(contextIds[i], contextAttributes);\r\n                gl.contextId = contextIds[i];\r\n                gl.contextAttributes = contextAttributes;\r\n                break;\r\n            }\r\n            // eslint-disable-next-line no-empty\r\n            catch (e) { }\r\n        }\r\n        if (!gl)\r\n        { throw '无法初始化WEBGL'; }\r\n        this.gl = gl;\r\n        //\r\n        new GLCache(gl);\r\n        new GLExtension(gl);\r\n        new GLCapabilities(gl);\r\n        //\r\n        gl.clearColor(0.0, 0.0, 0.0, 1.0); // Clear to black, fully opaque\r\n        gl.clearDepth(1.0); // Clear everything\r\n        gl.enable(gl.DEPTH_TEST); // Enable depth testing\r\n        gl.depthFunc(gl.LEQUAL); // Near things obscure far things\r\n        WebGLRenderer.glList.push(gl);\r\n\r\n        console.assert(!gl.render, `${gl} ${gl.render} 存在！`);\r\n    }\r\n\r\n    render(renderAtomic: RenderAtomic)\r\n    {\r\n        const instanceCount = renderAtomic.getInstanceCount();\r\n        if (instanceCount === 0) return;\r\n        const shaderMacro = renderAtomic.getShaderMacro();\r\n        const shader = renderAtomic.getShader();\r\n        shader.shaderMacro = shaderMacro;\r\n        const shaderResult = shader.activeShaderProgram(this.gl);\r\n        if (!shaderResult) return;\r\n        //\r\n        const checkedRenderAtomic: RenderAtomicData = this.checkRenderData(renderAtomic);\r\n        if (!checkedRenderAtomic) return;\r\n        //\r\n        this.gl.useProgram(shaderResult.program);\r\n        checkedRenderAtomic.renderParams.updateRenderParams(this.gl);\r\n        this.activeAttributes(checkedRenderAtomic, shaderResult.attributes);\r\n        this.activeUniforms(checkedRenderAtomic, shaderResult.uniforms);\r\n        this.draw(checkedRenderAtomic, this.gl[checkedRenderAtomic.renderParams.renderMode]);\r\n    }\r\n\r\n    private checkRenderData(renderAtomic: RenderAtomic)\r\n    {\r\n        const shader = renderAtomic.getShader();\r\n        const shaderResult = shader.activeShaderProgram(this.gl);\r\n        if (!shaderResult)\r\n        {\r\n            console.warn(`缺少着色器，无法渲染!`);\r\n\r\n            return null;\r\n        }\r\n\r\n        const attributes: { [name: string]: Attribute; } = {};\r\n        for (const key in shaderResult.attributes)\r\n        {\r\n            const attribute = renderAtomic.getAttributeByKey(key);\r\n            if (!attribute)\r\n            {\r\n                console.warn(`缺少顶点 attribute 数据 ${key} ，无法渲染!`);\r\n\r\n                return null;\r\n            }\r\n            attributes[key] = attribute;\r\n        }\r\n\r\n        const uniforms: { [name: string]: Uniforms; } = {};\r\n        for (let key in shaderResult.uniforms)\r\n        {\r\n            const activeInfo = shaderResult.uniforms[key];\r\n            if (activeInfo.name)\r\n            {\r\n                key = activeInfo.name;\r\n            }\r\n            const uniform = renderAtomic.getUniformByKey(key);\r\n            if (uniform === undefined)\r\n            {\r\n                console.warn(`缺少 uniform 数据 ${key} ,无法渲染！`);\r\n\r\n                return null;\r\n            }\r\n            uniforms[key] = uniform;\r\n        }\r\n\r\n        const indexBuffer = renderAtomic.getIndexBuffer();\r\n\r\n        const checkedRenderAtomic: RenderAtomicData\r\n            = {\r\n            shader,\r\n            attributes,\r\n            uniforms,\r\n            renderParams: renderAtomic.getRenderParams(),\r\n            index: indexBuffer,\r\n            instanceCount: renderAtomic.getInstanceCount(),\r\n        };\r\n\r\n        return checkedRenderAtomic;\r\n    }\r\n\r\n    /**\r\n     * 激活属性\r\n     */\r\n    private activeAttributes(renderAtomic: RenderAtomicData, attributeInfos: { [name: string]: AttributeInfo })\r\n    {\r\n        const gl = this.gl;\r\n\r\n        const activeAttributes: number[] = [];\r\n        for (const name in attributeInfos)\r\n        {\r\n            const activeInfo = attributeInfos[name];\r\n            const buffer: Attribute = renderAtomic.attributes[name];\r\n            buffer.active(gl, activeInfo.location);\r\n            activeAttributes.push(activeInfo.location);\r\n\r\n            const index = this.preActiveAttributes.indexOf(activeInfo.location);\r\n            if (index !== -1)\r\n            {\r\n                this.preActiveAttributes.splice(index, 1);\r\n            }\r\n        }\r\n        this.preActiveAttributes.forEach((location) =>\r\n        {\r\n            gl.disableVertexAttribArray(location);\r\n        });\r\n        this.preActiveAttributes = activeAttributes;\r\n    }\r\n\r\n    /**\r\n     * 激活常量\r\n     */\r\n    private activeUniforms(renderAtomic: RenderAtomicData, uniformInfos: { [name: string]: UniformInfo })\r\n    {\r\n        const uniforms = renderAtomic.uniforms;\r\n        for (const name in uniformInfos)\r\n        {\r\n            const activeInfo = uniformInfos[name];\r\n            const paths = activeInfo.paths;\r\n            let uniformData = uniforms[paths[0]];\r\n            for (let i = 1; i < paths.length; i++)\r\n            {\r\n                uniformData = uniformData[paths[i]];\r\n            }\r\n            this.setContext3DUniform(activeInfo, uniformData);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置环境Uniform数据\r\n     */\r\n    private setContext3DUniform(activeInfo: UniformInfo, data)\r\n    {\r\n        const gl = this.gl;\r\n\r\n        let vec: number[] = data;\r\n        if (data.toArray) vec = data.toArray();\r\n        const location = activeInfo.location;\r\n        switch (activeInfo.type)\r\n        {\r\n            case gl.INT:\r\n                gl.uniform1i(location, data);\r\n                break;\r\n            case gl.FLOAT_MAT3:\r\n                gl.uniformMatrix3fv(location, false, vec);\r\n                break;\r\n            case gl.FLOAT_MAT4:\r\n                gl.uniformMatrix4fv(location, false, vec);\r\n                break;\r\n            case gl.FLOAT:\r\n                gl.uniform1f(location, data);\r\n                break;\r\n            case gl.FLOAT_VEC2:\r\n                gl.uniform2f(location, vec[0], vec[1]);\r\n                break;\r\n            case gl.FLOAT_VEC3:\r\n                gl.uniform3f(location, vec[0], vec[1], vec[2]);\r\n                break;\r\n            case gl.FLOAT_VEC4:\r\n                gl.uniform4f(location, vec[0], vec[1], vec[2], vec[3]);\r\n                break;\r\n            case gl.SAMPLER_2D:\r\n            case gl.SAMPLER_CUBE:\r\n                const textureInfo = data as Texture;\r\n                // 激活纹理编号\r\n                gl.activeTexture(gl[`TEXTURE${activeInfo.textureID}`]);\r\n                Texture.active(gl, textureInfo);\r\n                // 设置纹理所在采样编号\r\n                gl.uniform1i(location, activeInfo.textureID);\r\n                break;\r\n            default:\r\n                console.error(`无法识别的uniform类型 ${activeInfo.name} ${data}`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     */\r\n    private draw(renderAtomic: RenderAtomicData, renderMode: number)\r\n    {\r\n        const gl = this.gl;\r\n\r\n        const instanceCount = ~~lazy.getvalue(renderAtomic.instanceCount);\r\n\r\n        const indexBuffer = renderAtomic.index;\r\n        if (indexBuffer)\r\n        {\r\n            indexBuffer.active(gl);\r\n            const arrayType = gl[indexBuffer.type];\r\n            if (indexBuffer.count === 0)\r\n            {\r\n                // console.warn(`顶点索引为0，不进行渲染！`);\r\n                return;\r\n            }\r\n            if (instanceCount > 1)\r\n            {\r\n                gl.drawElementsInstanced(renderMode, indexBuffer.count, arrayType, indexBuffer.offset, instanceCount);\r\n            }\r\n            else\r\n            {\r\n                gl.drawElements(renderMode, indexBuffer.count, arrayType, indexBuffer.offset);\r\n            }\r\n        }\r\n        else\r\n        {\r\n            const vertexNum = ((attributes) =>\r\n            {\r\n                for (const attr in attributes)\r\n                {\r\n                    // eslint-disable-next-line no-prototype-builtins\r\n                    if (attributes.hasOwnProperty(attr))\r\n                    {\r\n                        const attribute: Attribute = attributes[attr];\r\n\r\n                        return attribute.data.length / attribute.size;\r\n                    }\r\n                }\r\n\r\n                return 0;\r\n            })(renderAtomic.attributes);\r\n            if (vertexNum === 0)\r\n            {\r\n                console.warn(`顶点数量为0，不进行渲染！`);\r\n\r\n                return;\r\n            }\r\n            if (instanceCount > 1)\r\n            {\r\n                gl.drawArraysInstanced(renderMode, 0, vertexNum, instanceCount);\r\n            }\r\n            else\r\n            {\r\n                gl.drawArrays(renderMode, 0, vertexNum);\r\n            }\r\n        }\r\n    }\r\n}\r\n","import { gPartial } from '@feng3d/polyfill';\r\nimport { AttributeUsage } from '../gl/enums/AttributeUsage';\r\nimport { GLArrayType } from '../gl/enums/GLArrayType';\r\nimport { GL } from '../gl/GL';\r\nimport { WebGLRenderer } from '../WebGLRenderer';\r\n\r\n/**\r\n * 属性渲染数据\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\r\n */\r\nexport class Attribute\r\n{\r\n    name: string;\r\n\r\n    /**\r\n     * 属性数据\r\n     */\r\n    get data()\r\n    {\r\n        return this._data;\r\n    }\r\n    set data(v)\r\n    {\r\n        this._data = v;\r\n        this.invalidate();\r\n    }\r\n    private _data: number[];\r\n\r\n    /**\r\n     * 数据尺寸\r\n     *\r\n     * A GLint specifying the number of components per vertex attribute. Must be 1, 2, 3, or 4.\r\n     */\r\n    size = 3;\r\n\r\n    /**\r\n     *  A GLenum specifying the data type of each component in the array. Possible values:\r\n            - gl.BYTE: signed 8-bit integer, with values in [-128, 127]\r\n            - gl.SHORT: signed 16-bit integer, with values in [-32768, 32767]\r\n            - gl.UNSIGNED_BYTE: unsigned 8-bit integer, with values in [0, 255]\r\n            - gl.UNSIGNED_SHORT: unsigned 16-bit integer, with values in [0, 65535]\r\n            - gl.FLOAT: 32-bit floating point number\r\n        When using a WebGL 2 context, the following values are available additionally:\r\n           - gl.HALF_FLOAT: 16-bit floating point number\r\n     */\r\n    type: 'BYTE' | 'SHORT' | 'UNSIGNED_BYTE' | 'UNSIGNED_SHORT' | 'FLOAT' | 'UNSIGNED_INT' | 'UNSIGNED_INT' | 'HALF_FLOAT' = GLArrayType.FLOAT;\r\n\r\n    /**\r\n     * A GLboolean specifying whether integer data values should be normalized when being casted to a float.\r\n          -  If true, signed integers are normalized to [-1, 1].\r\n          -  If true, unsigned integers are normalized to [0, 1].\r\n          -  For types gl.FLOAT and gl.HALF_FLOAT, this parameter has no effect.\r\n     */\r\n    normalized = false;\r\n    /**\r\n     * A GLsizei specifying the offset in bytes between the beginning of consecutive vertex attributes. Cannot be larger than 255.\r\n     */\r\n    stride = 0;\r\n    /**\r\n     * A GLintptr specifying an offset in bytes of the first component in the vertex attribute array. Must be a multiple of type.\r\n     */\r\n    offset = 0;\r\n\r\n    /**\r\n     * drawElementsInstanced时将会用到的因子，表示divisor个geometry共用一个数据\r\n     *\r\n     * A GLuint specifying the number of instances that will pass between updates of the generic attribute.\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/ANGLE_instanced_arrays/vertexAttribDivisorANGLE\r\n     */\r\n    divisor = 0;\r\n\r\n    /**\r\n     * A GLenum specifying the intended usage pattern of the data store for optimization purposes.\r\n     *\r\n     * 为优化目的指定数据存储的预期使用模式的GLenum。\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/bufferData\r\n     */\r\n    usage = AttributeUsage.STATIC_DRAW;\r\n\r\n    /**\r\n     * 是否失效\r\n     */\r\n    invalid = true;\r\n\r\n    constructor(source?: gPartial<Attribute>)\r\n    {\r\n        Object.assign(this, source);\r\n    }\r\n\r\n    /**\r\n     * 使数据失效\r\n     */\r\n    invalidate()\r\n    {\r\n        this.invalid = true;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param gl\r\n     * @param location A GLuint specifying the index of the vertex attribute that is to be modified.\r\n     */\r\n    active(gl: GL, location: number)\r\n    {\r\n        gl.enableVertexAttribArray(location);\r\n        const buffer = this.getBuffer(gl);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\r\n        gl.vertexAttribPointer(location, this.size, gl[this.type], this.normalized, this.stride, this.offset);\r\n\r\n        gl.vertexAttribDivisor(location, this.divisor);\r\n    }\r\n\r\n    /**\r\n     * 获取缓冲\r\n     */\r\n    getBuffer(gl: GL)\r\n    {\r\n        if (this.invalid)\r\n        {\r\n            this.clear(this);\r\n            this.invalid = false;\r\n        }\r\n        let buffer = gl.cache.attributes.get(this);\r\n        if (!buffer)\r\n        {\r\n            buffer = gl.createBuffer();\r\n            if (!buffer)\r\n            {\r\n                console.error('createBuffer 失败！');\r\n                throw '';\r\n            }\r\n            gl.cache.attributes.set(this, buffer);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\r\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(this.data), gl[this.usage]);\r\n        }\r\n\r\n        return buffer;\r\n    }\r\n\r\n    /**\r\n     * 清理缓冲\r\n     */\r\n    clear(attribute: Attribute)\r\n    {\r\n        WebGLRenderer.glList.forEach((gl) =>\r\n        {\r\n            const buffer = gl.cache.attributes.get(attribute);\r\n            if (buffer)\r\n            {\r\n                gl.deleteBuffer(buffer);\r\n                gl.cache.attributes.delete(attribute);\r\n            }\r\n        });\r\n    }\r\n}\r\n","import { GL } from '../gl/GL';\r\nimport { WebGLRenderer } from '../WebGLRenderer';\r\n\r\nexport class FrameBuffer\r\n{\r\n    /**\r\n     * 是否失效\r\n     */\r\n    private _invalid = true;\r\n\r\n    static active(gl: GL, frameBuffer: FrameBuffer)\r\n    {\r\n        if (frameBuffer._invalid)\r\n        {\r\n            frameBuffer._invalid = false;\r\n            this.clear(frameBuffer);\r\n        }\r\n\r\n        // Create a framebuffer object (FBO)\r\n        let buffer = gl.cache.frameBuffers.get(frameBuffer);\r\n        if (!buffer)\r\n        {\r\n            buffer = gl.createFramebuffer();\r\n            if (!buffer)\r\n            {\r\n                console.warn('Failed to create frame buffer object');\r\n\r\n                return null;\r\n            }\r\n            gl.cache.frameBuffers.set(frameBuffer, buffer);\r\n        }\r\n\r\n        return buffer;\r\n    }\r\n\r\n    /**\r\n     * 清理缓存\r\n     */\r\n    static clear(frameBuffer: FrameBuffer)\r\n    {\r\n        WebGLRenderer.glList.forEach((gl) =>\r\n        {\r\n            const buffer = gl.cache.frameBuffers.get(frameBuffer);\r\n            if (buffer)\r\n            {\r\n                gl.deleteFramebuffer(buffer);\r\n                gl.cache.frameBuffers.delete(frameBuffer);\r\n            }\r\n        });\r\n    }\r\n}\r\n","import { gPartial } from '@feng3d/polyfill';\r\nimport { GLArrayType } from '../gl/enums/GLArrayType';\r\nimport { GL } from '../gl/GL';\r\nimport { WebGLRenderer } from '../WebGLRenderer';\r\n\r\n/**\r\n * 索引渲染数据\r\n */\r\nexport class Index\r\n{\r\n    /**\r\n     * 索引数据\r\n     */\r\n    get indices()\r\n    {\r\n        return this._indices;\r\n    }\r\n    set indices(v)\r\n    {\r\n        this._indices = v;\r\n        this.invalidate();\r\n    }\r\n    private _indices: number[];\r\n\r\n    constructor(source?: gPartial<Index>)\r\n    {\r\n        Object.assign(this, source);\r\n    }\r\n\r\n    invalidate()\r\n    {\r\n        this._invalid = true;\r\n    }\r\n\r\n    /**\r\n     * 渲染数量\r\n     */\r\n    get count()\r\n    {\r\n        if (!this.indices)\r\n        {\r\n            return 0;\r\n        }\r\n\r\n        return this.indices.length;\r\n    }\r\n\r\n    /**\r\n     * 数据类型，gl.UNSIGNED_BYTE、gl.UNSIGNED_SHORT\r\n     */\r\n    type = GLArrayType.UNSIGNED_INT;\r\n\r\n    /**\r\n     * 索引偏移\r\n     */\r\n    offset = 0;\r\n\r\n    /**\r\n     * 是否失效\r\n     */\r\n    private _invalid = true;\r\n\r\n    /**\r\n     * 激活缓冲\r\n     * @param gl\r\n     */\r\n    active(gl: GL)\r\n    {\r\n        const buffer = Index.getBuffer(gl, this);\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);\r\n    }\r\n\r\n    /**\r\n     * 获取缓冲\r\n     */\r\n    static getBuffer(gl: GL, index: Index)\r\n    {\r\n        if (index._invalid)\r\n        {\r\n            this.clear(index);\r\n            index._invalid = false;\r\n        }\r\n        let buffer = gl.cache.indices.get(index);\r\n        if (!buffer)\r\n        {\r\n            buffer = gl.createBuffer();\r\n            if (!buffer)\r\n            {\r\n                console.error('createBuffer 失败！');\r\n                throw '';\r\n            }\r\n            gl.cache.indices.set(index, buffer);\r\n\r\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);\r\n            gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint32Array(index.indices), gl.STATIC_DRAW);\r\n        }\r\n\r\n        return buffer;\r\n    }\r\n\r\n    /**\r\n     * 清理缓冲\r\n     */\r\n    static clear(index: Index)\r\n    {\r\n        WebGLRenderer.glList.forEach((gl) =>\r\n        {\r\n            const buffer = gl.cache.indices.get(index);\r\n            if (buffer)\r\n            {\r\n                gl.deleteBuffer(buffer);\r\n                gl.cache.indices.delete(index);\r\n            }\r\n        });\r\n    }\r\n}\r\n","import { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { BlendEquation } from '../gl/enums/BlendEquation';\r\nimport { BlendFactor } from '../gl/enums/BlendFactor';\r\nimport { ColorMask } from '../gl/enums/ColorMask';\r\nimport { CullFace } from '../gl/enums/CullFace';\r\nimport { DepthFunc } from '../gl/enums/DepthFunc';\r\nimport { FrontFace } from '../gl/enums/FrontFace';\r\nimport { RenderMode } from '../gl/enums/RenderMode';\r\nimport { StencilFunc } from '../gl/enums/StencilFunc';\r\nimport { StencilOp } from '../gl/enums/StencilOp';\r\nimport { GL } from '../gl/GL';\r\n\r\n/**\r\n * 渲染参数\r\n */\r\nexport class RenderParams\r\n{\r\n    /**\r\n     * 渲染模式，默认 TRIANGLES，每三个顶点绘制一个三角形。\r\n     *\r\n     * A GLenum specifying the type primitive to render. Possible values are:\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/drawElements\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVEnum', tooltip: '渲染模式，默认RenderMode.TRIANGLES', componentParam: { enumClass: RenderMode } })\r\n    renderMode: 'POINTS' | 'LINE_LOOP' | 'LINE_STRIP' | 'LINES' | 'TRIANGLES' | 'TRIANGLE_STRIP' | 'TRIANGLE_FAN' = RenderMode.TRIANGLES;\r\n\r\n    /**\r\n     * 剔除面，默认 BACK，剔除背面。\r\n     *\r\n     * 默认情况下，逆时针的顶点连接顺序被定义为三角形的正面。\r\n     * 使用gl.frontFace(gl.CW);调整顺时针为正面\r\n     *\r\n     * @see http://www.jianshu.com/p/ee04165f2a02\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/cullFace\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVEnum', tooltip: '剔除面', componentParam: { enumClass: CullFace } })\r\n    cullFace: 'NONE' | 'FRONT' | 'BACK' | 'FRONT_AND_BACK' = CullFace.BACK;\r\n\r\n    /**\r\n     * 正向方向，默认 CW。三角形顺时针方向为正面。\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/frontFace\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVEnum', tooltip: '正面方向，默认FrontFace.CW 顺时针为正面', componentParam: { enumClass: FrontFace } })\r\n    frontFace: 'CW' | 'CCW' = FrontFace.CW;\r\n\r\n    /**\r\n     * 是否开启混合，默认 false，不开启混合。\r\n     *\r\n     * <混合后的颜色> = <源颜色>*sfactor + <目标颜色>*dfactor\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/blendEquation\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '是否开启混合' })\r\n    enableBlend = false;\r\n\r\n    /**\r\n     * 混合方式，默认 FUNC_ADD，源 + 目标。\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/blendEquation\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVEnum', tooltip: '混合方式，默认BlendEquation.FUNC_ADD', componentParam: { enumClass: BlendEquation } })\r\n    blendEquation: 'FUNC_ADD' | 'FUNC_SUBTRACT' | 'FUNC_REVERSE_SUBTRACT' = BlendEquation.FUNC_ADD;\r\n\r\n    /**\r\n     * 源混合因子，默认 SRC_ALPHA，将所有颜色乘以源alpha值。\r\n     *\r\n     * @see BlendFactor\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/blendFunc\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVEnum', tooltip: '源混合因子，默认BlendFactor.SRC_ALPHA', componentParam: { enumClass: BlendFactor } })\r\n    sfactor: 'ZERO' | 'ONE' | 'SRC_COLOR' | 'ONE_MINUS_SRC_COLOR' | 'DST_COLOR' | 'ONE_MINUS_DST_COLOR' | 'SRC_ALPHA' | 'ONE_MINUS_SRC_ALPHA' | 'DST_ALPHA' | 'ONE_MINUS_DST_ALPHA' | 'SRC_ALPHA_SATURATE' = BlendFactor.SRC_ALPHA;\r\n\r\n    /**\r\n     * 目标混合因子，默认 ONE_MINUS_SRC_ALPHA，将所有颜色乘以1减去源alpha值。\r\n     *\r\n     * @see BlendFactor\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/blendFunc\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVEnum', tooltip: '目标混合因子，默认BlendFactor.ONE_MINUS_SRC_ALPHA', componentParam: { enumClass: BlendFactor } })\r\n    dfactor: 'ZERO' | 'ONE' | 'SRC_COLOR' | 'ONE_MINUS_SRC_COLOR' | 'DST_COLOR' | 'ONE_MINUS_DST_COLOR' | 'SRC_ALPHA' | 'ONE_MINUS_SRC_ALPHA' | 'DST_ALPHA' | 'ONE_MINUS_DST_ALPHA' | 'SRC_ALPHA_SATURATE' = BlendFactor.ONE_MINUS_SRC_ALPHA;\r\n\r\n    /**\r\n     * 是否开启深度检查，默认 true，开启深度检测。\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/depthFunc\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '是否开启深度检查' })\r\n    depthtest = true;\r\n\r\n    /**\r\n     * 指定深度比较函数的枚举，该函数设置绘制像素的条件，默认 LESS，如果传入值小于深度缓冲区值则通过。\r\n     *\r\n     * A GLenum specifying the depth comparison function, which sets the conditions under which the pixel will be drawn. The default value is gl.LESS.\r\n     *\r\n     * @see DepthFunc\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/depthFunc\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVEnum', tooltip: '深度检测方法', componentParam: { enumClass: DepthFunc } })\r\n    depthFunc: 'NEVER' | 'LESS' | 'EQUAL' | 'LEQUAL' | 'GREATER' | 'NOTEQUAL' | 'GEQUAL' | 'ALWAYS' = DepthFunc.LESS;\r\n\r\n    /**\r\n     * 是否开启深度标记\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/depthMask\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '是否开启深度标记' })\r\n    depthMask = true;\r\n\r\n    /**\r\n     * 控制那些颜色分量是否可以被写入到帧缓冲器。\r\n     *\r\n     * [red, green, blue, alpha]\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/colorMask\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVEnum', tooltip: '深度检测方法', componentParam: { enumClass: ColorMask } })\r\n    colorMask = ColorMask.RGBA;\r\n\r\n    /**\r\n     * 是否使用 viewport，默认不使用，不使用时viewport为画布区域。\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/viewport\r\n     */\r\n    @oav({ tooltip: '是否使用 viewRect' })\r\n    @serialize\r\n    useViewPort = false;\r\n\r\n    /**\r\n     * 通过WebGL API的WebGLRenderingContext.viewport()方法设置了viewport，指定了x和y从标准化设备坐标到窗口坐标的仿射变换。\r\n     *\r\n     * The WebGLRenderingContext.viewport() method of the WebGL API sets the viewport, which specifies the affine transformation of x and y from normalized device coordinates to window coordinates.\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/viewport\r\n     */\r\n    @oav({ tooltip: '绘制在画布上的区域' })\r\n    @serialize\r\n    viewPort: { x: number, y: number, width: number, height: number } = { x: 0, y: 0, width: 100, height: 100 };\r\n\r\n    /**\r\n     * 是否开启剪刀裁剪，默认不开启。\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/scissor\r\n     */\r\n    @oav({ tooltip: 'https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/scissor' })\r\n    @serialize\r\n    useScissor = false;\r\n\r\n    /**\r\n     * WebGL API的WebGLRenderingContext.scissor()方法设置了一个剪刀盒，它将绘图限制为一个指定的矩形。\r\n     *\r\n     * The WebGLRenderingContext.scissor() method of the WebGL API sets a scissor box, which limits the drawing to a specified rectangle.\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/scissor\r\n     */\r\n    @oav({ tooltip: 'https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/scissor' })\r\n    @serialize\r\n    scissor: { x: number, y: number, width: number, height: number } = { x: 0, y: 0, width: 100, height: 100 };\r\n\r\n    /**\r\n     * 是否开启 gl.POLYGON_OFFSET_FILL，默认不开启。\r\n     *\r\n     * WebGL API的WebGLRenderingContext.polygonOffset()方法指定了计算深度值的比例因子和单位。\r\n     * 在执行深度测试和将值写入深度缓冲区之前添加偏移量。\r\n     *\r\n     * The WebGLRenderingContext.polygonOffset() method of the WebGL API specifies the scale factors and units to calculate depth values.\r\n     * The offset is added before the depth test is performed and before the value is written into the depth buffer.\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/polygonOffset\r\n     */\r\n    @oav({ tooltip: 'The WebGLRenderingContext.polygonOffset() method of the WebGL API specifies the scale factors and units to calculate depth values.' })\r\n    @serialize\r\n    usePolygonOffset = false;\r\n\r\n    /**\r\n     * 为每个多边形设置可变深度偏移的比例因子。缺省值为0。\r\n     *\r\n     * A GLfloat which sets the scale factor for the variable depth offset for each polygon. The default value is 0.\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/polygonOffset\r\n     */\r\n    @oav({ tooltip: 'A GLfloat which sets the scale factor for the variable depth offset for each polygon. The default value is 0.' })\r\n    @serialize\r\n    polygonOffsetFactor = 0;\r\n\r\n    /**\r\n     * 它设置特定于实现的值乘以的乘数，以创建恒定的深度偏移量。缺省值为0。\r\n     *\r\n     * A GLfloat which sets the multiplier by which an implementation-specific value is multiplied with to create a constant depth offset. The default value is 0.\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/polygonOffset\r\n     */\r\n    @oav({ tooltip: 'A GLfloat which sets the multiplier by which an implementation-specific value is multiplied with to create a constant depth offset. The default value is 0.' })\r\n    @serialize\r\n    polygonOffsetUnits = 0;\r\n\r\n    /**\r\n     * 是否开启模板测试与更新模板缓冲。\r\n     *\r\n     * Activates stencil testing and updates to the stencil buffer.\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/stencilFunc\r\n     */\r\n    @oav({ tooltip: 'Activates stencil testing and updates to the stencil buffer. See WebGLRenderingContext.stencilFunc().' })\r\n    @serialize\r\n    useStencil = false;\r\n\r\n    /**\r\n     * 描述模板测试的方法。默认ALWAYS，总是通过。\r\n     *\r\n     * A GLenum specifying the test function. The default function is gl.ALWAYS.\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/stencilFunc\r\n     */\r\n    @oav({ tooltip: 'A GLenum specifying the test function. The default function is gl.ALWAYS. ', component: 'OAVEnum', componentParam: { enumClass: StencilFunc } })\r\n    @serialize\r\n    stencilFunc: 'NEVER' | 'LESS' | 'EQUAL' | 'LEQUAL' | 'GREATER' | 'NOTEQUAL' | 'GEQUAL' | 'ALWAYS' = StencilFunc.ALWAYS;\r\n\r\n    /**\r\n     * 一个为模板测试指定参考值。这个值被限制在0到2^n -1的范围内，其中n是模板缓冲区中的位数。默认0。\r\n     *\r\n     * A GLint specifying the reference value for the stencil test. This value is clamped to the range 0 to 2^n -1 where n is the number of bitplanes in the stencil buffer. The default value is 0.\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/stencilFunc\r\n     */\r\n    @oav({ tooltip: 'A GLint specifying the reference value for the stencil test. This value is clamped to the range 0 to 2^n -1 where n is the number of bitplanes in the stencil buffer. The default value is 0. ' })\r\n    @serialize\r\n    stencilFuncRef = 0;\r\n\r\n    /**\r\n     * 模板测试时使用的mask值，默认1。\r\n     *\r\n     * A GLuint specifying a bit-wise mask that is used to AND the reference value and the stored stencil value when the test is done. The default value is all 1.\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/stencilFunc\r\n     */\r\n    @oav({ tooltip: 'A GLuint specifying a bit-wise mask that is used to AND the reference value and the stored stencil value when the test is done. The default value is all 1.' })\r\n    @serialize\r\n    stencilFuncMask = 1;\r\n\r\n    /**\r\n     * 指定模板测试失败时使用的函数的枚举。默认KEEP，保持当前值。\r\n     *\r\n     * A GLenum specifying the function to use when the stencil test fails. The default value is gl.KEEP.\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/stencilMask\r\n     */\r\n    @oav({ tooltip: 'A GLenum specifying the function to use when the stencil test fails. The default value is gl.KEEP.', component: 'OAVEnum', componentParam: { enumClass: StencilOp } })\r\n    @serialize\r\n    stencilOpFail: 'KEEP' | 'ZERO' | 'REPLACE' | 'INCR' | 'INCR_WRAP' | 'DECR' | 'DECR_WRAP' | 'INVERT' = StencilOp.KEEP;\r\n\r\n    /**\r\n     * 指定在模板测试通过但深度测试失败时使用的函数枚举。默认KEEP，保持当前值。\r\n     *\r\n     * A GLenum specifying the function to use when the stencil test passes, but the depth test fails. The default value is gl.KEEP.\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/stencilMask\r\n     */\r\n    @oav({ tooltip: 'A GLenum specifying the function to use when the stencil test passes, but the depth test fails. The default value is gl.KEEP.', component: 'OAVEnum', componentParam: { enumClass: StencilOp } })\r\n    @serialize\r\n    stencilOpZFail: 'KEEP' | 'ZERO' | 'REPLACE' | 'INCR' | 'INCR_WRAP' | 'DECR' | 'DECR_WRAP' | 'INVERT' = StencilOp.KEEP;\r\n\r\n    /**\r\n     * 指定在模板测试和深度测试通过时使用的函数枚举，或在模板测试通过且没有深度缓冲或禁用深度测试时使用的函数枚举。默认KEEP，保持当前值。\r\n     *\r\n     * A GLenum specifying the function to use when both the stencil test and the depth test pass, or when the stencil test passes and there is no depth buffer or depth testing is disabled. The default value is gl.KEEP.\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/stencilMask\r\n     */\r\n    @oav({ tooltip: 'A GLenum specifying the function to use when both the stencil test and the depth test pass, or when the stencil test passes and there is no depth buffer or depth testing is disabled. The default value is gl.KEEP.', component: 'OAVEnum', componentParam: { enumClass: StencilOp } })\r\n    @serialize\r\n    stencilOpZPass: 'KEEP' | 'ZERO' | 'REPLACE' | 'INCR' | 'INCR_WRAP' | 'DECR' | 'DECR_WRAP' | 'INVERT' = StencilOp.KEEP;\r\n\r\n    /**\r\n     * 指定位掩码以启用或禁用在模板平面中写入单个位的正整数。默认1。\r\n     *\r\n     * A GLuint specifying a bit mask to enable or disable writing of individual bits in the stencil planes. By default, the mask is all 1.\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/stencilMask\r\n     */\r\n    @oav({ tooltip: 'A GLuint specifying a bit mask to enable or disable writing of individual bits in the stencil planes. By default, the mask is all 1.' })\r\n    @serialize\r\n    stencilMask = 1;\r\n\r\n    constructor(raw?: Partial<RenderParams>)\r\n    {\r\n        Object.assign(this, raw);\r\n    }\r\n\r\n    /**\r\n     * 更新渲染参数\r\n     *\r\n     * @param gl WebGL渲染上下文\r\n     */\r\n    updateRenderParams(gl: GL)\r\n    {\r\n        const cullfaceEnum = this.cullFace;\r\n        const blendEquation = gl[this.blendEquation];\r\n        const sfactor = gl[this.sfactor];\r\n        const dfactor = gl[this.dfactor];\r\n        const cullFace = gl[this.cullFace];\r\n        const frontFace = gl[this.frontFace];\r\n        const enableBlend = this.enableBlend;\r\n        const depthtest = this.depthtest;\r\n        const depthMask = this.depthMask;\r\n        const depthFunc = gl[this.depthFunc];\r\n        let viewPort = this.viewPort;\r\n        const useViewPort = this.useViewPort;\r\n        const useScissor = this.useScissor;\r\n        const scissor = this.scissor;\r\n        const colorMask = this.colorMask;\r\n        const colorMaskB = [ColorMask.R, ColorMask.G, ColorMask.B, ColorMask.A].map((v) => !!(colorMask & v));\r\n\r\n        const usePolygonOffset = this.usePolygonOffset;\r\n        const polygonOffsetFactor = this.polygonOffsetFactor;\r\n        const polygonOffsetUnits = this.polygonOffsetUnits;\r\n\r\n        const useStencil = this.useStencil;\r\n        const stencilFunc = gl[this.stencilFunc];\r\n        const stencilFuncRef = this.stencilFuncRef;\r\n        const stencilFuncMask = this.stencilFuncMask;\r\n        const stencilOpFail = gl[this.stencilOpFail];\r\n        const stencilOpZFail = gl[this.stencilOpZFail];\r\n        const stencilOpZPass = gl[this.stencilOpZPass];\r\n        const stencilMask = this.stencilMask;\r\n\r\n        if (!useViewPort)\r\n        {\r\n            viewPort = { x: 0, y: 0, width: gl.canvas.width, height: gl.canvas.height };\r\n        }\r\n\r\n        if (cullfaceEnum !== CullFace.NONE)\r\n        {\r\n            gl.enable(gl.CULL_FACE);\r\n            gl.cullFace(cullFace);\r\n            gl.frontFace(frontFace);\r\n        }\r\n        else\r\n        {\r\n            gl.disable(gl.CULL_FACE);\r\n        }\r\n\r\n        if (enableBlend)\r\n        {\r\n            //\r\n            gl.enable(gl.BLEND);\r\n            gl.blendEquation(blendEquation);\r\n            gl.blendFunc(sfactor, dfactor);\r\n        }\r\n        else\r\n        {\r\n            gl.disable(gl.BLEND);\r\n        }\r\n\r\n        if (depthtest)\r\n        {\r\n            gl.enable(gl.DEPTH_TEST);\r\n            gl.depthFunc(depthFunc);\r\n        }\r\n        else\r\n        {\r\n            gl.disable(gl.DEPTH_TEST);\r\n        }\r\n        gl.depthMask(depthMask);\r\n\r\n        gl.colorMask(colorMaskB[0], colorMaskB[1], colorMaskB[2], colorMaskB[3]);\r\n\r\n        gl.viewport(viewPort.x, viewPort.y, viewPort.width, viewPort.height);\r\n\r\n        if (usePolygonOffset)\r\n        {\r\n            gl.enable(gl.POLYGON_OFFSET_FILL);\r\n            gl.polygonOffset(polygonOffsetFactor, polygonOffsetUnits);\r\n        }\r\n        else\r\n        {\r\n            gl.disable(gl.POLYGON_OFFSET_FILL);\r\n        }\r\n\r\n        if (useScissor)\r\n        {\r\n            gl.enable(gl.SCISSOR_TEST);\r\n            gl.scissor(scissor.x, scissor.y, scissor.width, scissor.height);\r\n        }\r\n        else\r\n        {\r\n            gl.disable(gl.SCISSOR_TEST);\r\n        }\r\n\r\n        if (useStencil)\r\n        {\r\n            if (gl.capabilities.stencilBits === 0)\r\n            {\r\n                console.warn(`${gl} 不支持 stencil，参考 https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/getContext WebGL context attributes: stencil`);\r\n            }\r\n            gl.enable(gl.STENCIL_TEST);\r\n            gl.stencilFunc(stencilFunc, stencilFuncRef, stencilFuncMask);\r\n            gl.stencilOp(stencilOpFail, stencilOpZFail, stencilOpZPass);\r\n            gl.stencilMask(stencilMask);\r\n        }\r\n        else\r\n        {\r\n            gl.disable(gl.STENCIL_TEST);\r\n        }\r\n    }\r\n}\r\n","/**\r\n * 纹理数据类型\r\n * A GLenum specifying the data type of the texel data\r\n *\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texImage2D\r\n */\r\nexport enum TextureDataType\r\n{\r\n    /**\r\n     * 8 bits per channel for gl.RGBA\r\n     */\r\n    UNSIGNED_BYTE = 'UNSIGNED_BYTE',\r\n    /**\r\n     * 5 red bits, 6 green bits, 5 blue bits.\r\n     */\r\n    UNSIGNED_SHORT_5_6_5 = 'UNSIGNED_SHORT_5_6_5',\r\n    /**\r\n     * 4 red bits, 4 green bits, 4 blue bits, 4 alpha bits.\r\n     */\r\n    UNSIGNED_SHORT_4_4_4_4 = 'UNSIGNED_SHORT_4_4_4_4',\r\n    /**\r\n     * 5 red bits, 5 green bits, 5 blue bits, 1 alpha bit.\r\n     */\r\n    UNSIGNED_SHORT_5_5_5_1 = 'UNSIGNED_SHORT_5_5_5_1',\r\n    // /**\r\n    //  * When using the WEBGL_depth_texture extension:\r\n    //  */\r\n    // UNSIGNED_SHORT = 'UNSIGNED_SHORT',\r\n    // /**\r\n    //  * When using the WEBGL_depth_texture extension:\r\n    //  */\r\n    // UNSIGNED_INT = 'UNSIGNED_INT',\r\n    // /**\r\n    //  * When using the WEBGL_depth_texture extension:\r\n    //  *  (constant provided by the extension)\r\n    //  */\r\n    // UNSIGNED_INT_24_8_WEBGL = 'UNSIGNED_INT_24_8_WEBGL',\r\n    // //When using the OES_texture_half_float extension:\r\n    // /**\r\n    //  * When using the OES_texture_float extension:\r\n    //  */\r\n    // FLOAT = 'FLOAT',\r\n    // /**\r\n    //  * When using the OES_texture_half_float extension:\r\n    //  *  (constant provided by the extension)\r\n    //  */\r\n    // HALF_FLOAT_OES = 'HALF_FLOAT_OES',\r\n    // // When using a WebGL 2 context, the following values are available additionally:\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // BYTE = 'BYTE',\r\n    // // UNSIGNED_SHORT   // 与上面合并处理\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // SHORT = 'SHORT',\r\n    // // UNSIGNED_INT     // 与上面合并处理\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // INT = 'INT',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // HALF_FLOAT = 'HALF_FLOAT',\r\n    // // FLOAT               // 与上面合并处理\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // UNSIGNED_INT_2_10_10_10_REV = 'UNSIGNED_INT_2_10_10_10_REV',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // UNSIGNED_INT_10F_11F_11F_REV = 'UNSIGNED_INT_10F_11F_11F_REV',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // UNSIGNED_INT_5_9_9_9_REV = 'UNSIGNED_INT_5_9_9_9_REV',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // UNSIGNED_INT_24_8 = 'UNSIGNED_INT_24_8',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  *  (pixels must be null)\r\n    //  */\r\n    // FLOAT_32_UNSIGNED_INT_24_8_REV = 'FLOAT_32_UNSIGNED_INT_24_8_REV',\r\n}\r\n","/**\r\n * 纹理颜色格式\r\n * A GLint specifying the color components in the texture\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texImage2D\r\n */\r\nexport enum TextureFormat\r\n{\r\n    /**\r\n     * Discards the red, green and blue components and reads the alpha component.\r\n     */\r\n    ALPHA = 'ALPHA',\r\n    /**\r\n     *  Discards the alpha components and reads the red, green and blue components.\r\n     */\r\n    RGB = 'RGB',\r\n    /**\r\n     * Red, green, blue and alpha components are read from the color buffer.\r\n     */\r\n    RGBA = 'RGBA',\r\n    /**\r\n     * Each color component is a luminance component, alpha is 1.0.\r\n     */\r\n    LUMINANCE = 'LUMINANCE',\r\n    /**\r\n     * Each component is a luminance/alpha component.\r\n     */\r\n    LUMINANCE_ALPHA = 'LUMINANCE_ALPHA',\r\n\r\n    // /**\r\n    //  * When using the WEBGL_depth_texture extension:\r\n    //  */\r\n    // DEPTH_COMPONENT = 'DEPTH_COMPONENT',\r\n    // /**\r\n    //  * When using the WEBGL_depth_texture extension:\r\n    //  */\r\n    // DEPTH_STENCIL = 'DEPTH_STENCIL',\r\n    // /**\r\n    //  * When using the EXT_sRGB extension:\r\n    //  */\r\n    // SRGB_EXT = 'SRGB_EXT',\r\n    // /**\r\n    //  * When using the EXT_sRGB extension:\r\n    //  */\r\n    // SRGB_ALPHA_EXT = 'SRGB_ALPHA_EXT',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // R8 = 'R8',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // R16F = 'R16F',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // R32F = 'R32F',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // R8UI = 'R8UI',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // RG8 = 'RG8',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // RG16F = 'RG16F',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // RG32F = 'RG32F',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // RG8UI = 'RG8UI',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // RG16UI = 'RG16UI',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // RG32UI = 'RG32UI',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // RGB8 = 'RGB8',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // SRGB8 = 'SRGB8',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // RGB565 = 'RGB565',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // R11F_G11F_B10F = 'R11F_G11F_B10F',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // RGB9_E5 = 'RGB9_E5',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // RGB16F = 'RGB16F',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // RGB32F = 'RGB32F',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // RGB8UI = 'RGB8UI',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // RGBA8 = 'RGBA8',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // // SRGB8_APLHA8,\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // RGB5_A1 = 'RGB5_A1',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // RGB10_A2 = 'RGB10_A2',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // RGBA4 = 'RGBA4',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // RGBA16F = 'RGBA16F',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // RGBA32F = 'RGBA32F',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  */\r\n    // RGBA8UI = 'RGBA8UI',\r\n}\r\n","/**\r\n * 纹理放大滤波器\r\n * Texture magnification filter\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texParameter\r\n */\r\nexport enum TextureMagFilter\r\n{\r\n    /**\r\n     *  (default value)\r\n     */\r\n    LINEAR = 'LINEAR',\r\n    NEAREST = 'NEAREST',\r\n}\r\n","/**\r\n * 纹理缩小过滤器\r\n * Texture minification filter\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texParameter\r\n */\r\nexport enum TextureMinFilter\r\n{\r\n    LINEAR = 'LINEAR',\r\n    NEAREST = 'NEAREST',\r\n    NEAREST_MIPMAP_NEAREST = 'NEAREST_MIPMAP_NEAREST',\r\n    LINEAR_MIPMAP_NEAREST = 'LINEAR_MIPMAP_NEAREST',\r\n    /**\r\n     *  (default value)\r\n     */\r\n    NEAREST_MIPMAP_LINEAR = 'NEAREST_MIPMAP_LINEAR',\r\n    LINEAR_MIPMAP_LINEAR = 'LINEAR_MIPMAP_LINEAR',\r\n}\r\n","/**\r\n * 纹理类型\r\n * A GLenum specifying the binding point (target). Possible values:\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/bindTexture\r\n */\r\nexport enum TextureType\r\n{\r\n    /**\r\n     * gl.TEXTURE_2D: A two-dimensional texture.\r\n     */\r\n    TEXTURE_2D = 'TEXTURE_2D',\r\n    /**\r\n     * gl.TEXTURE_CUBE_MAP: A cube-mapped texture.\r\n     */\r\n    TEXTURE_CUBE_MAP = 'TEXTURE_CUBE_MAP',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  * gl.TEXTURE_3D: A three-dimensional texture.\r\n    //  */\r\n    // TEXTURE_3D = 'TEXTURE_3D',\r\n    // /**\r\n    //  * using a WebGL 2 context\r\n    //  * gl.TEXTURE_2D_ARRAY: A two-dimensional array texture.\r\n    //  */\r\n    // TEXTURE_2D_ARRAY = 'TEXTURE_2D_ARRAY',\r\n}\r\n","/**\r\n * 纹理坐标s包装函数枚举\r\n * Wrapping function for texture coordinate s\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texParameter\r\n */\r\nexport enum TextureWrap\r\n{\r\n    /**\r\n     * (default value)\r\n     */\r\n    REPEAT = 'REPEAT',\r\n    CLAMP_TO_EDGE = 'CLAMP_TO_EDGE',\r\n    MIRRORED_REPEAT = 'MIRRORED_REPEAT',\r\n}\r\n","const shaderMacroKeys = ['if', 'ifdef', 'defined'];\r\n\r\nexport class ShaderMacroUtils\r\n{\r\n    /**\r\n     * 从着色器代码中获取宏变量列表\r\n     * @param vertex\r\n     * @param fragment\r\n     */\r\n    getMacroVariablesFromShaderCode(vertex: string, fragment: string)\r\n    {\r\n        const variables0 = this.getMacroVariablesFromCode(vertex);\r\n        const variables1 = this.getMacroVariablesFromCode(fragment);\r\n        for (let i = 0; i < variables1.length; i++)\r\n        {\r\n            const element = variables1[i];\r\n            if (variables0.indexOf(element) === -1)\r\n            {\r\n                variables0.push(element);\r\n            }\r\n        }\r\n\r\n        return variables0;\r\n    }\r\n\r\n    /**\r\n     * 从着色器代码中获取宏变量列表\r\n     * @param code\r\n     */\r\n    getMacroVariablesFromCode(code: string)\r\n    {\r\n        const variables: string[] = [];\r\n        const lines = code.split('\\n');\r\n        for (let i = 0; i < lines.length; i++)\r\n        {\r\n            const line = lines[i];\r\n            if (line.indexOf('#if') !== -1)\r\n            {\r\n                const reg = /(\\w+)/g;\r\n                let result: RegExpExecArray = reg.exec(line);\r\n                while (result)\r\n                {\r\n                    const key = result[1];\r\n                    if (key !== null && isNaN(Number(key)) && shaderMacroKeys.indexOf(key) === -1 && variables.indexOf(key) === -1)\r\n                    {\r\n                        variables.push(key);\r\n                    }\r\n                    result = reg.exec(line);\r\n                }\r\n            }\r\n        }\r\n\r\n        return variables;\r\n    }\r\n}\r\n\r\n/**\r\n * 着色器代码宏工具\r\n */\r\nexport const shaderMacroUtils = new ShaderMacroUtils();\r\n","import { RenderParams } from '../data/RenderParams';\r\nimport { shaderMacroUtils } from './ShaderMacroUtils';\r\n\r\nexport const shaderConfig: ShaderConfig = { shaders: {}, modules: {} };\r\n\r\n/**\r\n * 着色器库，由shader.ts初始化\r\n */\r\nexport interface ShaderConfig\r\n{\r\n    shaders: {\r\n        [shaderName: string]: {\r\n            /**\r\n             * 从glsl读取的vertex shader\r\n             */\r\n            vertex: string,\r\n            /**\r\n             * 从glsl读取的fragment shader\r\n             */\r\n            fragment: string,\r\n            cls?: new (...arg: any[]) => any,\r\n            renderParams?: Partial<RenderParams>,\r\n        }\r\n    },\r\n    /**\r\n     * shader 模块\r\n     */\r\n    modules: {\r\n        [moduleName: string]: string\r\n    }\r\n}\r\n\r\n/**\r\n * 渲染代码库\r\n\r\n */\r\nexport class ShaderLib\r\n{\r\n    get shaderConfig()\r\n    {\r\n        this._shaderConfig = this._shaderConfig || shaderConfig;\r\n\r\n        return this._shaderConfig;\r\n    }\r\n    set shaderConfig(v)\r\n    {\r\n        this._shaderConfig = v;\r\n    }\r\n    private _shaderConfig: ShaderConfig;\r\n\r\n    private _shaderCache: { [shaderName: string]: { vertex: string, fragment: string, vertexMacroVariables: string[], fragmentMacroVariables: string[] } } = {};\r\n\r\n    /**\r\n     * 获取shaderCode\r\n     */\r\n    getShader(shaderName: string)\r\n    {\r\n        if (this._shaderCache[shaderName])\r\n        {\r\n            return this._shaderCache[shaderName];\r\n        }\r\n\r\n        const shader = shaderlib.shaderConfig.shaders[shaderName];\r\n        //\r\n        const vertex = shaderlib.uninclude(shader.vertex);\r\n        //\r\n        const fragment = shaderlib.uninclude(shader.fragment);\r\n        const vertexMacroVariables = shaderMacroUtils.getMacroVariablesFromCode(vertex);\r\n        const fragmentMacroVariables = shaderMacroUtils.getMacroVariablesFromCode(fragment);\r\n\r\n        this._shaderCache[shaderName] = { vertex, fragment, vertexMacroVariables, fragmentMacroVariables };\r\n\r\n        return this._shaderCache[shaderName];\r\n    }\r\n\r\n    /**\r\n     * 展开 include\r\n     */\r\n    uninclude(shaderCode: string)\r\n    {\r\n        // #include 正则表达式\r\n        const includeRegExp = /#include<(.+)>/g;\r\n        //\r\n        let match = includeRegExp.exec(shaderCode);\r\n        while (match)\r\n        {\r\n            let moduleshader = this.shaderConfig.modules[match[1]];\r\n            if (!moduleshader)\r\n            {\r\n                console.error(`无法找到着色器 ${match[1]}`);\r\n            }\r\n            moduleshader = this.uninclude(moduleshader);\r\n            shaderCode = shaderCode.replace(match[0], moduleshader);\r\n            includeRegExp.lastIndex = 0;\r\n            match = includeRegExp.exec(shaderCode);\r\n        }\r\n\r\n        return shaderCode;\r\n    }\r\n\r\n    /**\r\n     * 获取shader列表\r\n     */\r\n    getShaderNames()\r\n    {\r\n        return Object.keys(this.shaderConfig.shaders);\r\n    }\r\n\r\n    /**\r\n     * 清除缓存\r\n     */\r\n    clearCache()\r\n    {\r\n        this._shaderCache = {};\r\n    }\r\n}\r\n\r\n/**\r\n * shader 库\r\n */\r\nexport const shaderlib = new ShaderLib();\r\n","import { gPartial } from '@feng3d/polyfill';\r\nimport { GL } from '../gl/GL';\r\nimport { ShaderMacro } from '../shader/Macro';\r\nimport { shaderlib } from '../shader/ShaderLib';\r\n\r\n/**\r\n * shader\r\n */\r\nexport class Shader\r\n{\r\n    /**\r\n     * shader 中的 宏\r\n     */\r\n    shaderMacro: ShaderMacro = {} as any;\r\n\r\n    constructor(source?: gPartial<Shader>)\r\n    {\r\n        Object.assign(this, source);\r\n    }\r\n\r\n    setShader(vertex: string, fragment: string)\r\n    {\r\n        this.vertex = vertex;\r\n        this.fragment = fragment;\r\n    }\r\n\r\n    /**\r\n     * 激活渲染程序\r\n     */\r\n    activeShaderProgram(gl: GL)\r\n    {\r\n        this.updateShaderCode();\r\n\r\n        const shaderKey = this.vertex + this.fragment;\r\n        let result = gl.cache.compileShaderResults[shaderKey];\r\n        if (result) return result;\r\n\r\n        // 渲染程序\r\n        try\r\n        {\r\n            result = gl.cache.compileShaderResults[shaderKey] = this.compileShaderProgram(gl, this.vertex, this.fragment);\r\n        }\r\n        catch (error)\r\n        {\r\n            console.error(`${this.shaderName} 编译失败！\\n${error}`);\r\n\r\n            return null;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * 着色器名称\r\n     */\r\n    shaderName: string;\r\n    /**\r\n     * 顶点着色器代码\r\n     */\r\n    vertex: string;\r\n    /**\r\n     * 片段着色器代码\r\n     */\r\n    fragment: string;\r\n\r\n    /**\r\n     * 更新渲染代码\r\n     */\r\n    private updateShaderCode()\r\n    {\r\n        if (!this.shaderName) return;\r\n\r\n        // 获取着色器代码\r\n        const result = shaderlib.getShader(this.shaderName);\r\n\r\n        const vMacroCode = this.getMacroCode(result.vertexMacroVariables, this.shaderMacro);\r\n        this.vertex = vMacroCode + result.vertex;\r\n        const fMacroCode = this.getMacroCode(result.fragmentMacroVariables, this.shaderMacro);\r\n        this.fragment = fMacroCode + result.fragment;\r\n    }\r\n\r\n    /**\r\n     * 编译着色器代码\r\n     * @param gl GL上下文\r\n     * @param type 着色器类型\r\n     * @param code 着色器代码\r\n     * @return 编译后的着色器对象\r\n     */\r\n    private compileShaderCode(gl: GL, type: number, code: string)\r\n    {\r\n        const shader = gl.createShader(type);\r\n        if (!shader)\r\n        {\r\n            throw 'unable to create shader';\r\n        }\r\n\r\n        gl.shaderSource(shader, code);\r\n        gl.compileShader(shader);\r\n\r\n        // 检查编译结果\r\n        const compiled = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n        if (!compiled)\r\n        {\r\n            const error = gl.getShaderInfoLog(shader);\r\n            gl.deleteShader(shader);\r\n            throw `Failed to compile shader: ${error}`;\r\n        }\r\n\r\n        return shader;\r\n    }\r\n\r\n    private createLinkProgram(gl: GL, vertexShader: WebGLShader, fragmentShader: WebGLShader)\r\n    {\r\n        // 创建程序对象\r\n        const program = gl.createProgram();\r\n        if (!program)\r\n        {\r\n            throw '创建 WebGLProgram 失败！';\r\n        }\r\n\r\n        // 添加着色器\r\n        gl.attachShader(program, vertexShader);\r\n        gl.attachShader(program, fragmentShader);\r\n\r\n        // 链接程序\r\n        gl.linkProgram(program);\r\n\r\n        // 检查结果\r\n        const linked = gl.getProgramParameter(program, gl.LINK_STATUS);\r\n        if (!linked)\r\n        {\r\n            const error = gl.getProgramInfoLog(program);\r\n            gl.deleteProgram(program);\r\n            gl.deleteShader(fragmentShader);\r\n            gl.deleteShader(vertexShader);\r\n            throw `Failed to link program: ${error}`;\r\n        }\r\n\r\n        return program;\r\n    }\r\n\r\n    private compileShaderProgram(gl: GL, vshader: string, fshader: string): CompileShaderResult\r\n    {\r\n        // 创建着色器程序\r\n        // 编译顶点着色器\r\n        const vertexShader = this.compileShaderCode(gl, gl.VERTEX_SHADER, vshader);\r\n\r\n        // 编译片段着色器\r\n        const fragmentShader = this.compileShaderCode(gl, gl.FRAGMENT_SHADER, fshader);\r\n\r\n        // 创建着色器程序\r\n        const shaderProgram = this.createLinkProgram(gl, vertexShader, fragmentShader);\r\n\r\n        // 获取属性信息\r\n        const numAttributes = gl.getProgramParameter(shaderProgram, gl.ACTIVE_ATTRIBUTES);\r\n        const attributes: { [name: string]: AttributeInfo } = {};\r\n        let i = 0;\r\n        while (i < numAttributes)\r\n        {\r\n            const activeInfo = gl.getActiveAttrib(shaderProgram, i++);\r\n            attributes[activeInfo.name] = { name: activeInfo.name, size: activeInfo.size, type: activeInfo.type, location: gl.getAttribLocation(shaderProgram, activeInfo.name) };\r\n        }\r\n        // 获取uniform信息\r\n        const numUniforms = gl.getProgramParameter(shaderProgram, gl.ACTIVE_UNIFORMS);\r\n        const uniforms: { [name: string]: UniformInfo } = {};\r\n        i = 0;\r\n        let textureID = 0;\r\n        while (i < numUniforms)\r\n        {\r\n            const activeInfo = gl.getActiveUniform(shaderProgram, i++);\r\n            const reg = /(\\w+)/g;\r\n\r\n            let name = activeInfo.name;\r\n            const names = [name];\r\n            if (activeInfo.size > 1)\r\n            {\r\n                console.assert(name.substr(-3, 3) === '[0]');\r\n                const baseName = name.substring(0, name.length - 3);\r\n                for (let j = 1; j < activeInfo.size; j++)\r\n                {\r\n                    names[j] = `${baseName}[${j}]`;\r\n                }\r\n            }\r\n\r\n            for (let j = 0; j < names.length; j++)\r\n            {\r\n                name = names[j];\r\n                let result: RegExpExecArray = reg.exec(name);\r\n                const paths: string[] = [];\r\n                while (result)\r\n                {\r\n                    paths.push(result[1]);\r\n                    result = reg.exec(name);\r\n                }\r\n                uniforms[name] = { name: paths[0], paths, size: activeInfo.size, type: activeInfo.type, location: gl.getUniformLocation(shaderProgram, name), textureID };\r\n                if (activeInfo.type === gl.SAMPLER_2D || activeInfo.type === gl.SAMPLER_CUBE)\r\n                {\r\n                    textureID++;\r\n                }\r\n            }\r\n        }\r\n\r\n        return { program: shaderProgram, vertex: vertexShader, fragment: fragmentShader, attributes, uniforms };\r\n    }\r\n\r\n    private getMacroCode(variables: string[], valueObj: Object)\r\n    {\r\n        let macroHeader = '';\r\n        variables.forEach((macroName) =>\r\n        {\r\n            const value = valueObj[macroName];\r\n            if (typeof value === 'boolean')\r\n            {\r\n                value && (macroHeader += `#define ${macroName}\\n`);\r\n            }\r\n            else if (typeof value === 'number')\r\n            {\r\n                macroHeader += `#define ${macroName} ${value}\\n`;\r\n            }\r\n        });\r\n\r\n        return macroHeader.length > 0 ? (`${macroHeader}\\n`) : macroHeader;\r\n    }\r\n}\r\n\r\nexport interface CompileShaderResult\r\n{\r\n    program: WebGLProgram, vertex: WebGLShader, fragment: WebGLShader\r\n    /**\r\n     * 属性信息列表\r\n     */\r\n    attributes: { [name: string]: AttributeInfo };\r\n    /**\r\n     * uniform信息列表\r\n     */\r\n    uniforms: { [name: string]: UniformInfo };\r\n}\r\n\r\n/**\r\n * WebGL渲染程序有效信息\r\n */\r\nexport interface UniformInfo\r\n{\r\n    /**\r\n     * uniform名称\r\n     */\r\n    name: string;\r\n\r\n    size: number;\r\n    type: number;\r\n    /**\r\n     * uniform地址\r\n     */\r\n    location: WebGLUniformLocation;\r\n    /**\r\n     * texture索引\r\n     */\r\n    textureID: number;\r\n\r\n    /**\r\n     * Uniform数组索引，当Uniform数据为数组数据时生效\r\n     */\r\n    paths: string[];\r\n}\r\n\r\nexport interface AttributeInfo\r\n{\r\n    /**\r\n     * 名称\r\n     */\r\n    name: string;\r\n\r\n    size: number;\r\n    type: number;\r\n\r\n    /**\r\n     * 属性地址\r\n     */\r\n    location: number;\r\n}\r\n","import { gPartial, Lazy, lazy } from '@feng3d/polyfill';\r\nimport { ShaderMacro } from '../shader/Macro';\r\nimport { Attribute } from './Attribute';\r\nimport { Attributes } from './Attributes';\r\nimport { Index } from './Index';\r\nimport { RenderParams } from './RenderParams';\r\nimport { Shader } from './Shader';\r\nimport { LazyUniforms, Uniforms } from './Uniform';\r\n\r\ndeclare global\r\n{\r\n    interface MixinsRenderAtomic\r\n    {\r\n\r\n    }\r\n}\r\n\r\nexport interface RenderAtomic extends MixinsRenderAtomic { }\r\n\r\n/**\r\n * 渲染原子（该对象会收集一切渲染所需数据以及参数）\r\n */\r\nexport class RenderAtomic\r\n{\r\n    /**\r\n     * 下一个结点\r\n     */\r\n    next: RenderAtomic;\r\n\r\n    /**\r\n     * 顶点索引缓冲\r\n     */\r\n    get index()\r\n    {\r\n        return this._index;\r\n    }\r\n    set index(v)\r\n    {\r\n        if (v instanceof Index)\r\n        {\r\n            this._index = v;\r\n        }\r\n        else\r\n        {\r\n            this._index = new Index(v);\r\n        }\r\n    }\r\n    private _index: Index;\r\n\r\n    /**\r\n     * 属性数据列表\r\n     */\r\n    get attributes()\r\n    {\r\n        return this._attributes;\r\n    }\r\n\r\n    set attributes(v)\r\n    {\r\n        this._attributes = {} as any;\r\n        for (const key in v)\r\n        {\r\n            if (v[key] instanceof Attribute)\r\n            {\r\n                this._attributes[key] = v[key];\r\n            }\r\n            else\r\n            {\r\n                this._attributes[key] = new Attribute(v[key]);\r\n            }\r\n        }\r\n    }\r\n\r\n    private _attributes: Attributes = {} as any;\r\n\r\n    /**\r\n     * Uniform渲染数据\r\n     */\r\n    uniforms: LazyUniforms = {} as any;\r\n\r\n    /**\r\n     * 渲染实例数量\r\n     */\r\n    instanceCount: Lazy<number>;\r\n\r\n    /**\r\n     * 渲染程序\r\n     */\r\n    get shader()\r\n    {\r\n        return this._shader;\r\n    }\r\n    set shader(v)\r\n    {\r\n        if (v instanceof Shader)\r\n        {\r\n            this._shader = v;\r\n        }\r\n        else\r\n        {\r\n            this._shader = new Shader(v);\r\n        }\r\n    }\r\n    private _shader: Shader;\r\n\r\n    /**\r\n     * shader 中的 宏\r\n     */\r\n    shaderMacro: ShaderMacro = {} as any;\r\n\r\n    /**\r\n     * 渲染参数\r\n     */\r\n    get renderParams()\r\n    {\r\n        return this._renderParams;\r\n    }\r\n    set renderParams(v)\r\n    {\r\n        if (v instanceof RenderParams)\r\n        {\r\n            this._renderParams = v;\r\n        }\r\n        else\r\n        {\r\n            this._renderParams = new RenderParams(v);\r\n        }\r\n    }\r\n    private _renderParams = new RenderParams();\r\n\r\n    constructor(source?: gPartial<RenderAtomic>)\r\n    {\r\n        Object.assign(this, source);\r\n    }\r\n\r\n    getIndexBuffer(): Index\r\n    {\r\n        if (this.index !== undefined) return this.index;\r\n\r\n        return (this.next && this.next.getIndexBuffer());\r\n    }\r\n\r\n    getAttributes(attributes: Attributes = {} as any)\r\n    {\r\n        this.next && this.next.getAttributes(attributes);\r\n        Object.assign(attributes, this.attributes);\r\n\r\n        return attributes;\r\n    }\r\n\r\n    getAttributeByKey(key: string): Attribute\r\n    {\r\n        if (this.attributes[key] !== undefined) return this.attributes[key];\r\n\r\n        return (this.next && this.next.getAttributeByKey(key));\r\n    }\r\n\r\n    getUniforms(uniforms: LazyUniforms = {} as any)\r\n    {\r\n        this.next && this.next.getUniforms(uniforms);\r\n        Object.assign(uniforms, this.uniforms);\r\n\r\n        return uniforms;\r\n    }\r\n\r\n    getUniformByKey(key: string): Uniforms\r\n    {\r\n        if (this.uniforms[key] !== undefined) return lazy.getvalue(this.uniforms[key]);\r\n\r\n        return (this.next && this.next.getUniformByKey(key));\r\n    }\r\n\r\n    getInstanceCount(): number\r\n    {\r\n        if (this.instanceCount !== undefined) return lazy.getvalue(this.instanceCount);\r\n\r\n        return this.next && this.next.getInstanceCount();\r\n    }\r\n\r\n    getShader(): Shader\r\n    {\r\n        if (this.shader !== undefined) return this.shader;\r\n\r\n        return this.next && this.next.getShader();\r\n    }\r\n\r\n    getRenderParams(renderParams = new RenderParams())\r\n    {\r\n        this.next && this.next.getRenderParams(renderParams);\r\n        Object.assign(renderParams, this.renderParams);\r\n\r\n        return renderParams;\r\n    }\r\n\r\n    getShaderMacro(shaderMacro: ShaderMacro = {} as any)\r\n    {\r\n        this.next && this.next.getShaderMacro(shaderMacro);\r\n        Object.assign(shaderMacro, this.shaderMacro);\r\n\r\n        return shaderMacro;\r\n    }\r\n}\r\n\r\nexport interface RenderAtomicData\r\n{\r\n    shader: Shader;\r\n    attributes: { [name: string]: Attribute; };\r\n    uniforms: { [name: string]: Uniforms; };\r\n    renderParams: RenderParams;\r\n    index: Index;\r\n    instanceCount: number;\r\n}\r\n","import { GL } from './gl/GL';\r\nimport { WebGLRenderer } from './WebGLRenderer';\r\n\r\nexport class RenderBuffer\r\n{\r\n    get OFFSCREEN_WIDTH()\r\n    {\r\n        return this._OFFSCREEN_WIDTH;\r\n    }\r\n    set OFFSCREEN_WIDTH(v)\r\n    {\r\n        this._OFFSCREEN_WIDTH = v;\r\n        this.invalidate();\r\n    }\r\n    private _OFFSCREEN_WIDTH = 1024;\r\n\r\n    get OFFSCREEN_HEIGHT()\r\n    {\r\n        return this._OFFSCREEN_HEIGHT;\r\n    }\r\n    set OFFSCREEN_HEIGHT(v)\r\n    {\r\n        this._OFFSCREEN_HEIGHT = v;\r\n        this.invalidate();\r\n    }\r\n    private _OFFSCREEN_HEIGHT = 1024;\r\n\r\n    /**\r\n     * 是否失效\r\n     */\r\n    private _invalid = true;\r\n\r\n    /**\r\n     * 使失效\r\n     */\r\n    protected invalidate()\r\n    {\r\n        this._invalid = true;\r\n    }\r\n\r\n    /**\r\n     * 激活\r\n     * @param gl\r\n     */\r\n    static active(gl: GL, renderBuffer: RenderBuffer)\r\n    {\r\n        if (renderBuffer._invalid)\r\n        {\r\n            this.clear(renderBuffer);\r\n            renderBuffer._invalid = false;\r\n        }\r\n\r\n        let buffer = gl.cache.renderBuffers.get(renderBuffer);\r\n        if (!buffer)\r\n        {\r\n            // Create a renderbuffer object and Set its size and parameters\r\n            buffer = gl.createRenderbuffer(); // Create a renderbuffer object\r\n            if (!buffer)\r\n            {\r\n                console.warn('Failed to create renderbuffer object');\r\n\r\n                return;\r\n            }\r\n            gl.cache.renderBuffers.set(renderBuffer, buffer);\r\n            gl.bindRenderbuffer(gl.RENDERBUFFER, buffer);\r\n            gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, renderBuffer.OFFSCREEN_WIDTH, renderBuffer.OFFSCREEN_HEIGHT);\r\n        }\r\n\r\n        return buffer;\r\n    }\r\n\r\n    /**\r\n     * 清理纹理\r\n     */\r\n    static clear(renderBuffer: RenderBuffer)\r\n    {\r\n        WebGLRenderer.glList.forEach((gl) =>\r\n        {\r\n            const buffer = gl.cache.renderBuffers.get(renderBuffer);\r\n            if (buffer)\r\n            {\r\n                gl.deleteRenderbuffer(buffer);\r\n                gl.cache.renderBuffers.delete(renderBuffer);\r\n            }\r\n        });\r\n    }\r\n}\r\n","/**\r\n * 加载数据类型\r\n */\r\nexport enum LoaderDataFormat\r\n{\r\n    /**\r\n     * 以原始二进制数据形式接收下载的数据。\r\n     */\r\n    BINARY = 'binary',\r\n    /**\r\n     * 以文本形式接收已下载的数据。\r\n     */\r\n    TEXT = 'text',\r\n    /**\r\n     * 图片数据\r\n     */\r\n    IMAGE = 'image',\r\n}\r\n","/**\r\n * 任务函数\r\n */\r\nexport interface TaskFunction\r\n{\r\n    /**\r\n     * 函数自身名称\r\n     */\r\n    readonly name?: string;\r\n    /**\r\n     * 函数自身\r\n     */\r\n    (callback: () => void): void;\r\n}\r\n\r\n/**\r\n * 任务\r\n *\r\n * 处理 异步任务(函数)串联并联执行功能\r\n */\r\nclass Task\r\n{\r\n    /**\r\n     * 并联多个异步函数为一个函数\r\n     *\r\n     * 这些异步函数同时执行\r\n     *\r\n     * @param fns 一组异步函数\r\n     */\r\n    parallel(fns: TaskFunction[]): TaskFunction\r\n    {\r\n        const result: TaskFunction = (callback) =>\r\n        {\r\n            if (fns.length === 0)\r\n            {\r\n                callback();\r\n\r\n                return;\r\n            }\r\n            let index = 0;\r\n\r\n            fns.forEach((fn) =>\r\n            {\r\n                let callbackNum = 0;\r\n\r\n                fn(() =>\r\n                {\r\n                    callbackNum++;\r\n                    if (callbackNum === 1)\r\n                    {\r\n                        index++;\r\n                        if (index === fns.length)\r\n                        {\r\n                            callback();\r\n                        }\r\n                    }\r\n                    else { console.warn(`${fn.name ? `函数${fn.name}` : '匿名函数'} 多次调用回调函数，当前次数 ${callbackNum}`); }\r\n                });\r\n            });\r\n        };\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * 串联多个异步函数为一个函数\r\n     *\r\n     * 这些异步函数按顺序依次执行，等待前一个异步函数执行完调用回调后才执行下一个异步函数。\r\n     *\r\n     * @param fns 一组异步函数\r\n     */\r\n    series(fns: TaskFunction[]): TaskFunction\r\n    {\r\n        const result: TaskFunction = (callback) =>\r\n        {\r\n            if (fns.length === 0)\r\n            {\r\n                callback();\r\n\r\n                return;\r\n            }\r\n            let index = 0;\r\n            const next = () =>\r\n            {\r\n                const fn = fns[index];\r\n                let callbackNum = 0;\r\n\r\n                fn(() =>\r\n                {\r\n                    callbackNum++;\r\n                    if (callbackNum === 1)\r\n                    {\r\n                        index++;\r\n                        if (index < fns.length)\r\n                        {\r\n                            next();\r\n                        }\r\n                        else\r\n                        {\r\n                            callback && callback();\r\n                        }\r\n                    }\r\n                    else { console.warn(`${fn.name ? `函数${fn.name}` : '匿名函数'} 多次调用回调函数，当前次数 ${callbackNum}`); }\r\n                });\r\n            };\r\n\r\n            next();\r\n        };\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * 创建一组并行同类任务，例如同时加载一组资源，并在回调中返回结果数组\r\n     *\r\n     * @param ps 一组参数\r\n     * @param fn 单一任务函数\r\n     * @param done 完成回调\r\n     */\r\n    parallelResults<P, R>(ps: P[], fn: (p: P, callback: (r: R) => void) => void, done: (rs: R[]) => void)\r\n    {\r\n        const map = new Map();\r\n        // 包装函数\r\n        const fns = ps.map((p) => (callback: () => void) =>\r\n        {\r\n            fn(p, (r) =>\r\n            {\r\n                map.set(p, r);\r\n                callback();\r\n            });\r\n        });\r\n\r\n        this.parallel(fns)(() =>\r\n        {\r\n            const results = ps.map((p) =>\r\n                map.get(p));\r\n\r\n            map.clear();\r\n            done(results);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 创建一组串联同类任务，例如排序加载一组资源\r\n     *\r\n     * @param ps 一组参数\r\n     * @param fn 单一任务函数\r\n     * @param done 完成回调\r\n     */\r\n    seriesResults<P, R>(ps: P[], fn: (p: P, callback: (r: R) => void) => void, done: (rs: R[]) => void)\r\n    {\r\n        const map = new Map();\r\n        // 包装函数\r\n        const fns = ps.map((p) => (callback: () => void) =>\r\n        {\r\n            fn(p, (r) =>\r\n            {\r\n                map.set(p, r);\r\n                callback();\r\n            });\r\n        });\r\n\r\n        this.series(fns)(() =>\r\n        {\r\n            const results = ps.map((p) =>\r\n                map.get(p));\r\n\r\n            map.clear();\r\n            done(results);\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * 任务，用于处理任务之间依赖\r\n */\r\nexport const task = new Task();\r\n","import { LoaderDataFormat } from './LoaderDataFormat';\r\n\r\n/**\r\n * 加载类\r\n */\r\nexport class Loader\r\n{\r\n    /**\r\n     * 加载文本\r\n     * @param url 路径\r\n     */\r\n    loadText(url: string, onCompleted?: (content: string) => void, onRequestProgress?: () => void, onError?: (e: Error) => void)\r\n    {\r\n        xmlHttpRequestLoad({ url, dataFormat: LoaderDataFormat.TEXT, onCompleted, onProgress: onRequestProgress, onError });\r\n    }\r\n\r\n    /**\r\n     * 加载二进制\r\n     * @param url 路径\r\n     */\r\n    loadBinary(url: string, onCompleted?: (content: ArrayBuffer) => void, onRequestProgress?: () => void, onError?: (e: Error) => void)\r\n    {\r\n        xmlHttpRequestLoad({ url, dataFormat: LoaderDataFormat.BINARY, onCompleted, onProgress: onRequestProgress, onError });\r\n    }\r\n\r\n    /**\r\n     * 加载图片\r\n     * @param url 路径\r\n     */\r\n    loadImage(url: string, onCompleted?: (content: HTMLImageElement) => void, onRequestProgress?: () => void, onError?: (e: Error) => void)\r\n    {\r\n        const image = new Image();\r\n\r\n        image.crossOrigin = 'Anonymous';\r\n        image.onload = (_event) =>\r\n        {\r\n            onCompleted && onCompleted(image);\r\n        };\r\n        image.onerror = (_event) =>\r\n        {\r\n            console.error(`Error while trying to load texture: ${url}`);\r\n            //\r\n            image.src = 'data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z';\r\n            //\r\n            const err = new Error(`${url} 加载失败！`);\r\n\r\n            onError && onError(err);\r\n        };\r\n        image.src = url;\r\n    }\r\n}\r\n\r\n/**\r\n * 加载类\r\n */\r\nexport const loader = new Loader();\r\n\r\ninterface LoadItem\r\n{\r\n    url: string;\r\n    dataFormat: LoaderDataFormat;\r\n    onCompleted?: (content: string | ArrayBuffer) => void;\r\n    onProgress?: (loaded: number, total: number) => void;\r\n    onError?: (ev: Error) => void;\r\n}\r\n\r\n/**\r\n * 使用XMLHttpRequest加载\r\n * @param url 加载路径\r\n * @param dataFormat 数据类型\r\n */\r\nfunction xmlHttpRequestLoad(loadItem: LoadItem)\r\n{\r\n    const request = new XMLHttpRequest();\r\n\r\n    request.open('Get', loadItem.url, true);\r\n    request.setRequestHeader('Access-Control-Allow-Origin', '*');\r\n    request.responseType = loadItem.dataFormat === LoaderDataFormat.BINARY ? 'arraybuffer' : '';\r\n    request.onreadystatechange = onRequestReadystatechange(request, loadItem);\r\n    request.onprogress = onRequestProgress(request, loadItem);\r\n    request.send();\r\n}\r\n\r\n/**\r\n * 请求进度回调\r\n */\r\nfunction onRequestProgress(request: XMLHttpRequest, loadItem: LoadItem)\r\n{\r\n    return (event: ProgressEvent) =>\r\n    {\r\n        loadItem.onProgress && loadItem.onProgress(event.loaded, event.total);\r\n    };\r\n}\r\n\r\n/**\r\n * 请求状态变化回调\r\n */\r\nfunction onRequestReadystatechange(request: XMLHttpRequest, loadItem: LoadItem)\r\n{\r\n    return (_ev) =>\r\n    {\r\n        if (request.readyState === 4)\r\n        { // 4 = \"loaded\"\r\n            request.onreadystatechange = null;\r\n\r\n            if (request.status >= 200 && request.status < 300)\r\n            {\r\n                const content = loadItem.dataFormat === LoaderDataFormat.TEXT ? request.responseText : request.response;\r\n\r\n                loadItem.onCompleted && loadItem.onCompleted(content);\r\n            }\r\n            else\r\n            {\r\n                const err = new Error(`${loadItem.url} 加载失败！`);\r\n\r\n                loadItem.onError && loadItem.onError(err);\r\n                loadItem.onCompleted && loadItem.onCompleted(null);\r\n            }\r\n        }\r\n    };\r\n}\r\n","const databases: { [name: string]: IDBDatabase } = {};\r\n\r\n/**\r\n *\r\n */\r\nexport class _IndexedDB\r\n{\r\n    /**\r\n     * 数据库状态\r\n     */\r\n    private _dbStatus: {\r\n        [dbname: string]: {\r\n            /**\r\n             * 状态\r\n             */\r\n            status: DBStatus,\r\n            /**\r\n             * 开启或者升级成功回调\r\n             */\r\n            onsuccessCallbacks: ((err: Error, database: IDBDatabase) => void)[],\r\n            /**\r\n             * 升级回调\r\n             */\r\n            onupgradeneededCallbacks: ((newdatabase: IDBDatabase) => void)[],\r\n        }\r\n    } = {};\r\n\r\n    /**\r\n     * 是否支持 indexedDB\r\n     */\r\n    support()\r\n    {\r\n        if (typeof indexedDB === 'undefined')\r\n        {\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 获取数据库，如果不存在则新建数据库\r\n     *\r\n     * @param dbname 数据库名称\r\n     * @param callback 完成回调\r\n     */\r\n    getDatabase(dbname: string, callback: (err: any, database: IDBDatabase) => void)\r\n    {\r\n        if (databases[dbname])\r\n        {\r\n            callback(null, databases[dbname]);\r\n\r\n            return;\r\n        }\r\n\r\n        this._open(dbname, callback);\r\n    }\r\n\r\n    /**\r\n     * 打开或者升级数据库\r\n     *\r\n     * @param dbname 数据库名称\r\n     * @param callback 完成回调\r\n     * @param upgrade 是否升级数据库\r\n     * @param onupgrade 升级回调\r\n     */\r\n    private _open(dbname: string, callback: (err: any, database: IDBDatabase) => void, upgrade = false, onupgrade?: (newdatabase: IDBDatabase) => void)\r\n    {\r\n        if (!this._dbStatus[dbname]) this._dbStatus[dbname] = { status: DBStatus.unOpen, onsuccessCallbacks: [], onupgradeneededCallbacks: [] };\r\n\r\n        this._dbStatus[dbname].onsuccessCallbacks.push(callback);\r\n        if (upgrade)\r\n        {\r\n            console.assert(!!onupgrade);\r\n            this._dbStatus[dbname].onupgradeneededCallbacks.push(onupgrade);\r\n        }\r\n        if (this._dbStatus[dbname].status === DBStatus.opening || this._dbStatus[dbname].status === DBStatus.upgrading) return;\r\n\r\n        let request: IDBOpenDBRequest;\r\n\r\n        if (!upgrade)\r\n        {\r\n            request = indexedDB.open(dbname);\r\n            this._dbStatus[dbname].status = DBStatus.opening;\r\n        }\r\n        else\r\n        {\r\n            const oldDatabase = databases[dbname];\r\n\r\n            oldDatabase.close();\r\n            delete databases[dbname];\r\n\r\n            request = indexedDB.open(dbname, oldDatabase.version + 1);\r\n            this._dbStatus[dbname].status = DBStatus.upgrading;\r\n        }\r\n\r\n        request.onupgradeneeded = (event) =>\r\n        {\r\n            const newdatabase: IDBDatabase = (event.target as any).result;\r\n\r\n            request.onupgradeneeded = null;\r\n\r\n            const callbacks = this._dbStatus[dbname].onupgradeneededCallbacks.concat();\r\n\r\n            this._dbStatus[dbname].onupgradeneededCallbacks.length = 0;\r\n            callbacks.forEach((element) =>\r\n            {\r\n                element(newdatabase);\r\n            });\r\n        };\r\n        request.onsuccess = (event) =>\r\n        {\r\n            databases[dbname] = (event.target as any).result;\r\n            request.onsuccess = null;\r\n\r\n            this._dbStatus[dbname].status = DBStatus.opened;\r\n\r\n            const callbacks = this._dbStatus[dbname].onsuccessCallbacks.concat();\r\n\r\n            this._dbStatus[dbname].onsuccessCallbacks.length = 0;\r\n            callbacks.forEach((element) =>\r\n            {\r\n                element(null, databases[dbname]);\r\n            });\r\n        };\r\n        request.onerror = (event) =>\r\n        {\r\n            request.onerror = null;\r\n\r\n            this._dbStatus[dbname].status = DBStatus.error;\r\n\r\n            const callbacks = this._dbStatus[dbname].onsuccessCallbacks.concat();\r\n\r\n            this._dbStatus[dbname].onsuccessCallbacks.length = 0;\r\n            callbacks.forEach((element) =>\r\n            {\r\n                element(event as any, null);\r\n            });\r\n        };\r\n    }\r\n\r\n    /**\r\n     * 删除数据库\r\n     *\r\n     * @param dbname 数据库名称\r\n     * @param callback 完成回调\r\n     */\r\n    deleteDatabase(dbname: string, callback?: (err: any) => void)\r\n    {\r\n        const request = indexedDB.deleteDatabase(dbname);\r\n\r\n        request.onsuccess = function (_event)\r\n        {\r\n            delete databases[dbname];\r\n            callback && callback(null);\r\n            request.onsuccess = null;\r\n        };\r\n        request.onerror = function (event)\r\n        {\r\n            callback && callback(event);\r\n            request.onerror = null;\r\n        };\r\n    }\r\n\r\n    /**\r\n     * 是否存在指定的对象存储\r\n     *\r\n     * @param dbname 数据库名称\r\n     * @param objectStroreName 对象存储名称\r\n     * @param callback 完成回调\r\n     */\r\n    hasObjectStore(dbname: string, objectStroreName: string, callback: (has: boolean) => void)\r\n    {\r\n        this.getDatabase(dbname, (_err, database) =>\r\n        {\r\n            callback(database.objectStoreNames.contains(objectStroreName));\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 获取对象存储名称列表\r\n     *\r\n     * @param dbname 数据库\r\n     * @param callback 完成回调\r\n     */\r\n    getObjectStoreNames(dbname: string, callback: (err: Error | null, objectStoreNames: string[]) => void)\r\n    {\r\n        this.getDatabase(dbname, (_err, database) =>\r\n        {\r\n            const objectStoreNames: string[] = [];\r\n\r\n            for (let i = 0; i < database.objectStoreNames.length; i++)\r\n            {\r\n                objectStoreNames.push(database.objectStoreNames.item(i));\r\n            }\r\n            callback(null, objectStoreNames);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 创建对象存储\r\n     *\r\n     * @param dbname 数据库名称\r\n     * @param objectStroreName 对象存储名称\r\n     * @param callback 完成回调\r\n     */\r\n    createObjectStore(dbname: string, objectStroreName: string, callback?: (err: any) => void)\r\n    {\r\n        this.getDatabase(dbname, (_err, database) =>\r\n        {\r\n            if (database.objectStoreNames.contains(objectStroreName))\r\n            {\r\n                callback && callback(null);\r\n\r\n                return;\r\n            }\r\n\r\n            this._open(dbname, callback, true, (newdatabase: IDBDatabase) =>\r\n            {\r\n                newdatabase.createObjectStore(objectStroreName);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 删除对象存储\r\n     *\r\n     * @param dbname 数据库名称\r\n     * @param objectStroreName 对象存储名称\r\n     * @param callback 完成回调\r\n     */\r\n    deleteObjectStore(dbname: string, objectStroreName: string, callback?: (err: any) => void)\r\n    {\r\n        this.getDatabase(dbname, (_err, database) =>\r\n        {\r\n            if (!database.objectStoreNames.contains(objectStroreName))\r\n            {\r\n                callback && callback(null);\r\n\r\n                return;\r\n            }\r\n            this._open(dbname, callback, true, (newdatabase: IDBDatabase) =>\r\n            {\r\n                newdatabase.deleteObjectStore(objectStroreName);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 获取对象存储中所有键列表\r\n     *\r\n     * @param dbname 数据库名称\r\n     * @param objectStroreName 对象存储名称\r\n     * @param callback 完成回调\r\n     */\r\n    getAllKeys(dbname: string, objectStroreName: string, callback?: (err: Error, keys: string[]) => void)\r\n    {\r\n        this.getDatabase(dbname, (_err, database) =>\r\n        {\r\n            try\r\n            {\r\n                const transaction = database.transaction([objectStroreName], 'readwrite');\r\n                const objectStore = transaction.objectStore(objectStroreName);\r\n                const request = objectStore.getAllKeys();\r\n\r\n                request.onsuccess = function (event)\r\n                {\r\n                    callback && callback(null, (event.target as any).result);\r\n                    request.onsuccess = null;\r\n                };\r\n            }\r\n            catch (error)\r\n            {\r\n                callback && callback(error, null);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 获取对象存储中指定键对应的数据\r\n     *\r\n     * @param dbname 数据库名称\r\n     * @param objectStroreName 对象存储名称\r\n     * @param key 键\r\n     * @param callback 完成回调\r\n     */\r\n    objectStoreGet(dbname: string, objectStroreName: string, key: string | number, callback?: (err: Error, data: any) => void)\r\n    {\r\n        this.getDatabase(dbname, (_err, database) =>\r\n        {\r\n            const transaction = database.transaction([objectStroreName], 'readwrite');\r\n            const objectStore = transaction.objectStore(objectStroreName);\r\n            const request = objectStore.get(key);\r\n\r\n            request.onsuccess = function (event)\r\n            {\r\n                const result = (event.target as any).result;\r\n\r\n                callback && callback(result !== undefined ? null : new Error(`没有找到资源 ${key}`), result);\r\n                request.onsuccess = null;\r\n            };\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 设置对象存储的键与值，如果不存在指定键则新增否则修改。\r\n     *\r\n     * @param dbname 数据库名称\r\n     * @param objectStroreName 对象存储名称\r\n     * @param key 键\r\n     * @param data 数据\r\n     * @param callback 完成回调\r\n     */\r\n    objectStorePut(dbname: string, objectStroreName: string, key: string | number, data: any, callback?: (err: Error) => void)\r\n    {\r\n        this.getDatabase(dbname, (_err, database) =>\r\n        {\r\n            try\r\n            {\r\n                const transaction = database.transaction([objectStroreName], 'readwrite');\r\n                const objectStore = transaction.objectStore(objectStroreName);\r\n                const request = objectStore.put(data, key);\r\n\r\n                request.onsuccess = function (_event)\r\n                {\r\n                    callback && callback(null);\r\n                    request.onsuccess = null;\r\n                };\r\n            }\r\n            catch (error)\r\n            {\r\n                callback && callback(error);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 删除对象存储中指定键以及对于数据\r\n     *\r\n     * @param dbname 数据库名称\r\n     * @param objectStroreName 对象存储名称\r\n     * @param key 键\r\n     * @param callback 完成回调\r\n     */\r\n    objectStoreDelete(dbname: string, objectStroreName: string, key: string | number, callback?: (err?: Error) => void)\r\n    {\r\n        this.getDatabase(dbname, (_err, database) =>\r\n        {\r\n            try\r\n            {\r\n                const transaction = database.transaction([objectStroreName], 'readwrite');\r\n                const objectStore = transaction.objectStore(objectStroreName);\r\n                const request = objectStore.delete(key);\r\n\r\n                request.onsuccess = function (_event)\r\n                {\r\n                    callback && callback();\r\n                    request.onsuccess = null;\r\n                };\r\n            }\r\n            catch (error)\r\n            {\r\n                callback && callback(error);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 清空对象存储中数据\r\n     *\r\n     * @param dbname 数据库名称\r\n     * @param objectStroreName 对象存储名称\r\n     * @param callback 完成回调\r\n     */\r\n    objectStoreClear(dbname: string, objectStroreName: string, callback?: (err?: Error) => void)\r\n    {\r\n        this.getDatabase(dbname, (_err, database) =>\r\n        {\r\n            try\r\n            {\r\n                const transaction = database.transaction([objectStroreName], 'readwrite');\r\n                const objectStore = transaction.objectStore(objectStroreName);\r\n                const request = objectStore.clear();\r\n\r\n                request.onsuccess = function (_event)\r\n                {\r\n                    callback && callback();\r\n                    request.onsuccess = null;\r\n                };\r\n            }\r\n            catch (error)\r\n            {\r\n                callback && callback(error);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport const _indexedDB = new _IndexedDB();\r\n\r\n/**\r\n * 数据库状态\r\n */\r\nenum DBStatus\r\n{\r\n    /**\r\n     * 未开启\r\n     */\r\n    unOpen,\r\n\r\n    /**\r\n     * 正在开启中\r\n     */\r\n    opening,\r\n\r\n    /**\r\n     * 已开启\r\n     */\r\n    opened,\r\n\r\n    /**\r\n     * 正在升级中\r\n     */\r\n    upgrading,\r\n\r\n    /**\r\n     * 开启或者升级失败\r\n     */\r\n    error,\r\n}\r\n","import { IReadFS } from './IReadFS';\r\nimport { ReadFS } from './ReadFS';\r\n\r\nexport class FS\r\n{\r\n    /**\r\n     * 默认文件系统\r\n     */\r\n    static fs: ReadFS;\r\n\r\n    /**\r\n     * 默认基础文件系统\r\n     */\r\n    static basefs: IReadFS;\r\n}\r\n","/**\r\n * 文件系统类型\r\n */\r\nexport enum FSType\r\n{\r\n    http = 'http',\r\n    native = 'native',\r\n    indexedDB = 'indexedDB'\r\n}\r\n","import { loader } from './base/Loader';\r\nimport { FS } from './FS';\r\nimport { FSType } from './FSType';\r\nimport { IReadFS } from './IReadFS';\r\n\r\n/**\r\n * Http可读文件系统\r\n */\r\nexport class HttpFS implements IReadFS\r\n{\r\n    /**\r\n     * 根路径\r\n     */\r\n    rootPath = '';\r\n\r\n    type = FSType.http;\r\n\r\n    constructor(rootPath = '')\r\n    {\r\n        this.rootPath = rootPath;\r\n        if (this.rootPath === '')\r\n        {\r\n            if (typeof document !== 'undefined')\r\n            {\r\n                const url = document.URL.split('?').shift();\r\n\r\n                this.rootPath = url.substring(0, url.lastIndexOf('/') + 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 读取文件\r\n     * @param path 路径\r\n     * @param callback 读取完成回调 当err不为null时表示读取失败\r\n     */\r\n    readArrayBuffer(path: string, callback: (err: Error, data: ArrayBuffer) => void)\r\n    {\r\n        // rootPath\r\n        loader.loadBinary(this.getAbsolutePath(path),\r\n            (content) =>\r\n            {\r\n                callback(null, content);\r\n            },\r\n            null,\r\n            (e) =>\r\n            {\r\n                callback(e, null);\r\n            });\r\n    }\r\n\r\n    /**\r\n     * 读取文件为字符串\r\n     * @param path 路径\r\n     * @param callback 读取完成回调 当err不为null时表示读取失败\r\n     */\r\n    readString(path: string, callback: (err: Error, data: string) => void)\r\n    {\r\n        loader.loadText(this.getAbsolutePath(path),\r\n            (content) =>\r\n            {\r\n                callback(null, content);\r\n            },\r\n            null,\r\n            (e) =>\r\n            {\r\n                callback(e, null);\r\n            });\r\n    }\r\n\r\n    /**\r\n     * 读取文件为Object\r\n     * @param path 路径\r\n     * @param callback 读取完成回调 当err不为null时表示读取失败\r\n     */\r\n    readObject(path: string, callback: (err: Error, data: any) => void)\r\n    {\r\n        loader.loadText(this.getAbsolutePath(path),\r\n            (content) =>\r\n            {\r\n                const obj = JSON.parse(content);\r\n\r\n                callback(null, obj);\r\n            },\r\n            null,\r\n            (e) =>\r\n            {\r\n                callback(e, null);\r\n            });\r\n    }\r\n\r\n    /**\r\n     * 加载图片\r\n     * @param path 图片路径\r\n     * @param callback 加载完成回调\r\n     */\r\n    readImage(path: string, callback: (err: Error, img: HTMLImageElement) => void)\r\n    {\r\n        const img = new Image();\r\n\r\n        img.onload = () =>\r\n        {\r\n            callback(null, img);\r\n        };\r\n        img.onerror = (_evt) =>\r\n        {\r\n            callback(new Error(`加载图片${path}失败`), null);\r\n        };\r\n        img.src = this.getAbsolutePath(path);\r\n    }\r\n\r\n    /**\r\n     * 获取文件绝对路径\r\n     * @param path （相对）路径\r\n     * @param callback 回调函数\r\n     */\r\n    getAbsolutePath(path: string)\r\n    {\r\n        return this.rootPath + path;\r\n    }\r\n}\r\n\r\nFS.basefs = new HttpFS();\r\n\r\n","import { globalEmitter } from '@feng3d/event';\r\nimport { dataTransform } from '@feng3d/polyfill';\r\nimport { _indexedDB } from './base/_IndexedDB';\r\nimport { FSType } from './FSType';\r\nimport { IReadWriteFS } from './IReadWriteFS';\r\n\r\n/**\r\n * 用于是否为文件夹\r\n */\r\nconst directorytoken = '!!!___directory___!!!';\r\n\r\n/**\r\n * 索引数据文件系统\r\n */\r\nexport class IndexedDBFS implements IReadWriteFS\r\n{\r\n    get type()\r\n    {\r\n        return FSType.indexedDB;\r\n    }\r\n\r\n    /**\r\n     * 数据库名称\r\n     */\r\n    DBname: string;\r\n\r\n    /**\r\n     * 项目名称（表单名称）\r\n     */\r\n    projectname: string;\r\n\r\n    constructor(DBname = 'feng3d-editor', projectname = 'testproject')\r\n    {\r\n        this.DBname = DBname;\r\n        this.projectname = projectname;\r\n    }\r\n\r\n    /**\r\n     * 读取文件\r\n     * @param path 路径\r\n     * @param callback 读取完成回调 当err不为null时表示读取失败\r\n     */\r\n    readArrayBuffer(path: string, callback: (err: Error, data: ArrayBuffer) => void)\r\n    {\r\n        _indexedDB.objectStoreGet(this.DBname, this.projectname, path, (err, data) =>\r\n        {\r\n            if (err)\r\n            {\r\n                callback(err, data);\r\n\r\n                return;\r\n            }\r\n            if (data instanceof ArrayBuffer)\r\n            {\r\n                callback(null, data);\r\n            }\r\n            else if (data instanceof Object)\r\n            {\r\n                const str = JSON.stringify(data, null, '\\t').replace(/[\\n\\t]+([\\d\\.e\\-\\[\\]]+)/g, '$1');\r\n                const arraybuffer = dataTransform.stringToArrayBuffer(str);\r\n\r\n                callback(null, arraybuffer);\r\n            }\r\n            else\r\n            {\r\n                const arraybuffer = dataTransform.stringToArrayBuffer(data);\r\n\r\n                callback(null, arraybuffer);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 读取文件\r\n     * @param path 路径\r\n     * @param callback 读取完成回调 当err不为null时表示读取失败\r\n     */\r\n    readString(path: string, callback: (err: Error, data: string) => void)\r\n    {\r\n        _indexedDB.objectStoreGet(this.DBname, this.projectname, path, (err, data) =>\r\n        {\r\n            if (err)\r\n            {\r\n                callback(err, data);\r\n\r\n                return;\r\n            }\r\n            if (data instanceof ArrayBuffer)\r\n            {\r\n                dataTransform.arrayBufferToString(data, (str) =>\r\n                {\r\n                    callback(null, str);\r\n                });\r\n            }\r\n            else if (data instanceof Object)\r\n            {\r\n                const str = JSON.stringify(data, null, '\\t').replace(/[\\n\\t]+([\\d\\.e\\-\\[\\]]+)/g, '$1');\r\n\r\n                callback(null, str);\r\n            }\r\n            else\r\n            {\r\n                callback(null, data);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 读取文件\r\n     * @param path 路径\r\n     * @param callback 读取完成回调 当err不为null时表示读取失败\r\n     */\r\n    readObject(path: string, callback: (err: Error, data: any) => void)\r\n    {\r\n        _indexedDB.objectStoreGet(this.DBname, this.projectname, path, (err, data) =>\r\n        {\r\n            if (err)\r\n            {\r\n                callback(err, data);\r\n\r\n                return;\r\n            }\r\n            if (data instanceof ArrayBuffer)\r\n            {\r\n                dataTransform.arrayBufferToString(data, (str) =>\r\n                {\r\n                    const obj = JSON.parse(str);\r\n\r\n                    callback(null, obj);\r\n                });\r\n            }\r\n            else if (data instanceof Object)\r\n            {\r\n                callback(null, data);\r\n            }\r\n            else\r\n            {\r\n                console.assert(typeof data === 'string');\r\n                const obj = JSON.parse(data);\r\n\r\n                callback(null, obj);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 加载图片\r\n     * @param path 图片路径\r\n     * @param callback 加载完成回调\r\n     */\r\n    readImage(path: string, callback: (err: Error, img: HTMLImageElement) => void)\r\n    {\r\n        this.readArrayBuffer(path, (err, data) =>\r\n        {\r\n            if (err)\r\n            {\r\n                callback(err, null);\r\n\r\n                return;\r\n            }\r\n            dataTransform.arrayBufferToImage(data, (img) =>\r\n            {\r\n                callback(null, img);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 获取文件绝对路径\r\n     * @param path （相对）路径\r\n     * @param callback 回调函数\r\n     */\r\n    getAbsolutePath(path: string)\r\n    {\r\n        return path;\r\n    }\r\n\r\n    /**\r\n     * 是否为文件夹\r\n     *\r\n     * @param path 文件路径\r\n     * @param callback 完成回调\r\n     */\r\n    isDirectory(path: string, callback: (result: boolean) => void)\r\n    {\r\n        this.readString(path, (_err, data) =>\r\n        {\r\n            callback(data === directorytoken);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 文件是否存在\r\n     * @param path 文件路径\r\n     * @param callback 回调函数\r\n     */\r\n    exists(path: string, callback: (exists: boolean) => void): void\r\n    {\r\n        _indexedDB.objectStoreGet(this.DBname, this.projectname, path, (_err, data) =>\r\n        {\r\n            callback(!!data);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 读取文件夹中文件列表\r\n     * @param path 路径\r\n     * @param callback 回调函数\r\n     */\r\n    readdir(path: string, callback: (err: Error, files: string[]) => void): void\r\n    {\r\n        _indexedDB.getAllKeys(this.DBname, this.projectname, (err, allfilepaths) =>\r\n        {\r\n            if (!allfilepaths)\r\n            {\r\n                callback(err, null);\r\n\r\n                return;\r\n            }\r\n            const subfilemap = {};\r\n\r\n            allfilepaths.forEach((element) =>\r\n            {\r\n                const dirp = path === '' ? path : (`${path}/`);\r\n\r\n                if (element.substr(0, dirp.length) === dirp && element !== path)\r\n                {\r\n                    const result = element.substr(dirp.length);\r\n                    const subfile = result.split('/').shift();\r\n\r\n                    subfilemap[subfile] = 1;\r\n                }\r\n            });\r\n            const files = Object.keys(subfilemap);\r\n\r\n            callback(null, files);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 新建文件夹\r\n     * @param path 文件夹路径\r\n     * @param callback 回调函数\r\n     */\r\n    mkdir(path: string, callback?: (err: Error) => void): void\r\n    {\r\n        this.exists(path, (exists) =>\r\n        {\r\n            if (exists)\r\n            {\r\n                callback(new Error(`文件夹${path}已存在无法新建`));\r\n\r\n                return;\r\n            }\r\n            _indexedDB.objectStorePut(this.DBname, this.projectname, path, directorytoken, callback);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 删除文件\r\n     * @param path 文件路径\r\n     * @param callback 回调函数\r\n     */\r\n    deleteFile(path: string, callback: (err: Error) => void)\r\n    {\r\n        // 删除文件\r\n        _indexedDB.objectStoreDelete(this.DBname, this.projectname, path, callback);\r\n        globalEmitter.emit('fs.delete', path);\r\n    }\r\n\r\n    /**\r\n     * 写文件\r\n     * @param path 文件路径\r\n     * @param data 文件数据\r\n     * @param callback 回调函数\r\n     */\r\n    writeArrayBuffer(path: string, data: ArrayBuffer, callback?: (err: Error) => void)\r\n    {\r\n        _indexedDB.objectStorePut(this.DBname, this.projectname, path, data, callback);\r\n        globalEmitter.emit('fs.write', path);\r\n    }\r\n\r\n    /**\r\n     * 写文件\r\n     * @param path 文件路径\r\n     * @param data 文件数据\r\n     * @param callback 回调函数\r\n     */\r\n    writeString(path: string, data: string, callback?: (err: Error) => void)\r\n    {\r\n        _indexedDB.objectStorePut(this.DBname, this.projectname, path, data, callback);\r\n        globalEmitter.emit('fs.write', path);\r\n    }\r\n\r\n    /**\r\n     * 写文件\r\n     * @param path 文件路径\r\n     * @param object 文件数据\r\n     * @param callback 回调函数\r\n     */\r\n    writeObject(path: string, object: any, callback?: (err: Error) => void)\r\n    {\r\n        _indexedDB.objectStorePut(this.DBname, this.projectname, path, object, callback);\r\n        globalEmitter.emit('fs.write', path);\r\n    }\r\n\r\n    /**\r\n     * 写图片\r\n     * @param path 图片路径\r\n     * @param image 图片\r\n     * @param callback 回调函数\r\n     */\r\n    writeImage(path: string, image: HTMLImageElement, callback?: (err: Error) => void)\r\n    {\r\n        dataTransform.imageToArrayBuffer(image, (arraybuffer) =>\r\n        {\r\n            this.writeArrayBuffer(path, arraybuffer, callback);\r\n            globalEmitter.emit('fs.write', path);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 复制文件\r\n     * @param src 源路径\r\n     * @param dest 目标路径\r\n     * @param callback 回调函数\r\n     */\r\n    copyFile(src: string, dest: string, callback?: (err: Error) => void)\r\n    {\r\n        _indexedDB.objectStoreGet(this.DBname, this.projectname, src, (err, data) =>\r\n        {\r\n            if (err)\r\n            {\r\n                callback(err);\r\n\r\n                return;\r\n            }\r\n            _indexedDB.objectStorePut(this.DBname, this.projectname, dest, data, callback);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 是否存在指定项目\r\n     * @param projectname 项目名称\r\n     * @param callback 回调函数\r\n     */\r\n    hasProject(projectname: string, callback: (has: boolean) => void)\r\n    {\r\n        _indexedDB.getObjectStoreNames(this.DBname, (err, objectStoreNames) =>\r\n        {\r\n            if (err)\r\n            {\r\n                callback(false);\r\n\r\n                return;\r\n            }\r\n            callback(objectStoreNames.indexOf(projectname) !== -1);\r\n        });\r\n    }\r\n    /**\r\n     * 初始化项目\r\n     * @param projectname 项目名称\r\n     * @param callback 回调函数\r\n     */\r\n    initproject(projectname: string, callback: (err: Error) => void)\r\n    {\r\n        this.projectname = projectname;\r\n        _indexedDB.createObjectStore(this.DBname, projectname, callback);\r\n    }\r\n}\r\n\r\n/**\r\n * 索引数据文件系统\r\n */\r\nexport const indexedDBFS = new IndexedDBFS();\r\n","/**\r\n * 路径工具\r\n */\r\nexport class PathUtils\r\n{\r\n    /**\r\n     * 标准化文件夹路径\r\n     * @param path\r\n     */\r\n    normalizeDir(path: string): string\r\n    {\r\n        if (path[path.length - 1] === '/')\r\n        {\r\n            path = path.substr(0, path.length - 1);\r\n        }\r\n\r\n        return path;\r\n    }\r\n    /**\r\n     * 是否为HTTP地址\r\n     *\r\n     * @param path 地址\r\n     */\r\n    isHttpURL(path: string): any\r\n    {\r\n        if (path.indexOf('http://') !== -1 || path.indexOf('https://') !== -1 || path.indexOf('file:///') !== -1)\r\n        {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * 获取不带后缀名称\r\n     * @param path 路径\r\n     */\r\n    getName(path: string)\r\n    {\r\n        console.assert(path !== undefined);\r\n        let name = this.basename(path);\r\n\r\n        if (this.isDirectory(path))\r\n        {\r\n            return name;\r\n        }\r\n        name = name.split('.').shift();\r\n\r\n        return name;\r\n    }\r\n\r\n    /**\r\n     * 获取带后缀名称\r\n     * @param path 路径\r\n     */\r\n    basename(path: string)\r\n    {\r\n        console.assert(path !== undefined);\r\n        const paths = path.split('/');\r\n        let name = paths.pop();\r\n\r\n        if (name === '')\r\n        {\r\n            name = paths.pop();\r\n        }\r\n\r\n        return name;\r\n    }\r\n\r\n    /**\r\n     * 获取后缀\r\n     * @param path 路径\r\n     */\r\n    extname(path: string)\r\n    {\r\n        console.assert(path !== undefined);\r\n        const name = this.basename(path);\r\n        const index = name.indexOf('.');\r\n\r\n        if (index === -1) return '';\r\n\r\n        return name.substr(index);\r\n    }\r\n\r\n    /**\r\n     * 父路径\r\n     * @param path 路径\r\n     */\r\n    dirname(path: string)\r\n    {\r\n        console.assert(path !== undefined);\r\n        const paths = path.split('/');\r\n\r\n        if (this.isDirectory(path))\r\n        {\r\n            paths.pop();\r\n        }\r\n        paths.pop();\r\n\r\n        return paths.join('/');\r\n    }\r\n\r\n    /**\r\n     * 获取子文件（非文件夹）路径\r\n     *\r\n     * @param parentPath 父文件夹路径\r\n     * @param childName 子文件名称\r\n     */\r\n    getChildFilePath(parentPath: string, childName: string)\r\n    {\r\n        console.assert(parentPath !== undefined);\r\n        console.assert(childName !== undefined);\r\n\r\n        if (parentPath.charAt(parentPath.length - 1) !== '/') parentPath += '/';\r\n\r\n        return parentPath + childName;\r\n    }\r\n\r\n    /**\r\n     * 获取子文件夹路径\r\n     *\r\n     * @param parentPath 父文件夹路径\r\n     * @param childFolderName 子文件夹名称\r\n     */\r\n    getChildFolderPath(parentPath: string, childFolderName: string)\r\n    {\r\n        if (parentPath.charAt(parentPath.length - 1) !== '/') parentPath += '/';\r\n        if (childFolderName.charAt(childFolderName.length - 1) !== '/') childFolderName += '/';\r\n\r\n        return parentPath + childFolderName;\r\n    }\r\n\r\n    /**\r\n     * 是否文件夹\r\n     * @param path 路径\r\n     */\r\n    isDirectory(path: string)\r\n    {\r\n        return path.split('/').pop() === '';\r\n    }\r\n\r\n    /**\r\n     * 获取目录深度\r\n     * @param path 路径\r\n     */\r\n    getDirDepth(path: string)\r\n    {\r\n        let length = path.split('/').length;\r\n\r\n        if (this.isDirectory(path))\r\n        {\r\n            length--;\r\n        }\r\n\r\n        return length - 1;\r\n    }\r\n}\r\n\r\n/**\r\n * 路径工具\r\n */\r\nexport const pathUtils = new PathUtils();\r\n","import { task } from '@feng3d/task';\r\nimport { FS } from './FS';\r\nimport { FSType } from './FSType';\r\nimport { IReadFS } from './IReadFS';\r\n\r\n/**\r\n * 可读文件系统\r\n */\r\nexport class ReadFS\r\n{\r\n    /**\r\n     * 基础文件系统\r\n     */\r\n    get fs() { return this._fs || FS.basefs; }\r\n    set fs(v) { this._fs = v; }\r\n    protected _fs: IReadFS;\r\n\r\n    /**\r\n     * 文件系统类型\r\n     */\r\n    get type(): FSType\r\n    {\r\n        return this.fs.type;\r\n    }\r\n\r\n    constructor(fs?: IReadFS)\r\n    {\r\n        this.fs = fs;\r\n    }\r\n\r\n    /**\r\n     * 读取文件为ArrayBuffer\r\n     * @param path 路径\r\n     * @param callback 读取完成回调 当err不为null时表示读取失败\r\n     */\r\n    readArrayBuffer(path: string, callback: (err: Error, arraybuffer: ArrayBuffer) => void)\r\n    {\r\n        this.fs.readArrayBuffer(path, callback);\r\n    }\r\n\r\n    /**\r\n     * 读取文件为字符串\r\n     * @param path 路径\r\n     * @param callback 读取完成回调 当err不为null时表示读取失败\r\n     */\r\n    readString(path: string, callback: (err: Error, str: string) => void)\r\n    {\r\n        this.fs.readString(path, callback);\r\n    }\r\n\r\n    /**\r\n     * 读取文件为Object\r\n     * @param path 路径\r\n     * @param callback 读取完成回调 当err不为null时表示读取失败\r\n     */\r\n    readObject(path: string, callback: (err: Error, object: any) => void)\r\n    {\r\n        this.fs.readObject(path, callback);\r\n    }\r\n\r\n    /**\r\n     * 加载图片\r\n     * @param path 图片路径\r\n     * @param callback 加载完成回调\r\n     */\r\n    readImage(path: string, callback: (err: Error, img: HTMLImageElement) => void)\r\n    {\r\n        this.fs.readImage(path, callback);\r\n\r\n        // functionwrap.wrapF(this.fs, this.fs.readImage, [path], callback);\r\n    }\r\n\r\n    /**\r\n     * 获取文件绝对路径\r\n     * @param path （相对）路径\r\n     */\r\n    getAbsolutePath(path: string)\r\n    {\r\n        return this.fs.getAbsolutePath(path);\r\n    }\r\n\r\n    /**\r\n     * 读取文件列表为字符串列表\r\n     *\r\n     * @param path 路径\r\n     * @param callback 读取完成回调 当err不为null时表示读取失败\r\n     */\r\n    readStrings(paths: string[], callback: (strs: (string | Error)[]) => void)\r\n    {\r\n        task.parallelResults(paths, (path, callback) =>\r\n        {\r\n            this.readString(path, (err, str) =>\r\n            {\r\n                callback(err || str);\r\n            });\r\n        }, callback);\r\n    }\r\n\r\n    protected _images: { [path: string]: HTMLImageElement } = {};\r\n\r\n    private _state: { [eventtype: string]: true } = {};\r\n}\r\n\r\nFS.fs = new ReadFS();\r\n\r\n","import { dataTransform } from '@feng3d/polyfill';\r\nimport { IReadWriteFS } from './IReadWriteFS';\r\nimport { pathUtils } from './PathUtils';\r\nimport { ReadFS } from './ReadFS';\r\n\r\nexport interface ReadWriteFS\r\n{\r\n    get fs(): IReadWriteFS;\r\n}\r\n\r\n/**\r\n * 可读写文件系统\r\n *\r\n * 扩展基础可读写文件系统\r\n */\r\nexport class ReadWriteFS extends ReadFS\r\n{\r\n    /**\r\n     * 项目名称（表单名称）\r\n     */\r\n    projectname: string;\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-useless-constructor\r\n    constructor(fs?: IReadWriteFS)\r\n    {\r\n        super(fs);\r\n    }\r\n\r\n    /**\r\n     * 文件是否存在\r\n     * @param path 文件路径\r\n     * @param callback 回调函数\r\n     */\r\n    exists(path: string, callback: (exists: boolean) => void)\r\n    {\r\n        this.fs.exists(path, callback);\r\n    }\r\n\r\n    /**\r\n     * 读取文件夹中文件列表\r\n     * @param path 路径\r\n     * @param callback 回调函数\r\n     */\r\n    readdir(path: string, callback: (err: Error, files: string[]) => void)\r\n    {\r\n        this.fs.readdir(path, callback);\r\n    }\r\n\r\n    /**\r\n     * 新建文件夹\r\n     * @param path 文件夹路径\r\n     * @param callback 回调函数\r\n     */\r\n    mkdir(path: string, callback?: (err: Error) => void)\r\n    {\r\n        path = pathUtils.normalizeDir(path);\r\n\r\n        this.fs.exists(path, (exists) =>\r\n        {\r\n            if (exists)\r\n            {\r\n                callback && callback(null);\r\n\r\n                return;\r\n            }\r\n            this.fs.mkdir(path, callback);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 删除文件\r\n     * @param path 文件路径\r\n     * @param callback 回调函数\r\n     */\r\n    deleteFile(path: string, callback?: (err: Error) => void)\r\n    {\r\n        this.fs.deleteFile(path, callback);\r\n    }\r\n\r\n    /**\r\n     * 写(新建)文件\r\n     * 自动根据文件类型保存为对应结构\r\n     *\r\n     * @param path 文件路径\r\n     * @param arraybuffer 文件数据\r\n     * @param callback 回调函数\r\n     */\r\n    writeFile(path: string, arraybuffer: ArrayBuffer, callback?: (err: Error) => void)\r\n    {\r\n        let ext = pathUtils.extname(path);\r\n\r\n        ext = ext.split('.').pop();\r\n        const fileTypedic = { meta: 'txt', json: 'object', jpg: 'arraybuffer', png: 'arraybuffer', mp3: 'arraybuffer', js: 'txt', ts: 'txt', map: 'txt', html: 'txt' };\r\n        let type = fileTypedic[ext];\r\n\r\n        if (path === 'tsconfig.json' || path === '.vscode/settings.json')\r\n        {\r\n            type = 'txt';\r\n        }\r\n\r\n        if (type === 'txt')\r\n        {\r\n            dataTransform.arrayBufferToString(arraybuffer, (str) =>\r\n            {\r\n                this.fs.writeString(path, str, (err) =>\r\n                {\r\n                    callback(err);\r\n                });\r\n            });\r\n        }\r\n        else if (type === 'object')\r\n        {\r\n            dataTransform.arrayBufferToObject(arraybuffer, (obj) =>\r\n            {\r\n                this.fs.writeObject(path, obj, (err) =>\r\n                {\r\n                    callback(err);\r\n                });\r\n            });\r\n        }\r\n        else if (type === 'arraybuffer')\r\n        {\r\n            this.writeArrayBuffer(path, arraybuffer, (err) =>\r\n            {\r\n                callback(err);\r\n            });\r\n        }\r\n        else\r\n        {\r\n            console.error(`无法导入文件 ${path}`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 写ArrayBuffer(新建)文件\r\n     * @param path 文件路径\r\n     * @param arraybuffer 文件数据\r\n     * @param callback 回调函数\r\n     */\r\n    writeArrayBuffer(path: string, arraybuffer: ArrayBuffer, callback?: (err: Error) => void)\r\n    {\r\n        // 如果所属文件夹不存在则新建\r\n        const dirpath = pathUtils.dirname(path);\r\n\r\n        this.mkdir(dirpath, (err) =>\r\n        {\r\n            if (err)\r\n            {\r\n                callback && callback(err);\r\n\r\n                return;\r\n            }\r\n            this.fs.writeArrayBuffer(path, arraybuffer, callback);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 写字符串到(新建)文件\r\n     * @param path 文件路径\r\n     * @param str 文件数据\r\n     * @param callback 回调函数\r\n     */\r\n    writeString(path: string, str: string, callback?: (err: Error) => void)\r\n    {\r\n        // 如果所属文件夹不存在则新建\r\n        const dirpath = pathUtils.dirname(path);\r\n\r\n        this.mkdir(dirpath, (err) =>\r\n        {\r\n            if (err)\r\n            {\r\n                callback && callback(err);\r\n\r\n                return;\r\n            }\r\n            this.fs.writeString(path, str, callback);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 写Object到(新建)文件\r\n     * @param path 文件路径\r\n     * @param object 文件数据\r\n     * @param callback 回调函数\r\n     */\r\n    writeObject(path: string, object: any, callback?: (err: Error) => void)\r\n    {\r\n        // 如果所属文件夹不存在则新建\r\n        const dirpath = pathUtils.dirname(path);\r\n\r\n        this.mkdir(dirpath, (err) =>\r\n        {\r\n            if (err)\r\n            {\r\n                callback && callback(err);\r\n\r\n                return;\r\n            }\r\n            this.fs.writeObject(path, object, callback);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 写图片\r\n     * @param path 图片路径\r\n     * @param image 图片\r\n     * @param callback 回调函数\r\n     */\r\n    writeImage(path: string, image: HTMLImageElement, callback?: (err: Error) => void)\r\n    {\r\n        // 如果所属文件夹不存在则新建\r\n        const dirpath = pathUtils.dirname(path);\r\n\r\n        this.mkdir(dirpath, (err) =>\r\n        {\r\n            if (err)\r\n            {\r\n                callback && callback(err);\r\n\r\n                return;\r\n            }\r\n            this.fs.writeImage(path, image, callback);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 复制文件\r\n     * @param src 源路径\r\n     * @param dest 目标路径\r\n     * @param callback 回调函数\r\n     */\r\n    copyFile(src: string, dest: string, callback?: (err: Error) => void)\r\n    {\r\n        this.fs.copyFile(src, dest, callback);\r\n    }\r\n\r\n    /**\r\n     * 是否为文件夹\r\n     *\r\n     * @param path 文件路径\r\n     * @param callback 完成回调\r\n     */\r\n    isDirectory(path: string, callback: (result: boolean) => void)\r\n    {\r\n        this.fs.isDirectory(path, callback);\r\n    }\r\n\r\n    /**\r\n     * 初始化项目\r\n     * @param projectname 项目名称\r\n     * @param callback 回调函数\r\n     */\r\n    initproject(projectname: string, callback: (err: Error) => void)\r\n    {\r\n        this.fs.initproject(projectname, callback);\r\n    }\r\n\r\n    /**\r\n     * 是否存在指定项目\r\n     * @param projectname 项目名称\r\n     * @param callback 回调函数\r\n     */\r\n    hasProject(projectname: string, callback: (has: boolean) => void)\r\n    {\r\n        this.fs.hasProject(projectname, callback);\r\n    }\r\n\r\n    /**\r\n     * 获取指定文件下所有文件路径列表\r\n     */\r\n    getAllPathsInFolder(dirpath = '', callback: (err: Error, filepaths: string[]) => void): void\r\n    {\r\n        const dirs = [dirpath];\r\n        const result = [];\r\n        let currentdir = '';\r\n\r\n        // 递归获取文件\r\n        const handle = () =>\r\n        {\r\n            if (dirs.length > 0)\r\n            {\r\n                currentdir = dirs.shift();\r\n                this.readdir(currentdir, (_err, files) =>\r\n                {\r\n                    // 获取子文件路径\r\n                    const getChildPath = () =>\r\n                    {\r\n                        if (files.length === 0)\r\n                        {\r\n                            handle();\r\n\r\n                            return;\r\n                        }\r\n                        const childpath = currentdir + (currentdir === '' ? '' : '/') + files.shift();\r\n\r\n                        result.push(childpath);\r\n                        this.isDirectory(childpath, (result) =>\r\n                        {\r\n                            if (result) dirs.push(childpath);\r\n                            getChildPath();\r\n                        });\r\n                    };\r\n\r\n                    getChildPath();\r\n                });\r\n            }\r\n            else\r\n            {\r\n                callback(null, result);\r\n            }\r\n        };\r\n\r\n        handle();\r\n    }\r\n\r\n    /**\r\n     * 移动文件\r\n     * @param src 源路径\r\n     * @param dest 目标路径\r\n     * @param callback 回调函数\r\n     */\r\n    moveFile(src: string, dest: string, callback?: (err: Error) => void)\r\n    {\r\n        this.copyFile(src, dest, (err) =>\r\n        {\r\n            if (err)\r\n            {\r\n                callback && callback(err);\r\n\r\n                return;\r\n            }\r\n            this.deleteFile(src, callback);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 重命名文件\r\n     * @param oldPath 老路径\r\n     * @param newPath 新路径\r\n     * @param callback 回调函数\r\n     */\r\n    renameFile(oldPath: string, newPath: string, callback?: (err: Error) => void): void\r\n    {\r\n        this.moveFile(oldPath, newPath, callback);\r\n    }\r\n\r\n    /**\r\n     * 移动一组文件\r\n     * @param movelists 移动列表\r\n     * @param callback 回调函数\r\n     */\r\n    moveFiles(movelists: [string, string][], callback?: (err: Error) => void)\r\n    {\r\n        this.copyFiles(movelists.concat(), (err) =>\r\n        {\r\n            if (err)\r\n            {\r\n                callback && callback(err);\r\n\r\n                return;\r\n            }\r\n            const deletelists = movelists.reduce((value: string[], current) =>\r\n            {\r\n                value.push(current[0]);\r\n\r\n                return value;\r\n            }, []);\r\n\r\n            this.deleteFiles(deletelists, callback);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 复制一组文件\r\n     * @param copylists 复制列表\r\n     * @param callback 回调函数\r\n     */\r\n    copyFiles(copylists: [string, string][], callback?: (err: Error) => void)\r\n    {\r\n        if (copylists.length > 0)\r\n        {\r\n            const copyitem: [string, string] = copylists.shift();\r\n\r\n            this.copyFile(copyitem[0], copyitem[1], (err) =>\r\n            {\r\n                if (err)\r\n                {\r\n                    callback && callback(err);\r\n\r\n                    return;\r\n                }\r\n                this.copyFiles(copylists, callback);\r\n            });\r\n\r\n            return;\r\n        }\r\n        callback && callback(null);\r\n    }\r\n\r\n    /**\r\n     * 删除一组文件\r\n     * @param deletelists 删除列表\r\n     * @param callback 回调函数\r\n     */\r\n    deleteFiles(deletelists: string[], callback?: (err: Error) => void)\r\n    {\r\n        if (deletelists.length > 0)\r\n        {\r\n            this.deleteFile(deletelists.shift(), (err) =>\r\n            {\r\n                if (err)\r\n                {\r\n                    callback && callback(err);\r\n\r\n                    return;\r\n                }\r\n                this.deleteFiles(deletelists, callback);\r\n            });\r\n\r\n            return;\r\n        }\r\n        callback && callback(null);\r\n    }\r\n\r\n    /**\r\n     * 重命名文件(夹)\r\n     * @param oldPath 老路径\r\n     * @param newPath 新路径\r\n     * @param callback 回调函数\r\n     */\r\n    rename(oldPath: string, newPath: string, callback?: (err: Error) => void): void\r\n    {\r\n        this.isDirectory(oldPath, (result) =>\r\n        {\r\n            if (result)\r\n            {\r\n                this.getAllPathsInFolder(oldPath, (err, filepaths) =>\r\n                {\r\n                    if (err)\r\n                    {\r\n                        callback && callback(err);\r\n\r\n                        return;\r\n                    }\r\n                    const renamelists: [string, string][] = [[oldPath, newPath]];\r\n\r\n                    filepaths.forEach((element) =>\r\n                    {\r\n                        renamelists.push([element, element.replace(oldPath, newPath)]);\r\n                    });\r\n                    this.moveFiles(renamelists, callback);\r\n                });\r\n            }\r\n            else\r\n            {\r\n                this.renameFile(oldPath, newPath, callback);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 移动文件(夹)\r\n     *\r\n     * @param src 源路径\r\n     * @param dest 目标路径\r\n     * @param callback 回调函数\r\n     */\r\n    move(src: string, dest: string, callback?: (err?: Error) => void): void\r\n    {\r\n        this.rename(src, dest, callback);\r\n    }\r\n\r\n    /**\r\n     * 删除文件(夹)\r\n     * @param path 路径\r\n     * @param callback 回调函数\r\n     */\r\n    delete(path: string, callback?: (err: Error) => void): void\r\n    {\r\n        this.isDirectory(path, (result) =>\r\n        {\r\n            if (result)\r\n            {\r\n                this.getAllPathsInFolder(path, (err, filepaths) =>\r\n                {\r\n                    if (err)\r\n                    {\r\n                        callback && callback(err);\r\n\r\n                        return;\r\n                    }\r\n                    const removelists: string[] = filepaths.concat(path);\r\n\r\n                    this.deleteFiles(removelists, callback);\r\n                });\r\n            }\r\n            else\r\n            {\r\n                this.deleteFile(path, callback);\r\n            }\r\n        });\r\n    }\r\n}\r\n","import { EventEmitter, IEvent } from '@feng3d/event';\r\n\r\n/**\r\n * 代理 EventTarget, 处理js事件中this关键字问题\r\n */\r\nexport class EventProxy<T = any> extends EventEmitter<T>\r\n{\r\n    pageX = 0;\r\n    pageY = 0;\r\n    clientX = 0;\r\n    clientY = 0;\r\n\r\n    /**\r\n     * 是否右击\r\n     */\r\n    rightmouse = false;\r\n\r\n    key = '';\r\n\r\n    keyCode = 0;\r\n\r\n    deltaY = 0;\r\n\r\n    private listentypes: (keyof T)[] = [];\r\n\r\n    get target()\r\n    {\r\n        return this._target;\r\n    }\r\n    set target(v)\r\n    {\r\n        if (this._target === v) return;\r\n        if (this._target)\r\n        {\r\n            this.listentypes.forEach((element) =>\r\n            {\r\n                this._target.removeEventListener(element as any, this.onMouseKey);\r\n            });\r\n        }\r\n        this._target = v;\r\n        if (this._target)\r\n        {\r\n            this.listentypes.forEach((element) =>\r\n            {\r\n                this._target.addEventListener(element as any, this.onMouseKey);\r\n            });\r\n        }\r\n    }\r\n\r\n    private _target: EventTarget;\r\n\r\n    constructor(target?: EventTarget)\r\n    {\r\n        super();\r\n        this.target = target;\r\n    }\r\n\r\n    /**\r\n     * 监听一次事件后将会被移除\r\n     * @param type 事件的类型。\r\n     * @param listener 处理事件的侦听器函数。\r\n     * @param thisObject listener函数作用域\r\n     * @param priority 事件侦听器的优先级。数字越大，优先级越高。默认优先级为 0。\r\n     */\r\n    once<K extends keyof T>(type: K, listener: (event: IEvent<T[K]>) => void, thisObject?: any, priority?: number)\r\n    {\r\n        this.on(type as any, listener, thisObject, priority, true);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 添加监听\r\n     * @param type 事件的类型。\r\n     * @param listener 处理事件的侦听器函数。\r\n     * @param priority 事件侦听器的优先级。数字越大，优先级越高。默认优先级为 0。\r\n     */\r\n    on<K extends keyof T & string>(type: K, listener: (event: IEvent<T[K]>) => void, thisObject?: any, priority = 0, once = false): this\r\n    {\r\n        super.on(type, listener, thisObject, priority, once);\r\n        if (this.listentypes.indexOf(type) === -1)\r\n        {\r\n            this.listentypes.push(type);\r\n            this._target.addEventListener(type as any, this.onMouseKey);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 移除监听\r\n     * @param dispatcher 派发器\r\n     * @param type 事件的类型。\r\n     * @param listener 要删除的侦听器对象。\r\n     */\r\n    off<K extends keyof T & string>(type?: K, listener?: (event: IEvent<T[K]>) => void, thisObject?: any): this\r\n    {\r\n        super.off(type, listener, thisObject);\r\n        if (!type)\r\n        {\r\n            this.listentypes.forEach((element) =>\r\n            {\r\n                this._target.removeEventListener(element as any, this.onMouseKey);\r\n            });\r\n            this.listentypes.length = 0;\r\n        }\r\n        else if (!this.has(type))\r\n        {\r\n            this._target.removeEventListener(type, this.onMouseKey);\r\n            this.listentypes.splice(this.listentypes.indexOf(type), 1);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 处理鼠标按下时同时出发 \"mousemove\" 事件bug\r\n     */\r\n    private handleMouseMoveBug = true;\r\n    private mousedownposition: { x: number, y: number };\r\n    /**\r\n     * 键盘按下事件\r\n     */\r\n    private onMouseKey = (event) =>\r\n    {\r\n        // this.clear();\r\n\r\n        if (event.clientX !== undefined)\r\n        {\r\n            this.clientX = event.clientX;\r\n            this.clientY = event.clientY;\r\n            this.pageX = event.pageX;\r\n            this.pageY = event.pageY;\r\n        }\r\n\r\n        if (event instanceof MouseEvent)\r\n        {\r\n            this.rightmouse = event.button === 2;\r\n\r\n            // 处理鼠标按下时同时出发 \"mousemove\" 事件bug\r\n            if (this.handleMouseMoveBug)\r\n            {\r\n                if (event.type === 'mousedown')\r\n                {\r\n                    this.mousedownposition = { x: event.clientX, y: event.clientY };\r\n                }\r\n                if (event.type === 'mousemove')\r\n                {\r\n                    if (this.mousedownposition)\r\n                    {\r\n                        if (this.mousedownposition.x === event.clientX && this.mousedownposition.y === event.clientY)\r\n                        {\r\n                            // console.log(`由于系统原因，触发mousedown同时触发了mousemove，此处屏蔽mousemove事件派发！`);\r\n                            return;\r\n                        }\r\n                    }\r\n                }\r\n                if (event.type === 'mouseup')\r\n                {\r\n                    this.mousedownposition = null;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (event instanceof KeyboardEvent)\r\n        {\r\n            this.keyCode = event.keyCode;\r\n            this.key = event.key;\r\n        }\r\n\r\n        if (event instanceof WheelEvent)\r\n        {\r\n            this.deltaY = event.deltaY;\r\n        }\r\n\r\n        // 赋值上次鼠标事件值\r\n        // event.clientX = this.clientX;\r\n        // event.clientY = this.clientY;\r\n        // event.pageX = this.pageX;\r\n        // event.pageY = this.pageY;\r\n\r\n        this.emit(event.type, event);\r\n    };\r\n\r\n    /**\r\n     * 清理数据\r\n     */\r\n    private clear()\r\n    {\r\n        this.clientX = 0;\r\n        this.clientY = 0;\r\n        this.rightmouse = false;\r\n        this.key = '';\r\n        this.keyCode = 0;\r\n        this.deltaY = 0;\r\n    }\r\n}\r\n","/**\r\n * 运行环境枚举\r\n */\r\nexport enum RunEnvironment\r\n{\r\n    /**\r\n     * 在feng3d模式下运行\r\n     */\r\n    feng3d = 1 << 0,\r\n\r\n    /**\r\n     * 运行在编辑器中\r\n     */\r\n    editor = 1 << 1,\r\n\r\n    /**\r\n     * 在所有环境中运行\r\n     */\r\n    all = (1 << 8) - 1,\r\n}\r\n","/**\r\n * 在检查器中控制对象销毁、保存和可见性的位掩码。\r\n */\r\nexport enum HideFlags\r\n{\r\n    /**\r\n     * 一个正常的,可见对象。这是默认的。\r\n     */\r\n    None = 0,\r\n    /**\r\n     * 不会出现在层次界面中。\r\n     */\r\n    HideInHierarchy = 1,\r\n    /**\r\n     * 不会出现在检查器界面中。\r\n     */\r\n    HideInInspector = 2,\r\n    /**\r\n     * 不会保存到编辑器中的场景中。\r\n     */\r\n    DontSaveInEditor = 4,\r\n    /**\r\n     * 在检查器中不可编辑。\r\n     */\r\n    NotEditable = 8,\r\n    /**\r\n     * 在构建播放器时对象不会被保存。\r\n     */\r\n    DontSaveInBuild = 16,\r\n    /**\r\n     * 对象不会被Resources.UnloadUnusedAssets卸载。\r\n     */\r\n    DontUnloadUnusedAsset = 32,\r\n    /**\r\n     * 不能被变换\r\n     */\r\n    DontTransform = 64,\r\n    /**\r\n     * 隐藏\r\n     */\r\n    Hide = HideInHierarchy | HideInInspector,\r\n    /**\r\n     * 对象不会保存到场景中。加载新场景时不会被销毁。相当于DontSaveInBuild | HideFlags。DontSaveInEditor | HideFlags.DontUnloadUnusedAsset\r\n     */\r\n    DontSave = DontSaveInEditor | DontSaveInBuild,\r\n    /**\r\n     * 不显示在层次界面中，不保存到场景中，加载新场景时不会被销毁。\r\n     */\r\n    HideAndDontSave = 61\r\n}\r\n","import { EventEmitter } from '@feng3d/event';\r\n\r\n/**\r\n * 按键状态\r\n */\r\nexport class KeyState extends EventEmitter\r\n{\r\n    /**\r\n     * 按键状态{key:键名称,value:是否按下}\r\n     */\r\n    private _keyStateDic: { [key: string]: boolean };\r\n\r\n    /**\r\n     * 构建\r\n     */\r\n    constructor()\r\n    {\r\n        super();\r\n        this._keyStateDic = {};\r\n    }\r\n\r\n    /**\r\n     * 按下键\r\n     * @param key 键名称\r\n     * @param data 携带数据\r\n     */\r\n    pressKey(key: string, data: KeyboardEvent | WheelEvent | MouseEvent): void\r\n    {\r\n        // 处理鼠标中键与右键\r\n        if (data instanceof MouseEvent)\r\n        {\r\n            if (['click', 'mousedown', 'mouseup'].indexOf(data.type) !== -1)\r\n            {\r\n                key = ['', 'middle', 'right'][data.button] + data.type;\r\n            }\r\n        }\r\n        this._keyStateDic[key] = true;\r\n        this.emit(key, data);\r\n    }\r\n\r\n    /**\r\n     * 释放键\r\n     * @param key 键名称\r\n     * @param data 携带数据\r\n     */\r\n    releaseKey(key: string, data: KeyboardEvent | WheelEvent | MouseEvent): void\r\n    {\r\n        // 处理鼠标中键与右键\r\n        if (data instanceof MouseEvent)\r\n        {\r\n            if (['click', 'mousedown', 'mouseup'].indexOf(data.type) !== -1)\r\n            {\r\n                key = ['', 'middle', 'right'][data.button] + data.type;\r\n            }\r\n        }\r\n        this._keyStateDic[key] = false;\r\n        this.emit(key, data);\r\n    }\r\n\r\n    /**\r\n     * 获取按键状态\r\n     * @param key 按键名称\r\n     */\r\n    getKeyState(key: string): boolean\r\n    {\r\n        return !!this._keyStateDic[key];\r\n    }\r\n}\r\n","import { IEvent } from '@feng3d/event';\r\nimport { ShortCut } from '../ShortCut';\r\nimport { KeyState } from './KeyState';\r\n\r\n/**\r\n * 快捷键捕获\r\n */\r\nexport class ShortCutCapture\r\n{\r\n    /**\r\n     * 快捷键环境\r\n     */\r\n    private _shortCut: ShortCut;\r\n\r\n    /**\r\n     * 快捷键\r\n     */\r\n    private _key: string;\r\n\r\n    /**\r\n     * 要执行的命令名称\r\n     */\r\n    private _command: string | undefined;\r\n\r\n    /**\r\n     * 可执行的状态命令\r\n     */\r\n    private _stateCommand: string | undefined;\r\n\r\n    /**\r\n     * 快捷键处于活动状态的条件\r\n     */\r\n    private _when: string | undefined;\r\n\r\n    /**\r\n     * 按键状态\r\n     */\r\n    private _keyState: KeyState;\r\n\r\n    /**\r\n     * 按键列表\r\n     */\r\n    private _keys: Key[];\r\n\r\n    /**\r\n     * 状态列表\r\n     */\r\n    private _states: State[];\r\n\r\n    /**\r\n     * 命令列表\r\n     */\r\n    private _commands: string[];\r\n\r\n    /**\r\n     * 命令列表\r\n     */\r\n    private _stateCommands: StateCommand[];\r\n\r\n    /**\r\n     * 构建快捷键捕获\r\n     * @param shortCut 快捷键环境\r\n     * @param key 快捷键；用“+”连接多个按键，“!”表示没按下某键；例如 “a+!b”表示按下“a”与没按下“b”时触发。\r\n     * @param command 要执行的command的id；使用“,”连接触发多个命令；例如 “commandA,commandB”表示满足触发条件后依次执行commandA与commandB命令。\r\n     * @param stateCommand 要执行的状态命令id；使用“,”连接触发多个状态命令，没带“!”表示激活该状态，否则表示使其处于非激活状态；例如 “stateA,!stateB”表示满足触发条件后激活状态“stateA，使“stateB处于非激活状态。\r\n     * @param when 快捷键激活的条件；使用“+”连接多个状态，没带“!”表示需要处于激活状态，否则需要处于非激活状态； 例如 “stateA+!stateB”表示stateA处于激活状态且stateB处于非激活状态时会判断按键是否满足条件。\r\n     */\r\n    constructor(shortCut: ShortCut, key: string, command?: string, stateCommand?: string, when?: string)\r\n    {\r\n        this._shortCut = shortCut;\r\n        this._keyState = shortCut.keyState;\r\n        this._key = key;\r\n        this._command = command;\r\n        this._stateCommand = stateCommand;\r\n        this._when = when;\r\n\r\n        this._keys = this.getKeys(key);\r\n        this._states = this.getStates(when);\r\n        this._commands = this.getCommands(command);\r\n        this._stateCommands = this.getStateCommand(stateCommand);\r\n\r\n        this.init();\r\n    }\r\n\r\n    /**\r\n     * 初始化\r\n     */\r\n    private init(): void\r\n    {\r\n        for (let i = 0; i < this._keys.length; i++)\r\n        {\r\n            this._keyState.on(this._keys[i].key, this.onCapture, this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 处理捕获事件\r\n     */\r\n    private onCapture(event: IEvent<any>): void\r\n    {\r\n        const inWhen = this.checkActivityStates(this._states);\r\n        const pressKeys = this.checkActivityKeys(this._keys);\r\n\r\n        if (pressKeys && inWhen)\r\n        {\r\n            this.dispatchCommands(this._commands, event);\r\n            this.executeStateCommands(this._stateCommands);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 派发命令\r\n     */\r\n    private dispatchCommands(commands: string[], data: IEvent<any>): void\r\n    {\r\n        for (let i = 0; i < commands.length; i++)\r\n        {\r\n            this._shortCut.emit(commands[i], data);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 执行状态命令\r\n     */\r\n    private executeStateCommands(stateCommands: StateCommand[]): void\r\n    {\r\n        for (let i = 0; i < stateCommands.length; i++)\r\n        {\r\n            const stateCommand: StateCommand = stateCommands[i];\r\n\r\n            if (stateCommand.not)\r\n            {\r\n                this._shortCut.deactivityState(stateCommand.state);\r\n            }\r\n            else\r\n            {\r\n                this._shortCut.activityState(stateCommand.state);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 检测快捷键是否处于活跃状态\r\n     */\r\n    private checkActivityStates(states: State[]): boolean\r\n    {\r\n        for (let i = 0; i < states.length; i++)\r\n        {\r\n            if (!this.getState(states[i]))\r\n            {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 获取是否处于指定状态中（支持一个！取反）\r\n     * @param state 状态名称\r\n     */\r\n    private getState(state: State): boolean\r\n    {\r\n        let result = this._shortCut.getState(state.state);\r\n\r\n        if (state.not)\r\n        {\r\n            result = !result;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * 检测是否按下给出的键\r\n     * @param keys 按键数组\r\n     */\r\n    private checkActivityKeys(keys: Key[]): boolean\r\n    {\r\n        for (let i = 0; i < keys.length; i++)\r\n        {\r\n            if (!this.getKeyValue(keys[i]))\r\n            {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 获取按键状态（true：按下状态，false：弹起状态）\r\n     */\r\n    private getKeyValue(key: Key): boolean\r\n    {\r\n        let value = this._keyState.getKeyState(key.key);\r\n\r\n        if (key.not)\r\n        {\r\n            value = !value;\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * 获取状态列表\r\n     * @param when 状态字符串\r\n     */\r\n    private getStates(when?: string): State[]\r\n    {\r\n        const states: State[] = [];\r\n\r\n        if (!when)\r\n        {\r\n            return states;\r\n        }\r\n        const state: string = when.trim();\r\n\r\n        if (state.length === 0)\r\n        {\r\n            return states;\r\n        }\r\n\r\n        const stateStrs = state.split('+');\r\n\r\n        for (let i = 0; i < stateStrs.length; i++)\r\n        {\r\n            states.push(new State(stateStrs[i]));\r\n        }\r\n\r\n        return states;\r\n    }\r\n\r\n    /**\r\n     * 获取键列表\r\n     * @param key 快捷键\r\n     */\r\n    private getKeys(key: string): Key[]\r\n    {\r\n        const keyStrs = key.split('+');\r\n        const keys: Key[] = [];\r\n\r\n        for (let i = 0; i < keyStrs.length; i++)\r\n        {\r\n            keys.push(new Key(keyStrs[i]));\r\n        }\r\n\r\n        return keys;\r\n    }\r\n\r\n    /**\r\n     * 获取命令列表\r\n     * @param command 命令\r\n     */\r\n    private getCommands(command?: string): string[]\r\n    {\r\n        const commands: string[] = [];\r\n\r\n        if (!command)\r\n        { return commands; }\r\n\r\n        command = command.trim();\r\n        const commandStrs = command.split(',');\r\n\r\n        for (let i = 0; i < commandStrs.length; i++)\r\n        {\r\n            const commandStr: string = commandStrs[i].trim();\r\n\r\n            if (commandStr.length > 0)\r\n            {\r\n                commands.push(commandStr);\r\n            }\r\n        }\r\n\r\n        return commands;\r\n    }\r\n\r\n    /**\r\n     * 获取状态命令列表\r\n     * @param stateCommand 状态命令\r\n     */\r\n    private getStateCommand(stateCommand?: string): StateCommand[]\r\n    {\r\n        const stateCommands: StateCommand[] = [];\r\n\r\n        if (!stateCommand)\r\n        {\r\n            return stateCommands;\r\n        }\r\n\r\n        stateCommand = stateCommand.trim();\r\n        const stateCommandStrs = stateCommand.split(',');\r\n\r\n        for (let i = 0; i < stateCommandStrs.length; i++)\r\n        {\r\n            const commandStr: string = stateCommandStrs[i].trim();\r\n\r\n            if (commandStr.length > 0)\r\n            {\r\n                stateCommands.push(new StateCommand(commandStr));\r\n            }\r\n        }\r\n\r\n        return stateCommands;\r\n    }\r\n\r\n    /**\r\n     * 销毁\r\n     */\r\n    destroy(): void\r\n    {\r\n        for (let i = 0; i < this._keys.length; i++)\r\n        {\r\n            this._keyState.off(this._keys[i].key, this.onCapture, this);\r\n        }\r\n        this._shortCut = null;\r\n        this._keys = null;\r\n        this._states = null;\r\n    }\r\n}\r\n\r\n/**\r\n * 按键\r\n */\r\nclass Key\r\n{\r\n    /**\r\n     * 是否取反\r\n     */\r\n    not: boolean;\r\n\r\n    /**\r\n     * 状态名称\r\n     */\r\n    key: string;\r\n\r\n    constructor(key: string)\r\n    {\r\n        key = key.trim();\r\n        if (key.charAt(0) === '!')\r\n        {\r\n            this.not = true;\r\n            key = key.substr(1).trim();\r\n        }\r\n        this.key = key;\r\n    }\r\n}\r\n\r\n/**\r\n * 状态\r\n */\r\nclass State\r\n{\r\n    /**\r\n     * 是否取反\r\n     */\r\n    not: boolean;\r\n\r\n    /**\r\n     * 状态名称\r\n     */\r\n    state: string;\r\n\r\n    constructor(state: string)\r\n    {\r\n        state = state.trim();\r\n        if (state.charAt(0) === '!')\r\n        {\r\n            this.not = true;\r\n            state = state.substr(1).trim();\r\n        }\r\n        this.state = state;\r\n    }\r\n}\r\n\r\n/**\r\n * 状态命令\r\n */\r\nclass StateCommand\r\n{\r\n    /**\r\n     * 是否取反\r\n     */\r\n    not: boolean;\r\n\r\n    /**\r\n     * 状态名称\r\n     */\r\n    state: string;\r\n\r\n    constructor(state: string)\r\n    {\r\n        state = state.trim();\r\n        if (state.charAt(0) === '!')\r\n        {\r\n            this.not = true;\r\n            state = state.substr(1).trim();\r\n        }\r\n        this.state = state;\r\n    }\r\n}\r\n\r\n","/**\r\n * 键盘按键字典 （补充常量，a-z以及鼠标按键不必再次列出）\r\n * 例如 boardKeyDic[17] = \"ctrl\";\r\n */\r\nconst boardKeyDic: { [keyCode: number]: string } = {\r\n    17: 'ctrl',\r\n    16: 'shift',\r\n    32: 'escape',\r\n    18: 'alt',\r\n    46: 'del',\r\n};\r\n\r\nexport class KeyBoard\r\n{\r\n    /**\r\n     * 获取键盘按键名称\r\n     * @param code 按键值\r\n     */\r\n    static getKey(code: number): string\r\n    {\r\n        let key = boardKeyDic[code];\r\n\r\n        if ((key === undefined || key === null) && code >= 65 && code <= 90)\r\n        {\r\n            key = String.fromCharCode(code).toLocaleLowerCase();\r\n        }\r\n\r\n        return key;\r\n    }\r\n\r\n    /**\r\n     * 获取按键值\r\n     * @param key 按键\r\n     */\r\n    static getCode(key: string)\r\n    {\r\n        key = key.toLocaleLowerCase();\r\n        const code = key.charCodeAt(0);\r\n\r\n        if (key.length === 1 && code >= 65 && code <= 90)\r\n        {\r\n            return code;\r\n        }\r\n        for (const code in boardKeyDic)\r\n        {\r\n            if (boardKeyDic[code] === key)\r\n            {\r\n                return Number(code);\r\n            }\r\n        }\r\n        console.error(`无法获取按键 ${key} 的值！`);\r\n\r\n        return code;\r\n    }\r\n}\r\n","import { EventProxy } from './EventProxy';\r\n\r\n/**\r\n * 键盘鼠标输入\r\n */\r\nexport const windowEventProxy = new EventProxy<WindowEventMap>(self);\r\n","import { IEvent } from '@feng3d/event';\r\nimport { KeyBoard } from '../Keyboard';\r\nimport { ShortCut } from '../ShortCut';\r\nimport { windowEventProxy } from '../WindowEventProxy';\r\nimport { KeyState } from './KeyState';\r\n\r\n/**\r\n * 按键捕获\r\n */\r\nexport class KeyCapture\r\n{\r\n    /**\r\n     * 捕获的按键字典\r\n     */\r\n    private _mouseKeyDic = {};\r\n\r\n    /**\r\n     * 按键状态\r\n     */\r\n    private _keyState: KeyState;\r\n    private shortcut: ShortCut;\r\n\r\n    /**\r\n     * 构建\r\n     * @param stage 舞台\r\n     */\r\n    constructor(shortcut: ShortCut)\r\n    {\r\n        this.shortcut = shortcut;\r\n        this._keyState = shortcut.keyState;\r\n        //\r\n        if (!windowEventProxy)\r\n        {\r\n            return;\r\n        }\r\n        windowEventProxy.on('keydown', this.onKeydown, this);\r\n        windowEventProxy.on('keyup', this.onKeyup, this);\r\n\r\n        // 监听鼠标事件\r\n        const mouseEvents = [ //\r\n            'dblclick', //\r\n            'click', //\r\n            'mousedown',\r\n            'mouseup',\r\n            'mousemove',\r\n            'mouseover',\r\n            'mouseout',\r\n        ];\r\n\r\n        for (let i = 0; i < mouseEvents.length; i++)\r\n        {\r\n            windowEventProxy.on(mouseEvents[i] as any, this.onMouseOnce, this);\r\n        }\r\n        windowEventProxy.on('wheel', this.onMousewheel, this);\r\n    }\r\n\r\n    /**\r\n     * 鼠标事件\r\n     */\r\n    private onMouseOnce(event: IEvent<MouseEvent>): void\r\n    {\r\n        if (!this.shortcut.enable)\r\n        {\r\n            return;\r\n        }\r\n        const mouseKey: string = event.type;\r\n\r\n        this._keyState.pressKey(mouseKey, event.data);\r\n        this._keyState.releaseKey(mouseKey, event.data);\r\n    }\r\n\r\n    /**\r\n     * 鼠标事件\r\n     */\r\n    private onMousewheel(event: IEvent<WheelEvent>): void\r\n    {\r\n        if (!this.shortcut.enable)\r\n        {\r\n            return;\r\n        }\r\n        const mouseKey: string = event.type;\r\n\r\n        this._keyState.pressKey(mouseKey, event.data);\r\n        this._keyState.releaseKey(mouseKey, event.data);\r\n    }\r\n\r\n    /**\r\n     * 键盘按下事件\r\n     */\r\n    private onKeydown(event: IEvent<KeyboardEvent>): void\r\n    {\r\n        if (!this.shortcut.enable)\r\n        {\r\n            return;\r\n        }\r\n        let boardKey: string = KeyBoard.getKey(event.data.keyCode);\r\n\r\n        boardKey = boardKey || event.data.key;\r\n        if (boardKey)\r\n        {\r\n            boardKey = boardKey.toLocaleLowerCase();\r\n            this._keyState.pressKey(boardKey, event.data);\r\n        }\r\n        else\r\n        {\r\n            console.error(`无法识别按钮 ${event.data.key}`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 键盘弹起事件\r\n     */\r\n    private onKeyup(event: IEvent<KeyboardEvent>): void\r\n    {\r\n        if (!this.shortcut.enable)\r\n        {\r\n            return;\r\n        }\r\n        let boardKey: string = KeyBoard.getKey(event.data.keyCode);\r\n\r\n        boardKey = boardKey || event.data.key;\r\n        if (boardKey)\r\n        {\r\n            boardKey = boardKey.toLocaleLowerCase();\r\n            this._keyState.releaseKey(boardKey, event.data);\r\n        }\r\n        else\r\n        {\r\n            console.error(`无法识别按钮 ${event.data.key}`);\r\n        }\r\n    }\r\n}\r\n","import { EventEmitter } from '@feng3d/event';\r\nimport { KeyCapture } from './handle/KeyCapture';\r\nimport { KeyState } from './handle/KeyState';\r\nimport { ShortCutCapture } from './handle/ShortCutCapture';\r\n\r\n/**\r\n * 初始化快捷键模块\r\n *\r\n * <pre>\r\nvar shortcuts:Array = [ //\r\n//在按下key1时触发命令command1\r\n{key: \"key1\", command: \"command1\", when: \"\"}, //\r\n //在按下key1时触发状态命令改变stateCommand1为激活状态\r\n{key: \"key1\", stateCommand: \"stateCommand1\", when: \"state1\"}, //\r\n //处于state1状态时按下key1触发命令command1\r\n{key: \"key1\", command: \"command1\", when: \"state1\"}, //\r\n//处于state1状态不处于state2时按下key1与没按下key2触发command1与command2，改变stateCommand1为激活状态，stateCommand2为非激活状态\r\n{key: \"key1+ ! key2\", command: \"command1,command2\", stateCommand: \"stateCommand1,!stateCommand2\", when: \"state1+!state2\"}, //\r\n];\r\n//添加快捷键\r\nshortCut.addShortCuts(shortcuts);\r\n//监听命令\r\nEvent.on(shortCut,\"run\" as any, function(e:Event):void\r\n{\r\ntrace(\"接受到命令：\" + e.type);\r\n});\r\n * </pre>\r\n */\r\nexport class ShortCut extends EventEmitter\r\n{\r\n    /**\r\n     * 按键状态\r\n     */\r\n    keyState: KeyState;\r\n\r\n    /**\r\n     * 状态字典\r\n     */\r\n    stateDic: { [state: string]: boolean };\r\n\r\n    /**\r\n     * 按键捕获\r\n     */\r\n    keyCapture: KeyCapture;\r\n\r\n    /**\r\n     * 捕获字典\r\n     */\r\n    captureDic: { [capture: string]: ShortCutCapture };\r\n\r\n    /**\r\n     * 启动\r\n     */\r\n    enable = true;\r\n\r\n    /**\r\n     * 初始化快捷键模块\r\n     */\r\n    constructor()\r\n    {\r\n        super();\r\n        this.keyState = new KeyState();\r\n        this.keyCapture = new KeyCapture(this);\r\n\r\n        this.captureDic = {};\r\n        this.stateDic = {};\r\n    }\r\n\r\n    /**\r\n     * 添加快捷键\r\n     * @param shortcuts 快捷键列表\r\n     */\r\n    addShortCuts(shortcuts: { key: string, command?: string, stateCommand?: string, when?: string }[]): void\r\n    {\r\n        for (let i = 0; i < shortcuts.length; i++)\r\n        {\r\n            const shortcut = shortcuts[i];\r\n            const shortcutUniqueKey: string = this.getShortcutUniqueKey(shortcut);\r\n\r\n            this.captureDic[shortcutUniqueKey] = this.captureDic[shortcutUniqueKey] || new ShortCutCapture(this, shortcut.key, shortcut.command, shortcut.stateCommand, shortcut.when);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 删除快捷键\r\n     * @param shortcuts 快捷键列表\r\n     */\r\n    removeShortCuts(shortcuts: { key: string, command?: string, stateCommand?: string, when?: string }[]): void\r\n    {\r\n        for (let i = 0; i < shortcuts.length; i++)\r\n        {\r\n            const shortcutUniqueKey: string = this.getShortcutUniqueKey(shortcuts[i]);\r\n            const shortCutCapture: ShortCutCapture = this.captureDic[shortcutUniqueKey];\r\n\r\n            if (ShortCutCapture !== null)\r\n            {\r\n                shortCutCapture.destroy();\r\n            }\r\n            delete this.captureDic[shortcutUniqueKey];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 移除所有快捷键\r\n     */\r\n    removeAllShortCuts(): void\r\n    {\r\n        const keys: string[] = [];\r\n        let key: string;\r\n\r\n        for (key in this.captureDic)\r\n        {\r\n            keys.push(key);\r\n        }\r\n\r\n        keys.forEach((key) =>\r\n        {\r\n            const shortCutCapture: ShortCutCapture = this.captureDic[key];\r\n\r\n            shortCutCapture.destroy();\r\n            delete this.captureDic[key];\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 激活状态\r\n     * @param state 状态名称\r\n     */\r\n    activityState(state: string): void\r\n    {\r\n        this.stateDic[state] = true;\r\n    }\r\n\r\n    /**\r\n     * 取消激活状态\r\n     * @param state 状态名称\r\n     */\r\n    deactivityState(state: string): void\r\n    {\r\n        delete this.stateDic[state];\r\n    }\r\n\r\n    /**\r\n     * 获取状态\r\n     * @param state 状态名称\r\n     */\r\n    getState(state: string): boolean\r\n    {\r\n        return !!this.stateDic[state];\r\n    }\r\n\r\n    /**\r\n     * 获取快捷键唯一字符串\r\n     */\r\n    private getShortcutUniqueKey(shortcut: { key: string, command?: string, stateCommand?: string, when?: string }): string\r\n    {\r\n        return `${shortcut.key},${shortcut.command},${shortcut.stateCommand},${shortcut.when}`;\r\n    }\r\n}\r\n\r\n/**\r\n * 快捷键\r\n */\r\nexport const shortcut = new ShortCut();\r\n","import { EventEmitter } from '@feng3d/event';\r\nimport { Constructor, IDisposable, mathUtil } from '@feng3d/polyfill';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { HideFlags } from './HideFlags';\r\n\r\nexport interface Feng3dObjectEventMap\r\n{\r\n    /**\r\n     * 销毁事件。当对象将被销毁是发射销毁事件。\r\n     */\r\n    // destroy: Feng3dObject;\r\n}\r\n\r\n/**\r\n * 所有feng3d对象的基类\r\n */\r\nexport class Feng3dObject<T extends Feng3dObjectEventMap = Feng3dObjectEventMap> extends EventEmitter<T> implements IDisposable\r\n{\r\n    /**\r\n     * 名称\r\n     */\r\n    name: string;\r\n\r\n    /**\r\n     * 隐藏标记，用于控制是否在层级界面、检查器显示，是否保存\r\n     */\r\n    @serialize\r\n    hideFlags = HideFlags.None;\r\n\r\n    /**\r\n     * 通用唯一标识符（Universally Unique Identifier）\r\n     */\r\n    readonly uuid: string;\r\n\r\n    /**\r\n     * 是否已销毁\r\n     */\r\n    get disposed() { return this._disposed; }\r\n    protected _disposed = false;\r\n\r\n    /**\r\n     * 构建\r\n     *\r\n     * 新增不可修改属性 guid\r\n     */\r\n    constructor()\r\n    {\r\n        super();\r\n        Object.defineProperty(this, 'uuid', { value: mathUtil.uuid() });\r\n        Object.defineProperty(this, 'disposed', { value: false, configurable: true });\r\n        console.assert(!Feng3dObject.objectLib[this.uuid], `唯一标识符存在重复！？`);\r\n        Feng3dObject.objectLib[this.uuid] = this;\r\n    }\r\n\r\n    /**\r\n     * 销毁\r\n     */\r\n    dispose()\r\n    {\r\n        Object.defineProperty(this, 'disposed', { value: true, configurable: false });\r\n    }\r\n\r\n    /**\r\n     * 获取对象\r\n     *\r\n     * @param uuid 通用唯一标识符\r\n     */\r\n    static getObject(uuid: string)\r\n    {\r\n        return this.objectLib[uuid];\r\n    }\r\n\r\n    /**\r\n     * 获取对象\r\n     *\r\n     * @param type\r\n     */\r\n    static getObjects<T extends Feng3dObject>(type?: Constructor<T>): T[]\r\n    {\r\n        const objects = Object.keys(this.objectLib).map((v) => this.objectLib[v]);\r\n        //\r\n        let filterResult = objects;\r\n        if (type)\r\n        {\r\n            filterResult = objects.filter((v) => v instanceof type);\r\n        }\r\n\r\nreturn <T[]>filterResult;\r\n    }\r\n\r\n    /**\r\n     * 对象库\r\n     */\r\n    private static objectLib: { [guid: string]: Feng3dObject };\r\n}\r\nObject.defineProperty(Feng3dObject, 'objectLib', { value: {} });\r\n\r\nserialization.serializeHandlers.push(\r\n    // 处理 Feng3dObject\r\n    {\r\n        priority: 0,\r\n        handler (target, source, property)\r\n        {\r\n            const spv = source[property];\r\n            if (spv instanceof Feng3dObject && (spv.hideFlags & HideFlags.DontSave))\r\n            {\r\n                return true;\r\n            }\r\n\r\nreturn false;\r\n        }\r\n    },\r\n);\r\n\r\n","import { IEvent } from '@feng3d/event';\r\nimport { Constructor, IDisposable } from '@feng3d/polyfill';\r\nimport { RenderAtomic } from '@feng3d/renderer';\r\nimport { Camera } from '../cameras/Camera';\r\nimport { Feng3dObject } from '../core/Feng3dObject';\r\nimport { GameObject, GameObjectEventMap } from '../core/GameObject';\r\nimport { Scene } from '../scene/Scene';\r\n\r\ndeclare global\r\n{\r\n    interface MixinsComponentMap { }\r\n    interface MixinsComponent { }\r\n}\r\n\r\ninterface ComponentInfo\r\n{\r\n    /**\r\n     * 组件名称，默认构造函数名称。当组件重名时可以使用该参数进行取别名，并且在接口 ComponentMap 中相应调整。\r\n     */\r\n    name: string;\r\n    /**\r\n     * 是否唯一，同类型组件只允许一个。\r\n     */\r\n    single: boolean;\r\n    /**\r\n     * 构造函数\r\n     */\r\n    type: Constructor<Component>;\r\n    /**\r\n     * 所依赖的组件列表。当该组件被添加Entity上时，会补齐缺少的依赖组件。\r\n     */\r\n    dependencies: Constructor<Component>[];\r\n}\r\n\r\n/**\r\n * 组件信息属性常量，保存组件名称与组件依赖ComponentInfo，由 @RegisterComponent 装饰器进行填充。\r\n */\r\nconst __component__ = '__component__';\r\n\r\n/**\r\n * 注册组件\r\n *\r\n * 使用 @RegisterComponent 在组件类定义上注册组件，配合扩展 ComponentMap 接口后可使用 GameObject.getComponent 等方法。\r\n *\r\n * @param component 组件名称，默认使用类名称\r\n */\r\nexport function RegisterComponent(component?: {\r\n    /**\r\n     * 组件名称，默认构造函数名称。当组件重名时可以使用该参数进行取别名，并且在接口 ComponentMap 中相应调整。\r\n     */\r\n    name: string,\r\n    /**\r\n     * 是否唯一，同类型组件只允许一个。\r\n     */\r\n    single?: boolean,\r\n    /**\r\n     * 所依赖的组件列表。当该组件被添加Entity上时，会补齐缺少的依赖组件。\r\n     */\r\n    dependencies?: Constructor<Component>[]\r\n})\r\n{\r\n    return (constructor: Constructor<Component>) =>\r\n    {\r\n        component = component || <any>{};\r\n        const info = component as ComponentInfo;\r\n        info.name = info.name || component.name || constructor.name;\r\n        info.type = constructor;\r\n        info.dependencies = info.dependencies || [];\r\n        constructor.prototype[__component__] = info;\r\n\r\n        if (Component._componentMap[info.name])\r\n        {\r\n            console.warn(`重复定义组件${info.name}，${Component._componentMap[info.name]} ${constructor} ！`);\r\n        }\r\n        else\r\n        {\r\n            Component._componentMap[info.name] = constructor;\r\n        }\r\n    };\r\n}\r\n\r\nexport function getComponentType<T extends ComponentNames>(type: T): Constructor<ComponentMap[T]>\r\n{\r\n    return Component._componentMap[type] as any;\r\n}\r\n\r\n/**\r\n * 组件名称与类定义映射，由 @RegisterComponent 装饰器进行填充。\r\n */\r\nexport const componentMap: ComponentMap = <any>{};\r\n\r\n/**\r\n * 组件名称与类定义映射，新建组件一般都需扩展该接口。\r\n */\r\nexport interface ComponentMap extends MixinsComponentMap { Component: Component }\r\n\r\nexport type ComponentNames = keyof ComponentMap;\r\nexport type Components = ComponentMap[ComponentNames];\r\n\r\nexport interface Component extends MixinsComponent { }\r\n\r\n/**\r\n * 组件\r\n *\r\n * 所有附加到GameObjects的基类。\r\n *\r\n * 注意，您的代码永远不会直接创建组件。相反，你可以编写脚本代码，并将脚本附加到GameObject(游戏物体)上。\r\n */\r\nexport class Component extends Feng3dObject<GameObjectEventMap> implements IDisposable\r\n{\r\n    // ------------------------------------------\r\n    // Variables\r\n    // ------------------------------------------\r\n    /**\r\n     * 此组件附加到的游戏对象。组件总是附加到游戏对象上。\r\n     */\r\n    get gameObject()\r\n    {\r\n        return this._gameObject;\r\n    }\r\n\r\n    /**\r\n     * 标签\r\n     */\r\n    get tag()\r\n    {\r\n        return this._gameObject.tag;\r\n    }\r\n\r\n    /**\r\n     * The Transform attached to this GameObject (null if there is none attached).\r\n     */\r\n    get transform()\r\n    {\r\n        return this._gameObject && this._gameObject.transform;\r\n    }\r\n\r\n    /**\r\n     * 是否唯一，同类型3D对象组件只允许一个\r\n     */\r\n    get single()\r\n    {\r\n        return false;\r\n    }\r\n\r\n    // ------------------------------------------\r\n    // Functions\r\n    // ------------------------------------------\r\n    /**\r\n     * 创建一个组件\r\n     */\r\n    constructor()\r\n    {\r\n        super();\r\n        this.onAny(this._onAnyListener, this);\r\n    }\r\n\r\n    /**\r\n     * 初始化组件\r\n     *\r\n     * 在添加到GameObject时立即被调用。\r\n     */\r\n    init()\r\n    {\r\n    }\r\n\r\n    /**\r\n     * Adds a component class of type componentType to the game object.\r\n     *\r\n     * @param type A component class of type.\r\n     * @returns The component that is added.\r\n     */\r\n    /**\r\n     * Adds a component class of type componentType to the game object.\r\n     *\r\n     * @param type 组件类定义。\r\n     * @returns 被添加的组件。\r\n     */\r\n    addComponent<T extends Component>(type: Constructor<T>): T\r\n    {\r\n        return this._gameObject.addComponent(type);\r\n    }\r\n\r\n    /**\r\n     * Returns the component of Type type if the game object has one attached, null if it doesn't.\r\n     *\r\n     * Using gameObject.GetComponent will return the first component that is found. If you expect there to be more than one component of the\r\n     * same type, use gameObject.GetComponents instead, and cycle through the returned components testing for some unique property.\r\n     *\r\n     * @param type The type of Component to retrieve.\r\n     * @returns The component to retrieve.\r\n     */\r\n    /**\r\n     * 返回游戏对象附加的一个指定类型的组件，如果没有，则返回 null。\r\n     *\r\n     * 使用 gameObject.GetComponent 将返回找到的第一个组件。如果您希望有多个相同类型的组件，请改用 gameObject.GetComponents，并循环通过返回的组件测试某些唯一属性。\r\n     *\r\n     * @param type 要检索的组件类型。\r\n     * @returns 要检索的组件。\r\n     */\r\n    getComponent<T extends Component>(type: Constructor<T>): T\r\n    {\r\n        return this._gameObject.getComponent(type);\r\n    }\r\n\r\n    /**\r\n     * Returns the component of Type type in the GameObject or any of its children using depth first search.\r\n     *\r\n     * @param type The type of Component to retrieve.\r\n     * @param includeInactive Should Components on inactive GameObjects be included in the found set?\r\n     * @returns A component of the matching type, if found.\r\n     */\r\n    /**\r\n     * 使用深度优先搜索返回 GameObject 或其任何子项中的 Type 组件。\r\n     *\r\n     * @param type 要检索的组件类型。\r\n     * @param includeInactive 是否包含不活跃组件。\r\n     * @returns 匹配类型的组件（如果找到）。\r\n     */\r\n    getComponentInChildren<T extends Component>(type: Constructor<T>, includeInactive = false): T\r\n    {\r\n        return this._gameObject.getComponentInChildren(type, includeInactive);\r\n    }\r\n\r\n    /**\r\n     * Retrieves the component of Type type in the GameObject or any of its parents.\r\n     *\r\n     * This method recurses upwards until it finds a GameObject with a matching component. Only components on active GameObjects are matched.\r\n     *\r\n     * @param type Type of component to find.\r\n     * @param includeInactive Should Components on inactive GameObjects be included in the found set?\r\n     * @returns Returns a component if a component matching the type is found. Returns null otherwise.\r\n     */\r\n    /**\r\n     * 检索GameObject或其任何父项type中的 Type 组件。\r\n     *\r\n     * 此方法向上递归，直到找到具有匹配组件的 GameObject。仅匹配活动游戏对象上的组件。\r\n     *\r\n     * @param type 要查找的组件类型。\r\n     * @param includeInactive 是否包含不活跃组件。\r\n     * @returns 如果找到与类型匹配的组件，则返回一个组件。否则返回 null。\r\n     */\r\n    getComponentInParent<T extends Component>(type: Constructor<T>, includeInactive = false): T\r\n    {\r\n        return this._gameObject.getComponentInParent(type, includeInactive);\r\n    }\r\n\r\n    /**\r\n     * Returns all components of Type `type` in the GameObject.\r\n     *\r\n     * @param type The type of component to retrieve.\r\n     * @param results List to receive the results.\r\n     * @returns all components of Type type in the GameObject.\r\n     */\r\n    /**\r\n     * 返回GameObject中指定类型的所有组件。\r\n     *\r\n     * @param type 要检索的组件类型。\r\n     * @param results 列出接收找到的组件。\r\n     * @returns GameObject中指定类型的所有组件。\r\n     */\r\n    getComponents<T extends Component>(type: Constructor<T>, results: T[] = []): T[]\r\n    {\r\n        return this._gameObject.getComponents(type, results);\r\n    }\r\n\r\n    /**\r\n     * Returns all components of Type type in the GameObject or any of its children children using depth first search. Works recursively.\r\n     *\r\n     * Unity searches for components recursively on child GameObjects. This means that it also includes all the child GameObjects of the target GameObject, and all subsequent child GameObjects.\r\n     *\r\n     * @param type The type of Component to retrieve.\r\n     * @param includeInactive Should Components on inactive GameObjects be included in the found set?\r\n     * @param results List to receive found Components.\r\n     * @returns All found Components.\r\n     */\r\n    /**\r\n     * 使用深度优先搜索返回 GameObject 或其任何子子项中 Type 的所有组件。递归工作。\r\n     *\r\n     * Unity 在子游戏对象上递归搜索组件。这意味着它还包括目标 GameObject 的所有子 GameObject，以及所有后续子 GameObject。\r\n     *\r\n     * @param type 要检索的组件类型。\r\n     * @param includeInactive 非活动游戏对象上的组件是否应该包含在搜索结果中？\r\n     * @param results 列出接收找到的组件。\r\n     * @returns 所有找到的组件。\r\n     */\r\n    getComponentsInChildren<T extends Component>(type: Constructor<T>, includeInactive = false, results: T[] = []): T[]\r\n    {\r\n        return this._gameObject.getComponentsInChildren(type, includeInactive, results);\r\n    }\r\n\r\n    /**\r\n     * Returns all components of Type type in the GameObject or any of its parents.\r\n     *\r\n     * @param type The type of Component to retrieve.\r\n     * @param includeInactive Should inactive Components be included in the found set?\r\n     * @param results List holding the found Components.\r\n     * @returns All components of Type type in the GameObject or any of its parents.\r\n     */\r\n    /**\r\n     * 返回GameObject或其任何父级中指定的所有组件。\r\n     *\r\n     * @param type 要检索的组件类型。\r\n     * @param includeInactive 非活动组件是否应该包含在搜索结果中？\r\n     * @param results 列出找到的组件。\r\n     * @returns GameObject或其任何父级中指定的所有组件。\r\n     */\r\n    getComponentsInParent<T extends Component>(type: Constructor<T>, includeInactive = false, results: T[] = []): T[]\r\n    {\r\n        return this._gameObject.getComponentsInParent(type, includeInactive, results);\r\n    }\r\n\r\n    /**\r\n     * 把事件分享到实体上。\r\n     */\r\n    getShareTargets()\r\n    {\r\n        return [this._gameObject];\r\n    }\r\n\r\n    /**\r\n     * 销毁\r\n     */\r\n    dispose()\r\n    {\r\n        this._gameObject = <any>null;\r\n        this._disposed = true;\r\n    }\r\n\r\n    beforeRender(_renderAtomic: RenderAtomic, _scene: Scene, _camera: Camera)\r\n    {\r\n\r\n    }\r\n\r\n    /**\r\n     * 监听对象的所有事件并且传播到所有组件中\r\n     */\r\n    private _onAnyListener(e: IEvent<any>)\r\n    {\r\n        if (this._gameObject)\r\n        { this._gameObject.emitEvent(e); }\r\n    }\r\n\r\n    /**\r\n     * 该方法仅在GameObject中使用\r\n     * @private\r\n     *\r\n     * @param gameObject 游戏对象\r\n     */\r\n    setGameObject(gameObject: GameObject)\r\n    {\r\n        this._gameObject = gameObject;\r\n    }\r\n    protected _gameObject: GameObject;\r\n\r\n    /**\r\n     * 组件名称与类定义映射，由 @RegisterComponent 装饰器进行填充。\r\n     * @private\r\n     */\r\n    static _componentMap: { [name: string]: Constructor<Component> } = {};\r\n\r\n    /**\r\n     * 获取组件依赖列表\r\n     *\r\n     * @param type 组件类定义\r\n     */\r\n    static getDependencies(type: Constructor<Component>)\r\n    {\r\n        let prototype = type.prototype;\r\n        let dependencies: Constructor<Component>[] = [];\r\n        while (prototype)\r\n        {\r\n            dependencies = dependencies.concat((prototype[__component__] as ComponentInfo)?.dependencies || []);\r\n            prototype = prototype.__proto__;\r\n        }\r\n\r\n        return dependencies;\r\n    }\r\n\r\n    /**\r\n     * 判断组件是否为唯一组件。\r\n     *\r\n     * @param type 组件类定义\r\n     */\r\n    static isSingleComponent<T extends Component>(type: Constructor<T>)\r\n    {\r\n        let prototype = type.prototype;\r\n        let isSingle = false;\r\n        while (prototype && !isSingle)\r\n        {\r\n            isSingle = !!((prototype[__component__] as ComponentInfo)?.single);\r\n            prototype = prototype.__proto__;\r\n        }\r\n\r\n        return isSingle;\r\n    }\r\n}\r\n","import { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { RunEnvironment } from '../core/RunEnvironment';\r\nimport { RegisterComponent, Component } from './Component';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        Behaviour: Behaviour;\r\n    }\r\n}\r\n\r\n/**\r\n * 行为\r\n *\r\n * 可以控制开关的组件\r\n */\r\n@RegisterComponent()\r\nexport class Behaviour extends Component\r\n{\r\n    /**\r\n     * 是否启用update方法\r\n     */\r\n    @oav()\r\n    @serialize\r\n    enabled = true;\r\n\r\n    /**\r\n     * 可运行环境\r\n     */\r\n    runEnvironment = RunEnvironment.all;\r\n\r\n    /**\r\n     * Has the Behaviour had enabled called.\r\n     * 是否所在GameObject显示且该行为已启动。\r\n     */\r\n    get isVisibleAndEnabled()\r\n    {\r\n        const v = this.enabled && this.gameObject && this.gameObject.activeSelf;\r\n\r\n        return v;\r\n    }\r\n\r\n    /**\r\n     * 每帧执行\r\n     */\r\n    update(_interval?: number)\r\n    {\r\n    }\r\n\r\n    dispose()\r\n    {\r\n        this.enabled = false;\r\n        super.dispose();\r\n    }\r\n}\r\n","import { Constructor } from '@feng3d/polyfill';\r\nimport { Components, ComponentNames } from './component/Component';\r\n\r\n/**\r\n * 添加组件菜单\r\n *\r\n * 在组件类上新增 @feng3d.AddComponentMenu(\"UI/Text\") 可以把该组件添加到组件菜单上。\r\n *\r\n * @param path 组件菜单中路径\r\n * @param componentOrder 组件菜单中组件的顺序(从低到高)。\r\n */\r\nexport function AddComponentMenu(path: string, componentOrder = 0)\r\n{\r\n    return (target: Constructor<Components>) =>\r\n    {\r\n        if (!menuConfig.component) menuConfig.component = [];\r\n        menuConfig.component.push({ path, order: componentOrder, type: target.name as any });\r\n\r\n        menuConfig.component.sort((a, b) =>\r\n        {\r\n            if (a.path < b.path) return -1;\r\n\r\n            return 1;\r\n        });\r\n        menuConfig.component.sort((a, b) => a.order - b.order);\r\n    };\r\n}\r\n\r\n/**\r\n * 菜单配置\r\n */\r\nexport const menuConfig: MenuConfig = {};\r\n\r\n/**\r\n * 菜单配置\r\n */\r\nexport interface MenuConfig\r\n{\r\n    /**\r\n     * 组件菜单\r\n     */\r\n    component?: ComponentMenu[];\r\n}\r\n\r\n/**\r\n * 组件菜单\r\n */\r\nexport interface ComponentMenu\r\n{\r\n    /**\r\n     * 组件菜单中路径\r\n     */\r\n    path: string;\r\n    /**\r\n     * 组件菜单中组件的顺序(从低到高)。\r\n     */\r\n    order: number;\r\n    /**\r\n     * 组件类定义\r\n     */\r\n    type: ComponentNames;\r\n}\r\n","/**\r\n * 资源扩展名\r\n */\r\nexport enum AssetType\r\n{\r\n    /**\r\n     * 文件夹\r\n     */\r\n    folder = 'folder',\r\n\r\n    /**\r\n     * 音频\r\n     */\r\n    audio = 'audio',\r\n\r\n    /**\r\n     * ts文件\r\n     */\r\n    ts = 'ts',\r\n    /**\r\n     * js文件\r\n     */\r\n    js = 'js',\r\n    /**\r\n     * 文本文件\r\n     */\r\n    txt = 'txt',\r\n    /**\r\n     * json文件\r\n     */\r\n    json = 'json',\r\n    /**\r\n     * OBJ模型资源附带的材质文件\r\n     */\r\n    mtl = 'mtl',\r\n    /**\r\n     * OBJ模型文件\r\n     */\r\n    obj = 'obj',\r\n    /**\r\n     * MD5模型文件\r\n     */\r\n    md5mesh = 'md5mesh',\r\n    /**\r\n     * MD5动画\r\n     */\r\n    md5anim = 'md5anim',\r\n    /**\r\n     * 魔兽MDL模型\r\n     */\r\n    mdl = 'mdl',\r\n    // -- feng3d中的类型\r\n    /**\r\n     * 纹理\r\n     */\r\n    texture = 'texture',\r\n    /**\r\n     * 立方体纹理\r\n     */\r\n    texturecube = 'texturecube',\r\n    /**\r\n     * 材质\r\n     */\r\n    material = 'material',\r\n    /**\r\n     * 几何体\r\n     */\r\n    geometry = 'geometry',\r\n    /**\r\n     * 游戏对象\r\n     */\r\n    gameobject = 'gameobject',\r\n    /**\r\n     * 场景\r\n     */\r\n    scene = 'scene',\r\n    /**\r\n     * 动画\r\n     */\r\n    anim = 'anim',\r\n    /**\r\n     * 着色器\r\n     */\r\n    shader = 'shader',\r\n    /**\r\n     * 脚本\r\n     */\r\n    script = 'script',\r\n}\r\n","import { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { AssetType } from '../assets/AssetType';\r\nimport { Feng3dObject } from '../core/Feng3dObject';\r\nimport { PropertyClip } from './PropertyClip';\r\n\r\nexport class AnimationClip extends Feng3dObject\r\n{\r\n    readonly assetType = AssetType.anim;\r\n\r\n    @oav()\r\n    @serialize\r\n    declare name: string;\r\n    /**\r\n     * 动画时长，单位ms\r\n     */\r\n    @serialize\r\n    length: number;\r\n\r\n    @oav()\r\n    @serialize\r\n    loop = true;\r\n\r\n    @serialize\r\n    propertyClips: PropertyClip[];\r\n}\r\n","import { Vector3, Quaternion } from '@feng3d/math';\r\nimport { serialize } from '@feng3d/serialization';\r\n\r\nexport class PropertyClip\r\n{\r\n    /**\r\n     * 属性路径\r\n     */\r\n    @serialize\r\n    path: PropertyClipPath;\r\n\r\n    @serialize\r\n    propertyName: string;\r\n\r\n    @serialize\r\n    type: 'Number' | 'Vector3' | 'Quaternion';\r\n\r\n    @serialize\r\n    propertyValues: [number, number[]][];\r\n\r\n    private _cacheValues = {};\r\n    private _propertyValues: [number, number | Vector3 | Quaternion][];\r\n\r\n    getValue(cliptime: number, fps: number)\r\n    {\r\n        const frame = Math.round(fps * cliptime / 1000);\r\n        if (this._cacheValues[frame] !== undefined)\r\n        {\r\n            return this._cacheValues[frame];\r\n        }\r\n\r\n        this._propertyValues = this._propertyValues || <any> this.propertyValues.map((v) =>\r\n            [v[0], this.getpropertyValue(v[1])]);\r\n\r\n        const propertyValues = this._propertyValues;\r\n        let propertyValue = propertyValues[0][1];\r\n        if (cliptime <= propertyValues[0][0])\r\n        // eslint-disable-next-line no-empty\r\n        {\r\n\r\n        }\r\n        else if (cliptime >= propertyValues[propertyValues.length - 1][0])\r\n        {\r\n            propertyValue = propertyValues[propertyValues.length - 1][1];\r\n        }\r\n        else\r\n        {\r\n            for (let j = 0; j < propertyValues.length - 1; j++)\r\n            {\r\n                if (propertyValues[j][0] <= cliptime && cliptime < propertyValues[j + 1][0])\r\n                {\r\n                    propertyValue = this.interpolation(\r\n                        propertyValues[j][1],\r\n                        propertyValues[j + 1][1],\r\n                        (cliptime - propertyValues[j][0]) / (propertyValues[j + 1][0] - propertyValues[j][0])\r\n                    );\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        this._cacheValues[frame] = propertyValue;\r\n\r\n        return propertyValue;\r\n    }\r\n\r\n    private interpolation(prevalue: ClipPropertyType, nextValue: ClipPropertyType, factor: number)\r\n    {\r\n        let propertyValue: ClipPropertyType;\r\n        if (prevalue instanceof Quaternion)\r\n        {\r\n            propertyValue = prevalue.clone();\r\n            propertyValue.lerp(prevalue, <Quaternion>nextValue, factor);\r\n        }\r\n        else if (prevalue instanceof Vector3)\r\n        {\r\n            propertyValue = new Vector3(\r\n                prevalue.x * (1 - factor) + (<Vector3>nextValue).x * factor,\r\n                prevalue.y * (1 - factor) + (<Vector3>nextValue).y * factor,\r\n                prevalue.z * (1 - factor) + (<Vector3>nextValue).z * factor,\r\n            );\r\n        }\r\n        else\r\n        {\r\n            propertyValue = prevalue * (1 - factor) + <number>nextValue * factor;\r\n        }\r\n\r\n        return propertyValue;\r\n    }\r\n\r\n    private getpropertyValue(value: number[])\r\n    {\r\n        if (this.type === 'Number')\r\n        {\r\n            return value[0];\r\n        }\r\n        if (this.type === 'Vector3')\r\n        {\r\n            return Vector3.fromArray(value);\r\n        }\r\n        if (this.type === 'Quaternion')\r\n        {\r\n            return Quaternion.fromArray(value);\r\n        }\r\n\r\n        console.error(`未处理 动画数据类型 ${this.type}`);\r\n        console.error(``);\r\n    }\r\n\r\n    cacheIndex: number;\r\n}\r\n\r\n/**\r\n * [time:number,value:number | Vector3 | Quaternion]\r\n */\r\nexport type ClipPropertyType = number | Vector3 | Quaternion;\r\nexport type PropertyClipPath = [PropertyClipPathItemType, string][];\r\n\r\nexport enum PropertyClipPathItemType\r\n{\r\n    GameObject,\r\n    Component,\r\n}\r\n","import { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { Behaviour } from '../component/Behaviour';\r\nimport { getComponentType, RegisterComponent } from '../component/Component';\r\nimport { AddComponentMenu } from '../Menu';\r\nimport { AnimationClip } from './AnimationClip';\r\nimport { PropertyClip, PropertyClipPathItemType } from './PropertyClip';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap { Animation: Animation; }\r\n}\r\n\r\n@AddComponentMenu('Animator/Animation')\r\n@RegisterComponent()\r\nexport class Animation extends Behaviour\r\n{\r\n    @oav({ component: 'OAVDefault', componentParam: { dragparam: { accepttype: 'animationclip', datatype: 'animationclip' } } })\r\n    @serialize\r\n    @watch('_onAnimationChanged')\r\n    animation: AnimationClip;\r\n\r\n    @oav({ component: 'OAVArray', componentParam: { dragparam: { accepttype: 'animationclip', datatype: 'animationclip' }, defaultItem: () => new AnimationClip() } })\r\n    @serialize\r\n    animations: AnimationClip[] = [];\r\n\r\n    /**\r\n     * 动画事件，单位为ms\r\n     */\r\n    @oav()\r\n    @watch('_onTimeChanged')\r\n    time = 0;\r\n\r\n    @oav()\r\n    @serialize\r\n    isplaying = false;\r\n\r\n    /**\r\n     * 播放速度\r\n     */\r\n    @oav()\r\n    @serialize\r\n    playspeed = 1;\r\n\r\n    /**\r\n     * 动作名称\r\n     */\r\n    get clipName()\r\n    {\r\n        return this.animation ? this.animation.name : null;\r\n    }\r\n\r\n    get frame()\r\n    {\r\n        if (!this.animation) return -1;\r\n        const cycle = this.animation.length;\r\n        const cliptime = (this.time % cycle + cycle) % cycle;\r\n        const _frame = Math.round(this._fps * cliptime / 1000);\r\n\r\n        return _frame;\r\n    }\r\n\r\n    update(interval: number)\r\n    {\r\n        if (this.isplaying) this.time += interval * this.playspeed;\r\n    }\r\n\r\n    dispose()\r\n    {\r\n        this.animation = null;\r\n        this.animations = null;\r\n        super.dispose();\r\n    }\r\n\r\n    private num = 0;\r\n    private _fps = 24;\r\n    private _objectCache = new Map();\r\n\r\n    private _updateAni()\r\n    {\r\n        if (!this.animation) return;\r\n        if ((this.num++) % 2 !== 0) return;\r\n\r\n        const cycle = this.animation.length;\r\n        const cliptime = (this.time % cycle + cycle) % cycle;\r\n\r\n        const propertyClips = this.animation.propertyClips;\r\n\r\n        for (let i = 0; i < propertyClips.length; i++)\r\n        {\r\n            const propertyClip = propertyClips[i];\r\n\r\n            const propertyValues = propertyClip.propertyValues;\r\n            if (propertyValues.length === 0) continue;\r\n            const propertyHost = this.getPropertyHost(propertyClip);\r\n            if (!propertyHost) continue;\r\n            propertyHost[propertyClip.propertyName] = propertyClip.getValue(cliptime, this._fps);\r\n        }\r\n    }\r\n\r\n    private getPropertyHost(propertyClip: PropertyClip)\r\n    {\r\n        if (propertyClip.cacheIndex && this._objectCache[propertyClip.cacheIndex])\r\n        { return this._objectCache[propertyClip.cacheIndex]; }\r\n\r\n        if (!propertyClip.cacheIndex)\r\n        { propertyClip.cacheIndex = autoobjectCacheID++; }\r\n\r\n        let propertyHost = this.gameObject;\r\n        const path = propertyClip.path;\r\n\r\n        for (let i = 0; i < path.length; i++)\r\n        {\r\n            const element = path[i];\r\n            switch (element[0])\r\n            {\r\n                case PropertyClipPathItemType.GameObject:\r\n                    propertyHost = propertyHost.find(element[1]);\r\n                    break;\r\n                case PropertyClipPathItemType.Component:\r\n                    const componentClass = getComponentType(element[1] as any);\r\n                    propertyHost = propertyHost.getComponent(componentClass);\r\n                    break;\r\n                default:\r\n                    console.error(`无法获取 PropertyHost ${element}`);\r\n            }\r\n            if (!propertyHost)\r\n            {\r\n                return null;\r\n            }\r\n        }\r\n        this._objectCache[propertyClip.cacheIndex] = propertyHost;\r\n\r\n        return propertyHost;\r\n    }\r\n\r\n    private _onAnimationChanged()\r\n    {\r\n        this.time = 0;\r\n    }\r\n\r\n    private _onTimeChanged()\r\n    {\r\n        this._updateAni();\r\n    }\r\n}\r\nlet autoobjectCacheID = 1;\r\n","import { Matrix4x4 } from '@feng3d/math';\r\nimport { serialize } from '@feng3d/serialization';\r\n\r\n// /**\r\n//  * 骨骼数据\r\n//\r\n//  */\r\n// export class Skeleton\r\n// {\r\n\r\n// }\r\n\r\n/**\r\n * 骨骼关节数据\r\n\r\n */\r\nexport class SkeletonJoint\r\n{\r\n    /** 父关节索引 （-1说明本身是总父结点，这个序号其实就是行号了，譬如上面”origin“结点的序号就是0，无父结点； \"body\"结点序号是1，父结点序号是0，也就是说父结点是”origin“）*/\r\n    @serialize\r\n    parentIndex = -1;\r\n\r\n    /** 关节名字 */\r\n    @serialize\r\n    name: string;\r\n\r\n    /** 骨骼全局矩阵 */\r\n    @serialize\r\n    matrix: Matrix4x4;\r\n\r\n    children: number[] = [];\r\n\r\n    get invertMatrix()\r\n    {\r\n        if (!this._invertMatrix)\r\n        {\r\n            this._invertMatrix = this.matrix.clone().invert();\r\n        }\r\n\r\n        return this._invertMatrix;\r\n    }\r\n    private _invertMatrix: Matrix4x4;\r\n}\r\n","import { GameObject } from '../core/GameObject';\r\n\r\n/**\r\n *\r\n */\r\nexport interface MenuItem\r\n{\r\n    /**\r\n     * 标签的路径\r\n     */\r\n    path: string;\r\n    /**\r\n     * 优先级，数字越大，显示越靠前，默认为0\r\n     */\r\n    priority?: number;\r\n    /**\r\n     * 点击事件\r\n     */\r\n    click?: () => GameObject,\r\n    /**\r\n     * 是否启用，禁用时显示灰色\r\n     */\r\n    enable?: () => boolean;\r\n    /**\r\n     * 是否显示，默认显示\r\n     */\r\n    show?: () => boolean;\r\n}\r\n\r\nexport const createNodeMenu: MenuItem[] = [];\r\n","import { Box3, Vector3 } from '@feng3d/math';\r\nimport { Component } from '../component/Component';\r\nimport { GameObject } from './GameObject';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsGameObjectEventMap\r\n    {\r\n        /**\r\n         * 获取自身包围盒\r\n         */\r\n        getSelfBounds: { bounds: Box3[] };\r\n\r\n        /**\r\n         * 自身包围盒发生变化\r\n         */\r\n        selfBoundsChanged: Component;\r\n    }\r\n}\r\n\r\n/**\r\n * 轴对称包围盒\r\n *\r\n * 用于优化计算射线碰撞检测以及视锥剔除等。\r\n */\r\nexport class BoundingBox\r\n{\r\n    private _gameObject: GameObject;\r\n\r\n    protected _selfLocalBounds = new Box3();\r\n    protected _selfWorldBounds = new Box3();\r\n    protected _worldBounds = new Box3();\r\n\r\n    protected _selfBoundsInvalid = true;\r\n    protected _selfWorldBoundsInvalid = true;\r\n    protected _worldBoundsInvalid = true;\r\n\r\n    constructor(gameObject: GameObject)\r\n    {\r\n        this._gameObject = gameObject;\r\n        gameObject.on('selfBoundsChanged', this._invalidateSelfLocalBounds, this);\r\n        gameObject.on('scenetransformChanged', this._invalidateSelfWorldBounds, this);\r\n    }\r\n\r\n    /**\r\n     * 自身局部包围盒通常有Renderable组件提供\r\n     */\r\n    get selfLocalBounds()\r\n    {\r\n        if (this._selfBoundsInvalid)\r\n        {\r\n            this._updateSelfBounds();\r\n            this._selfBoundsInvalid = false;\r\n        }\r\n\r\n        return this._selfLocalBounds;\r\n    }\r\n\r\n    /**\r\n     * 自身世界空间的包围盒\r\n     */\r\n    get selfWorldBounds()\r\n    {\r\n        if (this._selfWorldBoundsInvalid)\r\n        {\r\n            this._updateSelfWorldBounds();\r\n            this._selfWorldBoundsInvalid = false;\r\n        }\r\n\r\n        return this._selfWorldBounds;\r\n    }\r\n\r\n    /**\r\n     * 世界包围盒\r\n     */\r\n    get worldBounds()\r\n    {\r\n        if (this._worldBoundsInvalid)\r\n        {\r\n            this._updateWorldBounds();\r\n            this._worldBoundsInvalid = false;\r\n        }\r\n\r\n        return this._worldBounds;\r\n    }\r\n\r\n    /**\r\n     * 更新自身包围盒\r\n     *\r\n     * 自身包围盒通常有Renderable组件提供\r\n     */\r\n    protected _updateSelfBounds()\r\n    {\r\n        const bounds = this._selfLocalBounds.empty();\r\n\r\n        // 获取对象上的包围盒\r\n        const data: { bounds: Box3[]; } = { bounds: [] };\r\n        this._gameObject.emit('getSelfBounds', data);\r\n\r\n        data.bounds.forEach((b) =>\r\n        {\r\n            bounds.union(b);\r\n        });\r\n        if (bounds.isEmpty())\r\n        {\r\n            bounds.fromPoints([new Vector3()]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 更新自身世界包围盒\r\n     */\r\n    protected _updateSelfWorldBounds()\r\n    {\r\n        this._selfWorldBounds.copy(this.selfLocalBounds).applyMatrix(this._gameObject.transform.localToWorldMatrix);\r\n    }\r\n\r\n    /**\r\n     * 更新世界包围盒\r\n     */\r\n    protected _updateWorldBounds()\r\n    {\r\n        this._worldBounds.copy(this.selfWorldBounds);\r\n\r\n        // 获取子对象的世界包围盒与自身世界包围盒进行合并\r\n        this._gameObject.children.forEach((element) =>\r\n        {\r\n            this._worldBounds.union(element.boundingBox.worldBounds);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 使自身包围盒失效\r\n     */\r\n    protected _invalidateSelfLocalBounds()\r\n    {\r\n        if (this._selfBoundsInvalid) return;\r\n\r\n        this._selfBoundsInvalid = true;\r\n        this._invalidateSelfWorldBounds();\r\n    }\r\n\r\n    /**\r\n     * 使自身世界包围盒失效\r\n     */\r\n    protected _invalidateSelfWorldBounds()\r\n    {\r\n        if (this._selfWorldBoundsInvalid) return;\r\n\r\n        this._selfWorldBoundsInvalid = true;\r\n        this._invalidateWorldBounds();\r\n    }\r\n\r\n    /**\r\n     * 使世界包围盒失效\r\n     */\r\n    protected _invalidateWorldBounds()\r\n    {\r\n        if (this._worldBoundsInvalid) return;\r\n\r\n        this._worldBoundsInvalid = true;\r\n\r\n        // 世界包围盒失效会影响父对象世界包围盒失效\r\n        const parent = this._gameObject.parent;\r\n        if (!parent) return;\r\n        parent.boundingBox._invalidateWorldBounds();\r\n    }\r\n}\r\n","/**\r\n * 路径\r\n */\r\nexport interface Path\r\n{\r\n    /**\r\n     * 规范化字符串路径，减少'.'和'.'的部分。当发现多个斜杠时，它们被单个斜杠替换;当路径包含尾部斜杠时，它将被保留。在Windows上使用反斜杠。\r\n     *\r\n     * @param p 要规范化的字符串路径。\r\n     */\r\n    normalize(p: string): string;\r\n    /**\r\n     * 将所有参数连接在一起，并规范化生成的路径。参数必须是字符串。在v0.8中，非字符串参数被悄悄地忽略。在v0.10及以上版本中，会抛出异常。\r\n     *\r\n     * @param paths 用于连接的路径列表\r\n     */\r\n    join(...paths: string[]): string;\r\n    /**\r\n     * 最右边的参数被认为是{to}。其他参数被认为是{from}的数组。\r\n     *\r\n     * 从最左边的{from}参数开始，将{to}解析为一个绝对路径。\r\n     *\r\n     * 如果{to}还不是绝对的，则{from}参数将按从右到左的顺序预先设置，直到找到绝对路径为止。如果在使用所有{from}路径之后仍然没有找到绝对路径，则还将使用当前工作目录。得到的路径是规范化的，除非路径被解析到根目录，否则尾部斜杠将被删除。\r\n     *\r\n     * @param pathSegments 要连接的字符串路径。非字符串参数将被忽略。\r\n     */\r\n    resolve(...pathSegments: string[]): string;\r\n    /**\r\n     * 确定{path}是否是一个绝对路径。无论工作目录如何，绝对路径总是解析到相同的位置。\r\n     *\r\n     * @param path 用于测试的路径。\r\n     */\r\n    isAbsolute(path: string): boolean;\r\n    /**\r\n     * 解决从{from}到{to}的相对路径。有时我们有两条绝对路径，我们需要推导出一条到另一条的相对路径。这实际上是path.resolve的逆变换。\r\n     *\r\n     * @param from 起始路径\r\n     * @param to 目标路径\r\n     */\r\n    relative(from: string, to: string): string;\r\n    /**\r\n     * 返回路径的目录名。类似于Unix的dirname命令。\r\n     *\r\n     * @param p 求值的路径。\r\n     */\r\n    dirname(p: string): string;\r\n    /**\r\n     * 返回路径的最后一部分。类似于Unix basename命令。通常用于从完全限定的路径中提取文件名。\r\n     *\r\n     * @param p 求值的路径。\r\n     * @param ext 可选地，从结果中删除的扩展。\r\n     */\r\n    basename(p: string, ext?: string): string;\r\n    /**\r\n     * 返回路径的扩展名，在路径的最后一部分从最后一个'.'到字符串末尾。如果在路径的最后部分没有'.'或者最后一个字符时'.'则返回一个空字符串。\r\n     *\r\n     * @param p 求值的路径。\r\n     */\r\n    extname(p: string): string;\r\n    /**\r\n     * 特定平台的文件分隔符。'\\\\'或'/'。\r\n     */\r\n    sep: '\\\\' | '/';\r\n    /**\r\n     * 特定平台的文件分隔符。 ';' 或者 ':'.\r\n     */\r\n    delimiter: ';' | ':';\r\n    /**\r\n     * 从路径字符串返回一个对象 —— 与format()相反。\r\n     *\r\n     * @param pathString 路径字符串。\r\n     */\r\n    parse(pathString: string): ParsedPath;\r\n    /**\r\n     * 从对象返回路径字符串——与parse()相反。\r\n     *\r\n     * @param pathObject 路径对象。\r\n     */\r\n    format(pathObject: FormatInputPathObject): string;\r\n\r\n    win32: Path;\r\n    posix: Path;\r\n}\r\n\r\n/**\r\n * 由path.parse()生成或由path.format()使用的已解析路径对象。\r\n */\r\nexport interface ParsedPath\r\n{\r\n    /**\r\n     * 路径的根，如'/'或'c:\\'\r\n     */\r\n    root: string;\r\n    /**\r\n     * 完整的目录路径，如'/home/user/dir'或'c:\\path\\dir'\r\n     */\r\n    dir: string;\r\n    /**\r\n     * 包含扩展名(如有)的文件名，如'index.html'\r\n     */\r\n    base: string;\r\n    /**\r\n     * 文件扩展名(如果有)，如'.html'\r\n     */\r\n    ext: string;\r\n    /**\r\n     * 没有扩展名(如果有)的文件名，如'index'\r\n     */\r\n    name: string;\r\n}\r\n\r\nexport interface FormatInputPathObject\r\n{\r\n    /**\r\n     * 路径的根，如'/'或'c:\\'\r\n     */\r\n    root?: string;\r\n    /**\r\n     * 完整的目录路径，如'/home/user/dir'或'c:\\path\\dir'\r\n     */\r\n    dir?: string;\r\n    /**\r\n     * 包含扩展名(如有)的文件名，如'index.html'\r\n     */\r\n    base?: string;\r\n    /**\r\n     * 文件扩展名(如果有)，如'.html'\r\n     */\r\n    ext?: string;\r\n    /**\r\n     * 没有扩展名(如果有)的文件名，如'index'\r\n     */\r\n    name?: string;\r\n}\r\n\r\n/**\r\n * .\r\n */\r\nconst CHAR_DOT = 46;\r\n/**\r\n * :\r\n */\r\nconst CHAR_COLON = 58;\r\n/**\r\n * ?\r\n */\r\nconst CHAR_QUESTION_MARK = 63;\r\n/**\r\n * A\r\n */\r\nconst CHAR_UPPERCASE_A = 65;\r\n/**\r\n * Z\r\n */\r\nconst CHAR_UPPERCASE_Z = 90;\r\n/**\r\n * a\r\n */\r\nconst CHAR_LOWERCASE_A = 97;\r\n/**\r\n * z\r\n */\r\nconst CHAR_LOWERCASE_Z = 122;\r\n/**\r\n * /\r\n */\r\nconst CHAR_FORWARD_SLASH = 47;\r\n/**\r\n * \\\r\n */\r\nconst CHAR_BACKWARD_SLASH = 92;\r\n\r\n/**\r\n * 未实现其功能\r\n */\r\nconst process = {\r\n    platform: 'win32',\r\n    env: <any>{},\r\n    cwd() { return ''; },\r\n};\r\n\r\nclass ERR_INVALID_ARG_TYPE extends TypeError\r\n{\r\n    constructor(name: string, expected: string, actual: any)\r\n    {\r\n        assert(typeof name === 'string', '\\'name\\' must be a string');\r\n\r\n        // determiner: 'must be' or 'must not be'\r\n        let determiner;\r\n        if (typeof expected === 'string' && expected.startsWith('not '))\r\n        {\r\n            determiner = 'must not be';\r\n            expected = expected.replace(/^not /, '');\r\n        }\r\n        else\r\n        {\r\n            determiner = 'must be';\r\n        }\r\n\r\n        let msg;\r\n        if (name.endsWith(' argument'))\r\n        {\r\n            // For cases like 'first argument'\r\n            msg = `The ${name} ${determiner} ${oneOf(expected, 'type')}`;\r\n        }\r\n        else\r\n        {\r\n            const type = name.includes('.') ? 'property' : 'argument';\r\n            msg = `The \"${name}\" ${type} ${determiner} ${oneOf(expected, 'type')}`;\r\n        }\r\n\r\n        // TODO(BridgeAR): Improve the output by showing `null` and similar.\r\n        msg += `. Received type ${typeof actual}`;\r\n\r\n        super(msg);\r\n    }\r\n}\r\n\r\nfunction oneOf(expected: string | string[], thing: string)\r\n{\r\n    assert(typeof thing === 'string', '`thing` has to be of type string');\r\n    if (Array.isArray(expected))\r\n    {\r\n        const len = expected.length;\r\n        assert(len > 0, 'At least one expected value needs to be specified');\r\n        expected = expected.map((i) => String(i));\r\n        if (len > 2)\r\n        {\r\n            return `one of ${thing} ${expected.slice(0, len - 1).join(', ')}, or ${expected[len - 1]}`;\r\n        }\r\n        else if (len === 2)\r\n        {\r\n            return `one of ${thing} ${expected[0]} or ${expected[1]}`;\r\n        }\r\n\r\n        return `of ${thing} ${expected[0]}`;\r\n    }\r\n\r\n    return `of ${thing} ${String(expected)}`;\r\n}\r\n\r\nfunction assert(b: boolean, msg: string)\r\n{\r\n    if (!b) throw msg;\r\n}\r\n\r\nfunction validateString(value: string, name: string)\r\n{\r\n    if (typeof value !== 'string')\r\n    { throw new ERR_INVALID_ARG_TYPE(name, 'string', value); }\r\n}\r\n\r\nfunction isPathSeparator(code: number)\r\n{\r\n    return code === CHAR_FORWARD_SLASH || code === CHAR_BACKWARD_SLASH;\r\n}\r\n\r\nfunction isPosixPathSeparator(code: number)\r\n{\r\n    return code === CHAR_FORWARD_SLASH;\r\n}\r\n\r\nfunction isWindowsDeviceRoot(code: number)\r\n{\r\n    return code >= CHAR_UPPERCASE_A && code <= CHAR_UPPERCASE_Z\r\n        || code >= CHAR_LOWERCASE_A && code <= CHAR_LOWERCASE_Z;\r\n}\r\n\r\n// Resolves . and .. elements in a path with directory names\r\nfunction normalizeString(path: string, allowAboveRoot: boolean, separator: string, isPathSeparator: (code: number) => boolean)\r\n{\r\n    let res = '';\r\n    let lastSegmentLength = 0;\r\n    let lastSlash = -1;\r\n    let dots = 0;\r\n    let code = -1;\r\n    for (let i = 0; i <= path.length; ++i)\r\n    {\r\n        if (i < path.length)\r\n        { code = path.charCodeAt(i); }\r\n        else if (isPathSeparator(code))\r\n        { break; }\r\n        else\r\n        { code = CHAR_FORWARD_SLASH; }\r\n\r\n        if (isPathSeparator(code))\r\n        {\r\n            if (lastSlash === i - 1 || dots === 1)\r\n            {\r\n                // NOOP\r\n            }\r\n            else if (lastSlash !== i - 1 && dots === 2)\r\n            {\r\n                if (res.length < 2 || lastSegmentLength !== 2\r\n                    || res.charCodeAt(res.length - 1) !== CHAR_DOT\r\n                    || res.charCodeAt(res.length - 2) !== CHAR_DOT)\r\n                {\r\n                    if (res.length > 2)\r\n                    {\r\n                        const lastSlashIndex = res.lastIndexOf(separator);\r\n                        if (lastSlashIndex === -1)\r\n                        {\r\n                            res = '';\r\n                            lastSegmentLength = 0;\r\n                        }\r\n                        else\r\n                        {\r\n                            res = res.slice(0, lastSlashIndex);\r\n                            lastSegmentLength = res.length - 1 - res.lastIndexOf(separator);\r\n                        }\r\n                        lastSlash = i;\r\n                        dots = 0;\r\n                        continue;\r\n                    }\r\n                    else if (res.length === 2 || res.length === 1)\r\n                    {\r\n                        res = '';\r\n                        lastSegmentLength = 0;\r\n                        lastSlash = i;\r\n                        dots = 0;\r\n                        continue;\r\n                    }\r\n                }\r\n                if (allowAboveRoot)\r\n                {\r\n                    if (res.length > 0)\r\n                    { res += `${separator}..`; }\r\n                    else\r\n                    { res = '..'; }\r\n                    lastSegmentLength = 2;\r\n                }\r\n            }\r\n            else\r\n            {\r\n                if (res.length > 0)\r\n                { res += separator + path.slice(lastSlash + 1, i); }\r\n                else\r\n                { res = path.slice(lastSlash + 1, i); }\r\n                lastSegmentLength = i - lastSlash - 1;\r\n            }\r\n            lastSlash = i;\r\n            dots = 0;\r\n        }\r\n        else if (code === CHAR_DOT && dots !== -1)\r\n        {\r\n            ++dots;\r\n        }\r\n        else\r\n        {\r\n            dots = -1;\r\n        }\r\n    }\r\n\r\n    return res;\r\n}\r\n\r\nfunction _format(sep: string, pathObject: { dir: string, root: string, base: string, name: string, ext: string })\r\n{\r\n    const dir = pathObject.dir || pathObject.root;\r\n    const base = pathObject.base\r\n        || ((pathObject.name || '') + (pathObject.ext || ''));\r\n    if (!dir)\r\n    {\r\n        return base;\r\n    }\r\n    if (dir === pathObject.root)\r\n    {\r\n        return dir + base;\r\n    }\r\n\r\n    return dir + sep + base;\r\n}\r\n\r\nclass Win32Path implements Path\r\n{\r\n    // path.resolve([from ...], to)\r\n    resolve(..._pathSegments: string[]): string\r\n    {\r\n        let resolvedDevice = '';\r\n        let resolvedTail = '';\r\n        let resolvedAbsolute = false;\r\n\r\n        for (let i = arguments.length - 1; i >= -1; i--)\r\n        {\r\n            let path: string;\r\n            if (i >= 0)\r\n            {\r\n                // eslint-disable-next-line prefer-rest-params\r\n                path = arguments[i];\r\n            }\r\n            else if (!resolvedDevice)\r\n            {\r\n                path = process.cwd();\r\n            }\r\n            else\r\n            {\r\n                // Windows has the concept of drive-specific current working\r\n                // directories. If we've resolved a drive letter but not yet an\r\n                // absolute path, get cwd for that drive, or the process cwd if\r\n                // the drive cwd is not available. We're sure the device is not\r\n                // a UNC path at this points, because UNC paths are always absolute.\r\n                path = process.env[`=${resolvedDevice}`] || process.cwd();\r\n\r\n                // Verify that a cwd was found and that it actually points\r\n                // to our drive. If not, default to the drive's root.\r\n                if (path === undefined\r\n                    || path.slice(0, 3).toLowerCase()\r\n                    !== `${resolvedDevice.toLowerCase()}\\\\`)\r\n                {\r\n                    path = `${resolvedDevice}\\\\`;\r\n                }\r\n            }\r\n\r\n            validateString(path, 'path');\r\n\r\n            // Skip empty entries\r\n            if (path.length === 0)\r\n            {\r\n                continue;\r\n            }\r\n\r\n            const len = path.length;\r\n            let rootEnd = 0;\r\n            let device = '';\r\n            let isAbsolute = false;\r\n            const code = path.charCodeAt(0);\r\n\r\n            // Try to match a root\r\n            if (len > 1)\r\n            {\r\n                if (isPathSeparator(code))\r\n                {\r\n                    // Possible UNC root\r\n\r\n                    // If we started with a separator, we know we at least have an\r\n                    // absolute path of some kind (UNC or otherwise)\r\n                    isAbsolute = true;\r\n\r\n                    if (isPathSeparator(path.charCodeAt(1)))\r\n                    {\r\n                        // Matched double path separator at beginning\r\n                        let j = 2;\r\n                        let last = j;\r\n                        // Match 1 or more non-path separators\r\n                        for (; j < len; ++j)\r\n                        {\r\n                            if (isPathSeparator(path.charCodeAt(j)))\r\n                            { break; }\r\n                        }\r\n                        if (j < len && j !== last)\r\n                        {\r\n                            const firstPart = path.slice(last, j);\r\n                            // Matched!\r\n                            last = j;\r\n                            // Match 1 or more path separators\r\n                            for (; j < len; ++j)\r\n                            {\r\n                                if (!isPathSeparator(path.charCodeAt(j)))\r\n                                { break; }\r\n                            }\r\n                            if (j < len && j !== last)\r\n                            {\r\n                                // Matched!\r\n                                last = j;\r\n                                // Match 1 or more non-path separators\r\n                                for (; j < len; ++j)\r\n                                {\r\n                                    // eslint-disable-next-line max-depth\r\n                                    if (isPathSeparator(path.charCodeAt(j))) { break; }\r\n                                }\r\n                                if (j === len)\r\n                                {\r\n                                    // We matched a UNC root only\r\n\r\n                                    device = `\\\\\\\\${firstPart}\\\\${path.slice(last)}`;\r\n                                    rootEnd = j;\r\n                                }\r\n                                else if (j !== last)\r\n                                {\r\n                                    // We matched a UNC root with leftovers\r\n\r\n                                    device = `\\\\\\\\${firstPart}\\\\${path.slice(last, j)}`;\r\n                                    rootEnd = j;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    else\r\n                    {\r\n                        rootEnd = 1;\r\n                    }\r\n                }\r\n                else if (isWindowsDeviceRoot(code))\r\n                {\r\n                    // Possible device root\r\n\r\n                    if (path.charCodeAt(1) === CHAR_COLON)\r\n                    {\r\n                        device = path.slice(0, 2);\r\n                        rootEnd = 2;\r\n                        if (len > 2)\r\n                        {\r\n                            if (isPathSeparator(path.charCodeAt(2)))\r\n                            {\r\n                                // Treat separator following drive name as an absolute path\r\n                                // indicator\r\n                                isAbsolute = true;\r\n                                rootEnd = 3;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            else if (isPathSeparator(code))\r\n            {\r\n                // `path` contains just a path separator\r\n                rootEnd = 1;\r\n                isAbsolute = true;\r\n            }\r\n\r\n            if (device.length > 0\r\n                && resolvedDevice.length > 0\r\n                && device.toLowerCase() !== resolvedDevice.toLowerCase())\r\n            {\r\n                // This path points to another device so it is not applicable\r\n                continue;\r\n            }\r\n\r\n            if (resolvedDevice.length === 0 && device.length > 0)\r\n            {\r\n                resolvedDevice = device;\r\n            }\r\n            if (!resolvedAbsolute)\r\n            {\r\n                resolvedTail = `${path.slice(rootEnd)}\\\\${resolvedTail}`;\r\n                resolvedAbsolute = isAbsolute;\r\n            }\r\n\r\n            if (resolvedDevice.length > 0 && resolvedAbsolute)\r\n            {\r\n                break;\r\n            }\r\n        }\r\n\r\n        // At this point the path should be resolved to a full absolute path,\r\n        // but handle relative paths to be safe (might happen when process.cwd()\r\n        // fails)\r\n\r\n        // Normalize the tail path\r\n        resolvedTail = normalizeString(resolvedTail, !resolvedAbsolute, '\\\\',\r\n            isPathSeparator);\r\n\r\n        return (resolvedDevice + (resolvedAbsolute ? '\\\\' : '') + resolvedTail)\r\n            || '.';\r\n    }\r\n\r\n    normalize(path: string)\r\n    {\r\n        validateString(path, 'path');\r\n        const len = path.length;\r\n        if (len === 0)\r\n        { return '.'; }\r\n        let rootEnd = 0;\r\n        let device;\r\n        let isAbsolute = false;\r\n        const code = path.charCodeAt(0);\r\n\r\n        // Try to match a root\r\n        if (len > 1)\r\n        {\r\n            if (isPathSeparator(code))\r\n            {\r\n                // Possible UNC root\r\n\r\n                // If we started with a separator, we know we at least have an absolute\r\n                // path of some kind (UNC or otherwise)\r\n                isAbsolute = true;\r\n\r\n                if (isPathSeparator(path.charCodeAt(1)))\r\n                {\r\n                    // Matched double path separator at beginning\r\n                    let j = 2;\r\n                    let last = j;\r\n                    // Match 1 or more non-path separators\r\n                    for (; j < len; ++j)\r\n                    {\r\n                        if (isPathSeparator(path.charCodeAt(j)))\r\n                        { break; }\r\n                    }\r\n                    if (j < len && j !== last)\r\n                    {\r\n                        const firstPart = path.slice(last, j);\r\n                        // Matched!\r\n                        last = j;\r\n                        // Match 1 or more path separators\r\n                        for (; j < len; ++j)\r\n                        {\r\n                            if (!isPathSeparator(path.charCodeAt(j)))\r\n                            { break; }\r\n                        }\r\n                        if (j < len && j !== last)\r\n                        {\r\n                            // Matched!\r\n                            last = j;\r\n                            // Match 1 or more non-path separators\r\n                            for (; j < len; ++j)\r\n                            {\r\n                                // eslint-disable-next-line max-depth\r\n                                if (isPathSeparator(path.charCodeAt(j))) { break; }\r\n                            }\r\n                            if (j === len)\r\n                            {\r\n                                // We matched a UNC root only\r\n                                // Return the normalized version of the UNC root since there\r\n                                // is nothing left to process\r\n\r\n                                return `\\\\\\\\${firstPart}\\\\${path.slice(last)}\\\\`;\r\n                            }\r\n                            else if (j !== last)\r\n                            {\r\n                                // We matched a UNC root with leftovers\r\n\r\n                                device = `\\\\\\\\${firstPart}\\\\${path.slice(last, j)}`;\r\n                                rootEnd = j;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                else\r\n                {\r\n                    rootEnd = 1;\r\n                }\r\n            }\r\n            else if (isWindowsDeviceRoot(code))\r\n            {\r\n                // Possible device root\r\n\r\n                if (path.charCodeAt(1) === CHAR_COLON)\r\n                {\r\n                    device = path.slice(0, 2);\r\n                    rootEnd = 2;\r\n                    if (len > 2)\r\n                    {\r\n                        if (isPathSeparator(path.charCodeAt(2)))\r\n                        {\r\n                            // Treat separator following drive name as an absolute path\r\n                            // indicator\r\n                            isAbsolute = true;\r\n                            rootEnd = 3;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else if (isPathSeparator(code))\r\n        {\r\n            // `path` contains just a path separator, exit early to avoid unnecessary\r\n            // work\r\n            return '\\\\';\r\n        }\r\n\r\n        let tail: string;\r\n        if (rootEnd < len)\r\n        {\r\n            tail = normalizeString(path.slice(rootEnd), !isAbsolute, '\\\\',\r\n                isPathSeparator);\r\n        }\r\n        else\r\n        {\r\n            tail = '';\r\n        }\r\n        if (tail.length === 0 && !isAbsolute)\r\n        { tail = '.'; }\r\n        if (tail.length > 0 && isPathSeparator(path.charCodeAt(len - 1)))\r\n        { tail += '\\\\'; }\r\n        if (device === undefined)\r\n        {\r\n            if (isAbsolute)\r\n            {\r\n                if (tail.length > 0)\r\n                { return `\\\\${tail}`; }\r\n\r\n                return '\\\\';\r\n            }\r\n            else if (tail.length > 0)\r\n            {\r\n                return tail;\r\n            }\r\n\r\n            return '';\r\n        }\r\n        else if (isAbsolute)\r\n        {\r\n            if (tail.length > 0)\r\n            { return `${device}\\\\${tail}`; }\r\n\r\n            return `${device}\\\\`;\r\n        }\r\n        else if (tail.length > 0)\r\n        {\r\n            return device + tail;\r\n        }\r\n\r\n        return device;\r\n    }\r\n\r\n    isAbsolute(path: string)\r\n    {\r\n        validateString(path, 'path');\r\n        const len = path.length;\r\n        if (len === 0)\r\n        { return false; }\r\n\r\n        const code = path.charCodeAt(0);\r\n        if (isPathSeparator(code))\r\n        {\r\n            return true;\r\n        }\r\n        else if (isWindowsDeviceRoot(code))\r\n        {\r\n            // Possible device root\r\n\r\n            if (len > 2 && path.charCodeAt(1) === CHAR_COLON)\r\n            {\r\n                if (isPathSeparator(path.charCodeAt(2)))\r\n                { return true; }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    join()\r\n    {\r\n        if (arguments.length === 0)\r\n        { return '.'; }\r\n\r\n        let joined;\r\n        let firstPart;\r\n        for (let i = 0; i < arguments.length; ++i)\r\n        {\r\n            // eslint-disable-next-line prefer-rest-params\r\n            const arg = arguments[i];\r\n            validateString(arg, 'path');\r\n            if (arg.length > 0)\r\n            {\r\n                if (joined === undefined)\r\n                { joined = firstPart = arg; }\r\n                else\r\n                { joined += `\\\\${arg}`; }\r\n            }\r\n        }\r\n\r\n        if (joined === undefined)\r\n        { return '.'; }\r\n\r\n        // Make sure that the joined path doesn't start with two slashes, because\r\n        // normalize() will mistake it for an UNC path then.\r\n        //\r\n        // This step is skipped when it is very clear that the user actually\r\n        // intended to point at an UNC path. This is assumed when the first\r\n        // non-empty string arguments starts with exactly two slashes followed by\r\n        // at least one more non-slash character.\r\n        //\r\n        // Note that for normalize() to treat a path as an UNC path it needs to\r\n        // have at least 2 components, so we don't filter for that here.\r\n        // This means that the user can use join to construct UNC paths from\r\n        // a server name and a share name; for example:\r\n        //   path.join('//server', 'share') -> '\\\\\\\\server\\\\share\\\\')\r\n        let needsReplace = true;\r\n        let slashCount = 0;\r\n        if (isPathSeparator(firstPart.charCodeAt(0)))\r\n        {\r\n            ++slashCount;\r\n            const firstLen = firstPart.length;\r\n            if (firstLen > 1)\r\n            {\r\n                if (isPathSeparator(firstPart.charCodeAt(1)))\r\n                {\r\n                    ++slashCount;\r\n                    if (firstLen > 2)\r\n                    {\r\n                        if (isPathSeparator(firstPart.charCodeAt(2)))\r\n                        { ++slashCount; }\r\n                        else\r\n                        {\r\n                            // We matched a UNC path in the first part\r\n                            needsReplace = false;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (needsReplace)\r\n        {\r\n            // Find any more consecutive slashes we need to replace\r\n            for (; slashCount < joined.length; ++slashCount)\r\n            {\r\n                if (!isPathSeparator(joined.charCodeAt(slashCount)))\r\n                { break; }\r\n            }\r\n\r\n            // Replace the slashes if needed\r\n            if (slashCount >= 2)\r\n            { joined = `\\\\${joined.slice(slashCount)}`; }\r\n        }\r\n\r\n        return win32.normalize(joined);\r\n    }\r\n\r\n    // It will solve the relative path from `from` to `to`, for instance:\r\n    //  from = 'C:\\\\orandea\\\\test\\\\aaa'\r\n    //  to = 'C:\\\\orandea\\\\impl\\\\bbb'\r\n    // The output of the function should be: '..\\\\..\\\\impl\\\\bbb'\r\n    relative(from: string, to: string)\r\n    {\r\n        validateString(from, 'from');\r\n        validateString(to, 'to');\r\n\r\n        if (from === to)\r\n        { return ''; }\r\n\r\n        const fromOrig = win32.resolve(from);\r\n        const toOrig = win32.resolve(to);\r\n\r\n        if (fromOrig === toOrig)\r\n        { return ''; }\r\n\r\n        from = fromOrig.toLowerCase();\r\n        to = toOrig.toLowerCase();\r\n\r\n        if (from === to)\r\n        { return ''; }\r\n\r\n        // Trim any leading backslashes\r\n        let fromStart = 0;\r\n        for (; fromStart < from.length; ++fromStart)\r\n        {\r\n            if (from.charCodeAt(fromStart) !== CHAR_BACKWARD_SLASH)\r\n            { break; }\r\n        }\r\n        // Trim trailing backslashes (applicable to UNC paths only)\r\n        let fromEnd = from.length;\r\n        for (; fromEnd - 1 > fromStart; --fromEnd)\r\n        {\r\n            if (from.charCodeAt(fromEnd - 1) !== CHAR_BACKWARD_SLASH)\r\n            { break; }\r\n        }\r\n        const fromLen = (fromEnd - fromStart);\r\n\r\n        // Trim any leading backslashes\r\n        let toStart = 0;\r\n        for (; toStart < to.length; ++toStart)\r\n        {\r\n            if (to.charCodeAt(toStart) !== CHAR_BACKWARD_SLASH)\r\n            { break; }\r\n        }\r\n        // Trim trailing backslashes (applicable to UNC paths only)\r\n        let toEnd = to.length;\r\n        for (; toEnd - 1 > toStart; --toEnd)\r\n        {\r\n            if (to.charCodeAt(toEnd - 1) !== CHAR_BACKWARD_SLASH)\r\n            { break; }\r\n        }\r\n        const toLen = (toEnd - toStart);\r\n\r\n        // Compare paths to find the longest common path from root\r\n        const length = (fromLen < toLen ? fromLen : toLen);\r\n        let lastCommonSep = -1;\r\n        let i = 0;\r\n        for (; i <= length; ++i)\r\n        {\r\n            if (i === length)\r\n            {\r\n                if (toLen > length)\r\n                {\r\n                    if (to.charCodeAt(toStart + i) === CHAR_BACKWARD_SLASH)\r\n                    {\r\n                        // We get here if `from` is the exact base path for `to`.\r\n                        // For example: from='C:\\\\foo\\\\bar'; to='C:\\\\foo\\\\bar\\\\baz'\r\n                        return toOrig.slice(toStart + i + 1);\r\n                    }\r\n                    else if (i === 2)\r\n                    {\r\n                        // We get here if `from` is the device root.\r\n                        // For example: from='C:\\\\'; to='C:\\\\foo'\r\n                        return toOrig.slice(toStart + i);\r\n                    }\r\n                }\r\n                if (fromLen > length)\r\n                {\r\n                    if (from.charCodeAt(fromStart + i) === CHAR_BACKWARD_SLASH)\r\n                    {\r\n                        // We get here if `to` is the exact base path for `from`.\r\n                        // For example: from='C:\\\\foo\\\\bar'; to='C:\\\\foo'\r\n                        lastCommonSep = i;\r\n                    }\r\n                    else if (i === 2)\r\n                    {\r\n                        // We get here if `to` is the device root.\r\n                        // For example: from='C:\\\\foo\\\\bar'; to='C:\\\\'\r\n                        lastCommonSep = 3;\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n            const fromCode = from.charCodeAt(fromStart + i);\r\n            const toCode = to.charCodeAt(toStart + i);\r\n            if (fromCode !== toCode)\r\n            { break; }\r\n            else if (fromCode === CHAR_BACKWARD_SLASH)\r\n            { lastCommonSep = i; }\r\n        }\r\n\r\n        // We found a mismatch before the first common path separator was seen, so\r\n        // return the original `to`.\r\n        if (i !== length && lastCommonSep === -1)\r\n        {\r\n            return toOrig;\r\n        }\r\n\r\n        let out = '';\r\n        if (lastCommonSep === -1)\r\n        { lastCommonSep = 0; }\r\n        // Generate the relative path based on the path difference between `to` and\r\n        // `from`\r\n        for (i = fromStart + lastCommonSep + 1; i <= fromEnd; ++i)\r\n        {\r\n            if (i === fromEnd || from.charCodeAt(i) === CHAR_BACKWARD_SLASH)\r\n            {\r\n                if (out.length === 0)\r\n                { out += '..'; }\r\n                else\r\n                { out += '\\\\..'; }\r\n            }\r\n        }\r\n\r\n        // Lastly, append the rest of the destination (`to`) path that comes after\r\n        // the common path parts\r\n        if (out.length > 0)\r\n        { return out + toOrig.slice(toStart + lastCommonSep, toEnd); }\r\n\r\n        toStart += lastCommonSep;\r\n        if (toOrig.charCodeAt(toStart) === CHAR_BACKWARD_SLASH)\r\n        { ++toStart; }\r\n\r\n        return toOrig.slice(toStart, toEnd);\r\n    }\r\n\r\n    toNamespacedPath(path: string)\r\n    {\r\n        // Note: this will *probably* throw somewhere.\r\n        if (typeof path !== 'string')\r\n        { return path; }\r\n\r\n        if (path.length === 0)\r\n        {\r\n            return '';\r\n        }\r\n\r\n        const resolvedPath = win32.resolve(path);\r\n\r\n        if (resolvedPath.length >= 3)\r\n        {\r\n            if (resolvedPath.charCodeAt(0) === CHAR_BACKWARD_SLASH)\r\n            {\r\n                // Possible UNC root\r\n\r\n                if (resolvedPath.charCodeAt(1) === CHAR_BACKWARD_SLASH)\r\n                {\r\n                    const code = resolvedPath.charCodeAt(2);\r\n                    if (code !== CHAR_QUESTION_MARK && code !== CHAR_DOT)\r\n                    {\r\n                        // Matched non-long UNC root, convert the path to a long UNC path\r\n                        return `\\\\\\\\?\\\\UNC\\\\${resolvedPath.slice(2)}`;\r\n                    }\r\n                }\r\n            }\r\n            else if (isWindowsDeviceRoot(resolvedPath.charCodeAt(0)))\r\n            {\r\n                // Possible device root\r\n\r\n                if (resolvedPath.charCodeAt(1) === CHAR_COLON\r\n                    && resolvedPath.charCodeAt(2) === CHAR_BACKWARD_SLASH)\r\n                {\r\n                    // Matched device root, convert the path to a long UNC path\r\n                    return `\\\\\\\\?\\\\${resolvedPath}`;\r\n                }\r\n            }\r\n        }\r\n\r\n        return path;\r\n    }\r\n\r\n    dirname(path: string)\r\n    {\r\n        validateString(path, 'path');\r\n        const len = path.length;\r\n        if (len === 0)\r\n        { return '.'; }\r\n        let rootEnd = -1;\r\n        let end = -1;\r\n        let matchedSlash = true;\r\n        let offset = 0;\r\n        const code = path.charCodeAt(0);\r\n\r\n        // Try to match a root\r\n        if (len > 1)\r\n        {\r\n            if (isPathSeparator(code))\r\n            {\r\n                // Possible UNC root\r\n\r\n                rootEnd = offset = 1;\r\n\r\n                if (isPathSeparator(path.charCodeAt(1)))\r\n                {\r\n                    // Matched double path separator at beginning\r\n                    let j = 2;\r\n                    let last = j;\r\n                    // Match 1 or more non-path separators\r\n                    for (; j < len; ++j)\r\n                    {\r\n                        if (isPathSeparator(path.charCodeAt(j)))\r\n                        { break; }\r\n                    }\r\n                    if (j < len && j !== last)\r\n                    {\r\n                        // Matched!\r\n                        last = j;\r\n                        // Match 1 or more path separators\r\n                        for (; j < len; ++j)\r\n                        {\r\n                            if (!isPathSeparator(path.charCodeAt(j)))\r\n                            { break; }\r\n                        }\r\n                        if (j < len && j !== last)\r\n                        {\r\n                            // Matched!\r\n                            last = j;\r\n                            // Match 1 or more non-path separators\r\n                            for (; j < len; ++j)\r\n                            {\r\n                                // eslint-disable-next-line max-depth\r\n                                if (isPathSeparator(path.charCodeAt(j))) { break; }\r\n                            }\r\n                            if (j === len)\r\n                            {\r\n                                // We matched a UNC root only\r\n                                return path;\r\n                            }\r\n                            if (j !== last)\r\n                            {\r\n                                // We matched a UNC root with leftovers\r\n\r\n                                // Offset by 1 to include the separator after the UNC root to\r\n                                // treat it as a \"normal root\" on top of a (UNC) root\r\n                                rootEnd = offset = j + 1;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            else if (isWindowsDeviceRoot(code))\r\n            {\r\n                // Possible device root\r\n\r\n                if (path.charCodeAt(1) === CHAR_COLON)\r\n                {\r\n                    rootEnd = offset = 2;\r\n                    if (len > 2)\r\n                    {\r\n                        if (isPathSeparator(path.charCodeAt(2)))\r\n                        { rootEnd = offset = 3; }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else if (isPathSeparator(code))\r\n        {\r\n            // `path` contains just a path separator, exit early to avoid\r\n            // unnecessary work\r\n            return path;\r\n        }\r\n\r\n        for (let i = len - 1; i >= offset; --i)\r\n        {\r\n            if (isPathSeparator(path.charCodeAt(i)))\r\n            {\r\n                if (!matchedSlash)\r\n                {\r\n                    end = i;\r\n                    break;\r\n                }\r\n            }\r\n            else\r\n            {\r\n                // We saw the first non-path separator\r\n                matchedSlash = false;\r\n            }\r\n        }\r\n\r\n        if (end === -1)\r\n        {\r\n            if (rootEnd === -1)\r\n            { return '.'; }\r\n            end = rootEnd;\r\n        }\r\n\r\n        return path.slice(0, end);\r\n    }\r\n\r\n    basename(path: string, ext: string)\r\n    {\r\n        if (ext !== undefined)\r\n        { validateString(ext, 'ext'); }\r\n        validateString(path, 'path');\r\n        let start = 0;\r\n        let end = -1;\r\n        let matchedSlash = true;\r\n        let i;\r\n\r\n        // Check for a drive letter prefix so as not to mistake the following\r\n        // path separator as an extra separator at the end of the path that can be\r\n        // disregarded\r\n        if (path.length >= 2)\r\n        {\r\n            const drive = path.charCodeAt(0);\r\n            if (isWindowsDeviceRoot(drive))\r\n            {\r\n                if (path.charCodeAt(1) === CHAR_COLON)\r\n                { start = 2; }\r\n            }\r\n        }\r\n\r\n        if (ext !== undefined && ext.length > 0 && ext.length <= path.length)\r\n        {\r\n            if (ext.length === path.length && ext === path)\r\n            { return ''; }\r\n            let extIdx = ext.length - 1;\r\n            let firstNonSlashEnd = -1;\r\n            for (i = path.length - 1; i >= start; --i)\r\n            {\r\n                const code = path.charCodeAt(i);\r\n                if (isPathSeparator(code))\r\n                {\r\n                    // If we reached a path separator that was not part of a set of path\r\n                    // separators at the end of the string, stop now\r\n                    if (!matchedSlash)\r\n                    {\r\n                        start = i + 1;\r\n                        break;\r\n                    }\r\n                }\r\n                else\r\n                {\r\n                    if (firstNonSlashEnd === -1)\r\n                    {\r\n                        // We saw the first non-path separator, remember this index in case\r\n                        // we need it if the extension ends up not matching\r\n                        matchedSlash = false;\r\n                        firstNonSlashEnd = i + 1;\r\n                    }\r\n                    if (extIdx >= 0)\r\n                    {\r\n                        // Try to match the explicit extension\r\n                        if (code === ext.charCodeAt(extIdx))\r\n                        {\r\n                            if (--extIdx === -1)\r\n                            {\r\n                                // We matched the extension, so mark this as the end of our path\r\n                                // component\r\n                                end = i;\r\n                            }\r\n                        }\r\n                        else\r\n                        {\r\n                            // Extension does not match, so our result is the entire path\r\n                            // component\r\n                            extIdx = -1;\r\n                            end = firstNonSlashEnd;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (start === end)\r\n            { end = firstNonSlashEnd; }\r\n            else if (end === -1)\r\n            { end = path.length; }\r\n\r\n            return path.slice(start, end);\r\n        }\r\n        for (i = path.length - 1; i >= start; --i)\r\n        {\r\n            if (isPathSeparator(path.charCodeAt(i)))\r\n            {\r\n                // If we reached a path separator that was not part of a set of path\r\n                // separators at the end of the string, stop now\r\n                if (!matchedSlash)\r\n                {\r\n                    start = i + 1;\r\n                    break;\r\n                }\r\n            }\r\n            else if (end === -1)\r\n            {\r\n                // We saw the first non-path separator, mark this as the end of our\r\n                // path component\r\n                matchedSlash = false;\r\n                end = i + 1;\r\n            }\r\n        }\r\n\r\n        if (end === -1)\r\n        { return ''; }\r\n\r\n        return path.slice(start, end);\r\n    }\r\n\r\n    extname(path: string)\r\n    {\r\n        validateString(path, 'path');\r\n        let start = 0;\r\n        let startDot = -1;\r\n        let startPart = 0;\r\n        let end = -1;\r\n        let matchedSlash = true;\r\n        // Track the state of characters (if any) we see before our first dot and\r\n        // after any path separator we find\r\n        let preDotState = 0;\r\n\r\n        // Check for a drive letter prefix so as not to mistake the following\r\n        // path separator as an extra separator at the end of the path that can be\r\n        // disregarded\r\n\r\n        if (path.length >= 2\r\n            && path.charCodeAt(1) === CHAR_COLON\r\n            && isWindowsDeviceRoot(path.charCodeAt(0)))\r\n        {\r\n            start = startPart = 2;\r\n        }\r\n\r\n        for (let i = path.length - 1; i >= start; --i)\r\n        {\r\n            const code = path.charCodeAt(i);\r\n            if (isPathSeparator(code))\r\n            {\r\n                // If we reached a path separator that was not part of a set of path\r\n                // separators at the end of the string, stop now\r\n                if (!matchedSlash)\r\n                {\r\n                    startPart = i + 1;\r\n                    break;\r\n                }\r\n                continue;\r\n            }\r\n            if (end === -1)\r\n            {\r\n                // We saw the first non-path separator, mark this as the end of our\r\n                // extension\r\n                matchedSlash = false;\r\n                end = i + 1;\r\n            }\r\n            if (code === CHAR_DOT)\r\n            {\r\n                // If this is our first dot, mark it as the start of our extension\r\n                if (startDot === -1)\r\n                { startDot = i; }\r\n                else if (preDotState !== 1)\r\n                { preDotState = 1; }\r\n            }\r\n            else if (startDot !== -1)\r\n            {\r\n                // We saw a non-dot and non-path separator before our dot, so we should\r\n                // have a good chance at having a non-empty extension\r\n                preDotState = -1;\r\n            }\r\n        }\r\n\r\n        if (startDot === -1\r\n            || end === -1\r\n            // We saw a non-dot character immediately before the dot\r\n            || preDotState === 0\r\n            // The (right-most) trimmed path component is exactly '..'\r\n            || (preDotState === 1\r\n                && startDot === end - 1\r\n                && startDot === startPart + 1))\r\n        {\r\n            return '';\r\n        }\r\n\r\n        return path.slice(startDot, end);\r\n    }\r\n\r\n    format(pathObject: {\r\n        dir: string;\r\n        root: string;\r\n        base: string;\r\n        name: string;\r\n        ext: string;\r\n    })\r\n    {\r\n        if (pathObject === null || typeof pathObject !== 'object')\r\n        {\r\n            throw new ERR_INVALID_ARG_TYPE('pathObject', 'Object', pathObject);\r\n        }\r\n\r\n        return _format('\\\\', pathObject);\r\n    }\r\n\r\n    parse(path: string)\r\n    {\r\n        validateString(path, 'path');\r\n\r\n        const ret = { root: '', dir: '', base: '', ext: '', name: '' };\r\n        if (path.length === 0)\r\n        { return ret; }\r\n\r\n        const len = path.length;\r\n        let rootEnd = 0;\r\n        let code = path.charCodeAt(0);\r\n\r\n        // Try to match a root\r\n        if (len > 1)\r\n        {\r\n            if (isPathSeparator(code))\r\n            {\r\n                // Possible UNC root\r\n\r\n                rootEnd = 1;\r\n                if (isPathSeparator(path.charCodeAt(1)))\r\n                {\r\n                    // Matched double path separator at beginning\r\n                    let j = 2;\r\n                    let last = j;\r\n                    // Match 1 or more non-path separators\r\n                    for (; j < len; ++j)\r\n                    {\r\n                        if (isPathSeparator(path.charCodeAt(j)))\r\n                        { break; }\r\n                    }\r\n                    if (j < len && j !== last)\r\n                    {\r\n                        // Matched!\r\n                        last = j;\r\n                        // Match 1 or more path separators\r\n                        for (; j < len; ++j)\r\n                        {\r\n                            if (!isPathSeparator(path.charCodeAt(j)))\r\n                            { break; }\r\n                        }\r\n                        if (j < len && j !== last)\r\n                        {\r\n                            // Matched!\r\n                            last = j;\r\n                            // Match 1 or more non-path separators\r\n                            for (; j < len; ++j)\r\n                            {\r\n                                // eslint-disable-next-line max-depth\r\n                                if (isPathSeparator(path.charCodeAt(j)))\r\n                                {\r\n                                    break;\r\n                                }\r\n                            }\r\n                            if (j === len)\r\n                            {\r\n                                // We matched a UNC root only\r\n\r\n                                rootEnd = j;\r\n                            }\r\n                            else if (j !== last)\r\n                            {\r\n                                // We matched a UNC root with leftovers\r\n\r\n                                rootEnd = j + 1;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            else if (isWindowsDeviceRoot(code))\r\n            {\r\n                // Possible device root\r\n\r\n                if (path.charCodeAt(1) === CHAR_COLON)\r\n                {\r\n                    rootEnd = 2;\r\n                    if (len > 2)\r\n                    {\r\n                        if (isPathSeparator(path.charCodeAt(2)))\r\n                        {\r\n                            if (len === 3)\r\n                            {\r\n                                // `path` contains just a drive root, exit early to avoid\r\n                                // unnecessary work\r\n                                ret.root = ret.dir = path;\r\n\r\n                                return ret;\r\n                            }\r\n                            rootEnd = 3;\r\n                        }\r\n                    }\r\n                    else\r\n                    {\r\n                        // `path` contains just a drive root, exit early to avoid\r\n                        // unnecessary work\r\n                        ret.root = ret.dir = path;\r\n\r\n                        return ret;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else if (isPathSeparator(code))\r\n        {\r\n            // `path` contains just a path separator, exit early to avoid\r\n            // unnecessary work\r\n            ret.root = ret.dir = path;\r\n\r\n            return ret;\r\n        }\r\n\r\n        if (rootEnd > 0)\r\n        { ret.root = path.slice(0, rootEnd); }\r\n\r\n        let startDot = -1;\r\n        let startPart = rootEnd;\r\n        let end = -1;\r\n        let matchedSlash = true;\r\n        let i = path.length - 1;\r\n\r\n        // Track the state of characters (if any) we see before our first dot and\r\n        // after any path separator we find\r\n        let preDotState = 0;\r\n\r\n        // Get non-dir info\r\n        for (; i >= rootEnd; --i)\r\n        {\r\n            code = path.charCodeAt(i);\r\n            if (isPathSeparator(code))\r\n            {\r\n                // If we reached a path separator that was not part of a set of path\r\n                // separators at the end of the string, stop now\r\n                if (!matchedSlash)\r\n                {\r\n                    startPart = i + 1;\r\n                    break;\r\n                }\r\n                continue;\r\n            }\r\n            if (end === -1)\r\n            {\r\n                // We saw the first non-path separator, mark this as the end of our\r\n                // extension\r\n                matchedSlash = false;\r\n                end = i + 1;\r\n            }\r\n            if (code === CHAR_DOT)\r\n            {\r\n                // If this is our first dot, mark it as the start of our extension\r\n                if (startDot === -1)\r\n                { startDot = i; }\r\n                else if (preDotState !== 1)\r\n                { preDotState = 1; }\r\n            }\r\n            else if (startDot !== -1)\r\n            {\r\n                // We saw a non-dot and non-path separator before our dot, so we should\r\n                // have a good chance at having a non-empty extension\r\n                preDotState = -1;\r\n            }\r\n        }\r\n\r\n        if (startDot === -1\r\n            || end === -1\r\n            // We saw a non-dot character immediately before the dot\r\n            || preDotState === 0\r\n            // The (right-most) trimmed path component is exactly '..'\r\n            || (preDotState === 1\r\n                && startDot === end - 1\r\n                && startDot === startPart + 1))\r\n        {\r\n            if (end !== -1)\r\n            {\r\n                ret.base = ret.name = path.slice(startPart, end);\r\n            }\r\n        }\r\n        else\r\n        {\r\n            ret.name = path.slice(startPart, startDot);\r\n            ret.base = path.slice(startPart, end);\r\n            ret.ext = path.slice(startDot, end);\r\n        }\r\n\r\n        // If the directory is the root, use the entire root as the `dir` including\r\n        // the trailing slash if any (`C:\\abc` -> `C:\\`). Otherwise, strip out the\r\n        // trailing slash (`C:\\abc\\def` -> `C:\\abc`).\r\n        if (startPart > 0 && startPart !== rootEnd)\r\n        { ret.dir = path.slice(0, startPart - 1); }\r\n        else\r\n        { ret.dir = ret.root; }\r\n\r\n        return ret;\r\n    }\r\n\r\n    sep: '\\\\' | '/' = '\\\\';\r\n    delimiter: ';' | ':' = ';';\r\n    win32: Win32Path = <any>null;\r\n    posix: PosixPath = <any>null;\r\n}\r\n\r\nclass PosixPath implements Path\r\n{\r\n    // path.resolve([from ...], to)\r\n    resolve(..._pathSegments: string[]): string\r\n    {\r\n        let resolvedPath = '';\r\n        let resolvedAbsolute = false;\r\n\r\n        for (let i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--)\r\n        {\r\n            let path;\r\n            if (i >= 0)\r\n            // eslint-disable-next-line prefer-rest-params\r\n            { path = arguments[i]; }\r\n            else\r\n            {\r\n                path = process.cwd();\r\n            }\r\n\r\n            validateString(path, 'path');\r\n\r\n            // Skip empty entries\r\n            if (path.length === 0)\r\n            {\r\n                continue;\r\n            }\r\n\r\n            resolvedPath = `${path}/${resolvedPath}`;\r\n            resolvedAbsolute = path.charCodeAt(0) === CHAR_FORWARD_SLASH;\r\n        }\r\n\r\n        // At this point the path should be resolved to a full absolute path, but\r\n        // handle relative paths to be safe (might happen when process.cwd() fails)\r\n\r\n        // Normalize the path\r\n        resolvedPath = normalizeString(resolvedPath, !resolvedAbsolute, '/',\r\n            isPosixPathSeparator);\r\n\r\n        if (resolvedAbsolute)\r\n        {\r\n            if (resolvedPath.length > 0)\r\n            { return `/${resolvedPath}`; }\r\n\r\n            return '/';\r\n        }\r\n        else if (resolvedPath.length > 0)\r\n        {\r\n            return resolvedPath;\r\n        }\r\n\r\n        return '.';\r\n    }\r\n\r\n    normalize(path: string)\r\n    {\r\n        validateString(path, 'path');\r\n\r\n        if (path.length === 0)\r\n        { return '.'; }\r\n\r\n        const isAbsolute = path.charCodeAt(0) === CHAR_FORWARD_SLASH;\r\n        const trailingSeparator\r\n            = path.charCodeAt(path.length - 1) === CHAR_FORWARD_SLASH;\r\n\r\n        // Normalize the path\r\n        path = normalizeString(path, !isAbsolute, '/', isPosixPathSeparator);\r\n\r\n        if (path.length === 0 && !isAbsolute)\r\n        { path = '.'; }\r\n        if (path.length > 0 && trailingSeparator)\r\n        { path += '/'; }\r\n\r\n        if (isAbsolute)\r\n        { return `/${path}`; }\r\n\r\n        return path;\r\n    }\r\n\r\n    isAbsolute(path: string)\r\n    {\r\n        validateString(path, 'path');\r\n\r\n        return path.length > 0 && path.charCodeAt(0) === CHAR_FORWARD_SLASH;\r\n    }\r\n\r\n    join()\r\n    {\r\n        if (arguments.length === 0)\r\n        { return '.'; }\r\n        let joined;\r\n        for (let i = 0; i < arguments.length; ++i)\r\n        {\r\n            // eslint-disable-next-line prefer-rest-params\r\n            const arg = arguments[i];\r\n            validateString(arg, 'path');\r\n            if (arg.length > 0)\r\n            {\r\n                if (joined === undefined)\r\n                { joined = arg; }\r\n                else\r\n                { joined += `/${arg}`; }\r\n            }\r\n        }\r\n        if (joined === undefined)\r\n        { return '.'; }\r\n\r\n        return posix.normalize(joined);\r\n    }\r\n\r\n    relative(from: string, to: string)\r\n    {\r\n        validateString(from, 'from');\r\n        validateString(to, 'to');\r\n\r\n        if (from === to)\r\n        { return ''; }\r\n\r\n        from = posix.resolve(from);\r\n        to = posix.resolve(to);\r\n\r\n        if (from === to)\r\n        { return ''; }\r\n\r\n        // Trim any leading backslashes\r\n        let fromStart = 1;\r\n        for (; fromStart < from.length; ++fromStart)\r\n        {\r\n            if (from.charCodeAt(fromStart) !== CHAR_FORWARD_SLASH)\r\n            { break; }\r\n        }\r\n        const fromEnd = from.length;\r\n        const fromLen = (fromEnd - fromStart);\r\n\r\n        // Trim any leading backslashes\r\n        let toStart = 1;\r\n        for (; toStart < to.length; ++toStart)\r\n        {\r\n            if (to.charCodeAt(toStart) !== CHAR_FORWARD_SLASH)\r\n            { break; }\r\n        }\r\n        const toEnd = to.length;\r\n        const toLen = (toEnd - toStart);\r\n\r\n        // Compare paths to find the longest common path from root\r\n        const length = (fromLen < toLen ? fromLen : toLen);\r\n        let lastCommonSep = -1;\r\n        let i = 0;\r\n        for (; i <= length; ++i)\r\n        {\r\n            if (i === length)\r\n            {\r\n                if (toLen > length)\r\n                {\r\n                    if (to.charCodeAt(toStart + i) === CHAR_FORWARD_SLASH)\r\n                    {\r\n                        // We get here if `from` is the exact base path for `to`.\r\n                        // For example: from='/foo/bar'; to='/foo/bar/baz'\r\n                        return to.slice(toStart + i + 1);\r\n                    }\r\n                    else if (i === 0)\r\n                    {\r\n                        // We get here if `from` is the root\r\n                        // For example: from='/'; to='/foo'\r\n                        return to.slice(toStart + i);\r\n                    }\r\n                }\r\n                else if (fromLen > length)\r\n                {\r\n                    if (from.charCodeAt(fromStart + i) === CHAR_FORWARD_SLASH)\r\n                    {\r\n                        // We get here if `to` is the exact base path for `from`.\r\n                        // For example: from='/foo/bar/baz'; to='/foo/bar'\r\n                        lastCommonSep = i;\r\n                    }\r\n                    else if (i === 0)\r\n                    {\r\n                        // We get here if `to` is the root.\r\n                        // For example: from='/foo'; to='/'\r\n                        lastCommonSep = 0;\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n            const fromCode = from.charCodeAt(fromStart + i);\r\n            const toCode = to.charCodeAt(toStart + i);\r\n            if (fromCode !== toCode)\r\n            { break; }\r\n            else if (fromCode === CHAR_FORWARD_SLASH)\r\n            { lastCommonSep = i; }\r\n        }\r\n\r\n        let out = '';\r\n        // Generate the relative path based on the path difference between `to`\r\n        // and `from`\r\n        for (i = fromStart + lastCommonSep + 1; i <= fromEnd; ++i)\r\n        {\r\n            if (i === fromEnd || from.charCodeAt(i) === CHAR_FORWARD_SLASH)\r\n            {\r\n                if (out.length === 0)\r\n                { out += '..'; }\r\n                else\r\n                { out += '/..'; }\r\n            }\r\n        }\r\n\r\n        // Lastly, append the rest of the destination (`to`) path that comes after\r\n        // the common path parts\r\n        if (out.length > 0)\r\n        { return out + to.slice(toStart + lastCommonSep); }\r\n\r\n        toStart += lastCommonSep;\r\n        if (to.charCodeAt(toStart) === CHAR_FORWARD_SLASH)\r\n        { ++toStart; }\r\n\r\n        return to.slice(toStart);\r\n    }\r\n\r\n    toNamespacedPath(path: string)\r\n    {\r\n        // Non-op on posix systems\r\n        return path;\r\n    }\r\n\r\n    dirname(path: string)\r\n    {\r\n        validateString(path, 'path');\r\n        if (path.length === 0)\r\n        { return '.'; }\r\n        const hasRoot = path.charCodeAt(0) === CHAR_FORWARD_SLASH;\r\n        let end = -1;\r\n        let matchedSlash = true;\r\n        for (let i = path.length - 1; i >= 1; --i)\r\n        {\r\n            if (path.charCodeAt(i) === CHAR_FORWARD_SLASH)\r\n            {\r\n                if (!matchedSlash)\r\n                {\r\n                    end = i;\r\n                    break;\r\n                }\r\n            }\r\n            else\r\n            {\r\n                // We saw the first non-path separator\r\n                matchedSlash = false;\r\n            }\r\n        }\r\n\r\n        if (end === -1)\r\n        { return hasRoot ? '/' : '.'; }\r\n        if (hasRoot && end === 1)\r\n        { return '//'; }\r\n\r\n        return path.slice(0, end);\r\n    }\r\n\r\n    basename(path: string, ext: string)\r\n    {\r\n        if (ext !== undefined)\r\n        { validateString(ext, 'ext'); }\r\n        validateString(path, 'path');\r\n\r\n        let start = 0;\r\n        let end = -1;\r\n        let matchedSlash = true;\r\n        let i;\r\n\r\n        if (ext !== undefined && ext.length > 0 && ext.length <= path.length)\r\n        {\r\n            if (ext.length === path.length && ext === path)\r\n            { return ''; }\r\n            let extIdx = ext.length - 1;\r\n            let firstNonSlashEnd = -1;\r\n            for (i = path.length - 1; i >= 0; --i)\r\n            {\r\n                const code = path.charCodeAt(i);\r\n                if (code === CHAR_FORWARD_SLASH)\r\n                {\r\n                    // If we reached a path separator that was not part of a set of path\r\n                    // separators at the end of the string, stop now\r\n                    if (!matchedSlash)\r\n                    {\r\n                        start = i + 1;\r\n                        break;\r\n                    }\r\n                }\r\n                else\r\n                {\r\n                    if (firstNonSlashEnd === -1)\r\n                    {\r\n                        // We saw the first non-path separator, remember this index in case\r\n                        // we need it if the extension ends up not matching\r\n                        matchedSlash = false;\r\n                        firstNonSlashEnd = i + 1;\r\n                    }\r\n                    if (extIdx >= 0)\r\n                    {\r\n                        // Try to match the explicit extension\r\n                        if (code === ext.charCodeAt(extIdx))\r\n                        {\r\n                            if (--extIdx === -1)\r\n                            {\r\n                                // We matched the extension, so mark this as the end of our path\r\n                                // component\r\n                                end = i;\r\n                            }\r\n                        }\r\n                        else\r\n                        {\r\n                            // Extension does not match, so our result is the entire path\r\n                            // component\r\n                            extIdx = -1;\r\n                            end = firstNonSlashEnd;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (start === end)\r\n            { end = firstNonSlashEnd; }\r\n            else if (end === -1)\r\n            { end = path.length; }\r\n\r\n            return path.slice(start, end);\r\n        }\r\n        for (i = path.length - 1; i >= 0; --i)\r\n        {\r\n            if (path.charCodeAt(i) === CHAR_FORWARD_SLASH)\r\n            {\r\n                // If we reached a path separator that was not part of a set of path\r\n                // separators at the end of the string, stop now\r\n                if (!matchedSlash)\r\n                {\r\n                    start = i + 1;\r\n                    break;\r\n                }\r\n            }\r\n            else if (end === -1)\r\n            {\r\n                // We saw the first non-path separator, mark this as the end of our\r\n                // path component\r\n                matchedSlash = false;\r\n                end = i + 1;\r\n            }\r\n        }\r\n\r\n        if (end === -1)\r\n        { return ''; }\r\n\r\n        return path.slice(start, end);\r\n    }\r\n\r\n    extname(path: string)\r\n    {\r\n        validateString(path, 'path');\r\n        let startDot = -1;\r\n        let startPart = 0;\r\n        let end = -1;\r\n        let matchedSlash = true;\r\n        // Track the state of characters (if any) we see before our first dot and\r\n        // after any path separator we find\r\n        let preDotState = 0;\r\n        for (let i = path.length - 1; i >= 0; --i)\r\n        {\r\n            const code = path.charCodeAt(i);\r\n            if (code === CHAR_FORWARD_SLASH)\r\n            {\r\n                // If we reached a path separator that was not part of a set of path\r\n                // separators at the end of the string, stop now\r\n                if (!matchedSlash)\r\n                {\r\n                    startPart = i + 1;\r\n                    break;\r\n                }\r\n                continue;\r\n            }\r\n            if (end === -1)\r\n            {\r\n                // We saw the first non-path separator, mark this as the end of our\r\n                // extension\r\n                matchedSlash = false;\r\n                end = i + 1;\r\n            }\r\n            if (code === CHAR_DOT)\r\n            {\r\n                // If this is our first dot, mark it as the start of our extension\r\n                if (startDot === -1)\r\n                { startDot = i; }\r\n                else if (preDotState !== 1)\r\n                { preDotState = 1; }\r\n            }\r\n            else if (startDot !== -1)\r\n            {\r\n                // We saw a non-dot and non-path separator before our dot, so we should\r\n                // have a good chance at having a non-empty extension\r\n                preDotState = -1;\r\n            }\r\n        }\r\n\r\n        if (startDot === -1\r\n            || end === -1\r\n            // We saw a non-dot character immediately before the dot\r\n            || preDotState === 0\r\n            // The (right-most) trimmed path component is exactly '..'\r\n            || (preDotState === 1\r\n                && startDot === end - 1\r\n                && startDot === startPart + 1))\r\n        {\r\n            return '';\r\n        }\r\n\r\n        return path.slice(startDot, end);\r\n    }\r\n\r\n    format(pathObject: {\r\n        dir: string;\r\n        root: string;\r\n        base: string;\r\n        name: string;\r\n        ext: string;\r\n    })\r\n    {\r\n        if (pathObject === null || typeof pathObject !== 'object')\r\n        {\r\n            throw new ERR_INVALID_ARG_TYPE('pathObject', 'Object', pathObject);\r\n        }\r\n\r\n        return _format('/', pathObject);\r\n    }\r\n\r\n    parse(path: string)\r\n    {\r\n        validateString(path, 'path');\r\n\r\n        const ret = { root: '', dir: '', base: '', ext: '', name: '' };\r\n        if (path.length === 0)\r\n        { return ret; }\r\n        const isAbsolute = path.charCodeAt(0) === CHAR_FORWARD_SLASH;\r\n        let start;\r\n        if (isAbsolute)\r\n        {\r\n            ret.root = '/';\r\n            start = 1;\r\n        }\r\n        else\r\n        {\r\n            start = 0;\r\n        }\r\n        let startDot = -1;\r\n        let startPart = 0;\r\n        let end = -1;\r\n        let matchedSlash = true;\r\n        let i = path.length - 1;\r\n\r\n        // Track the state of characters (if any) we see before our first dot and\r\n        // after any path separator we find\r\n        let preDotState = 0;\r\n\r\n        // Get non-dir info\r\n        for (; i >= start; --i)\r\n        {\r\n            const code = path.charCodeAt(i);\r\n            if (code === CHAR_FORWARD_SLASH)\r\n            {\r\n                // If we reached a path separator that was not part of a set of path\r\n                // separators at the end of the string, stop now\r\n                if (!matchedSlash)\r\n                {\r\n                    startPart = i + 1;\r\n                    break;\r\n                }\r\n                continue;\r\n            }\r\n            if (end === -1)\r\n            {\r\n                // We saw the first non-path separator, mark this as the end of our\r\n                // extension\r\n                matchedSlash = false;\r\n                end = i + 1;\r\n            }\r\n            if (code === CHAR_DOT)\r\n            {\r\n                // If this is our first dot, mark it as the start of our extension\r\n                if (startDot === -1)\r\n                { startDot = i; }\r\n                else if (preDotState !== 1)\r\n                { preDotState = 1; }\r\n            }\r\n            else if (startDot !== -1)\r\n            {\r\n                // We saw a non-dot and non-path separator before our dot, so we should\r\n                // have a good chance at having a non-empty extension\r\n                preDotState = -1;\r\n            }\r\n        }\r\n\r\n        if (startDot === -1\r\n            || end === -1\r\n            // We saw a non-dot character immediately before the dot\r\n            || preDotState === 0\r\n            // The (right-most) trimmed path component is exactly '..'\r\n            || (preDotState === 1\r\n                && startDot === end - 1\r\n                && startDot === startPart + 1))\r\n        {\r\n            if (end !== -1)\r\n            {\r\n                if (startPart === 0 && isAbsolute)\r\n                { ret.base = ret.name = path.slice(1, end); }\r\n                else\r\n                { ret.base = ret.name = path.slice(startPart, end); }\r\n            }\r\n        }\r\n        else\r\n        {\r\n            if (startPart === 0 && isAbsolute)\r\n            {\r\n                ret.name = path.slice(1, startDot);\r\n                ret.base = path.slice(1, end);\r\n            }\r\n            else\r\n            {\r\n                ret.name = path.slice(startPart, startDot);\r\n                ret.base = path.slice(startPart, end);\r\n            }\r\n            ret.ext = path.slice(startDot, end);\r\n        }\r\n\r\n        if (startPart > 0)\r\n        { ret.dir = path.slice(0, startPart - 1); }\r\n        else if (isAbsolute)\r\n        { ret.dir = '/'; }\r\n\r\n        return ret;\r\n    }\r\n\r\n    sep: '\\\\' | '/' = '/';\r\n    delimiter: ';' | ':' = ':';\r\n    win32: Win32Path = <any>null;\r\n    posix: PosixPath = <any>null;\r\n}\r\n\r\nconst win32 = new Win32Path();\r\nconst posix = new PosixPath();\r\n\r\nposix.win32 = win32.win32 = win32;\r\nposix.posix = win32.posix = posix;\r\n\r\n// Legacy internal API, docs-only deprecated: DEP0080\r\n// win32._makeLong = win32.toNamespacedPath;\r\n// posix._makeLong = posix.toNamespacedPath;\r\n\r\n// if (process.platform === 'win32')\r\n//     module.exports = win32;\r\n// else\r\n//     module.exports = posix;\r\n\r\n//\r\n\r\n/**\r\n * 路径\r\n *\r\n * 从nodeJs的path移植\r\n *\r\n * @see http://nodejs.cn/api/path.html\r\n * @see https://github.com/nodejs/node/blob/master/lib/path.js\r\n */\r\nexport const path: Path = (process.platform === 'win32') ? win32 : posix;\r\n","import { Lazy, lazy, ArrayUtils } from '@feng3d/polyfill';\r\n\r\n/**\r\n * 心跳计时器\r\n */\r\nexport class Ticker\r\n{\r\n    /**\r\n     * 帧率\r\n     */\r\n    frameRate = 60;\r\n    /**\r\n     * 注册帧函数\r\n     * @param func  执行方法\r\n     * @param thisObject    方法this指针\r\n     * @param priority      执行优先级\r\n     */\r\n    onframe(func: (interval: number) => void, thisObject?: Object, priority = 0)\r\n    {\r\n        this.on(() => 1000 / this.frameRate, func, thisObject, priority);\r\n\r\n        return this;\r\n    }\r\n    /**\r\n     * 下一帧执行方法\r\n     * @param func  执行方法\r\n     * @param thisObject    方法this指针\r\n     * @param priority      执行优先级\r\n     */\r\n    nextframe(func: (interval: number) => void, thisObject?: Object, priority = 0)\r\n    {\r\n        this.once(() => 1000 / this.frameRate, func, thisObject, priority);\r\n\r\n        return this;\r\n    }\r\n    /**\r\n     * 注销帧函数（只执行一次）\r\n     * @param func  执行方法\r\n     * @param thisObject    方法this指针\r\n     * @param priority      执行优先级\r\n     */\r\n    offframe(func: (interval: number) => void, thisObject?: Object)\r\n    {\r\n        this.off(() => 1000 / this.frameRate, func, thisObject);\r\n\r\n        return this;\r\n    }\r\n    /**\r\n     * 注册周期函数\r\n     * @param interval  执行周期，以ms为单位\r\n     * @param func  执行方法\r\n     * @param thisObject    方法this指针\r\n     * @param priority      执行优先级\r\n     */\r\n    on(interval: Lazy<number>, func: (interval: number) => void, thisObject?: Object, priority = 0)\r\n    {\r\n        addTickerFunc({ interval, func, thisObject, priority, once: false });\r\n\r\n        return this;\r\n    }\r\n    /**\r\n     * 注册周期函数（只执行一次）\r\n     * @param interval  执行周期，以ms为单位\r\n     * @param func  执行方法\r\n     * @param thisObject    方法this指针\r\n     * @param priority      执行优先级\r\n     */\r\n    once(interval: Lazy<number>, func: (interval: number) => void, thisObject?: Object, priority = 0)\r\n    {\r\n        addTickerFunc({ interval, func, thisObject, priority, once: true });\r\n\r\n        return this;\r\n    }\r\n    /**\r\n     * 注销周期函数\r\n     * @param interval  执行周期，以ms为单位\r\n     * @param func  执行方法\r\n     * @param thisObject    方法this指针\r\n     */\r\n    off(interval: Lazy<number>, func: (interval: number) => void, thisObject?: Object)\r\n    {\r\n        removeTickerFunc({ interval, func, thisObject });\r\n\r\n        return this;\r\n    }\r\n    /**\r\n     * 重复指定次数 执行函数\r\n     * @param interval  执行周期，以ms为单位\r\n     * @param \trepeatCount     执行次数\r\n     * @param func  执行方法\r\n     * @param thisObject    方法this指针\r\n     * @param priority      执行优先级\r\n     */\r\n    repeat(interval: Lazy<number>, repeatCount: number, func: (interval: number) => void, thisObject?: Object, priority = 0)\r\n    {\r\n        repeatCount = ~~repeatCount;\r\n        if (repeatCount < 1)\r\n        { return; }\r\n        const timer = new Timer(this, interval, repeatCount, func, thisObject, priority);\r\n\r\n        return timer;\r\n    }\r\n}\r\n\r\n/**\r\n * 心跳计时器\r\n */\r\nexport const ticker = new Ticker();\r\n\r\nexport class Timer\r\n{\r\n    private ticker: Ticker;\r\n    private interval: Lazy<number>;\r\n    private priority: number;\r\n    private func: (interval: number) => void;\r\n    private thisObject: Object;\r\n\r\n    /**\r\n     * 计时器从 0 开始后触发的总次数。\r\n     */\r\n    currentCount = 0;\r\n    /**\r\n     * 计时器事件间的延迟（以毫秒为单位）。\r\n     */\r\n    delay: number;\r\n    /**\r\n     * 设置的计时器运行总次数。\r\n     */\r\n    repeatCount: number;\r\n\r\n    constructor(ticker: Ticker, interval: Lazy<number>, repeatCount: number, func: (interval: number) => void, thisObject?: Object, priority = 0)\r\n    {\r\n        this.ticker = ticker;\r\n        this.interval = interval;\r\n        this.func = func;\r\n        this.thisObject = thisObject;\r\n        this.priority = priority;\r\n    }\r\n    /**\r\n     * 如果计时器尚未运行，则启动计时器。\r\n     */\r\n    start()\r\n    {\r\n        this.ticker.on(this.interval, this.runfunc, this, this.priority);\r\n\r\n        return this;\r\n    }\r\n    /**\r\n     * 停止计时器。\r\n     */\r\n    stop()\r\n    {\r\n        this.ticker.off(this.interval, this.runfunc, this);\r\n\r\n        return this;\r\n    }\r\n    /**\r\n     * 如果计时器正在运行，则停止计时器，并将 currentCount 属性设回为 0，这类似于秒表的重置按钮。\r\n     */\r\n    reset()\r\n    {\r\n        this.stop();\r\n        this.currentCount = 0;\r\n\r\n        return this;\r\n    }\r\n\r\n    private runfunc()\r\n    {\r\n        this.currentCount++;\r\n        this.repeatCount--;\r\n        this.func.call(this.thisObject, lazy.getvalue(this.interval));\r\n        if (this.repeatCount < 1)\r\n        { this.stop(); }\r\n    }\r\n}\r\n\r\ninterface TickerFuncItem\r\n{\r\n    interval: Lazy<number>,\r\n    func: (interval: number) => void,\r\n    thisObject?: Object,\r\n    priority?: number,\r\n    once?: boolean\r\n    //\r\n    runtime?: number;\r\n}\r\nconst tickerFuncs: TickerFuncItem[] = [];\r\n\r\nfunction addTickerFunc(item: TickerFuncItem)\r\n{\r\n    if (running)\r\n    {\r\n        affers.push([addTickerFunc, [item]]);\r\n\r\n        return;\r\n    }\r\n    // removeTickerFunc(item);\r\n    if (item.priority === undefined)\r\n    { item.priority = 0; }\r\n    item.runtime = Date.now() + lazy.getvalue(item.interval);\r\n    tickerFuncs.push(item);\r\n}\r\n\r\nfunction removeTickerFunc(item: TickerFuncItem)\r\n{\r\n    if (running)\r\n    {\r\n        affers.push([removeTickerFunc, [item]]);\r\n\r\n        return;\r\n    }\r\n    for (let i = tickerFuncs.length - 1; i >= 0; i--)\r\n    {\r\n        const element = tickerFuncs[i];\r\n        if (lazy.getvalue(element.interval) === lazy.getvalue(item.interval)\r\n            && element.func === item.func\r\n            && element.thisObject === item.thisObject\r\n        )\r\n        {\r\n            tickerFuncs.splice(i, 1);\r\n        }\r\n    }\r\n}\r\n\r\nlet running = false;\r\nconst affers: [Function, any[]][] = [];\r\n\r\nfunction runTickerFuncs()\r\n{\r\n    running = true;\r\n    // 倒序，优先级高的排在后面\r\n    tickerFuncs.sort((a, b) =>\r\n        <number>a.priority - <number>b.priority);\r\n    const currenttime = Date.now();\r\n    const needTickerFuncItems: TickerFuncItem[] = [];\r\n    for (let i = tickerFuncs.length - 1; i >= 0; i--)\r\n    {\r\n        const element = tickerFuncs[i];\r\n        if (<number>element.runtime < currenttime)\r\n        {\r\n            needTickerFuncItems.push(element);\r\n            if (element.once)\r\n            {\r\n                tickerFuncs.splice(i, 1);\r\n                continue;\r\n            }\r\n            element.runtime = nextRuntime(<number>element.runtime, lazy.getvalue(element.interval));\r\n        }\r\n    }\r\n    needTickerFuncItems.reverse();\r\n    // 相同的函数只执行一个\r\n    ArrayUtils.unique(needTickerFuncItems, (a, b) => (a.func === b.func && a.thisObject === b.thisObject));\r\n    needTickerFuncItems.forEach((v) =>\r\n    {\r\n        // try\r\n        // {\r\n        v.func.call(v.thisObject, lazy.getvalue(v.interval));\r\n        // } catch (error)\r\n        // {\r\n        //     console.warn(`${v.func} 方法执行错误，从 ticker 中移除`, error)\r\n        //     var index = tickerFuncs.indexOf(v);\r\n        //     if (index != -1) tickerFuncs.splice(index, 1);\r\n        // }\r\n    });\r\n    running = false;\r\n\r\n    for (let i = 0; i < affers.length; i++)\r\n    {\r\n        const affer = affers[i];\r\n        affer[0].apply(null, affer[1]);\r\n    }\r\n    affers.length = 0;\r\n\r\n    localrequestAnimationFrame(runTickerFuncs);\r\n\r\n    function nextRuntime(runtime: number, interval: number)\r\n    {\r\n        return runtime + Math.ceil((currenttime - runtime) / interval) * interval;\r\n    }\r\n}\r\n\r\nlet localrequestAnimationFrame: (callback: FrameRequestCallback) => number;\r\nif (typeof requestAnimationFrame === 'undefined')\r\n{\r\n    let _global: Window;\r\n    let global: any;\r\n    if (typeof window !== 'undefined')\r\n    {\r\n        _global = window;\r\n        localrequestAnimationFrame\r\n            = window['requestAnimationFrame']\r\n            || window['webkitRequestAnimationFrame']\r\n            || window['mozRequestAnimationFrame']\r\n            || window['oRequestAnimationFrame']\r\n            || window['msRequestAnimationFrame'];\r\n    }\r\n    else if (typeof global !== 'undefined')\r\n    {\r\n        _global = <any>global;\r\n    }\r\n    if (localrequestAnimationFrame === undefined)\r\n    {\r\n        localrequestAnimationFrame = function (callback)\r\n        {\r\n            return _global.setTimeout(callback, 1000 / ticker.frameRate);\r\n        };\r\n    }\r\n}\r\nelse\r\n{\r\n    localrequestAnimationFrame = requestAnimationFrame;\r\n}\r\n\r\nrunTickerFuncs();\r\n","import { anyEmitter } from '@feng3d/event';\r\nimport { pathUtils } from '@feng3d/filesystem';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { ticker } from '../utils/Ticker';\r\nimport { AssetMeta } from './AssetMeta';\r\nimport { AssetType } from './AssetType';\r\nimport { FolderAsset } from './FolderAsset';\r\nimport { ReadRS } from './rs/ReadRS';\r\nimport { ReadWriteRS } from './rs/ReadWriteRS';\r\n\r\ndeclare global\r\n{\r\n    interface MixinsAssetTypeClassMap\r\n    {\r\n\r\n    }\r\n}\r\n\r\nexport function getAssetTypeClass<K extends keyof AssetTypeClassMap>(type: K)\r\n{\r\n    return assetTypeClassMap[type];\r\n}\r\n\r\nexport function setAssetTypeClass<K extends keyof AssetTypeClassMap>(type: K, cls: AssetTypeClassMap[K])\r\n{\r\n    assetTypeClassMap[type] = cls;\r\n}\r\n\r\nexport interface AssetTypeClassMap extends MixinsAssetTypeClassMap\r\n{\r\n}\r\n\r\nexport const assetTypeClassMap: AssetTypeClassMap = <any>{};\r\n\r\n/**\r\n * feng3d资源\r\n */\r\nexport abstract class FileAsset\r\n{\r\n    /**\r\n     * 资源路径\r\n     */\r\n    @serialize\r\n    assetPath: string;\r\n\r\n    /**\r\n     * 资源编号\r\n     */\r\n    @serialize\r\n    assetId: string;\r\n\r\n    /**\r\n     * 资源元标签，该对象也用来判断资源是否被加载，值为null表示未加载，否则已加载。\r\n     *\r\n     * 并且该对象还会用于存储主文件无法存储的数据，比如 TextureAsset 中存储了 Texture2D 信息\r\n     */\r\n    meta: AssetMeta;\r\n\r\n    /**\r\n     * 资源系统\r\n     *\r\n     * 加载或者创建该资源的资源系统\r\n     */\r\n    rs: ReadWriteRS;\r\n\r\n    /**\r\n     * 资源类型，由具体对象类型决定\r\n     */\r\n    assetType: AssetType;\r\n\r\n    /**\r\n     * 是否已加载\r\n     */\r\n    isLoaded = false;\r\n\r\n    /**\r\n     * 是否正在加载中\r\n     */\r\n    isLoading = false;\r\n\r\n    /**\r\n     * 文件后缀\r\n     */\r\n    get extenson()\r\n    {\r\n        console.assert(!!this.assetPath);\r\n        const ext = pathUtils.extname(this.assetPath);\r\n\r\n        return ext;\r\n    }\r\n\r\n    /**\r\n     * 父资源\r\n     */\r\n    get parentAsset()\r\n    {\r\n        const dir = pathUtils.dirname(this.assetPath);\r\n        const parent = this.rs.getAssetByPath(dir) as FolderAsset;\r\n\r\n        return parent;\r\n    }\r\n\r\n    /**\r\n     * 文件名称\r\n     *\r\n     * 不包含后缀\r\n     */\r\n    get fileName()\r\n    {\r\n        console.assert(!!this.assetPath);\r\n        const fn = pathUtils.getName(this.assetPath);\r\n\r\n        return fn;\r\n    }\r\n\r\n    /**\r\n     * 资源对象\r\n     */\r\n    data: any;\r\n\r\n    /**\r\n     * 初始化资源\r\n     */\r\n    initAsset()\r\n    {\r\n    }\r\n\r\n    /**\r\n     * 获取资源数据\r\n     *\r\n     * @param callback 完成回调，当资源已加载时会立即调用回调，否则在资源加载完成后调用。\r\n     */\r\n    getAssetData(callback?: (result: any) => void)\r\n    {\r\n        if (!this.isLoaded)\r\n        {\r\n            if (callback)\r\n            {\r\n                this.read((err) =>\r\n                {\r\n                    console.assert(!err);\r\n                    this.getAssetData(callback);\r\n                });\r\n            }\r\n\r\n            return null;\r\n        }\r\n        const assetData = this._getAssetData();\r\n        callback && callback(assetData);\r\n\r\n        return assetData;\r\n    }\r\n\r\n    /**\r\n     * 资源已加载时获取资源数据，内部使用\r\n     */\r\n    protected _getAssetData()\r\n    {\r\n        return this.data;\r\n    }\r\n\r\n    /**\r\n     * 读取资源\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    read(callback: (err?: Error) => void)\r\n    {\r\n        if (this.isLoaded)\r\n        {\r\n            callback();\r\n\r\n            return;\r\n        }\r\n        const eventtype = 'loaded';\r\n        anyEmitter.once(this, eventtype, () =>\r\n        {\r\n            this.isLoaded = true;\r\n            this.isLoading = false;\r\n            callback();\r\n        });\r\n        if (this.isLoading) return;\r\n        this.isLoading = true;\r\n        this.readMeta((err) =>\r\n        {\r\n            if (err)\r\n            {\r\n                anyEmitter.emit(this, eventtype);\r\n\r\n                return;\r\n            }\r\n            this.readFile((_err) =>\r\n            {\r\n                anyEmitter.emit(this, eventtype);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 写入资源\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    write(callback?: (err: Error) => void)\r\n    {\r\n        this.meta.mtimeMs = Date.now();\r\n        this.writeMeta((err) =>\r\n        {\r\n            if (err)\r\n            {\r\n                callback && callback(err);\r\n\r\n                return;\r\n            }\r\n            this.saveFile((err) =>\r\n            {\r\n                callback && callback(err);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 删除资源\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    delete(callback?: (err?: Error) => void)\r\n    {\r\n        // 删除 meta 文件\r\n        this.deleteMeta((err) =>\r\n        {\r\n            if (err)\r\n            {\r\n                callback && callback(err);\r\n\r\n                return;\r\n            }\r\n            this.deleteFile((_err) =>\r\n            {\r\n                // 删除映射\r\n                ReadRS.rs.deleteAssetById(this.assetId);\r\n                callback && callback();\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 读取资源预览图标\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    readPreview(callback: (err: Error, image: HTMLImageElement) => void)\r\n    {\r\n        if (this._preview)\r\n        {\r\n            callback(null, this._preview);\r\n\r\n            return;\r\n        }\r\n        this.rs.fs.readImage(this.previewPath, (err, image) =>\r\n        {\r\n            this._preview = image;\r\n            callback(err, image);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 读取资源预览图标\r\n     *\r\n     * @param image 预览图\r\n     * @param callback 完成回调\r\n     */\r\n    writePreview(image: HTMLImageElement, callback?: (err: Error) => void)\r\n    {\r\n        if (this._preview === image)\r\n        {\r\n            callback && callback(null);\r\n\r\n            return;\r\n        }\r\n        this._preview = image;\r\n        this.rs.fs.writeImage(this.previewPath, image, callback);\r\n    }\r\n\r\n    /**\r\n     * 删除资源预览图标\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    deletePreview(callback?: (err: Error) => void)\r\n    {\r\n        this.rs.fs.deleteFile(this.previewPath, callback);\r\n    }\r\n\r\n    /**\r\n     * 读取文件\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    abstract readFile(callback?: (err: Error) => void): void;\r\n\r\n    /**\r\n     * 保存文件\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    abstract saveFile(callback?: (err: Error) => void): void;\r\n\r\n    /**\r\n     * 删除文件\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    protected deleteFile(callback?: (err: Error) => void)\r\n    {\r\n        this.rs.fs.deleteFile(this.assetPath, callback);\r\n\r\n        // 延迟一帧判断该资源是否被删除，排除移动文件时出现的临时删除情况\r\n        ticker.once(1000, () =>\r\n        {\r\n            if (!this.rs.getAssetById(this.assetId))\r\n            {\r\n                this.deletePreview();\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 元标签路径\r\n     */\r\n    protected get metaPath()\r\n    {\r\n        return `${this.assetPath}.meta`;\r\n    }\r\n\r\n    /**\r\n     * 读取元标签\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    protected readMeta(callback?: (err?: Error) => void)\r\n    {\r\n        this.rs.fs.readObject(this.metaPath, (err, meta: AssetMeta) =>\r\n        {\r\n            this.meta = meta;\r\n            callback && callback(err);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 写元标签\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    protected writeMeta(callback?: (err: Error) => void)\r\n    {\r\n        this.rs.fs.writeObject(this.metaPath, this.meta, callback);\r\n    }\r\n\r\n    /**\r\n     * 删除元标签\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    protected deleteMeta(callback?: (err: Error) => void)\r\n    {\r\n        this.rs.fs.deleteFile(this.metaPath, callback);\r\n    }\r\n\r\n    /**\r\n     * 预览图\r\n     */\r\n    private _preview: HTMLImageElement;\r\n\r\n    /**\r\n     * 预览图路径\r\n     */\r\n    private get previewPath()\r\n    {\r\n        return `previews/${this.assetId}.png`;\r\n    }\r\n}\r\n\r\n","import { ov } from '@feng3d/objectview';\r\nimport { AssetType } from './AssetType';\r\nimport { FileAsset, setAssetTypeClass } from './FileAsset';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsAssetTypeClassMap\r\n    {\r\n        'folder': new () => FolderAsset;\r\n    }\r\n}\r\n\r\n/**\r\n * 文件夹资源\r\n */\r\n@ov({ component: 'OVFolderAsset' })\r\nexport class FolderAsset extends FileAsset\r\n{\r\n    static extenson = '';\r\n\r\n    assetType = AssetType.folder;\r\n\r\n    /**\r\n     * 子资源列表\r\n     */\r\n    get childrenAssets()\r\n    {\r\n        const children = this.rs.getChildrenAssetByPath(this.assetPath);\r\n\r\n        return children;\r\n    }\r\n\r\n    initAsset()\r\n    {\r\n    }\r\n\r\n    /**\r\n     * 删除资源\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    delete(callback?: (err: Error) => void)\r\n    {\r\n        super.delete(callback);\r\n    }\r\n\r\n    /**\r\n     * 保存文件\r\n     * @param callback 完成回调\r\n     */\r\n    saveFile(callback?: (err: Error) => void)\r\n    {\r\n        this.rs.fs.mkdir(this.assetPath, callback);\r\n    }\r\n\r\n    /**\r\n     * 读取文件\r\n     * @param callback 完成回调\r\n     */\r\n    readFile(callback?: (err: Error) => void)\r\n    {\r\n        callback && callback(null);\r\n    }\r\n}\r\n\r\nsetAssetTypeClass('folder', FolderAsset);\r\n","import { FS, pathUtils, ReadFS } from '@feng3d/filesystem';\r\nimport { ArrayUtils, classUtils, Constructor, gPartial, mathUtil, ObjectUtils, __class__ } from '@feng3d/polyfill';\r\nimport { serialization } from '@feng3d/serialization';\r\nimport { task } from '@feng3d/task';\r\nimport { AssetData } from '../../core/AssetData';\r\nimport { path } from '../../utils/Path';\r\nimport { FileAsset } from '../FileAsset';\r\nimport { FolderAsset } from '../FolderAsset';\r\n\r\n/**\r\n * 可读资源系统\r\n */\r\nexport class ReadRS\r\n{\r\n    /**\r\n     * 默认资源系统\r\n     */\r\n    static rs = new ReadRS();\r\n\r\n    /**\r\n     * 文件系统\r\n     */\r\n    get fs() { return this._fs || FS.fs; }\r\n    private _fs: ReadFS;\r\n\r\n    /**\r\n     * 根资源路径\r\n     */\r\n    get rootPath() { return this._rootPath; }\r\n    private _rootPath = 'Assets';\r\n\r\n    /**\r\n     * 根资源\r\n     */\r\n    get root() { return this.getAssetByPath(this.rootPath) as FolderAsset; }\r\n\r\n    /**\r\n     * 资源编号映射\r\n     */\r\n    protected _idMap: { [id: string]: FileAsset } = {};\r\n\r\n    /**\r\n     * 资源路径映射\r\n     */\r\n    protected _pathMap: { [path: string]: FileAsset } = {};\r\n\r\n    /**\r\n     * 资源树保存路径\r\n     */\r\n    protected resources = 'resource.json';\r\n\r\n    /**\r\n     * 构建可读资源系统\r\n     *\r\n     * @param fs 可读文件系统\r\n     */\r\n    constructor(fs?: ReadFS)\r\n    {\r\n        this._fs = fs;\r\n    }\r\n\r\n    /**\r\n     * 初始化\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    init(callback?: () => void)\r\n    {\r\n        this.fs.readObject(this.resources, (_err, object) =>\r\n        {\r\n            if (object)\r\n            {\r\n                const allAssets: FileAsset[] = <any>serialization.deserialize(object);\r\n                //\r\n                allAssets.forEach((asset) =>\r\n                {\r\n                    // 设置资源系统\r\n                    asset.rs = this as any;\r\n                    // 新增映射\r\n                    this.addAsset(asset);\r\n                });\r\n                callback();\r\n            }\r\n            else\r\n            {\r\n                this.createAsset(FolderAsset, this.rootPath, null, null, (_err, _asset) =>\r\n                {\r\n                    callback();\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 新建资源\r\n     *\r\n     * @param Cls 资源类定义\r\n     * @param fileName 文件名称\r\n     * @param value 初始数据\r\n     * @param parent 所在文件夹，如果值为null时默认添加到根文件夹中\r\n     * @param callback 完成回调函数\r\n     */\r\n    createAsset<T extends FileAsset>(Cls: new () => T, fileName?: string, value?: gPartial<T>, parent?: FolderAsset, callback?: (err: Error, asset: T) => void)\r\n    {\r\n        parent = parent || this.root;\r\n        //\r\n        const asset: FileAsset = new Cls();\r\n        const assetId = mathUtil.uuid();\r\n\r\n        // 初始化\r\n        asset.rs = this as any;\r\n        serialization.setValue(<T>asset, value);\r\n        asset.assetId = assetId;\r\n        asset.meta = { guid: assetId, mtimeMs: Date.now(), birthtimeMs: Date.now(), assetType: asset.assetType };\r\n        asset.initAsset();\r\n        AssetData.addAssetData(asset.assetId, asset.data);\r\n\r\n        // 计算扩展名\r\n        let extenson = path.extname(fileName);\r\n        if (extenson === '') extenson = Cls['extenson'];\r\n        console.assert(extenson !== undefined, `对象 ${Cls} 没有设置 extenson 值，参考 FolderAsset.extenson`);\r\n\r\n        // 计算名称\r\n        fileName = pathUtils.getName(fileName);\r\n        // 设置默认名称\r\n        fileName = fileName || `new ${asset.assetType}`;\r\n        //\r\n        if (parent)\r\n        {\r\n            // 计算有效名称\r\n            fileName = this.getValidChildName(parent, fileName);\r\n            asset.assetPath = `${parent.assetPath}/${fileName}${extenson}`;\r\n        }\r\n        else\r\n        {\r\n            asset.assetPath = fileName + extenson;\r\n        }\r\n\r\n        // 新增映射\r\n        this.addAsset(asset);\r\n\r\n        //\r\n        asset.write((_err) =>\r\n        {\r\n            callback && callback(null, <T>asset);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 获取有效子文件名称\r\n     *\r\n     * @param parent 父文件夹\r\n     * @param fileName 文件名称\r\n     */\r\n    getValidChildName(parent: FolderAsset, fileName: string)\r\n    {\r\n        const childrenNames = parent.childrenAssets.map((v) => v.fileName);\r\n        let newName = fileName;\r\n        let index = 1;\r\n        while (childrenNames.indexOf(newName) !== -1)\r\n        {\r\n            newName = fileName + index;\r\n            index++;\r\n        }\r\n\r\n        return newName;\r\n    }\r\n\r\n    /**\r\n     * 读取文件为资源对象\r\n     * @param id 资源编号\r\n     * @param callback 读取完成回调\r\n     */\r\n    readAsset(id: string, callback: (err: Error, asset: FileAsset) => void)\r\n    {\r\n        const asset = this.getAssetById(id);\r\n        if (!asset)\r\n        {\r\n            callback(new Error(`不存在资源 ${id}`), asset);\r\n\r\n            return;\r\n        }\r\n        asset.read((err) =>\r\n        {\r\n            if (asset)\r\n            { AssetData.addAssetData(asset.assetId, asset.data); }\r\n            callback(err, asset);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 读取资源数据\r\n     *\r\n     * @param id 资源编号\r\n     * @param callback 完成回调\r\n     */\r\n    readAssetData(id: string, callback: (err: Error, data: AssetData) => void)\r\n    {\r\n        const asset = AssetData.getLoadedAssetData(id);\r\n        if (asset)\r\n        {\r\n            callback(null, asset);\r\n\r\n            return;\r\n        }\r\n        this.readAsset(id, (err, asset) =>\r\n        {\r\n            callback(err, asset && asset.getAssetData());\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 读取资源数据列表\r\n     *\r\n     * @param assetids 资源编号列表\r\n     * @param callback 完成回调\r\n     */\r\n    readAssetDatas(assetids: string[], callback: (err: Error, data: AssetData[]) => void)\r\n    {\r\n        const result: AssetData[] = [];\r\n        const fns = assetids.map((v) => (callback) =>\r\n        {\r\n            ReadRS.rs.readAssetData(v, (_err, data) =>\r\n            {\r\n                console.assert(!!data);\r\n                result.push(data);\r\n                callback();\r\n            });\r\n        });\r\n        task.parallel(fns)(() =>\r\n        {\r\n            console.assert(assetids.length === result.filter((v) => v !== null).length);\r\n            callback(null, result);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 获取指定类型资源\r\n     *\r\n     * @param type 资源类型\r\n     */\r\n    getAssetsByType<T extends FileAsset>(type: Constructor<T>): T[]\r\n    {\r\n        const assets = Object.keys(this._idMap).map((v) => this._idMap[v]);\r\n\r\n        return <any>assets.filter((v) => v instanceof type);\r\n    }\r\n\r\n    /**\r\n     * 获取指定类型资源数据\r\n     *\r\n     * @param type 资源类型\r\n     */\r\n    getLoadedAssetDatasByType<T>(type: Constructor<T>): T[]\r\n    {\r\n        const assets = AssetData.getAllLoadedAssetDatas();\r\n\r\n        return <any>assets.filter((v) => v instanceof type);\r\n    }\r\n\r\n    /**\r\n     * 获取指定编号资源\r\n     *\r\n     * @param id 资源编号\r\n     */\r\n    getAssetById(id: string)\r\n    {\r\n        return this._idMap[id];\r\n    }\r\n\r\n    /**\r\n     * 获取指定路径资源\r\n     *\r\n     * @param path 资源路径\r\n     */\r\n    getAssetByPath(path: string)\r\n    {\r\n        return this._pathMap[path];\r\n    }\r\n\r\n    /**\r\n     * 获取文件夹内子文件路径列表\r\n     *\r\n     * @param path 路径\r\n     */\r\n    getChildrenPathsByPath(path: string)\r\n    {\r\n        const paths = this.getAllPaths();\r\n        const childrenPaths = paths.filter((v) =>\r\n            pathUtils.dirname(v) === path);\r\n\r\n        return childrenPaths;\r\n    }\r\n\r\n    /**\r\n     * 获取文件夹内子文件列表\r\n     *\r\n     * @param path 文件夹路径\r\n     */\r\n    getChildrenAssetByPath(path: string)\r\n    {\r\n        const childrenPaths = this.getChildrenPathsByPath(path);\r\n\r\n        const children: FileAsset[] = childrenPaths.map((v) => this.getAssetByPath(v));\r\n\r\n        return children;\r\n    }\r\n\r\n    /**\r\n     * 新增资源\r\n     *\r\n     * @param asset 资源\r\n     */\r\n    addAsset(asset: FileAsset)\r\n    {\r\n        this._idMap[asset.assetId] = asset;\r\n        this._pathMap[asset.assetPath] = asset;\r\n    }\r\n\r\n    /**\r\n     * 获取所有资源编号列表\r\n     */\r\n    getAllIds()\r\n    {\r\n        return Object.keys(this._idMap);\r\n    }\r\n\r\n    /**\r\n     * 获取所有资源路径列表\r\n     */\r\n    getAllPaths()\r\n    {\r\n        return Object.keys(this._pathMap);\r\n    }\r\n\r\n    /**\r\n     * 获取所有资源\r\n     */\r\n    getAllAssets()\r\n    {\r\n        const assets = this.getAllIds().map((v) => this.getAssetById(v));\r\n\r\n        return assets;\r\n    }\r\n\r\n    /**\r\n     * 删除指定编号的资源\r\n     *\r\n     * @param id 资源编号\r\n     */\r\n    deleteAssetById(id: string)\r\n    {\r\n        this.deleteAsset0(this.getAssetById(id));\r\n    }\r\n\r\n    /**\r\n     * 删除指定路径的资源\r\n     *\r\n     * @param path 资源路径\r\n     */\r\n    deleteAssetByPath(path: string)\r\n    {\r\n        this.deleteAsset0(this._pathMap[path]);\r\n    }\r\n\r\n    /**\r\n     * 删除资源\r\n     *\r\n     * @param asset 资源\r\n     */\r\n    deleteAsset0(asset: FileAsset)\r\n    {\r\n        delete this._idMap[asset.assetId];\r\n        delete this._pathMap[asset.assetPath];\r\n    }\r\n\r\n    /**\r\n     * 获取需要反序列化对象中的资源id列表\r\n     */\r\n    getAssetsWithObject(object: any, assetids: string[] = [])\r\n    {\r\n        if (ObjectUtils.isBaseType(object)) return [];\r\n        //\r\n        if (AssetData.isAssetData(object)) assetids.push(object.assetId);\r\n        //\r\n        if (ObjectUtils.isObject(object) || Array.isArray(object))\r\n        {\r\n            const keys = Object.keys(object);\r\n            keys.forEach((k) =>\r\n            {\r\n                this.getAssetsWithObject(object[k], assetids);\r\n            });\r\n        }\r\n\r\n        return assetids;\r\n    }\r\n\r\n    /**\r\n     * 反序列化包含资源的对象\r\n     *\r\n     * @param object 反序列化的对象\r\n     * @param callback 完成回调\r\n     */\r\n    deserializeWithAssets(object: any, callback: (result: any) => void)\r\n    {\r\n        // 获取所包含的资源列表\r\n        const assetids = this.getAssetsWithObject(object);\r\n        // 不需要加载本资源，移除自身资源\r\n        ArrayUtils.deleteItem(assetids, object.assetId);\r\n        // 加载包含的资源数据\r\n        this.readAssetDatas(assetids, (_err, _result) =>\r\n        {\r\n            // 创建资源数据实例\r\n            const assetData = classUtils.getInstanceByName(object[__class__]);\r\n            // 默认反序列\r\n            serialization.setValue(assetData, object);\r\n            callback(assetData);\r\n        });\r\n    }\r\n}\r\n","import { classUtils, MapUtils, __class__ } from '@feng3d/polyfill';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { AssetType } from '../assets/AssetType';\r\nimport { ReadRS } from '../assets/rs/ReadRS';\r\nimport { Feng3dObject } from './Feng3dObject';\r\n\r\n/**\r\n * 资源数据\r\n *\r\n * 该对象可由资源文件中读取，或者保存为资源\r\n */\r\nexport class AssetData extends Feng3dObject\r\n{\r\n    /**\r\n     * 资源名称\r\n     */\r\n    @serialize\r\n    get assetName(): string\r\n    {\r\n        const asset = ReadRS.rs.getAssetById(this.assetId);\r\n        if (asset)\r\n        {\r\n            return asset.fileName;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * 资源编号\r\n     */\r\n    @serialize\r\n    get assetId()\r\n    {\r\n        return this._assetId;\r\n    }\r\n    set assetId(v)\r\n    {\r\n        if (this._assetId === v) return;\r\n\r\n        if (this._assetId !== undefined)\r\n        {\r\n            console.error(`不允许修改 assetId`);\r\n\r\n            return;\r\n        }\r\n\r\n        this._assetId = v;\r\n    }\r\n    private _assetId: string;\r\n\r\n    /**\r\n     * 资源类型，由具体对象类型决定\r\n     */\r\n    assetType: AssetType;\r\n\r\n    /**\r\n     * 新增资源数据\r\n     *\r\n     * @param assetId 资源编号\r\n     * @param data 资源数据\r\n     */\r\n    static addAssetData<T>(assetId: string, data: T)\r\n    {\r\n        if (!data) return;\r\n        if (this.assetMap.has(data) || this.idAssetMap.has(assetId))\r\n        {\r\n            console.warn(`同一个材质被保存在多个资源中！`);\r\n        }\r\n\r\n        this.assetMap.set(data, assetId);\r\n        this.idAssetMap.set(assetId, data);\r\n\r\n        return data;\r\n    }\r\n\r\n    /**\r\n     * 删除资源数据\r\n     *\r\n     * @param data 资源数据\r\n     */\r\n    static deleteAssetData(data: any)\r\n    {\r\n        if (!data) return;\r\n        console.assert(this.assetMap.has(data));\r\n        const assetId = this.assetMap.get(data);\r\n        this._delete(assetId, data);\r\n    }\r\n\r\n    static deleteAssetDataById(assetId: string)\r\n    {\r\n        console.assert(this.idAssetMap.has(assetId));\r\n        const data = this.idAssetMap.get(assetId);\r\n        this._delete(assetId, data);\r\n    }\r\n\r\n    private static _delete(assetId, data: any)\r\n    {\r\n        this.assetMap.delete(data);\r\n        this.idAssetMap.delete(assetId);\r\n    }\r\n\r\n    /**\r\n     * 判断是否为资源数据\r\n     *\r\n     * @param asset 可能的资源数据\r\n     */\r\n    static isAssetData(asset: any): asset is AssetData\r\n    {\r\n        if (this.assetMap.has(asset)) return true;\r\n        if (asset instanceof AssetData) return true;\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * 资源属性标记名称\r\n     */\r\n    private static assetPropertySign = 'assetId';\r\n\r\n    /**\r\n     * 序列化\r\n     *\r\n     * @param asset 资源数据\r\n     */\r\n    static serialize(asset: AssetData)\r\n    {\r\n        const obj = <any>{};\r\n        obj[__class__] = classUtils.getQualifiedClassName(asset);\r\n        obj.assetId = asset.assetId;\r\n\r\n        return obj;\r\n    }\r\n\r\n    /**\r\n     * 反序列化\r\n     *\r\n     * @param object 资源对象\r\n     */\r\n    static deserialize(object: any)\r\n    {\r\n        const result = this.getLoadedAssetData(object.assetId);\r\n        console.assert(!!result, `资源 ${object.assetId} 未加载，请使用 ReadRS.deserializeWithAssets 进行序列化包含加载的资源对象。`);\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * 获取已加载的资源数据\r\n     *\r\n     * @param assetId 资源编号\r\n     */\r\n    static getLoadedAssetData(assetId: string)\r\n    {\r\n        return this.idAssetMap.get(assetId);\r\n    }\r\n\r\n    /**\r\n     * 获取所有已加载资源数据\r\n     */\r\n    static getAllLoadedAssetDatas()\r\n    {\r\n        return MapUtils.getKeys(this.assetMap);\r\n    }\r\n\r\n    /**\r\n     * 资源与编号对应表\r\n     */\r\n    static assetMap = new Map<any, string>();\r\n\r\n    /**\r\n     * 编号与资源对应表\r\n     */\r\n    static idAssetMap = new Map<string, any>();\r\n}\r\n\r\n/**\r\n * 设置函数列表\r\n */\r\nserialization.setValueHandlers.push(\r\n    // 处理资源\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property, param)\r\n        {\r\n            const tpv = target[property];\r\n            const spv = source[property];\r\n            if (AssetData.isAssetData(spv))\r\n            {\r\n                // 此处需要反序列化资源完整数据\r\n                if (property === '__root__')\r\n                {\r\n                    return false;\r\n                }\r\n\r\n                target[property] = AssetData.deserialize(spv);\r\n\r\n                return true;\r\n            }\r\n            if (AssetData.isAssetData(tpv))\r\n            {\r\n                if (spv.__class__ === null)\r\n                {\r\n                    const className = classUtils.getQualifiedClassName(tpv);\r\n                    const inst = classUtils.getInstanceByName(className);\r\n                    param.serialization.setValue(inst, spv);\r\n                    target[property] = inst;\r\n                }\r\n                else\r\n                {\r\n                    target[property] = param.serialization.deserialize(spv);\r\n                }\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n);\r\n\r\nserialization.serializeHandlers.push(\r\n    // 处理资源\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property)\r\n        {\r\n            const spv = source[property];\r\n            if (AssetData.isAssetData(spv))\r\n            {\r\n                // 此处需要反序列化资源完整数据\r\n                if (property === '__root__')\r\n                {\r\n                    return false;\r\n                }\r\n                target[property] = AssetData.serialize(<any>spv);\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n);\r\n\r\nserialization.deserializeHandlers.push(\r\n    // 处理资源\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property, param)\r\n        {\r\n            const tpv = target[property];\r\n            const spv = source[property];\r\n            if (AssetData.isAssetData(spv))\r\n            {\r\n                // 此处需要反序列化资源完整数据\r\n                if (property === '__root__')\r\n                {\r\n                    return false;\r\n                }\r\n                target[property] = AssetData.deserialize(spv);\r\n\r\n                return true;\r\n            }\r\n            if (AssetData.isAssetData(tpv))\r\n            {\r\n                target[property] = param.serialization.deserialize(spv);\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n    // 处理资源\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property, param)\r\n        {\r\n            const tpv = target[property];\r\n            const spv = source[property];\r\n            if (AssetData.isAssetData(spv))\r\n            {\r\n                // 此处需要反序列化资源完整数据\r\n                if (property === '__root__')\r\n                {\r\n                    return false;\r\n                }\r\n                target[property] = AssetData.deserialize(spv);\r\n\r\n                return true;\r\n            }\r\n            if (AssetData.assetMap.has(tpv))\r\n            {\r\n                target[property] = param.serialization.deserialize(spv);\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n);\r\n\r\nserialization.differentHandlers.push(\r\n    // 资源\r\n    {\r\n        priority: 0,\r\n        handler(target, source, property, param)\r\n        {\r\n            const different = param.different;\r\n            const tpv = target[property];\r\n            if (AssetData.isAssetData(tpv))\r\n            {\r\n                // 此处需要反序列化资源完整数据\r\n                if (property === '__root__')\r\n                {\r\n                    return false;\r\n                }\r\n                different[property] = AssetData.serialize(tpv);\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    },\r\n);\r\n\r\n","import { Box3, Matrix4x4, Ray3, Vector2, Vector3 } from '@feng3d/math';\r\nimport { CullFace } from '@feng3d/renderer';\r\n\r\nexport class GeometryUtils\r\n{\r\n    /**\r\n     * 根据顶点数量按顺序创建顶点索引\r\n     * @param positions 顶点数据\r\n     */\r\n    createIndices(positions: number[])\r\n    {\r\n        const vertexNum = positions.length / 3;\r\n        const indices: number[] = [];\r\n        for (let i = 0; i < vertexNum; i++)\r\n        {\r\n            indices[i] = i;\r\n        }\r\n\r\n        return indices;\r\n    }\r\n\r\n    /**\r\n     * 创建循环uv数据\r\n     * @param positions 顶点数据\r\n     */\r\n    createUVs(positions: number[])\r\n    {\r\n        let idx = 0; let\r\n            uvIdx = 0;\r\n        const target: number[] = [];\r\n        const len = positions.length / 3 * 2;\r\n        while (idx < len)\r\n        {\r\n            target[idx++] = uvIdx * 0.5;\r\n            target[idx++] = 1.0 - (uvIdx & 1);\r\n            if (++uvIdx === 3)\r\n            { uvIdx = 0; }\r\n        }\r\n\r\n        return target;\r\n    }\r\n\r\n    /**\r\n     * 计算顶点法线数据\r\n     * @param indices 顶点索引\r\n     * @param positions 顶点数据\r\n     * @param useFaceWeights 是否使用面权重计算法线\r\n     */\r\n    createVertexNormals(indices: number[], positions: number[], useFaceWeights = false)\r\n    {\r\n        const faceNormalsResult = this.createFaceNormals(indices, positions, useFaceWeights);\r\n        const faceWeights = faceNormalsResult.faceWeights;\r\n        const faceNormals = faceNormalsResult.faceNormals;\r\n\r\n        let v1 = 0;\r\n        let f1 = 0; let f2 = 1; let\r\n            f3 = 2;\r\n        const lenV = positions.length;\r\n        const normalStride = 3;\r\n        const normalOffset = 0;\r\n        const normals = new Array<number>(lenV);\r\n        v1 = 0;\r\n        while (v1 < lenV)\r\n        {\r\n            normals[v1] = 0.0;\r\n            normals[v1 + 1] = 0.0;\r\n            normals[v1 + 2] = 0.0;\r\n            v1 += normalStride;\r\n        }\r\n        let i = 0; let\r\n            k = 0;\r\n        const lenI = indices.length;\r\n        let index = 0;\r\n        let weight = 0;\r\n        while (i < lenI)\r\n        {\r\n            weight = useFaceWeights ? faceWeights[k++] : 1;\r\n            index = normalOffset + indices[i++] * normalStride;\r\n            normals[index++] += faceNormals[f1] * weight;\r\n            normals[index++] += faceNormals[f2] * weight;\r\n            normals[index] += faceNormals[f3] * weight;\r\n            index = normalOffset + indices[i++] * normalStride;\r\n            normals[index++] += faceNormals[f1] * weight;\r\n            normals[index++] += faceNormals[f2] * weight;\r\n            normals[index] += faceNormals[f3] * weight;\r\n            index = normalOffset + indices[i++] * normalStride;\r\n            normals[index++] += faceNormals[f1] * weight;\r\n            normals[index++] += faceNormals[f2] * weight;\r\n            normals[index] += faceNormals[f3] * weight;\r\n            f1 += 3;\r\n            f2 += 3;\r\n            f3 += 3;\r\n        }\r\n        v1 = normalOffset;\r\n        while (v1 < lenV)\r\n        {\r\n            const vx = normals[v1];\r\n            const vy = normals[v1 + 1];\r\n            const vz = normals[v1 + 2];\r\n            const d = 1.0 / Math.sqrt(vx * vx + vy * vy + vz * vz);\r\n            normals[v1] = vx * d;\r\n            normals[v1 + 1] = vy * d;\r\n            normals[v1 + 2] = vz * d;\r\n            v1 += normalStride;\r\n        }\r\n\r\n        return normals;\r\n    }\r\n\r\n    /**\r\n     * 计算顶点切线数据\r\n     * @param indices 顶点索引\r\n     * @param positions 顶点数据\r\n     * @param uvs uv数据\r\n     * @param useFaceWeights 是否使用面权重计算切线数据\r\n     */\r\n    createVertexTangents(indices: number[], positions: number[], uvs: number[], useFaceWeights = false)\r\n    {\r\n        const faceTangentsResult = this.createFaceTangents(indices, positions, uvs, useFaceWeights);\r\n        const faceWeights = faceTangentsResult.faceWeights;\r\n        const faceTangents = faceTangentsResult.faceTangents;\r\n\r\n        let i = 0;\r\n        const lenV = positions.length;\r\n        const tangentStride = 3;\r\n        const tangentOffset = 0;\r\n        const target = new Array<number>(lenV);\r\n        i = tangentOffset;\r\n        while (i < lenV)\r\n        {\r\n            target[i] = 0.0;\r\n            target[i + 1] = 0.0;\r\n            target[i + 2] = 0.0;\r\n            i += tangentStride;\r\n        }\r\n        let k = 0;\r\n        const lenI = indices.length;\r\n        let index = 0;\r\n        let weight = 0;\r\n        let f1 = 0; let f2 = 1; let\r\n            f3 = 2;\r\n        i = 0;\r\n        while (i < lenI)\r\n        {\r\n            weight = useFaceWeights ? faceWeights[k++] : 1;\r\n            index = tangentOffset + indices[i++] * tangentStride;\r\n            target[index++] += faceTangents[f1] * weight;\r\n            target[index++] += faceTangents[f2] * weight;\r\n            target[index] += faceTangents[f3] * weight;\r\n            index = tangentOffset + indices[i++] * tangentStride;\r\n            target[index++] += faceTangents[f1] * weight;\r\n            target[index++] += faceTangents[f2] * weight;\r\n            target[index] += faceTangents[f3] * weight;\r\n            index = tangentOffset + indices[i++] * tangentStride;\r\n            target[index++] += faceTangents[f1] * weight;\r\n            target[index++] += faceTangents[f2] * weight;\r\n            target[index] += faceTangents[f3] * weight;\r\n            f1 += 3;\r\n            f2 += 3;\r\n            f3 += 3;\r\n        }\r\n        i = tangentOffset;\r\n        while (i < lenV)\r\n        {\r\n            const vx = target[i];\r\n            const vy = target[i + 1];\r\n            const vz = target[i + 2];\r\n            const d = 1.0 / Math.sqrt(vx * vx + vy * vy + vz * vz);\r\n            target[i] = vx * d;\r\n            target[i + 1] = vy * d;\r\n            target[i + 2] = vz * d;\r\n            i += tangentStride;\r\n        }\r\n\r\n        return target;\r\n    }\r\n\r\n    /**\r\n     * 计算面切线数据\r\n     * @param indices 顶点索引数据\r\n     * @param positions 顶点数据\r\n     * @param uvs uv数据\r\n     * @param useFaceWeights 是否计算面权重\r\n     */\r\n    createFaceTangents(indices: number[], positions: number[], uvs: number[], useFaceWeights = false)\r\n    {\r\n        let i = 0; let\r\n            k = 0;\r\n        let index1 = 0; let index2 = 0; let\r\n            index3 = 0;\r\n        const len = indices.length;\r\n        let ui = 0; let\r\n            vi = 0;\r\n        let v0 = 0;\r\n        let dv1 = 0; let\r\n            dv2 = 0;\r\n        let denom = 0;\r\n        let x0 = 0; let y0 = 0; let\r\n            z0 = 0;\r\n        let dx1 = 0; let dy1 = 0; let\r\n            dz1 = 0;\r\n        let dx2 = 0; let dy2 = 0; let\r\n            dz2 = 0;\r\n        let cx = 0; let cy = 0; let\r\n            cz = 0;\r\n        const posStride = 3;\r\n        const posOffset = 0;\r\n        const texStride = 2;\r\n        const texOffset = 0;\r\n        const faceTangents = new Array<number>(indices.length);\r\n        const faceWeights: number[] = [];\r\n        while (i < len)\r\n        {\r\n            index1 = indices[i];\r\n            index2 = indices[i + 1];\r\n            index3 = indices[i + 2];\r\n            ui = texOffset + index1 * texStride + 1;\r\n            v0 = uvs[ui];\r\n            ui = texOffset + index2 * texStride + 1;\r\n            dv1 = uvs[ui] - v0;\r\n            ui = texOffset + index3 * texStride + 1;\r\n            dv2 = uvs[ui] - v0;\r\n            vi = posOffset + index1 * posStride;\r\n            x0 = positions[vi];\r\n            y0 = positions[vi + 1];\r\n            z0 = positions[vi + 2];\r\n            vi = posOffset + index2 * posStride;\r\n            dx1 = positions[vi] - x0;\r\n            dy1 = positions[vi + 1] - y0;\r\n            dz1 = positions[vi + 2] - z0;\r\n            vi = posOffset + index3 * posStride;\r\n            dx2 = positions[vi] - x0;\r\n            dy2 = positions[vi + 1] - y0;\r\n            dz2 = positions[vi + 2] - z0;\r\n            cx = dv2 * dx1 - dv1 * dx2;\r\n            cy = dv2 * dy1 - dv1 * dy2;\r\n            cz = dv2 * dz1 - dv1 * dz2;\r\n            denom = Math.sqrt(cx * cx + cy * cy + cz * cz);\r\n            if (useFaceWeights)\r\n            {\r\n                let w = denom * 10000;\r\n                if (w < 1)\r\n                { w = 1; }\r\n                faceWeights[k++] = w;\r\n            }\r\n            denom = 1 / denom;\r\n            faceTangents[i++] = denom * cx;\r\n            faceTangents[i++] = denom * cy;\r\n            faceTangents[i++] = denom * cz;\r\n        }\r\n\r\n        return { faceTangents, faceWeights };\r\n    }\r\n\r\n    /**\r\n     * 计算面法线数据\r\n     * @param indices 顶点索引数据\r\n     * @param positions 顶点数据\r\n     * @param useFaceWeights 是否计算面权重\r\n     */\r\n    createFaceNormals(indices: number[], positions: number[], useFaceWeights = false)\r\n    {\r\n        let i = 0; let j = 0; let\r\n            k = 0;\r\n        let index = 0;\r\n        const len = indices.length;\r\n        let x1 = 0; let x2 = 0; let\r\n            x3 = 0;\r\n        let y1 = 0; let y2 = 0; let\r\n            y3 = 0;\r\n        let z1 = 0; let z2 = 0; let\r\n            z3 = 0;\r\n        let dx1 = 0; let dy1 = 0; let\r\n            dz1 = 0;\r\n        let dx2 = 0; let dy2 = 0; let\r\n            dz2 = 0;\r\n        let cx = 0; let cy = 0; let\r\n            cz = 0;\r\n        let d = 0;\r\n        const posStride = 3;\r\n        const faceNormals = new Array<number>(len);\r\n        const faceWeights: number[] = [];\r\n        while (i < len)\r\n        {\r\n            index = indices[i++] * posStride;\r\n            x1 = positions[index];\r\n            y1 = positions[index + 1];\r\n            z1 = positions[index + 2];\r\n            index = indices[i++] * posStride;\r\n            x2 = positions[index];\r\n            y2 = positions[index + 1];\r\n            z2 = positions[index + 2];\r\n            index = indices[i++] * posStride;\r\n            x3 = positions[index];\r\n            y3 = positions[index + 1];\r\n            z3 = positions[index + 2];\r\n            dx1 = x3 - x1;\r\n            dy1 = y3 - y1;\r\n            dz1 = z3 - z1;\r\n            dx2 = x2 - x1;\r\n            dy2 = y2 - y1;\r\n            dz2 = z2 - z1;\r\n            cx = dz1 * dy2 - dy1 * dz2;\r\n            cy = dx1 * dz2 - dz1 * dx2;\r\n            cz = dy1 * dx2 - dx1 * dy2;\r\n            d = Math.sqrt(cx * cx + cy * cy + cz * cz);\r\n            if (useFaceWeights)\r\n            {\r\n                let w = d * 10000;\r\n                if (w < 1)\r\n                { w = 1; }\r\n                faceWeights[k++] = w;\r\n            }\r\n            d = 1 / d;\r\n            faceNormals[j++] = cx * d;\r\n            faceNormals[j++] = cy * d;\r\n            faceNormals[j++] = cz * d;\r\n        }\r\n\r\n        return { faceNormals, faceWeights };\r\n    }\r\n\r\n    /**\r\n     * 应用变换矩阵\r\n     * @param transform 变换矩阵\r\n     * @param positions 顶点数据\r\n     * @param normals 顶点法线数据\r\n     * @param tangents 顶点切线数据\r\n     */\r\n    applyTransformation(transform: Matrix4x4, positions: number[], normals?: number[], tangents?: number[])\r\n    {\r\n        const posStride = 3;\r\n        const normalStride = 3;\r\n        const tangentStride = 3;\r\n\r\n        const len = positions.length / posStride;\r\n        let i: number; let i1: number; let\r\n            i2: number;\r\n        let vector = new Vector3();\r\n\r\n        const bakeNormals = !!normals;\r\n        const bakeTangents = !!tangents;\r\n        const invTranspose = new Matrix4x4();\r\n\r\n        if (bakeNormals || bakeTangents)\r\n        {\r\n            invTranspose.copy(transform);\r\n            invTranspose.invert();\r\n            invTranspose.transpose();\r\n        }\r\n\r\n        let vi0 = 0;\r\n        let ni0 = 0;\r\n        let ti0 = 0;\r\n\r\n        for (i = 0; i < len; ++i)\r\n        {\r\n            i1 = vi0 + 1;\r\n            i2 = vi0 + 2;\r\n\r\n            // bake position\r\n            vector.x = positions[vi0];\r\n            vector.y = positions[i1];\r\n            vector.z = positions[i2];\r\n            vector = transform.transformPoint3(vector);\r\n            positions[vi0] = vector.x;\r\n            positions[i1] = vector.y;\r\n            positions[i2] = vector.z;\r\n            vi0 += posStride;\r\n\r\n            // bake normal\r\n            if (bakeNormals)\r\n            {\r\n                i1 = ni0 + 1;\r\n                i2 = ni0 + 2;\r\n                vector.x = normals[ni0];\r\n                vector.y = normals[i1];\r\n                vector.z = normals[i2];\r\n                vector = invTranspose.transformVector3(vector);\r\n                vector.normalize();\r\n                normals[ni0] = vector.x;\r\n                normals[i1] = vector.y;\r\n                normals[i2] = vector.z;\r\n                ni0 += normalStride;\r\n            }\r\n\r\n            // bake tangent\r\n            if (bakeTangents)\r\n            {\r\n                i1 = ti0 + 1;\r\n                i2 = ti0 + 2;\r\n                vector.x = tangents[ti0];\r\n                vector.y = tangents[i1];\r\n                vector.z = tangents[i2];\r\n                vector = invTranspose.transformVector3(vector);\r\n                vector.normalize();\r\n                tangents[ti0] = vector.x;\r\n                tangents[i1] = vector.y;\r\n                tangents[i2] = vector.z;\r\n                ti0 += tangentStride;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 合并几何体\r\n     * @param geometrys 几何体列表\r\n     */\r\n    mergeGeometry(geometrys: { indices: number[], positions: number[], uvs?: number[], normals?: number[], tangents?: number[] }[])\r\n    {\r\n        // 此处存在隐患。\r\n        // 优化方案，遍历所有几何体，找到所有共有属性后进行合并。\r\n        const result: { indices: number[], positions: number[], uvs?: number[], normals?: number[], tangents?: number[] } = <any>{};\r\n        for (let i = 0; i < geometrys.length; i++)\r\n        {\r\n            const geometry = geometrys[i];\r\n            if (i === 0)\r\n            {\r\n                result.indices = geometry.indices.concat();\r\n                result.positions = geometry.positions.concat();\r\n                geometry.uvs && (result.uvs = geometry.uvs.concat());\r\n                geometry.normals && (result.normals = geometry.normals.concat());\r\n                geometry.tangents && (result.tangents = geometry.tangents.concat());\r\n            }\r\n            else\r\n            {\r\n                const startIndex = result.positions.length / 3;\r\n                geometry.indices.forEach((v) => result.indices.push(v + startIndex));\r\n                geometry.positions.forEach((v) => result.positions.push(v));\r\n                result.uvs && geometry.uvs.forEach((v) => result.uvs.push(v));\r\n                result.normals && geometry.normals.forEach((v) => result.normals.push(v));\r\n                result.tangents && geometry.tangents.forEach((v) => result.tangents.push(v));\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * 射线投影几何体\r\n     * @param ray                           射线\r\n     * @param shortestCollisionDistance     当前最短碰撞距离\r\n     * @param cullFace                      裁剪面枚举\r\n     *\r\n     * @todo\r\n     * @see 3D数学基础：图形与游戏开发 P278 是否可用该内容优化运算效率？\r\n     *\r\n     * @see 优化参考 three.js Ray.intersectTriangle\r\n     */\r\n    raycast(ray: Ray3, indices: number[], positions: number[], uvs: number[], shortestCollisionDistance = Number.MAX_VALUE, cullFace = CullFace.NONE)\r\n    {\r\n        if (cullFace === CullFace.FRONT_AND_BACK) return null;\r\n\r\n        let t = 0;\r\n        let i0 = 0; let i1 = 0; let\r\n            i2 = 0;\r\n        let rx = 0; let ry = 0; let\r\n            rz = 0;\r\n        let nx = 0; let ny = 0; let\r\n            nz = 0;\r\n        let cx = 0; let cy = 0; let\r\n            cz = 0;\r\n        let coeff = 0; let u = 0; let v = 0; let\r\n            w = 0;\r\n        let p0x = 0; let p0y = 0; let\r\n            p0z = 0;\r\n        let p1x = 0; let p1y = 0; let\r\n            p1z = 0;\r\n        let p2x = 0; let p2y = 0; let\r\n            p2z = 0;\r\n        let s0x = 0; let s0y = 0; let\r\n            s0z = 0;\r\n        let s1x = 0; let s1y = 0; let\r\n            s1z = 0;\r\n        let nl = 0; let nDotV = 0; let D = 0; let\r\n            disToPlane = 0;\r\n        let Q1Q2 = 0; let Q1Q1 = 0; let Q2Q2 = 0; let RQ1 = 0; let\r\n            RQ2 = 0;\r\n\r\n        let collisionTriangleIndex = -1;\r\n\r\n        const numIndices = indices.length;\r\n\r\n        const result: { rayEntryDistance: number, localPosition: Vector3, localNormal: Vector3, uv: Vector2, index: number } = <any>{};\r\n\r\n        // 遍历每个三角形 检测碰撞\r\n        for (let index = 0; index < numIndices; index += 3)\r\n        { // sweep all triangles\r\n            // 三角形三个顶点索引\r\n            i0 = indices[index] * 3;\r\n            i1 = indices[index + 1] * 3;\r\n            i2 = indices[index + 2] * 3;\r\n\r\n            // 三角形三个顶点数据\r\n            p0x = positions[i0];\r\n            p0y = positions[i0 + 1];\r\n            p0z = positions[i0 + 2];\r\n            p1x = positions[i1];\r\n            p1y = positions[i1 + 1];\r\n            p1z = positions[i1 + 2];\r\n            p2x = positions[i2];\r\n            p2y = positions[i2 + 1];\r\n            p2z = positions[i2 + 2];\r\n\r\n            // 计算出三角面的法线\r\n            s0x = p1x - p0x; // s0 = p1 - p0\r\n            s0y = p1y - p0y;\r\n            s0z = p1z - p0z;\r\n            s1x = p2x - p0x; // s1 = p2 - p0\r\n            s1y = p2y - p0y;\r\n            s1z = p2z - p0z;\r\n            nx = s0y * s1z - s0z * s1y; // n = s0 x s1\r\n            ny = s0z * s1x - s0x * s1z;\r\n            nz = s0x * s1y - s0y * s1x;\r\n            nl = 1 / Math.sqrt(nx * nx + ny * ny + nz * nz); // normalize n 此处使用了开平方根，性能很差\r\n            nx *= nl;\r\n            ny *= nl;\r\n            nz *= nl;\r\n\r\n            // 初始化射线数据\r\n            const rayPosition: Vector3 = ray.origin;\r\n            const rayDirection: Vector3 = ray.direction;\r\n\r\n            // 计算射线与法线的点积，不等于零表示射线所在直线与三角面相交\r\n            nDotV = nx * rayDirection.x + ny * rayDirection.y + nz * rayDirection.z; // rayDirection . normal\r\n            // 判断射线是否与三角面相交\r\n            if ((cullFace === CullFace.FRONT && nDotV > 0.0) || (cullFace === CullFace.BACK && nDotV < 0.0) || (cullFace === CullFace.NONE && nDotV !== 0.0))\r\n            { // an intersection must exist\r\n                // 计算平面方程D值，参考Plane3D\r\n                D = -(nx * p0x + ny * p0y + nz * p0z);\r\n                // 射线点到平面的距离\r\n                disToPlane = -(nx * rayPosition.x + ny * rayPosition.y + nz * rayPosition.z + D);\r\n                t = disToPlane / nDotV;\r\n                // 得到交点\r\n                cx = rayPosition.x + t * rayDirection.x;\r\n                cy = rayPosition.y + t * rayDirection.y;\r\n                cz = rayPosition.z + t * rayDirection.z;\r\n                // 判断交点是否在三角形内( using barycentric coordinates )\r\n                Q1Q2 = s0x * s1x + s0y * s1y + s0z * s1z;\r\n                Q1Q1 = s0x * s0x + s0y * s0y + s0z * s0z;\r\n                Q2Q2 = s1x * s1x + s1y * s1y + s1z * s1z;\r\n                rx = cx - p0x;\r\n                ry = cy - p0y;\r\n                rz = cz - p0z;\r\n                RQ1 = rx * s0x + ry * s0y + rz * s0z;\r\n                RQ2 = rx * s1x + ry * s1y + rz * s1z;\r\n                coeff = 1 / (Q1Q1 * Q2Q2 - Q1Q2 * Q1Q2);\r\n                v = coeff * (Q2Q2 * RQ1 - Q1Q2 * RQ2);\r\n                if (v < 0)\r\n                { continue; }\r\n                w = coeff * (-Q1Q2 * RQ1 + Q1Q1 * RQ2);\r\n                if (w < 0)\r\n                { continue; }\r\n                u = 1 - v - w;\r\n                // u v w都大于0表示点在三角形内 射线的坐标t大于0表示射线朝向三角面\r\n                if (u >= 0 && t >= 0 && t < shortestCollisionDistance)\r\n                {\r\n                    shortestCollisionDistance = t;\r\n                    collisionTriangleIndex = index / 3;\r\n                    result.rayEntryDistance = t;\r\n                    result.localPosition = new Vector3(cx, cy, cz);\r\n                    result.localNormal = new Vector3(nx, ny, nz);\r\n                    if (uvs)\r\n                    {\r\n                        result.uv = getCollisionUV(indices, uvs, index, v, w, u);\r\n                    }\r\n                    result.index = index;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (collisionTriangleIndex >= 0)\r\n        { return result; }\r\n\r\n        return null;\r\n\r\n        /**\r\n         * 获取碰撞uv\r\n         * @param indices 顶点数据\r\n         * @param uvs uv数据\r\n         * @param triangleIndex 三角形所有\r\n         * @param v\r\n         * @param w\r\n         * @param u\r\n         * @param uvOffset\r\n         * @param uvStride\r\n         * @return 碰撞uv\r\n         */\r\n        function getCollisionUV(indices: number[], uvs: number[], triangleIndex: number, v: number, w: number, u: number)\r\n        {\r\n            let uIndex = indices[triangleIndex] * 2;\r\n            const uv0x = uvs[uIndex];\r\n            const uv0y = uvs[uIndex + 1];\r\n            uIndex = indices[triangleIndex + 1] * 2;\r\n            const uv1x = uvs[uIndex];\r\n            const uv1y = uvs[uIndex + 1];\r\n            uIndex = indices[triangleIndex + 2] * 2;\r\n            const uv2x = uvs[uIndex];\r\n            const uv2y = uvs[uIndex + 1];\r\n            const uv = new Vector2();\r\n            uv.x = u * uv0x + v * uv1x + w * uv2x;\r\n            uv.y = u * uv0y + v * uv1y + w * uv2y;\r\n\r\n            return uv;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取包围盒\r\n     * @param positions 顶点数据\r\n     */\r\n    getAABB(positions: number[])\r\n    {\r\n        return Box3.formPositions(positions);\r\n    }\r\n}\r\n\r\nexport const geometryUtils = new GeometryUtils();\r\n","/**\r\n * 阴影类型\r\n */\r\nexport enum ShadowType\r\n{\r\n    /**\r\n     * 没有阴影\r\n     */\r\n    No_Shadows = 0,\r\n    /**\r\n     * 硬阴影\r\n     */\r\n    Hard_Shadows = 1,\r\n    /**\r\n     * PCF 阴影\r\n     */\r\n    PCF_Shadows = 2,\r\n    /**\r\n     * PCF 软阴影\r\n     */\r\n    PCF_Soft_Shadows = 3,\r\n}\r\n","import { Box3, Matrix4x4, Ray3, Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { Constructor, gPartial } from '@feng3d/polyfill';\r\nimport { Attribute, Attributes, CullFace, Index, RenderAtomic } from '@feng3d/renderer';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { AssetType } from '../assets/AssetType';\r\nimport { AssetData } from '../core/AssetData';\r\nimport { Feng3dObject } from '../core/Feng3dObject';\r\nimport { HideFlags } from '../core/HideFlags';\r\nimport { geometryUtils } from './GeometryUtils';\r\n\r\ndeclare global\r\n{\r\n    interface MixinsDefaultGeometry { }\r\n    interface MixinsGeometryTypes { }\r\n}\r\n\r\nexport interface GeometryTypes extends MixinsGeometryTypes { }\r\n\r\nexport type GeometryLike = GeometryTypes[keyof GeometryTypes];\r\n\r\nexport interface GeometryEventMap\r\n{\r\n    /**\r\n     * 包围盒失效\r\n     */\r\n    boundsInvalid: Geometry;\r\n}\r\n\r\n/**\r\n * 几何体\r\n */\r\nexport class Geometry<T extends GeometryEventMap = GeometryEventMap> extends Feng3dObject<T>\r\n{\r\n    @oav({ component: 'OAVFeng3dPreView' })\r\n    private preview = '';\r\n\r\n    @oav()\r\n    declare name: string;\r\n\r\n    /**\r\n     * 资源编号\r\n     */\r\n    assetId: string;\r\n\r\n    assetType = AssetType.geometry;\r\n\r\n    /**\r\n     * 几何体信息\r\n     */\r\n    @oav({ component: 'OAVMultiText', priority: -10 })\r\n    get geometryInfo()\r\n    {\r\n        const str = [\r\n            `Geometry Info`,\r\n            `  Vertices    ${this.numVertex}`,\r\n            `  Triangles    ${this.numTriangles}`,\r\n            `  Attributes    ${Object.keys(this._attributes).join(',')}`,\r\n        ].join('\\n');\r\n\r\n        return str;\r\n    }\r\n\r\n    /**\r\n     * 索引数据\r\n     */\r\n    get indices()\r\n    {\r\n        this.updateGrometry();\r\n\r\n        return this._indexBuffer.indices;\r\n    }\r\n\r\n    /**\r\n     * 更新顶点索引数据\r\n     */\r\n    set indices(value: number[])\r\n    {\r\n        this._indexBuffer.indices = value;\r\n    }\r\n\r\n    /**\r\n     * 坐标数据\r\n     */\r\n    get positions()\r\n    {\r\n        return this._attributes.a_position.data;\r\n    }\r\n\r\n    set positions(value)\r\n    {\r\n        this._attributes.a_position.data = value;\r\n    }\r\n\r\n    /**\r\n     * 颜色数据\r\n     */\r\n    get colors()\r\n    {\r\n        return this._attributes.a_color.data;\r\n    }\r\n\r\n    set colors(value)\r\n    {\r\n        this._attributes.a_color.data = value;\r\n    }\r\n\r\n    /**\r\n     * uv数据\r\n     */\r\n    get uvs()\r\n    {\r\n        return this._attributes.a_uv.data;\r\n    }\r\n\r\n    set uvs(value)\r\n    {\r\n        this._attributes.a_uv.data = value;\r\n    }\r\n\r\n    /**\r\n     * 法线数据\r\n     */\r\n    get normals()\r\n    {\r\n        return this._attributes.a_normal.data;\r\n    }\r\n\r\n    set normals(value)\r\n    {\r\n        this._attributes.a_normal.data = value;\r\n    }\r\n\r\n    /**\r\n     * 切线数据\r\n     */\r\n    get tangents()\r\n    {\r\n        return this._attributes.a_tangent.data;\r\n    }\r\n\r\n    set tangents(value)\r\n    {\r\n        this._attributes.a_tangent.data = value;\r\n    }\r\n\r\n    /**\r\n     * 蒙皮索引，顶点关联的关节索引\r\n     */\r\n    get skinIndices()\r\n    {\r\n        return this._attributes.a_skinIndices.data;\r\n    }\r\n\r\n    set skinIndices(value)\r\n    {\r\n        this._attributes.a_skinIndices.data = value;\r\n    }\r\n\r\n    /**\r\n     * 蒙皮权重，顶点关联的关节权重\r\n     */\r\n    get skinWeights()\r\n    {\r\n        return this._attributes.a_skinWeights.data;\r\n    }\r\n\r\n    set skinWeights(value)\r\n    {\r\n        this._attributes.a_skinWeights.data = value;\r\n    }\r\n\r\n    /**\r\n     * 蒙皮索引，顶点关联的关节索引\r\n     */\r\n    get skinIndices1()\r\n    {\r\n        return this._attributes.a_skinIndices1.data;\r\n    }\r\n\r\n    set skinIndices1(value)\r\n    {\r\n        this._attributes.a_skinIndices1.data = value;\r\n    }\r\n\r\n    /**\r\n     * 蒙皮权重，顶点关联的关节权重\r\n     */\r\n    get skinWeights1()\r\n    {\r\n        return this._attributes.a_skinWeights1.data;\r\n    }\r\n\r\n    set skinWeights1(value)\r\n    {\r\n        this._attributes.a_skinWeights1.data = value;\r\n    }\r\n\r\n    /**\r\n     * 创建一个几何体\r\n     */\r\n    constructor()\r\n    {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * 标记需要更新几何体，在更改几何体数据后需要调用该函数。\r\n     */\r\n    @oav({ tooltip: '标记需要更新几何体，在更改几何体数据后需要调用该函数。' })\r\n    invalidateGeometry()\r\n    {\r\n        this._geometryInvalid = true;\r\n        this.invalidateBounds();\r\n    }\r\n\r\n    /**\r\n     * 更新几何体\r\n     */\r\n    updateGrometry()\r\n    {\r\n        if (this._geometryInvalid)\r\n        {\r\n            this._geometryInvalid = false;\r\n            this.buildGeometry();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 构建几何体\r\n     */\r\n    protected buildGeometry()\r\n    {\r\n    }\r\n\r\n    /**\r\n     * 顶点数量\r\n     */\r\n    get numVertex()\r\n    {\r\n        return this.positions.length / 3;\r\n    }\r\n\r\n    /**\r\n     * 三角形数量\r\n     */\r\n    get numTriangles()\r\n    {\r\n        return this.indices.length / 3;\r\n    }\r\n\r\n    /**\r\n     * 添加几何体\r\n     * @param geometry          被添加的几何体\r\n     * @param transform         变换矩阵，把克隆被添加几何体的数据变换后再添加到该几何体中\r\n     */\r\n    addGeometry(geometry: Geometry, transform?: Matrix4x4)\r\n    {\r\n        // 更新几何体\r\n        this.updateGrometry();\r\n        geometry.updateGrometry();\r\n        // 变换被添加的几何体\r\n        if (transform)\r\n        {\r\n            geometry = geometry.clone();\r\n            geometry.applyTransformation(transform);\r\n        }\r\n\r\n        // 如果自身为空几何体\r\n        if (!this.indices)\r\n        {\r\n            this.cloneFrom(geometry);\r\n\r\n            return;\r\n        }\r\n\r\n        //\r\n        const attributes = this._attributes;\r\n        const addAttributes = geometry._attributes;\r\n        // 当前顶点数量\r\n        const oldNumVertex = this.numVertex;\r\n        // 合并索引\r\n        const indices = this.indices;\r\n        const targetIndices = geometry.indices;\r\n        const totalIndices = indices.concat();\r\n        for (let i = 0; i < targetIndices.length; i++)\r\n        {\r\n            totalIndices[indices.length + i] = targetIndices[i] + oldNumVertex;\r\n        }\r\n        this.indices = totalIndices;\r\n        // 合并后顶点数量\r\n        // const totalVertex = oldNumVertex + geometry.numVertex;\r\n        // 合并属性数据\r\n        for (const attributeName in attributes)\r\n        {\r\n            const attribute: Attribute = attributes[attributeName];\r\n            const addAttribute: Attribute = addAttributes[attributeName];\r\n            //\r\n            attribute.data = attribute.data.concat(addAttribute.data);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 应用变换矩阵\r\n     * @param transform 变换矩阵\r\n     */\r\n    applyTransformation(transform: Matrix4x4)\r\n    {\r\n        this.updateGrometry();\r\n\r\n        const vertices = this.positions;\r\n        const normals = this.normals;\r\n        const tangents = this.tangents;\r\n\r\n        geometryUtils.applyTransformation(transform, vertices, normals, tangents);\r\n\r\n        this.positions = vertices;\r\n        this.normals = normals;\r\n        this.tangents = tangents;\r\n    }\r\n\r\n    /**\r\n     * 纹理U缩放，默认为1。\r\n     */\r\n    @serialize\r\n    @oav()\r\n    scaleU = 1;\r\n\r\n    /**\r\n     * 纹理V缩放，默认为1。\r\n     */\r\n    @serialize\r\n    @oav()\r\n    scaleV = 1;\r\n\r\n    /**\r\n     * 包围盒失效\r\n     */\r\n    invalidateBounds()\r\n    {\r\n        this._bounding = <any>null;\r\n        this.emit('boundsInvalid', this);\r\n    }\r\n\r\n    get bounding()\r\n    {\r\n        this.updateGrometry();\r\n        if (!this._bounding)\r\n        {\r\n            const positions = this.positions;\r\n            if (!positions || positions.length === 0)\r\n            { return new Box3(); }\r\n            this._bounding = Box3.formPositions(this.positions);\r\n        }\r\n\r\n        return this._bounding;\r\n    }\r\n\r\n    /**\r\n     * 射线投影几何体\r\n     * @param ray                           射线\r\n     * @param shortestCollisionDistance     当前最短碰撞距离\r\n     * @param cullFace                      裁剪面枚举\r\n     */\r\n    raycast(ray: Ray3, shortestCollisionDistance = Number.MAX_VALUE, cullFace = CullFace.NONE)\r\n    {\r\n        const result = geometryUtils.raycast(ray, this.indices, this.positions, this.uvs, shortestCollisionDistance, cullFace);\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * 获取顶点列表\r\n     *\r\n     * @param result\r\n     */\r\n    getVertices(result: Vector3[] = [])\r\n    {\r\n        const positions = this.positions;\r\n        for (let i = 0, n = positions.length; i < n; i += 3)\r\n        {\r\n            result.push(new Vector3(positions[i], positions[i + 1], positions[i + 2]));\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    getFaces(result: number[][] = [])\r\n    {\r\n        const indices = this.indices;\r\n        for (let i = 0, n = indices.length; i < n; i += 3)\r\n        {\r\n            result.push([indices[i], indices[i + 1], indices[i + 2]]);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * 克隆一个几何体\r\n     */\r\n    clone()\r\n    {\r\n        const Cls = this.constructor as Constructor<Geometry>;\r\n        const geometry = new Cls();\r\n        geometry.cloneFrom(this);\r\n\r\n        return geometry;\r\n    }\r\n\r\n    /**\r\n     * 从一个几何体中克隆数据\r\n     */\r\n    cloneFrom(geometry: Geometry)\r\n    {\r\n        geometry.updateGrometry();\r\n        this.indices = geometry.indices.concat();\r\n        for (const attributeName in geometry._attributes)\r\n        {\r\n            const attribute: Attribute = this._attributes[attributeName];\r\n            const addAttribute: Attribute = geometry._attributes[attributeName];\r\n\r\n            attribute.data = addAttribute.data.concat();\r\n        }\r\n    }\r\n\r\n    beforeRender(renderAtomic: RenderAtomic)\r\n    {\r\n        this.updateGrometry();\r\n\r\n        renderAtomic.index = this._indexBuffer;\r\n\r\n        for (const key in this._attributes)\r\n        {\r\n            if (this._attributes.hasOwnProperty(key))\r\n            {\r\n                renderAtomic.attributes[key] = this._attributes[key];\r\n            }\r\n        }\r\n\r\n        renderAtomic.shaderMacro.SCALEU = this.scaleU;\r\n        renderAtomic.shaderMacro.SCALEV = this.scaleV;\r\n    }\r\n\r\n    /**\r\n     * 顶点索引缓冲\r\n     */\r\n    private _indexBuffer = new Index();\r\n\r\n    /**\r\n     * 属性数据列表\r\n     */\r\n    protected _attributes: Attributes = {\r\n        a_position: new Attribute({ name: 'a_position', data: [], size: 3 }),\r\n        a_color: new Attribute({ name: 'a_color', data: [], size: 4 }),\r\n        a_uv: new Attribute({ name: 'a_uv', data: [], size: 2 }),\r\n        a_normal: new Attribute({ name: 'a_normal', data: [], size: 3 }),\r\n        a_tangent: new Attribute({ name: 'a_tangent', data: [], size: 3 }),\r\n        a_skinIndices: new Attribute({ name: 'a_skinIndices', data: [], size: 4 }),\r\n        a_skinWeights: new Attribute({ name: 'a_skinWeights', data: [], size: 4 }),\r\n        a_skinIndices1: new Attribute({ name: 'a_skinIndices1', data: [], size: 4 }),\r\n        a_skinWeights1: new Attribute({ name: 'a_skinWeights1', data: [], size: 4 }),\r\n    };\r\n\r\n    /**\r\n     * 清理数据\r\n     */\r\n    clear()\r\n    {\r\n        for (const key in this._attributes)\r\n        {\r\n            const element: Attribute = this._attributes[key];\r\n            element.data = [];\r\n        }\r\n    }\r\n\r\n    private _geometryInvalid = true;\r\n    private _useFaceWeights = false;\r\n\r\n    private _bounding: Box3;\r\n\r\n    /**\r\n     * 设置默认几何体\r\n     *\r\n     * @param name 默认几何体名称\r\n     * @param geometry 默认几何体\r\n     */\r\n    static setDefault<K extends keyof DefaultGeometry>(name: K, geometry: DefaultGeometry[K], param?: gPartial<DefaultGeometry[K]>)\r\n    {\r\n        this._defaultGeometry[name] = geometry;\r\n        if (param) serialization.setValue(geometry, param);\r\n        serialization.setValue(geometry, { name, assetId: name, hideFlags: HideFlags.NotEditable });\r\n        AssetData.addAssetData(name, geometry);\r\n    }\r\n\r\n    /**\r\n     * 获取默认几何体\r\n     *\r\n     * @param name 默认几何体名称\r\n     */\r\n    static getDefault<K extends keyof DefaultGeometry>(name: K)\r\n    {\r\n        return this._defaultGeometry[name];\r\n    }\r\n    private static _defaultGeometry: DefaultGeometry = <any>{};\r\n}\r\n\r\n/**\r\n * 默认几何体\r\n */\r\nexport interface DefaultGeometry extends MixinsDefaultGeometry\r\n{\r\n}\r\n","import { Matrix4x4 } from '@feng3d/math';\r\nimport { RenderAtomic } from '@feng3d/renderer';\r\nimport { Renderable } from '../../core/Renderable';\r\nimport { Texture2D } from '../../textures/Texture2D';\r\nimport { DirectionalLight } from '../DirectionalLight';\r\nimport { PointLight } from '../PointLight';\r\nimport { ShadowType } from '../shadow/ShadowType';\r\nimport { SpotLight } from '../SpotLight';\r\n\r\nexport class LightPicker\r\n{\r\n    private _model: Renderable;\r\n\r\n    constructor(model: Renderable)\r\n    {\r\n        this._model = model;\r\n    }\r\n\r\n    beforeRender(renderAtomic: RenderAtomic)\r\n    {\r\n        let pointLights: PointLight[] = [];\r\n        let directionalLights: DirectionalLight[] = [];\r\n        let spotLights: SpotLight[] = [];\r\n\r\n        const scene = this._model.gameObject.scene;\r\n        if (scene)\r\n        {\r\n            pointLights = scene.activePointLights;\r\n            directionalLights = scene.activeDirectionalLights;\r\n            spotLights = scene.activeSpotLights;\r\n        }\r\n\r\n        renderAtomic.shaderMacro.NUM_LIGHT = pointLights.length + directionalLights.length + spotLights.length;\r\n\r\n        // 设置点光源数据\r\n        const castShadowPointLights: PointLight[] = [];\r\n        const unCastShadowPointLights: PointLight[] = [];\r\n        const pointShadowMaps: Texture2D[] = [];\r\n        pointLights.forEach((element) =>\r\n        {\r\n            if (!element.isVisibleAndEnabled) return;\r\n            if (element.shadowType !== ShadowType.No_Shadows && this._model.receiveShadows)\r\n            {\r\n                castShadowPointLights.push(element);\r\n                pointShadowMaps.push(element.shadowMap);\r\n            }\r\n            else\r\n            {\r\n                unCastShadowPointLights.push(element);\r\n            }\r\n        });\r\n        renderAtomic.shaderMacro.NUM_POINTLIGHT = unCastShadowPointLights.length;\r\n        renderAtomic.shaderMacro.NUM_POINTLIGHT_CASTSHADOW = castShadowPointLights.length;\r\n        //\r\n        renderAtomic.uniforms.u_pointLights = unCastShadowPointLights;\r\n        renderAtomic.uniforms.u_castShadowPointLights = castShadowPointLights;\r\n        renderAtomic.uniforms.u_pointShadowMaps = pointShadowMaps;\r\n\r\n        // 设置聚光灯光源数据\r\n        const castShadowSpotLights: SpotLight[] = [];\r\n        const unCastShadowSpotLights: SpotLight[] = [];\r\n        const spotShadowMaps: Texture2D[] = [];\r\n        const spotShadowMatrix: Matrix4x4[] = [];\r\n        spotLights.forEach((element) =>\r\n        {\r\n            if (!element.isVisibleAndEnabled) return;\r\n            if (element.shadowType !== ShadowType.No_Shadows && this._model.receiveShadows)\r\n            {\r\n                castShadowSpotLights.push(element);\r\n                spotShadowMatrix.push(element.shadowCamera.viewProjection);\r\n                spotShadowMaps.push(element.shadowMap);\r\n            }\r\n            else\r\n            {\r\n                unCastShadowSpotLights.push(element);\r\n            }\r\n        });\r\n        renderAtomic.shaderMacro.NUM_SPOT_LIGHTS = unCastShadowSpotLights.length;\r\n        renderAtomic.shaderMacro.NUM_SPOT_LIGHTS_CASTSHADOW = castShadowSpotLights.length;\r\n        //\r\n        renderAtomic.uniforms.u_spotLights = unCastShadowSpotLights;\r\n        renderAtomic.uniforms.u_castShadowSpotLights = castShadowSpotLights;\r\n        renderAtomic.uniforms.u_spotShadowMatrix = spotShadowMatrix;\r\n        renderAtomic.uniforms.u_spotShadowMaps = spotShadowMaps;\r\n\r\n        // 设置方向光源数据\r\n        const castShadowDirectionalLights: DirectionalLight[] = [];\r\n        const unCastShadowDirectionalLights: DirectionalLight[] = [];\r\n        const directionalShadowMatrix: Matrix4x4[] = [];\r\n        const directionalShadowMaps: Texture2D[] = [];\r\n        directionalLights.forEach((element) =>\r\n        {\r\n            if (!element.isVisibleAndEnabled) return;\r\n            if (element.shadowType !== ShadowType.No_Shadows && this._model.receiveShadows)\r\n            {\r\n                castShadowDirectionalLights.push(element);\r\n                directionalShadowMatrix.push(element.shadowCamera.viewProjection);\r\n                directionalShadowMaps.push(element.shadowMap);\r\n            }\r\n            else\r\n            {\r\n                unCastShadowDirectionalLights.push(element);\r\n            }\r\n        });\r\n\r\n        renderAtomic.shaderMacro.NUM_DIRECTIONALLIGHT = unCastShadowDirectionalLights.length;\r\n        renderAtomic.shaderMacro.NUM_DIRECTIONALLIGHT_CASTSHADOW = castShadowDirectionalLights.length;\r\n        //\r\n        renderAtomic.uniforms.u_directionalLights = unCastShadowDirectionalLights;\r\n        renderAtomic.uniforms.u_castShadowDirectionalLights = castShadowDirectionalLights;\r\n        renderAtomic.uniforms.u_directionalShadowMatrixs = directionalShadowMatrix;\r\n        renderAtomic.uniforms.u_directionalShadowMaps = directionalShadowMaps;\r\n    }\r\n}\r\n","import { loader } from '@feng3d/filesystem';\r\nimport { Color4, ColorKeywords } from '@feng3d/math';\r\nimport { ArrayUtils } from '@feng3d/polyfill';\r\nimport { TextureFormat, TextureType } from '@feng3d/renderer';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { AssetType } from '../assets/AssetType';\r\nimport { AssetData } from '../core/AssetData';\r\nimport { HideFlags } from '../core/HideFlags';\r\nimport { TextureInfo } from '../render/data/TextureInfo';\r\nimport { ImageUtil } from '../utils/ImageUtil';\r\n\r\nexport enum ImageDatas\r\n{\r\n    black = 'black',\r\n    white = 'white',\r\n    red = 'red',\r\n    green = 'green',\r\n    blue = 'blue',\r\n    defaultNormal = 'defaultNormal',\r\n    defaultParticle = 'defaultParticle',\r\n}\r\n\r\nexport let imageDatas: {\r\n    black: ImageData;\r\n    white: ImageData;\r\n    red: ImageData;\r\n    green: ImageData;\r\n    blue: ImageData;\r\n    defaultNormal: ImageData;\r\n    defaultParticle: ImageData;\r\n};\r\nif (typeof document !== 'undefined')\r\n{\r\n    imageDatas = {\r\n        black: new ImageUtil(1, 1, new Color4().fromUnit24(ColorKeywords.black)).imageData,\r\n        white: new ImageUtil(1, 1, new Color4().fromUnit24(ColorKeywords.white)).imageData,\r\n        red: new ImageUtil(1, 1, new Color4().fromUnit24(ColorKeywords.red)).imageData,\r\n        green: new ImageUtil(1, 1, new Color4().fromUnit24(ColorKeywords.green)).imageData,\r\n        blue: new ImageUtil(1, 1, new Color4().fromUnit24(ColorKeywords.blue)).imageData,\r\n        defaultNormal: new ImageUtil(1, 1, new Color4().fromUnit24(0x8080ff)).imageData,\r\n        defaultParticle: new ImageUtil().drawDefaultParticle().imageData,\r\n    };\r\n}\r\n\r\nexport interface Texture2DEventMap\r\n{\r\n    /**\r\n     * 加载完成\r\n     */\r\n    loadCompleted: any;\r\n}\r\n\r\n/**\r\n * 2D纹理\r\n */\r\nexport class Texture2D<T extends Texture2DEventMap = Texture2DEventMap> extends TextureInfo<T>\r\n{\r\n    __class__: 'feng3d.Texture2D';\r\n\r\n    /**\r\n     * 纹理类型\r\n     */\r\n    textureType = TextureType.TEXTURE_2D;\r\n\r\n    assetType = AssetType.texture;\r\n\r\n    /**\r\n     * 当贴图数据未加载好等情况时代替使用\r\n     */\r\n    noPixels = ImageDatas.white;\r\n\r\n    /**\r\n     * 是否已加载\r\n     */\r\n    get isLoaded() { return this._loadings.length === 0; }\r\n    private _loadings = [];\r\n\r\n    get image(): HTMLImageElement\r\n    {\r\n        return this._pixels as any;\r\n    }\r\n\r\n    /**\r\n     * 用于表示初始化纹理的数据来源\r\n     */\r\n    @serialize\r\n    get source()\r\n    {\r\n        return this._source;\r\n    }\r\n    set source(v)\r\n    {\r\n        this._source = v;\r\n        if (!v)\r\n        {\r\n            this._pixels = null;\r\n            this.invalidate();\r\n\r\n            return;\r\n        }\r\n        if (v.url)\r\n        {\r\n            this._loadings.push(v.url);\r\n            loader.loadImage(v.url, (img) =>\r\n            {\r\n                this._pixels = img;\r\n                this.invalidate();\r\n                ArrayUtils.deleteItem(this._loadings, v.url);\r\n                this.onItemLoadCompleted();\r\n            }, null,\r\n                (e) =>\r\n                {\r\n                    console.error(e);\r\n                    ArrayUtils.deleteItem(this._loadings, v.url);\r\n                    this.onItemLoadCompleted();\r\n                });\r\n        }\r\n    }\r\n\r\n    constructor()\r\n    {\r\n        super();\r\n    }\r\n\r\n    private onItemLoadCompleted()\r\n    {\r\n        if (this._loadings.length === 0) this.emit('loadCompleted');\r\n    }\r\n\r\n    /**\r\n     * 已加载完成或者加载完成时立即调用\r\n     * @param callback 完成回调\r\n     */\r\n    onLoadCompleted(callback: () => void)\r\n    {\r\n        if (this.isLoaded)\r\n        {\r\n            callback();\r\n\r\n            return;\r\n        }\r\n        this.once('loadCompleted', callback);\r\n    }\r\n\r\n    private _source: { url: string };\r\n\r\n    /**\r\n     * 默认贴图\r\n     */\r\n    static white: Texture2D;\r\n\r\n    /**\r\n     * 默认贴图\r\n     */\r\n    static default: Texture2D;\r\n\r\n    /**\r\n     * 默认法线贴图\r\n     */\r\n    static defaultNormal: Texture2D;\r\n\r\n    /**\r\n     * 默认粒子贴图\r\n     */\r\n    static defaultParticle: Texture2D;\r\n\r\n    /**\r\n     * 从url初始化纹理\r\n     *\r\n     * @param url 路径\r\n     */\r\n    static fromUrl(url: string)\r\n    {\r\n        const texture = new Texture2D();\r\n        texture.source = { url };\r\n\r\n        return texture;\r\n    }\r\n}\r\n\r\nTexture2D.white = serialization.setValue(new Texture2D(), { name: 'white-Texture', noPixels: ImageDatas.white, hideFlags: HideFlags.NotEditable });\r\nTexture2D.default = serialization.setValue(new Texture2D(), { name: 'Default-Texture', hideFlags: HideFlags.NotEditable });\r\nTexture2D.defaultNormal = serialization.setValue(new Texture2D(), { name: 'Default-NormalTexture', noPixels: ImageDatas.defaultNormal, hideFlags: HideFlags.NotEditable });\r\nTexture2D.defaultParticle = serialization.setValue(new Texture2D(), { name: 'Default-ParticleTexture', noPixels: ImageDatas.defaultParticle, format: TextureFormat.RGBA, hideFlags: HideFlags.NotEditable });\r\n\r\nAssetData.addAssetData('white-Texture', Texture2D.white);\r\nAssetData.addAssetData('Default-Texture', Texture2D.default);\r\nAssetData.addAssetData('Default-NormalTexture', Texture2D.defaultNormal);\r\nAssetData.addAssetData('Default-ParticleTexture', Texture2D.defaultParticle);\r\n","import { Vector2 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { dataTransform, mathUtil } from '@feng3d/polyfill';\r\nimport { Texture, TextureDataType, TextureFormat, TextureMagFilter, TextureMinFilter, TextureType, TextureWrap } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { Feng3dObject, Feng3dObjectEventMap } from '../../core/Feng3dObject';\r\nimport { imageDatas } from '../../textures/Texture2D';\r\n\r\n/**\r\n * 纹理信息\r\n */\r\nexport abstract class TextureInfo<T extends Feng3dObjectEventMap> extends Feng3dObject<T> implements Texture\r\n{\r\n    /**\r\n     * 纹理类型\r\n     */\r\n    textureType: TextureType;\r\n\r\n    /**\r\n     * 格式\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVEnum', componentParam: { enumClass: TextureFormat } })\r\n    @watch('invalidate')\r\n    format = TextureFormat.RGBA;\r\n\r\n    /**\r\n     * 数据类型\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVEnum', componentParam: { enumClass: TextureDataType } })\r\n    @watch('invalidate')\r\n    type = TextureDataType.UNSIGNED_BYTE;\r\n\r\n    /**\r\n     * 是否生成mipmap\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidate')\r\n    generateMipmap = false;\r\n\r\n    /**\r\n     * 对图像进行Y轴反转。默认值为false\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidate')\r\n    flipY = false;\r\n\r\n    /**\r\n     * 将图像RGB颜色值得每一个分量乘以A。默认为false\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidate')\r\n    premulAlpha = false;\r\n\r\n    @serialize\r\n    @oav({ component: 'OAVEnum', componentParam: { enumClass: TextureMinFilter } })\r\n    minFilter = TextureMinFilter.LINEAR;\r\n\r\n    @serialize\r\n    @oav({ component: 'OAVEnum', componentParam: { enumClass: TextureMagFilter } })\r\n    magFilter = TextureMagFilter.LINEAR;\r\n    /**\r\n     * 表示x轴的纹理的回环方式，就是当纹理的宽度小于需要贴图的平面的宽度的时候，平面剩下的部分应该p以何种方式贴图的问题。\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVEnum', componentParam: { enumClass: TextureWrap } })\r\n    get wrapS()\r\n    {\r\n        if (!this.isPowerOfTwo)\r\n        { return TextureWrap.CLAMP_TO_EDGE; }\r\n\r\n        return this._wrapS;\r\n    }\r\n    set wrapS(v)\r\n    {\r\n        this._wrapS = v;\r\n    }\r\n    private _wrapS = TextureWrap.REPEAT;\r\n\r\n    /**\r\n     * 表示y轴的纹理回环方式。 magFilter和minFilter表示过滤的方式，这是OpenGL的基本概念，我将在下面讲一下，目前你不用担心它的使用。当您不设置的时候，它会取默认值，所以，我们这里暂时不理睬他。\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVEnum', componentParam: { enumClass: TextureWrap } })\r\n    get wrapT()\r\n    {\r\n        if (!this.isPowerOfTwo)\r\n        { return TextureWrap.CLAMP_TO_EDGE; }\r\n\r\n        return this._wrapT;\r\n    }\r\n    set wrapT(v)\r\n    {\r\n        this._wrapT = v;\r\n    }\r\n    private _wrapT = TextureWrap.REPEAT;\r\n\r\n    /**\r\n     * 各向异性过滤。使用各向异性过滤能够使纹理的效果更好，但是会消耗更多的内存、CPU、GPU时间。默认为0。\r\n     */\r\n    @serialize\r\n    @oav()\r\n    anisotropy = 0;\r\n\r\n    invalid = true;\r\n\r\n    /**\r\n     * 需要使用的贴图数据\r\n     */\r\n    protected _pixels: TexImageSource | TexImageSource[];\r\n\r\n    /**\r\n     * 当贴图数据未加载好等情况时代替使用\r\n     */\r\n    noPixels: string | string[];\r\n\r\n    /**\r\n     * 当前使用的贴图数据\r\n     */\r\n    protected _activePixels: TexImageSource | TexImageSource[];\r\n\r\n    /**\r\n     * 是否为渲染目标纹理\r\n     */\r\n    isRenderTarget = false;\r\n\r\n    @watch('invalidate')\r\n    OFFSCREEN_WIDTH = 1024;\r\n\r\n    @watch('invalidate')\r\n    OFFSCREEN_HEIGHT = 1024;\r\n\r\n    /**\r\n     * 是否为2的幂贴图\r\n     */\r\n    get isPowerOfTwo()\r\n    {\r\n        if (this.isRenderTarget)\r\n        {\r\n            if (this.OFFSCREEN_WIDTH === 0 || !mathUtil.isPowerOfTwo(this.OFFSCREEN_WIDTH))\r\n            {\r\n                return false;\r\n            }\r\n            if (this.OFFSCREEN_HEIGHT === 0 || !mathUtil.isPowerOfTwo(this.OFFSCREEN_HEIGHT))\r\n            {\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        }\r\n        let pixels = this.activePixels;\r\n        if (!pixels) return false;\r\n        if (!Array.isArray(pixels))\r\n        { pixels = [pixels]; }\r\n        for (let i = 0; i < pixels.length; i++)\r\n        {\r\n            const element = pixels[i];\r\n            if (element.width === 0 || !mathUtil.isPowerOfTwo(element.width))\r\n            {\r\n                return false;\r\n            }\r\n            if (element.height === 0 || !mathUtil.isPowerOfTwo(element.height))\r\n            {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 纹理尺寸\r\n     */\r\n    getSize()\r\n    {\r\n        if (this.isRenderTarget)\r\n        {\r\n            return new Vector2(this.OFFSCREEN_WIDTH, this.OFFSCREEN_HEIGHT);\r\n        }\r\n        let pixels = this.activePixels;\r\n        if (!pixels)\r\n        {\r\n            return new Vector2(1, 1);\r\n        }\r\n        if (!Array.isArray(pixels))\r\n        {\r\n            pixels = [pixels];\r\n        }\r\n        if (pixels.length === 0)\r\n        {\r\n            return new Vector2(1, 1);\r\n        }\r\n        const pixel = pixels[0];\r\n\r\n        return new Vector2(pixel.width, pixel.height);\r\n    }\r\n\r\n    /**\r\n     * 判断数据是否满足渲染需求\r\n     */\r\n    private checkRenderData(pixels: TexImageSource | TexImageSource[])\r\n    {\r\n        if (!pixels) return false;\r\n        if (!Array.isArray(pixels))\r\n        {\r\n            pixels = [pixels];\r\n        }\r\n\r\n        if (pixels.length === 0) return false;\r\n        for (let i = 0; i < pixels.length; i++)\r\n        {\r\n            const element = pixels[i];\r\n            if (!element) return false;\r\n            if (element.width === 0)\r\n            {\r\n                return false;\r\n            }\r\n            if (element.height === 0)\r\n            {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 使纹理失效\r\n     */\r\n    invalidate()\r\n    {\r\n        this.invalid = true;\r\n    }\r\n\r\n    get activePixels()\r\n    {\r\n        this.updateActivePixels();\r\n\r\n        return this._activePixels;\r\n    }\r\n\r\n    /**\r\n     *\r\n     */\r\n    get dataURL()\r\n    {\r\n        this.updateActivePixels();\r\n        if (!this._dataURL)\r\n        {\r\n            if (this._activePixels instanceof ImageData)\r\n            {\r\n                this._dataURL = dataTransform.imageDataToDataURL(this._activePixels);\r\n            }\r\n            else if (this._activePixels instanceof HTMLImageElement)\r\n            {\r\n                this._dataURL = dataTransform.imageToDataURL(this._activePixels);\r\n            }\r\n            else if (this._activePixels instanceof HTMLCanvasElement)\r\n            {\r\n                this._dataURL = dataTransform.canvasToDataURL(this._activePixels);\r\n            }\r\n        }\r\n\r\n        return this._dataURL;\r\n    }\r\n    private _dataURL: string;\r\n\r\n    private updateActivePixels()\r\n    {\r\n        const old = this._activePixels;\r\n        if (this.checkRenderData(this._pixels))\r\n        {\r\n            this._activePixels = this._pixels;\r\n        }\r\n        else\r\n            if (Array.isArray(this.noPixels))\r\n            {\r\n                this._activePixels = this.noPixels.map((v) => imageDatas[v]);\r\n            }\r\n            else\r\n            {\r\n                this._activePixels = imageDatas[this.noPixels];\r\n            }\r\n        if (old !== this._activePixels) this._dataURL = null;\r\n    }\r\n}\r\n","import { AnimationCurve, Color3, Color4, Gradient, Rectangle, Vector2 } from '@feng3d/math';\r\nimport { dataTransform, mathUtil } from '@feng3d/polyfill';\r\n\r\n/**\r\n * 图片相关工具\r\n */\r\nexport class ImageUtil\r\n{\r\n    imageData: ImageData;\r\n\r\n    /**\r\n     * 获取图片数据\r\n     * @param image 加载完成的图片元素\r\n     */\r\n    static fromImage(image: HTMLImageElement)\r\n    {\r\n        return new ImageUtil().fromImage(image);\r\n    }\r\n\r\n    /**\r\n     * 创建ImageData\r\n     * @param width 数据宽度\r\n     * @param height 数据高度\r\n     * @param fillcolor 填充颜色\r\n     */\r\n    constructor(width = 1, height = 1, fillcolor = new Color4(0, 0, 0, 0))\r\n    {\r\n        this.init(width, height, fillcolor);\r\n    }\r\n\r\n    /**\r\n     * 初始化\r\n     * @param width 宽度\r\n     * @param height 高度\r\n     * @param fillcolor 填充颜色\r\n     */\r\n    init(width = 1, height = 1, fillcolor = new Color4(0, 0, 0, 0))\r\n    {\r\n        this.imageData = new ImageData(width, height);\r\n        this.fillRect(new Rectangle(0, 0, width, height), fillcolor);\r\n    }\r\n\r\n    /**\r\n     * 获取图片数据\r\n     * @param image 加载完成的图片元素\r\n     */\r\n    fromImage(image: HTMLImageElement)\r\n    {\r\n        if (!image) return null;\r\n        const canvasImg = document.createElement('canvas');\r\n        canvasImg.width = image.width;\r\n        canvasImg.height = image.height;\r\n\r\n        const ctxt = canvasImg.getContext('2d');\r\n        console.assert(!!ctxt);\r\n        ctxt.drawImage(image, 0, 0);\r\n        this.imageData = ctxt.getImageData(0, 0, image.width, image.height);// 读取整张图片的像素。\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 绘制图片数据指定位置颜色\r\n     * @param x 图片数据x坐标\r\n     * @param y 图片数据y坐标\r\n     * @param color 颜色值\r\n     */\r\n    drawPixel(x: number, y: number, color: Color4)\r\n    {\r\n        const oldColor = this.getPixel(x, y);\r\n        oldColor.mix(color, color.a);\r\n        this.setPixel(x, y, oldColor);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 获取图片指定位置颜色值\r\n     * @param x 图片数据x坐标\r\n     * @param y 图片数据y坐标\r\n     */\r\n    getPixel(x: number, y: number)\r\n    {\r\n        const pos = (x + y * this.imageData.width) * 4;\r\n        const color = new Color4(this.imageData.data[pos] / 255, this.imageData.data[pos + 1] / 255, this.imageData.data[pos + 2] / 255, this.imageData.data[pos + 3] / 255);\r\n\r\n        return color;\r\n    }\r\n\r\n    /**\r\n     * 设置指定位置颜色值\r\n     * @param imageData 图片数据\r\n     * @param x 图片数据x坐标\r\n     * @param y 图片数据y坐标\r\n     * @param color 颜色值\r\n     */\r\n    setPixel(x: number, y: number, color: Color4)\r\n    {\r\n        x = Math.round(x);\r\n        y = Math.round(y);\r\n        const pos = (x + y * this.imageData.width) * 4;\r\n\r\n        this.imageData.data[pos] = color.r * 255;\r\n        this.imageData.data[pos + 1] = color.g * 255;\r\n        this.imageData.data[pos + 2] = color.b * 255;\r\n        this.imageData.data[pos + 3] = color.a * 255;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 清理图片数据\r\n     * @param clearColor 清理时填充颜色\r\n     */\r\n    clear(clearColor = new Color4(0, 0, 0, 0))\r\n    {\r\n        for (let i = 0; i < this.imageData.width; i++)\r\n        {\r\n            for (let j = 0; j < this.imageData.height; j++)\r\n            {\r\n                this.setPixel(i, j, clearColor);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 填充矩形\r\n     * @param rect 填充的矩形\r\n     * @param fillcolor 填充颜色\r\n     */\r\n    fillRect(rect: Rectangle, fillcolor = new Color4())\r\n    {\r\n        for (let i = rect.x > 0 ? rect.x : 0; i < this.imageData.width && i < rect.x + rect.width; i++)\r\n        {\r\n            for (let j = rect.y > 0 ? rect.y : 0; j < this.imageData.height && j < rect.y + rect.height; j++)\r\n            {\r\n                this.setPixel(i, j, fillcolor);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 绘制线条\r\n     * @param start 起始坐标\r\n     * @param end 终止坐标\r\n     * @param color 线条颜色\r\n     */\r\n    drawLine(start: Vector2, end: Vector2, color: Color4)\r\n    {\r\n        const length = end.subTo(start).length;\r\n        const p = new Vector2();\r\n        for (let i = 0; i <= length; i++)\r\n        {\r\n            start.lerpNumberTo(end, i / length, p);\r\n            this.setPixel(p.x, p.y, color);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 绘制点\r\n     * @param x x坐标\r\n     * @param y y坐标\r\n     * @param color 颜色\r\n     * @param size 尺寸\r\n     */\r\n    drawPoint(x: number, y: number, color: Color4, size = 1)\r\n    {\r\n        const half = Math.floor(size / 2);\r\n        //\r\n        let sx = x - half; if (sx < 0) sx = 0;\r\n        let ex = x - half + size; if (ex > this.imageData.width) ex = this.imageData.width;\r\n        let sy = y - half; if (sy < 0) sy = 0;\r\n        let ey = y - half + size; if (ey > this.imageData.height) ey = this.imageData.height;\r\n        //\r\n        for (let i = sx; i < ex; i++)\r\n        {\r\n            for (let j = sy; j < ey; j++)\r\n            {\r\n                this.setPixel(i, j, color);\r\n            }\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 绘制图片数据\r\n     * @param imageData 图片数据\r\n     * @param x x坐标\r\n     * @param y y坐标\r\n     */\r\n    drawImageData(imageData: ImageData, x: number, y: number)\r\n    {\r\n        const rect = new Rectangle(0, 0, this.imageData.width, this.imageData.height).intersection(new Rectangle(x, y, imageData.width, imageData.height));\r\n\r\n        const imageUtil = new ImageUtil(); imageUtil.imageData = imageData;\r\n        for (let i = rect.x; i < rect.x + rect.width; i++)\r\n        {\r\n            for (let j = rect.y; j < rect.y + rect.height; j++)\r\n            {\r\n                const c = imageUtil.getPixel(i - x, j - y);\r\n                this.drawPixel(i, j, c);\r\n            }\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 转换为DataUrl字符串数据\r\n     */\r\n    toDataURL()\r\n    {\r\n        return dataTransform.imageDataToDataURL(this.imageData);\r\n    }\r\n\r\n    /**\r\n     * 创建默认粒子贴图\r\n     * @param size 尺寸\r\n     */\r\n    drawDefaultParticle(size = 64)\r\n    {\r\n        const imageData = new ImageData(size, size);\r\n\r\n        const half = size / 2;\r\n        for (let i = 0; i < size; i++)\r\n        {\r\n            for (let j = 0; j < size; j++)\r\n            {\r\n                const l = mathUtil.clamp(new Vector2(i - half, j - half).length, 0, half) / half;\r\n                let f = 1 - l;\r\n                f = f * f;\r\n\r\n                const pos = (i + j * size) * 4;\r\n                imageData.data[pos] = f * 255;\r\n                imageData.data[pos + 1] = f * 255;\r\n                imageData.data[pos + 2] = f * 255;\r\n                imageData.data[pos + 3] = f * 255;\r\n            }\r\n        }\r\n        this.imageData = imageData;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 创建颜色拾取矩形\r\n     * @param color 基色\r\n     * @param width 宽度\r\n     * @param height 高度\r\n     */\r\n    drawColorPickerRect(color: number)\r\n    {\r\n        Image;\r\n        const leftTop = new Color3(1, 1, 1);\r\n        const rightTop = new Color3().fromUnit(color);\r\n        const leftBottom = new Color3(0, 0, 0);\r\n        const rightBottom = new Color3(0, 0, 0);\r\n\r\n        //\r\n        for (let i = 0; i < this.imageData.width; i++)\r\n        {\r\n            for (let j = 0; j < this.imageData.height; j++)\r\n            {\r\n                const top = leftTop.mixTo(rightTop, i / this.imageData.width);\r\n                const bottom = leftBottom.mixTo(rightBottom, i / this.imageData.width);\r\n                const v = top.mixTo(bottom, j / this.imageData.height);\r\n\r\n                this.setPixel(i, j, new Color4().fromColor3(v));\r\n            }\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    drawColorRect(color: Color4)\r\n    {\r\n        const colorHeight = Math.floor(this.imageData.height * 0.8);\r\n        const alphaWidth = Math.floor(color.a * this.imageData.width);\r\n\r\n        const color4 = color.clone(); color4.a = 1;\r\n        const white = new Color4(1, 1, 1);\r\n        const black = new Color4(0, 0, 0);\r\n        //\r\n        for (let i = 0; i < this.imageData.width; i++)\r\n        {\r\n            for (let j = 0; j < this.imageData.height; j++)\r\n            {\r\n                //\r\n                if (j <= colorHeight)\r\n                {\r\n                    this.setPixel(i, j, color4);\r\n                }\r\n                else\r\n                {\r\n                    this.setPixel(i, j, i < alphaWidth ? white : black);\r\n                }\r\n            }\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param gradient\r\n     * @param dirw true为横向条带，否则纵向条带\r\n     */\r\n    drawMinMaxGradient(gradient: Gradient, dirw = true)\r\n    {\r\n        //\r\n        for (let i = 0; i < this.imageData.width; i++)\r\n        {\r\n            for (let j = 0; j < this.imageData.height; j++)\r\n            {\r\n                const c = gradient.getValue(dirw ? i / (this.imageData.width - 1) : j / (this.imageData.height - 1));\r\n\r\n                this.setPixel(i, j, c);\r\n            }\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 绘制曲线\r\n     * @param curve 曲线\r\n     * @param between0And1 是否显示值在[0,1]区间，否则[-1,1]区间\r\n     * @param color 曲线颜色\r\n     */\r\n    drawCurve(curve: AnimationCurve, between0And1: boolean, color: Color4, rect = null)\r\n    {\r\n        rect = rect || new Rectangle(0, 0, this.imageData.width, this.imageData.height);\r\n        const range = between0And1 ? [1, 0] : [1, -1];\r\n\r\n        const prepos = new Vector2();\r\n        const curpos = new Vector2();\r\n        //\r\n        for (let i = 0; i < rect.width; i++)\r\n        {\r\n            //\r\n            let y = curve.getValue(i / (rect.width - 1));\r\n\r\n            y = mathUtil.mapLinear(y, range[0], range[1], 0, 1);\r\n\r\n            const j = Math.round(y * (rect.height - 1));\r\n\r\n            //\r\n            curpos.x = rect.x + i;\r\n            curpos.y = rect.y + j;\r\n            if (i > 0)\r\n            {\r\n                this.drawLine(prepos, curpos, color);\r\n            }\r\n            prepos.x = curpos.x;\r\n            prepos.y = curpos.y;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 绘制双曲线\r\n     * @param curve 曲线\r\n     * @param curve1 曲线\r\n     * @param between0And1  是否显示值在[0,1]区间，否则[-1,1]区间\r\n     * @param curveColor 颜色\r\n     */\r\n    drawBetweenTwoCurves(curve: AnimationCurve, curve1: AnimationCurve, between0And1: boolean, curveColor = new Color4(), fillcolor = new Color4(1, 1, 1, 0.5), rect = null)\r\n    {\r\n        rect = rect || new Rectangle(0, 0, this.imageData.width, this.imageData.height);\r\n        const range = between0And1 ? [1, 0] : [1, -1];\r\n\r\n        const prepos0 = new Vector2();\r\n        const curpos0 = new Vector2();\r\n        const prepos1 = new Vector2();\r\n        const curpos1 = new Vector2();\r\n        //\r\n        for (let i = 0; i < rect.width; i++)\r\n        {\r\n            //\r\n            let y0 = curve.getValue(i / (rect.width - 1));\r\n            let y1 = curve1.getValue(i / (rect.width - 1));\r\n\r\n            y0 = mathUtil.mapLinear(y0, range[0], range[1], 0, 1);\r\n            y1 = mathUtil.mapLinear(y1, range[0], range[1], 0, 1);\r\n\r\n            y0 = Math.round(y0 * (rect.height - 1));\r\n            y1 = Math.round(y1 * (rect.height - 1));\r\n\r\n            curpos0.x = rect.x + i;\r\n            curpos0.y = rect.y + y0;\r\n            curpos1.x = rect.x + i;\r\n            curpos1.y = rect.y + y1;\r\n\r\n            this.drawLine(new Vector2(rect.x + i, rect.y + y0), new Vector2(rect.x + i, rect.y + y1), fillcolor);\r\n            if (i > 0)\r\n            {\r\n                this.drawLine(prepos0, curpos0, curveColor);\r\n                this.drawLine(prepos1, curpos1, curveColor);\r\n            }\r\n            prepos0.x = curpos0.x;\r\n            prepos0.y = curpos0.y;\r\n            prepos1.x = curpos1.x;\r\n            prepos1.y = curpos1.y;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 清理背景颜色，目前仅用于特定的抠图，例如 editor\\resource\\assets\\3d\\terrain\\terrain_brushes.png\r\n     * @param backColor 背景颜色\r\n     */\r\n    clearBackColor(backColor: Color4)\r\n    {\r\n        for (let i = 0; i < this.imageData.width; i++)\r\n        {\r\n            for (let j = 0; j < this.imageData.height; j++)\r\n            {\r\n                const t = this.getPixel(i, j);\r\n                const a = 1 - t.r / backColor.r;\r\n                t.r = t.g = t.b = 0;\r\n                t.a = a;\r\n                this.setPixel(i, j, t);\r\n            }\r\n        }\r\n    }\r\n}\r\n","import { FS } from '@feng3d/filesystem';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { ArrayUtils } from '@feng3d/polyfill';\r\nimport { TextureType } from '@feng3d/renderer';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { AssetType } from '../assets/AssetType';\r\nimport { AssetData } from '../core/AssetData';\r\nimport { HideFlags } from '../core/HideFlags';\r\nimport { TextureInfo } from '../render/data/TextureInfo';\r\nimport { ImageDatas, Texture2D } from './Texture2D';\r\n\r\nexport interface TextureCubeEventMap\r\n{\r\n    /**\r\n     * 加载完成\r\n     */\r\n    loadCompleted: any;\r\n}\r\n\r\nexport type TextureCubeImageName = 'positive_x_url' | 'positive_y_url' | 'positive_z_url' | 'negative_x_url' | 'negative_y_url' | 'negative_z_url';\r\n\r\n/**\r\n * 立方体纹理\r\n */\r\nexport class TextureCube<T extends TextureCubeEventMap = TextureCubeEventMap> extends TextureInfo<T>\r\n{\r\n    __class__: 'feng3d.TextureCube';\r\n\r\n    textureType = TextureType.TEXTURE_CUBE_MAP;\r\n\r\n    assetType = AssetType.texturecube;\r\n\r\n    static ImageNames: TextureCubeImageName[] = ['positive_x_url', 'positive_y_url', 'positive_z_url', 'negative_x_url', 'negative_y_url', 'negative_z_url'];\r\n\r\n    @oav({ component: 'OAVCubeMap', priority: 1 })\r\n    OAVCubeMap = '';\r\n\r\n    /**\r\n     * 原始数据\r\n     */\r\n    @serialize\r\n    @watch('_rawDataChanged')\r\n    rawData: { type: 'texture', textures: Texture2D[] } | { type: 'path', paths: string[] };\r\n\r\n    noPixels = [ImageDatas.white, ImageDatas.white, ImageDatas.white, ImageDatas.white, ImageDatas.white, ImageDatas.white];\r\n\r\n    protected _pixels = [null, null, null, null, null, null];\r\n\r\n    /**\r\n     * 是否加载完成\r\n     */\r\n    get isLoaded() { return this._loading.length === 0; }\r\n    private _loading = [];\r\n\r\n    setTexture2D(pos: TextureCubeImageName, texture: Texture2D)\r\n    {\r\n        if (!this.rawData || this.rawData.type !== 'texture')\r\n        {\r\n            this.rawData = { type: 'texture', textures: [] };\r\n        }\r\n        const index = TextureCube.ImageNames.indexOf(pos);\r\n        this.rawData.textures[index] = texture;\r\n\r\n        this._loadItemTexture(texture, index);\r\n    }\r\n\r\n    setTexture2DPath(pos: TextureCubeImageName, path: string)\r\n    {\r\n        if (!this.rawData || this.rawData.type !== 'path')\r\n        {\r\n            this.rawData = { type: 'path', paths: [] };\r\n        }\r\n        const index = TextureCube.ImageNames.indexOf(pos);\r\n        this.rawData.paths[index] = path;\r\n\r\n        this._loadItemImagePath(path, index);\r\n    }\r\n\r\n    getTextureImage(pos: TextureCubeImageName, callback: (img?: HTMLImageElement) => void)\r\n    {\r\n        if (!this.rawData)\r\n        {\r\n            callback();\r\n\r\n            return;\r\n        }\r\n        const index = TextureCube.ImageNames.indexOf(pos);\r\n        if (this.rawData.type === 'texture')\r\n        {\r\n            const texture = this.rawData.textures[index];\r\n            if (!texture)\r\n            {\r\n                callback();\r\n\r\n                return;\r\n            }\r\n            texture.onLoadCompleted(() =>\r\n            {\r\n                callback(texture.image);\r\n            });\r\n        }\r\n        else if (this.rawData.type === 'path')\r\n        {\r\n            const path = this.rawData.paths[index];\r\n            if (!path)\r\n            {\r\n                callback();\r\n\r\n                return;\r\n            }\r\n            FS.fs.readImage(path, (_err: Error, img: HTMLImageElement) =>\r\n            {\r\n                callback(img);\r\n            });\r\n        }\r\n    }\r\n\r\n    private _rawDataChanged()\r\n    {\r\n        if (!this.rawData) return;\r\n\r\n        if (this.rawData.type === 'texture')\r\n        {\r\n            this.rawData.textures.forEach((v, index) =>\r\n            {\r\n                this._loadItemTexture(v, index);\r\n            });\r\n            this.invalidate();\r\n        }\r\n        else if (this.rawData.type === 'path')\r\n        {\r\n            this.rawData.paths.forEach((v, index) =>\r\n            {\r\n                this._loadItemImagePath(v, index);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 加载单个贴图\r\n     *\r\n     * @param texture 贴图\r\n     * @param index 索引\r\n     */\r\n    private _loadItemTexture(texture: Texture2D, index: number)\r\n    {\r\n        if (!texture) return;\r\n\r\n        this._loading.push(texture);\r\n        texture.onLoadCompleted(() =>\r\n        {\r\n            if (this.rawData.type === 'texture' && this.rawData.textures[index] === texture)\r\n            {\r\n                this._pixels[index] = texture.image;\r\n                this.invalidate();\r\n            }\r\n            ArrayUtils.deleteItem(this._loading, texture);\r\n            this._onItemLoadCompleted();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 加载单个图片\r\n     *\r\n     * @param imagepath 图片路径\r\n     * @param index 索引\r\n     */\r\n    private _loadItemImagePath(imagepath: string, index: number)\r\n    {\r\n        if (!imagepath) return;\r\n\r\n        this._loading.push(imagepath);\r\n        FS.fs.readImage(imagepath, (_err, img) =>\r\n        {\r\n            if (img && this.rawData.type === 'path' && this.rawData.paths[index] === imagepath)\r\n            {\r\n                this._pixels[index] = img;\r\n                this.invalidate();\r\n            }\r\n            ArrayUtils.deleteItem(this._loading, imagepath);\r\n            this._onItemLoadCompleted();\r\n        });\r\n    }\r\n\r\n    private _onItemLoadCompleted()\r\n    {\r\n        if (this._loading.length === 0) this.emit('loadCompleted');\r\n    }\r\n\r\n    /**\r\n     * 已加载完成或者加载完成时立即调用\r\n     * @param callback 完成回调\r\n     */\r\n    onLoadCompleted(callback: () => void)\r\n    {\r\n        if (this.isLoaded)\r\n        {\r\n            callback();\r\n\r\n            return;\r\n        }\r\n        this.once('loadCompleted', callback);\r\n    }\r\n\r\n    static default: TextureCube;\r\n}\r\n\r\nTextureCube.default = serialization.setValue(new TextureCube(), { name: 'Default-TextureCube', hideFlags: HideFlags.NotEditable });\r\n\r\nAssetData.addAssetData('Default-TextureCube', TextureCube.default);\r\n","import { Color3, Color4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { shaderlib } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { Texture2D } from '../textures/Texture2D';\r\nimport { TextureCube } from '../textures/TextureCube';\r\nimport { Material } from './Material';\r\n\r\nimport standardFragment from '../shaders/standard.fragment.glsl';\r\nimport standardVertex from '../shaders/standard.vertex.glsl';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsDefaultMaterial\r\n    {\r\n        'Default-Material': Material;\r\n    }\r\n\r\n    export interface MixinsUniformsTypes\r\n    {\r\n        standard: StandardUniforms\r\n    }\r\n}\r\n\r\n/**\r\n * 雾模式\r\n */\r\nexport enum FogMode\r\n{\r\n    NONE = 0,\r\n    EXP = 1,\r\n    EXP2 = 2,\r\n    LINEAR = 3\r\n}\r\n\r\nexport class StandardUniforms\r\n{\r\n    __class__: 'feng3d.StandardUniforms' | 'feng3d.TerrainUniforms' | 'feng3d.ParticleUniforms';\r\n    /**\r\n     * 点绘制时点的尺寸\r\n     */\r\n    @serialize\r\n    @oav()\r\n    u_PointSize = 1;\r\n\r\n    /**\r\n     * 漫反射纹理\r\n     */\r\n    @serialize\r\n    @oav({ block: 'diffuse' })\r\n    s_diffuse = Texture2D.default;\r\n\r\n    /**\r\n     * 基本颜色\r\n     */\r\n    @serialize\r\n    @oav({ block: 'diffuse' })\r\n    u_diffuse = new Color4(1, 1, 1, 1);\r\n\r\n    /**\r\n     * 透明阈值，透明度小于该值的像素被片段着色器丢弃\r\n     */\r\n    @serialize\r\n    @oav({ block: 'diffuse' })\r\n    u_alphaThreshold = 0;\r\n\r\n    /**\r\n     * 法线纹理\r\n     */\r\n    @serialize\r\n    @oav({ block: 'normalMethod' })\r\n    s_normal = Texture2D.defaultNormal;\r\n\r\n    /**\r\n     * 镜面反射光泽图\r\n     */\r\n    @serialize\r\n    @oav({ block: 'specular' })\r\n    s_specular = Texture2D.default;\r\n\r\n    /**\r\n     * 镜面反射颜色\r\n     */\r\n    @serialize\r\n    @oav({ block: 'specular' })\r\n    u_specular = new Color3();\r\n\r\n    /**\r\n     * 高光系数\r\n     */\r\n    @serialize\r\n    @oav({ block: 'specular' })\r\n    u_glossiness = 50;\r\n\r\n    /**\r\n     * 环境纹理\r\n     */\r\n    @serialize\r\n    @oav({ block: 'ambient' })\r\n    s_ambient = Texture2D.default;\r\n\r\n    /**\r\n     * 环境光颜色\r\n     */\r\n    @serialize\r\n    @oav({ block: 'ambient' })\r\n    u_ambient = new Color4();\r\n\r\n    /**\r\n     * 环境映射贴图\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVPick', block: 'envMap', componentParam: { accepttype: 'texturecube', datatype: 'texturecube' } })\r\n    s_envMap = TextureCube.default;\r\n\r\n    /**\r\n     * 反射率\r\n     */\r\n    @serialize\r\n    @oav({ block: 'envMap' })\r\n    u_reflectivity = 1;\r\n\r\n    /**\r\n     * 出现雾效果的最近距离\r\n     */\r\n    @serialize\r\n    @oav({ block: 'fog' })\r\n    u_fogMinDistance = 0;\r\n\r\n    /**\r\n     * 最远距离\r\n     */\r\n    @serialize\r\n    @oav({ block: 'fog' })\r\n    u_fogMaxDistance = 100;\r\n\r\n    /**\r\n     * 雾的颜色\r\n     */\r\n    @serialize\r\n    @oav({ block: 'fog' })\r\n    u_fogColor = new Color3();\r\n\r\n    /**\r\n     * 雾的密度\r\n     */\r\n    @serialize\r\n    @oav({ block: 'fog' })\r\n    u_fogDensity = 0.1;\r\n\r\n    /**\r\n     * 雾模式\r\n     */\r\n    @serialize\r\n    @oav({ block: 'fog', component: 'OAVEnum', componentParam: { enumClass: FogMode } })\r\n    u_fogMode = FogMode.NONE;\r\n}\r\n\r\nshaderlib.shaderConfig.shaders.standard = { fragment: standardFragment, vertex: standardVertex, cls: StandardUniforms };\r\n\r\n","import { globalEmitter } from '@feng3d/event';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { gPartial } from '@feng3d/polyfill';\r\nimport { RenderAtomic, RenderMode, RenderParams, Shader, shaderlib } from '@feng3d/renderer';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { AssetData } from '../core/AssetData';\r\nimport { Feng3dObject } from '../core/Feng3dObject';\r\nimport { HideFlags } from '../core/HideFlags';\r\nimport { Texture2D } from '../textures/Texture2D';\r\nimport { TextureCube } from '../textures/TextureCube';\r\nimport { StandardUniforms } from './StandardMaterial';\r\n\r\ndeclare global\r\n{\r\n    interface MixinsDefaultMaterial\r\n    {\r\n\r\n    }\r\n    interface MixinsUniformsTypes\r\n    {\r\n\r\n    }\r\n}\r\n\r\nexport interface UniformsTypes extends MixinsUniformsTypes { }\r\nexport type ShaderNames = keyof UniformsTypes;\r\nexport type UniformsLike = UniformsTypes[keyof UniformsTypes];\r\n\r\n/**\r\n * 材质\r\n */\r\nexport class Material extends Feng3dObject\r\n{\r\n    __class__: 'feng3d.Material';\r\n\r\n    static create<K extends keyof UniformsTypes>(shaderName: K, uniforms?: gPartial<UniformsTypes[K]>, renderParams?: gPartial<RenderParams>)\r\n    {\r\n        const material = new Material();\r\n        material.init(shaderName, uniforms, renderParams);\r\n\r\n        return material;\r\n    }\r\n\r\n    init<K extends keyof UniformsTypes>(shaderName: K, uniforms?: gPartial<UniformsTypes[K]>, renderParams?: gPartial<RenderParams>)\r\n    {\r\n        this.shaderName = shaderName;\r\n        //\r\n        uniforms && serialization.setValue(this.uniforms, <any>uniforms);\r\n        renderParams && serialization.setValue(this.renderParams, renderParams);\r\n\r\n        return this;\r\n    }\r\n\r\n    //\r\n    private renderAtomic = new RenderAtomic();\r\n\r\n    @oav({ component: 'OAVFeng3dPreView' })\r\n    private preview = '';\r\n\r\n    /**\r\n     * shader名称\r\n     */\r\n    @oav({ component: 'OAVMaterialName' })\r\n    @serialize\r\n    @watch('_onShaderChanged')\r\n    shaderName: ShaderNames;\r\n\r\n    @oav()\r\n    @serialize\r\n    name = '';\r\n\r\n    /**\r\n     * Uniform数据\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVObjectView' })\r\n    @watch('_onUniformsChanged')\r\n    uniforms: UniformsLike;\r\n\r\n    /**\r\n     * 渲染参数\r\n     */\r\n    @serialize\r\n    @oav({ block: '渲染参数', component: 'OAVObjectView' })\r\n    @watch('_onRenderParamsChanged')\r\n    renderParams: RenderParams;\r\n\r\n    constructor()\r\n    {\r\n        super();\r\n        globalEmitter.on('asset.shaderChanged', this._onShaderChanged, this);\r\n        this.shaderName = 'standard';\r\n        this.uniforms = new StandardUniforms();\r\n        this.renderParams = new RenderParams();\r\n    }\r\n\r\n    beforeRender(renderAtomic: RenderAtomic)\r\n    {\r\n        Object.assign(renderAtomic.uniforms, this.renderAtomic.uniforms);\r\n\r\n        renderAtomic.shader = this.renderAtomic.shader;\r\n        renderAtomic.renderParams = this.renderAtomic.renderParams;\r\n        renderAtomic.shaderMacro.IS_POINTS_MODE = this.renderParams.renderMode === RenderMode.POINTS;\r\n    }\r\n\r\n    /**\r\n     * 是否加载完成\r\n     */\r\n    get isLoaded()\r\n    {\r\n        const uniforms = this.uniforms;\r\n        for (const key in uniforms)\r\n        {\r\n            const texture = uniforms[key];\r\n            if (texture instanceof Texture2D || texture instanceof TextureCube)\r\n            {\r\n                if (!texture.isLoaded) return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 已加载完成或者加载完成时立即调用\r\n     * @param callback 完成回调\r\n     */\r\n    onLoadCompleted(callback: () => void)\r\n    {\r\n        let loadingNum = 0;\r\n        const uniforms = this.uniforms;\r\n        for (const key in uniforms)\r\n        {\r\n            const texture = uniforms[key];\r\n            if (texture instanceof Texture2D || texture instanceof TextureCube)\r\n            {\r\n                if (!texture.isLoaded)\r\n                {\r\n                    loadingNum++;\r\n                    // eslint-disable-next-line no-loop-func\r\n                    texture.on('loadCompleted', () =>\r\n                    {\r\n                        loadingNum--;\r\n                        if (loadingNum === 0) callback();\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        if (loadingNum === 0) callback();\r\n    }\r\n\r\n    private _onShaderChanged()\r\n    {\r\n        const Cls = shaderlib.shaderConfig.shaders[this.shaderName].cls;\r\n        if (Cls)\r\n        {\r\n            if (!this.uniforms || this.uniforms.constructor !== Cls)\r\n            {\r\n                const newuniforms = new Cls();\r\n                this.uniforms = newuniforms;\r\n            }\r\n        }\r\n        else\r\n        {\r\n            this.uniforms = <any>{};\r\n        }\r\n\r\n        const renderParams = shaderlib.shaderConfig.shaders[this.shaderName].renderParams;\r\n        renderParams && serialization.setValue(this.renderParams, renderParams);\r\n\r\n        this.renderAtomic.shader = new Shader({ shaderName: this.shaderName });\r\n    }\r\n\r\n    private _onUniformsChanged()\r\n    {\r\n        this.renderAtomic.uniforms = this.uniforms as any;\r\n    }\r\n\r\n    private _onRenderParamsChanged()\r\n    {\r\n        this.renderAtomic.renderParams = this.renderParams;\r\n    }\r\n\r\n    /**\r\n     * 设置默认材质\r\n     *\r\n     * 资源名称与材质名称相同，且无法在检查器界面中编辑。\r\n     *\r\n     * @param name 材质名称\r\n     * @param material 材质数据\r\n     */\r\n    static setDefault<K extends keyof DefaultMaterial>(name: K, material: gPartial<Material>)\r\n    {\r\n        const newMaterial = this._defaultMaterials[<any>name] = new Material();\r\n        serialization.setValue(newMaterial, material);\r\n        serialization.setValue(newMaterial, { name, hideFlags: HideFlags.NotEditable });\r\n        AssetData.addAssetData(name, newMaterial);\r\n    }\r\n\r\n    /**\r\n     * 获取材质\r\n     *\r\n     * @param name 材质名称\r\n     */\r\n    static getDefault<K extends keyof DefaultMaterial>(name: K)\r\n    {\r\n        return this._defaultMaterials[name];\r\n    }\r\n    private static _defaultMaterials: DefaultMaterial = <any>{};\r\n}\r\n\r\n/**\r\n * 默认材质\r\n */\r\nexport interface DefaultMaterial extends MixinsDefaultMaterial\r\n{\r\n}\r\n\r\nMaterial.setDefault('Default-Material', { shaderName: 'standard' });\r\n","import { Box3, Ray3 } from '@feng3d/math';\r\nimport { Behaviour } from '../component/Behaviour';\r\nimport { RegisterComponent } from '../component/Component';\r\nimport { PickingCollisionVO } from '../pick/Raycaster';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        RayCastable: RayCastable;\r\n    }\r\n}\r\n\r\n/**\r\n * 可射线捕获\r\n */\r\n@RegisterComponent()\r\nexport class RayCastable extends Behaviour\r\n{\r\n    protected _selfLocalBounds: Box3;\r\n    protected _selfWorldBounds: Box3;\r\n\r\n    /**\r\n     * 自身局部包围盒\r\n     */\r\n    get selfLocalBounds()\r\n    {\r\n        if (!this._selfLocalBounds)\r\n        { this._updateBounds(); }\r\n\r\n        return this._selfLocalBounds;\r\n    }\r\n\r\n    /**\r\n     * 自身世界包围盒\r\n     */\r\n    get selfWorldBounds()\r\n    {\r\n        if (!this._selfWorldBounds)\r\n        { this._updateWorldBounds(); }\r\n\r\n        return this._selfWorldBounds;\r\n    }\r\n\r\n    /**\r\n     * 与世界空间射线相交\r\n     *\r\n     * @param _worldRay 世界空间射线\r\n     *\r\n     * @return 相交信息\r\n     */\r\n    worldRayIntersection(_worldRay: Ray3): PickingCollisionVO\r\n    {\r\n        throw '请在子类中实现！';\r\n    }\r\n\r\n    protected _onScenetransformChanged()\r\n    {\r\n        this._selfWorldBounds = null;\r\n    }\r\n\r\n    /**\r\n     * 更新世界边界\r\n     */\r\n    protected _updateWorldBounds()\r\n    {\r\n        this._selfWorldBounds = this.selfLocalBounds.applyMatrixTo(this.transform.localToWorldMatrix);\r\n    }\r\n\r\n    /**\r\n     * 处理包围盒变换事件\r\n     */\r\n    protected _onBoundsInvalid()\r\n    {\r\n        this._selfLocalBounds = null;\r\n        this._selfWorldBounds = null;\r\n\r\n        this.emit('selfBoundsChanged', this);\r\n    }\r\n\r\n    protected _updateBounds()\r\n    {\r\n        throw '请在子类中实现！';\r\n    }\r\n}\r\n","import { IEvent } from '@feng3d/event';\r\nimport { Box3, Ray3, Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { CullFace, RenderAtomic } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { Camera } from '../cameras/Camera';\r\nimport { RegisterComponent } from '../component/Component';\r\nimport { Geometry, GeometryLike } from '../geometry/Geometry';\r\nimport { LightPicker } from '../light/pickers/LightPicker';\r\nimport { Material } from '../materials/Material';\r\nimport { PickingCollisionVO } from '../pick/Raycaster';\r\nimport { Scene } from '../scene/Scene';\r\nimport { RayCastable } from './RayCastable';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap { Renderable: Renderable; }\r\n}\r\n\r\n/**\r\n * 可渲染组件\r\n *\r\n * General functionality for all renderers.\r\n *\r\n * A renderer is what makes an object appear on the screen. Use this class to access the renderer of any object, mesh or Particle System. Renderers can be disabled to make objects invisible (see enabled), and the materials can be accessed and modified through them (see material).\r\n *\r\n * See Also: Renderer components for meshes, particles, lines and trails.\r\n */\r\n@RegisterComponent()\r\nexport class Renderable extends RayCastable\r\n{\r\n    get single() { return true; }\r\n\r\n    readonly renderAtomic = new RenderAtomic();\r\n\r\n    /**\r\n     * 几何体\r\n     */\r\n    @oav({ component: 'OAVPick', tooltip: '几何体，提供模型以形状', componentParam: { accepttype: 'geometry', datatype: 'geometry' } })\r\n    @serialize\r\n    @watch('_onGeometryChanged')\r\n    geometry: GeometryLike = Geometry.getDefault('Cube');\r\n\r\n    /**\r\n     * 材质\r\n     */\r\n    @oav({ component: 'OAVPick', tooltip: '材质，提供模型以皮肤', componentParam: { accepttype: 'material', datatype: 'material' } })\r\n    @serialize\r\n    material = Material.getDefault('Default-Material');\r\n\r\n    @oav({ tooltip: '是否投射阴影' })\r\n    @serialize\r\n    castShadows = true;\r\n\r\n    @oav({ tooltip: '是否接受阴影' })\r\n    @serialize\r\n    receiveShadows = true;\r\n\r\n    constructor()\r\n    {\r\n        super();\r\n        this._lightPicker = new LightPicker(this);\r\n    }\r\n\r\n    init()\r\n    {\r\n        super.init();\r\n        this.on('scenetransformChanged', this._onScenetransformChanged, this);\r\n\r\n        this.on('getSelfBounds', this._onGetSelfBounds, this);\r\n    }\r\n\r\n    /**\r\n     * 渲染前执行函数\r\n     *\r\n     * 可用于渲染前收集渲染数据，或者更新显示效果等\r\n     *\r\n     * @param renderAtomic\r\n     * @param scene\r\n     * @param camera\r\n     */\r\n    beforeRender(renderAtomic: RenderAtomic, scene: Scene, camera: Camera)\r\n    {\r\n        //\r\n        this.geometry.beforeRender(renderAtomic);\r\n        this.material.beforeRender(renderAtomic);\r\n        this._lightPicker.beforeRender(renderAtomic);\r\n\r\n        this.gameObject.components.forEach((element) =>\r\n        {\r\n            if (element !== this)\r\n            { element.beforeRender(renderAtomic, scene, camera); }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 与世界空间射线相交\r\n     *\r\n     * @param worldRay 世界空间射线\r\n     *\r\n     * @return 相交信息\r\n     */\r\n    worldRayIntersection(worldRay: Ray3)\r\n    {\r\n        const localRay = this.transform.rayWorldToLocal(worldRay);\r\n        const pickingCollisionVO = this.localRayIntersection(localRay);\r\n\r\n        return pickingCollisionVO;\r\n    }\r\n\r\n    /**\r\n     * 与局部空间射线相交\r\n     *\r\n     * @param ray3D 局部空间射线\r\n     *\r\n     * @return 相交信息\r\n     */\r\n    localRayIntersection(localRay: Ray3)\r\n    {\r\n        const localNormal = new Vector3();\r\n\r\n        // 检测射线与边界的碰撞\r\n        const rayEntryDistance = this.selfLocalBounds.rayIntersection(localRay.origin, localRay.direction, localNormal);\r\n        if (rayEntryDistance === Number.MAX_VALUE)\r\n        { return null; }\r\n\r\n        // 保存碰撞数据\r\n        const pickingCollisionVO: PickingCollisionVO = {\r\n            gameObject: this.gameObject,\r\n            localNormal,\r\n            localRay,\r\n            rayEntryDistance,\r\n            rayOriginIsInsideBounds: rayEntryDistance === 0,\r\n            geometry: this.geometry,\r\n            cullFace: this.material.renderParams.cullFace as CullFace,\r\n        };\r\n\r\n        return pickingCollisionVO;\r\n    }\r\n\r\n    /**\r\n     * 是否加载完成\r\n     */\r\n    get isLoaded()\r\n    {\r\n        return this.material.isLoaded;\r\n    }\r\n\r\n    /**\r\n     * 已加载完成或者加载完成时立即调用\r\n     * @param callback 完成回调\r\n     */\r\n    onLoadCompleted(callback: () => void)\r\n    {\r\n        if (this.isLoaded) callback();\r\n        this.material.onLoadCompleted(callback);\r\n    }\r\n\r\n    /**\r\n     * 销毁\r\n     */\r\n    dispose()\r\n    {\r\n        this.geometry = <any>null;\r\n        this.material = <any>null;\r\n        super.dispose();\r\n    }\r\n\r\n    //\r\n    private _lightPicker: LightPicker;\r\n\r\n    private _onGeometryChanged(property: string, oldValue: GeometryLike, value: GeometryLike)\r\n    {\r\n        if (oldValue)\r\n        {\r\n            oldValue.off('boundsInvalid', this._onBoundsInvalid, this);\r\n        }\r\n        if (value)\r\n        {\r\n            value.on('boundsInvalid', this._onBoundsInvalid, this);\r\n        }\r\n        this.geometry = this.geometry || Geometry.getDefault('Cube');\r\n        this._onBoundsInvalid();\r\n    }\r\n\r\n    protected _updateBounds()\r\n    {\r\n        this._selfLocalBounds = this.geometry.bounding;\r\n    }\r\n\r\n    protected _onGetSelfBounds(event: IEvent<{ bounds: Box3[]; }>)\r\n    {\r\n        event.data.bounds.push(this.geometry.bounding);\r\n    }\r\n}\r\n","import { globalEmitter } from '@feng3d/event';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { classUtils } from '@feng3d/polyfill';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { Behaviour } from '../component/Behaviour';\r\nimport { RegisterComponent } from '../component/Component';\r\nimport { AddComponentMenu } from '../Menu';\r\nimport { RunEnvironment } from './RunEnvironment';\r\nimport { Script } from './Script';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        ScriptComponent: ScriptComponent;\r\n    }\r\n}\r\n\r\n/**\r\n * 3d对象脚本\r\n */\r\n@AddComponentMenu('Script/Script')\r\n@RegisterComponent()\r\nexport class ScriptComponent extends Behaviour\r\n{\r\n    runEnvironment = RunEnvironment.feng3d;\r\n\r\n    @serialize\r\n    @watch('_invalidateScriptInstance')\r\n    @oav({ component: 'OAVPick', componentParam: { accepttype: 'file_script' } })\r\n    scriptName: string;\r\n\r\n    /**\r\n     * 脚本对象\r\n     */\r\n    @serialize\r\n    get scriptInstance()\r\n    {\r\n        if (this._invalid) this._updateScriptInstance();\r\n\r\n        return this._scriptInstance;\r\n    }\r\n    private _scriptInstance: Script;\r\n\r\n    private _invalid = true;\r\n\r\n    private scriptInit = false;\r\n\r\n    init()\r\n    {\r\n        super.init();\r\n        globalEmitter.on('asset.scriptChanged', this._invalidateScriptInstance, this);\r\n    }\r\n\r\n    private _updateScriptInstance()\r\n    {\r\n        const oldInstance = this._scriptInstance;\r\n        this._scriptInstance = null;\r\n        if (!this.scriptName) return;\r\n\r\n        const Cls = classUtils.getDefinitionByName(this.scriptName, false);\r\n\r\n        if (Cls) this._scriptInstance = new Cls();\r\n        else console.warn(`无法初始化脚本 ${this.scriptName}`);\r\n\r\n        this.scriptInit = false;\r\n\r\n        // 移除旧实例\r\n        if (oldInstance)\r\n        {\r\n            // 如果两个类定义名称相同，则保留上个对象数据\r\n            if (classUtils.getQualifiedClassName(oldInstance) === this.scriptName)\r\n            {\r\n                serialization.setValue(this._scriptInstance, <any>oldInstance);\r\n            }\r\n            oldInstance.component = null;\r\n            oldInstance.dispose();\r\n        }\r\n        this._invalid = false;\r\n    }\r\n\r\n    private _invalidateScriptInstance()\r\n    {\r\n        this._invalid = true;\r\n    }\r\n\r\n    /**\r\n     * 每帧执行\r\n     */\r\n    update()\r\n    {\r\n        if (this.scriptInstance && !this.scriptInit)\r\n        {\r\n            this.scriptInstance.component = this;\r\n            this.scriptInstance.init();\r\n            this.scriptInit = true;\r\n        }\r\n        this.scriptInstance && this.scriptInstance.update();\r\n    }\r\n\r\n    /**\r\n     * 销毁\r\n     */\r\n    dispose()\r\n    {\r\n        this.enabled = false;\r\n\r\n        if (this._scriptInstance)\r\n        {\r\n            this._scriptInstance.component = null;\r\n            this._scriptInstance.dispose();\r\n            this._scriptInstance = null;\r\n        }\r\n        super.dispose();\r\n\r\n        globalEmitter.off('asset.scriptChanged', this._invalidateScriptInstance, this);\r\n    }\r\n}\r\n","import { Box3, Matrix4x4, Quaternion, Ray3, Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { mathUtil } from '@feng3d/polyfill';\r\nimport { RenderAtomic } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watcher } from '@feng3d/watcher';\r\nimport { Camera } from '../cameras/Camera';\r\nimport { Component, RegisterComponent } from '../component/Component';\r\nimport { Scene } from '../scene/Scene';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsGameObjectEventMap\r\n    {\r\n        /**\r\n         * 变换矩阵变化\r\n         */\r\n        transformChanged: Transform;\r\n        /**\r\n         *\r\n         */\r\n        updateLocalToWorldMatrix: Transform;\r\n\r\n        /**\r\n         * 场景矩阵变化\r\n         */\r\n        scenetransformChanged: Transform;\r\n    }\r\n\r\n    export interface MixinsComponentMap\r\n    {\r\n        Transform: Transform;\r\n    }\r\n}\r\n\r\n/**\r\n * 变换\r\n *\r\n * 物体的位置、旋转和比例。\r\n *\r\n * 场景中的每个对象都有一个变换。它用于存储和操作对象的位置、旋转和缩放。每个转换都可以有一个父元素，它允许您分层应用位置、旋转和缩放\r\n */\r\n@RegisterComponent()\r\nexport class Transform extends Component\r\n{\r\n    __class__: 'feng3d.Transform';\r\n\r\n    get single() { return true; }\r\n\r\n    /**\r\n     * 创建一个实体，该类为虚类\r\n     */\r\n    constructor()\r\n    {\r\n        super();\r\n\r\n        watcher.watch(this._position, 'x', this._positionChanged, this);\r\n        watcher.watch(this._position, 'y', this._positionChanged, this);\r\n        watcher.watch(this._position, 'z', this._positionChanged, this);\r\n        watcher.watch(this._rotation, 'x', this._rotationChanged, this);\r\n        watcher.watch(this._rotation, 'y', this._rotationChanged, this);\r\n        watcher.watch(this._rotation, 'z', this._rotationChanged, this);\r\n        watcher.watch(this._scale, 'x', this._scaleChanged, this);\r\n        watcher.watch(this._scale, 'y', this._scaleChanged, this);\r\n        watcher.watch(this._scale, 'z', this._scaleChanged, this);\r\n\r\n        this._renderAtomic.uniforms.u_modelMatrix = () => this.localToWorldMatrix;\r\n        this._renderAtomic.uniforms.u_ITModelMatrix = () => this.ITlocalToWorldMatrix;\r\n    }\r\n\r\n    /**\r\n     * 世界坐标\r\n     */\r\n    get worldPosition()\r\n    {\r\n        return this.localToWorldMatrix.getPosition();\r\n    }\r\n\r\n    get parent()\r\n    {\r\n        return this.gameObject.parent && this.gameObject.parent.transform;\r\n    }\r\n\r\n    /**\r\n     * X轴坐标。\r\n     */\r\n    @serialize\r\n    get x() { return this._position.x; }\r\n    set x(v) { this._position.x = v; }\r\n\r\n    /**\r\n     * Y轴坐标。\r\n     */\r\n    @serialize\r\n    get y() { return this._position.y; }\r\n    set y(v) { this._position.y = v; }\r\n\r\n    /**\r\n     * Z轴坐标。\r\n     */\r\n    @serialize\r\n    get z() { return this._position.z; }\r\n    set z(v) { this._position.z = v; }\r\n\r\n    /**\r\n     * X轴旋转角度。\r\n     */\r\n    @serialize\r\n    get rx() { return this._rotation.x; }\r\n    set rx(v) { this._rotation.x = v; }\r\n\r\n    /**\r\n     * Y轴旋转角度。\r\n     */\r\n    @serialize\r\n    get ry() { return this._rotation.y; }\r\n    set ry(v) { this._rotation.y = v; }\r\n\r\n    /**\r\n     * Z轴旋转角度。\r\n     */\r\n    @serialize\r\n    get rz() { return this._rotation.z; }\r\n    set rz(v) { this._rotation.z = v; }\r\n\r\n    /**\r\n     * X轴缩放。\r\n     */\r\n    @serialize\r\n    get sx() { return this._scale.x; }\r\n    set sx(v) { this._scale.x = v; }\r\n\r\n    /**\r\n     * Y轴缩放。\r\n     */\r\n    @serialize\r\n    get sy() { return this._scale.y; }\r\n    set sy(v) { this._scale.y = v; }\r\n\r\n    /**\r\n     * Z轴缩放。\r\n     */\r\n    @serialize\r\n    get sz() { return this._scale.z; }\r\n    set sz(v) { this._scale.z = v; }\r\n\r\n    /**\r\n     * 本地位移\r\n     */\r\n    @oav({ tooltip: '本地位移' })\r\n    get position() { return this._position; }\r\n    set position(v) { this._position.copy(v); }\r\n\r\n    /**\r\n     * 本地旋转\r\n     */\r\n    @oav({ tooltip: '本地旋转', component: 'OAVVector3', componentParam: { step: 0.001, stepScale: 30, stepDownup: 30 } })\r\n    get rotation() { return this._rotation; }\r\n    set rotation(v) { this._rotation.copy(v); }\r\n\r\n    /**\r\n     * 本地四元素旋转\r\n     */\r\n    get orientation()\r\n    {\r\n        this._orientation.fromMatrix(this.matrix);\r\n\r\n        return this._orientation;\r\n    }\r\n\r\n    set orientation(value)\r\n    {\r\n        const angles = value.toEulerAngles();\r\n        angles.scaleNumber(mathUtil.RAD2DEG);\r\n        this.rotation = angles;\r\n    }\r\n\r\n    /**\r\n     * 本地缩放\r\n     */\r\n    @oav({ tooltip: '本地缩放' })\r\n    get scale() { return this._scale; }\r\n    set scale(v) { this._scale.copy(v); }\r\n\r\n    /**\r\n     * 本地变换矩阵\r\n     */\r\n    get matrix()\r\n    {\r\n        if (this._matrixInvalid)\r\n        {\r\n            this._matrixInvalid = false;\r\n            this._updateMatrix();\r\n        }\r\n\r\n        return this._matrix;\r\n    }\r\n\r\n    set matrix(v)\r\n    {\r\n        v.toTRS(this._position, this._rotation, this._scale);\r\n        this._matrix.fromArray(v.elements);\r\n        this._matrixInvalid = false;\r\n    }\r\n\r\n    /**\r\n     * 本地旋转矩阵\r\n     */\r\n    get rotationMatrix()\r\n    {\r\n        if (this._rotationMatrixInvalid)\r\n        {\r\n            this._rotationMatrix.setRotation(this._rotation);\r\n            this._rotationMatrixInvalid = false;\r\n        }\r\n\r\n        return this._rotationMatrix;\r\n    }\r\n\r\n    moveForward(distance: number)\r\n    {\r\n        this.translateLocal(Vector3.Z_AXIS, distance);\r\n    }\r\n\r\n    moveBackward(distance: number)\r\n    {\r\n        this.translateLocal(Vector3.Z_AXIS, -distance);\r\n    }\r\n\r\n    moveLeft(distance: number)\r\n    {\r\n        this.translateLocal(Vector3.X_AXIS, -distance);\r\n    }\r\n\r\n    moveRight(distance: number)\r\n    {\r\n        this.translateLocal(Vector3.X_AXIS, distance);\r\n    }\r\n\r\n    moveUp(distance: number)\r\n    {\r\n        this.translateLocal(Vector3.Y_AXIS, distance);\r\n    }\r\n\r\n    moveDown(distance: number)\r\n    {\r\n        this.translateLocal(Vector3.Y_AXIS, -distance);\r\n    }\r\n\r\n    translate(axis: Vector3, distance: number)\r\n    {\r\n        const x = axis.x; const y = axis.y; const\r\n            z = axis.z;\r\n        const len = distance / Math.sqrt(x * x + y * y + z * z);\r\n        this.x += x * len;\r\n        this.y += y * len;\r\n        this.z += z * len;\r\n    }\r\n\r\n    translateLocal(axis: Vector3, distance: number)\r\n    {\r\n        const x = axis.x; const y = axis.y; const\r\n            z = axis.z;\r\n        const len = distance / Math.sqrt(x * x + y * y + z * z);\r\n        const matrix = this.matrix.clone();\r\n        matrix.prependTranslation(x * len, y * len, z * len);\r\n        const p = matrix.getPosition();\r\n        this.x = p.x;\r\n        this.y = p.y;\r\n        this.z = p.z;\r\n        this._invalidateSceneTransform();\r\n    }\r\n\r\n    pitch(angle: number)\r\n    {\r\n        this.rotate(Vector3.X_AXIS, angle);\r\n    }\r\n\r\n    yaw(angle: number)\r\n    {\r\n        this.rotate(Vector3.Y_AXIS, angle);\r\n    }\r\n\r\n    roll(angle: number)\r\n    {\r\n        this.rotate(Vector3.Z_AXIS, angle);\r\n    }\r\n\r\n    rotateTo(ax: number, ay: number, az: number)\r\n    {\r\n        this._rotation.set(ax, ay, az);\r\n    }\r\n\r\n    /**\r\n     * 绕指定轴旋转，不受位移与缩放影响\r\n     * @param    axis               旋转轴\r\n     * @param    angle              旋转角度\r\n     * @param    pivotPoint         旋转中心点\r\n     *\r\n     */\r\n    rotate(axis: Vector3, angle: number, pivotPoint?: Vector3): void\r\n    {\r\n        // 转换位移\r\n        const positionMatrix = Matrix4x4.fromPosition(this.position.x, this.position.y, this.position.z);\r\n        positionMatrix.appendRotation(axis, angle, pivotPoint);\r\n        this.position = positionMatrix.getPosition();\r\n        // 转换旋转\r\n        const rotationMatrix = Matrix4x4.fromRotation(this.rx, this.ry, this.rz);\r\n        rotationMatrix.appendRotation(axis, angle, pivotPoint);\r\n        const newrotation = rotationMatrix.toTRS()[1];\r\n        const v = Math.round((newrotation.x - this.rx) / 180);\r\n        if (v % 2 !== 0)\r\n        {\r\n            newrotation.x += 180;\r\n            newrotation.y = 180 - newrotation.y;\r\n            newrotation.z += 180;\r\n        }\r\n        //\r\n        const toRound = (a: number, b: number, c = 360) =>\r\n            Math.round((b - a) / c) * c + a;\r\n        newrotation.x = toRound(newrotation.x, this.rx);\r\n        newrotation.y = toRound(newrotation.y, this.ry);\r\n        newrotation.z = toRound(newrotation.z, this.rz);\r\n        this.rotation = newrotation;\r\n        this._invalidateSceneTransform();\r\n    }\r\n\r\n    /**\r\n     * 看向目标位置\r\n     *\r\n     * @param target    目标位置\r\n     * @param upAxis    向上朝向\r\n     */\r\n    lookAt(target: Vector3, upAxis?: Vector3)\r\n    {\r\n        this._updateMatrix();\r\n        this._matrix.lookAt(target, upAxis);\r\n        this._matrix.toTRS(this._position, this._rotation, this._scale);\r\n        this._matrixInvalid = false;\r\n    }\r\n\r\n    /**\r\n     * 将一个点从局部空间变换到世界空间的矩阵。\r\n     */\r\n    get localToWorldMatrix()\r\n    {\r\n        if (this._localToWorldMatrixInvalid)\r\n        {\r\n            this._localToWorldMatrixInvalid = false;\r\n            this._updateLocalToWorldMatrix();\r\n        }\r\n\r\n        return this._localToWorldMatrix;\r\n    }\r\n\r\n    set localToWorldMatrix(value)\r\n    {\r\n        value = value.clone();\r\n        this.parent && value.append(this.parent.worldToLocalMatrix);\r\n        this.matrix = value;\r\n    }\r\n\r\n    /**\r\n     * 本地转世界逆转置矩阵\r\n     */\r\n    get ITlocalToWorldMatrix()\r\n    {\r\n        if (this._ITlocalToWorldMatrixInvalid)\r\n        {\r\n            this._ITlocalToWorldMatrixInvalid = false;\r\n            this._ITlocalToWorldMatrix.copy(this.localToWorldMatrix);\r\n            this._ITlocalToWorldMatrix.invert().transpose();\r\n        }\r\n\r\n        return this._ITlocalToWorldMatrix;\r\n    }\r\n\r\n    /**\r\n     * 将一个点从世界空间转换为局部空间的矩阵。\r\n     */\r\n    get worldToLocalMatrix()\r\n    {\r\n        if (this._worldToLocalMatrixInvalid)\r\n        {\r\n            this._worldToLocalMatrixInvalid = false;\r\n            this._worldToLocalMatrix.copy(this.localToWorldMatrix).invert();\r\n        }\r\n\r\n        return this._worldToLocalMatrix;\r\n    }\r\n\r\n    get localToWorldRotationMatrix()\r\n    {\r\n        if (this._localToWorldRotationMatrixInvalid)\r\n        {\r\n            this._localToWorldRotationMatrix.copy(this.rotationMatrix);\r\n            if (this.parent)\r\n            { this._localToWorldRotationMatrix.append(this.parent.localToWorldRotationMatrix); }\r\n\r\n            this._localToWorldRotationMatrixInvalid = false;\r\n        }\r\n\r\n        return this._localToWorldRotationMatrix;\r\n    }\r\n\r\n    get worldToLocalRotationMatrix()\r\n    {\r\n        const mat = this.localToWorldRotationMatrix.clone();\r\n        mat.invert();\r\n\r\n        return mat;\r\n    }\r\n\r\n    /**\r\n     * 将方向从局部空间转换到世界空间。\r\n     *\r\n     * @param direction 局部空间方向\r\n     */\r\n    transformDirection(direction: Vector3)\r\n    {\r\n        direction = this.localToWolrdDirection(direction);\r\n\r\n        return direction;\r\n    }\r\n\r\n    /**\r\n     * 将方向从局部空间转换到世界空间。\r\n     *\r\n     * @param direction 局部空间方向\r\n     */\r\n    localToWolrdDirection(direction: Vector3)\r\n    {\r\n        if (!this.parent)\r\n        { return direction.clone(); }\r\n        const matrix = this.parent.localToWorldRotationMatrix;\r\n        direction = matrix.transformPoint3(direction);\r\n\r\n        return direction;\r\n    }\r\n\r\n    /**\r\n     * 将包围盒从局部空间转换到世界空间\r\n     *\r\n     * @param box 变换前的包围盒\r\n     * @param out 变换之后的包围盒\r\n     *\r\n     * @returns 变换之后的包围盒\r\n     */\r\n    localToWolrdBox(box: Box3, out = new Box3())\r\n    {\r\n        if (!this.parent)\r\n        { return out.copy(box); }\r\n        const matrix = this.parent.localToWorldMatrix;\r\n        box.applyMatrixTo(matrix, out);\r\n\r\n        return out;\r\n    }\r\n\r\n    /**\r\n     * 将位置从局部空间转换为世界空间。\r\n     *\r\n     * @param position 局部空间位置\r\n     */\r\n    transformPoint(position: Vector3)\r\n    {\r\n        position = this.localToWorldPoint(position);\r\n\r\n        return position;\r\n    }\r\n\r\n    /**\r\n     * 将位置从局部空间转换为世界空间。\r\n     *\r\n     * @param position 局部空间位置\r\n     */\r\n    localToWorldPoint(position: Vector3)\r\n    {\r\n        if (!this.parent)\r\n        { return position.clone(); }\r\n        position = this.parent.localToWorldMatrix.transformPoint3(position);\r\n\r\n        return position;\r\n    }\r\n\r\n    /**\r\n     * 将向量从局部空间变换到世界空间。\r\n     *\r\n     * @param vector 局部空间向量\r\n     */\r\n    transformVector(vector: Vector3)\r\n    {\r\n        vector = this.localToWorldVector(vector);\r\n\r\n        return vector;\r\n    }\r\n\r\n    /**\r\n     * 将向量从局部空间变换到世界空间。\r\n     *\r\n     * @param vector 局部空间位置\r\n     */\r\n    localToWorldVector(vector: Vector3)\r\n    {\r\n        if (!this.parent)\r\n        { return vector.clone(); }\r\n        const matrix = this.parent.localToWorldMatrix;\r\n        vector = matrix.transformVector3(vector);\r\n\r\n        return vector;\r\n    }\r\n\r\n    /**\r\n     * Transforms a direction from world space to local space. The opposite of Transform.TransformDirection.\r\n     *\r\n     * 将一个方向从世界空间转换到局部空间。\r\n     */\r\n    inverseTransformDirection(direction: Vector3)\r\n    {\r\n        direction = this.worldToLocalDirection(direction);\r\n\r\n        return direction;\r\n    }\r\n\r\n    /**\r\n     * 将一个方向从世界空间转换到局部空间。\r\n     */\r\n    worldToLocalDirection(direction: Vector3)\r\n    {\r\n        if (!this.parent)\r\n        { return direction.clone(); }\r\n        const matrix = this.parent.localToWorldRotationMatrix.clone().invert();\r\n        direction = matrix.transformPoint3(direction);\r\n\r\n        return direction;\r\n    }\r\n\r\n    /**\r\n     * 将位置从世界空间转换为局部空间。\r\n     *\r\n     * @param position 世界坐标系中位置\r\n     */\r\n    worldToLocalPoint(position: Vector3, out = new Vector3())\r\n    {\r\n        if (!this.parent)\r\n        { return out.copy(position); }\r\n        position = this.parent.worldToLocalMatrix.transformPoint3(position, out);\r\n\r\n        return position;\r\n    }\r\n\r\n    /**\r\n     * 将向量从世界空间转换为局部空间\r\n     *\r\n     * @param vector 世界坐标系中向量\r\n     */\r\n    worldToLocalVector(vector: Vector3)\r\n    {\r\n        if (!this.parent)\r\n        { return vector.clone(); }\r\n        vector = this.parent.worldToLocalMatrix.transformVector3(vector);\r\n\r\n        return vector;\r\n    }\r\n\r\n    /**\r\n     * 将 Ray3 从世界空间转换为局部空间。\r\n     *\r\n     * @param worldRay 世界空间射线。\r\n     * @param localRay 局部空间射线。\r\n     */\r\n    rayWorldToLocal(worldRay: Ray3, localRay = new Ray3())\r\n    {\r\n        this.worldToLocalMatrix.transformRay(worldRay, localRay);\r\n\r\n        return localRay;\r\n    }\r\n\r\n    beforeRender(renderAtomic: RenderAtomic, _scene: Scene, _camera: Camera)\r\n    {\r\n        Object.assign(renderAtomic.uniforms, this._renderAtomic.uniforms);\r\n    }\r\n\r\n    private readonly _position = new Vector3();\r\n    private readonly _rotation = new Vector3();\r\n    private readonly _orientation = new Quaternion();\r\n    private readonly _scale = new Vector3(1, 1, 1);\r\n\r\n    protected readonly _matrix = new Matrix4x4();\r\n    protected _matrixInvalid = false;\r\n\r\n    protected readonly _rotationMatrix = new Matrix4x4();\r\n    protected _rotationMatrixInvalid = false;\r\n\r\n    protected readonly _localToWorldMatrix = new Matrix4x4();\r\n    protected _localToWorldMatrixInvalid = false;\r\n\r\n    protected readonly _ITlocalToWorldMatrix = new Matrix4x4();\r\n    protected _ITlocalToWorldMatrixInvalid = false;\r\n\r\n    protected readonly _worldToLocalMatrix = new Matrix4x4();\r\n    protected _worldToLocalMatrixInvalid = false;\r\n\r\n    protected readonly _localToWorldRotationMatrix = new Matrix4x4();\r\n    protected _localToWorldRotationMatrixInvalid = false;\r\n\r\n    private _renderAtomic = new RenderAtomic();\r\n\r\n    private _positionChanged(newValue: number, oldValue: number, _object: Vector3, _property: string)\r\n    {\r\n        if (!mathUtil.equals(newValue, oldValue))\r\n        { this._invalidateTransform(); }\r\n    }\r\n\r\n    private _rotationChanged(newValue: number, oldValue: number, _object: Vector3, _property: string)\r\n    {\r\n        if (!mathUtil.equals(newValue, oldValue))\r\n        {\r\n            this._invalidateTransform();\r\n            this._rotationMatrixInvalid = true;\r\n        }\r\n    }\r\n\r\n    private _scaleChanged(newValue: number, oldValue: number, _object: Vector3, _property: string)\r\n    {\r\n        if (!mathUtil.equals(newValue, oldValue))\r\n        { this._invalidateTransform(); }\r\n    }\r\n\r\n    private _invalidateTransform()\r\n    {\r\n        if (this._matrixInvalid) return;\r\n        this._matrixInvalid = true;\r\n\r\n        this.emit('transformChanged', this);\r\n        this._invalidateSceneTransform();\r\n    }\r\n\r\n    private _invalidateSceneTransform()\r\n    {\r\n        if (this._localToWorldMatrixInvalid) return;\r\n\r\n        this._localToWorldMatrixInvalid = true;\r\n        this._worldToLocalMatrixInvalid = true;\r\n        this._ITlocalToWorldMatrixInvalid = true;\r\n        this._localToWorldRotationMatrixInvalid = true;\r\n\r\n        this.emit('scenetransformChanged', this);\r\n        //\r\n        if (this.gameObject)\r\n        {\r\n            for (let i = 0, n = this.gameObject.numChildren; i < n; i++)\r\n            {\r\n                this.gameObject.getChildAt(i).transform._invalidateSceneTransform();\r\n            }\r\n        }\r\n    }\r\n\r\n    private _updateMatrix()\r\n    {\r\n        this._matrix.fromTRS(this._position, this._rotation, this._scale);\r\n    }\r\n\r\n    private _updateLocalToWorldMatrix()\r\n    {\r\n        this._localToWorldMatrix.copy(this.matrix);\r\n        if (this.parent)\r\n        { this._localToWorldMatrix.append(this.parent.localToWorldMatrix); }\r\n        this.emit('updateLocalToWorldMatrix', this);\r\n        console.assert(!isNaN(this._localToWorldMatrix.elements[0]));\r\n    }\r\n}\r\n","import { oav } from '@feng3d/objectview';\r\nimport { Constructor, gPartial, IDisposable } from '@feng3d/polyfill';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { AssetType } from '../assets/AssetType';\r\nimport { Component, Components } from '../component/Component';\r\nimport { Geometry } from '../geometry/Geometry';\r\nimport { createNodeMenu } from '../menu/CreateNodeMenu';\r\nimport { Scene } from '../scene/Scene';\r\nimport { BoundingBox } from './BoundingBox';\r\nimport { Feng3dObject, Feng3dObjectEventMap } from './Feng3dObject';\r\nimport { MouseEventMap } from './Mouse3DManager';\r\nimport { Renderable } from './Renderable';\r\nimport { ScriptComponent } from './ScriptComponent';\r\nimport { Transform } from './Transform';\r\n\r\ndeclare global\r\n{\r\n    interface MixinsGameObjectEventMap { }\r\n    interface MixinsPrimitiveGameObject { }\r\n    interface MixinsGameObject { }\r\n}\r\n\r\nexport interface GameObjectEventMap extends MixinsGameObjectEventMap, MouseEventMap, Feng3dObjectEventMap\r\n{\r\n    /**\r\n     * 添加子组件事件\r\n     */\r\n    addComponent: { gameobject: GameObject, component: Component };\r\n\r\n    /**\r\n     * 移除子组件事件\r\n     */\r\n    removeComponent: { gameobject: GameObject, component: Component };\r\n\r\n    /**\r\n     * 添加了子对象，当child被添加到parent中时派发冒泡事件\r\n     */\r\n    addChild: { parent: GameObject, child: GameObject }\r\n    /**\r\n     * 删除了子对象，当child被parent移除时派发冒泡事件\r\n     */\r\n    removeChild: { parent: GameObject, child: GameObject };\r\n\r\n    /**\r\n     * 自身被添加到父对象中事件\r\n     */\r\n    added: { parent: GameObject };\r\n\r\n    /**\r\n     * 自身从父对象中移除事件\r\n     */\r\n    removed: { parent: GameObject };\r\n\r\n    /**\r\n     * 当GameObject的scene属性被设置是由Scene派发\r\n     */\r\n    addedToScene: GameObject;\r\n\r\n    /**\r\n     * 当GameObject的scene属性被清空时由Scene派发\r\n     */\r\n    removedFromScene: GameObject;\r\n\r\n    /**\r\n     * 包围盒失效\r\n     */\r\n    boundsInvalid: Geometry;\r\n\r\n    /**\r\n     * 刷新界面\r\n     */\r\n    refreshView: any;\r\n}\r\n\r\nexport interface GameObject extends MixinsGameObject { }\r\n\r\n/**\r\n * 游戏对象，场景唯一存在的对象类型\r\n */\r\nexport class GameObject extends Feng3dObject<GameObjectEventMap> implements IDisposable\r\n{\r\n    __class__: 'feng3d.GameObject';\r\n\r\n    assetType = AssetType.gameobject;\r\n\r\n    /**\r\n     * 名称\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVGameObjectName' })\r\n    declare name: string;\r\n\r\n    /**\r\n     * The local active state of this GameObject.\r\n     *\r\n     * This returns the local active state of this GameObject. Note that a GameObject may be inactive because a parent is not active, even if this returns true. This state will then be used once all parents are active. Use GameObject.activeInHierarchy if you want to check if the GameObject is actually treated as active in the Scene.\r\n     */\r\n    @serialize\r\n    get activeSelf()\r\n    {\r\n        return this._activeSelf;\r\n    }\r\n    set activeSelf(v)\r\n    {\r\n        if (this._activeSelf === v) return;\r\n        this._activeSelf = v;\r\n        this._invalidateActiveInHierarchy();\r\n    }\r\n    private _activeSelf = true;\r\n\r\n    /**\r\n     * Defines whether the GameObject is active in the Scene.\r\n     *\r\n     * This lets you know whether a GameObject is active in the game. That is the case if its GameObject.activeSelf property is enabled, as well as that of all its parents.\r\n     */\r\n    get activeInHierarchy()\r\n    {\r\n        if (this._activeInHierarchyInvalid)\r\n        {\r\n            this._updateActiveInHierarchy();\r\n            this._activeInHierarchyInvalid = false;\r\n        }\r\n\r\n        return this._activeInHierarchy;\r\n    }\r\n\r\n    /**\r\n     * The tag of this game object.\r\n     */\r\n    @serialize\r\n    tag: string;\r\n\r\n    /**\r\n     * 自身以及子对象是否支持鼠标拾取\r\n     */\r\n    @serialize\r\n    mouseEnabled = true;\r\n\r\n    /**\r\n     * 组件列表\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVComponentList' })\r\n    get components()\r\n    {\r\n        return this._components.concat();\r\n    }\r\n\r\n    set components(value)\r\n    {\r\n        if (!value) return;\r\n        for (let i = 0, n = value.length; i < n; i++)\r\n        {\r\n            const component = value[i];\r\n            if (!component) continue;\r\n            if (component.single) this.removeComponentsByType(<any>component.constructor);\r\n            this.addComponentAt(value[i], this.numComponents);\r\n        }\r\n    }\r\n    protected _components: Components[] = [];\r\n\r\n    /**\r\n     * 子组件个数\r\n     */\r\n    get numComponents()\r\n    {\r\n        return this._components.length;\r\n    }\r\n\r\n    /**\r\n     * 预设资源编号\r\n     */\r\n    @serialize\r\n    prefabId: string;\r\n\r\n    /**\r\n     * 资源编号\r\n     */\r\n    @serialize\r\n    assetId: string;\r\n\r\n    // ------------------------------------------\r\n    // Variables\r\n    // ------------------------------------------\r\n\r\n    /**\r\n     * The Transform attached to this GameObject.\r\n     */\r\n    get transform()\r\n    {\r\n        const transform = this.getComponent(Transform);\r\n\r\n        return transform;\r\n    }\r\n\r\n    /**\r\n     * 轴对称包围盒\r\n     */\r\n    get boundingBox()\r\n    {\r\n        if (!this._boundingBox)\r\n        {\r\n            this._boundingBox = new BoundingBox(this);\r\n        }\r\n\r\n        return this._boundingBox;\r\n    }\r\n    private _boundingBox: BoundingBox;\r\n\r\n    get scene()\r\n    {\r\n        return this._scene;\r\n    }\r\n\r\n    protected _parent: GameObject;\r\n    protected _children: GameObject[] = [];\r\n\r\n    get parent()\r\n    {\r\n        return this._parent;\r\n    }\r\n\r\n    /**\r\n     * 子对象\r\n     */\r\n    @serialize\r\n    get children()\r\n    {\r\n        return this._children.concat();\r\n    }\r\n\r\n    set children(value)\r\n    {\r\n        if (!value) return;\r\n        for (let i = this._children.length - 1; i >= 0; i--)\r\n        {\r\n            this.removeChildAt(i);\r\n        }\r\n        for (let i = 0; i < value.length; i++)\r\n        {\r\n            this.addChild(value[i]);\r\n        }\r\n    }\r\n\r\n    get numChildren()\r\n    {\r\n        return this._children.length;\r\n    }\r\n\r\n    // ------------------------------------------\r\n    // Functions\r\n    // ------------------------------------------\r\n    /**\r\n     * 构建3D对象\r\n     */\r\n    constructor()\r\n    {\r\n        super();\r\n        this.name = 'GameObject';\r\n        this.addComponent(Transform);\r\n    }\r\n\r\n    /**\r\n     * Activates/Deactivates the GameObject, depending on the given true or false value.\r\n     *\r\n     * A GameObject may be inactive because a parent is not active. In that case, calling SetActive will not activate it, but only set the local state of the GameObject, which you can check using GameObject.activeSelf. Unity can then use this state when all parents become active.\r\n     *\r\n     * @param value Activate or deactivate the object, where true activates the GameObject and false deactivates the GameObject.\r\n     */\r\n    setActive(value: boolean)\r\n    {\r\n        this.activeSelf = value;\r\n    }\r\n\r\n    /**\r\n     * Adds a component class of type componentType to the game object.\r\n     *\r\n     * @param Type A component class of type.\r\n     * @returns The component that is added.\r\n     */\r\n    /**\r\n     * 添加一个类型为`type`的组件到游戏对象。\r\n     *\r\n     * @param Type 组件类定义。\r\n     * @returns 被添加的组件。\r\n     */\r\n    addComponent<T extends Component>(Type: Constructor<T>): T\r\n    {\r\n        let component = this.getComponent(Type);\r\n        if (component && Component.isSingleComponent(Type))\r\n        {\r\n            // alert(`The compnent ${param[\"name\"]} can't be added because ${this.name} already contains the same component.`);\r\n            return component;\r\n        }\r\n        const dependencies = Component.getDependencies(Type);\r\n        // 先添加依赖\r\n        dependencies.forEach((dependency) =>\r\n        {\r\n            this.addComponent(dependency);\r\n        });\r\n        //\r\n        component = new Type();\r\n        this.addComponentAt(component, this._components.length);\r\n\r\n        return component;\r\n    }\r\n\r\n    /**\r\n     * Returns the component of Type type if the game object has one attached, null if it doesn't.\r\n     *\r\n     * Using gameObject.GetComponent will return the first component that is found. If you expect there to be more than one component of the\r\n     * same type, use gameObject.GetComponents instead, and cycle through the returned components testing for some unique property.\r\n     *\r\n     * @param type The type of Component to retrieve.\r\n     * @returns The component to retrieve.\r\n     */\r\n    /**\r\n     * 返回游戏对象附加的一个指定类型的组件，如果没有，则返回 null。\r\n     *\r\n     * 使用 gameObject.GetComponent 将返回找到的第一个组件。如果您希望有多个相同类型的组件，请改用 gameObject.GetComponents，并循环通过返回的组件测试某些唯一属性。\r\n     *\r\n     * @param type 要检索的组件类型。\r\n     * @returns 要检索的组件。\r\n     */\r\n    getComponent<T extends Component>(type: Constructor<T>): T\r\n    {\r\n        for (let i = 0; i < this._components.length; i++)\r\n        {\r\n            if (this._components[i] instanceof type)\r\n            {\r\n                return this._components[i] as T;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Returns the component of Type type in the GameObject or any of its children using depth first search.\r\n     *\r\n     * @param type The type of Component to retrieve.\r\n     * @param includeInactive Should Components on inactive GameObjects be included in the found set?\r\n     * @returns A component of the matching type, if found.\r\n     */\r\n    /**\r\n     * 使用深度优先搜索返回 GameObject 或其任何子项中的 Type 组件。\r\n     *\r\n     * @param type 要检索的组件类型。\r\n     * @param includeInactive 是否包含不活跃组件。\r\n     * @returns 匹配类型的组件（如果找到）。\r\n     */\r\n    getComponentInChildren<T extends Component>(type: Constructor<T>, includeInactive = false): T\r\n    {\r\n        const component = this.getComponent(type);\r\n        if (component)\r\n        {\r\n            return component;\r\n        }\r\n\r\n        for (let i = 0; i < this.numChildren; i++)\r\n        {\r\n            const gameObject = this.children[i];\r\n            if (!includeInactive && !gameObject.activeSelf) continue;\r\n            const compnent = gameObject.getComponentInChildren(type, includeInactive);\r\n            if (compnent)\r\n            {\r\n                return compnent;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Retrieves the component of Type type in the GameObject or any of its parents.\r\n     *\r\n     * This method recurses upwards until it finds a GameObject with a matching component. Only components on active GameObjects are matched.\r\n     *\r\n     * @param type Type of component to find.\r\n     * @param includeInactive Should Components on inactive GameObjects be included in the found set?\r\n     * @returns Returns a component if a component matching the type is found. Returns null otherwise.\r\n     */\r\n    /**\r\n     * 检索GameObject或其任何父项type中的 Type 组件。\r\n     *\r\n     * 此方法向上递归，直到找到具有匹配组件的 GameObject。仅匹配活动游戏对象上的组件。\r\n     *\r\n     * @param type 要查找的组件类型。\r\n     * @param includeInactive 是否包含不活跃组件。\r\n     * @returns 如果找到与类型匹配的组件，则返回一个组件。否则返回 null。\r\n     */\r\n    getComponentInParent<T extends Component>(type: Constructor<T>, includeInactive = false): T\r\n    {\r\n        if (includeInactive || this.activeSelf)\r\n        {\r\n            const component = this.getComponent(type);\r\n            if (component)\r\n            {\r\n                return component;\r\n            }\r\n        }\r\n\r\n        if (this.parent)\r\n        {\r\n            const component = this.parent.getComponentInParent(type, includeInactive);\r\n            if (component)\r\n            {\r\n                return component;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Returns all components of Type `type` in the GameObject.\r\n     *\r\n     * @param type The type of component to retrieve.\r\n     * @param results List to receive the results.\r\n     * @returns all components of Type type in the GameObject.\r\n     */\r\n    /**\r\n     * 返回GameObject中指定类型的所有组件。\r\n     *\r\n     * @param type 要检索的组件类型。\r\n     * @param results 列出接收找到的组件。\r\n     * @returns GameObject中指定类型的所有组件。\r\n     */\r\n    getComponents<T extends Component = Component>(type?: Constructor<T>, results: T[] = []): T[]\r\n    {\r\n        for (let i = 0; i < this._components.length; i++)\r\n        {\r\n            const component = this._components[i];\r\n            if (!type || component instanceof type)\r\n            {\r\n                results.push(component as any);\r\n            }\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    /**\r\n     * Returns all components of Type type in the GameObject or any of its children children using depth first search. Works recursively.\r\n     *\r\n     * Unity searches for components recursively on child GameObjects. This means that it also includes all the child GameObjects of the target GameObject, and all subsequent child GameObjects.\r\n     *\r\n     * @param type The type of Component to retrieve.\r\n     * @param includeInactive Should Components on inactive GameObjects be included in the found set?\r\n     * @param results List to receive found Components.\r\n     * @returns All found Components.\r\n     */\r\n    /**\r\n     * 使用深度优先搜索返回 GameObject 或其任何子子项中 Type 的所有组件。递归工作。\r\n     *\r\n     * Unity 在子游戏对象上递归搜索组件。这意味着它还包括目标 GameObject 的所有子 GameObject，以及所有后续子 GameObject。\r\n     *\r\n     * @param type 要检索的组件类型。\r\n     * @param includeInactive 非活动游戏对象上的组件是否应该包含在搜索结果中？\r\n     * @param results 列出接收找到的组件。\r\n     * @returns 所有找到的组件。\r\n     */\r\n    getComponentsInChildren<T extends Component>(type?: Constructor<T>, includeInactive = false, results: T[] = []): T[]\r\n    {\r\n        this.getComponents(type, results);\r\n\r\n        for (let i = 0; i < this.children.length; i++)\r\n        {\r\n            const gameObject = this.children[i];\r\n            if (!includeInactive && !gameObject.activeSelf) continue;\r\n            gameObject.getComponentsInChildren(type, includeInactive, results);\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    /**\r\n     * Returns all components of Type type in the GameObject or any of its parents.\r\n     *\r\n     * @param type The type of Component to retrieve.\r\n     * @param includeInactive Should inactive Components be included in the found set?\r\n     * @param results List holding the found Components.\r\n     * @returns All components of Type type in the GameObject or any of its parents.\r\n     */\r\n    /**\r\n     * 返回GameObject或其任何父级中指定的所有组件。\r\n     *\r\n     * @param type 要检索的组件类型。\r\n     * @param includeInactive 非活动组件是否应该包含在搜索结果中？\r\n     * @param results 列出找到的组件。\r\n     * @returns GameObject或其任何父级中指定的所有组件。\r\n     */\r\n    getComponentsInParent<T extends Component>(type?: Constructor<T>, includeInactive = false, results: T[] = []): T[]\r\n    {\r\n        if (includeInactive || this.activeSelf)\r\n        {\r\n            this.getComponents(type, results);\r\n        }\r\n\r\n        if (this.parent)\r\n        {\r\n            this.parent.getComponentsInParent(type, includeInactive, results);\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    /**\r\n     * 获取指定位置索引的子组件\r\n     * @param index\t\t\t位置索引\r\n     * @return\t\t\t\t子组件\r\n     */\r\n    getComponentAt(index: number): Component\r\n    {\r\n        console.assert(index < this.numComponents, '给出索引超出范围');\r\n\r\n        return this._components[index];\r\n    }\r\n\r\n    /**\r\n     * 设置子组件的位置\r\n     * @param component\t\t\t\t子组件\r\n     * @param index\t\t\t\t位置索引\r\n     */\r\n    setComponentIndex(component: Components, index: number): void\r\n    {\r\n        console.assert(index >= 0 && index < this.numComponents, '给出索引超出范围');\r\n\r\n        const oldIndex = this._components.indexOf(component);\r\n        console.assert(oldIndex >= 0 && oldIndex < this.numComponents, '子组件不在容器内');\r\n\r\n        this._components.splice(oldIndex, 1);\r\n        this._components.splice(index, 0, component);\r\n    }\r\n\r\n    /**\r\n     * 设置组件到指定位置\r\n     * @param component\t\t被设置的组件\r\n     * @param index\t\t\t索引\r\n     */\r\n    setComponentAt(component: Components, index: number)\r\n    {\r\n        if (this._components[index])\r\n        {\r\n            this.removeComponentAt(index);\r\n        }\r\n        this.addComponentAt(component, index);\r\n    }\r\n\r\n    /**\r\n     * 移除组件\r\n     * @param component 被移除组件\r\n     */\r\n    removeComponent(component: Components): void\r\n    {\r\n        console.assert(this.hasComponent(component), '只能移除在容器中的组件');\r\n\r\n        const index = this.getComponentIndex(component);\r\n        this.removeComponentAt(index);\r\n    }\r\n\r\n    /**\r\n     * 获取组件在容器的索引位置\r\n     * @param component\t\t\t查询的组件\r\n     * @return\t\t\t\t    组件在容器的索引位置\r\n     */\r\n    getComponentIndex(component: Components): number\r\n    {\r\n        console.assert(this._components.indexOf(component) !== -1, '组件不在容器中');\r\n\r\n        const index = this._components.indexOf(component);\r\n\r\n        return index;\r\n    }\r\n\r\n    /**\r\n     * 移除组件\r\n     * @param index\t\t要删除的 Component 的子索引。\r\n     */\r\n    removeComponentAt(index: number): Component\r\n    {\r\n        console.assert(index >= 0 && index < this.numComponents, '给出索引超出范围');\r\n\r\n        const component: Component = this._components.splice(index, 1)[0];\r\n        // 派发移除组件事件\r\n        this.emit('removeComponent', { component, gameobject: this as any }, true);\r\n        component.dispose();\r\n\r\n        return component;\r\n    }\r\n\r\n    /**\r\n     * 交换子组件位置\r\n     * @param index1\t\t第一个子组件的索引位置\r\n     * @param index2\t\t第二个子组件的索引位置\r\n     */\r\n    swapComponentsAt(index1: number, index2: number): void\r\n    {\r\n        console.assert(index1 >= 0 && index1 < this.numComponents, '第一个子组件的索引位置超出范围');\r\n        console.assert(index2 >= 0 && index2 < this.numComponents, '第二个子组件的索引位置超出范围');\r\n\r\n        const temp: Components = this._components[index1];\r\n        this._components[index1] = this._components[index2];\r\n        this._components[index2] = temp;\r\n    }\r\n\r\n    /**\r\n     * 交换子组件位置\r\n     * @param a\t\t第一个子组件\r\n     * @param b\t\t第二个子组件\r\n     */\r\n    swapComponents(a: Components, b: Components): void\r\n    {\r\n        console.assert(this.hasComponent(a), '第一个子组件不在容器中');\r\n        console.assert(this.hasComponent(b), '第二个子组件不在容器中');\r\n\r\n        this.swapComponentsAt(this.getComponentIndex(a), this.getComponentIndex(b));\r\n    }\r\n\r\n    /**\r\n     * 移除指定类型组件\r\n     * @param type 组件类型\r\n     */\r\n    removeComponentsByType<T extends Components>(type: Constructor<T>)\r\n    {\r\n        const removeComponents: T[] = [];\r\n        for (let i = this._components.length - 1; i >= 0; i--)\r\n        {\r\n            if (this._components[i].constructor === type)\r\n            { removeComponents.push(this.removeComponentAt(i) as T); }\r\n        }\r\n\r\n        return removeComponents;\r\n    }\r\n\r\n    /**\r\n     * 判断是否拥有组件\r\n     * @param com\t被检测的组件\r\n     * @return\t\ttrue：拥有该组件；false：不拥有该组件。\r\n     */\r\n    private hasComponent(com: Components): boolean\r\n    {\r\n        return this._components.indexOf(com) !== -1;\r\n    }\r\n\r\n    /**\r\n     * 添加组件到指定位置\r\n     * @param component\t\t被添加的组件\r\n     * @param index\t\t\t插入的位置\r\n     */\r\n    protected addComponentAt(component: Components, index: number): void\r\n    {\r\n        if (!component)\r\n        { return; }\r\n        console.assert(index >= 0 && index <= this.numComponents, '给出索引超出范围');\r\n\r\n        if (this.hasComponent(component))\r\n        {\r\n            index = Math.min(index, this._components.length - 1);\r\n            this.setComponentIndex(component, index);\r\n\r\n            return;\r\n        }\r\n        // 组件唯一时移除同类型的组件\r\n        if (component.single)\r\n        { this.removeComponentsByType(<Constructor<Components>>component.constructor); }\r\n\r\n        this._components.splice(index, 0, component);\r\n        component.setGameObject(this as any);\r\n        component.init();\r\n        // 派发添加组件事件\r\n        this.emit('addComponent', { component, gameobject: this as any }, true);\r\n    }\r\n\r\n    /**\r\n     * 根据名称查找对象\r\n     *\r\n     * @param name 对象名称\r\n     */\r\n    find(name: string): GameObject\r\n    {\r\n        if (this.name === name)\r\n        { return this; }\r\n        for (let i = 0; i < this._children.length; i++)\r\n        {\r\n            const target = this._children[i].find(name);\r\n            if (target)\r\n            { return target; }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * 添加脚本\r\n     * @param script   脚本路径\r\n     */\r\n    addScript(scriptName: string)\r\n    {\r\n        const scriptComponent = new ScriptComponent();\r\n        scriptComponent.scriptName = scriptName;\r\n        this.addComponentAt(scriptComponent, this._components.length);\r\n\r\n        return scriptComponent;\r\n    }\r\n\r\n    /**\r\n     * 是否包含指定对象\r\n     *\r\n     * @param child 可能的子孙对象\r\n     */\r\n    contains(child: GameObject)\r\n    {\r\n        let checkitem = child;\r\n        do\r\n        {\r\n            if (checkitem === this)\r\n            { return true; }\r\n            checkitem = checkitem.parent;\r\n        } while (checkitem);\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * 添加子对象\r\n     *\r\n     * @param child 子对象\r\n     */\r\n    addChild(child: GameObject)\r\n    {\r\n        if (!child)\r\n        { return; }\r\n        if (child.parent === this)\r\n        {\r\n            // 把子对象移动到最后\r\n            const childIndex = this._children.indexOf(child);\r\n            if (childIndex !== -1) this._children.splice(childIndex, 1);\r\n            this._children.push(child);\r\n        }\r\n        else\r\n        {\r\n            if (child.contains(this))\r\n            {\r\n                console.error('无法添加到自身中!');\r\n\r\n                return;\r\n            }\r\n            if (child._parent) child._parent.removeChild(child);\r\n            child._setParent(this);\r\n            this._children.push(child);\r\n            child.emit('added', { parent: this });\r\n            this.emit('addChild', { child, parent: this }, true);\r\n        }\r\n\r\n        return child;\r\n    }\r\n\r\n    /**\r\n     * 添加子对象\r\n     *\r\n     * @param childarray 子对象\r\n     */\r\n    addChildren(...childarray: GameObject[])\r\n    {\r\n        for (const childKey in childarray)\r\n        {\r\n            const child: GameObject = childarray[childKey];\r\n            this.addChild(child);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 移除自身\r\n     */\r\n    remove()\r\n    {\r\n        if (this.parent) this.parent.removeChild(this);\r\n    }\r\n\r\n    /**\r\n     * 移除所有子对象\r\n     */\r\n    removeChildren()\r\n    {\r\n        for (let i = this.numChildren - 1; i >= 0; i--)\r\n        {\r\n            this.removeChildAt(i);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 移除子对象\r\n     *\r\n     * @param child 子对象\r\n     */\r\n    removeChild(child: GameObject)\r\n    {\r\n        if (!child) return;\r\n        const childIndex = this._children.indexOf(child);\r\n        if (childIndex !== -1) this.removeChildInternal(childIndex, child);\r\n    }\r\n\r\n    /**\r\n     * 删除指定位置的子对象\r\n     *\r\n     * @param index 需要删除子对象的所有\r\n     */\r\n    removeChildAt(index: number)\r\n    {\r\n        const child = this._children[index];\r\n\r\n        return this.removeChildInternal(index, child);\r\n    }\r\n\r\n    /**\r\n     * 获取指定位置的子对象\r\n     *\r\n     * @param index\r\n     */\r\n    getChildAt(index: number)\r\n    {\r\n        return this._children[index];\r\n    }\r\n\r\n    /**\r\n     * 获取子对象列表（备份）\r\n     */\r\n    getChildren()\r\n    {\r\n        return this._children.concat();\r\n    }\r\n\r\n    private removeChildInternal(childIndex: number, child: GameObject)\r\n    {\r\n        this._children.splice(childIndex, 1);\r\n        child._setParent(null);\r\n\r\n        child.emit('removed', { parent: this as any });\r\n        this.emit('removeChild', { child, parent: this as any }, true);\r\n    }\r\n\r\n    /**\r\n     * 销毁\r\n     */\r\n    dispose()\r\n    {\r\n        if (this.parent)\r\n        { this.parent.removeChild(this); }\r\n        for (let i = this._children.length - 1; i >= 0; i--)\r\n        {\r\n            this.removeChildAt(i);\r\n        }\r\n        for (let i = this._components.length - 1; i >= 0; i--)\r\n        {\r\n            this.removeComponentAt(i);\r\n        }\r\n        super.dispose();\r\n    }\r\n\r\n    disposeWithChildren()\r\n    {\r\n        this.dispose();\r\n        while (this.numChildren > 0)\r\n        { this.getChildAt(0).dispose(); }\r\n    }\r\n\r\n    /**\r\n     * 是否加载完成\r\n     */\r\n    get isSelfLoaded()\r\n    {\r\n        const model = this.getComponent(Renderable);\r\n        if (model) return model.isLoaded;\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 已加载完成或者加载完成时立即调用\r\n     * @param callback 完成回调\r\n     */\r\n    onSelfLoadCompleted(callback: () => void)\r\n    {\r\n        if (this.isSelfLoaded)\r\n        {\r\n            callback();\r\n\r\n            return;\r\n        }\r\n        const model = this.getComponent(Renderable);\r\n        if (model)\r\n        {\r\n            model.onLoadCompleted(callback);\r\n        }\r\n        else callback();\r\n    }\r\n\r\n    /**\r\n     * 是否加载完成\r\n     */\r\n    get isLoaded()\r\n    {\r\n        if (!this.isSelfLoaded) return false;\r\n        for (let i = 0; i < this.children.length; i++)\r\n        {\r\n            const element = this.children[i];\r\n            if (!element.isLoaded) return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 已加载完成或者加载完成时立即调用\r\n     * @param callback 完成回调\r\n     */\r\n    onLoadCompleted(callback: () => void)\r\n    {\r\n        let loadingNum = 0;\r\n        if (!this.isSelfLoaded)\r\n        {\r\n            loadingNum++;\r\n            this.onSelfLoadCompleted(() =>\r\n            {\r\n                loadingNum--;\r\n                if (loadingNum === 0) callback();\r\n            });\r\n        }\r\n        for (let i = 0; i < this.children.length; i++)\r\n        {\r\n            const element = this.children[i];\r\n            if (!element.isLoaded)\r\n            {\r\n                loadingNum++;\r\n                // eslint-disable-next-line no-loop-func\r\n                element.onLoadCompleted(() =>\r\n                {\r\n                    loadingNum--;\r\n                    if (loadingNum === 0) callback();\r\n                });\r\n            }\r\n        }\r\n        if (loadingNum === 0) callback();\r\n    }\r\n\r\n    /**\r\n     * 查找指定名称的游戏对象\r\n     *\r\n     * @param name\r\n     */\r\n    static find(name: string)\r\n    {\r\n        const gameobjects = Feng3dObject.getObjects(GameObject);\r\n        const result = gameobjects.filter((v) => !v.disposed && (v.name === name));\r\n\r\n        return result[0];\r\n    }\r\n\r\n    protected _scene: Scene;\r\n    protected _activeInHierarchy = false;\r\n    protected _activeInHierarchyInvalid = true;\r\n\r\n    protected _updateActiveInHierarchy()\r\n    {\r\n        let activeSelf = this.activeSelf;\r\n        if (this.parent)\r\n        {\r\n            activeSelf = activeSelf && this.parent.activeInHierarchy;\r\n        }\r\n        this._activeInHierarchy = activeSelf;\r\n    }\r\n\r\n    protected _invalidateActiveInHierarchy()\r\n    {\r\n        if (this._activeInHierarchyInvalid) return;\r\n\r\n        this._activeInHierarchyInvalid = true;\r\n\r\n        this._children.forEach((c) =>\r\n        {\r\n            c._invalidateActiveInHierarchy();\r\n        });\r\n    }\r\n\r\n    protected _setParent(value: GameObject | null)\r\n    {\r\n        this._parent = value;\r\n        this.updateScene();\r\n        this.transform['_invalidateSceneTransform']();\r\n    }\r\n\r\n    private updateScene()\r\n    {\r\n        const newScene = this._parent ? this._parent._scene : null;\r\n        if (this._scene === newScene)\r\n        { return; }\r\n        if (this._scene)\r\n        {\r\n            this.emit('removedFromScene', this);\r\n        }\r\n        this._scene = newScene;\r\n        if (this._scene)\r\n        {\r\n            this.emit('addedToScene', this);\r\n        }\r\n        this.updateChildrenScene();\r\n    }\r\n\r\n    private updateChildrenScene()\r\n    {\r\n        for (let i = 0, n = this._children.length; i < n; i++)\r\n        {\r\n            this._children[i].updateScene();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 把事件分享到每个组件上。\r\n     */\r\n    getShareTargets()\r\n    {\r\n        return this.components;\r\n    }\r\n\r\n    /**\r\n     * 创建指定类型的游戏对象。\r\n     *\r\n     * @param type 游戏对象类型。\r\n     * @param param 游戏对象参数。\r\n     */\r\n    static createPrimitive<K extends keyof PrimitiveGameObject>(type: K, param?: gPartial<GameObject>)\r\n    {\r\n        const g = new GameObject();\r\n        g.name = type;\r\n\r\n        const createHandler = this._registerPrimitives[type];\r\n        if (createHandler) createHandler(g);\r\n\r\n        serialization.setValue(g, param);\r\n\r\n        return g;\r\n    }\r\n\r\n    /**\r\n     * 注册原始游戏对象，被注册后可以使用 GameObject.createPrimitive 进行创建。\r\n     *\r\n     * @param type 原始游戏对象类型。\r\n     * @param handler 构建原始游戏对象的函数。\r\n     */\r\n    static registerPrimitive<K extends keyof PrimitiveGameObject>(type: K, handler: (gameObject: GameObject) => void)\r\n    {\r\n        if (this._registerPrimitives[type])\r\n        { console.warn(`重复注册原始游戏对象 ${type} ！`); }\r\n        this._registerPrimitives[type] = handler;\r\n    }\r\n    static _registerPrimitives: { [type: string]: (gameObject: GameObject) => void } = {};\r\n}\r\n\r\n/**\r\n * 原始游戏对象，可以通过GameObject.createPrimitive进行创建。\r\n */\r\nexport interface PrimitiveGameObject extends MixinsPrimitiveGameObject\r\n{\r\n}\r\n\r\n// 在 Hierarchy 界面右键创建游戏\r\ncreateNodeMenu.push(\r\n    {\r\n        path: 'Create Empty',\r\n        click: () =>\r\n            new GameObject()\r\n    },\r\n);\r\n","import { Matrix4x4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { Component, RegisterComponent } from '../../component/Component';\r\nimport { GameObject } from '../../core/GameObject';\r\nimport { HideFlags } from '../../core/HideFlags';\r\nimport { Transform } from '../../core/Transform';\r\nimport { SkeletonJoint } from './Skeleton';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        SkeletonComponent: SkeletonComponent;\r\n    }\r\n}\r\n\r\n@RegisterComponent()\r\nexport class SkeletonComponent extends Component\r\n{\r\n    __class__: 'feng3d.SkeletonComponent';\r\n\r\n    /** 骨骼关节数据列表 */\r\n    @serialize\r\n    @oav()\r\n    joints: SkeletonJoint[] = [];\r\n\r\n    /**\r\n     * 当前骨骼姿势的全局矩阵\r\n     * @see #globalPose\r\n     */\r\n    get globalMatrices(): Matrix4x4[]\r\n    {\r\n        if (!this.isInitJoints)\r\n        {\r\n            this.initSkeleton();\r\n            this.isInitJoints = true;\r\n        }\r\n\r\n        if (this._globalPropertiesInvalid)\r\n        {\r\n            this.updateGlobalProperties();\r\n            this._globalPropertiesInvalid = false;\r\n        }\r\n\r\n        return this._globalMatrices;\r\n    }\r\n\r\n    //\r\n    private isInitJoints = false;\r\n    private jointGameobjects: Transform[];\r\n    private jointGameObjectMap: { [jointname: string]: Transform };\r\n    private _globalPropertiesInvalid: boolean;\r\n    private _jointsInvalid: boolean[];\r\n    private _globalMatrixsInvalid: boolean[];\r\n    private globalMatrixs: Matrix4x4[];\r\n    private _globalMatrices: Matrix4x4[];\r\n\r\n    initSkeleton()\r\n    {\r\n        this.jointGameobjects = [];\r\n        this.jointGameObjectMap = {};\r\n        //\r\n        this.createSkeletonGameObject();\r\n\r\n        //\r\n        this._globalPropertiesInvalid = true;\r\n        this._jointsInvalid = [];\r\n        this._globalMatrixsInvalid = [];\r\n        this.globalMatrixs = [];\r\n        this._globalMatrices = [];\r\n        //\r\n        const jointNum = this.joints.length;\r\n        for (let i = 0; i < jointNum; i++)\r\n        {\r\n            this._jointsInvalid[i] = true;\r\n            this._globalMatrixsInvalid[i] = true;\r\n            this.globalMatrixs[i] = new Matrix4x4();\r\n            this._globalMatrices[i] = new Matrix4x4();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 更新骨骼全局变换矩阵\r\n     */\r\n    private updateGlobalProperties()\r\n    {\r\n        // 姿势变换矩阵\r\n        const joints: SkeletonJoint[] = this.joints;\r\n        const jointGameobjects = this.jointGameobjects;\r\n        const globalMatrixs = this.globalMatrixs;\r\n        const _globalMatrixsInvalid = this._globalMatrixsInvalid;\r\n        // 遍历每个关节\r\n        for (let i = 0; i < joints.length; ++i)\r\n        {\r\n            if (!this._jointsInvalid[i])\r\n            { continue; }\r\n\r\n            this._globalMatrices[i]\r\n                .copy(globalMatrix(i))\r\n                .prepend(joints[i].invertMatrix);\r\n\r\n            this._jointsInvalid[i] = false;\r\n        }\r\n\r\n        function globalMatrix(index: number)\r\n        {\r\n            if (!_globalMatrixsInvalid[index])\r\n            { return globalMatrixs[index]; }\r\n\r\n            const jointPose = joints[index];\r\n\r\n            const jointGameobject = jointGameobjects[index];\r\n            globalMatrixs[index] = jointGameobject.transform.matrix.clone();\r\n            if (jointPose.parentIndex >= 0)\r\n            {\r\n                const parentGlobalMatrix = globalMatrix(jointPose.parentIndex);\r\n                globalMatrixs[index].append(parentGlobalMatrix);\r\n            }\r\n\r\n            _globalMatrixsInvalid[index] = false;\r\n\r\n            return globalMatrixs[index];\r\n        }\r\n    }\r\n\r\n    private invalidjoint(jointIndex: number)\r\n    {\r\n        this._globalPropertiesInvalid = true;\r\n        this._jointsInvalid[jointIndex] = true;\r\n        this._globalMatrixsInvalid[jointIndex] = true;\r\n\r\n        this.joints[jointIndex].children.forEach((element) =>\r\n        {\r\n            this.invalidjoint(element);\r\n        });\r\n    }\r\n\r\n    private createSkeletonGameObject()\r\n    {\r\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\r\n        const skeleton = this;\r\n\r\n        const joints = skeleton.joints;\r\n        const jointGameobjects = this.jointGameobjects;\r\n        const jointGameObjectMap = this.jointGameObjectMap;\r\n\r\n        for (let i = 0; i < joints.length; i++)\r\n        {\r\n            createJoint(i);\r\n        }\r\n\r\n        function createJoint(i: number)\r\n        {\r\n            if (jointGameobjects[i])\r\n            { return jointGameobjects[i].gameObject; }\r\n\r\n            const skeletonJoint = joints[i];\r\n            let parentGameobject: GameObject;\r\n            if (skeletonJoint.parentIndex !== -1)\r\n            {\r\n                parentGameobject = createJoint(skeletonJoint.parentIndex);\r\n                joints[skeletonJoint.parentIndex].children.push(i);\r\n            }\r\n            else\r\n            {\r\n                parentGameobject = skeleton.gameObject;\r\n            }\r\n\r\n            let jointGameobject = parentGameobject.find(skeletonJoint.name);\r\n            if (!jointGameobject)\r\n            {\r\n                jointGameobject = serialization.setValue(new GameObject(), { name: skeletonJoint.name, hideFlags: HideFlags.DontSave });\r\n                parentGameobject.addChild(jointGameobject);\r\n            }\r\n\r\n            const transform = jointGameobject.transform;\r\n\r\n            let matrix = skeletonJoint.matrix;\r\n            if (skeletonJoint.parentIndex !== -1)\r\n            {\r\n                matrix = matrix.clone().append(joints[skeletonJoint.parentIndex].invertMatrix);\r\n            }\r\n            transform.matrix = matrix;\r\n\r\n            transform.on('transformChanged', () =>\r\n            {\r\n                skeleton.invalidjoint(i);\r\n            });\r\n\r\n            jointGameobjects[i] = transform;\r\n            jointGameObjectMap[skeletonJoint.name] = transform;\r\n\r\n            return jointGameobject;\r\n        }\r\n    }\r\n}\r\n","import { Matrix4x4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { RenderAtomic } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { Camera } from '../../cameras/Camera';\r\nimport { RegisterComponent } from '../../component/Component';\r\nimport { GameObject } from '../../core/GameObject';\r\nimport { HideFlags } from '../../core/HideFlags';\r\nimport { Renderable } from '../../core/Renderable';\r\nimport { Scene } from '../../scene/Scene';\r\nimport { SkeletonComponent } from './SkeletonComponent';\r\nimport { Animation } from '../../animation/Animation';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        SkinnedMeshRenderer: SkinnedMeshRenderer\r\n    }\r\n}\r\n\r\n@RegisterComponent()\r\nexport class SkinnedMeshRenderer extends Renderable\r\n{\r\n    __class__: 'feng3d.SkinnedMeshRenderer';\r\n\r\n    get single() { return true; }\r\n\r\n    @serialize\r\n    @oav()\r\n    skinSkeleton: SkinSkeleton;\r\n\r\n    @serialize\r\n    initMatrix: Matrix4x4;\r\n\r\n    /**\r\n     * 创建一个骨骼动画类\r\n     */\r\n    init()\r\n    {\r\n        super.init();\r\n        this.hideFlags = HideFlags.DontTransform;\r\n    }\r\n\r\n    beforeRender(renderAtomic: RenderAtomic, scene: Scene, camera: Camera)\r\n    {\r\n        super.beforeRender(renderAtomic, scene, camera);\r\n\r\n        let frameId: string = null;\r\n        const animation = this.getComponentsInParent(Animation)[0];\r\n        if (animation)\r\n        {\r\n            frameId = `${animation.clipName}&${animation.frame}`;\r\n        }\r\n\r\n        renderAtomic.uniforms.u_modelMatrix = () => this.u_modelMatrix;\r\n        renderAtomic.uniforms.u_ITModelMatrix = () => this.u_ITModelMatrix;\r\n        //\r\n        let skeletonGlobalMatriices = this.cacheU_skeletonGlobalMatriices[frameId];\r\n        // if (!skeletonGlobalMatriices)\r\n        // eslint-disable-next-line no-lone-blocks\r\n        {\r\n            skeletonGlobalMatriices = this.u_skeletonGlobalMatriices;\r\n            if (frameId) this.cacheU_skeletonGlobalMatriices[frameId] = skeletonGlobalMatriices;\r\n        }\r\n        renderAtomic.uniforms.u_skeletonGlobalMatriices = skeletonGlobalMatriices;\r\n\r\n        renderAtomic.shaderMacro.HAS_SKELETON_ANIMATION = true;\r\n        renderAtomic.shaderMacro.NUM_SKELETONJOINT = this.skinSkeleton.joints.length;\r\n    }\r\n\r\n    /**\r\n     * 销毁\r\n     */\r\n    dispose()\r\n    {\r\n        this.cacheSkeletonComponent = null;\r\n        super.dispose();\r\n    }\r\n\r\n    /**\r\n     * 缓存，通过寻找父结点获得\r\n     */\r\n    private cacheSkeletonComponent: SkeletonComponent;\r\n\r\n    private cacheU_skeletonGlobalMatriices: { [id: string]: Matrix4x4[] } = {};\r\n\r\n    private get u_modelMatrix()\r\n    {\r\n        if (this.cacheSkeletonComponent)\r\n        { return this.cacheSkeletonComponent.transform.localToWorldMatrix; }\r\n\r\n        return this.transform.localToWorldMatrix;\r\n    }\r\n\r\n    private get u_ITModelMatrix()\r\n    {\r\n        if (this.cacheSkeletonComponent)\r\n        { return this.cacheSkeletonComponent.transform.ITlocalToWorldMatrix; }\r\n\r\n        return this.transform.ITlocalToWorldMatrix;\r\n    }\r\n\r\n    private get u_skeletonGlobalMatriices()\r\n    {\r\n        if (!this.cacheSkeletonComponent)\r\n        {\r\n            let gameObject: GameObject = this.gameObject;\r\n            let skeletonComponent: SkeletonComponent = null;\r\n            while (gameObject && !skeletonComponent)\r\n            {\r\n                skeletonComponent = gameObject.getComponent(SkeletonComponent);\r\n                gameObject = gameObject.parent;\r\n            }\r\n            this.cacheSkeletonComponent = skeletonComponent;\r\n        }\r\n        let skeletonGlobalMatriices: Matrix4x4[] = [];\r\n        if (this.skinSkeleton && this.cacheSkeletonComponent)\r\n        {\r\n            const joints = this.skinSkeleton.joints;\r\n            const globalMatrices = this.cacheSkeletonComponent.globalMatrices;\r\n            for (let i = joints.length - 1; i >= 0; i--)\r\n            {\r\n                skeletonGlobalMatriices[i] = globalMatrices[joints[i][0]].clone();\r\n                if (this.initMatrix)\r\n                {\r\n                    skeletonGlobalMatriices[i].prepend(this.initMatrix);\r\n                }\r\n            }\r\n        }\r\n        else\r\n        {\r\n            skeletonGlobalMatriices = defaultSkeletonGlobalMatriices;\r\n        }\r\n\r\n        return skeletonGlobalMatriices;\r\n    }\r\n}\r\n\r\nconst defaultSkeletonGlobalMatriices: Matrix4x4[] = (() =>\r\n{\r\n    const v = [new Matrix4x4()]; let i = 150; while (i-- > 1) v.push(v[0]);\r\n\r\n    return v;\r\n})();\r\n\r\nexport class SkinSkeleton\r\n{\r\n    /**\r\n     * [在整个骨架中的编号，骨骼名称]\r\n     */\r\n    @serialize\r\n    joints: [number, string][] = [];\r\n    /**\r\n     * 当前模型包含骨骼数量\r\n     */\r\n    @serialize\r\n    numJoint = 0;\r\n}\r\n\r\nexport class SkinSkeletonTemp extends SkinSkeleton\r\n{\r\n    /**\r\n     * temp 解析时临时数据\r\n     */\r\n    cache_map: { [oldjointid: number]: number } = {};\r\n\r\n    resetJointIndices(jointIndices: number[], skeleton: SkeletonComponent)\r\n    {\r\n        const len = jointIndices.length;\r\n        for (let i = 0; i < len; i++)\r\n        {\r\n            if (this.cache_map[jointIndices[i]] === undefined)\r\n            { this.cache_map[jointIndices[i]] = this.numJoint++; }\r\n            jointIndices[i] = this.cache_map[jointIndices[i]];\r\n        }\r\n\r\n        this.joints.length = 0;\r\n        for (const key in this.cache_map)\r\n        {\r\n            if (this.cache_map.hasOwnProperty(key))\r\n            {\r\n                this.joints[this.cache_map[key]] = [parseInt(key, 10), skeleton.joints[key].name];\r\n            }\r\n        }\r\n    }\r\n}\r\n","import { ReadWriteFS } from '@feng3d/filesystem';\r\nimport { gPartial } from '@feng3d/polyfill';\r\nimport { serialization } from '@feng3d/serialization';\r\nimport { AssetData } from '../../core/AssetData';\r\nimport { ticker } from '../../utils/Ticker';\r\nimport { FileAsset } from '../FileAsset';\r\nimport { FolderAsset } from '../FolderAsset';\r\nimport { ReadRS } from './ReadRS';\r\n\r\nexport interface ReadWriteRS\r\n{\r\n    get fs(): ReadWriteFS;\r\n}\r\n\r\n/**\r\n * 可读写资源系统\r\n */\r\nexport class ReadWriteRS extends ReadRS\r\n{\r\n    /**\r\n     * 延迟保存执行函数\r\n     */\r\n    private laterSaveFunc = (_interval: number) => { this.save(); };\r\n    /**\r\n     * 延迟保存，避免多次操作时频繁调用保存\r\n     */\r\n    private laterSave = () => { ticker.nextframe(this.laterSaveFunc, this); };\r\n\r\n    /**\r\n     * 构建可读写资源系统\r\n     *\r\n     * @param fs 可读写文件系统\r\n     */\r\n    constructor(fs?: ReadWriteFS)\r\n    {\r\n        super(fs);\r\n    }\r\n\r\n    /**\r\n     * 在更改资源结构（新增，移动，删除）时会自动保存\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    private save(callback?: (err: Error) => void)\r\n    {\r\n        const allAssets = this.getAllAssets();\r\n        const object = serialization.serialize(allAssets);\r\n        this.fs.writeObject(this.resources, object, callback);\r\n    }\r\n\r\n    /**\r\n     * 新建资源\r\n     *\r\n     * @param cls 资源类定义\r\n     * @param fileName 文件名称\r\n     * @param value 初始数据\r\n     * @param parent 所在文件夹，如果值为null时默认添加到根文件夹中\r\n     * @param callback 完成回调函数\r\n     */\r\n    createAsset<T extends FileAsset>(cls: new () => T, fileName?: string, value?: gPartial<T>, parent?: FolderAsset, callback?: (err: Error, asset: T) => void)\r\n    {\r\n        // 新建资源\r\n        super.createAsset(cls, fileName, value, parent, (err, asset) =>\r\n        {\r\n            if (asset)\r\n            {\r\n                // 保存资源\r\n                this.writeAsset(asset, (err) =>\r\n                {\r\n                    callback && callback(err, asset);\r\n\r\n                    // 保存资源库\r\n                    this.laterSave();\r\n                });\r\n            }\r\n            else\r\n            {\r\n                callback && callback(err, null);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 写（保存）资源\r\n     *\r\n     * @param asset 资源对象\r\n     * @param callback 完成回调\r\n     */\r\n    writeAsset(asset: FileAsset, callback?: (err: Error) => void)\r\n    {\r\n        asset.write(callback);\r\n    }\r\n\r\n    /**\r\n     * 移动资源到指定文件夹\r\n     *\r\n     * @param asset 被移动资源\r\n     * @param folder 目标文件夹\r\n     * @param callback 完成回调\r\n     */\r\n    moveAsset(asset: FileAsset, folder: FolderAsset, callback?: (err: Error) => void)\r\n    {\r\n        const filename = asset.fileName + asset.extenson;\r\n\r\n        const cnames = folder.childrenAssets.map((v) => v.fileName + v.extenson);\r\n        if (cnames.indexOf(filename) !== -1)\r\n        {\r\n            callback && callback(new Error(`目标文件夹中存在同名文件（夹），无法移动`));\r\n\r\n            return;\r\n        }\r\n        let fp = folder;\r\n        while (fp)\r\n        {\r\n            if (fp === <any>asset)\r\n            {\r\n                callback && callback(new Error(`无法移动达到子文件夹中`));\r\n\r\n                return;\r\n            }\r\n            fp = fp.parentAsset;\r\n        }\r\n\r\n        // 获取需要移动的资源列表\r\n        let assets = [asset];\r\n        let index = 0;\r\n        while (index < assets.length)\r\n        {\r\n            const ca = assets[index];\r\n            if (ca instanceof FolderAsset)\r\n            {\r\n                assets = assets.concat(ca.childrenAssets);\r\n            }\r\n            index++;\r\n        }\r\n\r\n        // 最后根据 parentAsset 修复 childrenAssets\r\n        // const copyassets = assets.concat();\r\n\r\n        // 移动最后一个资源\r\n        const moveLastAsset = () =>\r\n        {\r\n            if (assets.length === 0)\r\n            {\r\n                callback && callback(null);\r\n                // 保存资源库\r\n                this.laterSave();\r\n\r\n                return;\r\n            }\r\n            const la = assets.pop();\r\n            // 读取资源\r\n            this.readAsset(la.assetId, (err, _a) =>\r\n            {\r\n                if (err)\r\n                {\r\n                    callback && callback(err);\r\n\r\n                    return;\r\n                }\r\n                // 从原路径上删除资源\r\n                this.deleteAsset(la, (err) =>\r\n                {\r\n                    if (err)\r\n                    {\r\n                        callback && callback(err);\r\n\r\n                        return;\r\n                    }\r\n                    // 计算资源新路径\r\n                    let np = la.fileName + la.extenson;\r\n                    let p = la.parentAsset;\r\n                    while (p)\r\n                    {\r\n                        np = `${p.fileName}/${np}`;\r\n                        p = p.parentAsset;\r\n                    }\r\n                    la.assetPath = np;\r\n                    // 新增映射\r\n                    this.addAsset(la);\r\n                    // 保存资源到新路径\r\n                    this.writeAsset(la, (err) =>\r\n                    {\r\n                        if (err)\r\n                        {\r\n                            callback && callback(err);\r\n\r\n                            return;\r\n                        }\r\n                        moveLastAsset();\r\n                    });\r\n                });\r\n            });\r\n        };\r\n        moveLastAsset();\r\n    }\r\n\r\n    /**\r\n     * 删除资源\r\n     *\r\n     * @param asset 资源\r\n     * @param callback 完成回调\r\n     */\r\n    deleteAsset(asset: FileAsset, callback?: (err: Error) => void)\r\n    {\r\n        // 获取需要移动的资源列表\r\n        let assets = [asset];\r\n        let index = 0;\r\n        while (index < assets.length)\r\n        {\r\n            const ca = assets[index];\r\n            if (ca instanceof FolderAsset)\r\n            {\r\n                assets = assets.concat(ca.childrenAssets);\r\n            }\r\n            index++;\r\n        }\r\n\r\n        // 删除最后一个资源\r\n        const deleteLastAsset = () =>\r\n        {\r\n            if (assets.length === 0)\r\n            {\r\n                callback && callback(null);\r\n                // 保存资源库\r\n                this.laterSave();\r\n\r\n                return;\r\n            }\r\n            const la = assets.pop();\r\n\r\n            la.delete(() =>\r\n            {\r\n                AssetData.deleteAssetData(la.data);\r\n                deleteLastAsset();\r\n            });\r\n        };\r\n        deleteLastAsset();\r\n    }\r\n}\r\n","import { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { Behaviour } from '../component/Behaviour';\r\nimport { RegisterComponent } from '../component/Component';\r\nimport { AddComponentMenu } from '../Menu';\r\n\r\nexport let audioCtx: AudioContext;\r\nexport let globalGain: GainNode;\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        AudioListener: AudioListener;\r\n    }\r\n}\r\n/**\r\n * 声音监听器\r\n */\r\n@AddComponentMenu('Audio/AudioListener')\r\n@RegisterComponent()\r\nexport class AudioListener extends Behaviour\r\n{\r\n    gain: GainNode;\r\n\r\n    @watch('_enabledChanged')\r\n    enabled = true;\r\n\r\n    /**\r\n     * 音量\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '音量' })\r\n    get volume()\r\n    {\r\n        return this._volume;\r\n    }\r\n    set volume(v)\r\n    {\r\n        this._volume = v;\r\n        this.gain.gain.setTargetAtTime(v, audioCtx.currentTime, 0.01);\r\n    }\r\n    private _volume = 1;\r\n\r\n    constructor()\r\n    {\r\n        super();\r\n        this.gain = audioCtx.createGain();\r\n        this.gain.connect(audioCtx.destination);\r\n        this._enabledChanged();\r\n    }\r\n\r\n    init()\r\n    {\r\n        super.init();\r\n        this.on('scenetransformChanged', this._onScenetransformChanged, this);\r\n        this._onScenetransformChanged();\r\n    }\r\n\r\n    private _onScenetransformChanged()\r\n    {\r\n        const localToWorldMatrix = this.transform.localToWorldMatrix;\r\n        const position = localToWorldMatrix.getPosition();\r\n        const forward = localToWorldMatrix.getAxisZ();\r\n        const up = localToWorldMatrix.getAxisY();\r\n        //\r\n        const listener = audioCtx.listener;\r\n        // feng3d中为左手坐标系，listener中使用的为右手坐标系，参考https://developer.mozilla.org/en-US/docs/Web/API/AudioListener\r\n        if (listener.forwardX)\r\n        {\r\n            listener.positionX.setValueAtTime(position.x, audioCtx.currentTime);\r\n            listener.positionY.setValueAtTime(position.y, audioCtx.currentTime);\r\n            listener.positionZ.setValueAtTime(-position.z, audioCtx.currentTime);\r\n            listener.forwardX.setValueAtTime(forward.x, audioCtx.currentTime);\r\n            listener.forwardY.setValueAtTime(forward.y, audioCtx.currentTime);\r\n            listener.forwardZ.setValueAtTime(-forward.z, audioCtx.currentTime);\r\n            listener.upX.setValueAtTime(up.x, audioCtx.currentTime);\r\n            listener.upY.setValueAtTime(up.y, audioCtx.currentTime);\r\n            listener.upZ.setValueAtTime(-up.z, audioCtx.currentTime);\r\n        }\r\n        else\r\n        {\r\n            listener.setOrientation(forward.x, forward.y, -forward.z, up.x, up.y, -up.z);\r\n            listener.setPosition(position.x, position.y, -position.z);\r\n        }\r\n    }\r\n\r\n    private _enabledChanged()\r\n    {\r\n        if (!this.gain) return;\r\n        if (this.enabled)\r\n        {\r\n            globalGain.connect(this.gain);\r\n        }\r\n        else\r\n        {\r\n            globalGain.disconnect(this.gain);\r\n        }\r\n    }\r\n\r\n    dispose()\r\n    {\r\n        this.off('scenetransformChanged', this._onScenetransformChanged, this);\r\n        super.dispose();\r\n    }\r\n}\r\n\r\n(() =>\r\n{\r\n    if (typeof window === 'undefined') return;\r\n\r\n    window['AudioContext'] = window['AudioContext'] || window['webkitAudioContext'];\r\n\r\n    audioCtx = new AudioContext();\r\n    globalGain = audioCtx.createGain();\r\n\r\n    // 新增无音Gain，避免没有AudioListener组件时暂停声音播放进度\r\n    const zeroGain = audioCtx.createGain();\r\n    zeroGain.connect(audioCtx.destination);\r\n    globalGain.connect(zeroGain);\r\n    zeroGain.gain.setTargetAtTime(0, audioCtx.currentTime, 0.01);\r\n    //\r\n    const listener = audioCtx.listener;\r\n    audioCtx.createGain();\r\n    if (listener.forwardX)\r\n    {\r\n        listener.forwardX.value = 0;\r\n        listener.forwardY.value = 0;\r\n        listener.forwardZ.value = -1;\r\n        listener.upX.value = 0;\r\n        listener.upY.value = 1;\r\n        listener.upZ.value = 0;\r\n    }\r\n    else\r\n    {\r\n        listener.setOrientation(0, 0, -1, 0, 1, 0);\r\n    }\r\n})();\r\n","import { FS } from '@feng3d/filesystem';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { Behaviour } from '../component/Behaviour';\r\nimport { RegisterComponent } from '../component/Component';\r\nimport { AddComponentMenu } from '../Menu';\r\nimport { audioCtx, globalGain } from './AudioListener';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        AudioSource: AudioSource;\r\n    }\r\n}\r\n\r\n/**\r\n * 音量与距离算法\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/PannerNode/distanceModel\r\n * @see https://mdn.github.io/webaudio-examples/panner-node/\r\n * @see https://github.com/mdn/webaudio-examples\r\n */\r\nexport enum DistanceModelType\r\n{\r\n    /**\r\n     * 1 - rolloffFactor * (distance - refDistance) / (maxDistance - refDistance)\r\n     */\r\n    linear = 'linear',\r\n    /**\r\n     * refDistance / (refDistance + rolloffFactor * (distance - refDistance))\r\n     */\r\n    inverse = 'inverse',\r\n    /**\r\n     * pow(distance / refDistance, -rolloffFactor)\r\n     */\r\n    exponential = 'exponential',\r\n}\r\n\r\n/**\r\n * 声源\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/AudioContext\r\n */\r\n@AddComponentMenu('Audio/AudioSource')\r\n@RegisterComponent()\r\nexport class AudioSource extends Behaviour\r\n{\r\n    private panner: PannerNode;\r\n    private source: AudioBufferSourceNode;\r\n    private buffer: AudioBuffer;\r\n    private gain: GainNode;\r\n\r\n    @watch('_enabledChanged')\r\n    enabled = true;\r\n\r\n    /**\r\n     * 声音文件路径\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVPick', tooltip: '声音文件路径', componentParam: { accepttype: 'audio' } })\r\n    @watch('_onUrlChanged')\r\n    url = '';\r\n\r\n    /**\r\n     * 是否循环播放\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '是否循环播放' })\r\n    get loop()\r\n    {\r\n        return this._loop;\r\n    }\r\n    set loop(v)\r\n    {\r\n        this._loop = v;\r\n        if (this.source) this.source.loop = v;\r\n    }\r\n    private _loop = true;\r\n\r\n    /**\r\n     * 音量\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '音量' })\r\n    get volume()\r\n    {\r\n        return this._volume;\r\n    }\r\n    set volume(v)\r\n    {\r\n        this._volume = v;\r\n        this.gain.gain.setTargetAtTime(v, audioCtx.currentTime, 0.01);\r\n    }\r\n    private _volume: number;\r\n\r\n    /**\r\n     * 是否启用位置影响声音\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '是否启用位置影响声音' })\r\n    get enablePosition()\r\n    {\r\n        return this._enablePosition;\r\n    }\r\n    set enablePosition(v)\r\n    {\r\n        this._disconnect();\r\n        this._enablePosition = v;\r\n        this._connect();\r\n    }\r\n    private _enablePosition = true;\r\n\r\n    // @serialize\r\n    // @oav()\r\n    get coneInnerAngle()\r\n    {\r\n        return this._coneInnerAngle;\r\n    }\r\n    set coneInnerAngle(v)\r\n    {\r\n        this._coneInnerAngle = v;\r\n        this.panner.coneInnerAngle = v;\r\n    }\r\n    private _coneInnerAngle: number;\r\n\r\n    // @serialize\r\n    // @oav()\r\n    get coneOuterAngle()\r\n    {\r\n        return this._coneOuterAngle;\r\n    }\r\n    set coneOuterAngle(v)\r\n    {\r\n        this._coneOuterAngle = v;\r\n        this.panner.coneOuterAngle = v;\r\n    }\r\n    private _coneOuterAngle: number;\r\n\r\n    // @serialize\r\n    // @oav()\r\n    get coneOuterGain()\r\n    {\r\n        return this._coneOuterGain;\r\n    }\r\n    set coneOuterGain(v)\r\n    {\r\n        this._coneOuterGain = v;\r\n        this.panner.coneOuterGain = v;\r\n    }\r\n    private _coneOuterGain: number;\r\n\r\n    /**\r\n     * 该接口的distanceModel属性PannerNode是一个枚举值，用于确定在音频源离开收听者时用于减少音频源音量的算法。\r\n     *\r\n     * 可能的值是：\r\n     * * linear：根据以下公式计算由距离引起的增益的线性距离模型：\r\n     *      1 - rolloffFactor * (distance - refDistance) / (maxDistance - refDistance)\r\n     * * inverse：根据以下公式计算由距离引起的增益的反距离模型：\r\n     *      refDistance / (refDistance + rolloffFactor * (distance - refDistance))\r\n     * * exponential：按照下式计算由距离引起的增益的指数距离模型\r\n     *      pow(distance / refDistance, -rolloffFactor)。\r\n     *\r\n     * inverse是的默认值distanceModel。\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVEnum', tooltip: '距离模式，距离影响声音的方式', componentParam: { enumClass: DistanceModelType } })\r\n    get distanceModel()\r\n    {\r\n        return this._distanceModel;\r\n    }\r\n    set distanceModel(v)\r\n    {\r\n        this._distanceModel = v;\r\n        this.panner.distanceModel = v;\r\n    }\r\n    private _distanceModel: DistanceModelType;\r\n\r\n    /**\r\n     * 表示音频源和收听者之间的最大距离，之后音量不会再降低。该值仅由linear距离模型使用。默认值是10000。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '表示音频源和收听者之间的最大距离，之后音量不会再降低。该值仅由linear距离模型使用。默认值是10000。' })\r\n    get maxDistance()\r\n    {\r\n        return this._maxDistance;\r\n    }\r\n    set maxDistance(v)\r\n    {\r\n        this._maxDistance = v;\r\n        this.panner.maxDistance = v;\r\n    }\r\n    private _maxDistance: number;\r\n\r\n    // @serialize\r\n    // @oav()\r\n    get panningModel()\r\n    {\r\n        return this._panningModel;\r\n    }\r\n    set panningModel(v)\r\n    {\r\n        this._panningModel = v;\r\n        this.panner.panningModel = v;\r\n    }\r\n    private _panningModel: PanningModelType;\r\n\r\n    /**\r\n     * 表示随着音频源远离收听者而减小音量的参考距离。此值由所有距离模型使用。默认值是1。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '表示随着音频源远离收听者而减小音量的参考距离。此值由所有距离模型使用。默认值是1。' })\r\n    get refDistance()\r\n    {\r\n        return this._refDistance;\r\n    }\r\n    set refDistance(v)\r\n    {\r\n        this._refDistance = v;\r\n        this.panner.refDistance = v;\r\n    }\r\n    private _refDistance: number;\r\n\r\n    /**\r\n     * 描述了音源离开收听者音量降低的速度。此值由所有距离模型使用。默认值是1。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '描述了音源离开收听者音量降低的速度。此值由所有距离模型使用。默认值是1。' })\r\n    get rolloffFactor()\r\n    {\r\n        return this._rolloffFactor;\r\n    }\r\n    set rolloffFactor(v)\r\n    {\r\n        this._rolloffFactor = v;\r\n        this.panner.rolloffFactor = v;\r\n    }\r\n    private _rolloffFactor: number;\r\n\r\n    constructor()\r\n    {\r\n        super();\r\n        this.panner = createPanner();\r\n        this.panningModel = 'HRTF';\r\n        this.distanceModel = DistanceModelType.inverse;\r\n        this.refDistance = 1;\r\n        this.maxDistance = 10000;\r\n        this.rolloffFactor = 1;\r\n        this.coneInnerAngle = 360;\r\n        this.coneOuterAngle = 0;\r\n        this.coneOuterGain = 0;\r\n        //\r\n        this.gain = audioCtx.createGain();\r\n        this.volume = 1;\r\n        //\r\n        this._enabledChanged();\r\n        this._connect();\r\n    }\r\n\r\n    init()\r\n    {\r\n        super.init();\r\n        this.on('scenetransformChanged', this._onScenetransformChanged, this);\r\n    }\r\n\r\n    @oav()\r\n    play()\r\n    {\r\n        this.stop();\r\n        if (this.buffer)\r\n        {\r\n            this.source = audioCtx.createBufferSource();\r\n            this.source.buffer = this.buffer;\r\n            this._connect();\r\n            this.source.loop = this.loop;\r\n            this.source.start(0);\r\n        }\r\n    }\r\n\r\n    @oav()\r\n    stop()\r\n    {\r\n        if (this.source)\r\n        {\r\n            this.source.stop(0);\r\n            this._disconnect();\r\n            this.source = null;\r\n        }\r\n    }\r\n\r\n    private _onScenetransformChanged()\r\n    {\r\n        const localToWorldMatrix = this.transform.localToWorldMatrix;\r\n        const scenePosition = localToWorldMatrix.getPosition();\r\n\r\n        //\r\n        const panner = this.panner;\r\n        // feng3d使用左手坐标系，panner使用右手坐标系，参考https://developer.mozilla.org/en-US/docs/Web/API/PannerNode\r\n        if (panner.orientationX)\r\n        {\r\n            panner.positionX.value = scenePosition.x;\r\n            panner.positionY.value = scenePosition.y;\r\n            panner.positionZ.value = -scenePosition.z;\r\n            panner.orientationX.value = 1;\r\n            panner.orientationY.value = 0;\r\n            panner.orientationZ.value = 0;\r\n        }\r\n        else\r\n        {\r\n            panner.setPosition(scenePosition.x, scenePosition.y, -scenePosition.z);\r\n            panner.setOrientation(1, 0, 0);\r\n        }\r\n    }\r\n\r\n    private _onUrlChanged()\r\n    {\r\n        this.stop();\r\n        if (this.url)\r\n        {\r\n            const url = this.url;\r\n            FS.fs.readArrayBuffer(this.url, (err, data) =>\r\n            {\r\n                if (err)\r\n                {\r\n                    console.warn(err);\r\n\r\n                    return;\r\n                }\r\n                if (url !== this.url)\r\n                { return; }\r\n                audioCtx.decodeAudioData(data, (buffer) =>\r\n                {\r\n                    this.buffer = buffer;\r\n                });\r\n            });\r\n        }\r\n    }\r\n\r\n    private _connect()\r\n    {\r\n        const arr = this._getAudioNodes();\r\n        for (let i = 0; i < arr.length - 1; i++)\r\n        {\r\n            arr[i + 1].connect(arr[i]);\r\n        }\r\n    }\r\n\r\n    private _disconnect()\r\n    {\r\n        const arr = this._getAudioNodes();\r\n        for (let i = 0; i < arr.length - 1; i++)\r\n        {\r\n            arr[i + 1].disconnect(arr[i]);\r\n        }\r\n    }\r\n\r\n    private _getAudioNodes()\r\n    {\r\n        const arr: AudioNode[] = [];\r\n        arr.push(this.gain);\r\n        if (this._enablePosition)\r\n        { arr.push(this.panner); }\r\n        if (this.source)\r\n        { arr.push(this.source); }\r\n\r\n        return arr;\r\n    }\r\n\r\n    private _enabledChanged()\r\n    {\r\n        if (!this.gain)\r\n        { return; }\r\n        if (this.enabled)\r\n        { this.gain.connect(globalGain); }\r\n        else\r\n        { this.gain.disconnect(globalGain); }\r\n    }\r\n\r\n    dispose()\r\n    {\r\n        this.off('scenetransformChanged', this._onScenetransformChanged, this);\r\n        this._disconnect();\r\n        super.dispose();\r\n    }\r\n}\r\n\r\nfunction createPanner()\r\n{\r\n    const panner = this.panner = audioCtx.createPanner();\r\n\r\n    if (panner.orientationX)\r\n    {\r\n        panner.orientationX.value = 1;\r\n        panner.orientationY.value = 0;\r\n        panner.orientationZ.value = 0;\r\n    }\r\n    else\r\n    {\r\n        panner.setOrientation(1, 0, 0);\r\n    }\r\n\r\n    return panner;\r\n}\r\n","/**\r\n * 摄像机投影类型\r\n */\r\nexport enum Projection\r\n{\r\n    /**\r\n     * 透视投影\r\n     */\r\n    Perspective,\r\n    /**\r\n     * 正交投影\r\n     */\r\n    Orthographic,\r\n}\r\n","import { Matrix4x4, Ray3, Vector3, Vector4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { Feng3dObject } from '../../core/Feng3dObject';\r\nimport { Projection } from '../Projection';\r\n\r\nexport interface LensEventMap\r\n{\r\n\tlensChanged: LensBase;\r\n}\r\n\r\n/**\r\n * 摄像机镜头\r\n *\r\n * 镜头主要作用是投影以及逆投影。\r\n * 投影指的是从摄像机空间可视区域内的坐标投影至GPU空间可视区域内的坐标。\r\n *\r\n * 摄像机可视区域：由近、远，上，下，左，右组成的四棱柱\r\n * GPU空间可视区域：立方体 [(-1, -1, -1), (1, 1, 1)]\r\n *\r\n */\r\nexport abstract class LensBase<T extends LensEventMap = LensEventMap> extends Feng3dObject<T>\r\n{\r\n\t/**\r\n\t * 摄像机投影类型\r\n\t */\r\n\tget projectionType()\r\n\t{\r\n\t\treturn this._projectionType;\r\n\t}\r\n\tprotected _projectionType: Projection;\r\n\r\n\t/**\r\n\t * 最近距离\r\n\t */\r\n\t@serialize\r\n\t@oav()\r\n\t@watch('invalidate')\r\n\tnear: number;\r\n\r\n\t/**\r\n\t * 最远距离\r\n\t */\r\n\t@watch('invalidate')\r\n\t@serialize\r\n\t@oav()\r\n\tfar: number;\r\n\r\n\t/**\r\n\t * 视窗缩放比例(width/height)，在渲染器中设置\r\n\t */\r\n\t@watch('invalidate')\r\n\taspect: number;\r\n\r\n\t/**\r\n\t * 创建一个摄像机镜头\r\n\t */\r\n\tconstructor(aspectRatio = 1, near = 0.3, far = 1000)\r\n\t{\r\n\t\tsuper();\r\n\t\tthis.aspect = aspectRatio;\r\n\t\tthis.near = near;\r\n\t\tthis.far = far;\r\n\t}\r\n\r\n\t/**\r\n\t * 投影矩阵\r\n\t */\r\n\tget matrix(): Matrix4x4\r\n\t{\r\n\t\tif (this._matrixInvalid)\r\n\t\t{\r\n\t\t\tthis._updateMatrix();\r\n\t\t\tthis._matrixInvalid = false;\r\n\t\t}\r\n\r\nreturn this._matrix;\r\n\t}\r\n\r\n\t/**\r\n\t * 逆矩阵\r\n\t */\r\n\tget inverseMatrix(): Matrix4x4\r\n\t{\r\n\t\tif (this._invertMatrixInvalid)\r\n\t\t{\r\n\t\t\tthis._updateInverseMatrix();\r\n\t\t\tthis._invertMatrixInvalid = false;\r\n\t\t}\r\n\r\nreturn this._inverseMatrix;\r\n\t}\r\n\r\n\t/**\r\n\t * 摄像机空间坐标投影到GPU空间坐标\r\n\t * @param point3d 摄像机空间坐标\r\n\t * @param v GPU空间坐标\r\n\t * @return GPU空间坐标\r\n\t */\r\n\tproject(point3d: Vector3, v = new Vector3()): Vector3\r\n\t{\r\n\t\tconst v4 = this.matrix.transformVector4(Vector4.fromVector3(point3d, 1));\r\n\t\tv4.toVector3(v);\r\n\r\nreturn v;\r\n\t}\r\n\r\n\t/**\r\n\t * GPU空间坐标投影到摄像机空间坐标\r\n\t * @param point3d GPU空间坐标\r\n\t * @param v 摄像机空间坐标（输出）\r\n\t * @returns 摄像机空间坐标\r\n\t */\r\n\tunproject(point3d: Vector3, v = new Vector3())\r\n\t{\r\n\t\tconst v4 = this.inverseMatrix.transformVector4(Vector4.fromVector3(point3d, 1));\r\n\t\tv4.toVector3(v);\r\n\r\nreturn v;\r\n\t}\r\n\r\n\t/**\r\n\t * 逆投影求射线\r\n\t *\r\n\t * 通过GPU空间坐标x与y值求出摄像机空间坐标的射线\r\n\t *\r\n\t * @param x GPU空间坐标x值\r\n\t * @param y GPU空间坐标y值\r\n\t */\r\n\tunprojectRay(x: number, y: number, ray = new Ray3())\r\n\t{\r\n\t\tconst p0 = this.unproject(new Vector3(x, y, 0));\r\n\t\tconst p1 = this.unproject(new Vector3(x, y, 1));\r\n\t\t// 初始化射线\r\n\t\tray.fromPosAndDir(p0, p1.sub(p0));\r\n\t\t// 获取z==0的点\r\n\t\tconst sp = ray.getPointWithZ(0);\r\n\t\tray.origin = sp;\r\n\r\nreturn ray;\r\n\t}\r\n\r\n\t/**\r\n\t * 指定深度逆投影\r\n\t *\r\n\t * 获取投影在指定GPU坐标且摄像机前方（深度）sZ处的点的3D坐标\r\n\t *\r\n\t * @param nX GPU空间坐标X\r\n\t * @param nY GPU空间坐标Y\r\n\t * @param sZ 到摄像机的距离\r\n\t * @param v 摄像机空间坐标（输出）\r\n\t * @return 摄像机空间坐标\r\n\t */\r\n\tunprojectWithDepth(nX: number, nY: number, sZ: number, v = new Vector3())\r\n\t{\r\n\t\treturn this.unprojectRay(nX, nY).getPointWithZ(sZ, v);\r\n\t}\r\n\r\n\t//\r\n\tprivate _inverseMatrix = new Matrix4x4();\r\n\tprivate _invertMatrixInvalid = true;\r\n\t//\r\n\tprotected _matrix = new Matrix4x4();\r\n\tprivate _matrixInvalid = true;\r\n\r\n\t/**\r\n\t * 投影矩阵失效\r\n\t */\r\n\tprotected invalidate()\r\n\t{\r\n\t\tconsole.assert(!isNaN(this.aspect));\r\n\r\n\t\tthis._matrixInvalid = true;\r\n\t\tthis._invertMatrixInvalid = true;\r\n\t\tthis.emit('lensChanged', this);\r\n\t}\r\n\r\n\tprivate _updateInverseMatrix()\r\n\t{\r\n\t\tthis._inverseMatrix.copy(this.matrix);\r\n\t\tthis._inverseMatrix.invert();\r\n\t}\r\n\r\n\t/**\r\n\t * 更新投影矩阵\r\n\t */\r\n\tprotected abstract _updateMatrix(): void;\r\n\r\n\t/**\r\n\t * 克隆\r\n\t */\r\n\tabstract clone(): LensBase;\r\n}\r\n","import { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { Projection } from '../Projection';\r\nimport { LensBase } from './LensBase';\r\n\r\n/**\r\n * 正射投影镜头\r\n */\r\nexport class OrthographicLens extends LensBase\r\n{\r\n    /**\r\n     * 尺寸\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidate')\r\n    size: number;\r\n\r\n    /**\r\n     * 构建正射投影镜头\r\n     * @param size 尺寸\r\n     */\r\n    constructor(size = 1, aspect = 1, near = 0.3, far = 1000)\r\n    {\r\n        super(aspect, near, far);\r\n        this._projectionType = Projection.Orthographic;\r\n        this.size = size;\r\n    }\r\n\r\n    protected _updateMatrix()\r\n    {\r\n        this._matrix.setOrtho(-this.size, this.size, this.size, -this.size, this.near, this.far);\r\n    }\r\n\r\n    clone()\r\n    {\r\n        return new OrthographicLens(this.size, this.aspect, this.near, this.far);\r\n    }\r\n}\r\n","import { Vector3, Vector4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { Projection } from '../Projection';\r\nimport { LensBase } from './LensBase';\r\n\r\n/**\r\n * 透视摄像机镜头\r\n */\r\nexport class PerspectiveLens extends LensBase\r\n{\r\n    /**\r\n     * 垂直视角，视锥体顶面和底面间的夹角；单位为角度，取值范围 [1,179]\r\n     */\r\n    @watch('invalidate')\r\n    @serialize\r\n    @oav()\r\n    fov: number;\r\n\r\n    /**\r\n     * 创建一个透视摄像机镜头\r\n     * @param fov 垂直视角，视锥体顶面和底面间的夹角；单位为角度，取值范围 [1,179]\r\n     *\r\n     */\r\n    constructor(fov = 60, aspect = 1, near = 0.3, far = 1000)\r\n    {\r\n        super(aspect, near, far);\r\n        this._projectionType = Projection.Perspective;\r\n        this.fov = fov;\r\n    }\r\n\r\n    /**\r\n     * 焦距\r\n     */\r\n    get focalLength(): number\r\n    {\r\n        return 1 / Math.tan(this.fov * Math.PI / 360);\r\n    }\r\n\r\n    set focalLength(value: number)\r\n    {\r\n        this.fov = Math.atan(1 / value) * 360 / Math.PI;\r\n    }\r\n\r\n    /**\r\n     * 投影\r\n     *\r\n     * 摄像机空间坐标投影到GPU空间坐标\r\n     *\r\n     * @param point3d 摄像机空间坐标\r\n     * @param v GPU空间坐标\r\n     * @return GPU空间坐标\r\n     */\r\n    project(point3d: Vector3, v = new Vector3()): Vector3\r\n    {\r\n        const v4 = this.matrix.transformVector4(Vector4.fromVector3(point3d, 1));\r\n        // 透视投影结果中w!=1，需要标准化齐次坐标\r\n        v4.scale(1 / v4.w);\r\n        v4.toVector3(v);\r\n\r\nreturn v;\r\n    }\r\n\r\n    /**\r\n     * 逆投影\r\n     *\r\n     * GPU空间坐标投影到摄像机空间坐标\r\n     *\r\n     * @param point3d GPU空间坐标\r\n     * @param v 摄像机空间坐标（输出）\r\n     * @returns 摄像机空间坐标\r\n     */\r\n    unproject(point3d: Vector3, v = new Vector3())\r\n    {\r\n        // ！！该计算过程需要参考或者研究透视投影矩阵\r\n        // 初始化齐次坐标\r\n        const p4 = Vector4.fromVector3(point3d, 1);\r\n        // 逆投影求出深度值\r\n        const v4 = this.inverseMatrix.transformVector4(p4);\r\n        const sZ = 1 / v4.w;\r\n        // 齐次坐标乘以深度值获取真实的投影结果\r\n        const p44 = p4.scaleTo(sZ);\r\n        // 计算逆投影\r\n        const v44 = this.inverseMatrix.transformVector4(p44);\r\n        // 输出3维坐标\r\n        v44.toVector3(v);\r\n\r\nreturn v;\r\n    }\r\n\r\n    protected _updateMatrix()\r\n    {\r\n        this._matrix.setPerspectiveFromFOV(this.fov, this.aspect, this.near, this.far);\r\n    }\r\n\r\n    clone()\r\n    {\r\n        return new PerspectiveLens(this.fov, this.aspect, this.near, this.far);\r\n    }\r\n}\r\n","import { Frustum, Matrix4x4, Ray3, Vector2, Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { Component, RegisterComponent } from '../component/Component';\r\nimport { GameObject } from '../core/GameObject';\r\nimport { AddComponentMenu } from '../Menu';\r\nimport { createNodeMenu } from '../menu/CreateNodeMenu';\r\nimport { LensBase } from './lenses/LensBase';\r\nimport { OrthographicLens } from './lenses/OrthographicLens';\r\nimport { PerspectiveLens } from './lenses/PerspectiveLens';\r\nimport { Projection } from './Projection';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsGameObjectEventMap\r\n    {\r\n        lensChanged;\r\n    }\r\n\r\n    export interface MixinsComponentMap\r\n    {\r\n        Camera: Camera;\r\n    }\r\n\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        Camera: GameObject;\r\n    }\r\n}\r\n\r\n/**\r\n * 摄像机\r\n */\r\n@AddComponentMenu('Rendering/Camera')\r\n@RegisterComponent()\r\nexport class Camera extends Component\r\n{\r\n    __class__: 'feng3d.Camera';\r\n\r\n    // /**\r\n    //  * How the camera clears the background.\r\n    //  *\r\n    //  * @todo\r\n    //  */\r\n    // @oav({ component: \"OAVEnum\", componentParam: { enumClass: CameraClearFlags }, tooltip: `What to display in empty areas of this Camera's view.\\n\\nChoose Skybox to display a skybox in empty areas, defaulting to a background color if no skybox is found.\\n\\nChoose Solid Color to display a background color in empty areas.\\n\\nChoose Depth Only to display nothing in empty areas.\\n\\nChoose Don't Clear to display whatever was displayed in the previous frame in empty areas.` })\r\n    // @serialize\r\n    // clearFlags = CameraClearFlags.Skybox;\r\n\r\n    get single() { return true; }\r\n\r\n    @oav({ component: 'OAVEnum', componentParam: { enumClass: Projection } })\r\n    get projection()\r\n    {\r\n        return this.lens && this.lens.projectionType;\r\n    }\r\n    set projection(v)\r\n    {\r\n        const projectionType = this.projection;\r\n        if (projectionType === v) return;\r\n        //\r\n        let aspect = 1;\r\n        let near = 0.3;\r\n        let far = 1000;\r\n        if (this.lens)\r\n        {\r\n            aspect = this.lens.aspect;\r\n            near = this.lens.near;\r\n            far = this.lens.far;\r\n            serialization.setValue(this._backups, this.lens as any);\r\n        }\r\n        const fov = this._backups ? this._backups.fov : 60;\r\n        const size = this._backups ? this._backups.size : 1;\r\n        if (v === Projection.Perspective)\r\n        {\r\n            this.lens = new PerspectiveLens(fov, aspect, near, far);\r\n        }\r\n        else\r\n        {\r\n            this.lens = new OrthographicLens(size, aspect, near, far);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 镜头\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVObjectView' })\r\n    get lens()\r\n    {\r\n        return this._lens;\r\n    }\r\n    set lens(v)\r\n    {\r\n        if (this._lens === v) return;\r\n\r\n        if (this._lens)\r\n        {\r\n            this._lens.off('lensChanged', this.invalidateViewProjection, this);\r\n        }\r\n        this._lens = v;\r\n        if (this._lens)\r\n        {\r\n            this._lens.on('lensChanged', this.invalidateViewProjection, this);\r\n        }\r\n\r\n        this.invalidateViewProjection();\r\n\r\n        this.emit('refreshView');\r\n        this.emit('lensChanged');\r\n    }\r\n    private _lens: LensBase;\r\n\r\n    /**\r\n     * 场景投影矩阵，世界空间转投影空间\r\n     */\r\n    get viewProjection(): Matrix4x4\r\n    {\r\n        if (this._viewProjectionInvalid)\r\n        {\r\n            // 场景空间转摄像机空间\r\n            this._viewProjection.copy(this.transform.worldToLocalMatrix);\r\n            // +摄像机空间转投影空间 = 场景空间转投影空间\r\n            this._viewProjection.append(this.lens.matrix);\r\n            this._viewProjectionInvalid = false;\r\n        }\r\n\r\n        return this._viewProjection;\r\n    }\r\n\r\n    /**\r\n     * 获取摄像机的截头锥体\r\n     */\r\n    get frustum()\r\n    {\r\n        if (this._frustumInvalid)\r\n        {\r\n            this._frustum.fromMatrix(this.viewProjection);\r\n            this._frustumInvalid = false;\r\n        }\r\n\r\n        return this._frustum;\r\n    }\r\n\r\n    /**\r\n     * 创建一个摄像机\r\n     */\r\n    init()\r\n    {\r\n        super.init();\r\n        this.lens = this.lens || new PerspectiveLens();\r\n        //\r\n        this.on('scenetransformChanged', this.invalidateViewProjection, this);\r\n        this.invalidateViewProjection();\r\n    }\r\n\r\n    /**\r\n     * 获取与坐标重叠的射线\r\n     * @param x view3D上的X坐标\r\n     * @param y view3D上的X坐标\r\n     * @return\r\n     */\r\n    getRay3D(x: number, y: number, ray3D = new Ray3()): Ray3\r\n    {\r\n        return this.lens.unprojectRay(x, y, ray3D).applyMatri4x4(this.transform.localToWorldMatrix);\r\n    }\r\n\r\n    /**\r\n     * 投影坐标（世界坐标转换为3D视图坐标）\r\n     * @param point3d 世界坐标\r\n     * @return 屏幕的绝对坐标\r\n     */\r\n    project(point3d: Vector3): Vector3\r\n    {\r\n        const v: Vector3 = this.lens.project(this.transform.worldToLocalMatrix.transformPoint3(point3d));\r\n\r\n        return v;\r\n    }\r\n\r\n    /**\r\n     * 屏幕坐标投影到场景坐标\r\n     * @param nX 屏幕坐标X ([0-width])\r\n     * @param nY 屏幕坐标Y ([0-height])\r\n     * @param sZ 到屏幕的距离\r\n     * @param v 场景坐标（输出）\r\n     * @return 场景坐标\r\n     */\r\n    unproject(sX: number, sY: number, sZ: number, v = new Vector3()): Vector3\r\n    {\r\n        return this.transform.localToWorldMatrix.transformPoint3(this.lens.unprojectWithDepth(sX, sY, sZ, v), v);\r\n    }\r\n\r\n    /**\r\n     * 获取摄像机能够在指定深度处的视野；镜头在指定深度的尺寸。\r\n     *\r\n     * @param   depth   深度\r\n     */\r\n    getScaleByDepth(depth: number, dir = new Vector2(0, 1))\r\n    {\r\n        const lt = this.unproject(-0.5 * dir.x, -0.5 * dir.y, depth);\r\n        const rb = this.unproject(+0.5 * dir.x, +0.5 * dir.y, depth);\r\n        const scale = lt.subTo(rb).length;\r\n\r\n        return scale;\r\n    }\r\n\r\n    /**\r\n     * 处理场景变换改变事件\r\n     */\r\n    protected invalidateViewProjection()\r\n    {\r\n        this._viewProjectionInvalid = true;\r\n        this._frustumInvalid = true;\r\n    }\r\n\r\n    //\r\n    private _viewProjection: Matrix4x4 = new Matrix4x4();\r\n    private _viewProjectionInvalid = true;\r\n    private _backups = { fov: 60, size: 1 };\r\n    private _frustum = new Frustum();\r\n    private _frustumInvalid = true;\r\n}\r\n\r\nGameObject.registerPrimitive('Camera', (g) =>\r\n{\r\n    g.addComponent(Camera);\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n    {\r\n        path: 'Camera',\r\n        priority: -2,\r\n        click: () =>\r\n            GameObject.createPrimitive('Camera')\r\n    }\r\n);\r\n\r\n","import { oav } from '@feng3d/objectview';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { Camera } from '../cameras/Camera';\r\nimport { AddComponentMenu } from '../Menu';\r\nimport { Component, RegisterComponent } from './Component';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        BillboardComponent: BillboardComponent;\r\n    }\r\n}\r\n\r\n@AddComponentMenu('Layout/BillboardComponent')\r\n@RegisterComponent()\r\nexport class BillboardComponent extends Component\r\n{\r\n    __class__: 'feng3d.BillboardComponent';\r\n\r\n    /**\r\n     * 相机\r\n     */\r\n    @oav()\r\n    @watch('_onCameraChanged')\r\n    camera: Camera;\r\n\r\n    init()\r\n    {\r\n        super.init();\r\n        this.transform.on('updateLocalToWorldMatrix', this._onUpdateLocalToWorldMatrix, this);\r\n        this._invalidHoldSizeMatrix();\r\n    }\r\n\r\n    private _onCameraChanged(property: string, oldValue: Camera, value: Camera)\r\n    {\r\n        if (oldValue) oldValue.off('scenetransformChanged', this._invalidHoldSizeMatrix, this);\r\n        if (value) value.on('scenetransformChanged', this._invalidHoldSizeMatrix, this);\r\n        this._invalidHoldSizeMatrix();\r\n    }\r\n\r\n    private _invalidHoldSizeMatrix()\r\n    {\r\n        if (this._gameObject) this.transform['_invalidateSceneTransform']();\r\n    }\r\n\r\n    private _onUpdateLocalToWorldMatrix()\r\n    {\r\n        const _localToWorldMatrix = this.transform['_localToWorldMatrix'];\r\n        if (_localToWorldMatrix && this.camera)\r\n        {\r\n            const camera = this.camera;\r\n            const cameraPos = camera.transform.worldPosition;\r\n            const yAxis = camera.transform.localToWorldMatrix.getAxisY();\r\n            _localToWorldMatrix.lookAt(cameraPos, yAxis);\r\n        }\r\n    }\r\n\r\n    dispose()\r\n    {\r\n        this.camera = null;\r\n        this.transform.off('updateLocalToWorldMatrix', this._onUpdateLocalToWorldMatrix, this);\r\n        super.dispose();\r\n    }\r\n}\r\n","import { Color4, Vector4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { RenderAtomic } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { Camera } from '../cameras/Camera';\r\nimport { AddComponentMenu } from '../Menu';\r\nimport { Scene } from '../scene/Scene';\r\nimport { Component, RegisterComponent } from './Component';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        CartoonComponent: CartoonComponent;\r\n    }\r\n\r\n    export interface MixinsUniforms\r\n    {\r\n        u_diffuseSegment: Vector4;\r\n        u_diffuseSegmentValue: Vector4;\r\n\r\n        u_specularSegment: number;\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * 参考\r\n */\r\n@AddComponentMenu('Rendering/CartoonComponent')\r\n@RegisterComponent()\r\nexport class CartoonComponent extends Component\r\n{\r\n    __class__: 'feng3d.CartoonComponent';\r\n\r\n    @oav()\r\n    @serialize\r\n    outlineSize = 1;\r\n\r\n    @oav()\r\n    @serialize\r\n    outlineColor = new Color4(0.2, 0.2, 0.2, 1.0);\r\n\r\n    @oav()\r\n    @serialize\r\n    outlineMorphFactor = 0.0;\r\n\r\n    /**\r\n     * 半兰伯特值diff，分段值 4个(0.0,1.0)\r\n     */\r\n    @oav()\r\n    @serialize\r\n    diffuseSegment = new Vector4(0.1, 0.3, 0.6, 1.0);\r\n    /**\r\n     * 半兰伯特值diff，替换分段值 4个(0.0,1.0)\r\n     */\r\n    @oav()\r\n    @serialize\r\n    diffuseSegmentValue = new Vector4(0.1, 0.3, 0.6, 1.0);\r\n\r\n    @oav()\r\n    @serialize\r\n    specularSegment = 0.5;\r\n\r\n    @oav()\r\n    @serialize\r\n    get cartoon_Anti_aliasing()\r\n    {\r\n        return this._cartoon_Anti_aliasing;\r\n    }\r\n    set cartoon_Anti_aliasing(value)\r\n    {\r\n        this._cartoon_Anti_aliasing = value;\r\n    }\r\n    _cartoon_Anti_aliasing = false;\r\n\r\n    beforeRender(renderAtomic: RenderAtomic, _scene: Scene, _camera: Camera)\r\n    {\r\n        renderAtomic.uniforms.u_diffuseSegment = this.diffuseSegment;\r\n        renderAtomic.uniforms.u_diffuseSegmentValue = this.diffuseSegmentValue;\r\n        renderAtomic.uniforms.u_specularSegment = this.specularSegment;\r\n        //\r\n        renderAtomic.uniforms.u_outlineSize = this.outlineSize;\r\n        renderAtomic.uniforms.u_outlineColor = this.outlineColor;\r\n        renderAtomic.uniforms.u_outlineMorphFactor = this.outlineMorphFactor;\r\n    }\r\n}\r\n","import { dataTransform } from '@feng3d/polyfill';\r\nimport { Component } from './Component';\r\n\r\n/**\r\n * Graphics 类包含一组可用来创建矢量形状的方法。\r\n */\r\nexport class Graphics extends Component\r\n{\r\n    __class__: 'feng3d.Graphics';\r\n\r\n    private image: HTMLImageElement;\r\n    private context2D: CanvasRenderingContext2D;\r\n    private canvas: HTMLCanvasElement;\r\n    private width: number;\r\n    private height: number;\r\n\r\n    constructor()\r\n    {\r\n        super();\r\n\r\n        this.canvas = document.createElement('canvas');\r\n        this.canvas.width = this.width;\r\n        this.canvas.height = this.height;\r\n        this.context2D = this.canvas.getContext('2d');\r\n\r\n        //\r\n        watchContext2D(this.context2D);\r\n    }\r\n\r\n    draw(width: number, height: number, callback: (context2D: CanvasRenderingContext2D) => void)\r\n    {\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n        const ctxt = canvas.getContext('2d');\r\n        callback(ctxt);\r\n        dataTransform.canvasToImage(canvas, 'png', 1, (img) =>\r\n        {\r\n            this.image = img;\r\n        });\r\n\r\n        return this;\r\n    }\r\n}\r\n\r\nexport function watchContext2D(context2D: CanvasRenderingContext2D, watchFuncs = ['rect'])\r\n{\r\n    watchFuncs.forEach((v) =>\r\n    {\r\n        const oldFunc = context2D[v];\r\n        context2D[v] = function (...args): void\r\n        {\r\n            oldFunc.apply(context2D, args);\r\n            // 标记更改\r\n            context2D['__changed'] = true;\r\n        };\r\n    });\r\n}\r\n\r\n// var ctxts = [];\r\n// var num = 100;\r\n// for (var i = 0; i < num; i++)\r\n// {\r\n//     var canvas = document.createElement(\"canvas\");\r\n//     canvas.width = 100;\r\n//     canvas.height = 100;\r\n//     var ctxt = canvas.getContext('2d');\r\n//     ctxts.push(ctxt);\r\n// }\r\n","import { oav } from '@feng3d/objectview';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { Camera } from '../cameras/Camera';\r\nimport { AddComponentMenu } from '../Menu';\r\nimport { RegisterComponent, Component } from './Component';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        HoldSizeComponent: HoldSizeComponent;\r\n    }\r\n}\r\n\r\n@AddComponentMenu('Layout/HoldSizeComponent')\r\n@RegisterComponent()\r\nexport class HoldSizeComponent extends Component\r\n{\r\n    __class__: 'feng3d.HoldSizeComponent';\r\n\r\n    /**\r\n     * 保持缩放尺寸\r\n     */\r\n    @oav()\r\n    @watch('_invalidateSceneTransform')\r\n    holdSize = 1;\r\n\r\n    /**\r\n     * 相机\r\n     */\r\n    @oav()\r\n    @watch('_onCameraChanged')\r\n    camera: Camera;\r\n\r\n    init()\r\n    {\r\n        this.transform.on('updateLocalToWorldMatrix', this._onUpdateLocalToWorldMatrix, this);\r\n    }\r\n\r\n    dispose()\r\n    {\r\n        this.camera = null;\r\n        this.transform.off('updateLocalToWorldMatrix', this._onUpdateLocalToWorldMatrix, this);\r\n        super.dispose();\r\n    }\r\n\r\n    private _onCameraChanged(property: string, oldValue: Camera, value: Camera)\r\n    {\r\n        if (oldValue) oldValue.off('scenetransformChanged', this._invalidateSceneTransform, this);\r\n        if (value) value.on('scenetransformChanged', this._invalidateSceneTransform, this);\r\n        this._invalidateSceneTransform();\r\n    }\r\n\r\n    private _invalidateSceneTransform()\r\n    {\r\n        if (this._gameObject) this.transform['_invalidateSceneTransform']();\r\n    }\r\n\r\n    private _onUpdateLocalToWorldMatrix()\r\n    {\r\n        const _localToWorldMatrix = this.transform['_localToWorldMatrix'];\r\n        if (this.holdSize && this.camera && _localToWorldMatrix)\r\n        {\r\n            const depthScale = this._getDepthScale(this.camera);\r\n            const vec = _localToWorldMatrix.toTRS();\r\n            vec[2].scaleNumber(depthScale * this.holdSize);\r\n            _localToWorldMatrix.fromTRS(vec[0], vec[1], vec[2]);\r\n\r\n            console.assert(!isNaN(_localToWorldMatrix.elements[0]));\r\n        }\r\n    }\r\n\r\n    private _getDepthScale(camera: Camera)\r\n    {\r\n        const cameraTranform = camera.transform.localToWorldMatrix;\r\n        const distance = this.transform.worldPosition.subTo(cameraTranform.getPosition());\r\n        if (distance.length === 0)\r\n        {\r\n            distance.x = 1;\r\n        }\r\n        const depth = distance.dot(cameraTranform.getAxisZ());\r\n        let scale = camera.getScaleByDepth(depth);\r\n        // 限制在放大缩小100倍之间，否则容易出现矩阵不可逆问题\r\n        scale = Math.max(Math.min(100, scale), 0.01);\r\n\r\n        return scale;\r\n    }\r\n}\r\n","import { Color4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { RenderAtomic } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { Camera } from '../cameras/Camera';\r\nimport { AddComponentMenu } from '../Menu';\r\nimport { Scene } from '../scene/Scene';\r\nimport { RegisterComponent, Component } from './Component';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        OutLineComponent: OutLineComponent;\r\n    }\r\n\r\n    export interface MixinsUniforms\r\n    {\r\n        /**\r\n         * 描边宽度\r\n         */\r\n        u_outlineSize: number;\r\n        /**\r\n         * 描边颜色\r\n         */\r\n        u_outlineColor: Color4;\r\n        /**\r\n         * 描边形态因子\r\n         * (0.0，1.0):0.0表示延法线方向，1.0表示延顶点方向\r\n         */\r\n        u_outlineMorphFactor: number;\r\n    }\r\n}\r\n\r\n@AddComponentMenu('Rendering/OutLineComponent')\r\n@RegisterComponent()\r\nexport class OutLineComponent extends Component\r\n{\r\n    __class__: 'feng3d.OutLineComponent';\r\n\r\n    @oav()\r\n    @serialize\r\n    size = 1;\r\n\r\n    @oav()\r\n    @serialize\r\n    color = new Color4(0.2, 0.2, 0.2, 1.0);\r\n\r\n    @oav()\r\n    @serialize\r\n    outlineMorphFactor = 0.0;\r\n\r\n    beforeRender(renderAtomic: RenderAtomic, _scene: Scene, _camera: Camera)\r\n    {\r\n        renderAtomic.uniforms.u_outlineSize = this.size;\r\n        renderAtomic.uniforms.u_outlineColor = this.color;\r\n        renderAtomic.uniforms.u_outlineMorphFactor = this.outlineMorphFactor;\r\n    }\r\n}\r\n","import { Color4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { RegisterComponent, Component } from './Component';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        WireframeComponent: WireframeComponent;\r\n    }\r\n}\r\n\r\n/**\r\n * 线框组件，将会对拥有该组件的对象绘制线框\r\n */\r\n@RegisterComponent()\r\nexport class WireframeComponent extends Component\r\n{\r\n    __class__: 'feng3d.WireframeComponent';\r\n\r\n    @oav()\r\n    color = new Color4(125 / 255, 176 / 255, 250 / 255);\r\n}\r\n","import { GameObject } from '../core/GameObject';\r\n\r\nexport class ControllerBase\r\n{\r\n    /**\r\n     * 控制对象\r\n     */\r\n    protected _targetObject: GameObject | undefined;\r\n\r\n    /**\r\n     * 控制器基类，用于动态调整3D对象的属性\r\n     */\r\n    constructor(targetObject?: GameObject)\r\n    {\r\n        this.targetObject = targetObject;\r\n    }\r\n\r\n    /**\r\n     * 手动应用更新到目标3D对象\r\n     */\r\n    update(_interpolate = true): void\r\n    {\r\n        throw new Error('Abstract method');\r\n    }\r\n\r\n    get targetObject()\r\n    {\r\n        return this._targetObject;\r\n    }\r\n\r\n    set targetObject(val)\r\n    {\r\n        this._targetObject = val;\r\n    }\r\n}\r\n","import { IEvent } from '@feng3d/event';\r\nimport { Vector2, Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { windowEventProxy } from '@feng3d/shortcut';\r\nimport { Behaviour } from '../component/Behaviour';\r\nimport { RegisterComponent } from '../component/Component';\r\nimport { RunEnvironment } from '../core/RunEnvironment';\r\nimport { AddComponentMenu } from '../Menu';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        FPSController: FPSController;\r\n    }\r\n}\r\n\r\n/**\r\n * FPS模式控制器\r\n */\r\n@AddComponentMenu('Controller/FPSController')\r\n@RegisterComponent()\r\nexport class FPSController extends Behaviour\r\n{\r\n    /**\r\n     * 加速度\r\n     */\r\n    @oav()\r\n    public acceleration = 0.001;\r\n\r\n    runEnvironment = RunEnvironment.feng3d;\r\n\r\n    /**\r\n     * 按键记录\r\n     */\r\n    private keyDownDic: { [key: string]: boolean };\r\n\r\n    /**\r\n     * 按键方向字典\r\n     */\r\n    private keyDirectionDic: { [key: string]: Vector3 };\r\n\r\n    /**\r\n     * 速度\r\n     */\r\n    private velocity: Vector3;\r\n\r\n    /**\r\n     * 上次鼠标位置\r\n     */\r\n    private preMousePoint: Vector2 | null;\r\n\r\n    private ischange = false;\r\n\r\n    private _auto: boolean;\r\n    get auto()\r\n    {\r\n        return this._auto;\r\n    }\r\n    set auto(value)\r\n    {\r\n        if (this._auto === value)\r\n        {\r\n            return;\r\n        }\r\n        if (this._auto)\r\n        {\r\n            windowEventProxy.off('mousedown', this.onMousedown, this);\r\n            windowEventProxy.off('mouseup', this.onMouseup, this);\r\n            this.onMouseup();\r\n        }\r\n        this._auto = value;\r\n        if (this._auto)\r\n        {\r\n            windowEventProxy.on('mousedown', this.onMousedown, this);\r\n            windowEventProxy.on('mouseup', this.onMouseup, this);\r\n        }\r\n    }\r\n\r\n    init()\r\n    {\r\n        super.init();\r\n\r\n        this.keyDirectionDic = {};\r\n        this.keyDirectionDic['a'] = new Vector3(-1, 0, 0);// 左\r\n        this.keyDirectionDic['d'] = new Vector3(1, 0, 0);// 右\r\n        this.keyDirectionDic['w'] = new Vector3(0, 0, 1);// 前\r\n        this.keyDirectionDic['s'] = new Vector3(0, 0, -1);// 后\r\n        this.keyDirectionDic['e'] = new Vector3(0, 1, 0);// 上\r\n        this.keyDirectionDic['q'] = new Vector3(0, -1, 0);// 下\r\n\r\n        this.keyDownDic = {};\r\n\r\n        this.auto = true;\r\n    }\r\n\r\n    onMousedown()\r\n    {\r\n        this.ischange = true;\r\n\r\n        this.preMousePoint = null;\r\n        this.mousePoint = null;\r\n        this.velocity = new Vector3();\r\n        this.keyDownDic = {};\r\n\r\n        windowEventProxy.on('keydown', this.onKeydown, this);\r\n        windowEventProxy.on('keyup', this.onKeyup, this);\r\n        windowEventProxy.on('mousemove', this.onMouseMove, this);\r\n    }\r\n\r\n    onMouseup()\r\n    {\r\n        this.ischange = false;\r\n        this.preMousePoint = null;\r\n        this.mousePoint = null;\r\n\r\n        windowEventProxy.off('keydown', this.onKeydown, this);\r\n        windowEventProxy.off('keyup', this.onKeyup, this);\r\n        windowEventProxy.off('mousemove', this.onMouseMove, this);\r\n    }\r\n\r\n    /**\r\n     * 销毁\r\n     */\r\n    dispose()\r\n    {\r\n        this.auto = false;\r\n    }\r\n\r\n    /**\r\n     * 手动应用更新到目标3D对象\r\n     */\r\n    update(): void\r\n    {\r\n        if (!this.ischange)\r\n        { return; }\r\n\r\n        if (this.mousePoint && this.preMousePoint)\r\n        {\r\n            // 计算旋转\r\n            const offsetPoint = this.mousePoint.subTo(this.preMousePoint);\r\n            offsetPoint.x *= 0.15;\r\n            offsetPoint.y *= 0.15;\r\n            // this.targetObject.transform.rotate(Vector3.X_AXIS, offsetPoint.y, this.targetObject.transform.position);\r\n            // this.targetObject.transform.rotate(Vector3.Y_AXIS, offsetPoint.x, this.targetObject.transform.position);\r\n\r\n            const matrix = this.transform.localToWorldMatrix;\r\n            matrix.appendRotation(matrix.getAxisX(), offsetPoint.y, matrix.getPosition());\r\n            const up = Vector3.Y_AXIS.clone();\r\n            if (matrix.getAxisY().dot(up) < 0)\r\n            {\r\n                up.scaleNumber(-1);\r\n            }\r\n            matrix.appendRotation(up, offsetPoint.x, matrix.getPosition());\r\n            this.transform.localToWorldMatrix = matrix;\r\n            //\r\n            this.preMousePoint = this.mousePoint;\r\n            this.mousePoint = null;\r\n        }\r\n\r\n        // 计算加速度\r\n        const accelerationVec = new Vector3();\r\n        for (const key in this.keyDirectionDic)\r\n        {\r\n            if (this.keyDownDic[key] === true)\r\n            {\r\n                const element = this.keyDirectionDic[key];\r\n                accelerationVec.add(element);\r\n            }\r\n        }\r\n        accelerationVec.scaleNumber(this.acceleration);\r\n        // 计算速度\r\n        this.velocity.add(accelerationVec);\r\n        const right = this.transform.matrix.getAxisX();\r\n        const up = this.transform.matrix.getAxisY();\r\n        const forward = this.transform.matrix.getAxisZ();\r\n        right.scaleNumber(this.velocity.x);\r\n        up.scaleNumber(this.velocity.y);\r\n        forward.scaleNumber(this.velocity.z);\r\n        // 计算位移\r\n        const displacement = right.clone();\r\n        displacement.add(up);\r\n        displacement.add(forward);\r\n        this.transform.x += displacement.x;\r\n        this.transform.y += displacement.y;\r\n        this.transform.z += displacement.z;\r\n    }\r\n    private mousePoint: Vector2 | null;\r\n    /**\r\n     * 处理鼠标移动事件\r\n     */\r\n    private onMouseMove(event: IEvent<MouseEvent>)\r\n    {\r\n        this.mousePoint = new Vector2(event.data.clientX, event.data.clientY);\r\n\r\n        if (!this.preMousePoint)\r\n        {\r\n            this.preMousePoint = this.mousePoint;\r\n            this.mousePoint = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 键盘按下事件\r\n     */\r\n    private onKeydown(event: IEvent<KeyboardEvent>): void\r\n    {\r\n        const boardKey = String.fromCharCode(event.data.keyCode).toLocaleLowerCase();\r\n        if (!this.keyDirectionDic[boardKey])\r\n        {\r\n            return;\r\n        }\r\n\r\n        if (!this.keyDownDic[boardKey])\r\n        { this.stopDirectionVelocity(this.keyDirectionDic[boardKey]); }\r\n        this.keyDownDic[boardKey] = true;\r\n    }\r\n\r\n    /**\r\n     * 键盘弹起事件\r\n     */\r\n    private onKeyup(event: IEvent<KeyboardEvent>): void\r\n    {\r\n        const boardKey = String.fromCharCode(event.data.keyCode).toLocaleLowerCase();\r\n        if (!this.keyDirectionDic[boardKey])\r\n        {\r\n            return;\r\n        }\r\n\r\n        this.keyDownDic[boardKey] = false;\r\n        this.stopDirectionVelocity(this.keyDirectionDic[boardKey]);\r\n    }\r\n\r\n    /**\r\n     * 停止xyz方向运动\r\n     * @param direction     停止运动的方向\r\n     */\r\n    private stopDirectionVelocity(direction: Vector3)\r\n    {\r\n        if (!direction)\r\n        {\r\n            return;\r\n        }\r\n        if (direction.x !== 0)\r\n        {\r\n            this.velocity.x = 0;\r\n        }\r\n        if (direction.y !== 0)\r\n        {\r\n            this.velocity.y = 0;\r\n        }\r\n        if (direction.z !== 0)\r\n        {\r\n            this.velocity.z = 0;\r\n        }\r\n    }\r\n}\r\n","import { Vector3 } from '@feng3d/math';\r\nimport { GameObject } from '../core/GameObject';\r\nimport { ControllerBase } from './ControllerBase';\r\n\r\nexport class LookAtController extends ControllerBase\r\n{\r\n    protected _lookAtPosition: Vector3;\r\n    protected _lookAtObject: GameObject;\r\n    protected _origin: Vector3 = new Vector3(0.0, 0.0, 0.0);\r\n    protected _upAxis: Vector3 = Vector3.Y_AXIS;\r\n    protected _pos: Vector3 = new Vector3();\r\n\r\n    constructor(target?: GameObject, lookAtObject?: GameObject)\r\n    {\r\n        super(target);\r\n\r\n        if (lookAtObject)\r\n        { this.lookAtObject = lookAtObject; }\r\n        else\r\n        { this.lookAtPosition = new Vector3(); }\r\n    }\r\n\r\n    get upAxis(): Vector3\r\n    {\r\n        return this._upAxis;\r\n    }\r\n\r\n    set upAxis(upAxis: Vector3)\r\n    {\r\n        this._upAxis = upAxis;\r\n    }\r\n\r\n    get lookAtPosition(): Vector3\r\n    {\r\n        return this._lookAtPosition;\r\n    }\r\n\r\n    set lookAtPosition(val: Vector3)\r\n    {\r\n        this._lookAtPosition = val;\r\n    }\r\n\r\n    get lookAtObject()\r\n    {\r\n        return this._lookAtObject;\r\n    }\r\n\r\n    set lookAtObject(value)\r\n    {\r\n        if (this._lookAtObject === value)\r\n        {\r\n            return;\r\n        }\r\n\r\n        this._lookAtObject = value;\r\n    }\r\n\r\n    update(_interpolate = true): void\r\n    {\r\n        if (this._targetObject)\r\n        {\r\n            if (this._lookAtPosition)\r\n            {\r\n                this._targetObject.transform.lookAt(this.lookAtPosition, this._upAxis);\r\n            }\r\n            else if (this._lookAtObject)\r\n            {\r\n                this._pos = this._lookAtObject.transform.position;\r\n                this._targetObject.transform.lookAt(this._pos, this._upAxis);\r\n            }\r\n        }\r\n    }\r\n}\r\n","import { mathUtil } from '@feng3d/polyfill';\r\nimport { GameObject } from '../core/GameObject';\r\nimport { LookAtController } from './LookAtController';\r\n\r\nexport class HoverController extends LookAtController\r\n{\r\n    _currentPanAngle = 0;\r\n    _currentTiltAngle = 90;\r\n    private _panAngle = 0;\r\n    private _tiltAngle = 90;\r\n    private _distance = 1000;\r\n    private _minPanAngle = -Infinity;\r\n    private _maxPanAngle = Infinity;\r\n    private _minTiltAngle = -90;\r\n    private _maxTiltAngle = 90;\r\n    private _steps = 8;\r\n    private _yFactor = 2;\r\n    private _wrapPanAngle = false;\r\n    get steps(): number\r\n    {\r\n        return this._steps;\r\n    }\r\n\r\n    set steps(val: number)\r\n    {\r\n        val = (val < 1) ? 1 : val;\r\n        if (this._steps === val)\r\n        {\r\n            return;\r\n        }\r\n        this._steps = val;\r\n        this.update();\r\n    }\r\n\r\n    get panAngle(): number\r\n    {\r\n        return this._panAngle;\r\n    }\r\n\r\n    set panAngle(val: number)\r\n    {\r\n        val = Math.max(this._minPanAngle, Math.min(this._maxPanAngle, val));\r\n        if (this._panAngle === val)\r\n        {\r\n            return;\r\n        }\r\n        this._panAngle = val;\r\n        this.update();\r\n    }\r\n\r\n    get tiltAngle(): number\r\n    {\r\n        return this._tiltAngle;\r\n    }\r\n\r\n    set tiltAngle(val: number)\r\n    {\r\n        val = Math.max(this._minTiltAngle, Math.min(this._maxTiltAngle, val));\r\n        if (this._tiltAngle === val)\r\n        {\r\n            return;\r\n        }\r\n        this._tiltAngle = val;\r\n        this.update();\r\n    }\r\n\r\n    get distance(): number\r\n    {\r\n        return this._distance;\r\n    }\r\n\r\n    set distance(val: number)\r\n    {\r\n        if (this._distance === val)\r\n        {\r\n            return;\r\n        }\r\n        this._distance = val;\r\n        this.update();\r\n    }\r\n\r\n    get minPanAngle(): number\r\n    {\r\n        return this._minPanAngle;\r\n    }\r\n\r\n    set minPanAngle(val: number)\r\n    {\r\n        if (this._minPanAngle === val)\r\n        {\r\n            return;\r\n        }\r\n        this._minPanAngle = val;\r\n        this.panAngle = Math.max(this._minPanAngle, Math.min(this._maxPanAngle, this._panAngle));\r\n    }\r\n\r\n    get maxPanAngle(): number\r\n    {\r\n        return this._maxPanAngle;\r\n    }\r\n\r\n    set maxPanAngle(val: number)\r\n    {\r\n        if (this._maxPanAngle === val)\r\n        {\r\n            return;\r\n        }\r\n        this._maxPanAngle = val;\r\n        this.panAngle = Math.max(this._minPanAngle, Math.min(this._maxPanAngle, this._panAngle));\r\n    }\r\n\r\n    get minTiltAngle(): number\r\n    {\r\n        return this._minTiltAngle;\r\n    }\r\n\r\n    set minTiltAngle(val: number)\r\n    {\r\n        if (this._minTiltAngle === val)\r\n        {\r\n            return;\r\n        }\r\n        this._minTiltAngle = val;\r\n        this.tiltAngle = Math.max(this._minTiltAngle, Math.min(this._maxTiltAngle, this._tiltAngle));\r\n    }\r\n\r\n    get maxTiltAngle(): number\r\n    {\r\n        return this._maxTiltAngle;\r\n    }\r\n\r\n    set maxTiltAngle(val: number)\r\n    {\r\n        if (this._maxTiltAngle === val)\r\n        {\r\n            return;\r\n        }\r\n        this._maxTiltAngle = val;\r\n        this.tiltAngle = Math.max(this._minTiltAngle, Math.min(this._maxTiltAngle, this._tiltAngle));\r\n    }\r\n\r\n    get yFactor(): number\r\n    {\r\n        return this._yFactor;\r\n    }\r\n\r\n    set yFactor(val: number)\r\n    {\r\n        if (this._yFactor === val)\r\n        {\r\n            return;\r\n        }\r\n        this._yFactor = val;\r\n        this.update();\r\n    }\r\n\r\n    get wrapPanAngle(): boolean\r\n    {\r\n        return this._wrapPanAngle;\r\n    }\r\n\r\n    set wrapPanAngle(val: boolean)\r\n    {\r\n        if (this._wrapPanAngle === val)\r\n        {\r\n            return;\r\n        }\r\n        this._wrapPanAngle = val;\r\n        this.update();\r\n    }\r\n\r\n    // eslint-disable-next-line max-params\r\n    constructor(targetObject?: GameObject, lookAtObject?: GameObject, panAngle = 0, tiltAngle = 90, distance = 1000, minTiltAngle = -90, maxTiltAngle = 90, minPanAngle = NaN, maxPanAngle = NaN, steps = 8, yFactor = 2, wrapPanAngle = false)\r\n    {\r\n        super(targetObject, lookAtObject);\r\n        this.distance = distance;\r\n        this.panAngle = panAngle;\r\n        this.tiltAngle = tiltAngle;\r\n        this.minPanAngle = minPanAngle || -Infinity;\r\n        this.maxPanAngle = maxPanAngle || Infinity;\r\n        this.minTiltAngle = minTiltAngle;\r\n        this.maxTiltAngle = maxTiltAngle;\r\n        this.steps = steps;\r\n        this.yFactor = yFactor;\r\n        this.wrapPanAngle = wrapPanAngle;\r\n        this._currentPanAngle = this._panAngle;\r\n        this._currentTiltAngle = this._tiltAngle;\r\n    }\r\n\r\n    update(interpolate = true)\r\n    {\r\n        if (this._tiltAngle !== this._currentTiltAngle || this._panAngle !== this._currentPanAngle)\r\n        {\r\n            if (this._wrapPanAngle)\r\n            {\r\n                if (this._panAngle < 0)\r\n                {\r\n                    this._currentPanAngle += this._panAngle % 360 + 360 - this._panAngle;\r\n                    this._panAngle = this._panAngle % 360 + 360;\r\n                }\r\n                else\r\n                {\r\n                    this._currentPanAngle += this._panAngle % 360 - this._panAngle;\r\n                    this._panAngle = this._panAngle % 360;\r\n                }\r\n                while (this._panAngle - this._currentPanAngle < -180)\r\n                { this._currentPanAngle -= 360; }\r\n                while (this._panAngle - this._currentPanAngle > 180)\r\n                { this._currentPanAngle += 360; }\r\n            }\r\n            if (interpolate)\r\n            {\r\n                this._currentTiltAngle += (this._tiltAngle - this._currentTiltAngle) / (this.steps + 1);\r\n                this._currentPanAngle += (this._panAngle - this._currentPanAngle) / (this.steps + 1);\r\n            }\r\n            else\r\n            {\r\n                this._currentPanAngle = this._panAngle;\r\n                this._currentTiltAngle = this._tiltAngle;\r\n            }\r\n            if ((Math.abs(this.tiltAngle - this._currentTiltAngle) < 0.01) && (Math.abs(this._panAngle - this._currentPanAngle) < 0.01))\r\n            {\r\n                this._currentTiltAngle = this._tiltAngle;\r\n                this._currentPanAngle = this._panAngle;\r\n            }\r\n        }\r\n        if (!this._targetObject)\r\n        { return; }\r\n        if (this._lookAtPosition)\r\n        {\r\n            this._pos.x = this._lookAtPosition.x;\r\n            this._pos.y = this._lookAtPosition.y;\r\n            this._pos.z = this._lookAtPosition.z;\r\n        }\r\n        else if (this._lookAtObject)\r\n        {\r\n            if (this._targetObject.transform.parent && this._lookAtObject.transform.parent)\r\n            {\r\n                if (this._targetObject.transform.parent !== this._lookAtObject.transform.parent)\r\n                {\r\n                    this._pos.x = this._lookAtObject.transform.worldPosition.x;\r\n                    this._pos.y = this._lookAtObject.transform.worldPosition.y;\r\n                    this._pos.z = this._lookAtObject.transform.worldPosition.z;\r\n                    this._targetObject.transform.parent.worldToLocalMatrix.transformPoint3(this._pos, this._pos);\r\n                }\r\n                else\r\n                {\r\n                    this._pos.copy(this._lookAtObject.transform.position);\r\n                }\r\n            }\r\n            else if (this._lookAtObject.scene)\r\n            {\r\n                this._pos.x = this._lookAtObject.transform.worldPosition.x;\r\n                this._pos.y = this._lookAtObject.transform.worldPosition.y;\r\n                this._pos.z = this._lookAtObject.transform.worldPosition.z;\r\n            }\r\n            else\r\n            {\r\n                this._pos.copy(this._lookAtObject.transform.position);\r\n            }\r\n        }\r\n        else\r\n        {\r\n            this._pos.x = this._origin.x;\r\n            this._pos.y = this._origin.y;\r\n            this._pos.z = this._origin.z;\r\n        }\r\n        this._targetObject.transform.x = this._pos.x + this._distance * Math.sin(this._currentPanAngle * mathUtil.DEG2RAD) * Math.cos(this._currentTiltAngle * mathUtil.DEG2RAD);\r\n        this._targetObject.transform.z = this._pos.z + this._distance * Math.cos(this._currentPanAngle * mathUtil.DEG2RAD) * Math.cos(this._currentTiltAngle * mathUtil.DEG2RAD);\r\n        this._targetObject.transform.y = this._pos.y + this._distance * Math.sin(this._currentTiltAngle * mathUtil.DEG2RAD) * this._yFactor;\r\n        super.update();\r\n    }\r\n}\r\n","import { RegisterComponent } from '../component/Component';\r\nimport { Renderable } from './Renderable';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap { MeshRenderer: MeshRenderer }\r\n}\r\n\r\n/**\r\n * 网格渲染器\r\n */\r\n@RegisterComponent()\r\nexport class MeshRenderer extends Renderable\r\n{\r\n    __class__: 'feng3d.MeshRenderer';\r\n}\r\n","import { Ray3, Vector2, Vector3 } from '@feng3d/math';\r\nimport { CullFace } from '@feng3d/renderer';\r\nimport { GameObject } from '../core/GameObject';\r\nimport { RayCastable } from '../core/RayCastable';\r\nimport { Geometry } from '../geometry/Geometry';\r\n\r\n/**\r\n * 射线投射拾取器\r\n */\r\nexport class Raycaster\r\n{\r\n    /**\r\n     * 获取射线穿过的实体\r\n     * @param ray3D 射线\r\n     * @param gameObjects 实体列表\r\n     * @return\r\n     */\r\n    pick(ray3D: Ray3, gameObjects: GameObject[])\r\n    {\r\n        if (gameObjects.length === 0) return null;\r\n\r\n        const pickingCollisionVOs = gameObjects.reduce((pv: PickingCollisionVO[], gameObject) =>\r\n        {\r\n            const model = gameObject.getComponent(RayCastable);\r\n            const pickingCollisionVO = model && model.worldRayIntersection(ray3D);\r\n            if (pickingCollisionVO) pv.push(pickingCollisionVO);\r\n\r\n            return pv;\r\n        }, []);\r\n\r\n        if (pickingCollisionVOs.length === 0) return null;\r\n\r\n        // 根据与包围盒距离进行排序\r\n        pickingCollisionVOs.sort((a, b) => a.rayEntryDistance - b.rayEntryDistance);\r\n\r\n        let shortestCollisionDistance = Number.MAX_VALUE;\r\n        let bestCollisionVO: PickingCollisionVO = null;\r\n        const collisionVOs: PickingCollisionVO[] = [];\r\n\r\n        for (let i = 0; i < pickingCollisionVOs.length; ++i)\r\n        {\r\n            const pickingCollisionVO = pickingCollisionVOs[i];\r\n            if (!bestCollisionVO || pickingCollisionVO.rayEntryDistance < bestCollisionVO.rayEntryDistance)\r\n            {\r\n                const result = pickingCollisionVO.geometry.raycast(pickingCollisionVO.localRay, shortestCollisionDistance, pickingCollisionVO.cullFace);\r\n                if (result)\r\n                {\r\n                    pickingCollisionVO.rayEntryDistance = result.rayEntryDistance;\r\n                    pickingCollisionVO.index = result.index;\r\n                    pickingCollisionVO.localNormal = result.localNormal;\r\n                    pickingCollisionVO.localPosition = result.localPosition;\r\n                    pickingCollisionVO.uv = result.uv;\r\n                    //\r\n                    shortestCollisionDistance = pickingCollisionVO.rayEntryDistance;\r\n                    collisionVOs.push(pickingCollisionVO);\r\n                    bestCollisionVO = pickingCollisionVO;\r\n                }\r\n            }\r\n        }\r\n\r\n        return bestCollisionVO;\r\n    }\r\n\r\n    /**\r\n     * 获取射线穿过的实体\r\n     * @param ray3D 射线\r\n     * @param gameObjects 实体列表\r\n     * @return\r\n     */\r\n    pickAll(ray3D: Ray3, gameObjects: GameObject[])\r\n    {\r\n        if (gameObjects.length === 0) return [];\r\n\r\n        const pickingCollisionVOs = gameObjects.reduce((pv: PickingCollisionVO[], gameObject) =>\r\n        {\r\n            const model = gameObject.getComponent(RayCastable);\r\n            const pickingCollisionVO = model && model.worldRayIntersection(ray3D);\r\n            if (pickingCollisionVO) pv.push(pickingCollisionVO);\r\n\r\n            return pv;\r\n        }, []);\r\n\r\n        if (pickingCollisionVOs.length === 0) return [];\r\n\r\n        const collisionVOs = pickingCollisionVOs.filter((v) =>\r\n        {\r\n            const result = v.geometry.raycast(v.localRay, Number.MAX_VALUE, v.cullFace);\r\n            if (result)\r\n            {\r\n                v.rayEntryDistance = result.rayEntryDistance;\r\n                v.index = result.index;\r\n                v.localNormal = result.localNormal;\r\n                v.localPosition = result.localPosition;\r\n                v.uv = result.uv;\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        });\r\n\r\n        return collisionVOs;\r\n    }\r\n}\r\n\r\n/**\r\n * 射线投射拾取器\r\n */\r\nexport const raycaster = new Raycaster();\r\n\r\n/**\r\n * 拾取的碰撞数据\r\n */\r\nexport interface PickingCollisionVO\r\n{\r\n    /**\r\n     * 第一个穿过的物体\r\n     */\r\n    gameObject: GameObject;\r\n\r\n    /**\r\n     * 碰撞的uv坐标\r\n     */\r\n    uv?: Vector2;\r\n\r\n    /**\r\n     * 实体上碰撞本地坐标\r\n     */\r\n    localPosition?: Vector3;\r\n\r\n    /**\r\n     * 射线顶点到实体的距离\r\n     */\r\n    rayEntryDistance: number;\r\n\r\n    /**\r\n     * 本地坐标系射线\r\n     */\r\n    localRay: Ray3;\r\n\r\n    /**\r\n     * 本地坐标碰撞法线\r\n     */\r\n    localNormal: Vector3;\r\n\r\n    /**\r\n     * 射线坐标是否在边界内\r\n     */\r\n    rayOriginIsInsideBounds: boolean;\r\n\r\n    /**\r\n     * 碰撞三角形索引\r\n     */\r\n    index?: number;\r\n\r\n    /**\r\n     * 碰撞关联的渲染对象\r\n     */\r\n    geometry: Geometry;\r\n\r\n    /**\r\n     * 剔除面\r\n     */\r\n    cullFace: CullFace;\r\n}\r\n\r\n","import { EventEmitter, IEvent } from '@feng3d/event';\r\nimport { Rectangle } from '@feng3d/math';\r\nimport { Lazy, lazy } from '@feng3d/polyfill';\r\nimport { windowEventProxy } from '@feng3d/shortcut';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { Camera } from '../cameras/Camera';\r\nimport { raycaster } from '../pick/Raycaster';\r\nimport { Scene } from '../scene/Scene';\r\nimport { GameObject } from './GameObject';\r\nimport { View } from './View';\r\n\r\n/**\r\n * 鼠标事件管理\r\n */\r\nexport class Mouse3DManager\r\n{\r\n    @watch('_mouseInputChanged')\r\n    mouseInput: MouseInput;\r\n\r\n    get selectedGameObject()\r\n    {\r\n        return this._selectedGameObject;\r\n    }\r\n    set selectedGameObject(v)\r\n    {\r\n        this.setSelectedGameObject(v);\r\n    }\r\n\r\n    /**\r\n     * 视窗，鼠标在该矩形内时为有效事件\r\n     */\r\n    viewport: Lazy<Rectangle>;\r\n\r\n    /**\r\n     * 拾取\r\n     * @param scene 场景\r\n     * @param _camera 摄像机\r\n     */\r\n    pick(view: View, scene: Scene, _camera: Camera)\r\n    {\r\n        if (this._mouseEventTypes.length === 0) return;\r\n        // 计算得到鼠标射线相交的物体\r\n        const pickingCollisionVO = raycaster.pick(view.mouseRay3D, scene.mouseCheckObjects);\r\n\r\n        const gameobject = pickingCollisionVO && pickingCollisionVO.gameObject;\r\n\r\n        return gameobject;\r\n    }\r\n\r\n    constructor(mouseInput: MouseInput, viewport?: Lazy<Rectangle>)\r\n    {\r\n        //\r\n        this.mouseInput = mouseInput;\r\n        this.viewport = viewport;\r\n    }\r\n\r\n    private _selectedGameObject: GameObject;\r\n    private _mouseEventTypes: string[] = [];\r\n\r\n    /**\r\n     * 鼠标按下时的对象，用于与鼠标弹起时对象做对比，如果相同触发click\r\n     */\r\n    private preMouseDownGameObject: GameObject | null;\r\n    /**\r\n     * 统计处理click次数，判断是否达到dblclick\r\n     */\r\n    private gameObjectClickNum: number;\r\n\r\n    private _mouseInputChanged(_property: string, oldValue: MouseInput, newValue: MouseInput)\r\n    {\r\n        if (oldValue)\r\n        {\r\n            mouseEventTypes.forEach((element) =>\r\n            {\r\n                oldValue.off(element, this.onMouseEvent, this);\r\n            });\r\n        }\r\n        if (newValue)\r\n        {\r\n            mouseEventTypes.forEach((element) =>\r\n            {\r\n                newValue.on(element, this.onMouseEvent, this);\r\n            });\r\n        }\r\n    }\r\n\r\n    private dispatch(type)\r\n    {\r\n        if (this.viewport)\r\n        {\r\n            const bound = lazy.getvalue(this.viewport);\r\n            if (!bound.contains(windowEventProxy.clientX, windowEventProxy.clientY))\r\n            { return; }\r\n        }\r\n\r\n        if (this._mouseEventTypes.indexOf(type) === -1)\r\n        { this._mouseEventTypes.push(type); }\r\n    }\r\n\r\n    /**\r\n     * 监听鼠标事件收集事件类型\r\n     */\r\n    private onMouseEvent(event: IEvent<any>)\r\n    {\r\n        this.dispatch(event.type);\r\n    }\r\n\r\n    /**\r\n     * 设置选中对象\r\n     */\r\n    private setSelectedGameObject(value: GameObject)\r\n    {\r\n        if (this._selectedGameObject !== value)\r\n        {\r\n            if (this._selectedGameObject)\r\n            { this._selectedGameObject.emit('mouseout', null, true); }\r\n            if (value)\r\n            { value.emit('mouseover', null, true); }\r\n        }\r\n        this._selectedGameObject = value;\r\n        this._mouseEventTypes.forEach((element) =>\r\n        {\r\n            switch (element)\r\n            {\r\n                case 'mousedown':\r\n                    if (this.preMouseDownGameObject !== this._selectedGameObject)\r\n                    {\r\n                        this.gameObjectClickNum = 0;\r\n                        this.preMouseDownGameObject = this._selectedGameObject;\r\n                    }\r\n                    this._selectedGameObject && this._selectedGameObject.emit(element, null, true);\r\n                    break;\r\n                case 'mouseup':\r\n                    if (this._selectedGameObject === this.preMouseDownGameObject)\r\n                    {\r\n                        this.gameObjectClickNum++;\r\n                    }\r\n                    else\r\n                    {\r\n                        this.gameObjectClickNum = 0;\r\n                        this.preMouseDownGameObject = null;\r\n                    }\r\n                    this._selectedGameObject && this._selectedGameObject.emit(element, null, true);\r\n                    break;\r\n                case 'mousemove':\r\n                    this._selectedGameObject && this._selectedGameObject.emit(element, null, true);\r\n                    break;\r\n                case 'click':\r\n                    if (this.gameObjectClickNum > 0)\r\n                    { this._selectedGameObject && this._selectedGameObject.emit(element, null, true); }\r\n                    break;\r\n                case 'dblclick':\r\n                    if (this.gameObjectClickNum > 1)\r\n                    {\r\n                        this._selectedGameObject && this._selectedGameObject.emit(element, null, true);\r\n                        this.gameObjectClickNum = 0;\r\n                    }\r\n                    break;\r\n            }\r\n        });\r\n        this._mouseEventTypes.length = 0;\r\n    }\r\n}\r\n\r\n/**\r\n * 鼠标事件输入\r\n */\r\nexport class MouseInput<T = MouseEventMap> extends EventEmitter<T>\r\n{\r\n    /**\r\n     * 是否启动\r\n     */\r\n    enable = true;\r\n\r\n    /**\r\n     * 是否捕获鼠标移动\r\n     */\r\n    catchMouseMove = false;\r\n\r\n    /**\r\n     * 将事件调度到事件流中. 事件目标是对其调用 dispatchEvent() 方法的 IEvent 对象。\r\n     * @param type                      事件的类型。类型区分大小写。\r\n     * @param data                      事件携带的自定义数据。\r\n     * @param bubbles                   表示事件是否为冒泡事件。如果事件可以冒泡，则此值为 true；否则为 false。\r\n     */\r\n    emit<K extends keyof T & string>(type: K, data?: T[K], bubbles = false)\r\n    {\r\n        if (!this.enable)\r\n        { return null; }\r\n        if (!this.catchMouseMove && type === 'mousemove')\r\n        { return null; }\r\n\r\n        return super.emit(type, data, bubbles);\r\n    }\r\n\r\n    /**\r\n     * 派发事件\r\n     * @param event   事件对象\r\n     */\r\n    emitEvent<K extends keyof T & string>(event: IEvent<T[K]>)\r\n    {\r\n        if (!this.enable)\r\n        { return event; }\r\n        if (!this.catchMouseMove && event.type === 'mousemove')\r\n        { return event; }\r\n\r\n        return super.emitEvent(event);\r\n    }\r\n}\r\n\r\n/**\r\n * 鼠标事件列表\r\n */\r\nconst mouseEventTypes: (keyof MouseEventMap)[]\r\n    = [\r\n        'mouseout',\r\n        'mouseover',\r\n        'mousemove',\r\n        'mousedown',\r\n        'mouseup',\r\n        'click',\r\n        'middlemousedown',\r\n        'middlemouseup',\r\n        'middleclick',\r\n        'rightmousedown',\r\n        'rightmouseup',\r\n        'rightclick',\r\n        'dblclick',\r\n    ];\r\n\r\n/**\r\n * Window鼠标事件输入\r\n */\r\nexport class WindowMouseInput extends MouseInput\r\n{\r\n    constructor()\r\n    {\r\n        super();\r\n        windowEventProxy.on('click', this.onMouseEvent, this);\r\n        windowEventProxy.on('dblclick', this.onMouseEvent, this);\r\n        windowEventProxy.on('mousedown', this.onMouseEvent, this);\r\n        windowEventProxy.on('mouseup', this.onMouseEvent, this);\r\n        windowEventProxy.on('mousemove', this.onMouseEvent, this);\r\n    }\r\n\r\n    /**\r\n     * 监听鼠标事件收集事件类型\r\n     */\r\n    private onMouseEvent(event: IEvent<MouseEvent>)\r\n    {\r\n        const mouseEvent = event.data;\r\n        let type = mouseEvent.type;\r\n        // 处理鼠标中键与右键\r\n        if (mouseEvent instanceof MouseEvent)\r\n        {\r\n            if (['click', 'mousedown', 'mouseup'].indexOf(mouseEvent.type) !== -1)\r\n            {\r\n                type = ['', 'middle', 'right'][mouseEvent.button] + mouseEvent.type;\r\n            }\r\n        }\r\n\r\n        this.emit(<any>type, { mouseX: mouseEvent.clientX, mouseY: mouseEvent.clientY });\r\n    }\r\n}\r\n\r\nexport interface MouseEventMap\r\n{\r\n    /**\r\n     * 鼠标移出对象\r\n     */\r\n    mouseout: { clientX: number, clientY: number }\r\n    /**\r\n     * 鼠标移入对象\r\n     */\r\n    mouseover: { clientX: number, clientY: number }\r\n    /**\r\n     * 鼠标在对象上移动\r\n     */\r\n    mousemove: { clientX: number, clientY: number }\r\n    /**\r\n     * 鼠标左键按下\r\n     */\r\n    mousedown: { clientX: number, clientY: number }\r\n    /**\r\n     * 鼠标左键弹起\r\n     */\r\n    mouseup: { clientX: number, clientY: number }\r\n    /**\r\n     * 单击\r\n     */\r\n    click: { clientX: number, clientY: number }\r\n    /**\r\n     * 鼠标中键按下\r\n     */\r\n    middlemousedown: { clientX: number, clientY: number }\r\n    /**\r\n     * 鼠标中键弹起\r\n     */\r\n    middlemouseup: { clientX: number, clientY: number }\r\n    /**\r\n     * 鼠标中键单击\r\n     */\r\n    middleclick: { clientX: number, clientY: number }\r\n    /**\r\n     * 鼠标右键按下\r\n     */\r\n    rightmousedown: { clientX: number, clientY: number }\r\n    /**\r\n     * 鼠标右键弹起\r\n     */\r\n    rightmouseup: { clientX: number, clientY: number }\r\n    /**\r\n     * 鼠标右键单击\r\n     */\r\n    rightclick: { clientX: number, clientY: number }\r\n    /**\r\n     * 鼠标双击\r\n     */\r\n    dblclick: { clientX: number, clientY: number }\r\n}\r\n","import { ScriptComponent } from './ScriptComponent';\r\n\r\n/**\r\n * 3d对象脚本\r\n */\r\nexport class Script\r\n{\r\n    /**\r\n     * The game object this component is attached to. A component is always attached to a game object.\r\n     */\r\n    get gameObject()\r\n    {\r\n        return this.component.gameObject;\r\n    }\r\n\r\n    /**\r\n     * The Transform attached to this GameObject (null if there is none attached).\r\n     */\r\n    get transform()\r\n    {\r\n        return this.gameObject.transform;\r\n    }\r\n\r\n    /**\r\n     * 宿主组件\r\n     */\r\n    component: ScriptComponent;\r\n\r\n    constructor()\r\n    {\r\n    }\r\n\r\n    /**\r\n     * Use this for initialization\r\n     */\r\n    init()\r\n    {\r\n\r\n    }\r\n\r\n    /**\r\n     * Update is called once per frame\r\n     * 每帧执行一次\r\n     */\r\n    update()\r\n    {\r\n\r\n    }\r\n\r\n    /**\r\n     * 销毁\r\n     */\r\n    dispose()\r\n    {\r\n\r\n    }\r\n}\r\n","import { IEvent } from '@feng3d/event';\r\nimport { Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { RenderAtomic } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watcher } from '@feng3d/watcher';\r\nimport { Camera } from '../cameras/Camera';\r\nimport { Component, RegisterComponent } from '../component/Component';\r\nimport { AddComponentMenu } from '../Menu';\r\nimport { Scene } from '../scene/Scene';\r\nimport { ticker } from '../utils/Ticker';\r\nimport { GameObject } from './GameObject';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsGameObjectEventMap\r\n    {\r\n        /**\r\n         * 尺寸变化事件\r\n         */\r\n        sizeChanged: TransformLayout;\r\n\r\n        /**\r\n         * 中心点变化事件\r\n         */\r\n        pivotChanged: TransformLayout;\r\n    }\r\n\r\n    export interface MixinsComponentMap\r\n    {\r\n        TransformLayout: TransformLayout;\r\n    }\r\n}\r\n\r\n/**\r\n * 变换布局\r\n *\r\n * 提供了比Transform更加适用于2D元素的API\r\n *\r\n * 通过修改Transform的数值实现\r\n */\r\n@AddComponentMenu('Layout/TransformLayout')\r\n@RegisterComponent()\r\nexport class TransformLayout extends Component\r\n{\r\n    get single() { return true; }\r\n\r\n    /**\r\n     * 创建一个实体，该类为虚类\r\n     */\r\n    constructor()\r\n    {\r\n        super();\r\n\r\n        watcher.watch(this._position, 'x', this._invalidateLayout, this);\r\n        watcher.watch(this._position, 'y', this._invalidateLayout, this);\r\n        watcher.watch(this._position, 'z', this._invalidateLayout, this);\r\n        watcher.watch(this.anchorMin, 'x', this._invalidateLayout, this);\r\n        watcher.watch(this.anchorMin, 'y', this._invalidateLayout, this);\r\n        watcher.watch(this.anchorMin, 'z', this._invalidateLayout, this);\r\n        watcher.watch(this.anchorMax, 'x', this._invalidateLayout, this);\r\n        watcher.watch(this.anchorMax, 'y', this._invalidateLayout, this);\r\n        watcher.watch(this.anchorMax, 'z', this._invalidateLayout, this);\r\n        //\r\n        watcher.watch(this._leftTop, 'x', this._invalidateSize, this);\r\n        watcher.watch(this._leftTop, 'y', this._invalidateSize, this);\r\n        watcher.watch(this._leftTop, 'z', this._invalidateSize, this);\r\n        watcher.watch(this._rightBottom, 'x', this._invalidateSize, this);\r\n        watcher.watch(this._rightBottom, 'y', this._invalidateSize, this);\r\n        watcher.watch(this._rightBottom, 'z', this._invalidateSize, this);\r\n        //\r\n        watcher.watch(this._size, 'x', this._invalidateSize, this);\r\n        watcher.watch(this._size, 'y', this._invalidateSize, this);\r\n        watcher.watch(this._size, 'z', this._invalidateSize, this);\r\n        watcher.watch(this.pivot, 'x', this._invalidatePivot, this);\r\n        watcher.watch(this.pivot, 'y', this._invalidatePivot, this);\r\n        watcher.watch(this.pivot, 'z', this._invalidatePivot, this);\r\n        //\r\n        this.on('added', this._onAdded, this);\r\n        this.on('removed', this._onRemoved, this);\r\n    }\r\n\r\n    private _onAdded(event: IEvent<{ parent: GameObject; }>)\r\n    {\r\n        event.data.parent.on('sizeChanged', this._invalidateLayout, this);\r\n        event.data.parent.on('pivotChanged', this._invalidateLayout, this);\r\n        this._invalidateLayout();\r\n    }\r\n\r\n    private _onRemoved(event: IEvent<{ parent: GameObject; }>)\r\n    {\r\n        event.data.parent.off('sizeChanged', this._invalidateLayout, this);\r\n        event.data.parent.off('pivotChanged', this._invalidateLayout, this);\r\n    }\r\n\r\n    /**\r\n     * 位移\r\n     */\r\n    @oav({ tooltip: '当anchorMin.x == anchorMax.x时对position.x赋值生效，当 anchorMin.y == anchorMax.y 时对position.y赋值生效，否则赋值无效，自动被覆盖。', componentParam: { step: 1, stepScale: 1, stepDownup: 1 } })\r\n    @serialize\r\n    get position()\r\n    {\r\n        this._updateLayout();\r\n\r\n        return this._position;\r\n    }\r\n    set position(v) { this._position.copy(v); }\r\n    private readonly _position = new Vector3();\r\n\r\n    /**\r\n     * 尺寸，宽高。\r\n     */\r\n    @oav({ tooltip: '宽度，不会影响到缩放值。当 anchorMin.x == anchorMax.x 时对 size.x 赋值生效，当anchorMin.y == anchorMax.y时对 size.y 赋值生效，否则赋值无效，自动被覆盖。', componentParam: { step: 1, stepScale: 1, stepDownup: 1 } })\r\n    @serialize\r\n    get size()\r\n    {\r\n        this._updateLayout();\r\n\r\n        return this._size;\r\n    }\r\n    set size(v) { this._size.copy(v); }\r\n    private _size = new Vector3(1, 1, 1);\r\n\r\n    /**\r\n     * 与最小最大锚点形成的边框的left、right、top、bottom距离。当 anchorMin.x != anchorMax.x 时对 layout.x layout.y 赋值生效，当 anchorMin.y != anchorMax.y 时对 layout.z layout.w 赋值生效，否则赋值无效，自动被覆盖。\r\n     */\r\n    @oav({ tooltip: '与最小最大锚点形成的边框的left、right、top、bottom距离。当 anchorMin.x != anchorMax.x 时对 layout.x layout.y 赋值生效，当 anchorMin.y != anchorMax.y 时对 layout.z layout.w 赋值生效，否则赋值无效，自动被覆盖。', componentParam: { step: 1, stepScale: 1, stepDownup: 1 } })\r\n    @serialize\r\n    get leftTop()\r\n    {\r\n        return this._leftTop;\r\n    }\r\n    set leftTop(v)\r\n    {\r\n        this._leftTop.copy(v);\r\n    }\r\n    private _leftTop = new Vector3(0, 0, 0);\r\n\r\n    /**\r\n     * 与最小最大锚点形成的边框的left、right、top、bottom距离。当 anchorMin.x != anchorMax.x 时对 layout.x layout.y 赋值生效，当 anchorMin.y != anchorMax.y 时对 layout.z layout.w 赋值生效，否则赋值无效，自动被覆盖。\r\n     */\r\n    @oav({ tooltip: '与最小最大锚点形成的边框的left、right、top、bottom距离。当 anchorMin.x != anchorMax.x 时对 layout.x layout.y 赋值生效，当 anchorMin.y != anchorMax.y 时对 layout.z layout.w 赋值生效，否则赋值无效，自动被覆盖。', componentParam: { step: 1, stepScale: 1, stepDownup: 1 } })\r\n    @serialize\r\n    get rightBottom()\r\n    {\r\n        return this._rightBottom;\r\n    }\r\n    set rightBottom(v)\r\n    {\r\n        this._rightBottom.copy(v);\r\n    }\r\n    private _rightBottom = new Vector3(0, 0, 0);\r\n\r\n    /**\r\n     * 最小锚点，父Transform2D中左上角锚定的规范化位置。\r\n     */\r\n    @oav({ tooltip: '父Transform2D中左上角锚定的规范化位置。', componentParam: { step: 0.01, stepScale: 0.01, stepDownup: 0.01 } })\r\n    @serialize\r\n    anchorMin = new Vector3(0.5, 0.5, 0.5);\r\n\r\n    /**\r\n     * 最大锚点，父Transform2D中左上角锚定的规范化位置。\r\n     */\r\n    @oav({ tooltip: '最大锚点，父Transform2D中左上角锚定的规范化位置。', componentParam: { step: 0.01, stepScale: 0.01, stepDownup: 0.01 } })\r\n    @serialize\r\n    anchorMax = new Vector3(0.5, 0.5, 0.5);\r\n\r\n    /**\r\n     * The normalized position in this RectTransform that it rotates around.\r\n     */\r\n    @oav({ tooltip: '中心点' })\r\n    @serialize\r\n    pivot = new Vector3(0.5, 0.5, 0.5);\r\n\r\n    beforeRender(_renderAtomic: RenderAtomic, _scene: Scene, _camera: Camera)\r\n    {\r\n        // renderAtomic.uniforms.u_rect = this.rect;\r\n    }\r\n\r\n    private _updateLayout()\r\n    {\r\n        if (!this._layoutInvalid) return;\r\n\r\n        const transformLayout = this.gameObject && this.gameObject.parent && this.gameObject.parent.getComponent(TransformLayout);\r\n        if (!transformLayout) return;\r\n\r\n        // 中心点基于anchorMin的坐标\r\n        const position = this._position;\r\n        // 尺寸\r\n        const size = this._size;\r\n        const leftTop = this._leftTop;\r\n        const rightBottom = this._rightBottom;\r\n\r\n        // 最小锚点\r\n        const anchorMin = this.anchorMin.clone();\r\n        // 最大锚点\r\n        const anchorMax = this.anchorMax.clone();\r\n        const pivot = this.pivot.clone();\r\n\r\n        // 父对象显示区域宽高\r\n        const parentSize = transformLayout.size;\r\n        const parentPivot = transformLayout.pivot;\r\n        // 锚点在父Transform2D中锚定的 leftRightTopBottom 位置。\r\n        const anchorLeftTop = new Vector3(\r\n            anchorMin.x * parentSize.x - parentPivot.x * parentSize.x,\r\n            anchorMin.y * parentSize.y - parentPivot.y * parentSize.y,\r\n            anchorMin.z * parentSize.z - parentPivot.z * parentSize.z,\r\n        );\r\n        const anchorRightBottom = new Vector3(\r\n            anchorMax.x * parentSize.x - parentPivot.x * parentSize.x,\r\n            anchorMax.y * parentSize.y - parentPivot.y * parentSize.y,\r\n            anchorMax.z * parentSize.z - parentPivot.z * parentSize.z,\r\n        );\r\n\r\n        if (anchorMin.x === anchorMax.x)\r\n        {\r\n            leftTop.x = (-pivot.x * size.x + position.x) - anchorLeftTop.x;\r\n            rightBottom.x = anchorRightBottom.x - (size.x - pivot.x * size.x + position.x);\r\n        }\r\n        else\r\n        {\r\n            size.x = (anchorRightBottom.x - rightBottom.x) - (anchorLeftTop.x + leftTop.x);\r\n            position.x = leftTop.x + pivot.x * size.x;\r\n        }\r\n\r\n        if (anchorMin.y === anchorMax.y)\r\n        {\r\n            leftTop.y = (-pivot.y * size.y + position.y) - anchorLeftTop.y;\r\n            rightBottom.y = anchorRightBottom.y - (size.y - pivot.y * size.y + position.y);\r\n        }\r\n        else\r\n        {\r\n            size.y = (anchorRightBottom.y - rightBottom.y) - (anchorLeftTop.y + leftTop.y);\r\n            position.y = leftTop.y + pivot.y * size.y;\r\n        }\r\n\r\n        if (anchorMin.z === anchorMax.z)\r\n        {\r\n            leftTop.z = (-pivot.z * size.z + position.z) - anchorLeftTop.z;\r\n            rightBottom.z = anchorRightBottom.z - (size.z - pivot.z * size.z + position.z);\r\n        }\r\n        else\r\n        {\r\n            size.z = (anchorRightBottom.z - rightBottom.z) - (anchorLeftTop.z + leftTop.z);\r\n            position.z = leftTop.z + pivot.z * size.z;\r\n        }\r\n\r\n        //\r\n        this.transform.position.x = anchorLeftTop.x + position.x;\r\n        this.transform.position.y = anchorLeftTop.y + position.y;\r\n        this.transform.position.z = anchorLeftTop.z + position.z;\r\n        //\r\n        this._layoutInvalid = false;\r\n        ticker.offframe(this._updateLayout, this);\r\n    }\r\n\r\n    /**\r\n     * 布局是否失效\r\n     */\r\n    private _layoutInvalid = true;\r\n\r\n    private _invalidateLayout()\r\n    {\r\n        this._layoutInvalid = true;\r\n        ticker.onframe(this._updateLayout, this);\r\n    }\r\n\r\n    private _invalidateSize()\r\n    {\r\n        this._invalidateLayout();\r\n        this.emit('sizeChanged', this);\r\n    }\r\n\r\n    private _invalidatePivot()\r\n    {\r\n        this._invalidateLayout();\r\n        this.emit('pivotChanged', this);\r\n    }\r\n}\r\n","import { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { GameObject } from '../core/GameObject';\r\nimport { MeshRenderer } from '../core/MeshRenderer';\r\nimport { Geometry } from '../geometry/Geometry';\r\nimport { createNodeMenu } from '../menu/CreateNodeMenu';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsGeometryTypes\r\n    {\r\n        PlaneGeometry: PlaneGeometry\r\n    }\r\n\r\n    export interface MixinsDefaultGeometry\r\n    {\r\n        Plane: PlaneGeometry;\r\n    }\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        Plane: GameObject;\r\n    }\r\n}\r\n\r\n/**\r\n * 平面几何体\r\n */\r\nexport class PlaneGeometry extends Geometry\r\n{\r\n    __class__: 'feng3d.PlaneGeometry';\r\n\r\n    /**\r\n     * 宽度\r\n     */\r\n    @oav()\r\n    @serialize\r\n    @watch('invalidateGeometry')\r\n    width = 1;\r\n\r\n    /**\r\n     * 高度\r\n     */\r\n    @oav()\r\n    @serialize\r\n    @watch('invalidateGeometry')\r\n    height = 1;\r\n\r\n    /**\r\n     * 横向分割数\r\n     */\r\n    @oav()\r\n    @serialize\r\n    @watch('invalidateGeometry')\r\n    segmentsW = 1;\r\n\r\n    /**\r\n     * 纵向分割数\r\n     */\r\n    @oav()\r\n    @serialize\r\n    @watch('invalidateGeometry')\r\n    segmentsH = 1;\r\n\r\n    /**\r\n     * 是否朝上\r\n     */\r\n    @oav()\r\n    @serialize\r\n    @watch('invalidateGeometry')\r\n    yUp = true;\r\n\r\n    name = 'Plane';\r\n\r\n    /**\r\n     * 构建几何体数据\r\n     */\r\n    protected buildGeometry()\r\n    {\r\n        const vertexPositionData = this.buildPosition();\r\n        this.positions = vertexPositionData;\r\n\r\n        const vertexNormalData = this.buildNormal();\r\n        this.normals = vertexNormalData;\r\n\r\n        const vertexTangentData = this.buildTangent();\r\n        this.tangents = vertexTangentData;\r\n\r\n        const uvData = this.buildUVs();\r\n        this.uvs = uvData;\r\n\r\n        const indices = this.buildIndices();\r\n        this.indices = indices;\r\n    }\r\n\r\n    /**\r\n     * 构建顶点坐标\r\n     * @param this.width 宽度\r\n     * @param this.height 高度\r\n     * @param this.segmentsW 横向分割数\r\n     * @param this.segmentsH 纵向分割数\r\n     * @param this.yUp 正面朝向 true:Y+ false:Z+\r\n     */\r\n    private buildPosition()\r\n    {\r\n        const vertexPositionData: number[] = [];\r\n        let x: number; let\r\n            y: number;\r\n        let positionIndex = 0;\r\n        for (let yi = 0; yi <= this.segmentsH; ++yi)\r\n        {\r\n            for (let xi = 0; xi <= this.segmentsW; ++xi)\r\n            {\r\n                x = (xi / this.segmentsW - 0.5) * this.width;\r\n                y = (yi / this.segmentsH - 0.5) * this.height;\r\n\r\n                // 设置坐标数据\r\n                vertexPositionData[positionIndex++] = x;\r\n                if (this.yUp)\r\n                {\r\n                    vertexPositionData[positionIndex++] = 0;\r\n                    vertexPositionData[positionIndex++] = y;\r\n                }\r\n                else\r\n                {\r\n                    vertexPositionData[positionIndex++] = y;\r\n                    vertexPositionData[positionIndex++] = 0;\r\n                }\r\n            }\r\n        }\r\n\r\n        return vertexPositionData;\r\n    }\r\n\r\n    /**\r\n     * 构建顶点法线\r\n     * @param this.segmentsW 横向分割数\r\n     * @param this.segmentsH 纵向分割数\r\n     * @param this.yUp 正面朝向 true:Y+ false:Z+\r\n     */\r\n    private buildNormal()\r\n    {\r\n        const vertexNormalData: number[] = [];\r\n\r\n        let normalIndex = 0;\r\n        for (let yi = 0; yi <= this.segmentsH; ++yi)\r\n        {\r\n            for (let xi = 0; xi <= this.segmentsW; ++xi)\r\n            {\r\n                // 设置法线数据\r\n                vertexNormalData[normalIndex++] = 0;\r\n                if (this.yUp)\r\n                {\r\n                    vertexNormalData[normalIndex++] = 1;\r\n                    vertexNormalData[normalIndex++] = 0;\r\n                }\r\n                else\r\n                {\r\n                    vertexNormalData[normalIndex++] = 0;\r\n                    vertexNormalData[normalIndex++] = 1;\r\n                }\r\n            }\r\n        }\r\n\r\n        return vertexNormalData;\r\n    }\r\n\r\n    /**\r\n     * 构建顶点切线\r\n     * @param this.segmentsW 横向分割数\r\n     * @param this.segmentsH 纵向分割数\r\n     * @param this.yUp 正面朝向 true:Y+ false:Z+\r\n     */\r\n    private buildTangent()\r\n    {\r\n        const vertexTangentData: number[] = [];\r\n        let tangentIndex = 0;\r\n        for (let yi = 0; yi <= this.segmentsH; ++yi)\r\n        {\r\n            for (let xi = 0; xi <= this.segmentsW; ++xi)\r\n            {\r\n                if (this.yUp)\r\n                {\r\n                    vertexTangentData[tangentIndex++] = 1;\r\n                    vertexTangentData[tangentIndex++] = 0;\r\n                    vertexTangentData[tangentIndex++] = 0;\r\n                }\r\n                else\r\n                {\r\n                    vertexTangentData[tangentIndex++] = -1;\r\n                    vertexTangentData[tangentIndex++] = 0;\r\n                    vertexTangentData[tangentIndex++] = 0;\r\n                }\r\n            }\r\n        }\r\n\r\n        return vertexTangentData;\r\n    }\r\n\r\n    /**\r\n     * 构建顶点索引\r\n     * @param this.segmentsW 横向分割数\r\n     * @param this.segmentsH 纵向分割数\r\n     * @param this.yUp 正面朝向 true:Y+ false:Z+\r\n     */\r\n    private buildIndices()\r\n    {\r\n        const indices: number[] = [];\r\n        const tw = this.segmentsW + 1;\r\n\r\n        let numIndices = 0;\r\n        let base: number;\r\n        for (let yi = 0; yi <= this.segmentsH; ++yi)\r\n        {\r\n            for (let xi = 0; xi <= this.segmentsW; ++xi)\r\n            {\r\n                // 生成索引数据\r\n                if (xi !== this.segmentsW && yi !== this.segmentsH)\r\n                {\r\n                    base = xi + yi * tw;\r\n                    if (this.yUp)\r\n                    {\r\n                        indices[numIndices++] = base;\r\n                        indices[numIndices++] = base + tw;\r\n                        indices[numIndices++] = base + tw + 1;\r\n                        indices[numIndices++] = base;\r\n                        indices[numIndices++] = base + tw + 1;\r\n                        indices[numIndices++] = base + 1;\r\n                    }\r\n                    else\r\n                    {\r\n                        indices[numIndices++] = base;\r\n                        indices[numIndices++] = base + tw + 1;\r\n                        indices[numIndices++] = base + tw;\r\n                        indices[numIndices++] = base;\r\n                        indices[numIndices++] = base + 1;\r\n                        indices[numIndices++] = base + tw + 1;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return indices;\r\n    }\r\n\r\n    /**\r\n     * 构建uv\r\n     * @param this.segmentsW 横向分割数\r\n     * @param this.segmentsH 纵向分割数\r\n     */\r\n    private buildUVs()\r\n    {\r\n        const data: number[] = [];\r\n        let index = 0;\r\n\r\n        for (let yi = 0; yi <= this.segmentsH; ++yi)\r\n        {\r\n            for (let xi = 0; xi <= this.segmentsW; ++xi)\r\n            {\r\n                if (this.yUp)\r\n                {\r\n                    data[index++] = xi / this.segmentsW;\r\n                    data[index++] = 1 - yi / this.segmentsH;\r\n                }\r\n                else\r\n                {\r\n                    data[index++] = 1 - xi / this.segmentsW;\r\n                    data[index++] = 1 - yi / this.segmentsH;\r\n                }\r\n            }\r\n        }\r\n\r\n        return data;\r\n    }\r\n}\r\n\r\nGeometry.setDefault('Plane', new PlaneGeometry(), { width: 10, height: 10 });\r\n\r\nGameObject.registerPrimitive('Plane', (g) =>\r\n{\r\n    g.addComponent(MeshRenderer).geometry = Geometry.getDefault('Plane');\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n    {\r\n        path: '3D Object/Plane',\r\n        priority: -5,\r\n        click: () =>\r\n            GameObject.createPrimitive('Plane')\r\n    }\r\n);\r\n\r\n","import { TextureFormat, TextureMagFilter, TextureMinFilter } from '@feng3d/renderer';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { Texture2D } from './Texture2D';\r\n\r\n/**\r\n * 渲染目标纹理\r\n */\r\nexport class RenderTargetTexture2D extends Texture2D\r\n{\r\n    @watch('invalidate')\r\n    OFFSCREEN_WIDTH = 1024;\r\n\r\n    @watch('invalidate')\r\n    OFFSCREEN_HEIGHT = 1024;\r\n\r\n    format = TextureFormat.RGBA;\r\n\r\n    minFilter = TextureMinFilter.NEAREST;\r\n\r\n    magFilter = TextureMagFilter.NEAREST;\r\n\r\n    isRenderTarget = true;\r\n}\r\n","/**\r\n * 灯光类型\r\n */\r\nexport enum LightType\r\n{\r\n    /**\r\n     * 方向光\r\n     */\r\n    Directional = 0,\r\n    /**\r\n     * 点光\r\n     */\r\n    Point = 1,\r\n    /**\r\n     * 聚光灯\r\n     */\r\n    Spot = 2\r\n}\r\n","import { FrameBuffer, GL, RenderBuffer, Texture, WebGLRenderer } from '@feng3d/renderer';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { RenderTargetTexture2D } from '../textures/RenderTargetTexture2D';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsGLCache\r\n    {\r\n        /**\r\n         * 此处用于缓存，需要获取有效数据请调用 Attribute.getBuffer\r\n         */\r\n        frameBufferObjects: Map<FrameBufferObject, {\r\n            framebuffer: WebGLFramebuffer, texture: WebGLTexture, depthBuffer: WebGLRenderbuffer\r\n        }>;\r\n    }\r\n}\r\n\r\n/**\r\n * 帧缓冲对象\r\n */\r\nexport class FrameBufferObject\r\n{\r\n    @watch('invalidateSize')\r\n    OFFSCREEN_WIDTH = 1024;\r\n\r\n    @watch('invalidateSize')\r\n    OFFSCREEN_HEIGHT = 1024;\r\n\r\n    @watch('invalidate')\r\n    frameBuffer: FrameBuffer;\r\n\r\n    @watch('invalidate')\r\n    texture: RenderTargetTexture2D;\r\n\r\n    @watch('invalidate')\r\n    depthBuffer: RenderBuffer;\r\n\r\n    constructor(width = 1024, height = 1024)\r\n    {\r\n        this.frameBuffer = new FrameBuffer();\r\n        this.texture = new RenderTargetTexture2D();\r\n        this.depthBuffer = new RenderBuffer();\r\n        this.OFFSCREEN_WIDTH = width;\r\n        this.OFFSCREEN_HEIGHT = height;\r\n    }\r\n\r\n    static active(gl: GL, frameBufferObject: FrameBufferObject)\r\n    {\r\n        if (frameBufferObject._invalid)\r\n        {\r\n            frameBufferObject._invalid = false;\r\n            this.clear(frameBufferObject);\r\n        }\r\n\r\n        gl.cache.frameBufferObjects = gl.cache.frameBufferObjects || new Map();\r\n        let obj = gl.cache.frameBufferObjects.get(frameBufferObject);\r\n        if (!obj)\r\n        {\r\n            const framebuffer = FrameBuffer.active(gl, frameBufferObject.frameBuffer);\r\n            const texture = Texture.active(gl, frameBufferObject.texture);\r\n            const depthBuffer = RenderBuffer.active(gl, frameBufferObject.depthBuffer);\r\n\r\n            // 绑定帧缓冲区对象\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\r\n            // 设置颜色关联对象\r\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\r\n            // 设置深度关联对象\r\n            gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, depthBuffer);\r\n\r\n            // 检查Framebuffer状态\r\n            const e = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\r\n            if (gl.FRAMEBUFFER_COMPLETE !== e)\r\n            {\r\n                console.warn(`Frame buffer object is incomplete: ${e.toString()}`);\r\n\r\n                return null;\r\n            }\r\n\r\n            gl.bindTexture(gl.TEXTURE_2D, null);\r\n            gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n\r\n            obj = { framebuffer, texture, depthBuffer };\r\n            gl.cache.frameBufferObjects.set(frameBufferObject, obj);\r\n        }\r\n        else\r\n        {\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, obj.framebuffer);\r\n        }\r\n\r\n        return obj;\r\n    }\r\n\r\n    deactive(gl: GL)\r\n    {\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n    }\r\n\r\n    /**\r\n     * 是否失效\r\n     */\r\n    private _invalid = true;\r\n\r\n    /**\r\n     * 使失效\r\n     */\r\n    protected invalidate()\r\n    {\r\n        this._invalid = true;\r\n    }\r\n\r\n    private invalidateSize()\r\n    {\r\n        if (this.texture)\r\n        {\r\n            this.texture.OFFSCREEN_WIDTH = this.OFFSCREEN_WIDTH;\r\n            this.texture.OFFSCREEN_HEIGHT = this.OFFSCREEN_HEIGHT;\r\n        }\r\n        if (this.depthBuffer)\r\n        {\r\n            this.depthBuffer.OFFSCREEN_WIDTH = this.OFFSCREEN_WIDTH;\r\n            this.depthBuffer.OFFSCREEN_HEIGHT = this.OFFSCREEN_HEIGHT;\r\n        }\r\n        this._invalid = true;\r\n    }\r\n\r\n    static clear(frameBufferObject: FrameBufferObject)\r\n    {\r\n        WebGLRenderer.glList.forEach((gl) =>\r\n        {\r\n            gl.cache.frameBufferObjects = gl.cache.frameBufferObjects || new Map();\r\n\r\n            const buffer = gl.cache.frameBufferObjects.get(frameBufferObject);\r\n            if (buffer)\r\n            {\r\n                gl.cache.frameBufferObjects.delete(frameBufferObject);\r\n            }\r\n        });\r\n    }\r\n}\r\n","import { Color3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { BlendFactor } from '@feng3d/renderer';\r\nimport { serialize, serialization } from '@feng3d/serialization';\r\nimport { Camera } from '../cameras/Camera';\r\nimport { Behaviour } from '../component/Behaviour';\r\nimport { BillboardComponent } from '../component/BillboardComponent';\r\nimport { GameObject } from '../core/GameObject';\r\nimport { HideFlags } from '../core/HideFlags';\r\nimport { Renderable } from '../core/Renderable';\r\nimport { Material } from '../materials/Material';\r\nimport { PlaneGeometry } from '../primitives/PlaneGeometry';\r\nimport { FrameBufferObject } from '../render/FrameBufferObject';\r\nimport { Scene } from '../scene/Scene';\r\nimport { LightType } from './LightType';\r\nimport { ShadowType } from './shadow/ShadowType';\r\n\r\n/**\r\n * 灯光\r\n */\r\nexport class Light extends Behaviour\r\n{\r\n    /**\r\n     * 灯光类型\r\n     */\r\n    @serialize\r\n    lightType: LightType;\r\n\r\n    /**\r\n     * 颜色\r\n     */\r\n    @oav()\r\n    @serialize\r\n    color = new Color3();\r\n\r\n    /**\r\n     * 光照强度\r\n     */\r\n    @oav()\r\n    @serialize\r\n    intensity = 1;\r\n\r\n    /**\r\n     * 阴影类型\r\n     */\r\n    @oav({ component: 'OAVEnum', componentParam: { enumClass: ShadowType } })\r\n    @serialize\r\n    shadowType = ShadowType.No_Shadows;\r\n\r\n    /**\r\n     * 光源位置\r\n     */\r\n    get position()\r\n    {\r\n        return this.transform.worldPosition;\r\n    }\r\n\r\n    /**\r\n     * 光照方向\r\n     */\r\n    get direction()\r\n    {\r\n        return this.transform.localToWorldMatrix.getAxisZ();\r\n    }\r\n\r\n    /**\r\n     * 阴影偏差，用来解决判断是否为阴影时精度问题\r\n     */\r\n    shadowBias = -0.005;\r\n\r\n    /**\r\n     * 阴影半径，边缘宽度\r\n     */\r\n    shadowRadius = 1;\r\n\r\n    /**\r\n     * 阴影近平面距离\r\n     */\r\n    get shadowCameraNear()\r\n    {\r\n        return this.shadowCamera.lens.near;\r\n    }\r\n\r\n    /**\r\n     * 阴影近平面距离\r\n     */\r\n    get shadowCameraFar()\r\n    {\r\n        return this.shadowCamera.lens.far;\r\n    }\r\n\r\n    /**\r\n     * 投影摄像机\r\n     */\r\n    shadowCamera: Camera;\r\n\r\n    /**\r\n     * 阴影图尺寸\r\n     */\r\n    get shadowMapSize()\r\n    {\r\n        return this.shadowMap.getSize();\r\n    }\r\n\r\n    get shadowMap()\r\n    {\r\n        return this.frameBufferObject.texture;\r\n    }\r\n\r\n    /**\r\n     * 帧缓冲对象，用于处理光照阴影贴图渲染\r\n     */\r\n    frameBufferObject = new FrameBufferObject();\r\n\r\n    @oav({ tooltip: '是否调试阴影图' })\r\n    debugShadowMap = false;\r\n\r\n    private debugShadowMapObject: GameObject;\r\n\r\n    constructor()\r\n    {\r\n        super();\r\n        this.shadowCamera = serialization.setValue(new GameObject(), { name: 'LightShadowCamera' }).addComponent(Camera);\r\n    }\r\n\r\n    updateDebugShadowMap(scene: Scene, viewCamera: Camera)\r\n    {\r\n        let gameObject = this.debugShadowMapObject;\r\n        if (!gameObject)\r\n        {\r\n            gameObject = this.debugShadowMapObject = GameObject.createPrimitive('Plane', { name: 'debugShadowMapObject' });\r\n            gameObject.hideFlags = HideFlags.Hide | HideFlags.DontSave;\r\n            gameObject.mouseEnabled = false;\r\n            gameObject.addComponent(BillboardComponent);\r\n\r\n            // 材质\r\n            const model = gameObject.getComponent(Renderable);\r\n            model.geometry = serialization.setValue(new PlaneGeometry(), { width: this.lightType === LightType.Point ? 1 : 0.5, height: 0.5, segmentsW: 1, segmentsH: 1, yUp: false });\r\n            const textureMaterial = model.material = serialization.setValue(new Material(), { shaderName: 'texture', uniforms: { s_texture: this.frameBufferObject.texture as any } });\r\n            //\r\n            // textureMaterial.uniforms.s_texture.url = 'Assets/pz.jpg';\r\n            // textureMaterial.uniforms.u_color.setTo(1.0, 0.0, 0.0, 1.0);\r\n            textureMaterial.renderParams.enableBlend = true;\r\n            textureMaterial.renderParams.sfactor = BlendFactor.ONE;\r\n            textureMaterial.renderParams.dfactor = BlendFactor.ZERO;\r\n        }\r\n\r\n        const depth = viewCamera.lens.near * 2;\r\n        gameObject.transform.position = viewCamera.transform.worldPosition.addTo(viewCamera.transform.localToWorldMatrix.getAxisZ().scaleNumberTo(depth));\r\n        const billboardComponent = gameObject.getComponent(BillboardComponent);\r\n        billboardComponent.camera = viewCamera;\r\n\r\n        if (this.debugShadowMap)\r\n        {\r\n            scene.gameObject.addChild(gameObject);\r\n        }\r\n        else\r\n        {\r\n            gameObject.remove();\r\n        }\r\n    }\r\n}\r\n","import { Box3, Vector3 } from '@feng3d/math';\r\nimport { serialization } from '@feng3d/serialization';\r\nimport { Camera } from '../cameras/Camera';\r\nimport { OrthographicLens } from '../cameras/lenses/OrthographicLens';\r\nimport { RegisterComponent } from '../component/Component';\r\nimport { GameObject } from '../core/GameObject';\r\nimport { Renderable } from '../core/Renderable';\r\nimport { AddComponentMenu } from '../Menu';\r\nimport { createNodeMenu } from '../menu/CreateNodeMenu';\r\nimport { Scene } from '../scene/Scene';\r\nimport { Light } from './Light';\r\nimport { LightType } from './LightType';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        DirectionalLight: DirectionalLight;\r\n    }\r\n\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        'Directional light': GameObject;\r\n    }\r\n}\r\n\r\n/**\r\n * 方向光源\r\n */\r\n@AddComponentMenu('Rendering/DirectionalLight')\r\n@RegisterComponent()\r\nexport class DirectionalLight extends Light\r\n{\r\n    __class__: 'feng3d.DirectionalLight';\r\n\r\n    lightType = LightType.Directional;\r\n\r\n    private orthographicLens: OrthographicLens;\r\n\r\n    /**\r\n     * 光源位置\r\n     */\r\n    get position()\r\n    {\r\n        return this.shadowCamera.transform.worldPosition;\r\n    }\r\n\r\n    constructor()\r\n    {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * 通过视窗摄像机进行更新\r\n     * @param viewCamera 视窗摄像机\r\n     */\r\n    updateShadowByCamera(scene: Scene, viewCamera: Camera, models: Renderable[])\r\n    {\r\n        const worldBounds: Box3 = models.reduce((pre: Box3, i) =>\r\n        {\r\n            const box = i.gameObject.boundingBox.worldBounds;\r\n            if (!pre)\r\n            { return box.clone(); }\r\n            pre.union(box);\r\n\r\n            return pre;\r\n        }, null) || new Box3(new Vector3(), new Vector3(1, 1, 1));\r\n\r\n        //\r\n        const center = worldBounds.getCenter();\r\n        const radius = worldBounds.getSize().length / 2;\r\n        //\r\n        this.shadowCamera.transform.position = center.addTo(this.direction.scaleNumberTo(radius + this.shadowCameraNear).negate());\r\n        this.shadowCamera.transform.lookAt(center, this.shadowCamera.transform.matrix.getAxisY());\r\n        //\r\n        if (!this.orthographicLens)\r\n        {\r\n            this.shadowCamera.lens = this.orthographicLens = new OrthographicLens(radius, 1, this.shadowCameraNear, this.shadowCameraNear + radius * 2);\r\n        }\r\n        else\r\n        {\r\n            serialization.setValue(this.orthographicLens, { size: radius, near: this.shadowCameraNear, far: this.shadowCameraNear + radius * 2 });\r\n        }\r\n    }\r\n}\r\n\r\nGameObject.registerPrimitive('Directional light', (g) =>\r\n{\r\n    g.addComponent(DirectionalLight);\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n    {\r\n        path: 'Light/Directional light',\r\n        priority: -2,\r\n        click: () =>\r\n            GameObject.createPrimitive('Directional light')\r\n    }\r\n);\r\n\r\n","import { Vector4 } from '@feng3d/math';\r\nimport { LazyObject, lazy, mathUtil } from '@feng3d/polyfill';\r\nimport { WebGLRenderer, Uniforms } from '@feng3d/renderer';\r\nimport { Camera } from '../../cameras/Camera';\r\nimport { Scene } from '../../scene/Scene';\r\n\r\n/**\r\n * 前向渲染器\r\n */\r\nexport class ForwardRenderer\r\n{\r\n    /**\r\n     * 渲染\r\n     */\r\n    draw(gl: WebGLRenderer, scene: Scene, camera: Camera)\r\n    {\r\n        const blenditems = scene.getPickCache(camera).blenditems;\r\n        const unblenditems = scene.getPickCache(camera).unblenditems;\r\n\r\n        const uniforms: LazyObject<Uniforms> = <any>{};\r\n        //\r\n        uniforms.u_projectionMatrix = camera.lens.matrix;\r\n        uniforms.u_viewProjection = camera.viewProjection;\r\n        uniforms.u_viewMatrix = camera.transform.worldToLocalMatrix;\r\n        uniforms.u_cameraMatrix = camera.transform.localToWorldMatrix;\r\n        uniforms.u_cameraPos = camera.transform.worldPosition;\r\n        uniforms.u_skyBoxSize = camera.lens.far / Math.sqrt(3);\r\n        uniforms.u_scaleByDepth = camera.getScaleByDepth(1);\r\n        uniforms.u_sceneAmbientColor = scene.ambientColor;\r\n\r\n        const ctime = (Date.now() / 1000) % 3600;\r\n        uniforms._Time = new Vector4(ctime / 20, ctime, ctime * 2, ctime * 3);\r\n\r\n        unblenditems.concat(blenditems).forEach((renderable) =>\r\n        {\r\n            // 绘制\r\n            const renderAtomic = renderable.renderAtomic;\r\n\r\n            for (const key in uniforms)\r\n            {\r\n                renderAtomic.uniforms[key] = uniforms[key];\r\n            }\r\n            //\r\n            renderAtomic.uniforms.u_mvMatrix = () =>\r\n                lazy.getvalue(renderAtomic.uniforms.u_modelMatrix).clone().append(lazy.getvalue(renderAtomic.uniforms.u_viewMatrix));\r\n            renderAtomic.uniforms.u_ITMVMatrix = () =>\r\n                lazy.getvalue(renderAtomic.uniforms.u_mvMatrix).clone().invert().transpose();\r\n\r\n            renderAtomic.shaderMacro.RotationOrder = mathUtil.DefaultRotationOrder;\r\n\r\n            renderable.beforeRender(renderAtomic, scene, camera);\r\n\r\n            gl.render(renderAtomic);\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * 前向渲染器\r\n */\r\nexport const forwardRenderer = new ForwardRenderer();\r\n","import { CullFace, RenderAtomic, Shader, WebGLRenderer } from '@feng3d/renderer';\r\nimport { Camera } from '../../cameras/Camera';\r\nimport { CartoonComponent } from '../../component/CartoonComponent';\r\nimport { OutLineComponent } from '../../component/OutLineComponent';\r\nimport { Scene } from '../../scene/Scene';\r\n\r\n/**\r\n * 轮廓渲染器\r\n */\r\nexport class OutlineRenderer\r\n{\r\n    renderAtomic: RenderAtomic;\r\n\r\n    init()\r\n    {\r\n        if (!this.renderAtomic)\r\n        {\r\n            this.renderAtomic = new RenderAtomic();\r\n            const renderParams = this.renderAtomic.renderParams;\r\n            renderParams.enableBlend = false;\r\n            renderParams.cullFace = CullFace.FRONT;\r\n\r\n            this.renderAtomic.shader = new Shader({ shaderName: 'outline' });\r\n        }\r\n    }\r\n\r\n    draw(gl: WebGLRenderer, scene: Scene, camera: Camera)\r\n    {\r\n        const unblenditems = scene.getPickCache(camera).unblenditems;\r\n\r\n        this.init();\r\n\r\n        for (let i = 0; i < unblenditems.length; i++)\r\n        {\r\n            const renderable = unblenditems[i];\r\n            if (renderable.getComponent(OutLineComponent) || renderable.getComponent(CartoonComponent))\r\n            {\r\n                const renderAtomic = renderable.renderAtomic;\r\n                renderable.beforeRender(renderAtomic, scene, camera);\r\n\r\n                this.renderAtomic.next = renderAtomic;\r\n\r\n                gl.render(this.renderAtomic);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * 轮廓渲染器\r\n */\r\nexport const outlineRenderer = new OutlineRenderer();\r\n","import { Rectangle, Vector3 } from '@feng3d/math';\r\nimport { RenderAtomic, Shader, WebGLRenderer } from '@feng3d/renderer';\r\nimport { Camera } from '../../cameras/Camera';\r\nimport { Renderable } from '../../core/Renderable';\r\nimport { DirectionalLight } from '../../light/DirectionalLight';\r\nimport { PointLight } from '../../light/PointLight';\r\nimport { ShadowType } from '../../light/shadow/ShadowType';\r\nimport { SpotLight } from '../../light/SpotLight';\r\nimport { Scene } from '../../scene/Scene';\r\nimport { FrameBufferObject } from '../FrameBufferObject';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsRenderAtomic\r\n    {\r\n        shadowShader: Shader;\r\n    }\r\n}\r\n\r\nexport class ShadowRenderer\r\n{\r\n    private renderAtomic = new RenderAtomic();\r\n\r\n    /**\r\n     * 渲染\r\n     */\r\n    draw(gl: WebGLRenderer, scene: Scene, camera: Camera)\r\n    {\r\n        const pointLights = scene.activePointLights.filter((i) => i.shadowType !== ShadowType.No_Shadows);\r\n        for (let i = 0; i < pointLights.length; i++)\r\n        {\r\n            pointLights[i].updateDebugShadowMap(scene, camera);\r\n            this.drawForPointLight(gl, pointLights[i], scene, camera);\r\n        }\r\n\r\n        const spotLights = scene.activeSpotLights.filter((i) => i.shadowType !== ShadowType.No_Shadows);\r\n        for (let i = 0; i < spotLights.length; i++)\r\n        {\r\n            spotLights[i].updateDebugShadowMap(scene, camera);\r\n            this.drawForSpotLight(gl, spotLights[i], scene, camera);\r\n        }\r\n\r\n        const directionalLights = scene.activeDirectionalLights.filter((i) => i.shadowType !== ShadowType.No_Shadows);\r\n        for (let i = 0; i < directionalLights.length; i++)\r\n        {\r\n            directionalLights[i].updateDebugShadowMap(scene, camera);\r\n            this.drawForDirectionalLight(gl, directionalLights[i], scene, camera);\r\n        }\r\n    }\r\n\r\n    private drawForSpotLight(renderer: WebGLRenderer, light: SpotLight, scene: Scene, camera: Camera): any\r\n    {\r\n        const gl = renderer.gl;\r\n        FrameBufferObject.active(gl, light.frameBufferObject);\r\n\r\n        //\r\n        gl.viewport(0, 0, light.frameBufferObject.OFFSCREEN_WIDTH, light.frameBufferObject.OFFSCREEN_HEIGHT);\r\n        gl.clearColor(1.0, 1.0, 1.0, 1.0);\r\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\r\n        const shadowCamera = light.shadowCamera;\r\n        shadowCamera.transform.localToWorldMatrix = light.transform.localToWorldMatrix;\r\n\r\n        const renderAtomic = this.renderAtomic;\r\n\r\n        // 获取影响阴影图的渲染对象\r\n        const models = scene.getModelsByCamera(shadowCamera);\r\n        // 筛选投射阴影的渲染对象\r\n        const castShadowsModels = models.filter((i) => i.castShadows);\r\n\r\n        //\r\n        renderAtomic.renderParams.useViewPort = true;\r\n        renderAtomic.renderParams.viewPort = new Rectangle(0, 0, light.frameBufferObject.OFFSCREEN_WIDTH, light.frameBufferObject.OFFSCREEN_HEIGHT);\r\n\r\n        //\r\n        renderAtomic.uniforms.u_projectionMatrix = shadowCamera.lens.matrix;\r\n        renderAtomic.uniforms.u_viewProjection = shadowCamera.viewProjection;\r\n        renderAtomic.uniforms.u_viewMatrix = shadowCamera.transform.worldToLocalMatrix;\r\n        renderAtomic.uniforms.u_cameraMatrix = shadowCamera.transform.localToWorldMatrix;\r\n        renderAtomic.uniforms.u_cameraPos = shadowCamera.transform.worldPosition;\r\n        //\r\n        renderAtomic.uniforms.u_lightType = light.lightType;\r\n        renderAtomic.uniforms.u_lightPosition = light.position;\r\n        renderAtomic.uniforms.u_shadowCameraNear = light.shadowCameraNear;\r\n        renderAtomic.uniforms.u_shadowCameraFar = light.shadowCameraFar;\r\n\r\n        castShadowsModels.forEach((renderable) =>\r\n        {\r\n            this.drawGameObject(renderer, renderable, scene, camera);\r\n        });\r\n\r\n        light.frameBufferObject.deactive(gl);\r\n    }\r\n\r\n    private drawForPointLight(renderer: WebGLRenderer, light: PointLight, scene: Scene, camera: Camera): any\r\n    {\r\n        const gl = renderer.gl;\r\n\r\n        FrameBufferObject.active(gl, light.frameBufferObject);\r\n\r\n        //\r\n        gl.viewport(0, 0, light.frameBufferObject.OFFSCREEN_WIDTH, light.frameBufferObject.OFFSCREEN_HEIGHT);\r\n        gl.clearColor(1.0, 1.0, 1.0, 1.0);\r\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\r\n        const vpWidth = light.shadowMapSize.x;\r\n        const vpHeight = light.shadowMapSize.y;\r\n\r\n        // These viewports map a cube-map onto a 2D texture with the\r\n        // following orientation:\r\n        //\r\n        //  xzXZ\r\n        //   y Y\r\n        //\r\n        // X - Positive x direction\r\n        // x - Negative x direction\r\n        // Y - Positive y direction\r\n        // y - Negative y direction\r\n        // Z - Positive z direction\r\n        // z - Negative z direction\r\n\r\n        // positive X\r\n        cube2DViewPorts[0].init(vpWidth * 2, vpHeight, vpWidth, vpHeight);\r\n        // negative X\r\n\r\n        cube2DViewPorts[1].init(0, vpHeight, vpWidth, vpHeight);\r\n        // positive Z\r\n        cube2DViewPorts[2].init(vpWidth * 3, vpHeight, vpWidth, vpHeight);\r\n        // negative Z\r\n        cube2DViewPorts[3].init(vpWidth, vpHeight, vpWidth, vpHeight);\r\n        // positive Y\r\n        cube2DViewPorts[4].init(vpWidth * 3, 0, vpWidth, vpHeight);\r\n        // negative Y\r\n        cube2DViewPorts[5].init(vpWidth, 0, vpWidth, vpHeight);\r\n\r\n        const shadowCamera = light.shadowCamera;\r\n        shadowCamera.transform.position = light.transform.position;\r\n\r\n        const renderAtomic = this.renderAtomic;\r\n\r\n        for (let face = 0; face < 6; face++)\r\n        {\r\n            shadowCamera.transform.lookAt(light.position.addTo(cubeDirections[face]), cubeUps[face]);\r\n\r\n            // 获取影响阴影图的渲染对象\r\n            const models = scene.getModelsByCamera(shadowCamera);\r\n            // 筛选投射阴影的渲染对象\r\n            const castShadowsModels = models.filter((i) => i.castShadows);\r\n\r\n            //\r\n            renderAtomic.renderParams.useViewPort = true;\r\n            renderAtomic.renderParams.viewPort = cube2DViewPorts[face];\r\n\r\n            //\r\n            renderAtomic.uniforms.u_projectionMatrix = shadowCamera.lens.matrix;\r\n            renderAtomic.uniforms.u_viewProjection = shadowCamera.viewProjection;\r\n            renderAtomic.uniforms.u_viewMatrix = shadowCamera.transform.worldToLocalMatrix;\r\n            renderAtomic.uniforms.u_cameraMatrix = shadowCamera.transform.localToWorldMatrix;\r\n            renderAtomic.uniforms.u_cameraPos = shadowCamera.transform.worldPosition;\r\n            //\r\n            renderAtomic.uniforms.u_lightType = light.lightType;\r\n            renderAtomic.uniforms.u_lightPosition = light.position;\r\n            renderAtomic.uniforms.u_shadowCameraNear = light.shadowCameraNear;\r\n            renderAtomic.uniforms.u_shadowCameraFar = light.shadowCameraFar;\r\n\r\n            castShadowsModels.forEach((renderable) =>\r\n            {\r\n                this.drawGameObject(renderer, renderable, scene, camera);\r\n            });\r\n        }\r\n        light.frameBufferObject.deactive(gl);\r\n    }\r\n\r\n    private drawForDirectionalLight(renderer: WebGLRenderer, light: DirectionalLight, scene: Scene, camera: Camera): any\r\n    {\r\n        // 获取影响阴影图的渲染对象\r\n        const models = scene.getPickByDirectionalLight(light);\r\n        // 筛选投射阴影的渲染对象\r\n        const castShadowsModels = models.filter((i) => i.castShadows);\r\n\r\n        light.updateShadowByCamera(scene, camera, models);\r\n\r\n        FrameBufferObject.active(renderer.gl, light.frameBufferObject);\r\n\r\n        const gl = renderer.gl;\r\n\r\n        //\r\n        gl.viewport(0, 0, light.frameBufferObject.OFFSCREEN_WIDTH, light.frameBufferObject.OFFSCREEN_HEIGHT);\r\n        gl.clearColor(1.0, 1.0, 1.0, 1.0);\r\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\r\n        const shadowCamera = light.shadowCamera;\r\n\r\n        const renderAtomic = this.renderAtomic;\r\n        //\r\n        renderAtomic.renderParams.useViewPort = true;\r\n        renderAtomic.renderParams.viewPort = new Rectangle(0, 0, light.frameBufferObject.OFFSCREEN_WIDTH, light.frameBufferObject.OFFSCREEN_HEIGHT);\r\n        //\r\n        renderAtomic.uniforms.u_projectionMatrix = shadowCamera.lens.matrix;\r\n        renderAtomic.uniforms.u_viewProjection = shadowCamera.viewProjection;\r\n        renderAtomic.uniforms.u_viewMatrix = shadowCamera.transform.worldToLocalMatrix;\r\n        renderAtomic.uniforms.u_cameraMatrix = shadowCamera.transform.localToWorldMatrix;\r\n        renderAtomic.uniforms.u_cameraPos = shadowCamera.transform.worldPosition;\r\n        //\r\n        renderAtomic.uniforms.u_lightType = light.lightType;\r\n        renderAtomic.uniforms.u_lightPosition = shadowCamera.transform.worldPosition;\r\n        renderAtomic.uniforms.u_shadowCameraNear = light.shadowCameraNear;\r\n        renderAtomic.uniforms.u_shadowCameraFar = light.shadowCameraFar;\r\n        //\r\n        castShadowsModels.forEach((renderable) =>\r\n        {\r\n            this.drawGameObject(renderer, renderable, scene, camera);\r\n        });\r\n\r\n        light.frameBufferObject.deactive(gl);\r\n    }\r\n\r\n    /**\r\n     * 绘制3D对象\r\n     */\r\n    private drawGameObject(gl: WebGLRenderer, renderable: Renderable, scene: Scene, camera: Camera)\r\n    {\r\n        const renderAtomic = renderable.renderAtomic;\r\n        renderable.beforeRender(renderAtomic, scene, camera);\r\n        renderAtomic.shadowShader = renderAtomic.shadowShader || new Shader({ shaderName: 'shadow' });\r\n\r\n        //\r\n        this.renderAtomic.next = renderAtomic;\r\n        this.renderAtomic.renderParams.cullFace = renderAtomic.renderParams.cullFace;\r\n\r\n        // 使用shadowShader\r\n        this.renderAtomic.shader = renderAtomic.shadowShader;\r\n        gl.render(this.renderAtomic);\r\n        this.renderAtomic.shader = null;\r\n    }\r\n}\r\n\r\n/**\r\n * 阴影图渲染器\r\n */\r\nexport const shadowRenderer = new ShadowRenderer();\r\n\r\nconst cube2DViewPorts = [\r\n    new Rectangle(), new Rectangle(), new Rectangle(),\r\n    new Rectangle(), new Rectangle(), new Rectangle()\r\n];\r\nconst cubeUps = [\r\n    new Vector3(0, 1, 0), new Vector3(0, 1, 0), new Vector3(0, 1, 0),\r\n    new Vector3(0, 1, 0), new Vector3(0, 0, 1), new Vector3(0, 0, -1)\r\n];\r\nconst cubeDirections = [\r\n    new Vector3(1, 0, 0), new Vector3(-1, 0, 0), new Vector3(0, 0, 1),\r\n    new Vector3(0, 0, -1), new Vector3(0, 1, 0), new Vector3(0, -1, 0)\r\n];\r\n","import { Color4 } from '@feng3d/math';\r\nimport { lazy } from '@feng3d/polyfill';\r\nimport { Index, RenderAtomic, RenderMode, Shader, WebGLRenderer } from '@feng3d/renderer';\r\nimport { Camera } from '../../cameras/Camera';\r\nimport { WireframeComponent } from '../../component/WireframeComponent';\r\nimport { Renderable } from '../../core/Renderable';\r\nimport { Scene } from '../../scene/Scene';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsRenderAtomic\r\n    {\r\n        /**\r\n         * 顶点索引缓冲\r\n         */\r\n        wireframeindexBuffer: Index;\r\n\r\n        wireframeShader: Shader;\r\n    }\r\n}\r\n\r\nexport class WireframeRenderer\r\n{\r\n    private renderAtomic: RenderAtomic;\r\n\r\n    init()\r\n    {\r\n        if (!this.renderAtomic)\r\n        {\r\n            this.renderAtomic = new RenderAtomic();\r\n            const renderParams = this.renderAtomic.renderParams;\r\n            renderParams.renderMode = RenderMode.LINES;\r\n            // renderParams.depthMask = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 渲染\r\n     */\r\n    draw(renderer: WebGLRenderer, scene: Scene, camera: Camera)\r\n    {\r\n        const unblenditems = scene.getPickCache(camera).unblenditems;\r\n\r\n        const wireframes = unblenditems.reduce((pv: { wireframe: WireframeComponent, renderable: Renderable }[], cv) =>\r\n        {\r\n            const wireframe = cv.getComponent(WireframeComponent); if (wireframe) pv.push({ wireframe, renderable: cv });\r\n\r\n            return pv;\r\n        }, []);\r\n\r\n        if (wireframes.length === 0)\r\n        {\r\n            return;\r\n        }\r\n\r\n        wireframes.forEach((element) =>\r\n        {\r\n            this.drawGameObject(renderer, element.renderable, scene, camera, element.wireframe.color); //\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 绘制3D对象\r\n     */\r\n    drawGameObject(renderer: WebGLRenderer, renderable: Renderable, scene: Scene, camera: Camera, wireframeColor = new Color4())\r\n    {\r\n        const renderAtomic = renderable.renderAtomic;\r\n        renderable.beforeRender(renderAtomic, scene, camera);\r\n\r\n        const renderMode = lazy.getvalue(renderAtomic.renderParams.renderMode);\r\n        if (renderMode === RenderMode.POINTS\r\n            || renderMode === RenderMode.LINES\r\n            || renderMode === RenderMode.LINE_LOOP\r\n            || renderMode === RenderMode.LINE_STRIP\r\n        )\r\n        { return; }\r\n\r\n        this.init();\r\n\r\n        const uniforms = this.renderAtomic.uniforms;\r\n        //\r\n        uniforms.u_projectionMatrix = camera.lens.matrix;\r\n        uniforms.u_viewProjection = camera.viewProjection;\r\n        uniforms.u_viewMatrix = camera.transform.worldToLocalMatrix;\r\n        uniforms.u_cameraMatrix = camera.transform.localToWorldMatrix;\r\n        uniforms.u_cameraPos = camera.transform.worldPosition;\r\n        uniforms.u_skyBoxSize = camera.lens.far / Math.sqrt(3);\r\n        uniforms.u_scaleByDepth = camera.getScaleByDepth(1);\r\n\r\n        //\r\n        this.renderAtomic.next = renderAtomic;\r\n\r\n        //\r\n        const oldIndexBuffer = renderAtomic.index;\r\n        if (oldIndexBuffer.count < 3) return;\r\n        if (!renderAtomic.wireframeindexBuffer || renderAtomic.wireframeindexBuffer.count !== 2 * oldIndexBuffer.count)\r\n        {\r\n            const wireframeindices: number[] = [];\r\n            const indices = lazy.getvalue(oldIndexBuffer.indices);\r\n            for (let i = 0; i < indices.length; i += 3)\r\n            {\r\n                wireframeindices.push(\r\n                    indices[i], indices[i + 1],\r\n                    indices[i], indices[i + 2],\r\n                    indices[i + 1], indices[i + 2],\r\n                );\r\n            }\r\n            renderAtomic.wireframeindexBuffer = new Index();\r\n            renderAtomic.wireframeindexBuffer.indices = wireframeindices;\r\n        }\r\n        renderAtomic.wireframeShader = renderAtomic.wireframeShader || new Shader({ shaderName: 'wireframe' });\r\n        this.renderAtomic.index = renderAtomic.wireframeindexBuffer;\r\n\r\n        this.renderAtomic.uniforms.u_wireframeColor = wireframeColor;\r\n\r\n        //\r\n        this.renderAtomic.shader = renderAtomic.wireframeShader;\r\n        renderer.render(this.renderAtomic);\r\n        this.renderAtomic.shader = null;\r\n        //\r\n    }\r\n}\r\n\r\n/**\r\n * 线框渲染器\r\n */\r\nexport const wireframeRenderer = new WireframeRenderer();\r\n","import { Vector2 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { PerspectiveLens } from '../cameras/lenses/PerspectiveLens';\r\nimport { RegisterComponent } from '../component/Component';\r\nimport { GameObject } from '../core/GameObject';\r\nimport { AddComponentMenu } from '../Menu';\r\nimport { createNodeMenu } from '../menu/CreateNodeMenu';\r\nimport { Light } from './Light';\r\nimport { LightType } from './LightType';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        PointLight: PointLight;\r\n    }\r\n\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        'Point Light': GameObject;\r\n    }\r\n}\r\n\r\n/**\r\n * 点光源\r\n */\r\n@AddComponentMenu('Rendering/PointLight')\r\n@RegisterComponent()\r\nexport class PointLight extends Light\r\n{\r\n    __class__: 'feng3d.PointLight';\r\n\r\n    lightType = LightType.Point;\r\n\r\n    /**\r\n     * 光照范围\r\n     */\r\n    @oav()\r\n    @serialize\r\n    get range()\r\n    {\r\n        return this._range;\r\n    }\r\n    set range(v)\r\n    {\r\n        if (this._range === v) return;\r\n        this._range = v;\r\n        this.invalidRange();\r\n    }\r\n    private _range = 10;\r\n\r\n    /**\r\n     * 阴影图尺寸\r\n     */\r\n    get shadowMapSize()\r\n    {\r\n        return this.shadowMap.getSize().multiply(new Vector2(1 / 4, 1 / 2));\r\n    }\r\n\r\n    constructor()\r\n    {\r\n        super();\r\n        this.shadowCamera.lens = new PerspectiveLens(90, 1, 0.1, this.range);\r\n    }\r\n\r\n    private invalidRange()\r\n    {\r\n        if (this.shadowCamera)\r\n        { this.shadowCamera.lens.far = this.range; }\r\n    }\r\n}\r\n\r\nGameObject.registerPrimitive('Point Light', (g) =>\r\n{\r\n    g.addComponent(PointLight);\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n    {\r\n        path: 'Light/Point Light',\r\n        priority: -1,\r\n        click: () =>\r\n            GameObject.createPrimitive('Point Light')\r\n    }\r\n);\r\n\r\n","import { oav } from '@feng3d/objectview';\r\nimport { mathUtil } from '@feng3d/polyfill';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { PerspectiveLens } from '../cameras/lenses/PerspectiveLens';\r\nimport { RegisterComponent } from '../component/Component';\r\nimport { GameObject } from '../core/GameObject';\r\nimport { createNodeMenu } from '../menu/CreateNodeMenu';\r\nimport { Light } from './Light';\r\nimport { LightType } from './LightType';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        SpotLight: SpotLight;\r\n    }\r\n\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        'Spot Light': GameObject;\r\n    }\r\n}\r\n\r\n/**\r\n * 聚光灯光源\r\n */\r\n@RegisterComponent()\r\nexport class SpotLight extends Light\r\n{\r\n    lightType = LightType.Spot;\r\n\r\n    /**\r\n     * 光照范围\r\n     */\r\n    @oav()\r\n    @serialize\r\n    @watch('_invalidRange')\r\n    range = 10;\r\n\r\n    /**\r\n     *\r\n     */\r\n    @oav()\r\n    @serialize\r\n    @watch('_invalidAngle')\r\n    angle = 60;\r\n\r\n    /**\r\n     * 半影.\r\n     */\r\n    @oav()\r\n    @serialize\r\n    penumbra = 0;\r\n\r\n    /**\r\n     * 椎体cos值\r\n     */\r\n    get coneCos()\r\n    {\r\n        return Math.cos(this.angle * 0.5 * mathUtil.DEG2RAD);\r\n    }\r\n\r\n    get penumbraCos()\r\n    {\r\n        return Math.cos(this.angle * 0.5 * mathUtil.DEG2RAD * (1 - this.penumbra));\r\n    }\r\n\r\n    private perspectiveLens: PerspectiveLens;\r\n\r\n    constructor()\r\n    {\r\n        super();\r\n        this.perspectiveLens = this.shadowCamera.lens = new PerspectiveLens(this.angle, 1, 0.1, this.range);\r\n    }\r\n\r\n    private _invalidRange()\r\n    {\r\n        if (this.shadowCamera)\r\n        { this.shadowCamera.lens.far = this.range; }\r\n    }\r\n\r\n    private _invalidAngle()\r\n    {\r\n        if (this.perspectiveLens)\r\n        { this.perspectiveLens.fov = this.angle; }\r\n    }\r\n}\r\n\r\nGameObject.registerPrimitive('Spot Light', (g) =>\r\n{\r\n    g.addComponent(SpotLight);\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n    {\r\n        path: 'Light/Spot Light',\r\n        priority: -2,\r\n        click: () =>\r\n            GameObject.createPrimitive('Spot Light')\r\n    }\r\n);\r\n\r\n","import { oav } from '@feng3d/objectview';\r\nimport { RenderAtomic } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { Camera } from '../cameras/Camera';\r\nimport { RegisterComponent, Component } from '../component/Component';\r\nimport { AddComponentMenu } from '../Menu';\r\nimport { Scene } from '../scene/Scene';\r\nimport { TextureCube } from '../textures/TextureCube';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        SkyBox: SkyBox;\r\n    }\r\n}\r\n\r\n/**\r\n * 天空盒组件\r\n */\r\n@AddComponentMenu('SkyBox/SkyBox')\r\n@RegisterComponent()\r\nexport class SkyBox extends Component\r\n{\r\n    __class__: 'feng3d.SkyBox';\r\n\r\n    // /**\r\n    //  * The material used by the skybox.\r\n    //  */\r\n    // @serialize\r\n    // material: Material;\r\n\r\n    @serialize\r\n    @oav({ component: 'OAVPick', componentParam: { accepttype: 'texturecube', datatype: 'texturecube' } })\r\n    s_skyboxTexture = TextureCube.default;\r\n\r\n    beforeRender(renderAtomic: RenderAtomic, _scene: Scene, _camera: Camera)\r\n    {\r\n        renderAtomic.uniforms.s_skyboxTexture = () => this.s_skyboxTexture;\r\n    }\r\n}\r\n","import { Camera } from '../cameras/Camera';\r\nimport { Renderable } from '../core/Renderable';\r\nimport { Scene } from './Scene';\r\n\r\n/**\r\n * 场景拾取缓存\r\n */\r\nexport class ScenePickCache\r\n{\r\n    private scene: Scene;\r\n    private camera: Camera;\r\n\r\n    //\r\n    private _activeModels: Renderable[];\r\n    private _blenditems: Renderable[];\r\n    private _unblenditems: Renderable[];\r\n\r\n    constructor(scene: Scene, camera: Camera)\r\n    {\r\n        this.scene = scene;\r\n        this.camera = camera;\r\n    }\r\n\r\n    /**\r\n     * 获取需要渲染的对象\r\n     *\r\n     * #### 渲染需求条件\r\n     * 1. visible == true\r\n     * 1. 在摄像机视锥内\r\n     * 1. model.enabled == true\r\n     *\r\n     * @param gameObject\r\n     * @param camera\r\n     */\r\n    get activeModels()\r\n    {\r\n        if (this._activeModels)\r\n            { return this._activeModels; }\r\n\r\n        const models: Renderable[] = this._activeModels = [];\r\n        const frustum = this.camera.frustum;\r\n\r\n        let gameObjects = [this.scene.gameObject];\r\n        while (gameObjects.length > 0)\r\n        {\r\n            const gameObject = gameObjects.pop();\r\n\r\n            if (!gameObject.activeSelf)\r\n                { continue; }\r\n            const model = gameObject.getComponent(Renderable);\r\n            if (model && model.enabled)\r\n            {\r\n                if (model.selfWorldBounds)\r\n                {\r\n                    if (frustum.intersectsBox(model.selfWorldBounds))\r\n                        { models.push(model); }\r\n                }\r\n            }\r\n            gameObjects = gameObjects.concat(gameObject.children);\r\n        }\r\n\r\nreturn models;\r\n    }\r\n\r\n    /**\r\n     * 半透明渲染对象\r\n     */\r\n    get blenditems()\r\n    {\r\n        if (this._blenditems)\r\n            { return this._blenditems; }\r\n\r\n        const models = this.activeModels;\r\n        const camerapos = this.camera.transform.worldPosition;\r\n\r\n        const blenditems = this._blenditems = models.filter((item) =>\r\n        item.material.renderParams.enableBlend).sort((b, a) => a.transform.worldPosition.subTo(camerapos).lengthSquared - b.transform.worldPosition.subTo(camerapos).lengthSquared);\r\n\r\n        return blenditems;\r\n    }\r\n\r\n    /**\r\n     * 半透明渲染对象\r\n     */\r\n    get unblenditems()\r\n    {\r\n        if (this._unblenditems)\r\n            { return this._unblenditems; }\r\n\r\n        const models = this.activeModels;\r\n        const camerapos = this.camera.transform.worldPosition;\r\n\r\n        const unblenditems = this._unblenditems = models.filter((item) =>\r\n        !item.material.renderParams.enableBlend).sort((a, b) => a.transform.worldPosition.subTo(camerapos).lengthSquared - b.transform.worldPosition.subTo(camerapos).lengthSquared);\r\n\r\n        return unblenditems;\r\n    }\r\n\r\n    clear()\r\n    {\r\n        this._blenditems = null;\r\n        this._unblenditems = null;\r\n        this._activeModels = null;\r\n    }\r\n}\r\n","import { Color4, Ray3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { RenderMode } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { Animation } from '../animation/Animation';\r\nimport { Camera } from '../cameras/Camera';\r\nimport { Behaviour } from '../component/Behaviour';\r\nimport { Component, RegisterComponent } from '../component/Component';\r\nimport { GameObject } from '../core/GameObject';\r\nimport { HideFlags } from '../core/HideFlags';\r\nimport { Renderable } from '../core/Renderable';\r\nimport { RunEnvironment } from '../core/RunEnvironment';\r\nimport { DirectionalLight } from '../light/DirectionalLight';\r\nimport { PointLight } from '../light/PointLight';\r\nimport { SpotLight } from '../light/SpotLight';\r\nimport { SkyBox } from '../skybox/SkyBox';\r\nimport { ticker } from '../utils/Ticker';\r\nimport { ScenePickCache } from './ScenePickCache';\r\n\r\ndeclare global\r\n{\r\n    /**\r\n     * 组件事件\r\n     */\r\n    export interface MixinsGameObjectEventMap\r\n    {\r\n        addToScene: GameObject;\r\n        removeFromScene: GameObject;\r\n        addComponentToScene: Component;\r\n    }\r\n\r\n    export interface MixinsComponentMap { Scene: Scene; }\r\n}\r\n\r\n/**\r\n * 3D场景\r\n */\r\n@RegisterComponent()\r\nexport class Scene extends Component\r\n{\r\n    __class__: 'feng3d.Scene';\r\n\r\n    /**\r\n     * 背景颜色\r\n     */\r\n    @serialize\r\n    @oav()\r\n    background = new Color4(0, 0, 0, 1);\r\n\r\n    /**\r\n     * 环境光强度\r\n     */\r\n    @serialize\r\n    @oav()\r\n    ambientColor = new Color4();\r\n\r\n    /**\r\n     * 指定所运行环境\r\n     *\r\n     * 控制运行符合指定环境场景中所有 Behaviour.update 方法\r\n     *\r\n     * 用于处理某些脚本只在在feng3d引擎或者编辑器中运行的问题。例如 FPSController 默认只在feng3d中运行，在编辑器模式下不会运行。\r\n     */\r\n    runEnvironment = RunEnvironment.feng3d;\r\n\r\n    /**\r\n     * 鼠标射线，在渲染时被设置\r\n     */\r\n    mouseRay3D: Ray3;\r\n\r\n    /**\r\n     * 上次渲染时用的摄像机\r\n     */\r\n    camera: Camera;\r\n\r\n    init()\r\n    {\r\n        super.init();\r\n        this.transform.hideFlags = this.transform.hideFlags | HideFlags.Hide;\r\n        this.gameObject.hideFlags = this.gameObject.hideFlags | HideFlags.DontTransform;\r\n\r\n        //\r\n        this._gameObject['_scene'] = this;\r\n        this._gameObject['updateChildrenScene']();\r\n    }\r\n\r\n    update(interval?: number)\r\n    {\r\n        interval = interval || (1000 / ticker.frameRate);\r\n\r\n        this._mouseCheckObjects = null;\r\n        this._models = null;\r\n        this._visibleAndEnabledModels = null;\r\n        this._skyBoxs = null;\r\n        this._activeSkyBoxs = null;\r\n        this._directionalLights = null;\r\n        this._activeDirectionalLights = null;\r\n        this._pointLights = null;\r\n        this._activePointLights = null;\r\n        this._spotLights = null;\r\n        this._activeSpotLights = null;\r\n        this._animations = null;\r\n        this._activeAnimations = null;\r\n        this._behaviours = null;\r\n        this._activeBehaviours = null;\r\n\r\n        // 每帧清理拾取缓存\r\n        this._pickMap.forEach((item) => item.clear());\r\n\r\n        this.behaviours.forEach((element) =>\r\n        {\r\n            if (element.isVisibleAndEnabled && Boolean(this.runEnvironment & element.runEnvironment))\r\n            { element.update(interval); }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 所有 Model\r\n     */\r\n    get models()\r\n    {\r\n        this._models = this._models || this.getComponentsInChildren(Renderable);\r\n\r\n        return this._models;\r\n    }\r\n\r\n    /**\r\n     * 所有 可见且开启的 Model\r\n     */\r\n    get visibleAndEnabledModels()\r\n    {\r\n        this._visibleAndEnabledModels = this._visibleAndEnabledModels || this.models.filter((i) => i.isVisibleAndEnabled);\r\n\r\n        return this._visibleAndEnabledModels;\r\n    }\r\n\r\n    /**\r\n     * 所有 SkyBox\r\n     */\r\n    get skyBoxs()\r\n    {\r\n        this._skyBoxs = this._skyBoxs || this.getComponentsInChildren(SkyBox);\r\n\r\n        return this._skyBoxs;\r\n    }\r\n\r\n    get activeSkyBoxs()\r\n    {\r\n        this._activeSkyBoxs = this._activeSkyBoxs || this.skyBoxs.filter((i) => i.gameObject.activeInHierarchy);\r\n\r\n        return this._activeSkyBoxs;\r\n    }\r\n\r\n    get directionalLights()\r\n    {\r\n        this._directionalLights = this._directionalLights || this.getComponentsInChildren(DirectionalLight);\r\n\r\n        return this._directionalLights;\r\n    }\r\n\r\n    get activeDirectionalLights()\r\n    {\r\n        this._activeDirectionalLights = this._activeDirectionalLights || this.directionalLights.filter((i) => i.isVisibleAndEnabled);\r\n\r\n        return this._activeDirectionalLights;\r\n    }\r\n\r\n    get pointLights()\r\n    {\r\n        this._pointLights = this._pointLights || this.getComponentsInChildren(PointLight);\r\n\r\n        return this._pointLights;\r\n    }\r\n\r\n    get activePointLights()\r\n    {\r\n        this._activePointLights = this._activePointLights || this.pointLights.filter((i) => i.isVisibleAndEnabled);\r\n\r\n        return this._activePointLights;\r\n    }\r\n\r\n    get spotLights()\r\n    {\r\n        this._spotLights = this._spotLights || this.getComponentsInChildren(SpotLight);\r\n\r\n        return this._spotLights;\r\n    }\r\n\r\n    get activeSpotLights()\r\n    {\r\n        this._activeSpotLights = this._activeSpotLights || this.spotLights.filter((i) => i.isVisibleAndEnabled);\r\n\r\n        return this._activeSpotLights;\r\n    }\r\n\r\n    get animations()\r\n    {\r\n        this._animations = this._animations || this.getComponentsInChildren(Animation);\r\n\r\n        return this._animations;\r\n    }\r\n\r\n    get activeAnimations()\r\n    {\r\n        this._activeAnimations = this._activeAnimations || this.animations.filter((i) => i.isVisibleAndEnabled);\r\n\r\n        return this._activeAnimations;\r\n    }\r\n\r\n    get behaviours()\r\n    {\r\n        this._behaviours = this._behaviours || this.getComponentsInChildren(Behaviour);\r\n\r\n        return this._behaviours;\r\n    }\r\n\r\n    get activeBehaviours()\r\n    {\r\n        this._activeBehaviours = this._activeBehaviours || this.behaviours.filter((i) => i.isVisibleAndEnabled);\r\n\r\n        return this._activeBehaviours;\r\n    }\r\n\r\n    get mouseCheckObjects()\r\n    {\r\n        if (this._mouseCheckObjects)\r\n        { return this._mouseCheckObjects; }\r\n\r\n        let checkList = this.gameObject.getChildren();\r\n        this._mouseCheckObjects = [];\r\n        let i = 0;\r\n        // 获取所有需要拾取的对象并分层存储\r\n        while (i < checkList.length)\r\n        {\r\n            const checkObject = checkList[i++];\r\n            if (checkObject.mouseEnabled)\r\n            {\r\n                if (checkObject.getComponents(Renderable))\r\n                {\r\n                    this._mouseCheckObjects.push(checkObject);\r\n                }\r\n                checkList = checkList.concat(checkObject.getChildren());\r\n            }\r\n        }\r\n\r\n        return this._mouseCheckObjects;\r\n    }\r\n\r\n    /**\r\n     * 获取拾取缓存\r\n     * @param camera\r\n     */\r\n    getPickCache(camera: Camera)\r\n    {\r\n        if (this._pickMap.get(camera))\r\n        { return this._pickMap.get(camera); }\r\n        const pick = new ScenePickCache(this, camera);\r\n        this._pickMap.set(camera, pick);\r\n\r\n        return pick;\r\n    }\r\n\r\n    /**\r\n     * 获取接收光照渲染对象列表\r\n     * @param _light\r\n     */\r\n    getPickByDirectionalLight(_light: DirectionalLight)\r\n    {\r\n        const openlist = [this.gameObject];\r\n        const targets: Renderable[] = [];\r\n        while (openlist.length > 0)\r\n        {\r\n            const item = openlist.shift();\r\n            if (!item.activeSelf) continue;\r\n            const model = item.getComponent(Renderable);\r\n            if (model && (model.castShadows || model.receiveShadows)\r\n                && !model.material.renderParams.enableBlend\r\n                && model.material.renderParams.renderMode === RenderMode.TRIANGLES\r\n            )\r\n            {\r\n                targets.push(model);\r\n            }\r\n            item.children.forEach((element) =>\r\n            {\r\n                openlist.push(element);\r\n            });\r\n        }\r\n\r\n        return targets;\r\n    }\r\n\r\n    /**\r\n     * 获取 可被摄像机看见的 Model 列表\r\n     * @param camera\r\n     */\r\n    getModelsByCamera(camera: Camera)\r\n    {\r\n        const frustum = camera.frustum;\r\n\r\n        const results = this.visibleAndEnabledModels.filter((i) =>\r\n        {\r\n            const model = i.getComponent(Renderable);\r\n            if (model.selfWorldBounds)\r\n            {\r\n                if (frustum.intersectsBox(model.selfWorldBounds))\r\n                { return true; }\r\n            }\r\n\r\n            return false;\r\n        });\r\n\r\n        return results;\r\n    }\r\n\r\n    //\r\n    private _mouseCheckObjects: GameObject[];\r\n    private _models: Renderable[];\r\n    private _visibleAndEnabledModels: Renderable[];\r\n    private _skyBoxs: SkyBox[];\r\n    private _activeSkyBoxs: SkyBox[];\r\n    private _directionalLights: DirectionalLight[];\r\n    private _activeDirectionalLights: DirectionalLight[];\r\n    private _pointLights: PointLight[];\r\n    private _activePointLights: PointLight[];\r\n    private _spotLights: SpotLight[];\r\n    private _activeSpotLights: SpotLight[];\r\n    private _animations: Animation[];\r\n    private _activeAnimations: Animation[];\r\n    private _behaviours: Behaviour[];\r\n    private _activeBehaviours: Behaviour[];\r\n    private _pickMap = new Map<Camera, ScenePickCache>();\r\n}\r\n","import { Attribute, CullFace, Index, RenderAtomic, Shader, WebGLRenderer } from '@feng3d/renderer';\r\nimport { Camera } from '../cameras/Camera';\r\nimport { Scene } from '../scene/Scene';\r\nimport { SkyBox } from './SkyBox';\r\n\r\n/**\r\n * 天空盒渲染器\r\n */\r\nexport class SkyBoxRenderer\r\n{\r\n    private renderAtomic: RenderAtomic;\r\n\r\n    init()\r\n    {\r\n        if (!this.renderAtomic)\r\n        {\r\n            const renderAtomic = this.renderAtomic = new RenderAtomic();\r\n            // 八个顶点，32个number\r\n            const vertexPositionData = [ //\r\n                -1, 1, -1, //\r\n                1, 1, -1, //\r\n                1, 1, 1, //\r\n                -1, 1, 1, //\r\n                -1, -1, -1, //\r\n                1, -1, -1, //\r\n                1, -1, 1, //\r\n                -1, -1, 1 //\r\n            ];\r\n            renderAtomic.attributes.a_position = new Attribute({ name: 'a_position', data: vertexPositionData, size: 3 });\r\n            // 6个面，12个三角形，36个顶点索引\r\n            const indices = [ //\r\n                0, 1, 2, 2, 3, 0, //\r\n                6, 5, 4, 4, 7, 6, //\r\n                2, 6, 7, 7, 3, 2, //\r\n                4, 5, 1, 1, 0, 4, //\r\n                4, 0, 3, 3, 7, 4, //\r\n                2, 1, 5, 5, 6, 2 //\r\n            ];\r\n            renderAtomic.index = new Index();\r\n            renderAtomic.index.indices = indices;\r\n            //\r\n            const renderParams = renderAtomic.renderParams;\r\n            renderParams.cullFace = CullFace.NONE;\r\n            //\r\n\r\n            renderAtomic.shader = new Shader({ shaderName: 'skybox' });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 绘制场景中天空盒\r\n     * @param renderer\r\n     * @param scene 场景\r\n     * @param camera 摄像机\r\n     */\r\n    draw(renderer: WebGLRenderer, scene: Scene, camera: Camera)\r\n    {\r\n        const skybox = scene.activeSkyBoxs[0];\r\n        this.drawSkyBox(renderer, skybox, scene, camera);\r\n    }\r\n\r\n    /**\r\n     * 绘制天空盒\r\n     * @param renderer\r\n     * @param skybox 天空盒\r\n     * @param camera 摄像机\r\n     */\r\n    drawSkyBox(renderer: WebGLRenderer, skybox: SkyBox, scene: Scene, camera: Camera)\r\n    {\r\n        if (!skybox) return;\r\n\r\n        this.init();\r\n\r\n        //\r\n        skybox.beforeRender(this.renderAtomic, scene, camera);\r\n\r\n        //\r\n        this.renderAtomic.uniforms.u_viewProjection = camera.viewProjection;\r\n        this.renderAtomic.uniforms.u_viewMatrix = camera.transform.worldToLocalMatrix;\r\n        this.renderAtomic.uniforms.u_cameraMatrix = camera.transform.localToWorldMatrix;\r\n        this.renderAtomic.uniforms.u_cameraPos = camera.transform.worldPosition;\r\n        this.renderAtomic.uniforms.u_skyBoxSize = camera.lens.far / Math.sqrt(3);\r\n\r\n        renderer.render(this.renderAtomic);\r\n    }\r\n}\r\n\r\n/**\r\n * 天空盒渲染器\r\n */\r\nexport const skyboxRenderer = new SkyBoxRenderer();\r\n","import { Ray3, Rectangle, Vector2, Vector3 } from '@feng3d/math';\r\nimport { WebGLRenderer } from '@feng3d/renderer';\r\nimport { serialization } from '@feng3d/serialization';\r\nimport { windowEventProxy } from '@feng3d/shortcut';\r\nimport { AudioListener } from '../audio/AudioListener';\r\nimport { Camera } from '../cameras/Camera';\r\nimport { DirectionalLight } from '../light/DirectionalLight';\r\nimport { ShadowType } from '../light/shadow/ShadowType';\r\nimport { forwardRenderer } from '../render/renderer/ForwardRenderer';\r\nimport { outlineRenderer } from '../render/renderer/OutlineRenderer';\r\nimport { shadowRenderer } from '../render/renderer/ShadowRenderer';\r\nimport { wireframeRenderer } from '../render/renderer/WireframeRenderer';\r\nimport { Scene } from '../scene/Scene';\r\nimport { skyboxRenderer } from '../skybox/SkyBoxRenderer';\r\nimport { ticker } from '../utils/Ticker';\r\nimport { Feng3dObject } from './Feng3dObject';\r\nimport { GameObject } from './GameObject';\r\nimport { Mouse3DManager, WindowMouseInput } from './Mouse3DManager';\r\nimport { Renderable } from './Renderable';\r\nimport { Transform } from './Transform';\r\n\r\ndeclare global\r\n{\r\n    interface HTMLCanvasElement\r\n    {\r\n        gl: WebGLRenderer;\r\n    }\r\n}\r\n\r\n/**\r\n * 视图\r\n */\r\nexport class View extends Feng3dObject\r\n{\r\n    //\r\n    canvas: HTMLCanvasElement;\r\n\r\n    private _contextAttributes: WebGLContextAttributes = { stencil: true };\r\n\r\n    /**\r\n     * 摄像机\r\n     */\r\n    get camera()\r\n    {\r\n        if (!this._camera)\r\n        {\r\n            const cameras = this.scene.getComponentsInChildren(Camera);\r\n            if (cameras.length === 0)\r\n            {\r\n                this._camera = serialization.setValue(new GameObject(), { name: 'defaultCamera' }).addComponent(Camera);\r\n                this.scene.gameObject.addChild(this._camera.gameObject);\r\n            }\r\n            else\r\n            {\r\n                this._camera = cameras[0];\r\n            }\r\n        }\r\n\r\n        return this._camera;\r\n    }\r\n    set camera(v)\r\n    {\r\n        this._camera = v;\r\n    }\r\n    private _camera: Camera;\r\n    /**\r\n     * 3d场景\r\n     */\r\n    scene: Scene;\r\n    /**\r\n     * 根结点\r\n     */\r\n    get root()\r\n    {\r\n        return this.scene.gameObject;\r\n    }\r\n\r\n    get gl()\r\n    {\r\n        if (!this.canvas.gl)\r\n        { this.canvas.gl = new WebGLRenderer(this.canvas, this._contextAttributes); }\r\n\r\n        return this.canvas.gl;\r\n    }\r\n\r\n    /**\r\n     * 鼠标在3D视图中的位置\r\n     */\r\n    mousePos = new Vector2();\r\n\r\n    viewRect = new Rectangle();\r\n\r\n    /**\r\n     * 鼠标事件管理\r\n     */\r\n    mouse3DManager: Mouse3DManager;\r\n\r\n    protected contextLost = false;\r\n\r\n    /**\r\n     * 构建3D视图\r\n     * @param canvas    画布\r\n     * @param scene     3D场景\r\n     * @param camera    摄像机\r\n     */\r\n    constructor(canvas?: HTMLCanvasElement, scene?: Scene, camera?: Camera, contextAttributes?: WebGLContextAttributes)\r\n    {\r\n        super();\r\n        if (!canvas)\r\n        {\r\n            canvas = document.createElement('canvas');\r\n            canvas.id = 'glcanvas';\r\n            canvas.style.position = 'fixed';\r\n            canvas.style.left = '0px';\r\n            canvas.style.top = '0px';\r\n            canvas.style.width = '100%';\r\n            canvas.style.height = '100%';\r\n            document.body.appendChild(canvas);\r\n        }\r\n        console.assert(canvas instanceof HTMLCanvasElement, `canvas参数必须为 HTMLCanvasElement 类型！`);\r\n\r\n        this.canvas = canvas;\r\n        if (contextAttributes)\r\n        {\r\n            Object.assign(this._contextAttributes, contextAttributes);\r\n        }\r\n\r\n        canvas.addEventListener('webglcontextlost', (event) =>\r\n        {\r\n            event.preventDefault();\r\n            this.contextLost = true;\r\n            // #ifdef DEBUG\r\n            console.log('GraphicsDevice: WebGL context lost.');\r\n            // #endif\r\n        }, false);\r\n\r\n        canvas.addEventListener('webglcontextrestored', () =>\r\n        {\r\n            this.contextLost = false;\r\n            // #ifdef DEBUG\r\n            console.log('GraphicsDevice: WebGL context restored.');\r\n            // #endif\r\n        }, false);\r\n\r\n        this.scene = scene || serialization.setValue(new GameObject(), { name: 'scene' }).addComponent(Scene);\r\n        this.camera = camera;\r\n\r\n        this.start();\r\n\r\n        this.mouse3DManager = new Mouse3DManager(new WindowMouseInput(), () => this.viewRect);\r\n    }\r\n\r\n    /**\r\n     * 修改canvas尺寸\r\n     * @param width 宽度\r\n     * @param height 高度\r\n     */\r\n    setSize(width: number, height: number)\r\n    {\r\n        this.canvas.width = width;\r\n        this.canvas.height = height;\r\n        this.canvas.style.width = `${width}px`;\r\n        this.canvas.style.height = `${height}px`;\r\n    }\r\n\r\n    start()\r\n    {\r\n        ticker.onframe(this.update, this);\r\n    }\r\n\r\n    stop()\r\n    {\r\n        ticker.offframe(this.update, this);\r\n    }\r\n\r\n    update(interval?: number)\r\n    {\r\n        this.render(interval);\r\n        this.mouse3DManager.selectedGameObject = this.selectedObject;\r\n    }\r\n\r\n    /**\r\n     * 绘制场景\r\n     */\r\n    render(interval?: number)\r\n    {\r\n        if (!this.scene) return;\r\n        if (this.contextLost) return;\r\n\r\n        this.scene.update(interval);\r\n\r\n        this.canvas.width = this.canvas.clientWidth;\r\n        this.canvas.height = this.canvas.clientHeight;\r\n        if (this.canvas.width * this.canvas.height === 0) return;\r\n\r\n        const clientRect = this.canvas.getBoundingClientRect();\r\n\r\n        this.viewRect.x = clientRect.left;\r\n        this.viewRect.y = clientRect.top;\r\n        this.viewRect.width = clientRect.width;\r\n        this.viewRect.height = clientRect.height;\r\n\r\n        this.mousePos.x = windowEventProxy.clientX - clientRect.left;\r\n        this.mousePos.y = windowEventProxy.clientY - clientRect.top;\r\n\r\n        this.camera.lens.aspect = this.viewRect.width / this.viewRect.height;\r\n\r\n        // 设置鼠标射线\r\n        this.calcMouseRay3D();\r\n\r\n        this.scene.mouseRay3D = this.mouseRay3D;\r\n        this.scene.camera = this.camera;\r\n\r\n        const gl = this.gl.gl;\r\n\r\n        // 默认渲染\r\n        gl.colorMask(true, true, true, true);\r\n        gl.clearColor(this.scene.background.r, this.scene.background.g, this.scene.background.b, this.scene.background.a);\r\n        gl.clearStencil(0);\r\n        gl.clearDepth(1);\r\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT | gl.STENCIL_BUFFER_BIT);\r\n        gl.enable(gl.DEPTH_TEST);\r\n\r\n        // 鼠标拾取渲染\r\n        this.selectedObject = this.mouse3DManager.pick(this, this.scene, this.camera);\r\n        // 绘制阴影图\r\n        shadowRenderer.draw(this.gl, this.scene, this.camera);\r\n        skyboxRenderer.draw(this.gl, this.scene, this.camera);\r\n        // 默认渲染\r\n        forwardRenderer.draw(this.gl, this.scene, this.camera);\r\n        outlineRenderer.draw(this.gl, this.scene, this.camera);\r\n        wireframeRenderer.draw(this.gl, this.scene, this.camera);\r\n    }\r\n\r\n    /**\r\n     * 屏幕坐标转GPU坐标\r\n     * @param screenPos 屏幕坐标 (x: [0-width], y: [0 - height])\r\n     * @return GPU坐标 (x: [-1, 1], y: [-1, 1])\r\n     */\r\n    screenToGpuPosition(screenPos: Vector2): Vector2\r\n    {\r\n        const gpuPos: Vector2 = new Vector2();\r\n        gpuPos.x = (screenPos.x * 2 - this.viewRect.width) / this.viewRect.width;\r\n        // 屏幕坐标与gpu中使用的坐标Y轴方向相反\r\n        gpuPos.y = -(screenPos.y * 2 - this.viewRect.height) / this.viewRect.height;\r\n\r\n        return gpuPos;\r\n    }\r\n\r\n    /**\r\n     * 投影坐标（世界坐标转换为3D视图坐标）\r\n     * @param point3d 世界坐标\r\n     * @return 屏幕的绝对坐标\r\n     */\r\n    project(point3d: Vector3): Vector3\r\n    {\r\n        const v: Vector3 = this.camera.project(point3d);\r\n        v.x = (v.x + 1.0) * this.viewRect.width / 2.0;\r\n        v.y = (1.0 - v.y) * this.viewRect.height / 2.0;\r\n\r\n        return v;\r\n    }\r\n\r\n    /**\r\n     * 屏幕坐标投影到场景坐标\r\n     * @param nX 屏幕坐标X ([0-width])\r\n     * @param nY 屏幕坐标Y ([0-height])\r\n     * @param sZ 到屏幕的距离\r\n     * @param v 场景坐标（输出）\r\n     * @return 场景坐标\r\n     */\r\n    unproject(sX: number, sY: number, sZ: number, v = new Vector3()): Vector3\r\n    {\r\n        const gpuPos: Vector2 = this.screenToGpuPosition(new Vector2(sX, sY));\r\n\r\n        return this.camera.unproject(gpuPos.x, gpuPos.y, sZ, v);\r\n    }\r\n\r\n    /**\r\n     * 获取单位像素在指定深度映射的大小\r\n     * @param   depth   深度\r\n     */\r\n    getScaleByDepth(depth: number, dir = new Vector2(0, 1))\r\n    {\r\n        let scale = this.camera.getScaleByDepth(depth, dir);\r\n        scale = scale / new Vector2(this.viewRect.width * dir.x, this.viewRect.height * dir.y).length;\r\n\r\n        return scale;\r\n    }\r\n\r\n    /**\r\n     * 获取鼠标射线（与鼠标重叠的摄像机射线）\r\n     */\r\n    mouseRay3D: Ray3;\r\n\r\n    private calcMouseRay3D()\r\n    {\r\n        const gpuPos = this.screenToGpuPosition(this.mousePos);\r\n        this.mouseRay3D = this.camera.getRay3D(gpuPos.x, gpuPos.y);\r\n    }\r\n\r\n    /**\r\n     * 获取屏幕区域内所有游戏对象\r\n     * @param start 起点\r\n     * @param end 终点\r\n     */\r\n    getObjectsInGlobalArea(start: Vector2, end: Vector2)\r\n    {\r\n        const s = this.viewRect.clampPoint(start);\r\n        const e = this.viewRect.clampPoint(end);\r\n        s.sub(this.viewRect.topLeft);\r\n        e.sub(this.viewRect.topLeft);\r\n        const min = s.clone().min(e);\r\n        const max = s.clone().max(e);\r\n        const rect = new Rectangle(min.x, min.y, max.x - min.x, max.y - min.y);\r\n        //\r\n        const gs = this.scene.getComponentsInChildren(Transform).filter((t) =>\r\n        {\r\n            if (t === this.scene.transform) return false;\r\n            const m = t.getComponent(Renderable);\r\n            if (m)\r\n            {\r\n                const include = m.selfWorldBounds.toPoints().every((pos) =>\r\n                {\r\n                    const p = this.project(pos);\r\n\r\n                    return rect.contains(p.x, p.y);\r\n                });\r\n\r\n                return include;\r\n            }\r\n            const p = this.project(t.worldPosition);\r\n\r\n            return rect.contains(p.x, p.y);\r\n        }).map((t) => t.gameObject);\r\n\r\n        return gs;\r\n    }\r\n\r\n    protected selectedObject: GameObject;\r\n\r\n    static createNewScene()\r\n    {\r\n        const scene = serialization.setValue(new GameObject(), { name: 'Untitled' }).addComponent(Scene);\r\n        scene.background.setTo(0.2784, 0.2784, 0.2784);\r\n        scene.ambientColor.setTo(0.4, 0.4, 0.4);\r\n\r\n        const camera = GameObject.createPrimitive('Camera', { name: 'Main Camera' });\r\n        camera.addComponent(AudioListener);\r\n        camera.transform.position = new Vector3(0, 1, -10);\r\n        scene.gameObject.addChild(camera);\r\n\r\n        const directionalLight = serialization.setValue(new GameObject(), { name: 'DirectionalLight' });\r\n        directionalLight.addComponent(DirectionalLight).shadowType = ShadowType.Hard_Shadows;\r\n        directionalLight.transform.rx = 50;\r\n        directionalLight.transform.ry = -30;\r\n        directionalLight.transform.y = 3;\r\n        scene.gameObject.addChild(directionalLight);\r\n\r\n        return scene;\r\n    }\r\n}\r\n\r\n// var viewRect0 = { x: 0, y: 0, w: 400, h: 300 };\r\n","import { serialize } from '@feng3d/serialization';\r\nimport { Geometry } from './Geometry';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsGeometryTypes\r\n    {\r\n        CustomGeometry: CustomGeometry\r\n    }\r\n}\r\n\r\nexport class CustomGeometry extends Geometry\r\n{\r\n    __class__: 'feng3d.CustomGeometry';\r\n\r\n    /**\r\n     * 顶点索引缓冲\r\n     */\r\n    @serialize\r\n    private get indicesData()\r\n    {\r\n        return this.indices;\r\n    }\r\n\r\n    private set indicesData(v)\r\n    {\r\n        this.indices = v;\r\n    }\r\n\r\n    /**\r\n     * 属性数据列表\r\n     */\r\n    @serialize\r\n    get attributes()\r\n    {\r\n        return this._attributes;\r\n    }\r\n    set attributes(v)\r\n    {\r\n        this._attributes = v;\r\n    }\r\n}\r\n","import { Color4, Vector2, Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { Geometry } from './Geometry';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsGeometryTypes\r\n    {\r\n        PointGeometry: PointGeometry\r\n    }\r\n}\r\n\r\n/**\r\n * 点几何体\r\n */\r\nexport class PointGeometry extends Geometry\r\n{\r\n    __class__: 'feng3d.PointGeometry';\r\n\r\n    /**\r\n     * 点数据列表\r\n     * 修改数组内数据时需要手动调用 invalidateGeometry();\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    points: PointInfo[] = [];\r\n\r\n    /**\r\n     * 构建几何体\r\n     */\r\n    buildGeometry()\r\n    {\r\n        let numPoints = this.points.length;\r\n        const indices: number[] = [];\r\n        const positionData: number[] = [];\r\n        const normalData: number[] = [];\r\n        const uvData: number[] = [];\r\n        const colors: number[] = [];\r\n\r\n        numPoints = Math.max(1, numPoints);\r\n\r\n        for (let i = 0; i < numPoints; i++)\r\n        {\r\n            const element = this.points[i];\r\n            const position = (element && element.position) || Vector3.ZERO;\r\n            const color = (element && element.color) || Color4.WHITE;\r\n            const normal = (element && element.normal) || Vector3.ZERO;\r\n            const uv = (element && element.uv) || Vector2.zero;\r\n            indices[i] = i;\r\n            positionData.push(position.x, position.y, position.z);\r\n            normalData.push(normal.x, normal.y, normal.z);\r\n            uvData.push(uv.x, uv.y);\r\n            colors.push(color.r, color.g, color.b, color.a);\r\n        }\r\n        this.positions = positionData;\r\n        this.uvs = uvData;\r\n        this.normals = normalData;\r\n        this.indices = indices;\r\n        this.colors = colors;\r\n    }\r\n}\r\n\r\n/**\r\n * 点信息\r\n */\r\nexport interface PointInfo\r\n{\r\n    position?: Vector3;\r\n    color?: Color4;\r\n    normal?: Vector3;\r\n    uv?: Vector2;\r\n}\r\n","import { Color4, Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { GameObject } from '../core/GameObject';\r\nimport { MeshRenderer } from '../core/MeshRenderer';\r\nimport { Material } from '../materials/Material';\r\nimport { createNodeMenu } from '../menu/CreateNodeMenu';\r\nimport { Geometry } from './Geometry';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        Segment: GameObject;\r\n    }\r\n    export interface MixinsGeometryTypes\r\n    {\r\n        SegmentGeometry: SegmentGeometry\r\n    }\r\n}\r\n/**\r\n * 线段组件\r\n */\r\nexport class SegmentGeometry extends Geometry\r\n{\r\n    __class__: 'feng3d.SegmentGeometry';\r\n\r\n    name = 'Segment';\r\n\r\n    /**\r\n     * 线段列表\r\n     * 修改数组内数据时需要手动调用 invalidateGeometry();\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVArray', tooltip: '在指定时间进行额外发射指定数量的粒子', componentParam: { defaultItem: () => new Segment() } })\r\n    @watch('invalidateGeometry')\r\n    segments: Segment[] = [];\r\n\r\n    /**\r\n     * 添加线段\r\n     *\r\n     * @param segment 线段\r\n     */\r\n    addSegment(segment: Partial<Segment>)\r\n    {\r\n        const s = new Segment();\r\n        serialization.setValue(s, segment);\r\n        this.segments.push(s);\r\n        this.invalidateGeometry();\r\n    }\r\n\r\n    constructor()\r\n    {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * 更新几何体\r\n     */\r\n    protected buildGeometry()\r\n    {\r\n        const numSegments = this.segments.length;\r\n        const indices: number[] = [];\r\n        const positionData: number[] = [];\r\n        const colorData: number[] = [];\r\n\r\n        for (let i = 0; i < numSegments; i++)\r\n        {\r\n            const element = this.segments[i];\r\n            const start = element.start || Vector3.ZERO;\r\n            const end = element.end || Vector3.ZERO;\r\n            const startColor = element.startColor || Color4.WHITE;\r\n            const endColor = element.endColor || Color4.WHITE;\r\n\r\n            indices.push(i * 2, i * 2 + 1);\r\n            positionData.push(start.x, start.y, start.z, end.x, end.y, end.z);\r\n            colorData.push(startColor.r, startColor.g, startColor.b, startColor.a,\r\n                endColor.r, endColor.g, endColor.b, endColor.a);\r\n        }\r\n\r\n        this.positions = positionData;\r\n        this.colors = colorData;\r\n        this.indices = indices;\r\n    }\r\n}\r\n\r\n/**\r\n * 线段\r\n */\r\nexport class Segment\r\n{\r\n    /**\r\n     * 起点坐标\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '起点坐标' })\r\n    start = new Vector3();\r\n\r\n    /**\r\n     * 终点坐标\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '终点坐标' })\r\n    end = new Vector3();\r\n\r\n    /**\r\n     * 起点颜色\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '起点颜色' })\r\n    startColor = new Color4();\r\n\r\n    /**\r\n     * 终点颜色\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '终点颜色' })\r\n    endColor = new Color4();\r\n}\r\n\r\nGameObject.registerPrimitive('Segment', (g) =>\r\n{\r\n    const model = g.addComponent(MeshRenderer);\r\n    model.geometry = new SegmentGeometry();\r\n    model.material = Material.getDefault('Segment-Material');\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n    {\r\n        path: '3D Object/Segment',\r\n        priority: -10000,\r\n        click: () =>\r\n            GameObject.createPrimitive('Segment')\r\n    }\r\n);\r\n\r\n","import { Color4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { shaderlib } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport colorFragment from '../shaders/color.fragment.glsl';\r\nimport colorVertex from '../shaders/color.vertex.glsl';\r\n\r\ndeclare global\r\n{\r\n    interface MixinsUniformsTypes\r\n    {\r\n        color: ColorUniforms\r\n    }\r\n}\r\n\r\nexport class ColorUniforms\r\n{\r\n    __class__: 'feng3d.ColorUniforms';\r\n    /**\r\n     * 颜色\r\n     */\r\n    @serialize\r\n    @oav()\r\n    u_diffuseInput = new Color4();\r\n}\r\n\r\nshaderlib.shaderConfig.shaders.color = { fragment: colorFragment, vertex: colorVertex, cls: ColorUniforms };\r\n","import { Color4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { shaderlib } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport pointFragment from '../shaders/point.fragment.glsl';\r\nimport pointVertex from '../shaders/point.vertex.glsl';\r\n\r\ndeclare global\r\n{\r\n    interface MixinsUniformsTypes\r\n    {\r\n        point: PointUniforms\r\n    }\r\n}\r\n\r\nexport class PointUniforms\r\n{\r\n    __class__: 'feng3d.PointUniforms';\r\n    /**\r\n     * 颜色\r\n     */\r\n    @serialize\r\n    @oav()\r\n    u_color = new Color4();\r\n\r\n    /**\r\n     * 点绘制时点的尺寸\r\n     */\r\n    @serialize\r\n    @oav()\r\n    u_PointSize = 1;\r\n}\r\n\r\nshaderlib.shaderConfig.shaders.point = { fragment: pointFragment, vertex: pointVertex, cls: PointUniforms };\r\n","import { Color4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { RenderMode, shaderlib } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport segmentFragment from '../shaders/segment.fragment.glsl';\r\nimport segmentVertex from '../shaders/segment.vertex.glsl';\r\nimport { Material } from './Material';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsUniformsTypes\r\n    {\r\n        segment: SegmentUniforms\r\n    }\r\n\r\n    export interface MixinsDefaultMaterial\r\n    {\r\n        'Segment-Material': Material;\r\n    }\r\n}\r\n\r\n/**\r\n * 线段材质\r\n * 目前webgl不支持修改线条宽度，参考：https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/lineWidth\r\n */\r\nexport class SegmentUniforms\r\n{\r\n    __class__: 'feng3d.SegmentUniforms';\r\n\r\n    /**\r\n     * 颜色\r\n     */\r\n    @serialize\r\n    @oav()\r\n    u_segmentColor = new Color4();\r\n}\r\n\r\nshaderlib.shaderConfig.shaders.segment = {\r\n    fragment: segmentFragment, vertex: segmentVertex, cls: SegmentUniforms,\r\n    renderParams: { renderMode: RenderMode.LINES, enableBlend: true }\r\n};\r\n\r\nMaterial.setDefault('Segment-Material', { shaderName: 'segment' });\r\n","import { Color4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { shaderlib } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport textureFragment from '../shaders/texture.fragment.glsl';\r\nimport textureVertex from '../shaders/texture.vertex.glsl';\r\nimport { Texture2D } from '../textures/Texture2D';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsUniformsTypes\r\n    {\r\n        texture: TextureUniforms\r\n    }\r\n}\r\nexport class TextureUniforms\r\n{\r\n    __class__: 'feng3d.TextureUniforms';\r\n    /**\r\n     * 颜色\r\n     */\r\n    @serialize\r\n    @oav()\r\n    u_color = new Color4();\r\n\r\n    /**\r\n     * 纹理数据\r\n     */\r\n    @oav()\r\n    @serialize\r\n    s_texture = Texture2D.default;\r\n}\r\n\r\nshaderlib.shaderConfig.shaders.texture = { fragment: textureFragment, vertex: textureVertex, cls: TextureUniforms };\r\n","import { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { GameObject } from '../core/GameObject';\r\nimport { MeshRenderer } from '../core/MeshRenderer';\r\nimport { Geometry } from '../geometry/Geometry';\r\nimport { createNodeMenu } from '../menu/CreateNodeMenu';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsGeometryTypes\r\n    {\r\n        CapsuleGeometry: CapsuleGeometry\r\n    }\r\n\r\n    export interface MixinsDefaultGeometry\r\n    {\r\n        Capsule: CapsuleGeometry;\r\n    }\r\n\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        Capsule: GameObject;\r\n    }\r\n}\r\n\r\n/**\r\n * 胶囊体几何体\r\n */\r\nexport class CapsuleGeometry extends Geometry\r\n{\r\n    __class__: 'feng3d.CapsuleGeometry';\r\n\r\n    /**\r\n     * 胶囊体半径\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    radius = 0.5;\r\n\r\n    /**\r\n     * 胶囊体高度\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    height = 1;\r\n\r\n    /**\r\n     * 横向分割数\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    segmentsW = 16;\r\n\r\n    /**\r\n     * 纵向分割数\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    segmentsH = 15;\r\n\r\n    /**\r\n     * 正面朝向 true:Y+ false:Z+\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    yUp = true;\r\n\r\n    name = 'Capsule';\r\n\r\n    /**\r\n     * 构建几何体数据\r\n     * @param radius 胶囊体半径\r\n     * @param height 胶囊体高度\r\n     * @param segmentsW 横向分割数\r\n     * @param segmentsH 纵向分割数\r\n     * @param yUp 正面朝向 true:Y+ false:Z+\r\n     */\r\n    protected buildGeometry()\r\n    {\r\n        const vertexPositionData: number[] = [];\r\n        const vertexNormalData: number[] = [];\r\n        const vertexTangentData: number[] = [];\r\n\r\n        let startIndex: number;\r\n        let index = 0;\r\n        let comp1: number; let comp2: number; let t1: number; let\r\n            t2: number;\r\n        for (let yi = 0; yi <= this.segmentsH; ++yi)\r\n        {\r\n            startIndex = index;\r\n\r\n            const horangle = Math.PI * yi / this.segmentsH;\r\n            const z = -this.radius * Math.cos(horangle);\r\n            const ringradius = this.radius * Math.sin(horangle);\r\n\r\n            for (let xi = 0; xi <= this.segmentsW; ++xi)\r\n            {\r\n                const verangle = 2 * Math.PI * xi / this.segmentsW;\r\n                const x = ringradius * Math.cos(verangle);\r\n                const y = ringradius * Math.sin(verangle);\r\n                const normLen = 1 / Math.sqrt(x * x + y * y + z * z);\r\n                const tanLen = Math.sqrt(y * y + x * x);\r\n                const offset = yi > this.segmentsH / 2 ? this.height / 2 : -this.height / 2;\r\n\r\n                if (this.yUp)\r\n                {\r\n                    t1 = 0;\r\n                    t2 = tanLen > 0.007 ? x / tanLen : 0;\r\n                    comp1 = -z;\r\n                    comp2 = y;\r\n                }\r\n                else\r\n                {\r\n                    t1 = tanLen > 0.007 ? x / tanLen : 0;\r\n                    t2 = 0;\r\n                    comp1 = y;\r\n                    comp2 = z;\r\n                }\r\n\r\n                if (xi === this.segmentsW)\r\n                {\r\n                    vertexPositionData[index] = vertexPositionData[startIndex];\r\n                    vertexPositionData[index + 1] = vertexPositionData[startIndex + 1];\r\n                    vertexPositionData[index + 2] = vertexPositionData[startIndex + 2];\r\n\r\n                    vertexNormalData[index] = (vertexNormalData[startIndex] + x * normLen) * 0.5;\r\n                    vertexNormalData[index + 1] = (vertexNormalData[startIndex + 1] + comp1 * normLen) * 0.5;\r\n                    vertexNormalData[index + 2] = (vertexNormalData[startIndex + 2] + comp2 * normLen) * 0.5;\r\n\r\n                    vertexTangentData[index] = (vertexTangentData[startIndex] + tanLen > 0.007 ? -y / tanLen : 1) * 0.5;\r\n                    vertexTangentData[index + 1] = (vertexTangentData[startIndex + 1] + t1) * 0.5;\r\n                    vertexTangentData[index + 2] = (vertexTangentData[startIndex + 2] + t2) * 0.5;\r\n                }\r\n                else\r\n                {\r\n                    vertexPositionData[index] = x;\r\n                    vertexPositionData[index + 1] = this.yUp ? comp1 - offset : comp1;\r\n                    vertexPositionData[index + 2] = this.yUp ? comp2 : comp2 + offset;\r\n\r\n                    vertexNormalData[index] = x * normLen;\r\n                    vertexNormalData[index + 1] = comp1 * normLen;\r\n                    vertexNormalData[index + 2] = comp2 * normLen;\r\n\r\n                    vertexTangentData[index] = tanLen > 0.007 ? -y / tanLen : 1;\r\n                    vertexTangentData[index + 1] = t1;\r\n                    vertexTangentData[index + 2] = t2;\r\n                }\r\n\r\n                if (xi > 0 && yi > 0)\r\n                {\r\n                    if (yi === this.segmentsH)\r\n                    {\r\n                        vertexPositionData[index] = vertexPositionData[startIndex];\r\n                        vertexPositionData[index + 1] = vertexPositionData[startIndex + 1];\r\n                        vertexPositionData[index + 2] = vertexPositionData[startIndex + 2];\r\n                    }\r\n                }\r\n\r\n                index += 3;\r\n            }\r\n        }\r\n        this.positions = vertexPositionData;\r\n        this.normals = vertexNormalData;\r\n        this.tangents = vertexTangentData;\r\n\r\n        const uvData = this.buildUVs();\r\n        this.uvs = uvData;\r\n\r\n        this.buildIndices();\r\n    }\r\n\r\n    /**\r\n     * 构建顶点索引\r\n     * @param segmentsW 横向分割数\r\n     * @param segmentsH 纵向分割数\r\n     * @param yUp 正面朝向 true:Y+ false:Z+\r\n     */\r\n    private buildIndices()\r\n    {\r\n        const indices: number[] = [];\r\n\r\n        let numIndices = 0;\r\n        for (let yi = 0; yi <= this.segmentsH; ++yi)\r\n        {\r\n            for (let xi = 0; xi <= this.segmentsW; ++xi)\r\n            {\r\n                if (xi > 0 && yi > 0)\r\n                {\r\n                    const a = (this.segmentsW + 1) * yi + xi;\r\n                    const b = (this.segmentsW + 1) * yi + xi - 1;\r\n                    const c = (this.segmentsW + 1) * (yi - 1) + xi - 1;\r\n                    const d = (this.segmentsW + 1) * (yi - 1) + xi;\r\n\r\n                    if (yi === this.segmentsH)\r\n                    {\r\n                        indices[numIndices++] = a;\r\n                        indices[numIndices++] = c;\r\n                        indices[numIndices++] = d;\r\n                    }\r\n                    else if (yi === 1)\r\n                    {\r\n                        indices[numIndices++] = a;\r\n                        indices[numIndices++] = b;\r\n                        indices[numIndices++] = c;\r\n                    }\r\n                    else\r\n                    {\r\n                        indices[numIndices++] = a;\r\n                        indices[numIndices++] = b;\r\n                        indices[numIndices++] = c;\r\n                        indices[numIndices++] = a;\r\n                        indices[numIndices++] = c;\r\n                        indices[numIndices++] = d;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this.indices = indices;\r\n    }\r\n\r\n    /**\r\n     * 构建uv\r\n     * @param segmentsW 横向分割数\r\n     * @param segmentsH 纵向分割数\r\n     */\r\n    private buildUVs()\r\n    {\r\n        const data: number[] = [];\r\n        let index = 0;\r\n\r\n        for (let yi = 0; yi <= this.segmentsH; ++yi)\r\n        {\r\n            for (let xi = 0; xi <= this.segmentsW; ++xi)\r\n            {\r\n                data[index++] = xi / this.segmentsW;\r\n                data[index++] = yi / this.segmentsH;\r\n            }\r\n        }\r\n\r\n        return data;\r\n    }\r\n}\r\n\r\nGeometry.setDefault('Capsule', new CapsuleGeometry());\r\n\r\nGameObject.registerPrimitive('Capsule', (g) =>\r\n{\r\n    g.addComponent(MeshRenderer).geometry = Geometry.getDefault('Capsule');\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n    {\r\n        path: '3D Object/Capsule',\r\n        priority: -3,\r\n        click: () =>\r\n            GameObject.createPrimitive('Capsule')\r\n    }\r\n);\r\n\r\n","import { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { GameObject } from '../core/GameObject';\r\nimport { MeshRenderer } from '../core/MeshRenderer';\r\nimport { Geometry } from '../geometry/Geometry';\r\nimport { createNodeMenu } from '../menu/CreateNodeMenu';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsGeometryTypes\r\n    {\r\n        CylinderGeometry: CylinderGeometry\r\n    }\r\n\r\n    export interface MixinsDefaultGeometry\r\n    {\r\n        Cylinder: CylinderGeometry;\r\n    }\r\n\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        Cylinder: GameObject;\r\n    }\r\n}\r\n\r\n/**\r\n * 圆柱体几何体\r\n * @author DawnKing 2016-09-12\r\n */\r\nexport class CylinderGeometry extends Geometry\r\n{\r\n    __class__: 'feng3d.CylinderGeometry' | 'feng3d.ConeGeometry';\r\n\r\n    /**\r\n     * 顶部半径\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    topRadius = 0.5;\r\n\r\n    /**\r\n     * 底部半径\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    bottomRadius = 0.5;\r\n\r\n    /**\r\n     * 高度\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    height = 2;\r\n\r\n    /**\r\n     * 横向分割数\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    segmentsW = 16;\r\n\r\n    /**\r\n     * 纵向分割数\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    segmentsH = 1;\r\n\r\n    /**\r\n     * 顶部是否封口\r\n     */\r\n    @oav()\r\n    @serialize\r\n    @watch('invalidateGeometry')\r\n    topClosed = true;\r\n\r\n    /**\r\n     * 底部是否封口\r\n     */\r\n    @oav()\r\n    @serialize\r\n    @watch('invalidateGeometry')\r\n    bottomClosed = true;\r\n\r\n    /**\r\n     * 侧面是否封口\r\n     */\r\n    @oav()\r\n    @serialize\r\n    @watch('invalidateGeometry')\r\n    surfaceClosed = true;\r\n\r\n    /**\r\n     * 是否朝上\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    yUp = true;\r\n\r\n    name = 'Cylinder';\r\n\r\n    /**\r\n     * 构建几何体数据\r\n     */\r\n    protected buildGeometry()\r\n    {\r\n        let i: number; let j: number; let\r\n            index = 0;\r\n        let x: number; let y: number; let z: number; let radius: number; let\r\n            revolutionAngle = 0;\r\n\r\n        let comp1: number; let\r\n            comp2: number;\r\n        let startIndex = 0;\r\n        let t1: number; let\r\n            t2: number;\r\n\r\n        const vertexPositionData: number[] = [];\r\n        const vertexNormalData: number[] = [];\r\n        const vertexTangentData: number[] = [];\r\n\r\n        const revolutionAngleDelta = 2 * Math.PI / this.segmentsW;\r\n\r\n        // 顶部\r\n        if (this.topClosed && this.topRadius > 0)\r\n        {\r\n            z = -0.5 * this.height;\r\n\r\n            for (i = 0; i <= this.segmentsW; ++i)\r\n            {\r\n                // 中心顶点\r\n                if (this.yUp)\r\n                {\r\n                    t1 = 1;\r\n                    t2 = 0;\r\n                    comp1 = -z;\r\n                    comp2 = 0;\r\n                }\r\n                else\r\n                {\r\n                    t1 = 0;\r\n                    t2 = -1;\r\n                    comp1 = 0;\r\n                    comp2 = z;\r\n                }\r\n\r\n                addVertex(0, comp1, comp2, 0, t1, t2, 1, 0, 0);\r\n\r\n                // 旋转顶点\r\n                revolutionAngle = i * revolutionAngleDelta;\r\n                x = this.topRadius * Math.cos(revolutionAngle);\r\n                y = this.topRadius * Math.sin(revolutionAngle);\r\n\r\n                if (this.yUp)\r\n                {\r\n                    comp1 = -z;\r\n                    comp2 = y;\r\n                }\r\n                else\r\n                {\r\n                    comp1 = y;\r\n                    comp2 = z;\r\n                }\r\n\r\n                if (i === this.segmentsW)\r\n                {\r\n                    addVertex(vertexPositionData[startIndex + 3], vertexPositionData[startIndex + 4], vertexPositionData[startIndex + 5],\r\n                        0, t1, t2, 1, 0, 0);\r\n                }\r\n                else\r\n                {\r\n                    addVertex(x, comp1, comp2,\r\n                        0, t1, t2, 1, 0, 0);\r\n                }\r\n            }\r\n        }\r\n\r\n        // 底部\r\n        if (this.bottomClosed && this.bottomRadius > 0)\r\n        {\r\n            z = 0.5 * this.height;\r\n            startIndex = index;\r\n            for (i = 0; i <= this.segmentsW; ++i)\r\n            {\r\n                // 中心顶点\r\n                if (this.yUp)\r\n                {\r\n                    t1 = -1;\r\n                    t2 = 0;\r\n                    comp1 = -z;\r\n                    comp2 = 0;\r\n                }\r\n                else\r\n                {\r\n                    t1 = 0;\r\n                    t2 = 1;\r\n                    comp1 = 0;\r\n                    comp2 = z;\r\n                }\r\n\r\n                addVertex(0, comp1, comp2, 0, t1, t2, 1, 0, 0);\r\n\r\n                // 旋转顶点\r\n                revolutionAngle = i * revolutionAngleDelta;\r\n                x = this.bottomRadius * Math.cos(revolutionAngle);\r\n                y = this.bottomRadius * Math.sin(revolutionAngle);\r\n\r\n                if (this.yUp)\r\n                {\r\n                    comp1 = -z;\r\n                    comp2 = y;\r\n                }\r\n                else\r\n                {\r\n                    comp1 = y;\r\n                    comp2 = z;\r\n                }\r\n\r\n                if (i === this.segmentsW)\r\n                {\r\n                    addVertex(x, vertexPositionData[startIndex + 1], vertexPositionData[startIndex + 2],\r\n                        0, t1, t2, 1, 0, 0);\r\n                }\r\n                else\r\n                {\r\n                    addVertex(x, comp1, comp2,\r\n                        0, t1, t2, 1, 0, 0);\r\n                }\r\n            }\r\n        }\r\n\r\n        // 侧面\r\n        const dr = this.bottomRadius - this.topRadius;\r\n        const latNormElev = dr / this.height;\r\n        const latNormBase = (latNormElev === 0) ? 1 : this.height / dr;\r\n\r\n        if (this.surfaceClosed)\r\n        {\r\n            let na0: number; let na1: number; let naComp1: number; let\r\n                naComp2: number;\r\n\r\n            for (j = 0; j <= this.segmentsH; ++j)\r\n            {\r\n                radius = this.topRadius - ((j / this.segmentsH) * (this.topRadius - this.bottomRadius));\r\n                z = -(this.height / 2) + (j / this.segmentsH * this.height);\r\n\r\n                startIndex = index;\r\n                for (i = 0; i <= this.segmentsW; ++i)\r\n                {\r\n                    revolutionAngle = i * revolutionAngleDelta;\r\n                    x = radius * Math.cos(revolutionAngle);\r\n                    y = radius * Math.sin(revolutionAngle);\r\n                    na0 = latNormBase * Math.cos(revolutionAngle);\r\n                    na1 = latNormBase * Math.sin(revolutionAngle);\r\n\r\n                    if (this.yUp)\r\n                    {\r\n                        t1 = 0;\r\n                        t2 = -na0;\r\n                        comp1 = -z;\r\n                        comp2 = y;\r\n                        naComp1 = latNormElev;\r\n                        naComp2 = na1;\r\n                    }\r\n                    else\r\n                    {\r\n                        t1 = -na0;\r\n                        t2 = 0;\r\n                        comp1 = y;\r\n                        comp2 = z;\r\n                        naComp1 = na1;\r\n                        naComp2 = latNormElev;\r\n                    }\r\n\r\n                    if (i === this.segmentsW)\r\n                    {\r\n                        addVertex(vertexPositionData[startIndex], vertexPositionData[startIndex + 1], vertexPositionData[startIndex + 2],\r\n                            na0, latNormElev, na1,\r\n                            na1, t1, t2);\r\n                    }\r\n                    else\r\n                    {\r\n                        addVertex(x, comp1, comp2,\r\n                            na0, naComp1, naComp2,\r\n                            -na1, t1, t2);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        this.positions = vertexPositionData;\r\n        this.normals = vertexNormalData;\r\n        this.tangents = vertexTangentData;\r\n\r\n        function addVertex(px: number, py: number, pz: number, nx: number, ny: number, nz: number, tx: number, ty: number, tz: number)\r\n        {\r\n            vertexPositionData[index] = px;\r\n            vertexPositionData[index + 1] = py;\r\n            vertexPositionData[index + 2] = pz;\r\n\r\n            vertexNormalData[index] = nx;\r\n            vertexNormalData[index + 1] = ny;\r\n            vertexNormalData[index + 2] = nz;\r\n\r\n            vertexTangentData[index] = tx;\r\n            vertexTangentData[index + 1] = ty;\r\n            vertexTangentData[index + 2] = tz;\r\n\r\n            index += 3;\r\n        }\r\n\r\n        //\r\n        const uvData = this.buildUVs();\r\n        this.uvs = uvData;\r\n\r\n        const indices = this.buildIndices();\r\n        this.indices = indices;\r\n    }\r\n\r\n    /**\r\n     * 构建顶点索引\r\n     * @param segmentsW 横向分割数\r\n     * @param segmentsH 纵向分割数\r\n     * @param yUp 正面朝向 true:Y+ false:Z+\r\n     */\r\n    private buildIndices()\r\n    {\r\n        let i: number; let j: number; let\r\n            index = 0;\r\n\r\n        const indices: number[] = [];\r\n        let numIndices = 0;\r\n        // 顶部\r\n        if (this.topClosed && this.topRadius > 0)\r\n        {\r\n            for (i = 0; i <= this.segmentsW; ++i)\r\n            {\r\n                index += 2;\r\n                if (i > 0)\r\n                { addTriangleClockWise(index - 1, index - 3, index - 2); }\r\n            }\r\n        }\r\n\r\n        // 底部\r\n        if (this.bottomClosed && this.bottomRadius > 0)\r\n        {\r\n            for (i = 0; i <= this.segmentsW; ++i)\r\n            {\r\n                index += 2;\r\n                if (i > 0)\r\n                { addTriangleClockWise(index - 2, index - 3, index - 1); }\r\n            }\r\n        }\r\n\r\n        // 侧面\r\n        if (this.surfaceClosed)\r\n        {\r\n            let a: number; let b: number; let c: number; let\r\n                d: number;\r\n            for (j = 0; j <= this.segmentsH; ++j)\r\n            {\r\n                for (i = 0; i <= this.segmentsW; ++i)\r\n                {\r\n                    index++;\r\n                    if (i > 0 && j > 0)\r\n                    {\r\n                        a = index - 1;\r\n                        b = index - 2;\r\n                        c = b - this.segmentsW - 1;\r\n                        d = a - this.segmentsW - 1;\r\n\r\n                        addTriangleClockWise(a, b, c);\r\n                        addTriangleClockWise(a, c, d);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return indices;\r\n\r\n        function addTriangleClockWise(cwVertexIndex0: number, cwVertexIndex1: number, cwVertexIndex2: number)\r\n        {\r\n            indices[numIndices++] = cwVertexIndex0;\r\n            indices[numIndices++] = cwVertexIndex1;\r\n            indices[numIndices++] = cwVertexIndex2;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 构建uv\r\n     * @param segmentsW 横向分割数\r\n     * @param segmentsH 纵向分割数\r\n     */\r\n    private buildUVs()\r\n    {\r\n        let i: number; let\r\n            j: number;\r\n        let x: number; let y: number; let\r\n            revolutionAngle: number;\r\n\r\n        const data: number[] = [];\r\n        const revolutionAngleDelta = 2 * Math.PI / this.segmentsW;\r\n        let index = 0;\r\n\r\n        // 顶部\r\n        if (this.topClosed)\r\n        {\r\n            for (i = 0; i <= this.segmentsW; ++i)\r\n            {\r\n                revolutionAngle = i * revolutionAngleDelta;\r\n                x = 0.5 + 0.5 * -Math.cos(revolutionAngle);\r\n                y = 0.5 + 0.5 * Math.sin(revolutionAngle);\r\n\r\n                // 中心顶点\r\n                data[index++] = 0.5;\r\n                data[index++] = 0.5;\r\n                // 旋转顶点\r\n                data[index++] = x;\r\n                data[index++] = y;\r\n            }\r\n        }\r\n        // 底部\r\n        if (this.bottomClosed)\r\n        {\r\n            for (i = 0; i <= this.segmentsW; ++i)\r\n            {\r\n                revolutionAngle = i * revolutionAngleDelta;\r\n                x = 0.5 + 0.5 * Math.cos(revolutionAngle);\r\n                y = 0.5 + 0.5 * Math.sin(revolutionAngle);\r\n\r\n                // 中心顶点\r\n                data[index++] = 0.5;\r\n                data[index++] = 0.5;\r\n                // 旋转顶点\r\n                data[index++] = x;\r\n                data[index++] = y;\r\n            }\r\n        }\r\n        // 侧面\r\n        if (this.surfaceClosed)\r\n        {\r\n            for (j = 0; j <= this.segmentsH; ++j)\r\n            {\r\n                for (i = 0; i <= this.segmentsW; ++i)\r\n                {\r\n                    // 旋转顶点\r\n                    data[index++] = (i / this.segmentsW);\r\n                    data[index++] = (j / this.segmentsH);\r\n                }\r\n            }\r\n        }\r\n\r\n        return data;\r\n    }\r\n}\r\n\r\nGeometry.setDefault('Cylinder', new CylinderGeometry());\r\n\r\nGameObject.registerPrimitive('Cylinder', (g) =>\r\n{\r\n    g.addComponent(MeshRenderer).geometry = Geometry.getDefault('Cylinder');\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n    {\r\n        path: '3D Object/Cylinder',\r\n        priority: -4,\r\n        click: () =>\r\n            GameObject.createPrimitive('Cylinder')\r\n    }\r\n);\r\n\r\n","import { GameObject } from '../core/GameObject';\r\nimport { MeshRenderer } from '../core/MeshRenderer';\r\nimport { Geometry } from '../geometry/Geometry';\r\nimport { createNodeMenu } from '../menu/CreateNodeMenu';\r\nimport { CylinderGeometry } from './CylinderGeometry';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsGeometryTypes\r\n    {\r\n        ConeGeometry: ConeGeometry\r\n    }\r\n    export interface MixinsDefaultGeometry\r\n    {\r\n        Cone: ConeGeometry;\r\n    }\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        Cone: GameObject;\r\n    }\r\n}\r\n\r\n/**\r\n * 圆锥体\r\n */\r\nexport class ConeGeometry extends CylinderGeometry\r\n{\r\n    __class__: 'feng3d.ConeGeometry' = 'feng3d.ConeGeometry';\r\n\r\n    name = 'Cone';\r\n\r\n    /**\r\n     * 底部半径 private\r\n     */\r\n    topRadius = 0;\r\n\r\n    /**\r\n     * 顶部是否封口 private\r\n     */\r\n    topClosed = false;\r\n\r\n    /**\r\n     * 侧面是否封口 private\r\n     */\r\n    surfaceClosed = true;\r\n}\r\n\r\nGeometry.setDefault('Cone', new ConeGeometry());\r\n\r\nGameObject.registerPrimitive('Cone', (g) =>\r\n{\r\n    g.addComponent(MeshRenderer).geometry = Geometry.getDefault('Cone');\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n    {\r\n        path: '3D Object/Cone',\r\n        priority: -10000,\r\n        click: () =>\r\n            GameObject.createPrimitive('Cone')\r\n    }\r\n);\r\n\r\n","import { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { GameObject } from '../core/GameObject';\r\nimport { MeshRenderer } from '../core/MeshRenderer';\r\nimport { Geometry } from '../geometry/Geometry';\r\nimport { createNodeMenu } from '../menu/CreateNodeMenu';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsGeometryTypes { CubeGeometry: CubeGeometry }\r\n\r\n    export interface MixinsDefaultGeometry\r\n    {\r\n        Cube: CubeGeometry;\r\n    }\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        Cube: GameObject;\r\n    }\r\n}\r\n\r\n/**\r\n * 立（长）方体几何体\r\n */\r\nexport class CubeGeometry extends Geometry\r\n{\r\n    __class__: 'feng3d.CubeGeometry';\r\n\r\n    name = 'Cube';\r\n\r\n    /**\r\n     * 宽度\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    width = 1;\r\n\r\n    /**\r\n     * 高度\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    height = 1;\r\n\r\n    /**\r\n     * 深度\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    depth = 1;\r\n\r\n    /**\r\n     * 宽度方向分割数\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    segmentsW = 1;\r\n\r\n    /**\r\n     * 高度方向分割数\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    segmentsH = 1;\r\n\r\n    /**\r\n     * 深度方向分割数\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    segmentsD = 1;\r\n\r\n    /**\r\n     * 是否为6块贴图，默认true。\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    tile6 = false;\r\n\r\n    protected buildGeometry()\r\n    {\r\n        const vertexPositionData = this.buildPosition();\r\n        this.positions = vertexPositionData;\r\n        const vertexNormalData = this.buildNormal();\r\n        this.normals = vertexNormalData;\r\n        const vertexTangentData = this.buildTangent();\r\n        this.tangents = vertexTangentData;\r\n        const uvData = this.buildUVs();\r\n        this.uvs = uvData;\r\n        const indices = this.buildIndices();\r\n        this.indices = indices;\r\n    }\r\n\r\n    /**\r\n     * 构建坐标\r\n     * @param   width           宽度\r\n     * @param   height          高度\r\n     * @param   depth           深度\r\n     * @param   segmentsW       宽度方向分割\r\n     * @param   segmentsH       高度方向分割\r\n     * @param   segmentsD       深度方向分割\r\n     */\r\n    private buildPosition()\r\n    {\r\n        const vertexPositionData: number[] = [];\r\n\r\n        let i: number; let\r\n            j: number;\r\n\r\n        let outerPos: number;\r\n\r\n        // Indices\r\n        let positionIndex = 0;\r\n\r\n        // half cube dimensions\r\n        const hw = this.width / 2;\r\n        const hh = this.height / 2;\r\n        const hd = this.depth / 2;\r\n\r\n        // Segment dimensions\r\n        const dw = this.width / this.segmentsW;\r\n        const dh = this.height / this.segmentsH;\r\n        const dd = this.depth / this.segmentsD;\r\n\r\n        for (i = 0; i <= this.segmentsW; i++)\r\n        {\r\n            outerPos = -hw + i * dw;\r\n\r\n            for (j = 0; j <= this.segmentsH; j++)\r\n            {\r\n                // front\r\n                vertexPositionData[positionIndex++] = outerPos;\r\n                vertexPositionData[positionIndex++] = -hh + j * dh;\r\n                vertexPositionData[positionIndex++] = -hd;\r\n\r\n                // back\r\n                vertexPositionData[positionIndex++] = outerPos;\r\n                vertexPositionData[positionIndex++] = -hh + j * dh;\r\n                vertexPositionData[positionIndex++] = hd;\r\n            }\r\n        }\r\n\r\n        for (i = 0; i <= this.segmentsW; i++)\r\n        {\r\n            outerPos = -hw + i * dw;\r\n\r\n            for (j = 0; j <= this.segmentsD; j++)\r\n            {\r\n                // top\r\n                vertexPositionData[positionIndex++] = outerPos;\r\n                vertexPositionData[positionIndex++] = hh;\r\n                vertexPositionData[positionIndex++] = -hd + j * dd;\r\n\r\n                // bottom\r\n                vertexPositionData[positionIndex++] = outerPos;\r\n                vertexPositionData[positionIndex++] = -hh;\r\n                vertexPositionData[positionIndex++] = -hd + j * dd;\r\n            }\r\n        }\r\n\r\n        for (i = 0; i <= this.segmentsD; i++)\r\n        {\r\n            outerPos = hd - i * dd;\r\n\r\n            for (j = 0; j <= this.segmentsH; j++)\r\n            {\r\n                // left\r\n                vertexPositionData[positionIndex++] = -hw;\r\n                vertexPositionData[positionIndex++] = -hh + j * dh;\r\n                vertexPositionData[positionIndex++] = outerPos;\r\n\r\n                // right\r\n                vertexPositionData[positionIndex++] = hw;\r\n                vertexPositionData[positionIndex++] = -hh + j * dh;\r\n                vertexPositionData[positionIndex++] = outerPos;\r\n            }\r\n        }\r\n\r\n        return vertexPositionData;\r\n    }\r\n\r\n    /**\r\n     * 构建法线\r\n     * @param   segmentsW       宽度方向分割\r\n     * @param   segmentsH       高度方向分割\r\n     * @param   segmentsD       深度方向分割\r\n     */\r\n    private buildNormal()\r\n    {\r\n        const vertexNormalData: number[] = [];\r\n\r\n        let i: number; let\r\n            j: number;\r\n\r\n        // Indices\r\n        let normalIndex = 0;\r\n\r\n        for (i = 0; i <= this.segmentsW; i++)\r\n        {\r\n            for (j = 0; j <= this.segmentsH; j++)\r\n            {\r\n                // front\r\n                vertexNormalData[normalIndex++] = 0;\r\n                vertexNormalData[normalIndex++] = 0;\r\n                vertexNormalData[normalIndex++] = -1;\r\n\r\n                // back\r\n                vertexNormalData[normalIndex++] = 0;\r\n                vertexNormalData[normalIndex++] = 0;\r\n                vertexNormalData[normalIndex++] = 1;\r\n            }\r\n        }\r\n\r\n        for (i = 0; i <= this.segmentsW; i++)\r\n        {\r\n            for (j = 0; j <= this.segmentsD; j++)\r\n            {\r\n                // top\r\n                vertexNormalData[normalIndex++] = 0;\r\n                vertexNormalData[normalIndex++] = 1;\r\n                vertexNormalData[normalIndex++] = 0;\r\n\r\n                // bottom\r\n                vertexNormalData[normalIndex++] = 0;\r\n                vertexNormalData[normalIndex++] = -1;\r\n                vertexNormalData[normalIndex++] = 0;\r\n            }\r\n        }\r\n\r\n        for (i = 0; i <= this.segmentsD; i++)\r\n        {\r\n            for (j = 0; j <= this.segmentsH; j++)\r\n            {\r\n                // left\r\n                vertexNormalData[normalIndex++] = -1;\r\n                vertexNormalData[normalIndex++] = 0;\r\n                vertexNormalData[normalIndex++] = 0;\r\n\r\n                // right\r\n                vertexNormalData[normalIndex++] = 1;\r\n                vertexNormalData[normalIndex++] = 0;\r\n                vertexNormalData[normalIndex++] = 0;\r\n            }\r\n        }\r\n\r\n        return vertexNormalData;\r\n    }\r\n\r\n    /**\r\n     * 构建切线\r\n     * @param   segmentsW       宽度方向分割\r\n     * @param   segmentsH       高度方向分割\r\n     * @param   segmentsD       深度方向分割\r\n     */\r\n    private buildTangent()\r\n    {\r\n        const vertexTangentData: number[] = [];\r\n\r\n        let i: number; let\r\n            j: number;\r\n\r\n        // Indices\r\n        let tangentIndex = 0;\r\n\r\n        for (i = 0; i <= this.segmentsW; i++)\r\n        {\r\n            for (j = 0; j <= this.segmentsH; j++)\r\n            {\r\n                // front\r\n                vertexTangentData[tangentIndex++] = 1;\r\n                vertexTangentData[tangentIndex++] = 0;\r\n                vertexTangentData[tangentIndex++] = 0;\r\n\r\n                // back\r\n                vertexTangentData[tangentIndex++] = -1;\r\n                vertexTangentData[tangentIndex++] = 0;\r\n                vertexTangentData[tangentIndex++] = 0;\r\n            }\r\n        }\r\n\r\n        for (i = 0; i <= this.segmentsW; i++)\r\n        {\r\n            for (j = 0; j <= this.segmentsD; j++)\r\n            {\r\n                // top\r\n                vertexTangentData[tangentIndex++] = 1;\r\n                vertexTangentData[tangentIndex++] = 0;\r\n                vertexTangentData[tangentIndex++] = 0;\r\n\r\n                // bottom\r\n                vertexTangentData[tangentIndex++] = 1;\r\n                vertexTangentData[tangentIndex++] = 0;\r\n                vertexTangentData[tangentIndex++] = 0;\r\n            }\r\n        }\r\n\r\n        for (i = 0; i <= this.segmentsD; i++)\r\n        {\r\n            for (j = 0; j <= this.segmentsH; j++)\r\n            {\r\n                // left\r\n                vertexTangentData[tangentIndex++] = 0;\r\n                vertexTangentData[tangentIndex++] = 0;\r\n                vertexTangentData[tangentIndex++] = -1;\r\n\r\n                // right\r\n                vertexTangentData[tangentIndex++] = 0;\r\n                vertexTangentData[tangentIndex++] = 0;\r\n                vertexTangentData[tangentIndex++] = 1;\r\n            }\r\n        }\r\n\r\n        return vertexTangentData;\r\n    }\r\n\r\n    /**\r\n     * 构建索引\r\n     * @param   segmentsW       宽度方向分割\r\n     * @param   segmentsH       高度方向分割\r\n     * @param   segmentsD       深度方向分割\r\n     */\r\n    private buildIndices()\r\n    {\r\n        const indices: number[] = [];\r\n\r\n        let tl: number; let tr: number; let bl: number; let\r\n            br: number;\r\n        let i: number; let j: number; let\r\n            inc = 0;\r\n\r\n        let fidx = 0;\r\n\r\n        for (i = 0; i <= this.segmentsW; i++)\r\n        {\r\n            for (j = 0; j <= this.segmentsH; j++)\r\n            {\r\n                // front\r\n                // back\r\n                if (i && j)\r\n                {\r\n                    tl = 2 * ((i - 1) * (this.segmentsH + 1) + (j - 1));\r\n                    tr = 2 * (i * (this.segmentsH + 1) + (j - 1));\r\n                    bl = tl + 2;\r\n                    br = tr + 2;\r\n\r\n                    indices[fidx++] = tl;\r\n                    indices[fidx++] = bl;\r\n                    indices[fidx++] = br;\r\n                    indices[fidx++] = tl;\r\n                    indices[fidx++] = br;\r\n                    indices[fidx++] = tr;\r\n                    indices[fidx++] = tr + 1;\r\n                    indices[fidx++] = br + 1;\r\n                    indices[fidx++] = bl + 1;\r\n                    indices[fidx++] = tr + 1;\r\n                    indices[fidx++] = bl + 1;\r\n                    indices[fidx++] = tl + 1;\r\n                }\r\n            }\r\n        }\r\n\r\n        inc += 2 * (this.segmentsW + 1) * (this.segmentsH + 1);\r\n\r\n        for (i = 0; i <= this.segmentsW; i++)\r\n        {\r\n            for (j = 0; j <= this.segmentsD; j++)\r\n            {\r\n                // top\r\n                // bottom\r\n                if (i && j)\r\n                {\r\n                    tl = inc + 2 * ((i - 1) * (this.segmentsD + 1) + (j - 1));\r\n                    tr = inc + 2 * (i * (this.segmentsD + 1) + (j - 1));\r\n                    bl = tl + 2;\r\n                    br = tr + 2;\r\n\r\n                    indices[fidx++] = tl;\r\n                    indices[fidx++] = bl;\r\n                    indices[fidx++] = br;\r\n                    indices[fidx++] = tl;\r\n                    indices[fidx++] = br;\r\n                    indices[fidx++] = tr;\r\n                    indices[fidx++] = tr + 1;\r\n                    indices[fidx++] = br + 1;\r\n                    indices[fidx++] = bl + 1;\r\n                    indices[fidx++] = tr + 1;\r\n                    indices[fidx++] = bl + 1;\r\n                    indices[fidx++] = tl + 1;\r\n                }\r\n            }\r\n        }\r\n\r\n        inc += 2 * (this.segmentsW + 1) * (this.segmentsD + 1);\r\n\r\n        for (i = 0; i <= this.segmentsD; i++)\r\n        {\r\n            for (j = 0; j <= this.segmentsH; j++)\r\n            {\r\n                // left\r\n                // right\r\n\r\n                if (i && j)\r\n                {\r\n                    tl = inc + 2 * ((i - 1) * (this.segmentsH + 1) + (j - 1));\r\n                    tr = inc + 2 * (i * (this.segmentsH + 1) + (j - 1));\r\n                    bl = tl + 2;\r\n                    br = tr + 2;\r\n\r\n                    indices[fidx++] = tl;\r\n                    indices[fidx++] = bl;\r\n                    indices[fidx++] = br;\r\n                    indices[fidx++] = tl;\r\n                    indices[fidx++] = br;\r\n                    indices[fidx++] = tr;\r\n                    indices[fidx++] = tr + 1;\r\n                    indices[fidx++] = br + 1;\r\n                    indices[fidx++] = bl + 1;\r\n                    indices[fidx++] = tr + 1;\r\n                    indices[fidx++] = bl + 1;\r\n                    indices[fidx++] = tl + 1;\r\n                }\r\n            }\r\n        }\r\n\r\n        return indices;\r\n    }\r\n\r\n    /**\r\n     * 构建uv\r\n     * @param   segmentsW       宽度方向分割\r\n     * @param   segmentsH       高度方向分割\r\n     * @param   segmentsD       深度方向分割\r\n     * @param   tile6           是否为6块贴图\r\n     */\r\n    private buildUVs()\r\n    {\r\n        let i: number; let j: number; let\r\n            uidx: number;\r\n        const data: number[] = [];\r\n\r\n        let uTileDim: number; let\r\n            vTileDim: number;\r\n        let uTileStep: number; let\r\n            vTileStep: number;\r\n        let tl0u: number; let\r\n            tl0v: number;\r\n        let tl1u: number; let\r\n            tl1v: number;\r\n        let du: number; let\r\n            dv: number;\r\n\r\n        if (this.tile6)\r\n        {\r\n            uTileDim = uTileStep = 1 / 3;\r\n            vTileDim = vTileStep = 1 / 2;\r\n        }\r\n        else\r\n        {\r\n            uTileDim = vTileDim = 1;\r\n            uTileStep = vTileStep = 0;\r\n        }\r\n\r\n        // Create planes two and two, the same way that they were\r\n        // constructed in the this.buildGeometry() function. First calculate\r\n        // the top-left UV coordinate for both planes, and then loop\r\n        // over the points, calculating the UVs from these numbers.\r\n\r\n        // When this.tile6 is true, the layout is as follows:\r\n        //       .-----.-----.-----. (1,1)\r\n        //       | Bot |  T  | Bak |\r\n        //       |-----+-----+-----|\r\n        //       |  L  |  F  |  R  |\r\n        // (0,0)'-----'-----'-----'\r\n\r\n        uidx = 0;\r\n\r\n        // FRONT / BACK\r\n        tl0u = Number(uTileStep);\r\n        tl0v = Number(vTileStep);\r\n        tl1u = 2 * uTileStep;\r\n        tl1v = 0 * vTileStep;\r\n        du = uTileDim / this.segmentsW;\r\n        dv = vTileDim / this.segmentsH;\r\n        for (i = 0; i <= this.segmentsW; i++)\r\n        {\r\n            for (j = 0; j <= this.segmentsH; j++)\r\n            {\r\n                data[uidx++] = tl0u + i * du;\r\n                data[uidx++] = tl0v + (vTileDim - j * dv);\r\n                data[uidx++] = tl1u + (uTileDim - i * du);\r\n                data[uidx++] = tl1v + (vTileDim - j * dv);\r\n            }\r\n        }\r\n\r\n        // TOP / BOTTOM\r\n        tl0u = Number(uTileStep);\r\n        tl0v = 0 * vTileStep;\r\n        tl1u = 0 * uTileStep;\r\n        tl1v = 0 * vTileStep;\r\n        du = uTileDim / this.segmentsW;\r\n        dv = vTileDim / this.segmentsD;\r\n        for (i = 0; i <= this.segmentsW; i++)\r\n        {\r\n            for (j = 0; j <= this.segmentsD; j++)\r\n            {\r\n                data[uidx++] = tl0u + i * du;\r\n                data[uidx++] = tl0v + (vTileDim - j * dv);\r\n                data[uidx++] = tl1u + i * du;\r\n                data[uidx++] = tl1v + j * dv;\r\n            }\r\n        }\r\n\r\n        // LEFT / RIGHT\r\n        tl0u = 0 * uTileStep;\r\n        tl0v = Number(vTileStep);\r\n        tl1u = 2 * uTileStep;\r\n        tl1v = Number(vTileStep);\r\n        du = uTileDim / this.segmentsD;\r\n        dv = vTileDim / this.segmentsH;\r\n        for (i = 0; i <= this.segmentsD; i++)\r\n        {\r\n            for (j = 0; j <= this.segmentsH; j++)\r\n            {\r\n                data[uidx++] = tl0u + i * du;\r\n                data[uidx++] = tl0v + (vTileDim - j * dv);\r\n                data[uidx++] = tl1u + (uTileDim - i * du);\r\n                data[uidx++] = tl1v + (vTileDim - j * dv);\r\n            }\r\n        }\r\n\r\n        return data;\r\n    }\r\n}\r\n\r\nGeometry.setDefault('Cube', new CubeGeometry());\r\n\r\nGameObject.registerPrimitive('Cube', (g) =>\r\n{\r\n    g.addComponent(MeshRenderer).geometry = Geometry.getDefault('Cube');\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n    {\r\n        path: '3D Object/Cube',\r\n        priority: -1,\r\n        click: () =>\r\n            GameObject.createPrimitive('Cube')\r\n    }\r\n);\r\n\r\n","import { Vector3 } from '@feng3d/math';\r\nimport { Geometry } from '../geometry/Geometry';\r\nimport { geometryUtils } from '../geometry/GeometryUtils';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsGeometryTypes\r\n    {\r\n        ParametricGeometry: ParametricGeometry\r\n    }\r\n}\r\n\r\nexport class ParametricGeometry extends Geometry\r\n{\r\n    /**\r\n     * @author zz85 / https://github.com/zz85\r\n     * Parametric Surfaces Geometry\r\n     * based on the brilliant article by @prideout http://prideout.net/blog/?p=44\r\n     *\r\n     * new ParametricGeometry( parametricFunction, uSegments, ySegements );\r\n     *\r\n     */\r\n    constructor(func: (u: number, v: number) => Vector3, slices = 8, stacks = 8, doubleside = false)\r\n    {\r\n        super();\r\n\r\n        let positions: number[] = [];\r\n        const indices: number[] = [];\r\n        let uvs: number[] = [];\r\n\r\n        const sliceCount = slices + 1;\r\n\r\n        for (let i = 0; i <= stacks; i++)\r\n        {\r\n            const v = i / stacks;\r\n\r\n            for (let j = 0; j <= slices; j++)\r\n            {\r\n                const u = j / slices;\r\n                //\r\n                uvs.push(u, v);\r\n                //\r\n                const p = func(u, v);\r\n                positions.push(p.x, p.y, p.z);\r\n                //\r\n                if (i < stacks && j < slices)\r\n                {\r\n                    const a = i * sliceCount + j;\r\n                    const b = i * sliceCount + j + 1;\r\n                    const c = (i + 1) * sliceCount + j + 1;\r\n                    const d = (i + 1) * sliceCount + j;\r\n                    indices.push(a, b, d);\r\n                    indices.push(b, c, d);\r\n                }\r\n            }\r\n        }\r\n        // 反面\r\n        if (doubleside)\r\n        {\r\n            positions = positions.concat(positions);\r\n            uvs = uvs.concat(uvs);\r\n            const start = (stacks + 1) * (slices + 1);\r\n            for (let i = 0, n = indices.length; i < n; i += 3)\r\n            {\r\n                indices.push(start + indices[i], start + indices[i + 2], start + indices[i + 1]);\r\n            }\r\n        }\r\n        this.indices = indices;\r\n        this.positions = positions;\r\n        this.uvs = uvs;\r\n\r\n        this.invalidateGeometry();\r\n    }\r\n\r\n    /**\r\n     * 构建几何体\r\n     */\r\n    protected buildGeometry()\r\n    {\r\n        const positions = this.positions;\r\n        for (let i = 0, half = positions.length / 2; i < half; i++)\r\n        {\r\n            positions[i + half] = positions[i];\r\n        }\r\n        this.positions = positions;\r\n        this.normals = geometryUtils.createVertexNormals(this.indices, this.positions, true);\r\n        this.tangents = geometryUtils.createVertexTangents(this.indices, this.positions, this.uvs, true);\r\n    }\r\n}\r\n","import { GameObject } from '../core/GameObject';\r\nimport { MeshRenderer } from '../core/MeshRenderer';\r\nimport { Geometry } from '../geometry/Geometry';\r\nimport { geometryUtils } from '../geometry/GeometryUtils';\r\nimport { createNodeMenu } from '../menu/CreateNodeMenu';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsGeometryTypes\r\n    {\r\n        QuadGeometry: QuadGeometry\r\n    }\r\n\r\n    export interface MixinsDefaultGeometry\r\n    {\r\n        Quad: QuadGeometry;\r\n    }\r\n\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        Quad: GameObject;\r\n    }\r\n}\r\n\r\n/**\r\n * 四边形面皮几何体\r\n */\r\nexport class QuadGeometry extends Geometry\r\n{\r\n    __class__: 'feng3d.QuadGeometry';\r\n\r\n    constructor()\r\n    {\r\n        super();\r\n        const size = 0.5;\r\n\r\n        this.positions = [-size, size, 0, size, size, 0, size, -size, 0, -size, -size, 0];\r\n        this.uvs = [0, 0, 1, 0, 1, 1, 0, 1];\r\n        this.indices = [0, 1, 2, 0, 2, 3];\r\n\r\n        this.normals = geometryUtils.createVertexNormals(this.indices, this.positions, true);\r\n        this.tangents = geometryUtils.createVertexTangents(this.indices, this.positions, this.uvs, true);\r\n    }\r\n}\r\n\r\nGeometry.setDefault('Quad', new QuadGeometry());\r\n\r\nGameObject.registerPrimitive('Quad', (g) =>\r\n{\r\n    g.addComponent(MeshRenderer).geometry = Geometry.getDefault('Quad');\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n    {\r\n        path: '3D Object/Quad',\r\n        priority: -6,\r\n        click: () =>\r\n            GameObject.createPrimitive('Quad')\r\n    }\r\n);\r\n\r\n","import { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { GameObject } from '../core/GameObject';\r\nimport { MeshRenderer } from '../core/MeshRenderer';\r\nimport { Geometry } from '../geometry/Geometry';\r\nimport { createNodeMenu } from '../menu/CreateNodeMenu';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsGeometryTypes\r\n    {\r\n        SphereGeometry: SphereGeometry\r\n    }\r\n    export interface MixinsDefaultGeometry\r\n    {\r\n        Sphere: SphereGeometry;\r\n    }\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        Sphere: GameObject;\r\n    }\r\n}\r\n\r\n/**\r\n * 球体几何体\r\n * @author DawnKing 2016-09-12\r\n */\r\nexport class SphereGeometry extends Geometry\r\n{\r\n    __class__: 'feng3d.SphereGeometry';\r\n\r\n    /**\r\n     * 球体半径\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    radius = 0.5;\r\n\r\n    /**\r\n     * 横向分割数\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    segmentsW = 16;\r\n\r\n    /**\r\n     * 纵向分割数\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    segmentsH = 12;\r\n\r\n    /**\r\n     * 是否朝上\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    yUp = true;\r\n\r\n    name = 'Sphere';\r\n\r\n    /**\r\n     * 构建几何体数据\r\n     * @param this.radius 球体半径\r\n     * @param this.segmentsW 横向分割数\r\n     * @param this.segmentsH 纵向分割数\r\n     * @param this.yUp 正面朝向 true:Y+ false:Z+\r\n     */\r\n    protected buildGeometry()\r\n    {\r\n        const vertexPositionData: number[] = [];\r\n        const vertexNormalData: number[] = [];\r\n        const vertexTangentData: number[] = [];\r\n\r\n        let startIndex: number;\r\n        let index = 0;\r\n        let comp1: number; let comp2: number; let t1: number; let\r\n            t2: number;\r\n        for (let yi = 0; yi <= this.segmentsH; ++yi)\r\n        {\r\n            startIndex = index;\r\n\r\n            const horangle = Math.PI * yi / this.segmentsH;\r\n            const z = -this.radius * Math.cos(horangle);\r\n            const ringradius = this.radius * Math.sin(horangle);\r\n\r\n            for (let xi = 0; xi <= this.segmentsW; ++xi)\r\n            {\r\n                const verangle = 2 * Math.PI * xi / this.segmentsW;\r\n                const x = ringradius * Math.cos(verangle);\r\n                const y = ringradius * Math.sin(verangle);\r\n                const normLen = 1 / Math.sqrt(x * x + y * y + z * z);\r\n                const tanLen = Math.sqrt(y * y + x * x);\r\n\r\n                if (this.yUp)\r\n                {\r\n                    t1 = 0;\r\n                    t2 = tanLen > 0.007 ? x / tanLen : 0;\r\n                    comp1 = -z;\r\n                    comp2 = y;\r\n                }\r\n                else\r\n                {\r\n                    t1 = tanLen > 0.007 ? x / tanLen : 0;\r\n                    t2 = 0;\r\n                    comp1 = y;\r\n                    comp2 = z;\r\n                }\r\n\r\n                if (xi === this.segmentsW)\r\n                {\r\n                    vertexPositionData[index] = vertexPositionData[startIndex];\r\n                    vertexPositionData[index + 1] = vertexPositionData[startIndex + 1];\r\n                    vertexPositionData[index + 2] = vertexPositionData[startIndex + 2];\r\n\r\n                    vertexNormalData[index] = vertexNormalData[startIndex] + x * normLen * 0.5;\r\n                    vertexNormalData[index + 1] = vertexNormalData[startIndex + 1] + comp1 * normLen * 0.5;\r\n                    vertexNormalData[index + 2] = vertexNormalData[startIndex + 2] + comp2 * normLen * 0.5;\r\n\r\n                    vertexTangentData[index] = tanLen > 0.007 ? -y / tanLen : 1;\r\n                    vertexTangentData[index + 1] = t1;\r\n                    vertexTangentData[index + 2] = t2;\r\n                }\r\n                else\r\n                {\r\n                    vertexPositionData[index] = x;\r\n                    vertexPositionData[index + 1] = comp1;\r\n                    vertexPositionData[index + 2] = comp2;\r\n\r\n                    vertexNormalData[index] = x * normLen;\r\n                    vertexNormalData[index + 1] = comp1 * normLen;\r\n                    vertexNormalData[index + 2] = comp2 * normLen;\r\n\r\n                    vertexTangentData[index] = tanLen > 0.007 ? -y / tanLen : 1;\r\n                    vertexTangentData[index + 1] = t1;\r\n                    vertexTangentData[index + 2] = t2;\r\n                }\r\n\r\n                if (xi > 0 && yi > 0)\r\n                {\r\n                    if (yi === this.segmentsH)\r\n                    {\r\n                        vertexPositionData[index] = vertexPositionData[startIndex];\r\n                        vertexPositionData[index + 1] = vertexPositionData[startIndex + 1];\r\n                        vertexPositionData[index + 2] = vertexPositionData[startIndex + 2];\r\n                    }\r\n                }\r\n\r\n                index += 3;\r\n            }\r\n        }\r\n\r\n        this.positions = vertexPositionData;\r\n        this.normals = vertexNormalData;\r\n        this.tangents = vertexTangentData;\r\n\r\n        const uvData = this.buildUVs();\r\n        this.uvs = uvData;\r\n\r\n        const indices = this.buildIndices();\r\n        this.indices = indices;\r\n    }\r\n\r\n    /**\r\n     * 构建顶点索引\r\n     * @param this.segmentsW 横向分割数\r\n     * @param this.segmentsH 纵向分割数\r\n     * @param this.yUp 正面朝向 true:Y+ false:Z+\r\n     */\r\n    private buildIndices()\r\n    {\r\n        const indices: number[] = [];\r\n\r\n        let numIndices = 0;\r\n        for (let yi = 0; yi <= this.segmentsH; ++yi)\r\n        {\r\n            for (let xi = 0; xi <= this.segmentsW; ++xi)\r\n            {\r\n                if (xi > 0 && yi > 0)\r\n                {\r\n                    const a = (this.segmentsW + 1) * yi + xi;\r\n                    const b = (this.segmentsW + 1) * yi + xi - 1;\r\n                    const c = (this.segmentsW + 1) * (yi - 1) + xi - 1;\r\n                    const d = (this.segmentsW + 1) * (yi - 1) + xi;\r\n\r\n                    if (yi === this.segmentsH)\r\n                    {\r\n                        indices[numIndices++] = a;\r\n                        indices[numIndices++] = c;\r\n                        indices[numIndices++] = d;\r\n                    }\r\n                    else if (yi === 1)\r\n                    {\r\n                        indices[numIndices++] = a;\r\n                        indices[numIndices++] = b;\r\n                        indices[numIndices++] = c;\r\n                    }\r\n                    else\r\n                    {\r\n                        indices[numIndices++] = a;\r\n                        indices[numIndices++] = b;\r\n                        indices[numIndices++] = c;\r\n                        indices[numIndices++] = a;\r\n                        indices[numIndices++] = c;\r\n                        indices[numIndices++] = d;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return indices;\r\n    }\r\n\r\n    /**\r\n     * 构建uv\r\n     * @param this.segmentsW 横向分割数\r\n     * @param this.segmentsH 纵向分割数\r\n     */\r\n    private buildUVs()\r\n    {\r\n        const data: number[] = [];\r\n        let index = 0;\r\n\r\n        for (let yi = 0; yi <= this.segmentsH; ++yi)\r\n        {\r\n            for (let xi = 0; xi <= this.segmentsW; ++xi)\r\n            {\r\n                data[index++] = xi / this.segmentsW;\r\n                data[index++] = yi / this.segmentsH;\r\n            }\r\n        }\r\n\r\n        return data;\r\n    }\r\n}\r\n\r\nGeometry.setDefault('Sphere', new SphereGeometry());\r\n\r\nGameObject.registerPrimitive('Sphere', (g) =>\r\n{\r\n    g.addComponent(MeshRenderer).geometry = Geometry.getDefault('Sphere');\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n    {\r\n        path: '3D Object/Sphere',\r\n        priority: -2,\r\n        click: () =>\r\n            GameObject.createPrimitive('Sphere')\r\n    }\r\n);\r\n\r\n","import { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { GameObject } from '../core/GameObject';\r\nimport { MeshRenderer } from '../core/MeshRenderer';\r\nimport { Geometry } from '../geometry/Geometry';\r\nimport { createNodeMenu } from '../menu/CreateNodeMenu';\r\n\r\ndeclare global\r\n{\r\n\texport interface MixinsGeometryTypes\r\n\t{\r\n\t\tTorusGeometry: TorusGeometry\r\n\t}\r\n\texport interface MixinsDefaultGeometry\r\n\t{\r\n\t\tTorus: TorusGeometry;\r\n\t}\r\n\texport interface MixinsPrimitiveGameObject\r\n\t{\r\n\t\tTorus: GameObject;\r\n\t}\r\n}\r\n\r\n/**\r\n * 圆环几何体\r\n */\r\nexport class TorusGeometry extends Geometry\r\n{\r\n\t__class__: 'feng3d.TorusGeometry' = 'feng3d.TorusGeometry';\r\n\r\n\t/**\r\n\t * 半径\r\n\t */\r\n\t@serialize\r\n\t@oav()\r\n\t@watch('invalidateGeometry')\r\n\tradius = 0.5;\r\n\r\n\t/**\r\n\t * 管道半径\r\n\t */\r\n\t@serialize\r\n\t@oav()\r\n\t@watch('invalidateGeometry')\r\n\ttubeRadius = 0.1;\r\n\r\n\t/**\r\n\t * 半径方向分割数\r\n\t */\r\n\t@serialize\r\n\t@oav()\r\n\t@watch('invalidateGeometry')\r\n\tsegmentsR = 16;\r\n\r\n\t/**\r\n\t * 管道方向分割数\r\n\t */\r\n\t@serialize\r\n\t@oav()\r\n\t@watch('invalidateGeometry')\r\n\tsegmentsT = 8;\r\n\r\n\t/**\r\n\t * 是否朝上\r\n\t */\r\n\t@serialize\r\n\t@oav()\r\n\t@watch('invalidateGeometry')\r\n\tyUp = true;\r\n\r\n\tname = 'Torus';\r\n\r\n\t//\r\n\tprotected _vertexPositionData: number[];\r\n\tprotected _vertexNormalData: number[];\r\n\tprotected _vertexTangentData: number[];\r\n\tprivate _rawIndices: number[];\r\n\tprivate _vertexIndex: number;\r\n\tprivate _currentTriangleIndex: number;\r\n\tprivate _numVertices: number;\r\n\tprivate _vertexPositionStride = 3;\r\n\tprivate _vertexNormalStride = 3;\r\n\tprivate _vertexTangentStride = 3;\r\n\r\n\t/**\r\n\t * 添加顶点数据\r\n\t */\r\n\tprivate addVertex(vertexIndex: number, px: number, py: number, pz: number, nx: number, ny: number, nz: number, tx: number, ty: number, tz: number)\r\n\t{\r\n\t\tthis._vertexPositionData[vertexIndex * this._vertexPositionStride] = px;\r\n\t\tthis._vertexPositionData[vertexIndex * this._vertexPositionStride + 1] = py;\r\n\t\tthis._vertexPositionData[vertexIndex * this._vertexPositionStride + 2] = pz;\r\n\t\tthis._vertexNormalData[vertexIndex * this._vertexNormalStride] = nx;\r\n\t\tthis._vertexNormalData[vertexIndex * this._vertexNormalStride + 1] = ny;\r\n\t\tthis._vertexNormalData[vertexIndex * this._vertexNormalStride + 2] = nz;\r\n\t\tthis._vertexTangentData[vertexIndex * this._vertexTangentStride] = tx;\r\n\t\tthis._vertexTangentData[vertexIndex * this._vertexTangentStride + 1] = ty;\r\n\t\tthis._vertexTangentData[vertexIndex * this._vertexTangentStride + 2] = tz;\r\n\t}\r\n\r\n\t/**\r\n\t * 添加三角形索引数据\r\n\t * @param currentTriangleIndex\t\t当前三角形索引\r\n\t * @param cwVertexIndex0\t\t\t索引0\r\n\t * @param cwVertexIndex1\t\t\t索引1\r\n\t * @param cwVertexIndex2\t\t\t索引2\r\n\t */\r\n\tprivate addTriangleClockWise(currentTriangleIndex: number, cwVertexIndex0: number, cwVertexIndex1: number, cwVertexIndex2: number)\r\n\t{\r\n\t\tthis._rawIndices[currentTriangleIndex * 3] = cwVertexIndex0;\r\n\t\tthis._rawIndices[currentTriangleIndex * 3 + 1] = cwVertexIndex1;\r\n\t\tthis._rawIndices[currentTriangleIndex * 3 + 2] = cwVertexIndex2;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tprotected buildGeometry()\r\n\t{\r\n\t\tlet i: number; let\r\n\t\t\tj: number;\r\n\t\tlet x: number; let y: number; let z: number; let nx: number; let ny: number; let nz: number; let revolutionAngleR: number; let\r\n\t\t\trevolutionAngleT: number;\r\n\t\t// reset utility variables\r\n\t\tthis._numVertices = 0;\r\n\t\tthis._vertexIndex = 0;\r\n\t\tthis._currentTriangleIndex = 0;\r\n\r\n\t\t// evaluate target number of vertices, triangles and indices\r\n\t\tthis._numVertices = (this.segmentsT + 1) * (this.segmentsR + 1); // this.segmentsT + 1 because of closure, this.segmentsR + 1 because of closure\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tconst numTriangles = this.segmentsT * this.segmentsR * 2; // each level has segmentsR quads, each of 2 triangles\r\n\r\n\t\tthis._vertexPositionData = [];\r\n\t\tthis._vertexNormalData = [];\r\n\t\tthis._vertexTangentData = [];\r\n\t\tthis._rawIndices = [];\r\n\t\tthis.buildUVs();\r\n\r\n\t\t// evaluate revolution steps\r\n\t\tconst revolutionAngleDeltaR = 2 * Math.PI / this.segmentsR;\r\n\t\tconst revolutionAngleDeltaT = 2 * Math.PI / this.segmentsT;\r\n\r\n\t\tlet comp1: number; let\r\n\t\t\tcomp2: number;\r\n\t\tlet t1: number; let t2: number; let n1: number; let\r\n\t\t\tn2: number;\r\n\r\n\t\tlet startPositionIndex: number;\r\n\r\n\t\t// surface\r\n\t\tlet a: number; let b: number; let c: number; let d: number; let\r\n\t\t\tlength: number;\r\n\r\n\t\tfor (j = 0; j <= this.segmentsT; ++j)\r\n\t\t{\r\n\t\t\tstartPositionIndex = j * (this.segmentsR + 1) * this._vertexPositionStride;\r\n\r\n\t\t\tfor (i = 0; i <= this.segmentsR; ++i)\r\n\t\t\t{\r\n\t\t\t\tthis._vertexIndex = j * (this.segmentsR + 1) + i;\r\n\r\n\t\t\t\t// revolution vertex\r\n\t\t\t\trevolutionAngleR = i * revolutionAngleDeltaR;\r\n\t\t\t\trevolutionAngleT = j * revolutionAngleDeltaT;\r\n\r\n\t\t\t\tlength = Math.cos(revolutionAngleT);\r\n\t\t\t\tnx = length * Math.cos(revolutionAngleR);\r\n\t\t\t\tny = length * Math.sin(revolutionAngleR);\r\n\t\t\t\tnz = Math.sin(revolutionAngleT);\r\n\r\n\t\t\t\tx = this.radius * Math.cos(revolutionAngleR) + this.tubeRadius * nx;\r\n\t\t\t\ty = this.radius * Math.sin(revolutionAngleR) + this.tubeRadius * ny;\r\n\t\t\t\tz = (j === this.segmentsT) ? 0 : this.tubeRadius * nz;\r\n\r\n\t\t\t\tif (this.yUp)\r\n\t\t\t\t{\r\n\t\t\t\t\tn1 = -nz;\r\n\t\t\t\t\tn2 = ny;\r\n\t\t\t\t\tt1 = 0;\r\n\t\t\t\t\tt2 = (length ? nx / length : x / this.radius);\r\n\t\t\t\t\tcomp1 = -z;\r\n\t\t\t\t\tcomp2 = y;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tn1 = ny;\r\n\t\t\t\t\tn2 = nz;\r\n\t\t\t\t\tt1 = (length ? nx / length : x / this.radius);\r\n\t\t\t\t\tt2 = 0;\r\n\t\t\t\t\tcomp1 = y;\r\n\t\t\t\t\tcomp2 = z;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (i === this.segmentsR)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.addVertex(this._vertexIndex, x, this._vertexPositionData[startPositionIndex + 1], this._vertexPositionData[startPositionIndex + 2], nx, n1, n2, -(length ? ny / length : y / this.radius), t1, t2);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.addVertex(this._vertexIndex, x, comp1, comp2, nx, n1, n2, -(length ? ny / length : y / this.radius), t1, t2);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// close triangle\r\n\t\t\t\tif (i > 0 && j > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\ta = this._vertexIndex; // current\r\n\t\t\t\t\tb = this._vertexIndex - 1; // previous\r\n\t\t\t\t\tc = b - this.segmentsR - 1; // previous of last level\r\n\t\t\t\t\td = a - this.segmentsR - 1; // current of last level\r\n\t\t\t\t\tthis.addTriangleClockWise(this._currentTriangleIndex++, a, b, c);\r\n\t\t\t\t\tthis.addTriangleClockWise(this._currentTriangleIndex++, a, c, d);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.positions = this._vertexPositionData;\r\n\t\tthis.normals = this._vertexNormalData;\r\n\t\tthis.tangents = this._vertexTangentData;\r\n\r\n\t\tthis.indices = this._rawIndices;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tprotected buildUVs()\r\n\t{\r\n\t\tlet i: number; let\r\n\t\t\tj: number;\r\n\t\tconst stride = 2;\r\n\t\tconst data: number[] = [];\r\n\r\n\t\tlet index = 0;\r\n\t\t// surface\r\n\t\tfor (j = 0; j <= this.segmentsT; ++j)\r\n\t\t{\r\n\t\t\tfor (i = 0; i <= this.segmentsR; ++i)\r\n\t\t\t{\r\n\t\t\t\tindex = j * (this.segmentsR + 1) + i;\r\n\t\t\t\t// revolution vertex\r\n\t\t\t\tdata[index * stride] = i / this.segmentsR;\r\n\t\t\t\tdata[index * stride + 1] = j / this.segmentsT;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// build real data from raw data\r\n\t\tthis.uvs = data;\r\n\t}\r\n}\r\n\r\nGeometry.setDefault('Torus', new TorusGeometry());\r\n\r\nGameObject.registerPrimitive('Torus', (g) =>\r\n{\r\n\tg.addComponent(MeshRenderer).geometry = Geometry.getDefault('Torus');\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n\t{\r\n\t\tpath: '3D Object/Torus',\r\n\t\tpriority: -10000,\r\n\t\tclick: () =>\r\n\t\t\tGameObject.createPrimitive('Torus')\r\n\t}\r\n);\r\n\r\n","import { EventEmitter } from '@feng3d/event';\r\nimport { Rectangle } from '@feng3d/math';\r\nimport { GL, RenderAtomic } from '@feng3d/renderer';\r\nimport { windowEventProxy } from '@feng3d/shortcut';\r\nimport { GameObject } from '../../core/GameObject';\r\nimport { Renderable } from '../../core/Renderable';\r\n\r\n/**\r\n * 鼠标拾取渲染器\r\n */\r\nexport class MouseRenderer extends EventEmitter\r\n{\r\n    private objects: GameObject[] = [];\r\n\r\n    /**\r\n     * 渲染\r\n     */\r\n    draw(gl: GL, viewRect: Rectangle)\r\n    {\r\n        const mouseX = windowEventProxy.clientX;\r\n        const mouseY = windowEventProxy.clientY;\r\n\r\n        const offsetX = -(mouseX - viewRect.x);\r\n        const offsetY = -(viewRect.height - (mouseY - viewRect.y));// y轴与window中坐标反向，所以需要 h = (maxHeight - h)\r\n\r\n        gl.clearColor(0, 0, 0, 0);\r\n        gl.clearDepth(1);\r\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n        gl.viewport(offsetX, offsetY, viewRect.width, viewRect.height);\r\n\r\n        this.objects.length = 1;\r\n\r\n        // 启动裁剪，只绘制一个像素\r\n        gl.enable(gl.SCISSOR_TEST);\r\n        gl.scissor(0, 0, 1, 1);\r\n        // super.draw(renderContext);\r\n        gl.disable(gl.SCISSOR_TEST);\r\n\r\n        // 读取鼠标拾取索引\r\n        // this.frameBufferObject.readBuffer(gl, \"objectID\");\r\n\r\n        const data = new Uint8Array(4);\r\n        gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, data);\r\n        const id = data[0] + data[1] * 255 + data[2] * 255 * 255 + data[3] * 255 * 255 * 255 - data[3];// 最后（- data[3]）表示很奇怪，不过data[3]一般情况下为0\r\n        // log(`选中索引3D对象${id}`, data.toString());\r\n\r\n        return this.objects[id];\r\n    }\r\n\r\n    protected drawRenderables(_gl: GL, renderable: Renderable)\r\n    {\r\n        if (renderable.gameObject.mouseEnabled)\r\n        {\r\n            const object = renderable.gameObject;\r\n            const uObjectID = this.objects.length;\r\n            this.objects[uObjectID] = object;\r\n\r\n            const renderAtomic = renderable.renderAtomic;\r\n\r\n            renderAtomic.uniforms.u_objectID = uObjectID;\r\n            // super.drawRenderables(renderContext, model);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 绘制3D对象\r\n     */\r\n    protected drawGameObject(_gl: GL, _renderAtomic: RenderAtomic)\r\n    {\r\n        // var shader = new Shader();\r\n        // shader.vertexCode = shaderlib.getShader(\"mouse\").vertex;\r\n        // shader.fragmentCode = shaderlib.getShader(\"mouse\").fragment;\r\n        // super.drawGameObject(gl, renderAtomic, shader);\r\n    }\r\n}\r\n\r\nexport const mouseRenderer = new MouseRenderer();\r\n","import { globalEmitter } from '@feng3d/event';\r\nimport { shaderlib } from '@feng3d/renderer';\r\n\r\nglobalEmitter.on('asset.shaderChanged', () =>\r\n{\r\n    shaderlib.clearCache();\r\n});\r\n","import { Camera } from '../cameras/Camera';\r\nimport { Renderable } from '../core/Renderable';\r\nimport { Scene } from './Scene';\r\n\r\n/**\r\n * 用于处理从场景中获取特定数据\r\n */\r\nexport class SceneUtil\r\n{\r\n    /**\r\n     * 获取场景中可视需要混合的渲染对象\r\n     *\r\n     * @param _scene 场景\r\n     * @param _camera 摄像机\r\n     */\r\n    getBlenditems(_scene: Scene, _camera: Camera)\r\n    {\r\n        // throw new Error(\"Method not implemented.\");\r\n\r\n        // scene.getComponentsInChildren()\r\n\r\n    }\r\n\r\n    /**\r\n     * 获取需要渲染的对象\r\n     *\r\n     * #### 渲染需求条件\r\n     * 1. visible == true\r\n     * 1. 在摄像机视锥内\r\n     * 1. model.enabled == true\r\n     *\r\n     * @param gameObject\r\n     * @param camera\r\n     */\r\n    getActiveRenderers(scene: Scene, camera: Camera)\r\n    {\r\n        const renderers: Renderable[] = [];\r\n        const frustum = camera.frustum;\r\n\r\n        let gameObjects = [scene.gameObject];\r\n        while (gameObjects.length > 0)\r\n        {\r\n            const gameObject = gameObjects.pop();\r\n\r\n            if (!gameObject.activeSelf)\r\n            { continue; }\r\n            const renderer = gameObject.getComponent(Renderable);\r\n            if (renderer && renderer.enabled)\r\n            {\r\n                if (renderer.selfWorldBounds)\r\n                {\r\n                    if (frustum.intersectsBox(renderer.selfWorldBounds))\r\n                    { renderers.push(renderer); }\r\n                }\r\n            }\r\n            gameObjects = gameObjects.concat(gameObject.children);\r\n        }\r\n\r\n        return renderers;\r\n    }\r\n}\r\n\r\nexport const sceneUtil = new SceneUtil();\r\n","/* eslint-disable camelcase */\r\nimport mouseFragment from './shaders/mouse.fragment.glsl';\r\nimport mouseVertex from './shaders/mouse.vertex.glsl';\r\nimport outlineFragment from './shaders/outline.fragment.glsl';\r\nimport outlineVertex from './shaders/outline.vertex.glsl';\r\nimport Particles_AdditiveFragment from './shaders/Particles_Additive.fragment.glsl';\r\nimport Particles_AdditiveVertex from './shaders/Particles_Additive.vertex.glsl';\r\nimport Particles_AlphaBlendedPremultiplyFragment from './shaders/Particles_AlphaBlendedPremultiply.fragment.glsl';\r\nimport Particles_AlphaBlendedPremultiplyVertex from './shaders/Particles_AlphaBlendedPremultiply.vertex.glsl';\r\nimport shadowFragment from './shaders/shadow.fragment.glsl';\r\nimport shadowVertex from './shaders/shadow.vertex.glsl';\r\nimport skyboxFragment from './shaders/skybox.fragment.glsl';\r\nimport skyboxVertex from './shaders/skybox.vertex.glsl';\r\nimport terrainFragment from './shaders/terrain.fragment.glsl';\r\nimport terrainVertex from './shaders/terrain.vertex.glsl';\r\nimport wireframeFragment from './shaders/wireframe.fragment.glsl';\r\nimport wireframeVertex from './shaders/wireframe.vertex.glsl';\r\n//\r\nimport alphatest_frag from './shaders/modules/alphatest_frag.glsl';\r\nimport alphatest_pars_frag from './shaders/modules/alphatest_pars_frag.glsl';\r\nimport ambient_frag from './shaders/modules/ambient_frag.glsl';\r\nimport ambient_pars_frag from './shaders/modules/ambient_pars_frag.glsl';\r\nimport cartoon_pars_frag from './shaders/modules/cartoon_pars_frag.glsl';\r\nimport color_frag from './shaders/modules/color_frag.glsl';\r\nimport color_pars_frag from './shaders/modules/color_pars_frag.glsl';\r\nimport color_pars_vert from './shaders/modules/color_pars_vert.glsl';\r\nimport color_vert from './shaders/modules/color_vert.glsl';\r\nimport diffuse_frag from './shaders/modules/diffuse_frag.glsl';\r\nimport diffuse_pars_frag from './shaders/modules/diffuse_pars_frag.glsl';\r\nimport envmap_frag from './shaders/modules/envmap_frag.glsl';\r\nimport envmap_pars_frag from './shaders/modules/envmap_pars_frag.glsl';\r\nimport fog_frag from './shaders/modules/fog_frag.glsl';\r\nimport fog_pars_frag from './shaders/modules/fog_pars_frag.glsl';\r\nimport lights_frag from './shaders/modules/lights_frag.glsl';\r\nimport lights_pars_frag from './shaders/modules/lights_pars_frag.glsl';\r\nimport lights_pars_vert from './shaders/modules/lights_pars_vert.glsl';\r\nimport lights_vert from './shaders/modules/lights_vert.glsl';\r\nimport normalmap_pars_vert from './shaders/modules/normalmap_pars_vert.glsl';\r\nimport normalmap_vert from './shaders/modules/normalmap_vert.glsl';\r\nimport normal_frag from './shaders/modules/normal_frag.glsl';\r\nimport normal_pars_frag from './shaders/modules/normal_pars_frag.glsl';\r\nimport normal_pars_vert from './shaders/modules/normal_pars_vert.glsl';\r\nimport normal_vert from './shaders/modules/normal_vert.glsl';\r\nimport particle_frag from './shaders/modules/particle_frag.glsl';\r\nimport particle_pars_frag from './shaders/modules/particle_pars_frag.glsl';\r\nimport particle_pars_vert from './shaders/modules/particle_pars_vert.glsl';\r\nimport particle_vert from './shaders/modules/particle_vert.glsl';\r\nimport pointsize_pars_vert from './shaders/modules/pointsize_pars_vert.glsl';\r\nimport pointsize_vert from './shaders/modules/pointsize_vert.glsl';\r\nimport position_pars_vert from './shaders/modules/position_pars_vert.glsl';\r\nimport position_vert from './shaders/modules/position_vert.glsl';\r\nimport project_pars_vert from './shaders/modules/project_pars_vert.glsl';\r\nimport project_vert from './shaders/modules/project_vert.glsl';\r\nimport shadowmap_pars_frag from './shaders/modules/shadowmap_pars_frag.glsl';\r\nimport skeleton_pars_vert from './shaders/modules/skeleton_pars_vert.glsl';\r\nimport skeleton_vert from './shaders/modules/skeleton_vert.glsl';\r\nimport specular_frag from './shaders/modules/specular_frag.glsl';\r\nimport specular_pars_frag from './shaders/modules/specular_pars_frag.glsl';\r\nimport tangent_pars_vert from './shaders/modules/tangent_pars_vert.glsl';\r\nimport tangent_vert from './shaders/modules/tangent_vert.glsl';\r\nimport terrainDefault_pars_frag from './shaders/modules/terrainDefault_pars_frag.glsl';\r\nimport terrainMerge_pars_frag from './shaders/modules/terrainMerge_pars_frag.glsl';\r\nimport terrain_frag from './shaders/modules/terrain_frag.glsl';\r\nimport terrain_pars_frag from './shaders/modules/terrain_pars_frag.glsl';\r\nimport uv_pars_vert from './shaders/modules/uv_pars_vert.glsl';\r\nimport uv_vert from './shaders/modules/uv_vert.glsl';\r\nimport worldposition_pars_vert from './shaders/modules/worldposition_pars_vert.glsl';\r\nimport worldposition_vert from './shaders/modules/worldposition_vert.glsl';\r\n\r\nimport { shaderlib } from '@feng3d/renderer';\r\nimport { serialization } from '@feng3d/serialization';\r\n\r\nexport { };\r\n\r\nserialization.setValue(shaderlib.shaderConfig, {\r\n    shaders: {\r\n        mouse: { fragment: mouseFragment, vertex: mouseVertex },\r\n        outline: { fragment: outlineFragment, vertex: outlineVertex },\r\n        Particles_Additive: { fragment: Particles_AdditiveFragment, vertex: Particles_AdditiveVertex },\r\n        Particles_AlphaBlendedPremultiply: { fragment: Particles_AlphaBlendedPremultiplyFragment, vertex: Particles_AlphaBlendedPremultiplyVertex },\r\n        shadow: { fragment: shadowFragment, vertex: shadowVertex },\r\n        skybox: { fragment: skyboxFragment, vertex: skyboxVertex },\r\n        terrain: { fragment: terrainFragment, vertex: terrainVertex },\r\n        wireframe: { fragment: wireframeFragment, vertex: wireframeVertex },\r\n    },\r\n    modules: {\r\n        alphatest_frag,\r\n        alphatest_pars_frag,\r\n        ambient_frag,\r\n        ambient_pars_frag,\r\n        cartoon_pars_frag,\r\n        color_frag,\r\n        color_pars_frag,\r\n        color_pars_vert,\r\n        color_vert,\r\n        diffuse_frag,\r\n        diffuse_pars_frag,\r\n        envmap_frag,\r\n        envmap_pars_frag,\r\n        fog_frag,\r\n        fog_pars_frag,\r\n        lights_frag,\r\n        lights_pars_frag,\r\n        lights_pars_vert,\r\n        lights_vert,\r\n        normalmap_pars_vert,\r\n        normalmap_vert,\r\n        normal_frag,\r\n        normal_pars_frag,\r\n        normal_pars_vert,\r\n        normal_vert,\r\n        particle_frag,\r\n        particle_pars_frag,\r\n        particle_pars_vert,\r\n        particle_vert,\r\n        pointsize_pars_vert,\r\n        pointsize_vert,\r\n        position_pars_vert,\r\n        position_vert,\r\n        project_pars_vert,\r\n        project_vert,\r\n        shadowmap_pars_frag,\r\n        skeleton_pars_vert,\r\n        skeleton_vert,\r\n        specular_frag,\r\n        specular_pars_frag,\r\n        tangent_pars_vert,\r\n        tangent_vert,\r\n        terrainDefault_pars_frag,\r\n        terrainMerge_pars_frag,\r\n        terrain_frag,\r\n        terrain_pars_frag,\r\n        uv_pars_vert,\r\n        uv_vert,\r\n        worldposition_pars_vert,\r\n        worldposition_vert,\r\n    }\r\n});\r\n","import { watch } from '@feng3d/watcher';\r\nimport { Texture2D } from './Texture2D';\r\n\r\nexport class CanvasTexture2D extends Texture2D\r\n{\r\n    @watch('_canvasChanged')\r\n    canvas: HTMLCanvasElement;\r\n\r\n    private _canvasChanged()\r\n    {\r\n        this._pixels = this.canvas;\r\n        this.invalidate();\r\n    }\r\n}\r\n","import { watch } from '@feng3d/watcher';\r\nimport { Texture2D } from './Texture2D';\r\n\r\nexport class ImageDataTexture2D extends Texture2D\r\n{\r\n    @watch('_imageDataChanged')\r\n    imageData: ImageData;\r\n\r\n    private _imageDataChanged()\r\n    {\r\n        this._pixels = this.imageData;\r\n        this.invalidate();\r\n    }\r\n}\r\n","import { watch } from '@feng3d/watcher';\r\nimport { Texture2D } from './Texture2D';\r\n\r\n/**\r\n * 2D纹理\r\n */\r\nexport class ImageTexture2D extends Texture2D\r\n{\r\n    // __class__: \"feng3d.ImageTexture2D\" = \"feng3d.ImageTexture2D\";\r\n\r\n    @watch('_imageChanged')\r\n    imageSource: HTMLImageElement;\r\n\r\n    private _imageChanged()\r\n    {\r\n        this._pixels = this.imageSource;\r\n        this.invalidate();\r\n    }\r\n}\r\n","import { watch } from '@feng3d/watcher';\r\nimport { Texture2D } from './Texture2D';\r\n\r\nexport class VideoTexture2D extends Texture2D\r\n{\r\n    @watch('_videoChanged')\r\n    video: HTMLVideoElement;\r\n\r\n    private _videoChanged()\r\n    {\r\n        this._pixels = this.video;\r\n        this.invalidate();\r\n    }\r\n}\r\n","import { ObjectUtils, mathUtil } from '@feng3d/polyfill';\r\n\r\n/**\r\n * 通用唯一标识符（Universally Unique Identifier）\r\n *\r\n * 用于给所有对象分配一个通用唯一标识符\r\n */\r\nexport class Uuid\r\n{\r\n    /**\r\n     * 获取数组 通用唯一标识符\r\n     *\r\n     * @param arr 数组\r\n     * @param separator 分割符\r\n     */\r\n    getArrayUuid(arr: any[], separator = '$__uuid__$')\r\n    {\r\n        const uuids = arr.map((v) => this.getObjectUuid(v));\r\n        const groupUuid = uuids.join(separator);\r\n\r\n        return groupUuid;\r\n    }\r\n\r\n    /**\r\n     * 获取对象 通用唯一标识符\r\n     *\r\n     * 当参数object非Object对象时强制转换为字符串返回\r\n     *\r\n     * @param object 对象\r\n     */\r\n    getObjectUuid(object: Object)\r\n    {\r\n        if (ObjectUtils.isBaseType(object))\r\n        {\r\n            return String(object);\r\n        }\r\n        if (!object[__uuid__])\r\n        {\r\n            Object.defineProperty(object, __uuid__, { value: mathUtil.uuid() });\r\n        }\r\n\r\n        return object[__uuid__];\r\n    }\r\n    objectUuid = new WeakMap<Object, string>();\r\n}\r\n\r\nexport const __uuid__ = '__uuid__';\r\nexport const uuid = new Uuid();\r\n","import { anyEmitter } from '@feng3d/event';\r\nimport { ArrayUtils, FunctionPropertyNames } from '@feng3d/polyfill';\r\nimport { uuid } from './Uuid';\r\n\r\ntype Wraps<T, K extends keyof T> = {\r\n    [P in K]: { space: T, funcName: K, oldPropertyDescriptor: PropertyDescriptor, original: Function, funcs: Function[] };\r\n};\r\n\r\n/**\r\n * 函数经\r\n *\r\n * 包装函数，以及对应的拆包\r\n */\r\nexport class FunctionWrap\r\n{\r\n    /**\r\n     * 扩展继承函数\r\n     *\r\n     * 可用于扩展原型中原有API中的实现\r\n     *\r\n     * ```\r\n    class A\r\n    {\r\n        a = \"a\";\r\n\r\n        f(p: string = \"p\", p1: string = \"\")\r\n        {\r\n            return p + p1;\r\n        }\r\n\r\n        extendF: (p?: string, p1?: string) => string;\r\n        oldf: (p?: string, p1?: string) => string;\r\n    }\r\n\r\n    var a = new A();\r\n    a.oldf = a.f;\r\n    a.extendF = function (p: string = \"p\", p1: string = \"\")\r\n    {\r\n        return [\"polyfill\", this.a, this.oldf()].join(\"-\")\r\n    }\r\n    feng3d.functionwrap.extendFunction(a, \"f\", function (r)\r\n    {\r\n        return [\"polyfill\", this.a, r].join(\"-\");\r\n    });\r\n    // 验证 被扩展的a.f方法是否等价于 a.extendF\r\n    assert.ok(a.f() == a.extendF()); //true\r\n\r\n     * ```\r\n     *\r\n     * @param object 被扩展函数所属对象或者原型\r\n     * @param funcName 被扩展函数名称\r\n     * @param extendFunc 在函数执行后执行的扩展函数\r\n     */\r\n    extendFunction<T, K extends FunctionPropertyNames<T>, V extends (T[K] & ((...args: any) => any))>(object: T, funcName: K, extendFunc: (this: T, r: ReturnType<V>, ...ps: Parameters<V>) => ReturnType<V>)\r\n    {\r\n        const oldFun = object[funcName];\r\n        object[funcName] = <any>(function (...args: Parameters<V>)\r\n        {\r\n            let r = (<any>oldFun).apply(this, args);\r\n            const args1 = args.concat();\r\n            args1.unshift(r);\r\n            r = extendFunc.apply(this, args1);\r\n\r\n            return r;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 包装函数\r\n     *\r\n     * 一般用于调试\r\n     * 使用场景示例：\r\n     * 1. 在函数执行前后记录时间来计算函数执行时间。\r\n     * 1. 在console.error调用前使用 debugger 进行断点调试。\r\n     *\r\n     * @param object 函数所属对象或者原型\r\n     * @param funcName 函数名称\r\n     * @param beforeFunc 在函数执行前执行的函数\r\n     * @param afterFunc 在函数执行后执行的函数\r\n     */\r\n    wrap<T, K extends FunctionPropertyNames<T>, F extends T[K] & Function>(object: T, funcName: K, beforeFunc?: F, afterFunc?: F)\r\n    {\r\n        if (!beforeFunc && !afterFunc) return;\r\n\r\n        if (!Object.getOwnPropertyDescriptor(object, __functionwrap__))\r\n        {\r\n            Object.defineProperty(object, __functionwrap__, { value: {}, configurable: true, enumerable: false, writable: false });\r\n        }\r\n\r\n        const functionwraps: Wraps<T, K> = object[__functionwrap__];\r\n        let info = functionwraps[funcName];\r\n        if (!info)\r\n        {\r\n            const oldPropertyDescriptor = Object.getOwnPropertyDescriptor(object, funcName);\r\n            const original = <any>object[funcName];\r\n            functionwraps[funcName] = info = { space: object, funcName, oldPropertyDescriptor, original, funcs: [original] };\r\n            //\r\n            object[funcName] = <any> function ()\r\n            {\r\n                // eslint-disable-next-line prefer-rest-params\r\n                const args = arguments;\r\n                info.funcs.forEach((f) =>\r\n                {\r\n                    f.apply(this, args);\r\n                });\r\n            };\r\n        }\r\n        const funcs = info.funcs;\r\n        if (beforeFunc)\r\n        {\r\n            ArrayUtils.deleteItem(funcs, beforeFunc);\r\n            funcs.unshift(beforeFunc);\r\n        }\r\n        if (afterFunc)\r\n        {\r\n            ArrayUtils.deleteItem(funcs, afterFunc);\r\n            funcs.push(afterFunc);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 取消包装函数\r\n     *\r\n     * 与wrap函数对应\r\n     *\r\n     * @param object 函数所属对象或者原型\r\n     * @param funcName 函数名称\r\n     * @param wrapFunc 在函数执行前执行的函数\r\n     * @param before 运行在原函数之前\r\n     */\r\n    unwrap<T, K extends FunctionPropertyNames<T>, V extends T[K] & Function>(object: T, funcName: K, wrapFunc?: V)\r\n    {\r\n        const functionwraps: Wraps<T, K> = object[__functionwrap__];\r\n        const info = functionwraps[funcName];\r\n        if (!info) return;\r\n        if (wrapFunc === undefined)\r\n        {\r\n            info.funcs = [info.original];\r\n        }\r\n        else\r\n        {\r\n            ArrayUtils.deleteItem(info.funcs, wrapFunc);\r\n        }\r\n        if (info.funcs.length === 1)\r\n        {\r\n            delete object[funcName];\r\n            if (info.oldPropertyDescriptor)\r\n            { Object.defineProperty(object, funcName, info.oldPropertyDescriptor); }\r\n            delete functionwraps[funcName];\r\n\r\n            if (Object.keys(functionwraps).length === 0)\r\n            {\r\n                delete object[__functionwrap__];\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 包装一个异步函数，使其避免重复执行\r\n     *\r\n     * 使用场景示例：同时加载同一资源时，使其只加载一次，完成后调用所有相关回调函数。\r\n     *\r\n     * @param funcHost 函数所属对象\r\n     * @param func 函数\r\n     * @param params 函数除callback外的参数列表\r\n     * @param callback 完成回调函数\r\n     */\r\n    wrapAsyncFunc(funcHost: Object, func: Function, params: any[], callback: (...args: any[]) => void)\r\n    {\r\n        // 获取唯一编号\r\n        const cuuid = uuid.getArrayUuid([func].concat(params));\r\n        // 检查是否执行过\r\n        const result = this._wrapFResult[cuuid];\r\n        if (result)\r\n        {\r\n            // eslint-disable-next-line prefer-spread\r\n            callback.apply(null, result);\r\n\r\n            return;\r\n        }\r\n        // 监听执行完成事件\r\n        anyEmitter.once(this, cuuid, () =>\r\n        {\r\n            // 完成时重新执行函数\r\n            this.wrapAsyncFunc(funcHost, func, params, callback);\r\n        });\r\n        // 正在执行时直接返回等待完成事件\r\n        if (this._state[cuuid]) return;\r\n        // 标记正在执行中\r\n        this._state[cuuid] = true;\r\n\r\n        // 执行函数\r\n        func.apply(funcHost, params.concat((...args: any[]) =>\r\n        {\r\n            // 清理执行标记\r\n            delete this._state[cuuid];\r\n            // 保存执行结果\r\n            this._wrapFResult[cuuid] = args;\r\n            // 通知执行完成\r\n            anyEmitter.emit(this, cuuid);\r\n        }));\r\n    }\r\n\r\n    private _wrapFResult: { [cuuid: string]: any } = {};\r\n    private _state: { [uuid: string]: boolean } = {};\r\n}\r\n\r\nexport const __functionwrap__ = '__functionwrap__';\r\nexport const functionwrap = new FunctionWrap();\r\n","/* eslint-disable no-restricted-syntax */\r\n/* eslint-disable no-debugger */\r\nimport { functionwrap } from './FunctionWarp';\r\n\r\n/**\r\n * 是否开启调试\r\n */\r\nexport const debuger = true;\r\n\r\n/**\r\n * 调试工具\r\n */\r\nexport class Debug\r\n{\r\n    constructor()\r\n    {\r\n        // 断言失败前进入断点调试\r\n        functionwrap.wrap(console, 'assert', (test: boolean) => { if (!test) debugger; });\r\n        // 输出错误前进入断点调试\r\n        functionwrap.wrap(console, 'error', () => { debugger; });\r\n        functionwrap.wrap(console, 'warn', () => { debugger; });\r\n    }\r\n\r\n    /**\r\n     * 测试代码运行时间\r\n     * @param fn 被测试的方法\r\n     * @param labal 标签\r\n     */\r\n    time(fn: Function, labal?: string)\r\n    {\r\n        labal = labal || fn['name'] || `Anonymous function ${Math.random()}`;\r\n        console.time(labal);\r\n        fn();\r\n        console.timeEnd(labal);\r\n    }\r\n}\r\n/**\r\n * 调试工具\r\n */\r\nexport const debug = new Debug();\r\n","/**\r\n * 常用正则表示式\r\n */\r\nexport class RegExps\r\n{\r\n    /**\r\n     * json文件\r\n     */\r\n    json = /(\\.json)\\b/i;\r\n\r\n    /**\r\n     * 图片\r\n     */\r\n    image = /(\\.jpg|\\.png|\\.jpeg|\\.gif)\\b/i;\r\n\r\n    /**\r\n     * 声音\r\n     */\r\n    audio = /(\\.ogg|\\.mp3|\\.wav)\\b/i;\r\n\r\n    /**\r\n     * 命名空间\r\n     */\r\n    namespace = /namespace\\s+([\\w$_\\d\\.]+)/;\r\n\r\n    /**\r\n     * 类\r\n     */\r\n    classReg = /(export\\s+)?(abstract\\s+)?class\\s+([\\w$_\\d]+)(\\s+extends\\s+([\\w$_\\d\\.]+))?/;\r\n}\r\n\r\n/**\r\n * 常用正则表示式\r\n */\r\nexport const regExps = new RegExps();\r\n","import { ticker } from './Ticker';\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\ndeclare global\r\n{\r\n\r\n    interface Performance\r\n    {\r\n        memory: any;\r\n    }\r\n}\r\n\r\nexport class Stats\r\n{\r\n    static instance: Stats;\r\n    static init(parent?: HTMLElement)\r\n    {\r\n        if (!this.instance)\r\n        {\r\n            this.instance = new Stats();\r\n            parent = parent || document.body;\r\n            parent.appendChild(this.instance.dom);\r\n        }\r\n        ticker.onframe(this.instance.update, this.instance);\r\n    }\r\n\r\n    REVISION: number;\r\n    dom: HTMLDivElement;\r\n    domElement: HTMLDivElement;\r\n    addPanel: (panel: StatsPanel) => StatsPanel;\r\n    showPanel: (id: number) => void;\r\n    setMode: (id: number) => void;\r\n    begin: () => void;\r\n    end: () => number;\r\n    update: () => void;\r\n\r\n    constructor()\r\n    {\r\n        let mode = 0;\r\n        if (typeof document === 'undefined') return;\r\n\r\n        const container = document.createElement('div');\r\n        container.style.cssText = 'position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;';\r\n        container.addEventListener('click', function (event)\r\n        {\r\n            event.preventDefault();\r\n            showPanel(++mode % container.children.length);\r\n        }, false);\r\n\r\n        //\r\n        function addPanel(panel: StatsPanel)\r\n        {\r\n            container.appendChild(panel.dom);\r\n\r\n            return panel;\r\n        }\r\n\r\n        function showPanel(id: number)\r\n        {\r\n            for (let i = 0; i < container.children.length; i++)\r\n            {\r\n                (<HTMLCanvasElement>container.children[i]).style.display = i === id ? 'block' : 'none';\r\n            }\r\n            mode = id;\r\n        }\r\n\r\n        //\r\n        let beginTime = (performance || Date).now(); let prevTime = beginTime; let\r\n            frames = 0;\r\n\r\n        const fpsPanel = addPanel(new StatsPanel('FPS', '#0ff', '#002'));\r\n        const msPanel = addPanel(new StatsPanel('MS', '#0f0', '#020'));\r\n\r\n        let memPanel: StatsPanel;\r\n        if (self.performance && self.performance.memory)\r\n        {\r\n            memPanel = addPanel(new StatsPanel('MB', '#f08', '#201'));\r\n        }\r\n\r\n        showPanel(0);\r\n\r\n        this.REVISION = 16;\r\n        this.dom = container;\r\n        this.addPanel = addPanel;\r\n        this.showPanel = showPanel;\r\n\r\n        this.begin = () =>\r\n        {\r\n            beginTime = (performance || Date).now();\r\n        };\r\n\r\n        this.end = () =>\r\n        {\r\n            frames++;\r\n            const time = (performance || Date).now();\r\n            msPanel.update(time - beginTime, 200);\r\n            if (time > prevTime + 1000)\r\n            {\r\n                fpsPanel.update((frames * 1000) / (time - prevTime), 100);\r\n                prevTime = time;\r\n                frames = 0;\r\n                if (memPanel)\r\n                {\r\n                    const memory = performance.memory;\r\n                    memPanel.update(memory.usedJSHeapSize / 1048576, memory.jsHeapSizeLimit / 1048576);\r\n                }\r\n            }\r\n\r\n            return time;\r\n        };\r\n\r\n        this.update = () =>\r\n        {\r\n            beginTime = this.end();\r\n        };\r\n\r\n        // Backwards Compatibility\r\n\r\n        this.domElement = container;\r\n        this.setMode = showPanel;\r\n    }\r\n}\r\n\r\nexport class StatsPanel\r\n{\r\n    dom: HTMLCanvasElement;\r\n    update: (value: number, maxValue: number) => void;\r\n\r\n    constructor(name: string, fg: string, bg: string)\r\n    {\r\n        let min = Infinity; let max = 0; const\r\n            round = Math.round;\r\n        const PR = round(window.devicePixelRatio || 1);\r\n\r\n        const WIDTH = 80 * PR; const HEIGHT = 48 * PR;\r\n        const TEXT_X = 3 * PR; const TEXT_Y = 2 * PR;\r\n        const GRAPH_X = 3 * PR; const GRAPH_Y = 15 * PR;\r\n        const GRAPH_WIDTH = 74 * PR; const\r\n            GRAPH_HEIGHT = 30 * PR;\r\n\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = WIDTH;\r\n        canvas.height = HEIGHT;\r\n        canvas.style.cssText = 'width:80px;height:48px';\r\n\r\n        const context0 = canvas.getContext('2d');\r\n        if (!context0)\r\n        {\r\n            console.log(`无法创建 CanvasRenderingContext2D `);\r\n\r\n            return;\r\n        }\r\n        const context = context0;\r\n        context.font = `bold ${9 * PR}px Helvetica,Arial,sans-serif`;\r\n        context.textBaseline = 'top';\r\n\r\n        context.fillStyle = bg;\r\n        context.fillRect(0, 0, WIDTH, HEIGHT);\r\n\r\n        context.fillStyle = fg;\r\n        context.fillText(name, TEXT_X, TEXT_Y);\r\n        context.fillRect(GRAPH_X, GRAPH_Y, GRAPH_WIDTH, GRAPH_HEIGHT);\r\n\r\n        context.fillStyle = bg;\r\n        context.globalAlpha = 0.9;\r\n        context.fillRect(GRAPH_X, GRAPH_Y, GRAPH_WIDTH, GRAPH_HEIGHT);\r\n\r\n        this.dom = canvas;\r\n\r\n        this.update = (value: number, maxValue: number) =>\r\n        {\r\n            min = Math.min(min, value);\r\n            max = Math.max(max, value);\r\n\r\n            context.fillStyle = bg;\r\n            context.globalAlpha = 1;\r\n            context.fillRect(0, 0, WIDTH, GRAPH_Y);\r\n            context.fillStyle = fg;\r\n            context.fillText(`${round(value)} ${name} (${round(min)}-${round(max)})`, TEXT_X, TEXT_Y);\r\n\r\n            context.drawImage(canvas, GRAPH_X + PR, GRAPH_Y, GRAPH_WIDTH - PR, GRAPH_HEIGHT, GRAPH_X, GRAPH_Y, GRAPH_WIDTH - PR, GRAPH_HEIGHT);\r\n\r\n            context.fillRect(GRAPH_X + GRAPH_WIDTH - PR, GRAPH_Y, PR, GRAPH_HEIGHT);\r\n\r\n            context.fillStyle = bg;\r\n            context.globalAlpha = 0.9;\r\n            context.fillRect(GRAPH_X + GRAPH_WIDTH - PR, GRAPH_Y, PR, round((1 - (value / maxValue)) * GRAPH_HEIGHT));\r\n        };\r\n    }\r\n}\r\n","import { Matrix4x4, Plane, Vector3, Vector4 } from '@feng3d/math';\r\nimport { RenderAtomic } from '@feng3d/renderer';\r\nimport { serialization } from '@feng3d/serialization';\r\nimport { Camera } from '../cameras/Camera';\r\nimport { RegisterComponent } from '../component/Component';\r\nimport { GameObject } from '../core/GameObject';\r\nimport { Renderable } from '../core/Renderable';\r\nimport { Geometry } from '../geometry/Geometry';\r\nimport { Material } from '../materials/Material';\r\nimport { AddComponentMenu } from '../Menu';\r\nimport { createNodeMenu } from '../menu/CreateNodeMenu';\r\nimport { FrameBufferObject } from '../render/FrameBufferObject';\r\nimport { Scene } from '../scene/Scene';\r\nimport { WaterUniforms } from './WaterMaterial';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        Water: Water\r\n    }\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        Water: GameObject;\r\n    }\r\n}\r\n\r\n/**\r\n * The Water component renders the terrain.\r\n */\r\n@AddComponentMenu('Graphics/Water')\r\n@RegisterComponent()\r\nexport class Water extends Renderable\r\n{\r\n    __class__: 'feng3d.Water';\r\n\r\n    geometry = Geometry.getDefault('Plane');\r\n\r\n    material = Material.getDefault('Water-Material');\r\n\r\n    /**\r\n     * 帧缓冲对象，用于处理水面反射\r\n     */\r\n    private frameBufferObject = new FrameBufferObject();\r\n\r\n    beforeRender(renderAtomic: RenderAtomic, scene: Scene, camera: Camera)\r\n    {\r\n        const uniforms = this.material.uniforms as WaterUniforms;\r\n        const sun = this.gameObject.scene.activeDirectionalLights[0];\r\n        if (sun)\r\n        {\r\n            uniforms.u_sunColor = sun.color;\r\n            uniforms.u_sunDirection = sun.transform.localToWorldMatrix.getAxisZ().negate();\r\n        }\r\n\r\n        const clipBias = 0;\r\n\r\n        uniforms.u_time += 1.0 / 60.0;\r\n\r\n        // this.material.uniforms.s_mirrorSampler.url = \"Assets/floor_diffuse.jpg\";\r\n\r\n        super.beforeRender(renderAtomic, scene, camera);\r\n\r\n        // eslint-disable-next-line no-constant-condition\r\n        if (1) return;\r\n        //\r\n        const mirrorWorldPosition = this.transform.worldPosition;\r\n        const cameraWorldPosition = camera.transform.worldPosition;\r\n\r\n        let rotationMatrix = this.transform.rotationMatrix;\r\n\r\n        const normal = rotationMatrix.getAxisZ();\r\n\r\n        const view = mirrorWorldPosition.subTo(cameraWorldPosition);\r\n        if (view.dot(normal) > 0) return;\r\n\r\n        view.reflect(normal).negate();\r\n        view.add(mirrorWorldPosition);\r\n\r\n        rotationMatrix = camera.transform.rotationMatrix;\r\n\r\n        const lookAtPosition = new Vector3(0, 0, -1);\r\n        lookAtPosition.applyMatrix4x4(rotationMatrix);\r\n        lookAtPosition.add(cameraWorldPosition);\r\n\r\n        const target = mirrorWorldPosition.subTo(lookAtPosition);\r\n        target.reflect(normal).negate();\r\n        target.add(mirrorWorldPosition);\r\n\r\n        const mirrorCamera = serialization.setValue(new GameObject(), { name: 'waterMirrorCamera' }).addComponent(Camera);\r\n        mirrorCamera.transform.position = view;\r\n        mirrorCamera.transform.lookAt(target, rotationMatrix.getAxisY());\r\n\r\n        mirrorCamera.lens = camera.lens.clone();\r\n\r\n        const textureMatrix = new Matrix4x4(\r\n            [\r\n                0.5, 0.0, 0.0, 0.0,\r\n                0.0, 0.5, 0.0, 0.0,\r\n                0.0, 0.0, 0.5, 0.0,\r\n                0.5, 0.5, 0.5, 1.0\r\n            ]\r\n        );\r\n        textureMatrix.append(mirrorCamera.viewProjection);\r\n\r\n        const mirrorPlane = Plane.fromNormalAndPoint(mirrorCamera.transform.worldToLocalMatrix.transformVector3(normal), mirrorCamera.transform.worldToLocalMatrix.transformPoint3(mirrorWorldPosition));\r\n        const clipPlane = new Vector4(mirrorPlane.a, mirrorPlane.b, mirrorPlane.c, mirrorPlane.d);\r\n\r\n        const projectionMatrix = mirrorCamera.lens.matrix;\r\n\r\n        const q = new Vector4();\r\n        q.x = (clipPlane.x / Math.abs(clipPlane.x) + projectionMatrix.elements[8]) / projectionMatrix.elements[0];\r\n        q.y = (clipPlane.y / Math.abs(clipPlane.y) + projectionMatrix.elements[9]) / projectionMatrix.elements[5];\r\n        q.z = -1.0;\r\n        q.w = (1.0 + projectionMatrix.elements[10]) / projectionMatrix.elements[14];\r\n\r\n        clipPlane.scale(2.0 / clipPlane.dot(q));\r\n\r\n        projectionMatrix.elements[2] = clipPlane.x;\r\n        projectionMatrix.elements[6] = clipPlane.y;\r\n        projectionMatrix.elements[10] = clipPlane.z + 1.0 - clipBias;\r\n        projectionMatrix.elements[14] = clipPlane.w;\r\n\r\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n        const eye = camera.transform.worldPosition;\r\n\r\n        // 不支持直接操作gl，下面代码暂时注释掉！\r\n        // //\r\n        // var frameBufferObject = this.frameBufferObject;\r\n        // FrameBufferObject.active(gl, frameBufferObject);\r\n\r\n        // //\r\n        // gl.viewport(0, 0, frameBufferObject.OFFSCREEN_WIDTH, frameBufferObject.OFFSCREEN_HEIGHT);\r\n        // gl.clearColor(1.0, 1.0, 1.0, 1.0);\r\n        // gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\r\n        // skyboxRenderer.draw(gl, scene, mirrorCamera);\r\n        // // forwardRenderer.draw(gl, scene, mirrorCamera);\r\n        // // forwardRenderer.draw(gl, scene, camera);\r\n\r\n        // frameBufferObject.deactive(gl);\r\n\r\n        //\r\n        // this.material.uniforms.s_mirrorSampler = frameBufferObject.texture;\r\n\r\n        uniforms.u_textureMatrix = textureMatrix;\r\n    }\r\n}\r\n\r\nGameObject.registerPrimitive('Water', (g) =>\r\n{\r\n    g.addComponent(Water);\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n    {\r\n        path: '3D Object/Water',\r\n        priority: -20000,\r\n        click: () =>\r\n            GameObject.createPrimitive('Water')\r\n    }\r\n);\r\n\r\n","import { Color3, Matrix4x4, Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { shaderlib } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { Material } from '../materials/Material';\r\nimport { Texture2D } from '../textures/Texture2D';\r\nimport waterVertex from '../shaders/water.vertex.glsl';\r\nimport waterFragment from '../shaders/water.fragment.glsl';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsUniformsTypes { water: WaterUniforms }\r\n\r\n    export interface MixinsDefaultMaterial\r\n    {\r\n        'Water-Material': Material;\r\n    }\r\n}\r\n\r\nexport class WaterUniforms\r\n{\r\n    __class__: 'feng3d.WaterUniforms';\r\n\r\n    @serialize\r\n    @oav({ tooltip: '透明度' })\r\n    u_alpha = 1.0;\r\n\r\n    /**\r\n     * 水体运动时间，默认自动递增\r\n     */\r\n    // @serialize\r\n    // @oav({ tooltip: \"水体运动时间，默认自动递增\" })\r\n    u_time = 0.0;\r\n\r\n    @serialize\r\n    @oav({ tooltip: '水体展现的尺寸' })\r\n    u_size = 10.0;\r\n\r\n    @oav()\r\n    @serialize\r\n    u_distortionScale = 20.0;\r\n\r\n    @serialize\r\n    @oav({ tooltip: '水体颜色' })\r\n    u_waterColor = new Color3().fromUnit(0x555555);\r\n\r\n    @oav()\r\n    @serialize\r\n    @oav({ tooltip: '水体法线图' })\r\n    s_normalSampler = Texture2D.default;\r\n\r\n    /**\r\n     * 镜面反射贴图\r\n     */\r\n    @oav()\r\n    // s_mirrorSampler = new RenderTargetTexture2D();\r\n    s_mirrorSampler = Texture2D.default;\r\n\r\n    u_textureMatrix = new Matrix4x4();\r\n    u_sunColor = new Color3().fromUnit(0x7F7F7F);\r\n    u_sunDirection = new Vector3(0.70707, 0.70707, 0);\r\n}\r\n\r\nshaderlib.shaderConfig.shaders.water = { fragment: waterFragment, vertex: waterVertex, cls: WaterUniforms };\r\n\r\nMaterial.setDefault('Water-Material', { shaderName: 'water' });\r\n","import { FileAsset } from '@feng3d/core';\r\n\r\n/**\r\n * 二进制 资源\r\n */\r\nexport class ArrayBufferAsset extends FileAsset\r\n{\r\n    /**\r\n     * 文件数据\r\n     */\r\n    arraybuffer: ArrayBuffer;\r\n\r\n    /**\r\n     * 保存文件\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    saveFile(callback?: (err: Error) => void)\r\n    {\r\n        this.rs.fs.writeArrayBuffer(this.assetPath, this.arraybuffer, callback);\r\n    }\r\n\r\n    /**\r\n     * 读取文件\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    readFile(callback?: (err: Error) => void)\r\n    {\r\n        this.rs.fs.readArrayBuffer(this.assetPath, (err, data) =>\r\n        {\r\n            this.arraybuffer = data;\r\n            callback && callback(err);\r\n        });\r\n    }\r\n}\r\n","import { AssetType } from '@feng3d/core';\r\nimport { ArrayBufferAsset } from '../ArrayBufferAsset';\r\n\r\n/**\r\n * 音效资源\r\n */\r\nexport class AudioAsset extends ArrayBufferAsset\r\n{\r\n    readonly assetType = AssetType.audio;\r\n    // readonly extenson: \".ogg\" | \".mp3\" | \".wav\" = \".mp3\";\r\n}\r\n","import { FileAsset, AssetData } from '@feng3d/core';\r\nimport { objectEmitter } from '@feng3d/event';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialization } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\n\r\n/**\r\n * 对象资源\r\n */\r\nexport abstract class ObjectAsset extends FileAsset\r\n{\r\n    /**\r\n     * 资源对象\r\n     */\r\n    @oav({ component: 'OAVObjectView' })\r\n    @watch('_dataChanged')\r\n    declare data: any;\r\n\r\n    saveFile(callback?: (err: Error) => void)\r\n    {\r\n        this.data.assetId = this.assetId;\r\n        const d = serialization.serialize(this.data);\r\n        this.rs.fs.writeObject(this.assetPath, d, (err) =>\r\n        {\r\n            callback && callback(err);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 读取文件\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    readFile(callback?: (err: Error) => void)\r\n    {\r\n        this.rs.fs.readObject(this.assetPath, (err, object) =>\r\n        {\r\n            this.rs.deserializeWithAssets(object, (data: AssetData) =>\r\n            {\r\n                this.data = data;\r\n                this.data.assetId = this.assetId;\r\n                callback && callback(err);\r\n            });\r\n        });\r\n    }\r\n\r\n    private _dataChanged(property, oldValue, newValue)\r\n    {\r\n        if (oldValue)\r\n        {\r\n            objectEmitter.off(oldValue, 'propertyValueChanged', this._onDataChanged, this);\r\n        }\r\n        if (newValue)\r\n        {\r\n            objectEmitter.on(newValue, 'propertyValueChanged', this._onDataChanged, this);\r\n        }\r\n    }\r\n\r\n    private _onDataChanged()\r\n    {\r\n        this.write();\r\n    }\r\n}\r\n","import { AssetType, GameObject } from '@feng3d/core';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialization } from '@feng3d/serialization';\r\nimport { ObjectAsset } from '../ObjectAsset';\r\n\r\nexport interface GameObjectAsset\r\n{\r\n    getAssetData(callback?: (result: GameObject) => void): GameObject;\r\n}\r\n\r\n/**\r\n * 游戏对象资源\r\n */\r\nexport class GameObjectAsset extends ObjectAsset\r\n{\r\n    /**\r\n     * 材质\r\n     */\r\n    @oav({ component: 'OAVObjectView' })\r\n    declare data: GameObject;\r\n\r\n    assetType = AssetType.gameobject;\r\n\r\n    static extenson = '.json';\r\n\r\n    initAsset()\r\n    {\r\n        this.data = this.data || new GameObject();\r\n        this.data.assetId = this.data.assetId || this.assetId;\r\n    }\r\n\r\n    protected _getAssetData()\r\n    {\r\n        const gameobject = serialization.clone(this.data);\r\n        delete gameobject.assetId;\r\n        gameobject.prefabId = this.assetId;\r\n\r\n        return gameobject;\r\n    }\r\n}\r\n","import { AssetType, CubeGeometry, Geometry, setAssetTypeClass } from '@feng3d/core';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { ObjectAsset } from '../ObjectAsset';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsAssetTypeClassMap\r\n    {\r\n        'geometry': new () => GeometryAsset;\r\n    }\r\n}\r\n\r\n/**\r\n * 几何体资源\r\n */\r\nexport class GeometryAsset extends ObjectAsset\r\n{\r\n    static extenson = '.json';\r\n\r\n    /**\r\n     * 几何体\r\n     */\r\n    @oav({ component: 'OAVObjectView' })\r\n    declare data: Geometry;\r\n\r\n    assetType = AssetType.geometry;\r\n\r\n    initAsset()\r\n    {\r\n        this.data = this.data || new CubeGeometry();\r\n        this.data.assetId = this.data.assetId || this.assetId;\r\n    }\r\n}\r\n\r\nsetAssetTypeClass('geometry', GeometryAsset);\r\n","import { AssetType, FileAsset, setAssetTypeClass } from '@feng3d/core';\r\nimport { oav } from '@feng3d/objectview';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsAssetTypeClassMap\r\n    {\r\n        'txt': new () => TextAsset;\r\n    }\r\n}\r\n\r\n/**\r\n * 文本 资源\r\n */\r\nexport class TextAsset extends FileAsset\r\n{\r\n    static extenson = '.txt';\r\n\r\n    assetType = AssetType.txt;\r\n\r\n    @oav({ component: 'OAVMultiText' })\r\n    textContent: string;\r\n\r\n    initAsset()\r\n    {\r\n        this.textContent = this.textContent || '';\r\n    }\r\n\r\n    saveFile(callback?: (err: Error) => void)\r\n    {\r\n        this.rs.fs.writeString(this.assetPath, this.textContent, callback);\r\n    }\r\n\r\n    /**\r\n     * 读取文件\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    readFile(callback?: (err: Error) => void)\r\n    {\r\n        this.rs.fs.readString(this.assetPath, (err, data) =>\r\n        {\r\n            this.textContent = data;\r\n            callback && callback(err);\r\n        });\r\n    }\r\n}\r\n\r\nsetAssetTypeClass('txt', TextAsset);\r\n","import { AssetType, setAssetTypeClass } from '@feng3d/core';\r\nimport { TextAsset } from './TextAsset';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsAssetTypeClassMap\r\n    {\r\n        'js': new () => JSAsset;\r\n    }\r\n}\r\n\r\n/**\r\n * JS资源\r\n */\r\nexport class JSAsset extends TextAsset\r\n{\r\n    static extenson = '.js';\r\n\r\n    assetType = AssetType.js;\r\n\r\n    declare textContent: string;\r\n\r\n    initAsset()\r\n    {\r\n        this.textContent = this.textContent || '';\r\n    }\r\n}\r\n\r\nsetAssetTypeClass('js', JSAsset);\r\n","import { AssetType, setAssetTypeClass } from '@feng3d/core';\r\nimport { TextAsset } from './TextAsset';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsAssetTypeClassMap\r\n    {\r\n        'json': new () => JsonAsset;\r\n    }\r\n}\r\n\r\n/**\r\n * JSON 资源\r\n */\r\nexport class JsonAsset extends TextAsset\r\n{\r\n    static extenson = '.json';\r\n\r\n    assetType = AssetType.json;\r\n\r\n    declare textContent: string;\r\n\r\n    initAsset()\r\n    {\r\n        this.textContent = this.textContent || '{}';\r\n    }\r\n}\r\n\r\nsetAssetTypeClass('json', JsonAsset);\r\n","import { AssetType, Material, setAssetTypeClass } from '@feng3d/core';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { ObjectAsset } from '../ObjectAsset';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsAssetTypeClassMap\r\n    {\r\n        'material': new () => MaterialAsset;\r\n    }\r\n}\r\n\r\n/**\r\n * 材质资源\r\n */\r\nexport class MaterialAsset extends ObjectAsset\r\n{\r\n    static extenson = '.json';\r\n\r\n    /**\r\n     * 材质\r\n     */\r\n    @oav({ component: 'OAVObjectView' })\r\n    declare data: Material;\r\n\r\n    assetType = AssetType.material;\r\n\r\n    initAsset()\r\n    {\r\n        this.data = this.data || new Material();\r\n    }\r\n}\r\n\r\nsetAssetTypeClass('material', MaterialAsset);\r\n","import { AssetType, regExps, setAssetTypeClass } from '@feng3d/core';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { TextAsset } from './TextAsset';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsAssetTypeClassMap\r\n    {\r\n        'script': new () => ScriptAsset;\r\n    }\r\n}\r\n\r\n/**\r\n * 脚本资源\r\n */\r\nexport class ScriptAsset extends TextAsset\r\n{\r\n    static extenson = '.ts';\r\n\r\n    assetType = AssetType.script;\r\n\r\n    @watch('_invalidate')\r\n    declare textContent: string;\r\n\r\n    /**\r\n     * 脚本父类名称\r\n     */\r\n    get parentScriptName()\r\n    {\r\n        this._update();\r\n\r\n        return this._parentScriptName;\r\n    }\r\n    private _parentScriptName: string;\r\n\r\n    /**\r\n     * 脚本类定义\r\n     */\r\n    get scriptName()\r\n    {\r\n        this._update();\r\n\r\n        return this._scriptName;\r\n    }\r\n    private _scriptName: string;\r\n\r\n    private _invalid = true;\r\n\r\n    initAsset()\r\n    {\r\n        this.textContent = this.textContent || '';\r\n    }\r\n\r\n    private _invalidate()\r\n    {\r\n        this._invalid = true;\r\n    }\r\n\r\n    private _update()\r\n    {\r\n        if (!this._invalid) return;\r\n        this._invalid = false;\r\n\r\n        if (!this.textContent)\r\n        {\r\n            this._scriptName = '';\r\n\r\n            return;\r\n        }\r\n\r\n        // 获取脚本类名称\r\n        let result = regExps.classReg.exec(this.textContent);\r\n        console.assert(result !== null, `在脚本 ${this.assetPath} 中没有找到 脚本类定义`);\r\n        let script = result[3];\r\n        if (result[5])\r\n        {\r\n            this._parentScriptName = result[5].split('.').pop();\r\n        }\r\n        // 获取导出类命名空间\r\n        if (result[1])\r\n        {\r\n            result = regExps.namespace.exec(this.textContent);\r\n            console.assert(result !== null, `获取脚本 ${this.assetPath} 命名空间失败`);\r\n            script = `${result[1]}.${script}`;\r\n        }\r\n\r\n        this._scriptName = script;\r\n    }\r\n}\r\n\r\nsetAssetTypeClass('script', ScriptAsset);\r\n","import { AssetType, setAssetTypeClass } from '@feng3d/core';\r\nimport { ScriptAsset } from './ScriptAsset';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsAssetTypeClassMap\r\n    {\r\n        'shader': new () => ShaderAsset;\r\n    }\r\n}\r\n\r\n/**\r\n * 着色器 资源\r\n */\r\nexport class ShaderAsset extends ScriptAsset\r\n{\r\n    static extenson = '.ts';\r\n\r\n    assetType = AssetType.shader;\r\n}\r\n\r\nsetAssetTypeClass('shader', ShaderAsset);\r\n","import { AssetMeta, AssetType, FileAsset, Texture2D } from '@feng3d/core';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { gPartial } from '@feng3d/polyfill';\r\nimport { serialization } from '@feng3d/serialization';\r\n\r\n/**\r\n * 纹理文件\r\n */\r\nexport class TextureAsset extends FileAsset\r\n{\r\n    static extenson: '.jpg' | '.png' | '.jpeg' | '.gif' = '.png';\r\n\r\n    /**\r\n     * 材质\r\n     */\r\n    @oav({ component: 'OAVObjectView' })\r\n    declare data: Texture2D;\r\n\r\n    /**\r\n     * 图片\r\n     */\r\n    get image() { return this.data['_pixels'] as any; }\r\n    set image(v: HTMLImageElement)\r\n    {\r\n        this.data['_pixels'] = v;\r\n        this.saveFile();\r\n    }\r\n\r\n    declare meta: TextureAssetMeta;\r\n\r\n    assetType = AssetType.texture;\r\n\r\n    initAsset()\r\n    {\r\n        this.data = this.data || new Texture2D();\r\n    }\r\n\r\n    saveFile(callback?: (err: Error) => void)\r\n    {\r\n        this.rs.fs.writeImage(this.assetPath, this.image, (err) =>\r\n        {\r\n            callback && callback(err);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 读取文件\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    readFile(callback?: (err: Error) => void)\r\n    {\r\n        this.rs.fs.readImage(this.assetPath, (err, img: HTMLImageElement) =>\r\n        {\r\n            this.data['_pixels'] = img;\r\n            callback && callback(err);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 读取元标签\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    protected readMeta(callback?: (err?: Error) => void)\r\n    {\r\n        super.readMeta((err) =>\r\n        {\r\n            this.rs.deserializeWithAssets(this.meta.texture, (result) =>\r\n            {\r\n                this.data = result;\r\n                callback && callback(err);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 写元标签\r\n     *\r\n     * @param callback 完成回调\r\n     */\r\n    protected writeMeta(callback?: (err: Error) => void)\r\n    {\r\n        this.meta.texture = serialization.serialize(this.data);\r\n        super.writeMeta(callback);\r\n    }\r\n}\r\n\r\nexport interface TextureAssetMeta extends AssetMeta\r\n{\r\n    texture: gPartial<Texture2D>;\r\n}\r\n","import { AssetType, setAssetTypeClass, TextureCube } from '@feng3d/core';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { ObjectAsset } from '../ObjectAsset';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsAssetTypeClassMap\r\n    {\r\n        'texturecube': new () => TextureCubeAsset;\r\n    }\r\n}\r\n\r\n/**\r\n * 立方体纹理资源\r\n */\r\nexport class TextureCubeAsset extends ObjectAsset\r\n{\r\n    static extenson = '.json';\r\n\r\n    /**\r\n     * 材质\r\n     */\r\n    @oav({ component: 'OAVObjectView' })\r\n    declare data: TextureCube;\r\n\r\n    assetType = AssetType.texturecube;\r\n\r\n    initAsset()\r\n    {\r\n        this.data = this.data || new TextureCube();\r\n    }\r\n}\r\n\r\nsetAssetTypeClass('texturecube', TextureCubeAsset);\r\n","import { AnimationClip, PropertyClip, PropertyClipPath, PropertyClipPathItemType } from '@feng3d/core';\r\nimport { globalEmitter } from '@feng3d/event';\r\nimport { Vector3, Quaternion } from '@feng3d/math';\r\nimport { MD5AnimData, MD5_Frame, MD5_HierarchyData, MD5_BaseFrame } from '../parsers/MD5AnimParser';\r\n\r\n/**\r\n * MD5动画转换器\r\n */\r\nexport class MD5AnimConverter\r\n{\r\n    /**\r\n     * MD5动画数据转换为引擎动画数据\r\n     * @param md5AnimData MD5动画数据\r\n     * @param completed 转换完成回调\r\n     */\r\n    convert(md5AnimData: MD5AnimData, completed?: (animationClip: AnimationClip) => void)\r\n    {\r\n        const animationClip = new AnimationClip();\r\n        animationClip.name = md5AnimData.name;\r\n        animationClip.length = md5AnimData.numFrames / md5AnimData.frameRate * 1000;\r\n        animationClip.propertyClips = [];\r\n\r\n        const __chache__: { [key: string]: PropertyClip } = {};\r\n\r\n        for (let i = 0; i < md5AnimData.numFrames; ++i)\r\n        {\r\n            translatePose(md5AnimData, md5AnimData.frame[i], animationClip);\r\n        }\r\n\r\n        globalEmitter.emit('asset.parsed', animationClip);\r\n\r\n        completed && completed(animationClip);\r\n\r\n        /**\r\n         * 将一个关键帧数据转换为SkeletonPose\r\n         * @param frameData 帧数据\r\n         * @return 包含帧数据的SkeletonPose对象\r\n         */\r\n        function translatePose(md5AnimData: MD5AnimData, frameData: MD5_Frame, animationclip: AnimationClip)\r\n        {\r\n            let hierarchy: MD5_HierarchyData;\r\n            let base: MD5_BaseFrame;\r\n            let flags: number;\r\n            let j: number;\r\n            // 偏移量\r\n            const translation: Vector3 = new Vector3();\r\n            // 旋转四元素\r\n            const components: number[] = frameData.components;\r\n\r\n            for (let i = 0; i < md5AnimData.numJoints; ++i)\r\n            {\r\n                // 通过原始帧数据与层级数据计算出当前骨骼pose数据\r\n                j = 0;\r\n                // 层级数据\r\n                hierarchy = md5AnimData.hierarchy[i];\r\n                // 基础帧数据\r\n                base = md5AnimData.baseframe[i];\r\n                // 层级标记\r\n                flags = hierarchy.flags;\r\n                translation.x = base.position[0];\r\n                translation.y = base.position[1];\r\n                translation.z = base.position[2];\r\n                const orientation: Quaternion = new Quaternion();\r\n                orientation.x = base.orientation[0];\r\n                orientation.y = base.orientation[1];\r\n                orientation.z = base.orientation[2];\r\n\r\n                // 调整位移与角度数据\r\n                if (flags & 1)\r\n                { translation.x = components[hierarchy.startIndex + (j++)]; }\r\n                if (flags & 2)\r\n                { translation.y = components[hierarchy.startIndex + (j++)]; }\r\n                if (flags & 4)\r\n                { translation.z = components[hierarchy.startIndex + (j++)]; }\r\n                if (flags & 8)\r\n                { orientation.x = components[hierarchy.startIndex + (j++)]; }\r\n                if (flags & 16)\r\n                { orientation.y = components[hierarchy.startIndex + (j++)]; }\r\n                if (flags & 32)\r\n                { orientation.z = components[hierarchy.startIndex + (j++)]; }\r\n\r\n                // 计算四元素w值\r\n                const w = 1 - orientation.x * orientation.x - orientation.y * orientation.y - orientation.z * orientation.z;\r\n                orientation.w = w < 0 ? 0 : -Math.sqrt(w);\r\n\r\n                orientation.y = -orientation.y;\r\n                orientation.z = -orientation.z;\r\n                translation.x = -translation.x;\r\n\r\n                const eulers = orientation.toEulerAngles();\r\n                eulers.scaleNumber(180 / Math.PI);\r\n\r\n                const path: PropertyClipPath = [\r\n                    [PropertyClipPathItemType.GameObject, hierarchy.name],\r\n                    [PropertyClipPathItemType.Component, 'Transform'],\r\n                ];\r\n\r\n                const time = (frameData.index / md5AnimData.frameRate) * 1000;\r\n                setPropertyClipFrame(path, 'position', time, translation.toArray(), 'Vector3');\r\n                setPropertyClipFrame(path, 'orientation', time, orientation.toArray(), 'Quaternion');\r\n            }\r\n\r\n            function setPropertyClipFrame(path: PropertyClipPath, propertyName: string, time: number, propertyValue: number[], type: string)\r\n            {\r\n                const propertyClip = getPropertyClip(path, propertyName);\r\n                propertyClip.type = <any>type;\r\n                propertyClip.propertyValues.push([time, propertyValue]);\r\n            }\r\n\r\n            function getPropertyClip(path: PropertyClipPath, propertyName: string)\r\n            {\r\n                const key = path.join('-') + propertyName;\r\n                if (__chache__[key])\r\n                { return __chache__[key]; }\r\n                if (!__chache__[key])\r\n                {\r\n                    const propertyClip = __chache__[key] = new PropertyClip();\r\n                    propertyClip.path = path;\r\n                    propertyClip.propertyName = propertyName;\r\n                    propertyClip.propertyValues = [];\r\n                    animationclip.propertyClips.push(propertyClip);\r\n                }\r\n\r\n                return __chache__[key];\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * MD5动画转换器\r\n */\r\nexport const md5AnimConverter = new MD5AnimConverter();\r\n","import { CustomGeometry, GameObject, Material, Renderable } from '@feng3d/core';\r\nimport { globalEmitter } from '@feng3d/event';\r\nimport { serialization } from '@feng3d/serialization';\r\nimport { OBJ_Face, OBJ_OBJ, OBJ_OBJData, OBJ_SubOBJ } from '../parsers/OBJParser';\r\n\r\n/**\r\n * OBJ模型转换器\r\n */\r\nexport class OBJConverter\r\n{\r\n    /**\r\n     * OBJ模型数据转换为游戏对象\r\n     * @param objData OBJ模型数据\r\n     * @param materials 材质列表\r\n     * @param completed 转换完成回调\r\n     */\r\n    convert(objData: OBJ_OBJData, materials: { [name: string]: Material; }, completed: (gameObject: GameObject) => void)\r\n    {\r\n        const object = new GameObject();\r\n        object.name = objData.name;\r\n        const objs = objData.objs;\r\n        for (let i = 0; i < objs.length; i++)\r\n        {\r\n            const obj = objs[i];\r\n            const gameObject = createSubObj(objData, obj, materials);\r\n            object.addChild(gameObject);\r\n        }\r\n\r\n        globalEmitter.emit('asset.parsed', object);\r\n\r\n        completed && completed(object);\r\n    }\r\n}\r\n\r\n/**\r\n * OBJ模型转换器\r\n */\r\nexport const objConverter = new OBJConverter();\r\n\r\nfunction createSubObj(objData: OBJ_OBJData, obj: OBJ_OBJ, materials: { [name: string]: Material; })\r\n{\r\n    const gameObject = serialization.setValue(new GameObject(), { name: obj.name });\r\n\r\n    const subObjs = obj.subObjs;\r\n    for (let i = 0; i < subObjs.length; i++)\r\n    {\r\n        const materialObj = createMaterialObj(objData, subObjs[i], materials);\r\n        gameObject.addChild(materialObj);\r\n    }\r\n\r\n    return gameObject;\r\n}\r\n\r\nlet _realIndices: string[];\r\nlet _vertexIndex: number;\r\n\r\nfunction createMaterialObj(obj: OBJ_OBJData, subObj: OBJ_SubOBJ, materials: { [name: string]: Material; })\r\n{\r\n    const gameObject = new GameObject();\r\n    gameObject.name = subObj.g || gameObject.name;\r\n    const model = gameObject.addComponent(Renderable);\r\n    if (materials && materials[subObj.material])\r\n    { model.material = materials[subObj.material]; }\r\n\r\n    const geometry = model.geometry = new CustomGeometry();\r\n    geometry.name = subObj.g || geometry.name;\r\n    const vertices: number[] = [];\r\n    const normals: number[] = [];\r\n    const uvs: number[] = [];\r\n    _realIndices = [];\r\n    _vertexIndex = 0;\r\n    const faces = subObj.faces;\r\n    const indices: number[] = [];\r\n    for (let i = 0; i < faces.length; i++)\r\n    {\r\n        const face = faces[i];\r\n        const numVerts = face.indexIds.length - 1;\r\n        for (let j = 1; j < numVerts; ++j)\r\n        {\r\n            translateVertexData(face, j, vertices, uvs, indices, normals, obj);\r\n            translateVertexData(face, 0, vertices, uvs, indices, normals, obj);\r\n            translateVertexData(face, j + 1, vertices, uvs, indices, normals, obj);\r\n        }\r\n    }\r\n    geometry.indices = indices;\r\n    geometry.positions = vertices;\r\n\r\n    if (normals.length > 0)\r\n    { geometry.normals = normals; }\r\n\r\n    if (uvs.length > 0)\r\n    { geometry.uvs = uvs; }\r\n\r\n    globalEmitter.emit('asset.parsed', geometry);\r\n\r\n    return gameObject;\r\n\r\n    function translateVertexData(face: OBJ_Face, vertexIndex: number, vertices: Array<number>, uvs: Array<number>, indices: Array<number>, normals: Array<number>, obj: OBJ_OBJData)\r\n    {\r\n        let index: number;\r\n        let vertex: { x: number; y: number; z: number; };\r\n        let vertexNormal: { x: number; y: number; z: number; };\r\n        let uv: { u: number, v: number, s: number };\r\n        if (!_realIndices[face.indexIds[vertexIndex]])\r\n        {\r\n            index = _vertexIndex;\r\n            _realIndices[face.indexIds[vertexIndex]] = ++_vertexIndex;\r\n            vertex = obj.vertex[parseInt(face.vertexIndices[vertexIndex]) - 1];\r\n            vertices.push(vertex.x, vertex.y, vertex.z);\r\n            if (face.normalIndices && face.normalIndices.length > 0)\r\n            {\r\n                vertexNormal = obj.vn[parseInt(face.normalIndices[vertexIndex]) - 1];\r\n                normals.push(vertexNormal.x, vertexNormal.y, vertexNormal.z);\r\n            }\r\n            if (face.uvIndices && face.uvIndices.length > 0)\r\n            {\r\n                try\r\n                {\r\n                    uv = obj.vt[parseInt(face.uvIndices[vertexIndex]) - 1];\r\n                    uvs.push(uv.u, uv.v);\r\n                }\r\n                catch (e)\r\n                {\r\n                    switch (vertexIndex)\r\n                    {\r\n                        case 0:\r\n                            uvs.push(0, 1);\r\n                            break;\r\n                        case 1:\r\n                            uvs.push(0.5, 0);\r\n                            break;\r\n                        case 2:\r\n                            uvs.push(1, 1);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else\r\n        { index = _realIndices[face.indexIds[vertexIndex]] - 1; }\r\n        indices.push(index);\r\n    }\r\n}\r\n","import { Animation, CustomGeometry, GameObject, SkeletonComponent, SkeletonJoint, SkinnedMeshRenderer, SkinSkeletonTemp } from '@feng3d/core';\r\nimport { globalEmitter } from '@feng3d/event';\r\nimport { Matrix4x4, Quaternion, Vector3 } from '@feng3d/math';\r\nimport { MD5MeshData, MD5_Joint, MD5_Mesh, MD5_Vertex, MD5_Weight } from '../parsers/MD5MeshParser';\r\n\r\n/**\r\n * MD5模型转换器\r\n */\r\nexport class MD5MeshConverter\r\n{\r\n    /**\r\n     * MD5模型数据转换为游戏对象\r\n     * @param md5MeshData MD5模型数据\r\n     * @param completed 转换完成回调\r\n     */\r\n    convert(md5MeshData: MD5MeshData, completed?: (gameObject: GameObject) => void)\r\n    {\r\n        const gameObject = new GameObject();\r\n        gameObject.name = md5MeshData.name;\r\n        gameObject.addComponent(Animation);\r\n        gameObject.transform.rx = -90;\r\n\r\n        // 顶点最大关节关联数\r\n        const _maxJointCount = this.calculateMaxJointCount(md5MeshData);\r\n        console.assert(_maxJointCount <= 8, '顶点最大关节关联数最多支持8个');\r\n\r\n        const skeletonjoints = this.createSkeleton(md5MeshData.joints);\r\n\r\n        const skeletonComponent = gameObject.addComponent(SkeletonComponent);\r\n        skeletonComponent.joints = skeletonjoints;\r\n\r\n        for (let i = 0; i < md5MeshData.meshs.length; i++)\r\n        {\r\n            const skinSkeleton = new SkinSkeletonTemp();\r\n            const geometry = this.createGeometry(md5MeshData.meshs[i], skeletonComponent, skinSkeleton);\r\n\r\n            const skeletonGameObject = new GameObject();\r\n\r\n            const skinnedModel = skeletonGameObject.addComponent(SkinnedMeshRenderer);\r\n            skinnedModel.geometry = geometry;\r\n            skinnedModel.skinSkeleton = skinSkeleton;\r\n\r\n            gameObject.addChild(skeletonGameObject);\r\n        }\r\n\r\n        globalEmitter.emit('asset.parsed', gameObject);\r\n        completed && completed(gameObject);\r\n    }\r\n\r\n    /**\r\n     * 计算最大关节数量\r\n     */\r\n    private calculateMaxJointCount(md5MeshData: MD5MeshData)\r\n    {\r\n        let _maxJointCount = 0;\r\n\r\n        // 遍历所有的网格数据\r\n        const numMeshData = md5MeshData.meshs.length;\r\n        for (let i = 0; i < numMeshData; ++i)\r\n        {\r\n            const meshData: MD5_Mesh = md5MeshData.meshs[i];\r\n            const vertexData: MD5_Vertex[] = meshData.verts;\r\n            const numVerts = vertexData.length;\r\n\r\n            // 遍历每个顶点 寻找关节关联最大数量\r\n            for (let j = 0; j < numVerts; ++j)\r\n            {\r\n                const zeroWeights = this.countZeroWeightJoints(vertexData[j], meshData.weights);\r\n                const totalJoints = vertexData[j].countWeight - zeroWeights;\r\n                if (totalJoints > _maxJointCount)\r\n                { _maxJointCount = totalJoints; }\r\n            }\r\n        }\r\n\r\n        return _maxJointCount;\r\n    }\r\n\r\n    /**\r\n     * 计算0权重关节数量\r\n     * @param vertex 顶点数据\r\n     * @param weights 关节权重数组\r\n     * @return\r\n     */\r\n    private countZeroWeightJoints(vertex: MD5_Vertex, weights: MD5_Weight[]): number\r\n    {\r\n        const start = vertex.startWeight;\r\n        const end = vertex.startWeight + vertex.countWeight;\r\n        let count = 0;\r\n        let weight: number;\r\n\r\n        for (let i = start; i < end; ++i)\r\n        {\r\n            weight = weights[i].bias;\r\n            if (weight === 0)\r\n            { ++count; }\r\n        }\r\n\r\n        return count;\r\n    }\r\n\r\n    private createSkeleton(joints: MD5_Joint[])\r\n    {\r\n        const skeletonjoints: SkeletonJoint[] = [];\r\n        for (let i = 0; i < joints.length; i++)\r\n        {\r\n            const skeletonJoint = this.createSkeletonJoint(joints[i]);\r\n            skeletonjoints.push(skeletonJoint);\r\n        }\r\n\r\n        return skeletonjoints;\r\n    }\r\n\r\n    private createSkeletonJoint(joint: MD5_Joint)\r\n    {\r\n        const skeletonJoint = new SkeletonJoint();\r\n        skeletonJoint.name = joint.name;\r\n        skeletonJoint.parentIndex = joint.parentIndex;\r\n        const position = joint.position;\r\n        const rotation = joint.rotation;\r\n        const quat = new Quaternion(rotation[0], -rotation[1], -rotation[2]);\r\n        // quat supposed to be unit length\r\n        const t = 1 - quat.x * quat.x - quat.y * quat.y - quat.z * quat.z;\r\n        quat.w = t < 0 ? 0 : -Math.sqrt(t);\r\n        //\r\n        const matrix = quat.toMatrix();\r\n        matrix.appendTranslation(-position[0], position[1], position[2]);\r\n        //\r\n        skeletonJoint.matrix = matrix;\r\n\r\n        return skeletonJoint;\r\n    }\r\n\r\n    private createGeometry(md5Mesh: MD5_Mesh, skeleton: SkeletonComponent, skinSkeleton: SkinSkeletonTemp)\r\n    {\r\n        const vertexData = md5Mesh.verts;\r\n        const weights = md5Mesh.weights;\r\n        const indices = md5Mesh.tris;\r\n\r\n        const geometry = new CustomGeometry();\r\n\r\n        const len = vertexData.length;\r\n        let vertex: MD5_Vertex;\r\n        let weight: MD5_Weight;\r\n        let bindPose: Matrix4x4;\r\n        let pos: Vector3;\r\n        // uv数据\r\n        const uvs: number[] = [];\r\n        uvs.length = len * 2;\r\n        // 顶点位置数据\r\n        const vertices: number[] = [];\r\n        vertices.length = len * 3;\r\n        // 关节索引数据\r\n        const jointIndices0: number[] = [];\r\n        jointIndices0.length = len * 4;\r\n        const jointIndices1: number[] = [];\r\n        jointIndices1.length = len * 4;\r\n        // 关节权重数据\r\n        const jointWeights0: number[] = [];\r\n        jointWeights0.length = len * 4;\r\n        const jointWeights1: number[] = [];\r\n        jointWeights1.length = len * 4;\r\n\r\n        for (let i = 0; i < len; ++i)\r\n        {\r\n            vertex = vertexData[i];\r\n            vertices[i * 3] = vertices[i * 3 + 1] = vertices[i * 3 + 2] = 0;\r\n\r\n            /**\r\n             * 参考 http://blog.csdn.net/summerhust/article/details/17421213\r\n             * VertexPos = (MJ-0 * weight[index0].pos * weight[index0].bias) + ... + (MJ-N * weight[indexN].pos * weight[indexN].bias)\r\n             * 变量对应  MJ-N -> bindPose; 第J个关节的变换矩阵\r\n             * weight[indexN].pos -> weight.pos;\r\n             * weight[indexN].bias -> weight.bias;\r\n             */\r\n            const weightJoints: number[] = [];\r\n            const weightBiass: number[] = [];\r\n            for (let j = 0; j < 8; ++j)\r\n            {\r\n                weightJoints[j] = 0;\r\n                weightBiass[j] = 0;\r\n                if (j < vertex.countWeight)\r\n                {\r\n                    weight = weights[vertex.startWeight + j];\r\n                    if (weight.bias > 0)\r\n                    {\r\n                        bindPose = skeleton.joints[weight.joint].matrix;\r\n                        pos = bindPose.transformPoint3(new Vector3(-weight.pos[0], weight.pos[1], weight.pos[2]));\r\n                        vertices[i * 3] += pos.x * weight.bias;\r\n                        vertices[i * 3 + 1] += pos.y * weight.bias;\r\n                        vertices[i * 3 + 2] += pos.z * weight.bias;\r\n\r\n                        weightJoints[j] = weight.joint;\r\n                        weightBiass[j] = weight.bias;\r\n                    }\r\n                }\r\n            }\r\n\r\n            jointIndices0[i * 4] = weightJoints[0];\r\n            jointIndices0[i * 4 + 1] = weightJoints[1];\r\n            jointIndices0[i * 4 + 2] = weightJoints[2];\r\n            jointIndices0[i * 4 + 3] = weightJoints[3];\r\n            jointIndices1[i * 4] = weightJoints[4];\r\n            jointIndices1[i * 4 + 1] = weightJoints[5];\r\n            jointIndices1[i * 4 + 2] = weightJoints[6];\r\n            jointIndices1[i * 4 + 3] = weightJoints[7];\r\n            //\r\n            jointWeights0[i * 4] = weightBiass[0];\r\n            jointWeights0[i * 4 + 1] = weightBiass[1];\r\n            jointWeights0[i * 4 + 2] = weightBiass[2];\r\n            jointWeights0[i * 4 + 3] = weightBiass[3];\r\n            jointWeights1[i * 4] = weightBiass[4];\r\n            jointWeights1[i * 4 + 1] = weightBiass[5];\r\n            jointWeights1[i * 4 + 2] = weightBiass[6];\r\n            jointWeights1[i * 4 + 3] = weightBiass[7];\r\n\r\n            uvs[vertex.index * 2] = vertex.u;\r\n            uvs[vertex.index * 2 + 1] = vertex.v;\r\n        }\r\n\r\n        skinSkeleton.resetJointIndices(jointIndices0, skeleton);\r\n        skinSkeleton.resetJointIndices(jointIndices1, skeleton);\r\n\r\n        // 更新索引数据\r\n        geometry.indices = indices;\r\n        // 更新顶点坐标与uv数据\r\n        geometry.positions = vertices;\r\n        geometry.uvs = uvs;\r\n        // 更新关节索引与权重索引\r\n        geometry.skinIndices = jointIndices0;\r\n        geometry.skinWeights = jointWeights0;\r\n        geometry.skinIndices1 = jointIndices1;\r\n        geometry.skinWeights1 = jointWeights1;\r\n\r\n        return geometry;\r\n    }\r\n}\r\n\r\n/**\r\n * MD5模型转换器\r\n */\r\nexport const md5MeshConverter = new MD5MeshConverter();\r\n","import { Material } from '@feng3d/core';\r\nimport { globalEmitter } from '@feng3d/event';\r\nimport { serialization } from '@feng3d/serialization';\r\nimport { Mtl_Mtl } from '../parsers/MTLParser';\r\n\r\n/**\r\n * OBJ模型MTL材质转换器\r\n */\r\nexport class MTLConverter\r\n{\r\n    /**\r\n     * OBJ模型MTL材质原始数据转换引擎中材质对象\r\n     * @param mtl MTL材质原始数据\r\n     */\r\n    convert(mtl: Mtl_Mtl, completed?: (err: Error, materials: { [name: string]: Material; }) => void)\r\n    {\r\n        const materials: { [name: string]: Material } = {};\r\n        for (const name in mtl)\r\n        {\r\n            const materialInfo = mtl[name];\r\n            const material = materials[name] = serialization.setValue(new Material(), {\r\n                name: materialInfo.name,\r\n                uniforms: {\r\n                    u_diffuse: { r: materialInfo.kd[0], g: materialInfo.kd[1], b: materialInfo.kd[2] },\r\n                    u_specular: { r: materialInfo.ks[0], g: materialInfo.ks[1], b: materialInfo.ks[2] },\r\n                },\r\n            });\r\n            globalEmitter.emit('asset.parsed', material);\r\n        }\r\n        completed && completed(null, materials);\r\n    }\r\n}\r\n\r\n/**\r\n * OBJ模型MTL材质转换器\r\n */\r\nexport const mtlConverter = new MTLConverter();\r\n","/**\r\n * MD5动画解析器\r\n */\r\nexport class MD5AnimParser\r\n{\r\n    /**\r\n     * 解析\r\n     * @param context\r\n     */\r\n    parse(context: string)\r\n    {\r\n        const md5AnimData = <MD5AnimData>{};\r\n        const lines = context.split('\\n').reverse();\r\n        let line: string;\r\n        do\r\n        {\r\n            line = lines.pop();\r\n            line && parserLine(line, md5AnimData);\r\n        } while (line);\r\n\r\n        return md5AnimData;\r\n    }\r\n}\r\n\r\n/**\r\n * MD5动画解析器\r\n */\r\nexport const md5AnimParser = new MD5AnimParser();\r\n\r\n/**\r\n * 帧数据\r\n */\r\nexport type MD5_Frame = {\r\n    index: number;\r\n    components: number[];\r\n};\r\n\r\n/**\r\n * 基础帧数据\r\n */\r\nexport type MD5_BaseFrame = {\r\n    /** 位置 */\r\n    position: number[];\r\n    /** 方向 */\r\n    orientation: number[];\r\n};\r\n\r\n/**\r\n * 包围盒信息\r\n */\r\nexport type MD5_Bounds = {\r\n    /** 最小坐标 */\r\n    min: number[];\r\n    /** 最大坐标 */\r\n    max: number[];\r\n};\r\n\r\n/**\r\n * 层级数据\r\n */\r\nexport type MD5_HierarchyData = {\r\n    /** Joint 名字 */\r\n    name: string;\r\n    /** 父结点序号 */\r\n    parentIndex: number;\r\n    /** flag */\r\n    flags: number;\r\n    /** 影响的帧数据起始索引 */\r\n    startIndex: number;\r\n};\r\n\r\nexport type MD5AnimData = {\r\n    name?: string;\r\n    MD5Version: number;\r\n    commandline: string;\r\n    numFrames: number;\r\n    numJoints: number;\r\n    frameRate: number;\r\n    numAnimatedComponents: number;\r\n    hierarchy: MD5_HierarchyData[];\r\n    bounds: MD5_Bounds[];\r\n    baseframe: MD5_BaseFrame[];\r\n    frame: MD5_Frame[];\r\n};\r\n\r\nconst MD5VersionReg = /MD5Version\\s+(\\d+)/;\r\nconst commandlineReg = /commandline\\s+\"([\\w\\s/.-]+)\"/;\r\nconst numFramesReg = /numFrames\\s+(\\d+)/;\r\nconst numJointsReg = /numJoints\\s+(\\d+)/;\r\nconst frameRateReg = /frameRate\\s+(\\d+)/;\r\nconst numAnimatedComponentsReg = /numAnimatedComponents\\s+(\\d+)/;\r\nconst hierarchyStartReg = /hierarchy\\s+{/;\r\nconst hierarchyReg = /\"(\\w+)\"\\s+([\\d-]+)\\s+(\\d+)\\s+(\\d+)(\\s+\\/\\/(\\s+\\w+)?(\\s+\\([\\s\\w]+\\))?)?/;\r\nconst endBlockReg = /}/;\r\nconst boundsStartReg = /bounds\\s+{/;\r\n// 2组3个number\r\nconst number32Reg = /\\(\\s+([\\d.-]+)\\s+([\\d.-]+)\\s+([\\d.-]+)\\s+\\)\\s+\\(\\s+([\\d.-]+)\\s+([\\d.-]+)\\s+([\\d.-]+)\\s+\\)/;\r\nconst baseframeStartReg = /baseframe\\s+{/;\r\nconst frameStartReg = /frame\\s+(\\d+)\\s+{/;\r\nconst numbersReg = /(-?[\\d.]+)(\\s+-?[\\d.]+){0,}/;\r\n\r\n/**\r\n * 状态\r\n */\r\nenum State\r\n{\r\n    hierarchy,\r\n    bounds,\r\n    baseframe,\r\n    frame\r\n}\r\n\r\n/** 当前处于状态 */\r\nconst states: State[] = [];\r\nlet currentFrame: MD5_Frame | null;\r\n\r\nfunction parserLine(line: string, md5AnimData: MD5AnimData)\r\n{\r\n    if (!line)\r\n    {\r\n        return;\r\n    }\r\n    line = line.trim();\r\n    if (!line.length)\r\n    {\r\n        return;\r\n    }\r\n\r\n    let result: RegExpExecArray | null;\r\n    if ((result = MD5VersionReg.exec(line)) && result[0] === line)\r\n    {\r\n        md5AnimData.MD5Version = parseInt(result[1], 10);\r\n    }\r\n    else if ((result = commandlineReg.exec(line)) && result[0] === line)\r\n    {\r\n        md5AnimData.commandline = result[1];\r\n    }\r\n    else if ((result = numFramesReg.exec(line)) && result[0] === line)\r\n    {\r\n        md5AnimData.numFrames = parseInt(result[1], 10);\r\n    }\r\n    else if ((result = numJointsReg.exec(line)) && result[0] === line)\r\n    {\r\n        md5AnimData.numJoints = parseInt(result[1], 10);\r\n    }\r\n    else if ((result = frameRateReg.exec(line)) && result[0] === line)\r\n    {\r\n        md5AnimData.frameRate = parseInt(result[1], 10);\r\n    }\r\n    else if ((result = numAnimatedComponentsReg.exec(line)) && result[0] === line)\r\n    {\r\n        md5AnimData.numAnimatedComponents = parseInt(result[1], 10);\r\n    }\r\n    else if ((result = hierarchyStartReg.exec(line)) && result[0] === line)\r\n    {\r\n        md5AnimData.hierarchy = [];\r\n        states.push(State.hierarchy);\r\n    }\r\n    else if ((result = hierarchyReg.exec(line)) && result[0] === line)\r\n    {\r\n        switch (states[states.length - 1])\r\n        {\r\n            case State.hierarchy:\r\n                md5AnimData.hierarchy.push({\r\n                    name: result[1], parentIndex: parseInt(result[2], 10),\r\n                    flags: parseInt(result[3], 10), startIndex: parseInt(result[4], 10)\r\n                });\r\n                break;\r\n            default:\r\n                throw new Error('没有对应的数据处理');\r\n        }\r\n    }\r\n    else if ((result = endBlockReg.exec(line)) && result[0] === line)\r\n    {\r\n        const state = states.pop();\r\n        if (state === State.frame)\r\n        {\r\n            if (currentFrame && currentFrame.components.length !== md5AnimData.numAnimatedComponents)\r\n            {\r\n                throw new Error('frame中数据不对');\r\n            }\r\n            currentFrame = null;\r\n        }\r\n    }\r\n    else if ((result = boundsStartReg.exec(line)) && result[0] === line)\r\n    {\r\n        md5AnimData.bounds = [];\r\n        states.push(State.bounds);\r\n    }\r\n    else if ((result = baseframeStartReg.exec(line)) && result[0] === line)\r\n    {\r\n        md5AnimData.baseframe = [];\r\n        states.push(State.baseframe);\r\n    }\r\n    else if ((result = number32Reg.exec(line)) && result[0] === line)\r\n    {\r\n        switch (states[states.length - 1])\r\n        {\r\n            case State.bounds:\r\n                md5AnimData.bounds.push({ min: [parseFloat(result[1]), parseFloat(result[2]), parseFloat(result[3])], max: [parseFloat(result[4]), parseFloat(result[5]), parseFloat(result[6])] });\r\n                break;\r\n            case State.baseframe:\r\n                md5AnimData.baseframe.push({ position: [parseFloat(result[1]), parseFloat(result[2]), parseFloat(result[3])], orientation: [parseFloat(result[4]), parseFloat(result[5]), parseFloat(result[6])] });\r\n                break;\r\n            default:\r\n                throw new Error('没有对应的数据处理');\r\n        }\r\n    }\r\n    else if ((result = frameStartReg.exec(line)) && result[0] === line)\r\n    {\r\n        if (!md5AnimData.frame)\r\n        {\r\n            md5AnimData.frame = [];\r\n        }\r\n        currentFrame = { index: parseInt(result[1], 10), components: [] };\r\n        md5AnimData.frame.push(currentFrame);\r\n        states.push(State.frame);\r\n    }\r\n    else if ((result = numbersReg.exec(line)) && result[0] === line)\r\n    {\r\n        switch (states[states.length - 1])\r\n        {\r\n            case State.frame:\r\n                if (currentFrame)\r\n                {\r\n                    const numbers = line.split(' ');\r\n                    for (let i = 0; i < numbers.length; i++)\r\n                    {\r\n                        currentFrame.components.push(parseFloat(numbers[i]));\r\n                    }\r\n                }\r\n                break;\r\n            default:\r\n                throw new Error('没有对应的数据处理');\r\n        }\r\n    }\r\n    else\r\n    {\r\n        throw new Error(`无法解析${line}`);\r\n    }\r\n}\r\n","/**\r\n * MD5模型解析器\r\n */\r\nexport class MD5MeshParser\r\n{\r\n    /**\r\n     * 解析\r\n     * @param context\r\n     */\r\n    parse(context: string)\r\n    {\r\n        //\r\n        const md5MeshData = <MD5MeshData>{};\r\n        const lines = context.split('\\n');\r\n        for (let i = 0; i < lines.length; i++)\r\n        {\r\n            parserLine(lines[i], md5MeshData);\r\n        }\r\n\r\n        return md5MeshData;\r\n    }\r\n}\r\n/**\r\n * MD5模型解析器\r\n */\r\nexport const md5MeshParser = new MD5MeshParser();\r\n\r\n/**\r\n * 关节权重数据\r\n */\r\nexport type MD5_Weight = {\r\n    /** weight 序号 */\r\n    index: number;\r\n    /** 对应的Joint的序号 */\r\n    joint: number;\r\n    /** 作用比例 */\r\n    bias: number;\r\n    /** 位置值 */\r\n    pos: number[];\r\n};\r\n\r\nexport type MD5_Vertex = {\r\n    /** 顶点索引 */\r\n    index: number;\r\n    /** 纹理坐标u */\r\n    u: number;\r\n    /** 纹理坐标v */\r\n    v: number;\r\n    /** weight的起始序号 */\r\n    startWeight: number;\r\n    /** weight总数 */\r\n    countWeight: number;\r\n};\r\n\r\nexport type MD5_Mesh = {\r\n    shader: string;\r\n    numverts: number;\r\n    verts: MD5_Vertex[];\r\n    numtris: number;\r\n    tris: number[];\r\n    numweights: number;\r\n    weights: MD5_Weight[];\r\n};\r\n\r\nexport type MD5_Joint = {\r\n    name: string;\r\n    parentIndex: number;\r\n    position: number[];\r\n    /** 旋转数据 */\r\n    rotation: number[];\r\n};\r\n\r\nexport type MD5MeshData = {\r\n    name?: string;\r\n    MD5Version: number;\r\n    commandline: string;\r\n    numJoints: number;\r\n    numMeshes: number;\r\n    joints: MD5_Joint[];\r\n    meshs: MD5_Mesh[];\r\n};\r\n\r\nconst MD5VersionReg = /MD5Version\\s+(\\d+)/;\r\nconst commandlineReg = /commandline\\s+\"([\\w\\s/.-]+)\"/;\r\nconst numJointsReg = /numJoints\\s+(\\d+)/;\r\nconst numMeshesReg = /numMeshes\\s+(\\d+)/;\r\nconst jointsStartReg = /joints\\s+{/;\r\nconst jointsReg = /\"(\\w+)\"\\s+([-\\d]+)\\s+\\(\\s+([\\d.-]+)\\s+([\\d.-]+)\\s+([\\d.-]+)\\s+\\)\\s+\\(\\s+([\\d.-]+)\\s+([\\d.-]+)\\s+([\\d.-]+)\\s+\\)(\\s+\\/\\/(\\s+\\w+)?)?/;\r\nconst endBlockReg = /}/;\r\nconst meshStartReg = /mesh\\s+{/;\r\nconst annotationReg = /\\/\\/[\\s\\w:]+/;\r\nconst shaderReg = /shader\\s+\"([\\w\\/]+)\"/;\r\nconst numvertsReg = /numverts\\s+(\\d+)/;\r\nconst vertReg = /vert\\s+(\\d+)\\s+\\(\\s+([\\d.]+)\\s+([\\d.]+)\\s+\\)\\s+(\\d+)\\s+(\\d+)/;\r\nconst numtrisReg = /numtris\\s+(\\d+)/;\r\nconst triReg = /tri\\s+(\\d+)\\s+(\\d+)\\s+(\\d+)\\s+(\\d+)/;\r\nconst numweightsReg = /numweights\\s+(\\d+)/;\r\nconst weightReg = /weight\\s+(\\d+)\\s+(\\d+)\\s+([\\d.]+)\\s+\\(\\s+([\\d.-]+)\\s+([\\d.-]+)\\s+([\\d.-]+)\\s+\\)/;\r\n\r\n/**\r\n * 状态\r\n */\r\nenum State\r\n{\r\n    /** 读取关节 */\r\n    joints,\r\n    mesh\r\n}\r\n\r\n/** 当前处于状态 */\r\nconst states: State[] = [];\r\nlet currentMesh: MD5_Mesh;\r\n\r\nfunction parserLine(line: string, md5MeshData: MD5MeshData)\r\n{\r\n    if (!line)\r\n    { return; }\r\n    line = line.trim();\r\n    if (!line.length)\r\n    { return; }\r\n\r\n    let result: RegExpExecArray | null;\r\n    if ((result = MD5VersionReg.exec(line)) && result[0] === line)\r\n    {\r\n        md5MeshData.MD5Version = parseInt(result[1], 10);\r\n    }\r\n    else if ((result = commandlineReg.exec(line)) && result[0] === line)\r\n    {\r\n        md5MeshData.commandline = result[1];\r\n    }\r\n    else if ((result = numJointsReg.exec(line)) && result[0] === line)\r\n    {\r\n        md5MeshData.numJoints = parseInt(result[1], 10);\r\n    }\r\n    else if ((result = numMeshesReg.exec(line)) && result[0] === line)\r\n    {\r\n        md5MeshData.numMeshes = parseInt(result[1], 10);\r\n    }\r\n    else if ((result = jointsStartReg.exec(line)) && result[0] === line)\r\n    {\r\n        states.push(State.joints);\r\n        md5MeshData.joints = [];\r\n    }\r\n    else if ((result = jointsReg.exec(line)) && result[0] === line)\r\n    {\r\n        md5MeshData.joints.push({\r\n            name: result[1], parentIndex: parseInt(result[2], 10),\r\n            position: [parseFloat(result[3]), parseFloat(result[4]), parseFloat(result[5])],\r\n            rotation: [parseFloat(result[6]), parseFloat(result[7]), parseFloat(result[8])]\r\n        });\r\n    }\r\n    else if ((result = endBlockReg.exec(line)) && result[0] === line)\r\n    {\r\n        const exitState = states.pop();\r\n        if (exitState === State.mesh)\r\n        {\r\n            currentMesh = <any>null;\r\n        }\r\n    }\r\n    else if ((result = meshStartReg.exec(line)) && result[0] === line)\r\n    {\r\n        states.push(State.mesh);\r\n        if (!md5MeshData.meshs)\r\n        {\r\n            md5MeshData.meshs = [];\r\n        }\r\n        currentMesh = <any>{};\r\n        md5MeshData.meshs.push(currentMesh);\r\n    }\r\n    else if ((result = annotationReg.exec(line)) && result[0] === line)\r\n    // eslint-disable-next-line no-empty\r\n    {\r\n\r\n    }\r\n    else if ((result = shaderReg.exec(line)) && result[0] === line)\r\n    {\r\n        currentMesh.shader = result[1];\r\n    }\r\n    else if ((result = numvertsReg.exec(line)) && result[0] === line)\r\n    {\r\n        currentMesh.numverts = parseInt(result[1], 10);\r\n        currentMesh.verts = [];\r\n    }\r\n    else if ((result = vertReg.exec(line)) && result[0] === line)\r\n    {\r\n        currentMesh.verts.push({\r\n            index: parseFloat(result[1]), u: parseFloat(result[2]), v: parseFloat(result[3]),\r\n            startWeight: parseFloat(result[4]), countWeight: parseFloat(result[5])\r\n        });\r\n    }\r\n    else if ((result = numtrisReg.exec(line)) && result[0] === line)\r\n    {\r\n        currentMesh.numtris = parseInt(result[1], 10);\r\n        currentMesh.tris = [];\r\n    }\r\n    else if ((result = triReg.exec(line)) && result[0] === line)\r\n    {\r\n        const index = parseInt(result[1], 10) * 3;\r\n        currentMesh.tris[index] = parseInt(result[2], 10);\r\n        currentMesh.tris[index + 1] = parseInt(result[3], 10);\r\n        currentMesh.tris[index + 2] = parseInt(result[4], 10);\r\n    }\r\n    else if ((result = numweightsReg.exec(line)) && result[0] === line)\r\n    {\r\n        currentMesh.numweights = parseInt(result[1], 10);\r\n        currentMesh.weights = [];\r\n    }\r\n    else if ((result = weightReg.exec(line)) && result[0] === line)\r\n    {\r\n        currentMesh.weights.push({\r\n            index: parseInt(result[1], 10), joint: parseInt(result[2], 10), bias: parseFloat(result[3]),\r\n            pos: [parseFloat(result[4]), parseFloat(result[5]), parseFloat(result[6])]\r\n        });\r\n    }\r\n    else\r\n    {\r\n        throw new Error(`无法解析${line}`);\r\n    }\r\n}\r\n","import { AnimationClip, GameObject } from '@feng3d/core';\r\nimport { FS, pathUtils } from '@feng3d/filesystem';\r\nimport { md5AnimConverter } from '../converters/MD5AnimConverter';\r\nimport { md5MeshConverter } from '../converters/MD5MeshConverter';\r\nimport { md5AnimParser } from '../parsers/MD5AnimParser';\r\nimport { md5MeshParser } from '../parsers/MD5MeshParser';\r\n\r\n/**\r\n * MD5模型加载类\r\n */\r\nexport class MD5Loader\r\n{\r\n    /**\r\n     * 加载资源\r\n     * @param url   路径\r\n     * @param completed 加载完成回调\r\n     */\r\n    load(url: string, completed?: (gameObject: GameObject) => void)\r\n    {\r\n        FS.fs.readString(url, (_err, content) =>\r\n        {\r\n            const md5MeshData = md5MeshParser.parse(content);\r\n            md5MeshData.name = pathUtils.getName(url);\r\n            md5MeshConverter.convert(md5MeshData, completed);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 加载MD5模型动画\r\n     * @param url MD5模型动画资源路径\r\n     * @param completed 加载完成回调\r\n     */\r\n    loadAnim(url: string, completed?: (animationClip: AnimationClip) => void)\r\n    {\r\n        FS.fs.readString(url, (_err, content) =>\r\n        {\r\n            const md5AnimData = md5AnimParser.parse(content);\r\n            md5AnimData.name = pathUtils.getName(url);\r\n            md5AnimConverter.convert(md5AnimData, completed);\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * MD5模型加载类\r\n */\r\nexport const md5Loader = new MD5Loader();\r\n\r\n","import { Material as Feng3dMaterial, AnimationClip, PropertyClip, PropertyClipPath, PropertyClipPathItemType } from '@feng3d/core';\r\nimport { Vector3, Quaternion, Matrix4x4 } from '@feng3d/math';\r\n\r\n/**\r\n * 透明度动画\r\n */\r\nexport class AnimAlpha\r\n{\r\n}\r\n\r\n/**\r\n * 全局动作信息\r\n */\r\nexport class AnimInfo\r\n{\r\n\t/** 动作名称 */\r\n\tname: string;\r\n\t/** 动作间隔 */\r\n\tinterval: Interval;\r\n\t/** 最小范围 */\r\n\tMinimumExtent: Vector3;\r\n\t/** 最大范围 */\r\n\tMaximumExtent: Vector3;\r\n\t/** 半径范围 */\r\n\tBoundsRadius: number;\r\n\t/** 发生频率 */\r\n\tRarity: number;\r\n\t/** 是否循环 */\r\n\tloop = true;\r\n\t/** 移动速度 */\r\n\tMoveSpeed: number;\r\n}\r\n\r\n/**\r\n * 几何体动作信息\r\n */\r\nexport class AnimInfo1\r\n{\r\n\t/** 最小范围 */\r\n\tMinimumExtent: Vector3;\r\n\t/** 最大范围 */\r\n\tMaximumExtent: Vector3;\r\n\t/** 半径范围 */\r\n\tBoundsRadius: number;\r\n}\r\n\r\n/**\r\n * 骨骼的角度信息\r\n */\r\nexport class BoneRotation\r\n{\r\n\t/** 类型 */\r\n\ttype: string;\r\n\t/** */\r\n\tGlobalSeqId: number;\r\n\r\n\trotations: Rotation[] = [];\r\n\r\n\tgetRotationItem(rotation: Rotation)\r\n\t{\r\n\t\tconst quaternion = new Quaternion();\r\n\t\tif (this.type === 'DontInterp')\r\n\t\t{\r\n\t\t\tquaternion.fromEuler(rotation.value.x, rotation.value.y, rotation.value.z);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tquaternion.copy(rotation.value);\r\n\t\t}\r\n\r\n\t\treturn quaternion;\r\n\t}\r\n\r\n\tgetRotation(keyFrameTime: number): Quaternion\r\n\t{\r\n\t\tconst rotationQuaternion = new Quaternion();\r\n\t\tif (this.rotations.length === 0 || keyFrameTime < this.rotations[0].time || keyFrameTime > this.rotations[this.rotations.length - 1].time)\r\n\t\t{ return new Quaternion(); }\r\n\r\n\t\tlet key1: Rotation = this.rotations[0];\r\n\t\tlet key2: Rotation = this.rotations[0];\r\n\r\n\t\tfor (let i = 0; i < this.rotations.length; i++)\r\n\t\t{\r\n\t\t\tkey2 = this.rotations[i];\r\n\t\t\tif (key2.time > keyFrameTime)\r\n\t\t\t{\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tkey1 = key2;\r\n\t\t}\r\n\r\n\t\tif (key1 === key2)\r\n\t\t{\r\n\t\t\trotationQuaternion.copy(key1.value);\r\n\r\n\t\t\treturn rotationQuaternion;\r\n\t\t}\r\n\r\n\t\tconst Factor = (keyFrameTime - key1.time) / (key2.time - key1.time);\r\n\t\t// const InverseFactor = 1.0 - Factor;\r\n\r\n\t\t// let tempVec: Quaternion;\r\n\t\t// let Factor1: number;\r\n\t\t// let Factor2: number;\r\n\t\t// let Factor3: number;\r\n\t\t// let Factor4: number;\r\n\t\t// let FactorTimesTwo: number;\r\n\t\t// let InverseFactorTimesTwo: number;\r\n\r\n\t\t// let q: Quaternion;\r\n\t\tlet q1: Quaternion;\r\n\t\tlet q2: Quaternion;\r\n\r\n\t\tswitch (this.type)\r\n\t\t{\r\n\t\t\tcase 'DontInterp':\r\n\t\t\t\trotationQuaternion.fromEuler(key1.value.x, key1.value.y, key1.value.z);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Linear':\r\n\t\t\t\tq1 = key1.value.clone();\r\n\t\t\t\tq2 = key2.value.clone();\r\n\r\n\t\t\t\tq1.slerpTo(q2, Factor, rotationQuaternion);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Hermite':\r\n\t\t\tcase 'Bezier':\r\n\t\t\t\tq1 = key1.value.clone();\r\n\t\t\t\tq2 = key2.value.clone();\r\n\r\n\t\t\t\tq1.slerpTo(q2, Factor, rotationQuaternion);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn rotationQuaternion;\r\n\t}\r\n}\r\n\r\n/**\r\n * 骨骼信息(包含骨骼，helper等其他对象)\r\n */\r\nexport class BoneObject\r\n{\r\n\t/** 骨骼类型 */\r\n\ttype: string;\r\n\t/** 骨骼名称 */\r\n\tname: string;\r\n\t/** 对象编号 */\r\n\tObjectId: number;\r\n\t/** 父对象 */\r\n\tParent = -1;\r\n\t/** 几何体编号 */\r\n\tGeosetId: string;\r\n\t/** 几何体动画 */\r\n\tGeosetAnimId: string;\r\n\t/** 是否为广告牌 */\r\n\tBillboarded: boolean;\r\n\t/** 骨骼位移动画 */\r\n\tTranslation = new BoneTranslation();\r\n\t/** 骨骼缩放动画 */\r\n\tScaling = new BoneScaling();\r\n\t/** 骨骼角度动画 */\r\n\tRotation = new BoneRotation();\r\n\t/** 中心位置 */\r\n\tpivotPoint: Vector3;\r\n\r\n\t/** 当前对象变换矩阵 */\r\n\ttransformation = new Matrix4x4();\r\n\r\n\t/** 当前全局变换矩阵 */\r\n\tglobalTransformation = new Matrix4x4();\r\n\r\n\tcalculateTransformation(keyFrameTime: number): void\r\n\t{\r\n\t\t// const pScalingCenter = this.pivotPoint;\r\n\t\tconst pScaling = this.Scaling.getScaling(keyFrameTime);\r\n\t\tconst pRotation = this.Rotation.getRotation(keyFrameTime);\r\n\t\tconst pTranslation = this.Translation.getTranslation(keyFrameTime);\r\n\r\n\t\tconst matrix = this.transformation;\r\n\t\tmatrix.appendScale(pScaling.x, pScaling.y, pScaling.z).append(pRotation.toMatrix(new Matrix4x4()));\r\n\t\t// 设置旋转缩放中心\r\n\t\tmatrix.prependTranslation(-this.pivotPoint.x, -this.pivotPoint.y, -this.pivotPoint.z);\r\n\t\tmatrix.appendTranslation(this.pivotPoint.x, this.pivotPoint.y, this.pivotPoint.z);\r\n\t\t// 平移\r\n\t\tmatrix.appendTranslation(pTranslation.x, pTranslation.y, pTranslation.z);\r\n\t\t//\r\n\t}\r\n\r\n\tbuildAnimationclip(animationclip: AnimationClip, __chache__: { [key: string]: PropertyClip }, start: number, end: number)\r\n\t{\r\n\t\tconst path: PropertyClipPath = [\r\n\t\t\t[PropertyClipPathItemType.GameObject, this.name],\r\n\t\t\t[PropertyClipPathItemType.Component, 'Transform'],\r\n\t\t];\r\n\r\n\t\tif (this.Scaling.scalings.length > 0)\r\n\t\t{\r\n\t\t\tconst scalings = this.Scaling.scalings;\r\n\t\t\tfor (let i = 0, n = scalings.length; i < n; i++)\r\n\t\t\t{\r\n\t\t\t\tconst scaling = scalings[i];\r\n\t\t\t\tif (start <= scaling.time && scaling.time <= end)\r\n\t\t\t\t{\r\n\t\t\t\t\tsetPropertyClipFrame(path, 'scale', scaling.time - start, scaling.value.toArray(), 'Vector3');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.Translation.translations.length > 0)\r\n\t\t{\r\n\t\t\tconst translations = this.Translation.translations;\r\n\t\t\tfor (let i = 0, n = translations.length; i < n; i++)\r\n\t\t\t{\r\n\t\t\t\tconst translation = translations[i];\r\n\t\t\t\tif (start <= translation.time && translation.time <= end)\r\n\t\t\t\t{\r\n\t\t\t\t\tsetPropertyClipFrame(path, 'position', translation.time - start, translation.value.addTo(this.pivotPoint).toArray(), 'Vector3');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.Rotation.rotations.length > 0)\r\n\t\t{\r\n\t\t\tconst rotations = this.Rotation.rotations;\r\n\t\t\tfor (let i = 0, n = rotations.length; i < n; i++)\r\n\t\t\t{\r\n\t\t\t\tconst rotation = rotations[i];\r\n\t\t\t\tif (start <= rotation.time && rotation.time <= end)\r\n\t\t\t\t{\r\n\t\t\t\t\tsetPropertyClipFrame(path, 'orientation', rotation.time - start, this.Rotation.getRotationItem(rotation).toArray(), 'Quaternion');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction setPropertyClipFrame(path: PropertyClipPath, propertyName: string, time: number, propertyValue: number[], type: string)\r\n\t\t{\r\n\t\t\tconst propertyClip = getPropertyClip(path, propertyName);\r\n\t\t\tpropertyClip.type = <any>type;\r\n\t\t\tpropertyClip.propertyValues.push([time, propertyValue]);\r\n\t\t}\r\n\r\n\t\tfunction getPropertyClip(path: PropertyClipPath, propertyName: string)\r\n\t\t{\r\n\t\t\tconst key = path.join('-') + propertyName;\r\n\t\t\tif (__chache__[key])\r\n\t\t\t{ return __chache__[key]; }\r\n\t\t\tif (!__chache__[key])\r\n\t\t\t{\r\n\t\t\t\tconst propertyClip = __chache__[key] = new PropertyClip();\r\n\t\t\t\tpropertyClip.path = path;\r\n\t\t\t\tpropertyClip.propertyName = propertyName;\r\n\t\t\t\tpropertyClip.propertyValues = [];\r\n\t\t\t\tanimationclip.propertyClips.push(propertyClip);\r\n\t\t\t}\r\n\r\n\t\t\treturn __chache__[key];\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getMatrix(time: number)\r\n\t{\r\n\t\tconst pScaling = this.Scaling.getScaling(time);\r\n\t\tconst pRotation = this.Rotation.getRotation(time);\r\n\t\tconst pTranslation = this.Translation.getTranslation(time);\r\n\r\n\t\tconst matrix = new Matrix4x4().appendScale(pScaling.x, pScaling.y, pScaling.z).append(pRotation.toMatrix(new Matrix4x4()));\r\n\t\t// 平移\r\n\t\tmatrix.appendTranslation(pTranslation.x + this.pivotPoint.x, pTranslation.y + this.pivotPoint.y, pTranslation.z + this.pivotPoint.z);\r\n\r\n\t\t//\r\n\t\treturn matrix;\r\n\t}\r\n}\r\n\r\n/**\r\n * 骨骼的位移信息\r\n */\r\nexport class BoneScaling\r\n{\r\n\t/** 类型 */\r\n\ttype: String;\r\n\t/**  */\r\n\tGlobalSeqId: number;\r\n\tscalings: Scaling[] = [];\r\n\r\n\tgetScaling(keyFrameTime: number): Vector3\r\n\t{\r\n\t\tconst scalingVector = new Vector3();\r\n\t\tif (this.scalings.length === 0 || keyFrameTime < this.scalings[0].time || keyFrameTime > this.scalings[this.scalings.length - 1].time)\r\n\t\t{ return new Vector3(1, 1, 1); }\r\n\r\n\t\tlet key1: Scaling = this.scalings[0];\r\n\t\tlet key2: Scaling = this.scalings[0];\r\n\r\n\t\tfor (let i = 0; i < this.scalings.length; i++)\r\n\t\t{\r\n\t\t\tkey2 = this.scalings[i];\r\n\t\t\tif (key2.time >= keyFrameTime)\r\n\t\t\t{\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tkey1 = key2;\r\n\t\t}\r\n\r\n\t\tif (key1.time === key2.time)\r\n\t\t{\r\n\t\t\tscalingVector.copy(key1.value);\r\n\r\n\t\t\treturn scalingVector;\r\n\t\t}\r\n\r\n\t\tconst Factor: number = (keyFrameTime - key1.time) / (key2.time - key1.time);\r\n\t\tconst InverseFactor: number = 1.0 - Factor;\r\n\r\n\t\tlet tempVec: Vector3;\r\n\t\tlet Factor1: number;\r\n\t\tlet Factor2: number;\r\n\t\tlet Factor3: number;\r\n\t\tlet Factor4: number;\r\n\t\tlet FactorTimesTwo: number;\r\n\t\tlet InverseFactorTimesTwo: number;\r\n\r\n\t\tswitch (this.type)\r\n\t\t{\r\n\t\t\tcase 'DontInterp':\r\n\t\t\t\tscalingVector.copy(key1.value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Linear':\r\n\t\t\t\ttempVec = key1.value.clone();\r\n\t\t\t\ttempVec.scaleNumber(InverseFactor);\r\n\t\t\t\tscalingVector.add(tempVec);\r\n\r\n\t\t\t\ttempVec = key2.value.clone();\r\n\t\t\t\ttempVec.scaleNumber(Factor);\r\n\t\t\t\tscalingVector.add(tempVec);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Hermite':\r\n\t\t\t\tFactorTimesTwo = Factor * Factor;\r\n\r\n\t\t\t\tFactor1 = FactorTimesTwo * (2.0 * Factor - 3.0) + 1;\r\n\t\t\t\tFactor2 = FactorTimesTwo * (Factor - 2.0) + Factor;\r\n\t\t\t\tFactor3 = FactorTimesTwo * (Factor - 1.0);\r\n\t\t\t\tFactor4 = FactorTimesTwo * (3.0 - 2.0 * Factor);\r\n\r\n\t\t\t\ttempVec = key1.value.clone();\r\n\t\t\t\ttempVec.scaleNumber(Factor1);\r\n\t\t\t\tscalingVector.add(tempVec);\r\n\r\n\t\t\t\ttempVec = key1.OutTan.clone();\r\n\t\t\t\ttempVec.scaleNumber(Factor2);\r\n\t\t\t\tscalingVector.add(tempVec);\r\n\r\n\t\t\t\ttempVec = key2.InTan.clone();\r\n\t\t\t\ttempVec.scaleNumber(Factor3);\r\n\t\t\t\tscalingVector.add(tempVec);\r\n\r\n\t\t\t\ttempVec = key2.value.clone();\r\n\t\t\t\ttempVec.scaleNumber(Factor4);\r\n\t\t\t\tscalingVector.add(tempVec);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'Bezier':\r\n\t\t\t\tFactorTimesTwo = Factor * Factor;\r\n\t\t\t\tInverseFactorTimesTwo = InverseFactor * InverseFactor;\r\n\r\n\t\t\t\tFactor1 = InverseFactorTimesTwo * InverseFactor;\r\n\t\t\t\tFactor2 = 3.0 * Factor * InverseFactorTimesTwo;\r\n\t\t\t\tFactor3 = 3.0 * FactorTimesTwo * InverseFactor;\r\n\t\t\t\tFactor4 = FactorTimesTwo * Factor;\r\n\r\n\t\t\t\ttempVec = key1.value.clone();\r\n\t\t\t\ttempVec.scaleNumber(Factor1);\r\n\t\t\t\tscalingVector.add(tempVec);\r\n\r\n\t\t\t\ttempVec = key1.OutTan.clone();\r\n\t\t\t\ttempVec.scaleNumber(Factor2);\r\n\t\t\t\tscalingVector.add(tempVec);\r\n\r\n\t\t\t\ttempVec = key2.InTan.clone();\r\n\t\t\t\ttempVec.scaleNumber(Factor3);\r\n\t\t\t\tscalingVector.add(tempVec);\r\n\r\n\t\t\t\ttempVec = key2.value.clone();\r\n\t\t\t\ttempVec.scaleNumber(Factor4);\r\n\t\t\t\tscalingVector.add(tempVec);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn scalingVector;\r\n\t}\r\n}\r\n\r\n/**\r\n * 骨骼的位移信息\r\n */\r\nexport class BoneTranslation\r\n{\r\n\t/** 类型 */\r\n\ttype: string;\r\n\t/**  */\r\n\tGlobalSeqId: number;\r\n\ttranslations: Translation[] = [];\r\n\r\n\tgetTranslation(keyFrameTime: number): Vector3\r\n\t{\r\n\t\tconst TranslationVector = new Vector3();\r\n\t\tif (this.translations.length === 0)\r\n\t\t{ return new Vector3(); }\r\n\r\n\t\tlet key1 = this.translations[0];\r\n\t\tlet key2 = this.translations[0];\r\n\r\n\t\tfor (let i = 0; i < this.translations.length; i++)\r\n\t\t{\r\n\t\t\tkey2 = this.translations[i];\r\n\t\t\tif (key2.time > keyFrameTime)\r\n\t\t\t{\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tkey1 = key2;\r\n\t\t}\r\n\r\n\t\tif (key1 === key2)\r\n\t\t{\r\n\t\t\tTranslationVector.copy(key1.value);\r\n\r\n\t\t\treturn TranslationVector;\r\n\t\t}\r\n\r\n\t\tconst Factor: number = (keyFrameTime - key1.time) / (key2.time - key1.time);\r\n\t\tconst InverseFactor: number = 1.0 - Factor;\r\n\r\n\t\tlet tempVec: Vector3;\r\n\t\tlet Factor1: number;\r\n\t\tlet Factor2: number;\r\n\t\tlet Factor3: number;\r\n\t\tlet Factor4: number;\r\n\t\tlet FactorTimesTwo: number;\r\n\t\tlet InverseFactorTimesTwo: number;\r\n\r\n\t\tswitch (this.type)\r\n\t\t{\r\n\t\t\tcase 'DontInterp':\r\n\t\t\t\tTranslationVector.copy(key1.value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Linear':\r\n\t\t\t\ttempVec = key1.value.clone();\r\n\t\t\t\ttempVec.scaleNumber(InverseFactor);\r\n\t\t\t\tTranslationVector.add(tempVec);\r\n\r\n\t\t\t\ttempVec = key2.value.clone();\r\n\t\t\t\ttempVec.scaleNumber(Factor);\r\n\t\t\t\tTranslationVector.add(tempVec);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Hermite':\r\n\t\t\t\tFactorTimesTwo = Factor * Factor;\r\n\r\n\t\t\t\tFactor1 = FactorTimesTwo * (2.0 * Factor - 3.0) + 1;\r\n\t\t\t\tFactor2 = FactorTimesTwo * (Factor - 2.0) + Factor;\r\n\t\t\t\tFactor3 = FactorTimesTwo * (Factor - 1.0);\r\n\t\t\t\tFactor4 = FactorTimesTwo * (3.0 - 2.0 * Factor);\r\n\r\n\t\t\t\ttempVec = key1.value.clone();\r\n\t\t\t\ttempVec.scaleNumber(Factor1);\r\n\t\t\t\tTranslationVector.add(tempVec);\r\n\r\n\t\t\t\ttempVec = key1.OutTan.clone();\r\n\t\t\t\ttempVec.scaleNumber(Factor2);\r\n\t\t\t\tTranslationVector.add(tempVec);\r\n\r\n\t\t\t\ttempVec = key2.InTan.clone();\r\n\t\t\t\ttempVec.scaleNumber(Factor3);\r\n\t\t\t\tTranslationVector.add(tempVec);\r\n\r\n\t\t\t\ttempVec = key2.value.clone();\r\n\t\t\t\ttempVec.scaleNumber(Factor4);\r\n\t\t\t\tTranslationVector.add(tempVec);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'Bezier':\r\n\t\t\t\tFactorTimesTwo = Factor * Factor;\r\n\t\t\t\tInverseFactorTimesTwo = InverseFactor * InverseFactor;\r\n\r\n\t\t\t\tFactor1 = InverseFactorTimesTwo * InverseFactor;\r\n\t\t\t\tFactor2 = 3.0 * Factor * InverseFactorTimesTwo;\r\n\t\t\t\tFactor3 = 3.0 * FactorTimesTwo * InverseFactor;\r\n\t\t\t\tFactor4 = FactorTimesTwo * Factor;\r\n\r\n\t\t\t\ttempVec = key1.value.clone();\r\n\t\t\t\ttempVec.scaleNumber(Factor1);\r\n\t\t\t\tTranslationVector.add(tempVec);\r\n\r\n\t\t\t\ttempVec = key1.OutTan.clone();\r\n\t\t\t\ttempVec.scaleNumber(Factor2);\r\n\t\t\t\tTranslationVector.add(tempVec);\r\n\r\n\t\t\t\ttempVec = key2.InTan.clone();\r\n\t\t\t\ttempVec.scaleNumber(Factor3);\r\n\t\t\t\tTranslationVector.add(tempVec);\r\n\r\n\t\t\t\ttempVec = key2.value.clone();\r\n\t\t\t\ttempVec.scaleNumber(Factor4);\r\n\t\t\t\tTranslationVector.add(tempVec);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn TranslationVector;\r\n\t}\r\n}\r\n\r\n/**\r\n * 纹理\r\n */\r\nexport class FBitmap\r\n{\r\n\t/** 图片地址 */\r\n\timage: string;\r\n\t/** 可替换纹理id */\r\n\tReplaceableId: number;\r\n}\r\n\r\n/**\r\n * 几何设置\r\n */\r\nexport class Geoset\r\n{\r\n\t/** 顶点 */\r\n\tVertices: number[];\r\n\t/** 法线 */\r\n\tNormals: number[];\r\n\t/** 纹理坐标 */\r\n\tTVertices: number[];\r\n\t/** 顶点分组 */\r\n\tVertexGroup: number[];\r\n\t/** 面（索引） */\r\n\tFaces: number[];\r\n\t/** 顶点分组 */\r\n\tGroups: number[][];\r\n\t/** 最小范围 */\r\n\tMinimumExtent: Vector3;\r\n\t/** 最大范围 */\r\n\tMaximumExtent: Vector3;\r\n\t/** 半径范围 */\r\n\tBoundsRadius: number;\r\n\t/** 动作信息 */\r\n\tAnims: AnimInfo1[] = [];\r\n\t/** 材质编号 */\r\n\tMaterialID: number;\r\n\t/**  */\r\n\tSelectionGroup: number;\r\n\t/** 是否不可选 */\r\n\tUnselectable: boolean;\r\n\r\n\t/** 顶点对应的关节索引 */\r\n\tjointIndices: number[];\r\n\t/** 顶点对应的关节权重 */\r\n\tjointWeights: number[];\r\n}\r\n\r\n/**\r\n * 几何体动画\r\n */\r\nexport class GeosetAnim\r\n{\r\n}\r\n\r\n/**\r\n * 全局序列\r\n */\r\nexport class Globalsequences\r\n{\r\n\t/** 全局序列编号 */\r\n\tid: number;\r\n\t/** 持续时间 */\r\n\tdurations: number[] = [];\r\n}\r\n\r\n/**\r\n * 动作间隔\r\n */\r\nexport class Interval\r\n{\r\n\t/** 开始时间 */\r\n\tstart: number;\r\n\t/** 结束时间 */\r\n\tend: number;\r\n}\r\n\r\n/**\r\n * 材质层\r\n */\r\nexport class Layer\r\n{\r\n\t/** 过滤模式 */\r\n\tFilterMode: string;\r\n\t/** 贴图ID */\r\n\tTextureID: number;\r\n\t/** 透明度 */\r\n\tAlpha: number;\r\n\t/** 是否有阴影 */\r\n\tUnshaded: boolean;\r\n\t/** 是否无雾化 */\r\n\tUnfogged: boolean;\r\n\t/** 是否双面 */\r\n\tTwoSided: boolean;\r\n\t/** 是否开启地图环境范围 */\r\n\tSphereEnvMap: boolean;\r\n\t/** 是否无深度测试 */\r\n\tNoDepthTest: boolean;\r\n\t/** 是否无深度设置 */\r\n\tNoDepthSet: boolean;\r\n}\r\n\r\n/**\r\n * 材质\r\n */\r\nexport class Material\r\n{\r\n\t/** 材质层列表 */\r\n\tlayers: Layer[] = [];\r\n\t/**\r\n\t * created 材质\r\n\t */\r\n\tmaterial: Feng3dMaterial;\r\n}\r\n\r\n/**\r\n * 模型信息\r\n */\r\nexport class Model\r\n{\r\n\t/** 模型名称 */\r\n\tname: string;\r\n\t/** 混合时间 */\r\n\tBlendTime: number;\r\n\t/** 最小范围 */\r\n\tMinimumExtent: Vector3;\r\n\t/** 最大范围 */\r\n\tMaximumExtent: Vector3;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport class Rotation\r\n{\r\n\t/** 时间 */\r\n\ttime: number;\r\n\t/**  */\r\n\tvalue: Quaternion;\r\n\r\n\tInTan: Quaternion;\r\n\r\n\tOutTan: Quaternion;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport class Scaling\r\n{\r\n\t/** 时间 */\r\n\ttime: number;\r\n\t/**  */\r\n\tvalue: Vector3;\r\n\r\n\tInTan: Vector3;\r\n\r\n\tOutTan: Vector3;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport class Translation\r\n{\r\n\t/** 时间 */\r\n\ttime: number;\r\n\t/**  */\r\n\tvalue: Vector3;\r\n\r\n\tInTan: Vector3;\r\n\r\n\tOutTan: Vector3;\r\n}\r\n","import { Animation, AnimationClip, CustomGeometry, GameObject, geometryUtils, Material as Feng3dMaterial, PropertyClip, SkeletonComponent, SkeletonJoint, SkinnedMeshRenderer, SkinSkeletonTemp } from '@feng3d/core';\r\nimport { globalEmitter } from '@feng3d/event';\r\nimport { Matrix4x4, Vector3 } from '@feng3d/math';\r\nimport { CullFace } from '@feng3d/renderer';\r\nimport { serialization } from '@feng3d/serialization';\r\nimport { AnimInfo, BoneObject, FBitmap, Geoset, GeosetAnim, Globalsequences, Material, Model } from './MdlModel';\r\n\r\n/**\r\n * war3模型数据\r\n */\r\nexport class War3Model\r\n{\r\n\t/** 版本号 */\r\n\t_version: number;\r\n\t/** 模型数据统计结果 */\r\n\tmodel: Model;\r\n\t/** 动作序列 */\r\n\tsequences: AnimInfo[];\r\n\t/** 全局序列 */\r\n\tglobalsequences: Globalsequences;\r\n\t/** 纹理列表 */\r\n\ttextures: FBitmap[];\r\n\t/** 材质列表 */\r\n\tmaterials: Material[];\r\n\t/** 几何设置列表 */\r\n\tgeosets: Geoset[] = [];\r\n\t/** 几何动画列表 */\r\n\tgeosetAnims: GeosetAnim[];\r\n\t/** 骨骼动画列表 */\r\n\tbones: BoneObject[] = [];\r\n\t/** 骨骼轴心坐标 */\r\n\tpivotPoints: Vector3[];\r\n\r\n\t// -------------------------------------\r\n\t//\r\n\t//\t以下数据计算得出\r\n\t//\r\n\t// ---------------------------------------\r\n\r\n\tprivate meshs: GameObject[];\r\n\tprivate skeletonComponent: SkeletonComponent;\r\n\r\n\tgetMesh(): GameObject\r\n\t{\r\n\t\tthis.meshs = [];\r\n\t\tthis.meshs.length = this.geosets.length;\r\n\r\n\t\tconst container = serialization.setValue(new GameObject(), { name: this.model.name });\r\n\r\n\t\tconst skeletonjoints = createSkeleton(this);\r\n\t\tthis.skeletonComponent = container.addComponent(SkeletonComponent);\r\n\t\tthis.skeletonComponent.joints = skeletonjoints;\r\n\r\n\t\tfor (let i = 0; i < this.geosets.length; i++)\r\n\t\t{\r\n\t\t\tconst geoset: Geoset = this.geosets[i];\r\n\r\n\t\t\tconst mesh: GameObject = this.meshs[i] = new GameObject();\r\n\t\t\t// var model = mesh.addComponent(\"Model\");\r\n\t\t\tconst model = mesh.addComponent(SkinnedMeshRenderer);\r\n\r\n\t\t\tconst geometry: CustomGeometry = new CustomGeometry();\r\n\t\t\tgeometry.positions = geoset.Vertices;\r\n\t\t\tgeometry.uvs = geoset.TVertices;\r\n\t\t\tgeometry.indices = geoset.Faces;\r\n\t\t\tconst normals = geometryUtils.createVertexNormals(geometry.indices, geometry.positions, true);\r\n\t\t\tgeometry.normals = normals;\r\n\r\n\t\t\tconst skins = BuildAnimatedMeshSkin(geoset);\r\n\r\n\t\t\tconst skinSkeleton = new SkinSkeletonTemp();\r\n\t\t\tskinSkeleton.resetJointIndices(skins.jointIndices0, this.skeletonComponent);\r\n\r\n\t\t\t// 更新关节索引与权重索引\r\n\t\t\tgeometry.skinIndices = skins.jointIndices0;\r\n\t\t\tgeometry.skinWeights = skins.jointWeights0;\r\n\r\n\t\t\tconst material: Material = this.materials[geoset.MaterialID];\r\n\t\t\tif (!material.material)\r\n\t\t\t{\r\n\t\t\t\tconst fBitmap: FBitmap = this.getFBitmap(material);\r\n\t\t\t\tconst image: string = fBitmap.image;\r\n\t\t\t\t// if (image && image.length > 0)\r\n\t\t\t\t// {\r\n\t\t\t\t// image = image.substring(0, image.indexOf(\".\"));\r\n\t\t\t\t// image += \".JPG\";\r\n\t\t\t\tmaterial.material = model.material = serialization.setValue(new Feng3dMaterial(), { name: image, renderParams: { cullFace: CullFace.FRONT } });\r\n\t\t\t\t// }\r\n\r\n\t\t\t\tglobalEmitter.emit('asset.parsed', material.material);\r\n\t\t\t}\r\n\r\n\t\t\tglobalEmitter.emit('asset.parsed', geometry);\r\n\r\n\t\t\tmodel.geometry = geometry;\r\n\t\t\tmodel.skinSkeleton = skinSkeleton;\r\n\r\n\t\t\tcontainer.addChild(mesh);\r\n\t\t}\r\n\r\n\t\tconst animationclips = createAnimationClips(this);\r\n\t\tconst animation = container.addComponent(Animation);\r\n\t\tanimation.animation = animationclips[0];\r\n\t\tanimation.animations = animationclips;\r\n\r\n\t\t//\r\n\t\tcontainer.transform.rx = 90;\r\n\t\tcontainer.transform.sx = 0.01;\r\n\t\tcontainer.transform.sy = 0.01;\r\n\t\tcontainer.transform.sz = -0.01;\r\n\r\n\t\treturn container;\r\n\t}\r\n\r\n\tprivate getFBitmap(material: Material): FBitmap\r\n\t{\r\n\t\tlet TextureID = 0;\r\n\t\tfor (let i = 0; i < material.layers.length; i++)\r\n\t\t{\r\n\t\t\tconst layer = material.layers[i];\r\n\t\t\tTextureID = layer.TextureID;\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tconst fBitmap: FBitmap = this.textures[TextureID];\r\n\r\n\t\treturn fBitmap;\r\n\t}\r\n}\r\n\r\nfunction createSkeleton(war3Model: War3Model)\r\n{\r\n\tconst bones = war3Model.bones;\r\n\r\n\tconst skeletonjoints: SkeletonJoint[] = [];\r\n\tfor (let i = 0; i < bones.length; i++)\r\n\t{\r\n\t\tcreateSkeletonJoint(i);\r\n\t}\r\n\r\n\treturn skeletonjoints;\r\n\r\n\tfunction createSkeletonJoint(index)\r\n\t{\r\n\t\tif (skeletonjoints[index])\r\n\t\t{ return skeletonjoints[index]; }\r\n\r\n\t\tconst joint = bones[index];\r\n\t\tconst skeletonJoint = new SkeletonJoint();\r\n\t\tskeletonJoint.name = joint.name;\r\n\t\tskeletonJoint.parentIndex = joint.Parent;\r\n\r\n\t\tconst position = war3Model.pivotPoints[joint.ObjectId];\r\n\r\n\t\tconst matrix = new Matrix4x4().fromTRS(\r\n\t\t\tposition,\r\n\t\t\tnew Vector3(),\r\n\t\t\tnew Vector3(1, 1, 1)\r\n\t\t);\r\n\t\tif (skeletonJoint.parentIndex !== -1)\r\n\t\t{\r\n\t\t\tconst parentskeletonJoint = createSkeletonJoint(skeletonJoint.parentIndex);\r\n\t\t\tjoint.pivotPoint = matrix.getPosition().subTo(parentskeletonJoint.matrix.getPosition());\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tjoint.pivotPoint = position;\r\n\t\t}\r\n\t\tskeletonJoint.matrix = matrix;\r\n\t\tskeletonjoints[index] = skeletonJoint;\r\n\r\n\t\treturn skeletonJoint;\r\n\t}\r\n}\r\n\r\nfunction BuildAnimatedMeshSkin(geoset: Geoset)\r\n{\r\n\t// 关节索引数据\r\n\tconst jointIndices0: number[] = [];\r\n\t// 关节权重数据\r\n\tconst jointWeights0: number[] = [];\r\n\r\n\tconst numVertexs: number = geoset.Vertices.length / 3;\r\n\tfor (let i = 0; i < numVertexs; i++)\r\n\t{\r\n\t\t// 顶点所在组索引\r\n\t\tconst iGroupIndex: number = geoset.VertexGroup[i];\r\n\t\t// 顶点所在组索引\r\n\t\tconst group = geoset.Groups[iGroupIndex];\r\n\t\t// 顶点关联骨骼数量\r\n\t\tconst numBones: number = group.length;\r\n\t\tconst weightJoints = [0, 0, 0, 0];\r\n\t\tfor (let j = 0; j < numBones; j++)\r\n\t\t{\r\n\t\t\tconst boneIndex: number = group[j];\r\n\t\t\tweightJoints[j] = boneIndex;\r\n\t\t}\r\n\t\tconst weightBiass = [0, 0, 0, 0];\r\n\t\tfor (let j = 0; j < 4; j++)\r\n\t\t{\r\n\t\t\tif (j < numBones)\r\n\t\t\t{\r\n\t\t\t\tweightBiass[j] = 1 / numBones;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//\r\n\t\tjointIndices0[i * 4] = weightJoints[0];\r\n\t\tjointIndices0[i * 4 + 1] = weightJoints[1];\r\n\t\tjointIndices0[i * 4 + 2] = weightJoints[2];\r\n\t\tjointIndices0[i * 4 + 3] = weightJoints[3];\r\n\t\t//\r\n\t\tjointWeights0[i * 4] = weightBiass[0];\r\n\t\tjointWeights0[i * 4 + 1] = weightBiass[1];\r\n\t\tjointWeights0[i * 4 + 2] = weightBiass[2];\r\n\t\tjointWeights0[i * 4 + 3] = weightBiass[3];\r\n\t}\r\n\r\n\treturn { jointIndices0, jointWeights0 };\r\n}\r\n\r\nfunction createAnimationClips(war3Model: War3Model)\r\n{\r\n\tconst sequences = war3Model.sequences;\r\n\tconst animationclips: AnimationClip[] = [];\r\n\tfor (let i = 0; i < sequences.length; i++)\r\n\t{\r\n\t\tconst sequence = sequences[i];\r\n\t\tconst animationclip = new AnimationClip();\r\n\t\tanimationclip.name = sequence.name;\r\n\t\tanimationclip.loop = sequence.loop;\r\n\t\tanimationclip.length = sequence.interval.end - sequence.interval.start;\r\n\t\tanimationclip.propertyClips = [];\r\n\r\n\t\tconst __chache__: { [key: string]: PropertyClip } = {};\r\n\r\n\t\twar3Model.bones.forEach((bone) =>\r\n\t\t{\r\n\t\t\tbone.buildAnimationclip(animationclip, __chache__, sequence.interval.start, sequence.interval.end);\r\n\t\t});\r\n\r\n\t\tglobalEmitter.emit('asset.parsed', animationclip);\r\n\r\n\t\tanimationclips.push(animationclip);\r\n\t}\r\n\r\n\treturn animationclips;\r\n}\r\n","import { Quaternion, Vector2, Vector3 } from '@feng3d/math';\r\nimport { AnimInfo, AnimInfo1, BoneObject, BoneRotation, BoneScaling, BoneTranslation, FBitmap, Geoset, GeosetAnim, Globalsequences, Interval, Layer, Material, Model, Rotation, Scaling, Translation } from './mdl/MdlModel';\r\nimport { War3Model } from './mdl/War3Model';\r\n\r\n/**\r\n * war3的mdl文件解析器\r\n */\r\nexport class MDLParser\r\n{\r\n\t/**\r\n\t * 解析war3的mdl文件\r\n\t * @param data MDL模型数据\r\n\t * @param completed 完成回调\r\n\t */\r\n\tparse(data: string, completed?: (war3Model: War3Model) => void): void\r\n\t{\r\n\t\tparse(data, completed);\r\n\t}\r\n}\r\n\r\n/**\r\n * war3的mdl文件解析器\r\n */\r\nexport const mdlParser = new MDLParser();\r\n\r\nconst VERSION_TOKEN = 'Version';\r\nconst COMMENT_TOKEN = '//';\r\nconst MODEL = 'Model';\r\nconst SEQUENCES = 'Sequences';\r\nconst GLOBALSEQUENCES = 'GlobalSequences';\r\nconst TEXTURES = 'Textures';\r\nconst MATERIALS = 'Materials';\r\nconst GEOSET = 'Geoset';\r\nconst GEOSETANIM = 'GeosetAnim';\r\nconst BONE = 'Bone';\r\nconst HELPER = 'Helper';\r\n\r\nfunction parse(data: string, onParseComplete?: (war3Model: War3Model) => void)\r\n{\r\n\tlet token: string;\r\n\r\n\tlet bone: BoneObject;\r\n\tlet geoset: Geoset;\r\n\tlet junpStr: string;\r\n\r\n\t// const num = 0;\r\n\tconst war3Model = new War3Model();\r\n\r\n\t/** 字符串数据 */\r\n\tconst context = data;\r\n\t/** 当前解析位置 */\r\n\tlet _parseIndex = 0;\r\n\t/** 是否文件尾 */\r\n\tlet _reachedEOF = false;\r\n\t/** 当前解析行号 */\r\n\tlet _line: number;\r\n\t/** 当前行的字符位置 */\r\n\tlet _charLineIndex = 0;\r\n\r\n\t// eslint-disable-next-line no-unmodified-loop-condition\r\n\twhile (!_reachedEOF)\r\n\t{\r\n\t\t// 获取关键字\r\n\t\ttoken = getNextToken();\r\n\t\tswitch (token)\r\n\t\t{\r\n\t\t\tcase COMMENT_TOKEN:\r\n\t\t\t\tignoreLine();\r\n\t\t\t\tbreak;\r\n\t\t\tcase VERSION_TOKEN:\r\n\t\t\t\twar3Model._version = parseVersion();\r\n\t\t\t\tbreak;\r\n\t\t\tcase MODEL:\r\n\t\t\t\twar3Model.model = parseModel();\r\n\t\t\t\tbreak;\r\n\t\t\tcase SEQUENCES:\r\n\t\t\t\twar3Model.sequences = parseSequences();\r\n\t\t\t\tbreak;\r\n\t\t\tcase GLOBALSEQUENCES:\r\n\t\t\t\twar3Model.globalsequences = parseGlobalsequences();\r\n\t\t\t\tbreak;\r\n\t\t\tcase TEXTURES:\r\n\t\t\t\twar3Model.textures = parseTextures();\r\n\t\t\t\tbreak;\r\n\t\t\tcase MATERIALS:\r\n\t\t\t\twar3Model.materials = parseMaterials();\r\n\t\t\t\tbreak;\r\n\t\t\tcase GEOSET:\r\n\t\t\t\tgeoset = parseGeoset();\r\n\t\t\t\twar3Model.geosets.push(geoset);\r\n\t\t\t\tbreak;\r\n\t\t\tcase GEOSETANIM:\r\n\t\t\t\tparseGeosetanim();\r\n\t\t\t\tbreak;\r\n\t\t\tcase BONE:\r\n\t\t\t\tbone = parseBone();\r\n\t\t\t\twar3Model.bones[bone.ObjectId] = bone;\r\n\t\t\t\tbreak;\r\n\t\t\tcase HELPER:\r\n\t\t\t\tbone = parseHelper();\r\n\t\t\t\twar3Model.bones[bone.ObjectId] = bone;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'PivotPoints':\r\n\t\t\t\twar3Model.pivotPoints = parsePivotPoints();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'ParticleEmitter2':\r\n\t\t\t\tparseLiteralString();\r\n\t\t\t\tjunpStr = jumpChunk();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'EventObject':\r\n\t\t\t\tparseLiteralString();\r\n\t\t\t\tjunpStr = jumpChunk();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Attachment':\r\n\t\t\t\tparseLiteralString();\r\n\t\t\t\tjunpStr = jumpChunk();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'RibbonEmitter':\r\n\t\t\t\tparseLiteralString();\r\n\t\t\t\tjunpStr = jumpChunk();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'CollisionShape':\r\n\t\t\t\tparseLiteralString();\r\n\t\t\t\tjunpStr = jumpChunk();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Camera':\r\n\t\t\t\tparseLiteralString();\r\n\t\t\t\tjunpStr = jumpChunk();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Light':\r\n\t\t\t\tparseLiteralString();\r\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\t\t\tjunpStr = jumpChunk();\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tif (!_reachedEOF)\r\n\t\t\t\t{\r\n\t\t\t\t\tsendUnknownKeywordError(token);\r\n\t\t\t\t}\r\n\t\t}\r\n\t}\r\n\tonParseComplete && onParseComplete(war3Model);\r\n\r\n\t// /**\r\n\t//  * 获取骨骼深度\r\n\t//  * @param bone\r\n\t//  * @param bones\r\n\t//  * @return\r\n\t//  */\r\n\t// function getBoneDepth(bone: BoneObject, bones: BoneObject[]): number\r\n\t// {\r\n\t// \tif (bone.Parent === -1)\r\n\t// \t{\r\n\t// \t\treturn 0;\r\n\t// \t}\r\n\r\n\t// \treturn getBoneDepth(bones[bone.Parent], bones) + 1;\r\n\t// }\r\n\r\n\t/**\r\n\t * 解析版本号\r\n\t */\r\n\tfunction parseVersion()\r\n\t{\r\n\t\tlet token: string = getNextToken();\r\n\r\n\t\tif (token !== '{')\r\n\t\t{\r\n\t\t\tsendParseError(token);\r\n\t\t}\r\n\r\n\t\ttoken = getNextToken();\r\n\t\tif (token !== 'FormatVersion')\r\n\t\t{\r\n\t\t\tsendUnknownKeywordError(token);\r\n\t\t}\r\n\r\n\t\tconst version = getNextInt();\r\n\r\n\t\ttoken = getNextToken();\r\n\r\n\t\tif (token !== '}')\r\n\t\t{\r\n\t\t\tsendParseError(token);\r\n\t\t}\r\n\r\n\t\treturn version;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析模型数据统计结果\r\n\t */\r\n\tfunction parseModel(): Model\r\n\t{\r\n\t\tconst model: Model = new Model();\r\n\r\n\t\tmodel.name = parseLiteralString();\r\n\r\n\t\tconst token: string = getNextToken();\r\n\r\n\t\tif (token !== '{')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\tlet ch = '';\r\n\t\twhile (ch !== '}')\r\n\t\t{\r\n\t\t\tch = getNextToken();\r\n\t\t\tswitch (ch)\r\n\t\t\t{\r\n\t\t\t\tcase COMMENT_TOKEN:\r\n\t\t\t\t\tignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'BlendTime':\r\n\t\t\t\t\tmodel.BlendTime = getNextInt();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'MinimumExtent':\r\n\t\t\t\t\tmodel.MinimumExtent = parseVector3D();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'MaximumExtent':\r\n\t\t\t\t\tmodel.MaximumExtent = parseVector3D();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '}':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn model;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析动作序列\r\n\t */\r\n\tfunction parseSequences(): AnimInfo[]\r\n\t{\r\n\t\t// 跳过动作个数\r\n\t\tgetNextInt();\r\n\t\tconst sequences: AnimInfo[] = [];\r\n\r\n\t\tconst token: string = getNextToken();\r\n\r\n\t\tif (token !== '{')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\tlet ch = '';\r\n\t\twhile (ch !== '}')\r\n\t\t{\r\n\t\t\tch = getNextToken();\r\n\t\t\tswitch (ch)\r\n\t\t\t{\r\n\t\t\t\tcase COMMENT_TOKEN:\r\n\t\t\t\t\tignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Anim':\r\n\t\t\t\t\tconst anim: AnimInfo = parseAnim();\r\n\t\t\t\t\tsequences.push(anim);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '}':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tsendUnknownKeywordError(ch);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn sequences;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析全局序列\r\n\t */\r\n\tfunction parseGlobalsequences(): Globalsequences\r\n\t{\r\n\t\tconst globalsequences: Globalsequences = new Globalsequences();\r\n\r\n\t\tglobalsequences.id = getNextInt();\r\n\r\n\t\tconst token: string = getNextToken();\r\n\r\n\t\tif (token !== '{')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\tlet ch = '';\r\n\t\twhile (ch !== '}')\r\n\t\t{\r\n\t\t\tch = getNextToken();\r\n\t\t\tswitch (ch)\r\n\t\t\t{\r\n\t\t\t\tcase COMMENT_TOKEN:\r\n\t\t\t\t\tignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Duration':\r\n\t\t\t\t\tconst duration: number = getNextInt();\r\n\t\t\t\t\tglobalsequences.durations.push(duration);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '}':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tsendUnknownKeywordError(ch);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn globalsequences;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析纹理列表\r\n\t */\r\n\tfunction parseTextures(): FBitmap[]\r\n\t{\r\n\t\t// 跳过纹理个数\r\n\t\tgetNextInt();\r\n\t\tconst bitmaps: FBitmap[] = [];\r\n\r\n\t\tconst token: string = getNextToken();\r\n\r\n\t\tif (token !== '{')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\tlet ch = '';\r\n\t\twhile (ch !== '}')\r\n\t\t{\r\n\t\t\tch = getNextToken();\r\n\t\t\tswitch (ch)\r\n\t\t\t{\r\n\t\t\t\tcase COMMENT_TOKEN:\r\n\t\t\t\t\tignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Bitmap':\r\n\t\t\t\t\tconst bitmap: FBitmap = parseBitmap();\r\n\t\t\t\t\tbitmaps.push(bitmap);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '}':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tsendUnknownKeywordError(ch);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn bitmaps;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析材质\r\n\t */\r\n\tfunction parseMaterials(): Material[]\r\n\t{\r\n\t\t// 跳过纹理个数\r\n\t\tgetNextInt();\r\n\t\tconst materials: Material[] = [];\r\n\r\n\t\tconst token: string = getNextToken();\r\n\r\n\t\tif (token !== '{')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\tlet ch = '';\r\n\t\twhile (ch !== '}')\r\n\t\t{\r\n\t\t\tch = getNextToken();\r\n\t\t\tswitch (ch)\r\n\t\t\t{\r\n\t\t\t\tcase COMMENT_TOKEN:\r\n\t\t\t\t\tignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Material':\r\n\t\t\t\t\tconst material: Material = parseMaterial();\r\n\t\t\t\t\tmaterials.push(material);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '}':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tsendUnknownKeywordError(ch);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn materials;\r\n\t}\r\n\r\n\tfunction parseGeoset(): Geoset\r\n\t{\r\n\t\tconst geoset: Geoset = new Geoset();\r\n\r\n\t\tconst token: string = getNextToken();\r\n\r\n\t\tif (token !== '{')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\tlet ch = '';\r\n\t\twhile (ch !== '}')\r\n\t\t{\r\n\t\t\tch = getNextToken();\r\n\t\t\tswitch (ch)\r\n\t\t\t{\r\n\t\t\t\tcase COMMENT_TOKEN:\r\n\t\t\t\t\tignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Vertices':\r\n\t\t\t\t\tgeoset.Vertices = parseVertices();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Normals':\r\n\t\t\t\t\tgeoset.Normals = parseNormals();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'TVertices':\r\n\t\t\t\t\tgeoset.TVertices = parseTVertices();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'VertexGroup':\r\n\t\t\t\t\tgeoset.VertexGroup = parseVertexGroup();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Faces':\r\n\t\t\t\t\tgeoset.Faces = parseFaces();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Groups':\r\n\t\t\t\t\tgeoset.Groups = parseGroups();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'MinimumExtent':\r\n\t\t\t\t\tgeoset.MinimumExtent = parseVector3D();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'MaximumExtent':\r\n\t\t\t\t\tgeoset.MaximumExtent = parseVector3D();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'BoundsRadius':\r\n\t\t\t\t\tgeoset.BoundsRadius = getNextNumber();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Anim':\r\n\t\t\t\t\tconst anim: AnimInfo1 = parseAnim1();\r\n\t\t\t\t\tgeoset.Anims.push(anim);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'MaterialID':\r\n\t\t\t\t\tgeoset.MaterialID = getNextInt();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'SelectionGroup':\r\n\t\t\t\t\tgeoset.SelectionGroup = getNextInt();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Unselectable':\r\n\t\t\t\t\tgeoset.Unselectable = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '}':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tsendUnknownKeywordError(ch);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn geoset;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析骨骼动画\r\n\t */\r\n\tfunction parseBone(): BoneObject\r\n\t{\r\n\t\tconst bone: BoneObject = new BoneObject();\r\n\t\tbone.type = 'bone';\r\n\r\n\t\tbone.name = parseLiteralString();\r\n\r\n\t\tconst token: string = getNextToken();\r\n\r\n\t\tif (token !== '{')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\tlet ch = '';\r\n\t\twhile (ch !== '}')\r\n\t\t{\r\n\t\t\tch = getNextToken();\r\n\t\t\tswitch (ch)\r\n\t\t\t{\r\n\t\t\t\tcase COMMENT_TOKEN:\r\n\t\t\t\t\tignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'ObjectId':\r\n\t\t\t\t\tbone.ObjectId = getNextInt();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Parent':\r\n\t\t\t\t\tbone.Parent = getNextInt();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'GeosetId':\r\n\t\t\t\t\tbone.GeosetId = getNextToken();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'GeosetAnimId':\r\n\t\t\t\t\tbone.GeosetAnimId = getNextToken();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Billboarded':\r\n\t\t\t\t\tbone.Billboarded = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Translation':\r\n\t\t\t\t\tparseBoneTranslation(bone.Translation);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Scaling':\r\n\t\t\t\t\tparseBoneScaling(bone.Scaling);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Rotation':\r\n\t\t\t\t\tparseBoneRotation(bone.Rotation);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'BillboardedLockZ':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'BillboardedLockY':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'BillboardedLockX':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '}':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tsendUnknownKeywordError(ch);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn bone;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析骨骼动画\r\n\t */\r\n\tfunction parseHelper(): BoneObject\r\n\t{\r\n\t\tconst bone: BoneObject = new BoneObject();\r\n\t\tbone.type = 'helper';\r\n\r\n\t\tbone.name = parseLiteralString();\r\n\r\n\t\tconst token: string = getNextToken();\r\n\r\n\t\tif (token !== '{')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\tlet ch = '';\r\n\t\twhile (ch !== '}')\r\n\t\t{\r\n\t\t\tch = getNextToken();\r\n\t\t\tswitch (ch)\r\n\t\t\t{\r\n\t\t\t\tcase COMMENT_TOKEN:\r\n\t\t\t\t\tignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'ObjectId':\r\n\t\t\t\t\tbone.ObjectId = getNextInt();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Parent':\r\n\t\t\t\t\tbone.Parent = getNextInt();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'GeosetId':\r\n\t\t\t\t\tbone.GeosetId = getNextToken();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'GeosetAnimId':\r\n\t\t\t\t\tbone.GeosetAnimId = getNextToken();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Billboarded':\r\n\t\t\t\t\tbone.Billboarded = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Translation':\r\n\t\t\t\t\tparseBoneTranslation(bone.Translation);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Scaling':\r\n\t\t\t\t\tparseBoneScaling(bone.Scaling);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Rotation':\r\n\t\t\t\t\tparseBoneRotation(bone.Rotation);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'BillboardedLockX':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'BillboardedLockY':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'BillboardedLockZ':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'DontInherit':\r\n\t\t\t\t\tjumpChunk();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '}':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tsendUnknownKeywordError(ch);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn bone;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析骨骼角度\r\n\t */\r\n\tfunction parseBoneScaling(boneScaling: BoneScaling): void\r\n\t{\r\n\t\t// 跳过长度\r\n\t\tconst len: number = getNextInt();\r\n\r\n\t\tcheck('{');\r\n\t\tboneScaling.type = getNextToken();\r\n\r\n\t\tconst currentIndex: number = _parseIndex;\r\n\t\tconst token: string = getNextToken();\r\n\t\tif (token === 'GlobalSeqId')\r\n\t\t{\r\n\t\t\tboneScaling.GlobalSeqId = getNextInt();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t_parseIndex = currentIndex;\r\n\t\t}\r\n\r\n\t\tlet i = 0;\r\n\t\tlet scaling: Scaling;\r\n\t\tswitch (boneScaling.type)\r\n\t\t{\r\n\t\t\tcase 'Hermite':\r\n\t\t\tcase 'Bezier':\r\n\t\t\t\tfor (i = 0; i < len; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tscaling = new Scaling();\r\n\t\t\t\t\tscaling.time = getNextInt();\r\n\t\t\t\t\tscaling.value = parseVector3D();\r\n\t\t\t\t\tscaling[getNextToken()] = parseVector3D();\r\n\t\t\t\t\tscaling[getNextToken()] = parseVector3D();\r\n\t\t\t\t\tboneScaling.scalings.push(scaling);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Linear':\r\n\t\t\t\tfor (i = 0; i < len; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tscaling = new Scaling();\r\n\t\t\t\t\tscaling.time = getNextInt();\r\n\t\t\t\t\tscaling.value = parseVector3D();\r\n\t\t\t\t\tboneScaling.scalings.push(scaling);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'DontInterp':\r\n\t\t\t\tfor (i = 0; i < len; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tscaling = new Scaling();\r\n\t\t\t\t\tscaling.time = getNextInt();\r\n\t\t\t\t\tscaling.value = parseVector3D();\r\n\t\t\t\t\tboneScaling.scalings.push(scaling);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(`未处理${boneScaling.type}类型角度`);\r\n\t\t}\r\n\t\tcheck('}');\r\n\t}\r\n\r\n\t/**\r\n\t * 解析骨骼角度\r\n\t */\r\n\tfunction parseBoneTranslation(boneTranslation: BoneTranslation): void\r\n\t{\r\n\t\t// 跳过长度\r\n\t\tconst len: number = getNextInt();\r\n\r\n\t\tcheck('{');\r\n\t\tboneTranslation.type = getNextToken();\r\n\r\n\t\tconst currentIndex: number = _parseIndex;\r\n\t\tconst token: string = getNextToken();\r\n\t\tif (token === 'GlobalSeqId')\r\n\t\t{\r\n\t\t\tboneTranslation.GlobalSeqId = getNextInt();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t_parseIndex = currentIndex;\r\n\t\t}\r\n\r\n\t\tlet i = 0;\r\n\t\tlet translation: Translation;\r\n\t\tswitch (boneTranslation.type)\r\n\t\t{\r\n\t\t\tcase 'Hermite':\r\n\t\t\tcase 'Bezier':\r\n\t\t\t\tfor (i = 0; i < len; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\ttranslation = new Translation();\r\n\t\t\t\t\ttranslation.time = getNextInt();\r\n\t\t\t\t\ttranslation.value = parseVector3D();\r\n\t\t\t\t\ttranslation[getNextToken()] = parseVector3D();\r\n\t\t\t\t\ttranslation[getNextToken()] = parseVector3D();\r\n\t\t\t\t\tboneTranslation.translations.push(translation);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Linear':\r\n\t\t\t\tfor (i = 0; i < len; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\ttranslation = new Translation();\r\n\t\t\t\t\ttranslation.time = getNextInt();\r\n\t\t\t\t\ttranslation.value = parseVector3D();\r\n\t\t\t\t\tboneTranslation.translations.push(translation);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'DontInterp':\r\n\t\t\t\tfor (i = 0; i < len; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\ttranslation = new Translation();\r\n\t\t\t\t\ttranslation.time = getNextInt();\r\n\t\t\t\t\ttranslation.value = parseVector3D();\r\n\t\t\t\t\tboneTranslation.translations.push(translation);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(`未处理${boneTranslation.type}类型角度`);\r\n\t\t}\r\n\t\tcheck('}');\r\n\t}\r\n\r\n\t/**\r\n\t * 解析骨骼角度\r\n\t */\r\n\tfunction parseBoneRotation(boneRotation: BoneRotation): void\r\n\t{\r\n\t\tconst len: number = getNextInt();\r\n\r\n\t\tcheck('{');\r\n\t\tboneRotation.type = getNextToken();\r\n\r\n\t\tconst currentIndex: number = _parseIndex;\r\n\t\tconst token: string = getNextToken();\r\n\t\tif (token === 'GlobalSeqId')\r\n\t\t{\r\n\t\t\tboneRotation.GlobalSeqId = getNextInt();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t_parseIndex = currentIndex;\r\n\t\t}\r\n\r\n\t\tlet i = 0;\r\n\t\tlet rotation: Rotation;\r\n\t\tswitch (boneRotation.type)\r\n\t\t{\r\n\t\t\tcase 'Hermite':\r\n\t\t\tcase 'Bezier':\r\n\t\t\t\tfor (i = 0; i < len; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\trotation = new Rotation();\r\n\t\t\t\t\trotation.time = getNextInt();\r\n\t\t\t\t\trotation.value = parseVector3D4();\r\n\t\t\t\t\trotation[getNextToken()] = parseVector3D4();\r\n\t\t\t\t\trotation[getNextToken()] = parseVector3D4();\r\n\t\t\t\t\tboneRotation.rotations.push(rotation);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Linear':\r\n\t\t\t\tfor (i = 0; i < len; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\trotation = new Rotation();\r\n\t\t\t\t\trotation.time = getNextInt();\r\n\t\t\t\t\trotation.value = parseVector3D4();\r\n\t\t\t\t\tboneRotation.rotations.push(rotation);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'DontInterp':\r\n\t\t\t\tfor (i = 0; i < len; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\trotation = new Rotation();\r\n\t\t\t\t\trotation.time = getNextInt();\r\n\t\t\t\t\trotation.value = parseVector3D4();\r\n\t\t\t\t\tboneRotation.rotations.push(rotation);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(`未处理${boneRotation.type}类型角度`);\r\n\t\t}\r\n\t\tcheck('}');\r\n\t}\r\n\r\n\t/**\r\n\t * 解析多边形动画\r\n\t */\r\n\tfunction parseGeosetanim(): GeosetAnim | null\r\n\t{\r\n\t\t// const jumpStr = jumpChunk();\r\n\r\n\t\treturn null;\r\n\r\n\t\t// if (war3Model.geosetAnims == null)\r\n\t\t// \twar3Model.geosetAnims = [];\r\n\t\t// var geosetAnim: GeosetAnim = new GeosetAnim();\r\n\t\t// war3Model.geosetAnims.push(geosetAnim);\r\n\r\n\t\t// var token: string = getNextToken();\r\n\r\n\t\t// if (token != \"{\")\r\n\t\t// \tsendParseError(token);\r\n\r\n\t\t// var ch: string;\r\n\t\t// while (ch != \"}\")\r\n\t\t// {\r\n\t\t// \tch = getNextToken();\r\n\t\t// \tswitch (ch)\r\n\t\t// \t{\r\n\t\t// \t\tcase COMMENT_TOKEN:\r\n\t\t// \t\t\tignoreLine();\r\n\t\t// \t\t\tbreak;\r\n\t\t// \t\tcase \"Alpha\":\r\n\t\t// \t\t\t//\t\t\t\t\t\tparseAnimAlpha();\r\n\t\t// \t\t\tbreak;\r\n\t\t// \t\tcase \"}\":\r\n\t\t// \t\t\tbreak;\r\n\t\t// \t\tdefault:\r\n\t\t// \t\t\tsendUnknownKeywordError(ch);\r\n\t\t// \t\t\tbreak;\r\n\t\t// \t}\r\n\t\t// }\r\n\t\t// return geosetAnim;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析顶点\r\n\t */\r\n\tfunction parseVertices(): number[]\r\n\t{\r\n\t\tconst vertices: number[] = [];\r\n\r\n\t\t// 跳过长度\r\n\t\tconst len: number = getNextInt();\r\n\t\tlet token: string = getNextToken();\r\n\r\n\t\tif (token !== '{')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\tlet vertex: Vector3;\r\n\t\tfor (let i = 0; i < len; i++)\r\n\t\t{\r\n\t\t\tvertex = parseVector3D();\r\n\t\t\tvertices.push(vertex.x, vertex.y, vertex.z);\r\n\t\t}\r\n\r\n\t\ttoken = getNextToken();\r\n\t\tif (token !== '}')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\treturn vertices;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析法线\r\n\t */\r\n\tfunction parseNormals(): number[]\r\n\t{\r\n\t\tconst normals: number[] = [];\r\n\r\n\t\t// 跳过长度\r\n\t\tconst len: number = getNextInt();\r\n\t\tlet token: string = getNextToken();\r\n\r\n\t\tif (token !== '{')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\tlet vertex: Vector3;\r\n\t\tfor (let i = 0; i < len; i++)\r\n\t\t{\r\n\t\t\tvertex = parseVector3D();\r\n\t\t\tnormals.push(vertex.x, vertex.y, vertex.z);\r\n\t\t}\r\n\r\n\t\ttoken = getNextToken();\r\n\t\tif (token !== '}')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\treturn normals;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析纹理坐标\r\n\t */\r\n\tfunction parseTVertices(): number[]\r\n\t{\r\n\t\tconst tVertices: number[] = [];\r\n\r\n\t\t// 跳过长度\r\n\t\tconst len: number = getNextInt();\r\n\t\tlet token: string = getNextToken();\r\n\r\n\t\tif (token !== '{')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\tlet uv: Vector2;\r\n\t\tfor (let i = 0; i < len; i++)\r\n\t\t{\r\n\t\t\tuv = parsePoint();\r\n\t\t\ttVertices.push(uv.x, uv.y);\r\n\t\t}\r\n\r\n\t\ttoken = getNextToken();\r\n\t\tif (token !== '}')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\treturn tVertices;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析顶点分组\r\n\t */\r\n\tfunction parseVertexGroup(): number[]\r\n\t{\r\n\t\tconst vertexGroup: number[] = [];\r\n\r\n\t\tlet token: string = getNextToken();\r\n\r\n\t\tif (token !== '{')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\ttoken = getNextToken();\r\n\t\twhile (token !== '}')\r\n\t\t{\r\n\t\t\tvertexGroup.push(Number(token));\r\n\t\t\ttoken = getNextToken();\r\n\t\t}\r\n\r\n\t\treturn vertexGroup;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析面\r\n\t */\r\n\tfunction parseFaces(): number[]\r\n\t{\r\n\t\tconst faces: number[] = [];\r\n\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tconst faceNum: number = getNextInt();\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tconst indexNum: number = getNextInt();\r\n\r\n\t\tlet token: string;\r\n\r\n\t\tcheck('{');\r\n\t\tcheck('Triangles');\r\n\t\tcheck('{');\r\n\t\tcheck('{');\r\n\r\n\t\ttoken = getNextToken();\r\n\t\twhile (token !== '}')\r\n\t\t{\r\n\t\t\tfaces.push(Number(token));\r\n\t\t\ttoken = getNextToken();\r\n\t\t}\r\n\r\n\t\tcheck('}');\r\n\t\tcheck('}');\r\n\r\n\t\treturn faces;\r\n\t}\r\n\r\n\t/**\r\n\t * 解顶点分组\r\n\t */\r\n\tfunction parseGroups(): number[][]\r\n\t{\r\n\t\tconst groups: number[][] = [];\r\n\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tconst groupNum: number = getNextInt();\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tconst valueNum: number = getNextInt();\r\n\r\n\t\tlet token: string;\r\n\r\n\t\tcheck('{');\r\n\r\n\t\ttoken = getNextToken();\r\n\t\twhile (token !== '}')\r\n\t\t{\r\n\t\t\tif (token === 'Matrices')\r\n\t\t\t{\r\n\t\t\t\tcheck('{');\r\n\t\t\t\ttoken = getNextToken();\r\n\t\t\t\tconst Matrices: number[] = [];\r\n\t\t\t\twhile (token !== '}')\r\n\t\t\t\t{\r\n\t\t\t\t\tMatrices.push(Number(token));\r\n\t\t\t\t\ttoken = getNextToken();\r\n\t\t\t\t}\r\n\t\t\t\tgroups.push(Matrices);\r\n\t\t\t}\r\n\t\t\ttoken = getNextToken();\r\n\t\t}\r\n\r\n\t\treturn groups;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析纹理\r\n\t */\r\n\tfunction parseBitmap(): FBitmap\r\n\t{\r\n\t\tconst bitmap: FBitmap = new FBitmap();\r\n\r\n\t\tconst token: string = getNextToken();\r\n\r\n\t\tif (token !== '{')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\tlet ch = '';\r\n\t\twhile (ch !== '}')\r\n\t\t{\r\n\t\t\tch = getNextToken();\r\n\t\t\tswitch (ch)\r\n\t\t\t{\r\n\t\t\t\tcase COMMENT_TOKEN:\r\n\t\t\t\t\tignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Image':\r\n\t\t\t\t\tbitmap.image = parseLiteralString();\r\n\t\t\t\t\tbitmap.image = bitmap.image.replace(/\\\\/g, '/');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'ReplaceableId':\r\n\t\t\t\t\tbitmap.ReplaceableId = getNextInt();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'WrapWidth':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'WrapHeight':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '}':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tsendUnknownKeywordError(ch);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn bitmap;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析材质\r\n\t */\r\n\tfunction parseMaterial(): Material\r\n\t{\r\n\t\tconst material: Material = new Material();\r\n\r\n\t\tconst token: string = getNextToken();\r\n\r\n\t\tif (token !== '{')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\tlet ch = '';\r\n\t\twhile (ch !== '}')\r\n\t\t{\r\n\t\t\tch = getNextToken();\r\n\t\t\tswitch (ch)\r\n\t\t\t{\r\n\t\t\t\tcase COMMENT_TOKEN:\r\n\t\t\t\t\tignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Layer':\r\n\t\t\t\t\tconst layer: Layer = parseLayer();\r\n\t\t\t\t\tmaterial.layers.push(layer);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'SortPrimsFarZ':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'ConstantColor':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '}':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tsendUnknownKeywordError(ch);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn material;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析材质层\r\n\t */\r\n\tfunction parseLayer(): Layer\r\n\t{\r\n\t\tconst layer: Layer = new Layer();\r\n\r\n\t\tconst token: string = getNextToken();\r\n\r\n\t\tif (token !== '{')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\tlet staticSigned = false;\r\n\t\tlet ch = '';\r\n\t\twhile (ch !== '}')\r\n\t\t{\r\n\t\t\tch = getNextToken();\r\n\t\t\tswitch (ch)\r\n\t\t\t{\r\n\t\t\t\tcase COMMENT_TOKEN:\r\n\t\t\t\t\tignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'FilterMode':\r\n\t\t\t\t\tlayer.FilterMode = getNextToken();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'static':\r\n\t\t\t\t\tstaticSigned = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'TextureID':\r\n\t\t\t\t\tif (staticSigned)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlayer.TextureID = getNextInt();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tsendUnknownKeywordError(ch);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstaticSigned = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Alpha':\r\n\t\t\t\t\tif (staticSigned)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlayer.Alpha = getNextNumber();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tgetNextInt();\r\n\t\t\t\t\t\tjumpChunk();\r\n\r\n\t\t\t\t\t\t//\t\t\t\t\t\t\tsendUnknownKeywordError(ch);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstaticSigned = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Unshaded':\r\n\t\t\t\t\tlayer.Unshaded = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Unfogged':\r\n\t\t\t\t\tlayer.Unfogged = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'TwoSided':\r\n\t\t\t\t\tlayer.TwoSided = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'SphereEnvMap':\r\n\t\t\t\t\tlayer.SphereEnvMap = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'NoDepthTest':\r\n\t\t\t\t\tlayer.NoDepthTest = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'NoDepthSet':\r\n\t\t\t\t\tlayer.NoDepthSet = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '}':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tsendUnknownKeywordError(ch);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn layer;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析动作信息\r\n\t */\r\n\tfunction parseAnim(): AnimInfo\r\n\t{\r\n\t\tconst anim: AnimInfo = new AnimInfo();\r\n\r\n\t\tanim.name = parseLiteralString();\r\n\r\n\t\tconst token: string = getNextToken();\r\n\r\n\t\tif (token !== '{')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\tlet ch = '';\r\n\t\twhile (ch !== '}')\r\n\t\t{\r\n\t\t\tch = getNextToken();\r\n\t\t\tswitch (ch)\r\n\t\t\t{\r\n\t\t\t\tcase COMMENT_TOKEN:\r\n\t\t\t\t\tignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Interval':\r\n\t\t\t\t\tanim.interval = parseInterval();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'MinimumExtent':\r\n\t\t\t\t\tanim.MinimumExtent = parseVector3D();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'MaximumExtent':\r\n\t\t\t\t\tanim.MaximumExtent = parseVector3D();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'BoundsRadius':\r\n\t\t\t\t\tanim.BoundsRadius = getNextNumber();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Rarity':\r\n\t\t\t\t\tanim.Rarity = getNextNumber();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'NonLooping':\r\n\t\t\t\t\tanim.loop = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'MoveSpeed':\r\n\t\t\t\t\tanim.MoveSpeed = getNextNumber();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '}':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tsendUnknownKeywordError(ch);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn anim;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析几何体动作信息\r\n\t */\r\n\tfunction parseAnim1(): AnimInfo1\r\n\t{\r\n\t\tconst anim: AnimInfo1 = new AnimInfo1();\r\n\r\n\t\tconst token: string = getNextToken();\r\n\r\n\t\tif (token !== '{')\r\n\t\t{ sendParseError(token); }\r\n\r\n\t\tlet ch = '';\r\n\t\twhile (ch !== '}')\r\n\t\t{\r\n\t\t\tch = getNextToken();\r\n\t\t\tswitch (ch)\r\n\t\t\t{\r\n\t\t\t\tcase COMMENT_TOKEN:\r\n\t\t\t\t\tignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'MinimumExtent':\r\n\t\t\t\t\tanim.MinimumExtent = parseVector3D();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'MaximumExtent':\r\n\t\t\t\t\tanim.MaximumExtent = parseVector3D();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'BoundsRadius':\r\n\t\t\t\t\tanim.BoundsRadius = getNextNumber();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '}':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tsendUnknownKeywordError(ch);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn anim;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析骨骼轴心坐标\r\n\t */\r\n\tfunction parsePivotPoints(): Vector3[]\r\n\t{\r\n\t\tconst points: Vector3[] = [];\r\n\r\n\t\tconst len: number = getNextInt();\r\n\r\n\t\tcheck('{');\r\n\r\n\t\tfor (let i = 0; i < len; i++)\r\n\t\t{\r\n\t\t\tconst point: Vector3 = parseVector3D();\r\n\t\t\tpoints.push(point);\r\n\t\t}\r\n\r\n\t\tcheck('}');\r\n\r\n\t\treturn points;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析3d向量\r\n\t */\r\n\tfunction parseVector3D(): Vector3\r\n\t{\r\n\t\tconst vec: Vector3 = new Vector3();\r\n\t\tlet ch: string = getNextToken();\r\n\r\n\t\tif (ch !== '{')\r\n\t\t{ sendParseError('{'); }\r\n\t\tvec.x = getNextNumber();\r\n\t\tvec.y = getNextNumber();\r\n\t\tvec.z = getNextNumber();\r\n\r\n\t\tch = getNextToken();\r\n\t\tif (!(ch === '}' || ch === '},'))\r\n\t\t{ sendParseError('}'); }\r\n\r\n\t\treturn vec;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析四元素\r\n\t */\r\n\tfunction parseVector3D4(): Quaternion\r\n\t{\r\n\t\tconst vec: Quaternion = new Quaternion();\r\n\t\tlet ch: string = getNextToken();\r\n\r\n\t\tif (ch !== '{')\r\n\t\t{ sendParseError('{'); }\r\n\t\tvec.x = getNextNumber();\r\n\t\tvec.y = getNextNumber();\r\n\t\tvec.z = getNextNumber();\r\n\t\tvec.w = getNextNumber();\r\n\r\n\t\tch = getNextToken();\r\n\t\tif (!(ch === '}' || ch === '},'))\r\n\t\t{ sendParseError('}'); }\r\n\r\n\t\treturn vec;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析2d坐标\r\n\t */\r\n\tfunction parsePoint(): Vector2\r\n\t{\r\n\t\tconst point: Vector2 = new Vector2();\r\n\t\tlet ch: string = getNextToken();\r\n\r\n\t\tif (ch !== '{')\r\n\t\t{\r\n\t\t\tsendParseError('{');\r\n\t\t}\r\n\t\tpoint.x = getNextNumber();\r\n\t\tpoint.y = getNextNumber();\r\n\r\n\t\tch = getNextToken();\r\n\t\tif (!(ch === '}' || ch === '},'))\r\n\t\t{\r\n\t\t\tsendParseError('}');\r\n\t\t}\r\n\r\n\t\treturn point;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析间隔\r\n\t */\r\n\tfunction parseInterval(): Interval\r\n\t{\r\n\t\tconst interval: Interval = new Interval();\r\n\t\tlet ch: string = getNextToken();\r\n\r\n\t\tif (ch !== '{')\r\n\t\t{\r\n\t\t\tsendParseError('{');\r\n\t\t}\r\n\t\tinterval.start = getNextInt();\r\n\t\tinterval.end = getNextInt();\r\n\r\n\t\tch = getNextToken();\r\n\t\tif (!(ch === '}' || ch === '},'))\r\n\t\t{\r\n\t\t\tsendParseError('}');\r\n\t\t}\r\n\r\n\t\treturn interval;\r\n\t}\r\n\r\n\t/**\r\n\t * 解析带双引号的字符串\r\n\t */\r\n\tfunction parseLiteralString(): string\r\n\t{\r\n\t\tskipWhiteSpace();\r\n\r\n\t\tlet ch: string = getNextChar();\r\n\t\tlet str = '';\r\n\r\n\t\tif (ch !== '\"')\r\n\t\t{ sendParseError('\"'); }\r\n\r\n\t\tdo\r\n\t\t{\r\n\t\t\tif (_reachedEOF)\r\n\t\t\t{\r\n\t\t\t\tsendEOFError();\r\n\t\t\t}\r\n\t\t\tch = getNextChar();\r\n\t\t\tif (ch !== '\"')\r\n\t\t\t{\r\n\t\t\t\tstr += ch;\r\n\t\t\t}\r\n\t\t} while (ch !== '\"');\r\n\r\n\t\treturn str;\r\n\t}\r\n\r\n\t/**\r\n\t * 读取下个Number\r\n\t */\r\n\tfunction getNextNumber(): number\r\n\t{\r\n\t\tconst f: number = parseFloat(getNextToken());\r\n\t\tif (isNaN(f))\r\n\t\t{ sendParseError('float type'); }\r\n\r\n\t\treturn f;\r\n\t}\r\n\r\n\t/**\r\n\t * 读取下个字符\r\n\t */\r\n\tfunction getNextChar(): string\r\n\t{\r\n\t\tconst ch: string = context.charAt(_parseIndex++);\r\n\r\n\t\tif (ch === '\\n')\r\n\t\t{\r\n\t\t\t++_line;\r\n\t\t\t_charLineIndex = 0;\r\n\t\t}\r\n\t\telse if (ch !== '\\r')\r\n\t\t{ ++_charLineIndex; }\r\n\r\n\t\tif (_parseIndex >= context.length)\r\n\t\t{ _reachedEOF = true; }\r\n\r\n\t\treturn ch;\r\n\t}\r\n\r\n\t/**\r\n\t * 读取下个int\r\n\t */\r\n\tfunction getNextInt(): number\r\n\t{\r\n\t\tconst i: number = parseInt(getNextToken(), 10);\r\n\t\tif (isNaN(i))\r\n\t\t{\r\n\t\t\tsendParseError('int type');\r\n\t\t}\r\n\r\n\t\treturn i;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取下个关键字\r\n\t */\r\n\tfunction getNextToken(): string\r\n\t{\r\n\t\tlet ch: string;\r\n\t\tlet token = '';\r\n\r\n\t\twhile (!_reachedEOF)\r\n\t\t{\r\n\t\t\tch = getNextChar();\r\n\t\t\tif (ch === ' ' || ch === '\\r' || ch === '\\n' || ch === '\\t' || ch === ',')\r\n\t\t\t{\r\n\t\t\t\tif (token !== COMMENT_TOKEN)\r\n\t\t\t\t{\r\n\t\t\t\t\tskipWhiteSpace();\r\n\t\t\t\t}\r\n\t\t\t\tif (token !== '')\r\n\t\t\t\t{\r\n\t\t\t\t\treturn token;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\ttoken += ch;\r\n\t\t\t}\r\n\r\n\t\t\tif (token === COMMENT_TOKEN)\r\n\t\t\t{\r\n\t\t\t\treturn token;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn token;\r\n\t}\r\n\r\n\t/**\r\n\t * 跳过块\r\n\t * @return 跳过的内容\r\n\t */\r\n\tfunction jumpChunk()\r\n\t{\r\n\t\tconst start: number = _parseIndex;\r\n\r\n\t\tcheck('{');\r\n\t\tconst stack = ['{'];\r\n\r\n\t\tlet ch: string;\r\n\r\n\t\twhile (!_reachedEOF)\r\n\t\t{\r\n\t\t\tch = getNextChar();\r\n\t\t\tif (ch === '{')\r\n\t\t\t{\r\n\t\t\t\tstack.push('{');\r\n\t\t\t}\r\n\t\t\tif (ch === '}')\r\n\t\t\t{\r\n\t\t\t\tstack.pop();\r\n\t\t\t\tif (stack.length === 0)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn context.substring(start, _parseIndex);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn '';\r\n\t}\r\n\r\n\t/**\r\n\t * 返回到上个字符位置\r\n\t */\r\n\tfunction putBack(): void\r\n\t{\r\n\t\t_parseIndex--;\r\n\t\t_charLineIndex--;\r\n\t\t_reachedEOF = _parseIndex >= context.length;\r\n\t}\r\n\r\n\t/**\r\n\t * 跳过空白\r\n\t */\r\n\tfunction skipWhiteSpace(): void\r\n\t{\r\n\t\tlet ch: string;\r\n\r\n\t\tdo\r\n\t\t{ ch = getNextChar(); }\r\n\t\twhile (ch === '\\n' || ch === ' ' || ch === '\\r' || ch === '\\t');\r\n\r\n\t\tputBack();\r\n\t}\r\n\r\n\t/**\r\n\t * 忽略该行\r\n\t */\r\n\tfunction ignoreLine(): void\r\n\t{\r\n\t\tlet ch = '';\r\n\t\twhile (!_reachedEOF && ch !== '\\n')\r\n\t\t{\r\n\t\t\tch = getNextChar();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction check(key: string): void\r\n\t{\r\n\t\tconst token: string = getNextToken();\r\n\t\tif (token !== key)\r\n\t\t{\r\n\t\t\tsendParseError(token);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 抛出一个文件尾过早结束文件时遇到错误\r\n\t */\r\n\tfunction sendEOFError(): void\r\n\t{\r\n\t\tthrow new Error('Unexpected end of file');\r\n\t}\r\n\r\n\t/**\r\n\t * 遇到了一个意想不到的令牌时将抛出一个错误。\r\n\t * @param expected 发生错误的标记\r\n\t */\r\n\tfunction sendParseError(expected: string): void\r\n\t{\r\n\t\tthrow new Error(`Unexpected token at line ${_line + 1}, character ${_charLineIndex}. ${expected} expected, but ${context.charAt(_parseIndex - 1)} encountered`);\r\n\t}\r\n\r\n\t/**\r\n\t * 发生未知关键字错误\r\n\t */\r\n\tfunction sendUnknownKeywordError(keyword: string): void\r\n\t{\r\n\t\tthrow new Error(`Unknown keyword[${keyword}] at line ${_line + 1}, character ${_charLineIndex}. `);\r\n\t}\r\n}\r\n","import { GameObject } from '@feng3d/core';\r\nimport { globalEmitter } from '@feng3d/event';\r\nimport { FS, pathUtils } from '@feng3d/filesystem';\r\nimport { serialization } from '@feng3d/serialization';\r\nimport { mdlParser } from '../parsers/MDLParser';\r\n\r\n/**\r\n * MDL模型加载器\r\n */\r\nexport class MDLLoader\r\n{\r\n    /**\r\n     * 加载MDL模型\r\n     * @param mdlurl MDL模型路径\r\n     * @param callback 加载完成回调\r\n     */\r\n    load(mdlurl: string, callback?: (gameObject: GameObject) => void)\r\n    {\r\n        FS.fs.readString(mdlurl, (_err, content) =>\r\n        {\r\n            mdlParser.parse(content, (war3Model: { getMesh: () => any; }) =>\r\n            {\r\n                const showMesh = war3Model.getMesh();\r\n\r\n                const gameObject = serialization.setValue(new GameObject(), { name: pathUtils.getName(mdlurl), children: <any>[showMesh] });\r\n\r\n                globalEmitter.emit('asset.parsed', gameObject);\r\n                callback && callback(gameObject);\r\n            });\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * MDL模型加载器\r\n */\r\nexport const mdlLoader = new MDLLoader();\r\n","/**\r\n * OBJ模型MTL材质解析器\r\n */\r\nexport class MTLParser\r\n{\r\n    /**\r\n     * 解析\r\n     * @param context\r\n     */\r\n    parser(context: string): Mtl_Mtl\r\n    {\r\n        const mtl: Mtl_Mtl = {};\r\n        const lines = context.split('\\n');\r\n        for (let i = 0; i < lines.length; i++)\r\n        {\r\n            parserLine(lines[i], mtl);\r\n        }\r\n\r\n        return mtl;\r\n    }\r\n}\r\n/**\r\n * OBJ模型MTL材质解析器\r\n */\r\nexport const mtlParser = new MTLParser();\r\n\r\nexport type Mtl_Material = {\r\n    name: string;\r\n    ka: number[];\r\n    kd: number[];\r\n    ks: number[];\r\n    ns: number;\r\n    ni: number;\r\n    d: number;\r\n    illum: number;\r\n    map_Bump: string;\r\n    map_Ka: string;\r\n    map_Kd: string;\r\n    map_Ks: string;\r\n};\r\nexport type Mtl_Mtl = { [name: string]: Mtl_Material };\r\n\r\nconst newmtlReg = /newmtl\\s+([\\w.]+)/;\r\nconst kaReg = /Ka\\s+([\\d.]+)\\s+([\\d.]+)\\s+([\\d.]+)/;\r\nconst kdReg = /Kd\\s+([\\d.]+)\\s+([\\d.]+)\\s+([\\d.]+)/;\r\nconst ksReg = /Ks\\s+([\\d.]+)\\s+([\\d.]+)\\s+([\\d.]+)/;\r\nconst nsReg = /Ns\\s+([\\d.]+)/;\r\nconst niReg = /Ni\\s+([\\d.]+)/;\r\nconst dReg = /d\\s+([\\d.]+)/;\r\nconst illumReg = /illum\\s+([\\d]+)/;\r\nconst map_Bump_Reg = /map_Bump\\s+([\\w\\W]+\\.[\\w\\W]+)/;\r\nconst map_Ka_Reg = /map_Ka\\s+([\\w\\W]+\\.[\\w\\W]+)/;\r\nconst map_Kd_Reg = /map_Kd\\s+([\\w\\W]+\\.[\\w\\W]+)/;\r\nconst map_Ks_Reg = /map_Ks\\s+([\\w\\W]+\\.[\\w\\W]+)/;\r\nlet currentMaterial: Mtl_Material;\r\n\r\nfunction parserLine(line: string, mtl: Mtl_Mtl)\r\n{\r\n    if (!line)\r\n    { return; }\r\n    line = line.trim();\r\n    if (!line.length)\r\n    { return; }\r\n    if (line.charAt(0) === '#')\r\n    { return; }\r\n\r\n    let result: RegExpExecArray | null;\r\n    if ((result = newmtlReg.exec(line)) && result[0] === line)\r\n    {\r\n        currentMaterial = { name: result[1], ka: [], kd: [], ks: [], ns: 0, ni: 0, d: 0, illum: 0, map_Bump: '', map_Ka: '', map_Kd: '', map_Ks: '' };\r\n        mtl[currentMaterial.name] = currentMaterial;\r\n    }\r\n    else if ((result = kaReg.exec(line)) && result[0] === line)\r\n    {\r\n        currentMaterial.ka = [parseFloat(result[1]), parseFloat(result[2]), parseFloat(result[3])];\r\n    }\r\n    else if ((result = kdReg.exec(line)) && result[0] === line)\r\n    {\r\n        currentMaterial.kd = [parseFloat(result[1]), parseFloat(result[2]), parseFloat(result[3])];\r\n    }\r\n    else if ((result = ksReg.exec(line)) && result[0] === line)\r\n    {\r\n        currentMaterial.ks = [parseFloat(result[1]), parseFloat(result[2]), parseFloat(result[3])];\r\n    }\r\n    else if ((result = nsReg.exec(line)) && result[0] === line)\r\n    {\r\n        currentMaterial.ns = parseFloat(result[1]);\r\n    }\r\n    else if ((result = niReg.exec(line)) && result[0] === line)\r\n    {\r\n        currentMaterial.ni = parseFloat(result[1]);\r\n    }\r\n    else if ((result = dReg.exec(line)) && result[0] === line)\r\n    {\r\n        currentMaterial.d = parseFloat(result[1]);\r\n    }\r\n    else if ((result = illumReg.exec(line)) && result[0] === line)\r\n    {\r\n        currentMaterial.illum = parseFloat(result[1]);\r\n    }\r\n    else if ((result = map_Bump_Reg.exec(line)) && result[0] === line)\r\n    {\r\n        currentMaterial.map_Bump = result[1];\r\n    }\r\n    else if ((result = map_Ka_Reg.exec(line)) && result[0] === line)\r\n    {\r\n        currentMaterial.map_Ka = result[1];\r\n    }\r\n    else if ((result = map_Kd_Reg.exec(line)) && result[0] === line)\r\n    {\r\n        currentMaterial.map_Kd = result[1];\r\n    }\r\n    else if ((result = map_Ks_Reg.exec(line)) && result[0] === line)\r\n    {\r\n        currentMaterial.map_Ks = result[1];\r\n    }\r\n    else\r\n    {\r\n        throw new Error(`无法解析${line}`);\r\n    }\r\n}\r\n","import { Material } from '@feng3d/core';\r\nimport { FS } from '@feng3d/filesystem';\r\nimport { mtlConverter } from '../converters/MTLConverter';\r\nimport { mtlParser } from '../parsers/MTLParser';\r\n\r\n/**\r\n * OBJ模型MTL材质加载器\r\n */\r\nexport class MTLLoader\r\n{\r\n    /**\r\n     * 加载MTL材质\r\n     * @param path MTL材质文件路径\r\n     * @param completed 加载完成回调\r\n     */\r\n    load(path: string, completed?: (err: Error, materials: { [name: string]: Material; }) => void)\r\n    {\r\n        FS.fs.readString(path, (err, content) =>\r\n        {\r\n            if (err)\r\n            {\r\n                completed(err, null);\r\n\r\n                return;\r\n            }\r\n            const mtlData = mtlParser.parser(content);\r\n            mtlConverter.convert(mtlData, completed);\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * OBJ模型MTL材质加载器\r\n */\r\nexport const mtlLoader = new MTLLoader();\r\n","/**\r\n * OBJ模型解析器\r\n */\r\nexport class OBJParser\r\n{\r\n    /**\r\n     * 解析\r\n     * @param context\r\n     */\r\n    parser(context: string)\r\n    {\r\n        currentObj = null;\r\n        currentSubObj = null;\r\n        //\r\n        const objData: OBJ_OBJData = { mtl: null, objs: [], vertex: [], vn: [], vt: [] };\r\n        const lines = context.split('\\n').reverse();\r\n        do\r\n        {\r\n            const line = lines.pop();\r\n            line && parserLine(line, objData);\r\n        } while (lines.length > 0);\r\n\r\n        return objData;\r\n    }\r\n}\r\n/**\r\n * OBJ模型解析器\r\n */\r\nexport const objParser = new OBJParser();\r\n\r\n/**\r\n * 面数据\r\n */\r\nexport type OBJ_Face = {\r\n    /** 顶点索引 */\r\n    vertexIndices: string[];\r\n    /** uv索引 */\r\n    uvIndices?: string[];\r\n    /** 法线索引 */\r\n    normalIndices?: string[];\r\n    /** 索引数据 */\r\n    indexIds: string[];\r\n};\r\n\r\n/**\r\n * 子对象\r\n */\r\nexport type OBJ_SubOBJ = {\r\n    /** 材质名称 */\r\n    material?: string;\r\n    /**  */\r\n    g?: string,\r\n    /** 面列表 */\r\n    faces: OBJ_Face[];\r\n};\r\n\r\n/**\r\n * 对象\r\n */\r\nexport type OBJ_OBJ = {\r\n    // 模型名称\r\n    name: string;\r\n    /** 子对象 */\r\n    subObjs: OBJ_SubOBJ[];\r\n};\r\n\r\n/**\r\n * Obj模型数据\r\n */\r\nexport type OBJ_OBJData = {\r\n    /**\r\n     * 模型名称\r\n     */\r\n    name?: string;\r\n    /** mtl文件路径 */\r\n    mtl: string | null;\r\n    /** 顶点坐标 */\r\n    vertex: { x: number, y: number, z: number }[];\r\n    /** 顶点法线 */\r\n    vn: { x: number, y: number, z: number }[];\r\n    /** 顶点uv */\r\n    vt: { u: number, v: number, s: number }[];\r\n    /** 模型列表 */\r\n    objs: OBJ_OBJ[];\r\n};\r\n\r\n/** mtl正则 */\r\nconst mtlReg = /mtllib\\s+([\\w\\s]+\\.mtl)/;\r\n/** 对象名称正则 */\r\nconst objReg = /o\\s+([\\w\\.]+)/;\r\n/** 顶点坐标正则 */\r\nconst vertexReg = /v\\s+([-\\d.]+)\\s+([-\\d.]+)\\s+([-\\d.]+)/;\r\n/** 顶点法线正则 */\r\nconst vnReg = /vn\\s+([-\\d.]+)\\s+([-\\d.]+)\\s+([-\\d.]+)/;\r\n/** 顶点uv正则 */\r\nconst vtReg = /vt\\s+([-\\d.]+)\\s+([-\\d.]+)(\\s+([-\\d.]+))?/;\r\n/** 使用材质正则 */\r\nconst usemtlReg = /usemtl\\s+([\\w.]+)/;\r\n/** 面正则 vertex */\r\nconst faceV3Reg = /f\\s+(\\d+)\\s+(\\d+)\\s+(\\d+)/;\r\n/** 面正则 vertex */\r\nconst faceVReg = /f\\s+(\\d+)\\s+(\\d+)\\s+(\\d+)\\s+(\\d+)/;\r\n/** 面正则 vertex/uv/normal */\r\nconst faceVUNReg = /f\\s+((\\d+)\\/(\\d+)\\/(\\d+))\\s+((\\d+)\\/(\\d+)\\/(\\d+))\\s+((\\d+)\\/(\\d+)\\/(\\d+))/;\r\n/** 面正则 vertex//normal */\r\nconst faceVN3Reg = /f\\s+(\\d+)\\/\\/(\\d+)\\s+(\\d+)\\/\\/(\\d+)\\s+(\\d+)\\/\\/(\\d+)/;\r\n// g\r\nconst gReg = /g\\s+([\\(\\)\\w]+)?/;\r\n\r\nconst sReg = /s\\s+(\\w+)/;\r\n\r\n//\r\nlet currentObj: OBJ_OBJ;\r\nlet currentSubObj: OBJ_SubOBJ;\r\n\r\nfunction parserLine(line: string, objData: OBJ_OBJData)\r\n{\r\n    if (!line)\r\n    {\r\n        return;\r\n    }\r\n    line = line.trim();\r\n    if (!line.length)\r\n    {\r\n        return;\r\n    }\r\n    if (line.charAt(0) === '#')\r\n    {\r\n        return;\r\n    }\r\n\r\n    let result: RegExpExecArray | null;\r\n    if ((result = mtlReg.exec(line)) && result[0] === line)\r\n    {\r\n        objData.mtl = result[1];\r\n    }\r\n    else if ((result = objReg.exec(line)) && result[0] === line)\r\n    {\r\n        currentObj = { name: result[1], subObjs: [] };\r\n        objData.objs.push(currentObj);\r\n    }\r\n    else if ((result = vertexReg.exec(line)) && result[0] === line)\r\n    {\r\n        if (!currentObj)\r\n        {\r\n            currentObj = { name: '', subObjs: [] };\r\n            objData.objs.push(currentObj);\r\n        }\r\n        objData.vertex.push({ x: parseFloat(result[1]), y: parseFloat(result[2]), z: parseFloat(result[3]) });\r\n    }\r\n    else if ((result = vnReg.exec(line)) && result[0] === line)\r\n    {\r\n        objData.vn.push({ x: parseFloat(result[1]), y: parseFloat(result[2]), z: parseFloat(result[3]) });\r\n    }\r\n    else if ((result = vtReg.exec(line)) && result[0] === line)\r\n    {\r\n        objData.vt.push({ u: parseFloat(result[1]), v: 1 - parseFloat(result[2]), s: parseFloat(result[4]) });\r\n    }\r\n    else if ((result = gReg.exec(line)) && result[0] === line)\r\n    {\r\n        currentSubObj = { faces: [] };\r\n        currentObj.subObjs.push(currentSubObj);\r\n        currentSubObj.g = result[1];\r\n    }\r\n    else if ((result = sReg.exec(line)) && result[0] === line)\r\n    // eslint-disable-next-line no-empty\r\n    {\r\n\r\n    }\r\n    else if ((result = usemtlReg.exec(line)) && result[0] === line)\r\n    {\r\n        currentSubObj = { faces: [] };\r\n        currentObj.subObjs.push(currentSubObj);\r\n        currentSubObj.material = result[1];\r\n    }\r\n    else if ((result = faceV3Reg.exec(line)) && result[0] === line)\r\n    {\r\n        currentSubObj.faces.push({\r\n            indexIds: [result[2], result[1], result[3]],\r\n            vertexIndices: [result[2], result[1], result[3]]\r\n        });\r\n    }\r\n    else if ((result = faceVN3Reg.exec(line)) && result[0] === line)\r\n    {\r\n        currentSubObj.faces.push({\r\n            indexIds: [result[3], result[1], result[5]],\r\n            vertexIndices: [result[3], result[1], result[5]],\r\n            normalIndices: [result[4], result[2], result[6]],\r\n        });\r\n    }\r\n    else if ((result = faceVReg.exec(line)) && result[0] === line)\r\n    {\r\n        currentSubObj.faces.push({\r\n            indexIds: [result[2], result[1], result[3]],\r\n            vertexIndices: [result[2], result[1], result[3]]\r\n        });\r\n        currentSubObj.faces.push({\r\n            indexIds: [result[4], result[3], result[1]],\r\n            vertexIndices: [result[4], result[3], result[1]]\r\n        });\r\n    }\r\n    else if ((result = faceVUNReg.exec(line)) && result[0] === line)\r\n    {\r\n        currentSubObj.faces.push({\r\n            indexIds: [result[5], result[1], result[9]],\r\n            vertexIndices: [result[6], result[2], result[10]],\r\n            uvIndices: [result[7], result[3], result[11]],\r\n            normalIndices: [result[8], result[4], result[12]]\r\n        });\r\n    }\r\n    else\r\n    {\r\n        throw new Error(`无法解析${line}`);\r\n    }\r\n}\r\n","import { GameObject } from '@feng3d/core';\r\nimport { FS, pathUtils } from '@feng3d/filesystem';\r\nimport { objConverter } from '../converters/OBJConverter';\r\nimport { objParser } from '../parsers/OBJParser';\r\nimport { mtlLoader } from './MTLLoader';\r\n\r\n/**\r\n * Obj模型加载类\r\n */\r\nexport class ObjLoader\r\n{\r\n    /**\r\n     * 加载资源\r\n     * @param url   路径\r\n     */\r\n    load(url: string, completed?: (gameObject: GameObject) => void)\r\n    {\r\n        const root = url.substring(0, url.lastIndexOf('/') + 1);\r\n\r\n        FS.fs.readString(url, (_err, content) =>\r\n        {\r\n            const objData = objParser.parser(content);\r\n            objData.name = pathUtils.getName(url);\r\n            const mtl = objData.mtl;\r\n            if (mtl)\r\n            {\r\n                mtlLoader.load(root + mtl, (_err, materials) =>\r\n                {\r\n                    objConverter.convert(objData, materials, completed);\r\n                });\r\n            }\r\n            else\r\n            {\r\n                objConverter.convert(objData, null, completed);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Obj模型加载类\r\n */\r\nexport const objLoader = new ObjLoader();\r\n","/**\r\n * The animation type.\r\n *\r\n * 动画类型。\r\n */\r\nexport enum ParticleSystemAnimationType\r\n{\r\n    /**\r\n     * Animate over the whole texture sheet from left to right, top to bottom.\r\n     *\r\n     * 从左到右，从上到下动画整个纹理表。\r\n     */\r\n    WholeSheet = 0,\r\n    /**\r\n     * Animate a single row in the sheet from left to right.\r\n     *\r\n     * 从左到右移动工作表中的一行。\r\n     */\r\n    SingleRow = 1,\r\n}\r\n","/**\r\n * How to apply emitter velocity to particles.\r\n *\r\n * 如何将发射体速度应用于粒子。\r\n */\r\nexport enum ParticleSystemInheritVelocityMode\r\n{\r\n    /**\r\n     * Each particle inherits the emitter's velocity on the frame when it was initially emitted.\r\n     *\r\n     * 每个粒子在最初发射时都继承了发射体在帧上的速度。\r\n     */\r\n    Initial = 0,\r\n\r\n    /**\r\n     * Each particle's velocity is set to the emitter's current velocity value, every frame.\r\n     *\r\n     * 每一帧，每个粒子的速度都设定为发射器的当前速度值。\r\n     */\r\n    Current = 1,\r\n}\r\n","/**\r\n * The mesh emission type.\r\n *\r\n * 网格发射类型。\r\n */\r\nexport enum ParticleSystemMeshShapeType\r\n{\r\n    /**\r\n     * Emit from the vertices of the mesh.\r\n     *\r\n     * 从网格的顶点发出。\r\n     */\r\n    Vertex,\r\n\r\n    /**\r\n     * Emit from the edges of the mesh.\r\n     *\r\n     * 从网格的边缘发出。\r\n     */\r\n    Edge,\r\n\r\n    /**\r\n     * Emit from the surface of the mesh.\r\n     *\r\n     * 从网格表面发出。\r\n     */\r\n    Triangle,\r\n}\r\n","/**\r\n * The quality of the generated noise.\r\n *\r\n * 产生的噪音的质量。\r\n */\r\nexport enum ParticleSystemNoiseQuality\r\n{\r\n    /**\r\n     * Low quality 1D noise.\r\n     *\r\n     * 低质量的一维噪声。\r\n     */\r\n    Low,\r\n\r\n    /**\r\n     * Medium quality 2D noise.\r\n     *\r\n     * 中等质量2D噪音。\r\n     */\r\n    Medium,\r\n\r\n    /**\r\n     * High quality 3D noise.\r\n     *\r\n     * 高品质3D噪音。\r\n     */\r\n    High,\r\n}\r\n","export enum ParticleSystemRenderMode\r\n{\r\n    /**\r\n     * Render particles as billboards facing the active camera. (Default)\r\n     */\r\n    Billboard = 0,\r\n\r\n    /**\r\n     * Stretch particles in the direction of motion.\r\n     */\r\n    Stretch = 1,\r\n\r\n    /**\r\n     * Render particles as billboards always facing up along the y-Axis.\r\n     */\r\n    HorizontalBillboard = 2,\r\n\r\n    /**\r\n     * Render particles as billboards always facing the player, but not pitching along the x-Axis.\r\n\r\n     */\r\n    VerticalBillboard = 3,\r\n\r\n    /**\r\n     * Render particles as meshes.\r\n     */\r\n    Mesh = 4,\r\n\r\n    /**\r\n     * Do not render particles.\r\n     */\r\n    None = 5,\r\n}\r\n","/**\r\n * How particles are aligned when rendered.\r\n */\r\nexport enum ParticleSystemRenderSpace\r\n{\r\n    /**\r\n     * Particles face the camera plane.\r\n     */\r\n    View,\r\n\r\n    /**\r\n     * Particles align with the world.\r\n     */\r\n    World,\r\n\r\n    /**\r\n     * Particles align with their local transform.\r\n     */\r\n    Local,\r\n\r\n    /**\r\n     * Particles face the eye position.\r\n     */\r\n    Facing,\r\n\r\n    /**\r\n     * Particles are aligned to their direction of travel.\r\n     */\r\n    Velocity,\r\n\r\n}\r\n","/**\r\n * Control how particle systems apply transform scale.\r\n *\r\n * 控制粒子系统如何应用变换尺度。\r\n */\r\nexport enum ParticleSystemScalingMode\r\n{\r\n    /**\r\n     * Scale the particle system using the entire transform hierarchy.\r\n     *\r\n     * 使用整个转换层次来缩放粒子系统。\r\n     */\r\n    Hierarchy,\r\n\r\n    /**\r\n     * Scale the particle system using only its own transform scale. (Ignores parent scale).\r\n     *\r\n     * 尺度粒子系统只使用自己的变换尺度。(忽略了父母规模)。\r\n     */\r\n    Local,\r\n\r\n    /**\r\n     * Only apply transform scale to the shape component, which controls where particles are spawned, but does not affect their size or movement.\r\n     *\r\n     * 只对形状组件应用变换比例，它控制生成粒子的位置，但不影响粒子的大小或移动。\r\n     */\r\n    Shape\r\n}\r\n","/**\r\n * 粒子系统圆锥体发射类型，用于定义基于圆锥体的发射类型。\r\n */\r\nexport enum ParticleSystemShapeConeEmitFrom\r\n{\r\n    /**\r\n     * 从圆锥体底面发射。\r\n     */\r\n    Base,\r\n    /**\r\n     * 从圆锥体底面边缘沿着曲面发射。\r\n     */\r\n    BaseShell,\r\n    /**\r\n     * 从圆锥体内部发射。\r\n     */\r\n    Volume,\r\n    /**\r\n     * 从圆锥体曲面沿着曲面发射。\r\n     */\r\n    VolumeShell,\r\n}\r\n","/**\r\n * The mode used to generate new points in a shape (Shuriken).\r\n *\r\n * 用于在形状中生成新点的模式\r\n */\r\nexport enum ParticleSystemShapeMultiModeValue\r\n{\r\n    /**\r\n     * Generate points randomly. (Default)\r\n     *\r\n     * 生成随机点。(默认)\r\n     */\r\n    Random = 0,\r\n    /**\r\n     * Animate the emission point around the shape.\r\n     *\r\n     * 使发射点围绕形状运动。\r\n     */\r\n    Loop = 1,\r\n    /**\r\n     * Animate the emission point around the shape, alternating between clockwise and counter-clockwise directions.\r\n     *\r\n     * 使发射点围绕形状运动，在顺时针和逆时针方向之间交替。\r\n     */\r\n    PingPong = 2,\r\n    /**\r\n     * Distribute new particles around the shape evenly.\r\n     *\r\n     * 在形状周围均匀分布新粒子。\r\n     *\r\n     * @todo\r\n     */\r\n    BurstSpread = 3,\r\n}\r\n","/**\r\n * 发射形状\r\n */\r\nexport enum ParticleSystemShapeType\r\n{\r\n    /**\r\n     * Emit from a sphere.\r\n     *\r\n     * 从球体的体积中发射。\r\n     */\r\n    Sphere = 0,\r\n\r\n    /**\r\n     * Emit from the surface of a sphere.\r\n     *\r\n     * 从球体表面发射。\r\n     */\r\n    SphereShell = 1,\r\n\r\n    /**\r\n     * Emit from a half-sphere.\r\n     *\r\n     * 从半球体的体积发射。\r\n     */\r\n    Hemisphere = 2,\r\n\r\n    /**\r\n     * Emit from the surface of a half-sphere.\r\n     *\r\n     * 从半球体的表面发射。\r\n     */\r\n    HemisphereShell = 3,\r\n\r\n    /**\r\n     * Emit from a cone.\r\n     *\r\n     * 从圆锥体发射。\r\n     */\r\n    Cone = 4,\r\n\r\n    /**\r\n     * Emit from the base surface of a cone.\r\n     *\r\n     * 从圆锥体的基面发射。\r\n     */\r\n    ConeShell = 7,\r\n\r\n    /**\r\n     * Emit from the volume of a cone.\r\n     *\r\n     * 从一个圆锥体的体积发出。\r\n     */\r\n    ConeVolume = 8,\r\n\r\n    /**\r\n     * Emit from the surface of a cone.\r\n     *\r\n     * 从一个圆锥体的表面发射。\r\n     */\r\n    ConeVolumeShell = 9,\r\n\r\n    /**\r\n     * Emit from the volume of a box.\r\n     *\r\n     * 从一个盒子的体积中发出。\r\n     */\r\n    Box = 5,\r\n\r\n    /**\r\n     * Emit from the surface of a box.\r\n     *\r\n     * 从盒子表面发射。\r\n     */\r\n    BoxShell = 15,\r\n\r\n    /**\r\n     * Emit from the edges of a box.\r\n     *\r\n     * 从盒子的边缘发出。\r\n     */\r\n    BoxEdge = 16,\r\n\r\n    /**\r\n     * Emit from a mesh.\r\n     *\r\n     * 从一个网格中发出。\r\n     *\r\n     * @todo\r\n     */\r\n    Mesh = 6,\r\n\r\n    /**\r\n     * Emit from a mesh renderer.\r\n     *\r\n     * 从一个网格渲染器发射。\r\n     *\r\n     * @todo\r\n     */\r\n    MeshRenderer = 13,\r\n\r\n    /**\r\n     * Emit from a skinned mesh renderer.\r\n     *\r\n     * 从蒙皮网格渲染器发出。\r\n     *\r\n     * @todo\r\n     */\r\n    SkinnedMeshRenderer = 14,\r\n\r\n    /**\r\n     * Emit from a circle.\r\n     *\r\n     * 从一个圆发出。\r\n     */\r\n    Circle = 10,\r\n\r\n    /**\r\n     * Emit from the edge of a circle.\r\n     *\r\n     * 从圆的边缘发出。\r\n     */\r\n    CircleEdge = 11,\r\n\r\n    /**\r\n     * Emit from an edge.\r\n     *\r\n     * 从边缘发出。\r\n     */\r\n    SingleSidedEdge = 12,\r\n}\r\n","/**\r\n * The emission shape (Shuriken).\r\n *\r\n * 发射的形状\r\n */\r\nexport enum ParticleSystemShapeType1\r\n{\r\n    /**\r\n     * Emit from a sphere.\r\n     *\r\n     * 从球体的体积中发射。\r\n     */\r\n    Sphere,\r\n\r\n    /**\r\n     * Emit from a half-sphere.\r\n     *\r\n     * 从半球体的体积发射。\r\n     */\r\n    Hemisphere,\r\n\r\n    /**\r\n     * Emit from a cone.\r\n     *\r\n     * 从圆锥体发射。\r\n     */\r\n    Cone,\r\n\r\n    /**\r\n     * Emit from the volume of a box.\r\n     *\r\n     * 从一个盒子的体积中发出。\r\n     */\r\n    Box,\r\n\r\n    /**\r\n     * Emit from a mesh.\r\n     *\r\n     * 从一个网格中发出。\r\n     *\r\n     * @todo\r\n     */\r\n    Mesh,\r\n\r\n    /**\r\n     * Emit from a mesh renderer.\r\n     *\r\n     * 从一个网格渲染器发射。\r\n     *\r\n     * @todo\r\n     */\r\n    MeshRenderer,\r\n\r\n    /**\r\n     * Emit from a skinned mesh renderer.\r\n     *\r\n     * 从蒙皮网格渲染器发出。\r\n     *\r\n     * @todo\r\n     */\r\n    SkinnedMeshRenderer,\r\n\r\n    /**\r\n     * Emit from a circle.\r\n     *\r\n     * 从一个圆发出。\r\n     */\r\n    Circle,\r\n\r\n    /**\r\n     * Emit from an edge.\r\n     *\r\n     * 从边缘发出。\r\n     */\r\n    Edge,\r\n}\r\n","/**\r\n * 粒子模拟空间\r\n */\r\nexport enum ParticleSystemSimulationSpace\r\n{\r\n    /**\r\n     * Simulate particles in local space.\r\n     *\r\n     * 模拟局部空间中的粒子。\r\n     */\r\n    Local = 0,\r\n\r\n    /**\r\n     * Simulate particles in world space.\r\n     *\r\n     * 模拟世界空间中的粒子。\r\n     */\r\n    World = 1,\r\n}\r\n","/**\r\n * The sorting mode for particle systems.\r\n */\r\nexport enum ParticleSystemSortMode\r\n{\r\n    /**\r\n     * No sorting.\r\n     */\r\n    None,\r\n\r\n    /**\r\n     * Sort based on distance.\r\n     */\r\n    Distance,\r\n\r\n    /**\r\n     * Sort the oldest particles to the front.\r\n     */\r\n    OldestInFront,\r\n\r\n    /**\r\n     * Sort the youngest particles to the front.\r\n     */\r\n    YoungestInFront,\r\n\r\n}\r\n","/**\r\n * The properties of sub-emitter particles.\r\n */\r\nexport enum ParticleSystemSubEmitterProperties\r\n{\r\n    /**\r\n     * When spawning new particles, do not inherit any properties from the parent particles.\r\n     */\r\n    InheritNothing,\r\n\r\n    /**\r\n     * When spawning new particles, inherit all available properties from the parent particles.\r\n     */\r\n    InheritEverything,\r\n\r\n    /**\r\n     * When spawning new particles, multiply the start color by the color of the parent particles.\r\n     */\r\n    InheritColor,\r\n\r\n    /**\r\n     * When spawning new particles, multiply the start size by the size of the parent particles.\r\n     */\r\n    InheritSize,\r\n\r\n    /**\r\n     * When spawning new particles, add the start rotation to the rotation of the parent particles.\r\n     */\r\n    InheritRotation,\r\n\r\n    /**\r\n     * New particles will have a shorter lifespan, the closer their parent particles are to death.\r\n     */\r\n    InheritLifetime,\r\n\r\n    /**\r\n     * When spawning new particles, use the duration and age properties from the parent system, when sampling MainModule curves in the Sub-Emitter.\r\n     */\r\n    InheritDuration,\r\n}\r\n","/**\r\n * The events that cause new particles to be spawned.\r\n *\r\n * 导致新粒子产生的事件。\r\n */\r\nexport enum ParticleSystemSubEmitterType\r\n{\r\n    /**\r\n     * Spawns new particles when particles from the parent system are born.\r\n     *\r\n     * 当来自父系统的粒子诞生时，产生新的粒子。\r\n     */\r\n    Birth,\r\n\r\n    /**\r\n     * Spawns new particles when particles from the parent system collide with something.\r\n     *\r\n     * 当来自父系统的粒子与某物碰撞时，产生新的粒子。\r\n     */\r\n    Collision,\r\n\r\n    /**\r\n     * Spawns new particles when particles from the parent system die.\r\n     *\r\n     * 当来自父系统的粒子死亡时，产生新的粒子。\r\n     */\r\n    Death,\r\n\r\n    /**\r\n     * Spawns new particles when particles from the parent system pass conditions in the Trigger Module.\r\n     *\r\n     * 当来自父系统的粒子通过触发器模块中的条件时，生成新的粒子。\r\n     */\r\n    Trigger,\r\n\r\n    /**\r\n     * Spawns new particles when triggered from script using ParticleSystem.TriggerSubEmitter.\r\n     *\r\n     * 当使用ParticleSystem.TriggerSubEmitter从脚本中触发时，生成新的粒子。\r\n     */\r\n    Manual,\r\n\r\n}\r\n","/**\r\n * This enum controls the mode under which the sprite will interact with the masking system.\r\n *\r\n * Sprites by default do not interact with masks SpriteMaskInteraction.None. A sprite can also be setup to be visible in presence of one or more masks SpriteMaskInteraction.VisibleInsideMask or to be visible on areas where no masks are present SpriteMaskInteraction.VisibleOutsideMask.\r\n */\r\nexport enum SpriteMaskInteraction\r\n{\r\n\r\n    /**\r\n     * The sprite will not interact with the masking system.\r\n     */\r\n    None,\r\n\r\n    /**\r\n     * The sprite will be visible only in areas where a mask is present.\r\n     */\r\n    VisibleInsideMask,\r\n\r\n    /**\r\n     * The sprite will be visible only in areas where no mask is present.\r\n     */\r\n    VisibleOutsideMask,\r\n\r\n}\r\n","/**\r\n * A flag representing each UV channel.\r\n * 一个代表每个紫外线频道的旗子。\r\n */\r\nexport enum UVChannelFlags\r\n{\r\n    /**\r\n     * 无通道。\r\n     */\r\n    Nothing = 0,\r\n    /**\r\n     * First UV channel.\r\n     * 第一UV通道。\r\n     */\r\n    UV0 = 1,\r\n    /**\r\n     * Second UV channel.\r\n     * 第二UV通道。\r\n     */\r\n    UV1 = 2,\r\n    /**\r\n     * Third UV channel.\r\n     * 第三UV通道。\r\n     */\r\n    UV2 = 4,\r\n    /**\r\n     * Fourth UV channel.\r\n     * 第四UV通道。\r\n     */\r\n    UV3 = 8,\r\n    /**\r\n     * All channel.\r\n     * 所有通道。\r\n     */\r\n    Everything = UV0 | UV1 | UV2 | UV3,\r\n}\r\n","import { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { EventEmitter } from '@feng3d/event';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleSystem } from '../ParticleSystem';\r\n\r\n/**\r\n * 粒子模块\r\n */\r\nexport class ParticleModule extends EventEmitter\r\n{\r\n    /**\r\n     * 是否开启\r\n     */\r\n    @oav({ tooltip: '是否开启' })\r\n    @serialize\r\n    enabled = false;\r\n\r\n    /**\r\n     * 粒子系统\r\n     */\r\n    particleSystem: ParticleSystem;\r\n\r\n    /**\r\n     * 初始化粒子状态\r\n     * @param _particle 粒子\r\n     */\r\n    initParticleState(_particle: Particle)\r\n    {\r\n\r\n    }\r\n\r\n    /**\r\n     * 更新粒子状态\r\n     * @param _particle 粒子\r\n     */\r\n    updateParticleState(_particle: Particle)\r\n    {\r\n\r\n    }\r\n\r\n    /**\r\n     * 更新\r\n     *\r\n     * @param _interval\r\n     */\r\n    update(_interval: number)\r\n    {\r\n    }\r\n}\r\n","import { Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleSystemShape } from './ParticleSystemShape';\r\n\r\nexport enum ParticleSystemShapeBoxEmitFrom\r\n{\r\n    /**\r\n     * 从盒子内部发射。\r\n     */\r\n    Volume,\r\n    /**\r\n     * 从盒子外壳发射。\r\n     */\r\n    Shell,\r\n    /**\r\n     * 从盒子边缘发射。\r\n     */\r\n    Edge,\r\n}\r\n\r\n/**\r\n * 粒子系统 发射盒子\r\n */\r\nexport class ParticleSystemShapeBox extends ParticleSystemShape\r\n{\r\n    /**\r\n     * 盒子X方向缩放。\r\n     */\r\n    @oav({ tooltip: '盒子X方向缩放。' })\r\n    get boxX()\r\n    {\r\n        return this._module.box.x;\r\n    }\r\n\r\n    set boxX(v)\r\n    {\r\n        this._module.box.x = v;\r\n    }\r\n\r\n    /**\r\n     * 盒子Y方向缩放。\r\n     */\r\n    @oav({ tooltip: '盒子Y方向缩放。' })\r\n    get boxY()\r\n    {\r\n        return this._module.box.y;\r\n    }\r\n\r\n    set boxY(v)\r\n    {\r\n        this._module.box.y = v;\r\n    }\r\n\r\n    /**\r\n     * 盒子Z方向缩放。\r\n     */\r\n    @oav({ tooltip: '盒子Z方向缩放。' })\r\n    get boxZ()\r\n    {\r\n        return this._module.box.z;\r\n    }\r\n\r\n    set boxZ(v)\r\n    {\r\n        this._module.box.z = v;\r\n    }\r\n\r\n    /**\r\n     * 粒子系统盒子发射类型。\r\n     */\r\n    @oav({ tooltip: '粒子系统盒子发射类型。', component: 'OAVEnum', componentParam: { enumClass: ParticleSystemShapeBoxEmitFrom } })\r\n    emitFrom = ParticleSystemShapeBoxEmitFrom.Volume;\r\n\r\n    /**\r\n     * 计算粒子的发射位置与方向\r\n     *\r\n     * @param particle\r\n     * @param position\r\n     * @param dir\r\n     */\r\n    calcParticlePosDir(particle: Particle, position: Vector3, dir: Vector3)\r\n    {\r\n        // 计算位置\r\n        position.copy(Vector3.random().scaleNumber(2).subNumber(1));\r\n\r\n        if (this.emitFrom === ParticleSystemShapeBoxEmitFrom.Shell)\r\n        {\r\n            const max = Math.max(Math.abs(position.x), Math.abs(position.y), Math.abs(position.z));\r\n            if (Math.abs(position.x) === max)\r\n            {\r\n                position.x = position.x < 0 ? -1 : 1;\r\n            }\r\n            else if (Math.abs(position.y) === max)\r\n            {\r\n                position.y = position.y < 0 ? -1 : 1;\r\n            }\r\n            else if (Math.abs(position.z) === max)\r\n            {\r\n                position.z = position.z < 0 ? -1 : 1;\r\n            }\r\n        }\r\n        else if (this.emitFrom === ParticleSystemShapeBoxEmitFrom.Edge)\r\n        {\r\n            const min = Math.min(Math.abs(position.x), Math.abs(position.y), Math.abs(position.z));\r\n            if (Math.abs(position.x) === min)\r\n            {\r\n                position.y = position.y < 0 ? -1 : 1;\r\n                position.z = position.z < 0 ? -1 : 1;\r\n            }\r\n            else if (Math.abs(position.y) === min)\r\n            {\r\n                position.x = position.x < 0 ? -1 : 1;\r\n                position.z = position.z < 0 ? -1 : 1;\r\n            }\r\n            else if (Math.abs(position.z) === min)\r\n            {\r\n                position.x = position.x < 0 ? -1 : 1;\r\n                position.y = position.y < 0 ? -1 : 1;\r\n            }\r\n        }\r\n        position.scale(new Vector3(this.boxX, this.boxY, this.boxZ)).scaleNumber(0.5);\r\n\r\n        //\r\n        dir.set(0, 0, 1);\r\n    }\r\n}\r\n","import { MinMaxGradient, Vector2 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { mathUtil } from '@feng3d/polyfill';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleModule } from './ParticleModule';\r\n\r\n/**\r\n * the Color By Speed module.\r\n *\r\n * 颜色随速度变化模块。\r\n */\r\nexport class ParticleColorBySpeedModule extends ParticleModule\r\n{\r\n    /**\r\n     * The gradient controlling the particle colors.\r\n     *\r\n     * 控制粒子颜色的梯度。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '控制粒子颜色的梯度。' })\r\n    color = new MinMaxGradient();\r\n\r\n    /**\r\n     * Apply the color gradient between these minimum and maximum speeds.\r\n     *\r\n     * 在这些最小和最大速度之间应用颜色渐变。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '在这些最小和最大速度之间应用颜色渐变。' })\r\n    range = new Vector2(0, 1);\r\n\r\n    /**\r\n     * 初始化粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    initParticleState(particle: Particle)\r\n    {\r\n        particle[ColorBySpeedRate] = Math.random();\r\n    }\r\n\r\n    /**\r\n     * 更新粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    updateParticleState(particle: Particle)\r\n    {\r\n        if (!this.enabled) return;\r\n\r\n        const velocity = particle.velocity.length;\r\n        const rate = mathUtil.clamp((velocity - this.range.x) / (this.range.y - this.range.x), 0, 1);\r\n        const color = this.color.getValue(rate, particle[ColorBySpeedRate]);\r\n        particle.color.multiply(color);\r\n    }\r\n}\r\nconst ColorBySpeedRate = '_ColorBySpeed_rate';\r\n","import { MinMaxGradient } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleModule } from './ParticleModule';\r\n\r\n/**\r\n * 粒子系统 颜色随时间变化模块\r\n */\r\nexport class ParticleColorOverLifetimeModule extends ParticleModule\r\n{\r\n    /**\r\n     * The gradient controlling the particle colors.\r\n     * 控制粒子颜色的梯度。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"The gradient controlling the particle colors.\" })\r\n    @oav({ tooltip: '控制粒子颜色的梯度。' })\r\n    color = new MinMaxGradient();\r\n\r\n    /**\r\n     * 初始化粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    initParticleState(particle: Particle)\r\n    {\r\n        particle[ColorOverLifetimeRate] = Math.random();\r\n    }\r\n\r\n    /**\r\n     * 更新粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    updateParticleState(particle: Particle)\r\n    {\r\n        if (!this.enabled) return;\r\n\r\n        particle.color.multiply(this.color.getValue(particle.rateAtLifeTime, particle[ColorOverLifetimeRate]));\r\n    }\r\n}\r\n\r\nconst ColorOverLifetimeRate = '_ColorOverLifetime_rate';\r\n\r\n","import { MinMaxCurve } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\n\r\nexport class ParticleEmissionBurst\r\n{\r\n    __class__: 'feng3d.ParticleEmissionBurst';\r\n\r\n    /**\r\n     * The time that each burst occurs.\r\n     * 每次爆炸发生的时间。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"The time that each burst occurs.\" })\r\n    @oav({ tooltip: '每次爆炸发生的时间。' })\r\n    time = 0;\r\n\r\n    /**\r\n     * 要发射的粒子数。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Number of particles to be emitted.\" })\r\n    @oav({ tooltip: '要发射的粒子数。' })\r\n    count = serialization.setValue(new MinMaxCurve(), { constant: 30, constantMin: 30, constantMax: 30 });\r\n\r\n    /**\r\n     * Minimum number of bursts to be emitted.\r\n     * 要发射的最小爆发数量。\r\n     */\r\n    get minCount()\r\n    {\r\n        return this.count.constantMin;\r\n    }\r\n\r\n    set minCount(v)\r\n    {\r\n        this.count.constantMin = v;\r\n    }\r\n\r\n    /**\r\n     * Maximum number of bursts to be emitted.\r\n     *\r\n     * 要发射的最大爆发数量。\r\n     */\r\n    get maxCount()\r\n    {\r\n        return this.count.constantMax;\r\n    }\r\n\r\n    set maxCount(v)\r\n    {\r\n        this.count.constantMax = v;\r\n    }\r\n\r\n    /**\r\n     * 喷发被触发的几率。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"The chance that the burst will trigger.\" })\r\n    @oav({ tooltip: '喷发被触发的几率。取值在0与1之间，默认1。' })\r\n    probability = 1.0;\r\n\r\n    /**\r\n     * 是否喷发\r\n     */\r\n    get isProbability()\r\n    {\r\n        return this._isProbability;\r\n    }\r\n\r\n    private _isProbability = true;\r\n\r\n    /**\r\n     * 通过触发的几率计算是否喷发。\r\n     */\r\n    calculateProbability()\r\n    {\r\n        this._isProbability = this.probability >= Math.random();\r\n\r\nreturn this._isProbability;\r\n    }\r\n}\r\n","import { MinMaxCurve } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { ParticleEmissionBurst } from '../others/ParticleEmissionBurst';\r\nimport { ParticleModule } from './ParticleModule';\r\n\r\n/**\r\n * 粒子系统发射模块。\r\n */\r\nexport class ParticleEmissionModule extends ParticleModule\r\n{\r\n    __class__: 'feng3d.ParticleEmissionModule';\r\n\r\n    /**\r\n     * 随着时间的推移，新粒子产生的速度。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"The rate at which new particles are spawned, over time.\" })\r\n    @oav({ tooltip: '随着时间的推移，新粒子产生的速度。' })\r\n    rateOverTime = serialization.setValue(new MinMaxCurve(), { between0And1: true, constant: 10, constantMin: 10, constantMax: 10, curveMultiplier: 10 });\r\n\r\n    /**\r\n     * Change the rate over time multiplier.\r\n     * This is more efficient than accessing the whole curve, if you only want to change the overall rate multiplier.\r\n     *\r\n     * 改变率随时间的乘数。\r\n     * 如果您只想更改整体的速率乘数，那么这比访问整个曲线更有效。\r\n     * 只在\r\n     */\r\n    get rateOverTimeMultiplier()\r\n    {\r\n        return this.rateOverTime.curveMultiplier;\r\n    }\r\n\r\n    set rateOverTimeMultiplier(v)\r\n    {\r\n        this.rateOverTime.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * The rate at which new particles are spawned, over distance.\r\n     * New particles will only be emitted when the emitter moves.\r\n     *\r\n     * 产生新粒子的速度，通过距离。\r\n     * 新粒子只有世界空间模拟且发射器移动时才会被发射出来。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"The rate at which new particles are spawned, over distance.\" })\r\n    @oav({ tooltip: '产生新粒子的速度，通过距离。新粒子只有世界空间模拟且发射器移动时才会被发射出来。' })\r\n    rateOverDistance = serialization.setValue(new MinMaxCurve(), { between0And1: true, constant: 0, constantMin: 0, constantMax: 1 });\r\n\r\n    /**\r\n     * Change the rate over distance multiplier.\r\n     * This is more efficient than accessing the whole curve, if you only want to change the overall rate multiplier.\r\n     *\r\n     * 改变速率随距离变化的乘数。\r\n     * 如果您只想更改整体的速率乘数，那么这比访问整个曲线更有效。\r\n     */\r\n    get rateOverDistanceMultiplier()\r\n    {\r\n        return this.rateOverDistance.curveMultiplier;\r\n    }\r\n\r\n    set rateOverDistanceMultiplier(v)\r\n    {\r\n        this.rateOverDistance.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * 爆发数组\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVArray', tooltip: '在指定时间进行额外发射指定数量的粒子', componentParam: { defaultItem: () => new ParticleEmissionBurst() } })\r\n    bursts: ParticleEmissionBurst[] = [];\r\n\r\n    /**\r\n     * The current number of bursts.\r\n     *\r\n     * 当前的爆发次数。\r\n     */\r\n    get burstCount()\r\n    {\r\n        return this.bursts.length;\r\n    }\r\n\r\n    /**\r\n     * Get the burst array.\r\n     * 获取爆发数组。\r\n     *\r\n     * @param bursts Array of bursts to be filled in.要填充的爆发数组。\r\n     * @returns The number of bursts in the array.数组中的爆发次数。\r\n     */\r\n    getBursts(bursts: ParticleEmissionBurst[])\r\n    {\r\n        bursts.length = this.bursts.length;\r\n        for (let i = 0, n = bursts.length; i < n; i++)\r\n        {\r\n            bursts[i] = this.bursts[i];\r\n        }\r\n\r\n        return bursts.length;\r\n    }\r\n\r\n    /**\r\n     * Set the burst array.\r\n     * 设置爆发数组。\r\n     *\r\n     * @param bursts Array of bursts.爆发的数组。\r\n     * @param size Optional array size, if burst count is less than array size.可选的数组大小，如果爆发计数小于数组大小。\r\n     */\r\n    setBursts(bursts: ParticleEmissionBurst[], size: number = Number.MAX_SAFE_INTEGER)\r\n    {\r\n        size = Math.min(bursts.length, size);\r\n        for (let i = 0; i < size; i++)\r\n        {\r\n            this.bursts[i] = bursts[i];\r\n        }\r\n    }\r\n}\r\n","import { MinMaxCurveVector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { ParticleSystemSimulationSpace } from '../enums/ParticleSystemSimulationSpace';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleModule } from './ParticleModule';\r\n\r\n/**\r\n * 粒子系统 作用在粒子上的力随时间变化模块\r\n *\r\n * 控制每个粒子在其生命周期内的力。\r\n * Script interface for the Force Over Lifetime module.\r\n */\r\nexport class ParticleForceOverLifetimeModule extends ParticleModule\r\n{\r\n    /**\r\n     * 作用在粒子上的力\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '作用在粒子上的力' })\r\n    force = new MinMaxCurveVector3();\r\n\r\n    /**\r\n     * Are the forces being applied in local or world space?\r\n     *\r\n     * 这些力是作用于局部空间还是世界空间\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Are the forces being applied in local or world space?\", component: \"OAVEnum\", componentParam: { enumClass: ParticleSystemSimulationSpace } })\r\n    @oav({ tooltip: '这些力是作用于局部空间还是世界空间?', component: 'OAVEnum', componentParam: { enumClass: ParticleSystemSimulationSpace } })\r\n    space = ParticleSystemSimulationSpace.Local;\r\n\r\n    /**\r\n     * When randomly selecting values between two curves or constants, this flag will cause a new random force to be chosen on each frame.\r\n     *\r\n     * 当在两条曲线或常数之间随机选择值时，此标志将导致在每一帧上选择一个新的随机力。\r\n     *\r\n     * @todo\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"When randomly selecting values between two curves or constants, this flag will cause a new random force to be chosen on each frame.\" })\r\n    @oav({ tooltip: '当在两条曲线或常数之间随机选择值时，此标志将导致在每一帧上选择一个新的随机力。' })\r\n    randomized = false;\r\n\r\n    /**\r\n     * The curve defining particle forces in the X axis.\r\n     *\r\n     * 在X轴上定义粒子力的曲线。\r\n     */\r\n    get x()\r\n    {\r\n        return this.force.xCurve;\r\n    }\r\n\r\n    set x(v)\r\n    {\r\n        this.force.xCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Change the X axis mulutiplier.\r\n     *\r\n     * 改变X轴的乘数。\r\n     */\r\n    get xMultiplier()\r\n    {\r\n        return this.x.curveMultiplier;\r\n    }\r\n\r\n    set xMultiplier(v)\r\n    {\r\n        this.x.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * The curve defining particle forces in the Y axis.\r\n     *\r\n     * 在Y轴上定义粒子力的曲线。\r\n     */\r\n    get y()\r\n    {\r\n        return this.force.yCurve;\r\n    }\r\n\r\n    set y(v)\r\n    {\r\n        this.force.yCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Change the Y axis mulutiplier.\r\n     *\r\n     * 改变Y轴的乘数。\r\n     */\r\n    get yMultiplier()\r\n    {\r\n        return this.y.curveMultiplier;\r\n    }\r\n\r\n    set yMultiplier(v)\r\n    {\r\n        this.y.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * The curve defining particle forces in the Z axis.\r\n     *\r\n     * 在Z轴上定义粒子力的曲线。\r\n     */\r\n    get z()\r\n    {\r\n        return this.force.zCurve;\r\n    }\r\n\r\n    set z(v)\r\n    {\r\n        this.force.zCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Change the Z axis mulutiplier.\r\n     *\r\n     * 改变Z轴的乘数。\r\n     */\r\n    get zMultiplier()\r\n    {\r\n        return this.z.curveMultiplier;\r\n    }\r\n\r\n    set zMultiplier(v)\r\n    {\r\n        this.z.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * 初始化粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    initParticleState(particle: Particle)\r\n    {\r\n        particle[ForceOverLifetimeRate] = Math.random();\r\n    }\r\n\r\n    /**\r\n     * 更新粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    updateParticleState(particle: Particle)\r\n    {\r\n        this.particleSystem.removeParticleAcceleration(particle, ForceOverLifetimePreForce);\r\n        if (!this.enabled) return;\r\n\r\n        const force = this.force.getValue(particle.rateAtLifeTime, particle[ForceOverLifetimeRate]);\r\n        this.particleSystem.addParticleAcceleration(particle, force, this.space, ForceOverLifetimePreForce);\r\n    }\r\n}\r\nconst ForceOverLifetimeRate = '_ForceOverLifetime_rate';\r\nconst ForceOverLifetimePreForce = '_ForceOverLifetime_preForce';\r\n","import { MinMaxCurve } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { ParticleSystemInheritVelocityMode } from '../enums/ParticleSystemInheritVelocityMode';\r\nimport { ParticleSystemSimulationSpace } from '../enums/ParticleSystemSimulationSpace';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleModule } from './ParticleModule';\r\n\r\n/**\r\n * The Inherit Velocity Module controls how the velocity of the emitter is transferred to the particles as they are emitted.\r\n *\r\n * 遗传速度模块控制发射体的速度在粒子发射时如何传递到粒子上。（只有粒子系统在世界空间中模拟时生效）\r\n */\r\nexport class ParticleInheritVelocityModule extends ParticleModule\r\n{\r\n    '__class__': 'feng3d.ParticleInheritVelocityModule' = 'feng3d.ParticleInheritVelocityModule';\r\n\r\n    /**\r\n     * How to apply emitter velocity to particles.\r\n     *\r\n     * 如何将发射体速度应用于粒子。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '如何将发射体速度应用于粒子。', component: 'OAVEnum', componentParam: { enumClass: ParticleSystemInheritVelocityMode } })\r\n    mode = ParticleSystemInheritVelocityMode.Initial;\r\n\r\n    /**\r\n     * Curve to define how much emitter velocity is applied during the lifetime of a particle.\r\n     *\r\n     * 曲线，用来定义在粒子的生命周期内应用了多少发射速度。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '曲线，用来定义在粒子的生命周期内应用了多少发射速度。' })\r\n    multiplier = serialization.setValue(new MinMaxCurve(), { constant: 1, constantMin: 1, constantMax: 1 });\r\n\r\n    /**\r\n     * Curve to define how much emitter velocity is applied during the lifetime of a particle.\r\n     *\r\n     * 曲线，用来定义在粒子的生命周期内应用了多少发射速度。\r\n     */\r\n    get curve()\r\n    {\r\n        return this.multiplier;\r\n    }\r\n\r\n    set curve(v)\r\n    {\r\n        this.multiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Change the curve multiplier.\r\n     *\r\n     * 改变曲线的乘数。\r\n     */\r\n    get curveMultiplier()\r\n    {\r\n        return this.multiplier.curveMultiplier;\r\n    }\r\n\r\n    set curveMultiplier(v)\r\n    {\r\n        this.multiplier.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * 初始化粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    initParticleState(particle: Particle)\r\n    {\r\n        particle[InheritVelocityRate] = Math.random();\r\n\r\n        if (!this.enabled) return;\r\n        if (this.particleSystem.main.simulationSpace === ParticleSystemSimulationSpace.Local) return;\r\n        if (this.mode !== ParticleSystemInheritVelocityMode.Initial) return;\r\n\r\n        const multiplier = this.multiplier.getValue(particle.rateAtLifeTime, particle[InheritVelocityRate]);\r\n        particle.velocity.addScaledVector(multiplier, this.particleSystem._emitInfo.speed);\r\n    }\r\n\r\n    /**\r\n     * 更新粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    updateParticleState(particle: Particle)\r\n    {\r\n        if (!this.enabled) return;\r\n        if (this.particleSystem.main.simulationSpace === ParticleSystemSimulationSpace.Local) return;\r\n        if (this.mode !== ParticleSystemInheritVelocityMode.Current) return;\r\n\r\n        const multiplier = this.multiplier.getValue(particle.rateAtLifeTime, particle[InheritVelocityRate]);\r\n        particle.position.addScaledVector(multiplier, this.particleSystem._emitInfo.moveVec);\r\n    }\r\n}\r\nconst InheritVelocityRate = '_InheritVelocity_rate';\r\n","import { Matrix4x4, MinMaxCurve, MinMaxCurveVector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { ParticleSystemSimulationSpace } from '../enums/ParticleSystemSimulationSpace';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleModule } from './ParticleModule';\r\n\r\n/**\r\n * Limit Velocity Over Lifetime module.\r\n *\r\n * 基于时间轴限制速度模块。\r\n */\r\nexport class ParticleLimitVelocityOverLifetimeModule extends ParticleModule\r\n{\r\n    __class__: 'feng3d.ParticleLimitVelocityOverLifetimeModule';\r\n\r\n    /**\r\n     * Set the size over lifetime on each axis separately.\r\n     *\r\n     * 在每个轴上分别设置生命周期内的大小。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Set the size over lifetime on each axis separately.\" })\r\n    @oav({ tooltip: '在每个轴上分别设置生命周期内的大小。' })\r\n    separateAxes = false;\r\n\r\n    /**\r\n     * Maximum velocity curve, when not using one curve per axis.\r\n     *\r\n     * 最大速度曲线，当不使用每轴一个曲线时。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Maximum velocity curve, when not using one curve per axis.\" })\r\n    @oav({ tooltip: '最大速度曲线，当不使用每轴一个曲线时。' })\r\n    limit = serialization.setValue(new MinMaxCurve(), { between0And1: true, constant: 1, constantMin: 1, constantMax: 1 });\r\n\r\n    /**\r\n     * Maximum velocity.\r\n     *\r\n     * 最高速度。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Maximum velocity.\" })\r\n    @oav({ tooltip: '最高速度。' })\r\n    limit3D = serialization.setValue(new MinMaxCurveVector3(), { xCurve: { between0And1: true, constant: 1, constantMin: 1, constantMax: 1 }, yCurve: { between0And1: true, constant: 1, constantMin: 1, constantMax: 1 }, zCurve: { between0And1: true, constant: 1, constantMin: 1, constantMax: 1 } });\r\n\r\n    /**\r\n     * Specifies if the velocities are in local space (rotated with the transform) or world space.\r\n     *\r\n     * 指定速度是在局部空间(与变换一起旋转)还是在世界空间。\r\n     */\r\n    // @oav({ tooltip: \"Specifies if the velocities are in local space (rotated with the transform) or world space.\", component: \"OAVEnum\", componentParam: { enumClass: ParticleSystemSimulationSpace } })\r\n    @serialize\r\n    @oav({ tooltip: '指定速度是在局部空间(与变换一起旋转)还是在世界空间。', component: 'OAVEnum', componentParam: { enumClass: ParticleSystemSimulationSpace } })\r\n    space = ParticleSystemSimulationSpace.Local;\r\n\r\n    /**\r\n     * Controls how much the velocity that exceeds the velocity limit should be dampened.\r\n     *\r\n     * 控制多少速度，超过速度限制应该被抑制。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Controls how much the velocity that exceeds the velocity limit should be dampened.\", component: \"OAVEnum\", componentParam: { enumClass: ParticleSystemSimulationSpace } })\r\n    @oav({ tooltip: '控制多少速度，超过速度限制应该被抑制。' })\r\n    dampen = 1;\r\n\r\n    /**\r\n     * Change the limit multiplier.\r\n     *\r\n     * 改变限制乘法因子。\r\n     */\r\n    get limitMultiplier()\r\n    {\r\n        return this.limit.curveMultiplier;\r\n    }\r\n\r\n    set limitMultiplier(v)\r\n    {\r\n        this.limit.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Maximum velocity curve for the X axis.\r\n     *\r\n     * X轴的最大速度曲线。\r\n     */\r\n    get limitX()\r\n    {\r\n        return this.limit3D.xCurve;\r\n    }\r\n\r\n    set limitX(v)\r\n    {\r\n        this.limit3D.xCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Change the limit multiplier on the X axis.\r\n     *\r\n     * 改变X轴上的极限乘法器。\r\n     */\r\n    get limitXMultiplier()\r\n    {\r\n        return this.limit3D.xCurve.curveMultiplier;\r\n    }\r\n\r\n    set limitXMultiplier(v)\r\n    {\r\n        this.limit3D.xCurve.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Maximum velocity curve for the Y axis.\r\n     *\r\n     * Y轴的最大速度曲线。\r\n     */\r\n    get limitY()\r\n    {\r\n        return this.limit3D.yCurve;\r\n    }\r\n\r\n    set limitY(v)\r\n    {\r\n        this.limit3D.yCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Change the limit multiplier on the Y axis.\r\n     *\r\n     * 改变Y轴上的极限乘法器。\r\n     */\r\n    get limitYMultiplier()\r\n    {\r\n        return this.limit3D.yCurve.curveMultiplier;\r\n    }\r\n\r\n    set limitYMultiplier(v)\r\n    {\r\n        this.limit3D.yCurve.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Maximum velocity curve for the Z axis.\r\n     *\r\n     * Z轴的最大速度曲线。\r\n     */\r\n    get limitZ()\r\n    {\r\n        return this.limit3D.zCurve;\r\n    }\r\n\r\n    set limitZ(v)\r\n    {\r\n        this.limit3D.zCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Change the limit multiplier on the Z axis.\r\n     *\r\n     * 更改Z轴上的极限乘法器。\r\n     */\r\n    get limitZMultiplier()\r\n    {\r\n        return this.limit3D.zCurve.curveMultiplier;\r\n    }\r\n\r\n    set limitZMultiplier(v)\r\n    {\r\n        this.limit3D.zCurve.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * 初始化粒子状态\r\n     *\r\n     * @param particle 粒子\r\n     */\r\n    initParticleState(particle: Particle)\r\n    {\r\n        particle[LimitVelocityOverLifetimeRate] = Math.random();\r\n    }\r\n\r\n    /**\r\n     * 更新粒子状态\r\n     *\r\n     * @param particle 粒子\r\n     */\r\n    updateParticleState(particle: Particle)\r\n    {\r\n        if (!this.enabled) return;\r\n\r\n        const limit3D = this.limit3D.getValue(particle.rateAtLifeTime, particle[LimitVelocityOverLifetimeRate]);\r\n        const limit = this.limit.getValue(particle.rateAtLifeTime, particle[LimitVelocityOverLifetimeRate]);\r\n        const pVelocity = particle.velocity.clone();\r\n\r\n        // 计算变换矩阵\r\n        const mat = new Matrix4x4();\r\n        //\r\n        if (this.space !== this.particleSystem.main.simulationSpace)\r\n        {\r\n            if (this.space === ParticleSystemSimulationSpace.World)\r\n            {\r\n                mat.copy(this.particleSystem.transform.localToWorldMatrix);\r\n            }\r\n            else\r\n            {\r\n                mat.copy(this.particleSystem.transform.worldToLocalMatrix);\r\n            }\r\n        }\r\n        // 变换到现在空间进行限速\r\n        mat.transformVector3(pVelocity, pVelocity);\r\n        if (this.separateAxes)\r\n        {\r\n            pVelocity.clamp(limit3D.negateTo(), limit3D);\r\n        }\r\n        else\r\n            if (pVelocity.lengthSquared > limit * limit)\r\n            { pVelocity.normalize(limit); }\r\n        mat.invert();\r\n        // 还原到原空间\r\n        mat.transformVector3(pVelocity, pVelocity);\r\n        //\r\n        particle.velocity.lerpNumber(pVelocity, this.dampen);\r\n    }\r\n}\r\n\r\nconst LimitVelocityOverLifetimeRate = '_LimitVelocityOverLifetime_rate';\r\n","import { MinMaxCurve, MinMaxCurveVector3, MinMaxGradient, Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { ParticleSystemScalingMode } from '../enums/ParticleSystemScalingMode';\r\nimport { ParticleSystemSimulationSpace } from '../enums/ParticleSystemSimulationSpace';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleModule } from './ParticleModule';\r\n\r\n/**\r\n * 粒子主模块\r\n */\r\nexport class ParticleMainModule extends ParticleModule\r\n{\r\n    __class__: 'feng3d.ParticleMainModule';\r\n\r\n    @oav({ exclude: true })\r\n    enabled = true;\r\n\r\n    /**\r\n     * 粒子系统的持续时间(秒)。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"The duration of the particle system in seconds.\" })\r\n    @oav({ tooltip: '粒子系统的持续时间(秒)。' })\r\n    duration = 5;\r\n\r\n    /**\r\n     * 粒子系统在循环吗?\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Is the particle system looping?\" })\r\n    @oav({ tooltip: '粒子系统在循环吗?' })\r\n    loop = true;\r\n\r\n    /**\r\n     * When looping is enabled, this controls whether this particle system will look like it has already simulated for one loop when first becoming visible.\r\n     *\r\n     * 当循环被激活时，它控制这个粒子系统在第一次出现时是否看起来像已经模拟了一个循环。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"When looping is enabled, this controls whether this particle system will look like it has already simulated for one loop when first becoming visible.\" })\r\n    @oav({ tooltip: '当循环被激活时，它控制这个粒子系统在第一次出现时是否看起来像已经模拟了一个循环。' })\r\n    prewarm = false;\r\n\r\n    /**\r\n     * Start delay in seconds.\r\n     *\r\n     * 启动延迟(以秒为单位)。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Start delay in seconds.\" })\r\n    @oav({ tooltip: '启动延迟(以秒为单位)。' })\r\n    startDelay = new MinMaxCurve();\r\n\r\n    /**\r\n     * Start delay multiplier in seconds.\r\n     *\r\n     * 启动延迟乘数(以秒为单位)。\r\n     */\r\n    get startDelayMultiplier()\r\n    {\r\n        return this.startDelay.curveMultiplier;\r\n    }\r\n\r\n    /**\r\n     * The total lifetime in seconds that each new particle will have.\r\n     *\r\n     * 每个新粒子的总寿命(以秒计)。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"The total lifetime in seconds that each new particle will have.\" })\r\n    @oav({ tooltip: '每个新粒子的总寿命(以秒计)。' })\r\n    startLifetime = serialization.setValue(new MinMaxCurve(), { between0And1: true, constant: 5, constantMin: 5, constantMax: 5 });\r\n\r\n    /**\r\n     * Start lifetime multiplier.\r\n     * This method is more efficient than accessing the whole curve, if you only want to change the overall lifetime multiplier.\r\n     *\r\n     * 起始寿命乘数。\r\n     * 如果您只想更改总体寿命乘数，则此方法比访问整个曲线更有效。\r\n     */\r\n    get startLifetimeMultiplier()\r\n    {\r\n        return this.startLifetime.curveMultiplier;\r\n    }\r\n\r\n    set startLifetimeMultiplier(v)\r\n    {\r\n        this.startLifetime.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * The initial speed of particles when emitted.\r\n     *\r\n     * 粒子发射时的初始速度。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"The initial speed of particles when emitted.\" })\r\n    @oav({ tooltip: '粒子发射时的初始速度。' })\r\n    startSpeed = serialization.setValue(new MinMaxCurve(), { constant: 5, constantMin: 5, constantMax: 5 });\r\n\r\n    /**\r\n     * A multiplier of the initial speed of particles when emitted.\r\n     * This method is more efficient than accessing the whole curve, if you only want to change the overall speed multiplier.\r\n     *\r\n     * 粒子发射时的初始速度的乘子。\r\n     * 这种方法比访问整个曲线更有效，如果你只想改变整体速度乘数。\r\n     */\r\n    get startSpeedMultiplier()\r\n    {\r\n        return this.startSpeed.curveMultiplier;\r\n    }\r\n\r\n    set startSpeedMultiplier(v)\r\n    {\r\n        this.startSpeed.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * A flag to enable specifying particle size individually for each axis.\r\n     *\r\n     * 允许为每个轴分别指定粒度大小的标志。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"A flag to enable specifying particle size individually for each axis.\" })\r\n    @oav({ tooltip: '允许为每个轴分别指定粒度大小的标志。' })\r\n    useStartSize3D = false;\r\n\r\n    /**\r\n     * The initial size of particles when emitted.\r\n     *\r\n     * 粒子发射时的初始大小。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"The initial size of particles when emitted.\" })\r\n    @oav({ tooltip: '粒子发射时的初始大小。' })\r\n    get startSize()\r\n    {\r\n        return this.startSize3D.xCurve;\r\n    }\r\n\r\n    set startSize(v)\r\n    {\r\n        this.startSize3D.xCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Start size multiplier.\r\n     * This method is more efficient than accessing the whole curve, if you only want to change the overall size multiplier.\r\n     *\r\n     * 开始尺寸乘数。\r\n     * 如果您只想更改整体尺寸倍增器，则此方法比访问整个曲线更有效。\r\n     */\r\n    get startSizeMultiplier()\r\n    {\r\n        return this.startSize.curveMultiplier;\r\n    }\r\n\r\n    set startSizeMultiplier(v)\r\n    {\r\n        this.startSize.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * The initial size of particles when emitted.\r\n     *\r\n     * 发射时粒子的初始大小。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"The initial size of particles when emitted.\" })\r\n    @oav({ tooltip: '发射时粒子的初始大小。' })\r\n    startSize3D = serialization.setValue(new MinMaxCurveVector3(), { xCurve: { between0And1: true, constant: 1, constantMin: 1, constantMax: 1 }, yCurve: { between0And1: true, constant: 1, constantMin: 1, constantMax: 1 }, zCurve: { between0And1: true, constant: 1, constantMin: 1, constantMax: 1 } });\r\n\r\n    /**\r\n     * The initial size of particles along the X axis when emitted.\r\n     *\r\n     * 发射时沿X轴的粒子的初始大小。\r\n     */\r\n    get startSizeX()\r\n    {\r\n        return this.startSize3D.xCurve;\r\n    }\r\n\r\n    set startSizeX(v)\r\n    {\r\n        this.startSize3D.xCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Start rotation multiplier along the X axis.\r\n     * This method is more efficient than accessing the whole curve, if you only want to change the overall size multiplier.\r\n     *\r\n     * 启动旋转乘法器沿X轴。\r\n     * 如果您只想更改整体大小倍增器，则此方法比访问整个曲线更有效。\r\n     */\r\n    get startSizeXMultiplier()\r\n    {\r\n        return this.startSizeX.curveMultiplier;\r\n    }\r\n\r\n    set startSizeXMultiplier(v)\r\n    {\r\n        this.startSizeX.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * The initial size of particles along the Y axis when emitted.\r\n     *\r\n     * 发射时沿Y轴的粒子的初始大小。\r\n     */\r\n    get startSizeY()\r\n    {\r\n        return this.startSize3D.yCurve;\r\n    }\r\n\r\n    set startSizeY(v)\r\n    {\r\n        this.startSize3D.yCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Start rotation multiplier along the Y axis.\r\n     * This method is more efficient than accessing the whole curve, if you only want to change the overall size multiplier.\r\n     *\r\n     * 启动旋转乘法器沿Y轴。\r\n     * 如果您只想更改整体大小倍增器，则此方法比访问整个曲线更有效。\r\n     */\r\n    get startSizeYMultiplier()\r\n    {\r\n        return this.startSizeY.curveMultiplier;\r\n    }\r\n\r\n    set startSizeYMultiplier(v)\r\n    {\r\n        this.startSizeY.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * The initial size of particles along the Z axis when emitted.\r\n     *\r\n     * 发射时沿Z轴的粒子的初始大小。\r\n     */\r\n    get startSizeZ()\r\n    {\r\n        return this.startSize3D.zCurve;\r\n    }\r\n\r\n    set startSizeZ(v)\r\n    {\r\n        this.startSize3D.zCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Start rotation multiplier along the Z axis.\r\n     * This method is more efficient than accessing the whole curve, if you only want to change the overall size multiplier.\r\n     *\r\n     * 启动旋转乘法器沿Z轴。\r\n     * 如果您只想更改整体大小倍增器，则此方法比访问整个曲线更有效。\r\n     */\r\n    get startSizeZMultiplier()\r\n    {\r\n        return this.startSizeZ.curveMultiplier;\r\n    }\r\n\r\n    set startSizeZMultiplier(v)\r\n    {\r\n        this.startSizeZ.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * A flag to enable 3D particle rotation.\r\n     * 一个启用粒子3D旋转的标记。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"A flag to enable 3D particle rotation.\" })\r\n    @oav({ tooltip: '一个启用粒子3D旋转的标记。' })\r\n    useStartRotation3D = false;\r\n\r\n    /**\r\n     * The initial rotation of particles when emitted.\r\n     * 粒子发射时的初始旋转。\r\n     */\r\n    // @oav({ tooltip: \"The initial rotation of particles when emitted.\" })\r\n    @oav({ tooltip: '粒子发射时的初始旋转。' })\r\n    get startRotation()\r\n    {\r\n        return this.startRotation3D.zCurve;\r\n    }\r\n\r\n    set startRotation(v)\r\n    {\r\n        this.startRotation3D.zCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Start rotation multiplier.\r\n     * This method is more efficient than accessing the whole curve, if you only want to change the overall rotation multiplier.\r\n     *\r\n     * 开始旋转乘数。\r\n     * 这种方法比访问整个曲线更有效，如果你只想改变整体旋转乘数。\r\n     */\r\n    get startRotationMultiplier()\r\n    {\r\n        return this.startRotation.curveMultiplier;\r\n    }\r\n\r\n    set startRotationMultiplier(v)\r\n    {\r\n        this.startRotation.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * The initial rotation of particles when emitted.\r\n     *\r\n     * 粒子发射时的初始旋转。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"The initial rotation of particles when emitted.\" })\r\n    @oav({ tooltip: '粒子发射时的初始旋转。' })\r\n    startRotation3D = serialization.setValue(new MinMaxCurveVector3(), { xCurve: { curveMultiplier: 180 }, yCurve: { curveMultiplier: 180 }, zCurve: { curveMultiplier: 180 } });\r\n\r\n    /**\r\n     * The initial rotation of particles around the X axis when emitted.\r\n     *\r\n     * 发射时粒子围绕X轴的初始旋转。\r\n     */\r\n    get startRotationX()\r\n    {\r\n        return this.startRotation3D.xCurve;\r\n    }\r\n\r\n    set startRotationX(v)\r\n    {\r\n        this.startRotation3D.xCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Start rotation multiplier around the X axis.\r\n     * This method is more efficient than accessing the whole curve, if you only want to change the overall rotation multiplier.\r\n     *\r\n     * 开始绕X轴旋转乘法器。\r\n     * 这种方法比访问整个曲线更有效，如果你只想改变整体旋转乘数。\r\n     */\r\n    get startRotationXMultiplier()\r\n    {\r\n        return this.startRotationX.curveMultiplier;\r\n    }\r\n\r\n    set startRotationXMultiplier(v)\r\n    {\r\n        this.startRotationX.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * The initial rotation of particles around the Y axis when emitted.\r\n     *\r\n     * 发射时粒子围绕Y轴的初始旋转。\r\n     */\r\n    get startRotationY()\r\n    {\r\n        return this.startRotation3D.yCurve;\r\n    }\r\n\r\n    set startRotationY(v)\r\n    {\r\n        this.startRotation3D.yCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Start rotation multiplier around the Y axis.\r\n     * This method is more efficient than accessing the whole curve, if you only want to change the overall rotation multiplier.\r\n     *\r\n     * 开始绕Y轴旋转乘法器。\r\n     * 这种方法比访问整个曲线更有效，如果你只想改变整体旋转乘数。\r\n     */\r\n    get startRotationYMultiplier()\r\n    {\r\n        return this.startRotationY.curveMultiplier;\r\n    }\r\n\r\n    set startRotationYMultiplier(v)\r\n    {\r\n        this.startRotationY.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * The initial rotation of particles around the Z axis when emitted.\r\n     *\r\n     * 发射时粒子围绕Z轴的初始旋转。\r\n     */\r\n    get startRotationZ()\r\n    {\r\n        return this.startRotation3D.zCurve;\r\n    }\r\n\r\n    set startRotationZ(v)\r\n    {\r\n        this.startRotation3D.zCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Start rotation multiplier around the Z axis.\r\n     * This method is more efficient than accessing the whole curve, if you only want to change the overall rotation multiplier.\r\n     *\r\n     * 开始绕Z轴旋转乘法器。\r\n     * 这种方法比访问整个曲线更有效，如果你只想改变整体旋转乘数。\r\n     */\r\n    get startRotationZMultiplier()\r\n    {\r\n        return this.startRotationZ.curveMultiplier;\r\n    }\r\n\r\n    set startRotationZMultiplier(v)\r\n    {\r\n        this.startRotationZ.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Cause some particles to spin in the opposite direction. Set between 0 and 1, where higher values will cause a higher proportion of particles to spin in the opposite direction.\r\n     *\r\n     * 导致一些粒子向相反的方向旋转。设置在0和1之间，数值越大，粒子朝相反方向旋转的比例越大。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Cause some particles to spin in the opposite direction. Set between 0 and 1, where higher values will cause a higher proportion of particles to spin in the opposite direction.\" })\r\n    @oav({ tooltip: '导致一些粒子向相反的方向旋转。设置在0和1之间，数值越大，粒子朝相反方向旋转的比例越大。' })\r\n    randomizeRotationDirection = 0;\r\n\r\n    /**\r\n     * The initial color of particles when emitted.\r\n     *\r\n     * 粒子发射时的初始颜色。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"The initial color of particles when emitted.\" })\r\n    @oav({ tooltip: '粒子发射时的初始颜色。' })\r\n    startColor = new MinMaxGradient();\r\n\r\n    /**\r\n     * Scale applied to the gravity.\r\n     *\r\n     * 应用于重力加速度的缩放。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Scale applied to the gravity.\" })\r\n    @oav({ tooltip: '应用于重力加速度的缩放。' })\r\n    gravityModifier = new MinMaxCurve();\r\n\r\n    /**\r\n     * This selects the space in which to simulate particles. It can be either world or local space.\r\n     *\r\n     * 模拟空间，使粒子位置模拟在世界，本地或自定义空间。在本地空间中，它们相对于自己的转换而存在，在自定义空间中，它们相对于自定义转换。\r\n     *\r\n     * @todo\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"This selects the space in which to simulate particles. It can be either world or local space.\", component: \"OAVEnum\", componentParam: { enumClass: ParticleSystemSimulationSpace } })\r\n    @oav({ tooltip: '模拟空间，使粒子位置模拟在世界，本地或自定义空间。在本地空间中，它们相对于自己的转换而存在，在自定义空间中，它们相对于自定义转换。', component: 'OAVEnum', componentParam: { enumClass: ParticleSystemSimulationSpace } })\r\n    simulationSpace = ParticleSystemSimulationSpace.Local;\r\n\r\n    /**\r\n     * Override the default playback speed of the Particle System.\r\n     *\r\n     * 重写粒子系统的默认播放速度。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Override the default playback speed of the Particle System.\" })\r\n    @oav({ tooltip: '重写粒子系统的默认播放速度。' })\r\n    simulationSpeed = 1;\r\n\r\n    /**\r\n     * Control how the particle system's Transform Component is applied to the particle system.\r\n     *\r\n     * 控制粒子系统的变换组件如何应用于粒子系统。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Control how the particle system's Transform Component is applied to the particle system.\", component: \"OAVEnum\", componentParam: { enumClass: ParticleSystemScalingMode } })\r\n    @oav({ tooltip: '控制粒子系统的变换组件如何应用于粒子系统。', component: 'OAVEnum', componentParam: { enumClass: ParticleSystemScalingMode } })\r\n    scalingMode = ParticleSystemScalingMode.Local;\r\n\r\n    /**\r\n     * If set to true, the particle system will automatically start playing on startup.\r\n     *\r\n     * 如果设置为真，粒子系统将自动开始播放启动。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"If set to true, the particle system will automatically start playing on startup.\" })\r\n    @oav({ tooltip: '如果设置为真，粒子系统将自动开始播放启动。' })\r\n    playOnAwake = true;\r\n\r\n    /**\r\n     * The maximum number of particles to emit.\r\n     *\r\n     * 发射粒子的最大数量。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"The maximum number of particles to emit.\" })\r\n    @oav({ tooltip: '发射粒子的最大数量。' })\r\n    maxParticles = 1000;\r\n\r\n    constructor()\r\n    {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * 初始化粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    initParticleState(particle: Particle)\r\n    {\r\n        //\r\n        const birthRateAtDuration = particle.birthRateAtDuration;\r\n\r\n        particle.velocity.set(0, 0, 0);\r\n        particle.acceleration.set(0, 0, 0);\r\n        if (this.useStartSize3D)\r\n        {\r\n            particle.startSize.copy(this.startSize3D.getValue(birthRateAtDuration));\r\n        }\r\n        else\r\n        {\r\n            const startSize = this.startSize.getValue(birthRateAtDuration);\r\n            particle.startSize.set(startSize, startSize, startSize);\r\n        }\r\n\r\n        //\r\n        if (this.useStartRotation3D)\r\n        {\r\n            particle.rotation.copy(this.startRotation3D.getValue(birthRateAtDuration));\r\n        }\r\n        else\r\n        {\r\n            const startRotation = this.startRotation.getValue(birthRateAtDuration);\r\n            particle.rotation.set(0, 0, startRotation);\r\n        }\r\n        particle.angularVelocity.set(0, 0, 0);\r\n        //\r\n        particle.startColor.copy(this.startColor.getValue(birthRateAtDuration));\r\n    }\r\n\r\n    /**\r\n     * 更新粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    updateParticleState(particle: Particle)\r\n    {\r\n        // 加速度\r\n        const gravity = worldGravity.scaleNumberTo(this.gravityModifier.getValue(this.particleSystem._emitInfo.rateAtDuration));\r\n        this.particleSystem.addParticleAcceleration(particle, gravity, ParticleSystemSimulationSpace.World, MainPreGravity);\r\n\r\n        //\r\n        particle.size.copy(particle.startSize);\r\n        particle.color.copy(particle.startColor);\r\n    }\r\n}\r\n\r\nconst worldGravity = new Vector3(0, -9.8, 0);\r\nconst MainPreGravity = '_Main_preGravity';\r\n","import { MinMaxCurve, MinMaxCurveMode, MinMaxCurveVector3, noise, Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { ParticleSystemNoiseQuality } from '../enums/ParticleSystemNoiseQuality';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleModule } from './ParticleModule';\r\n\r\n/**\r\n * Script interface for the Noise Module.\r\n *\r\n * The Noise Module allows you to apply turbulence to the movement of your particles. Use the low quality settings to create computationally efficient Noise, or simulate smoother, richer Noise with the higher quality settings. You can also choose to define the behavior of the Noise individually for each axis.\r\n *\r\n * 噪声模块\r\n *\r\n * 噪声模块允许你将湍流应用到粒子的运动中。使用低质量设置来创建计算效率高的噪声，或者使用高质量设置来模拟更平滑、更丰富的噪声。您还可以选择为每个轴分别定义噪声的行为。\r\n */\r\nexport class ParticleNoiseModule extends ParticleModule\r\n{\r\n    /**\r\n     * Control the noise separately for each axis.\r\n     *\r\n     * 分别控制每个轴的噪声。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '分别控制每个轴的噪声。' })\r\n    separateAxes = false;\r\n\r\n    /**\r\n     * How strong the overall noise effect is.\r\n     *\r\n     * 整体噪音效应有多强。\r\n     */\r\n    @oav({ tooltip: '整体噪音效应有多强。' })\r\n    get strength()\r\n    {\r\n        return this.strength3D.xCurve;\r\n    }\r\n\r\n    set strength(v)\r\n    {\r\n        this.strength3D.xCurve = v;\r\n    }\r\n\r\n    /**\r\n     * How strong the overall noise effect is.\r\n     *\r\n     * 整体噪音效应有多强。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '整体噪音效应有多强。' })\r\n    strength3D = serialization.setValue(new MinMaxCurveVector3(), { xCurve: { between0And1: true, constant: 1, constantMin: 1, constantMax: 1, curveMultiplier: 1 }, yCurve: { between0And1: true, constant: 1, constantMin: 1, constantMax: 1, curveMultiplier: 1 }, zCurve: { between0And1: true, constant: 1, constantMin: 1, constantMax: 1, curveMultiplier: 1 } });\r\n\r\n    /**\r\n     * Define the strength of the effect on the X axis, when using separateAxes option.\r\n     *\r\n     * 在使用分别控制每个轴时，在X轴上定义效果的强度。\r\n     */\r\n    get strengthX()\r\n    {\r\n        return this.strength3D.xCurve;\r\n    }\r\n\r\n    set strengthX(v)\r\n    {\r\n        this.strength3D.xCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Define the strength of the effect on the Y axis, when using separateAxes option.\r\n     *\r\n     * 在使用分别控制每个轴时，在Y轴上定义效果的强度。\r\n     */\r\n    get strengthY()\r\n    {\r\n        return this.strength3D.yCurve;\r\n    }\r\n\r\n    set strengthY(v)\r\n    {\r\n        this.strength3D.yCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Define the strength of the effect on the Z axis, when using separateAxes option.\r\n     *\r\n     * 在使用分别控制每个轴时，在Z轴上定义效果的强度。\r\n     */\r\n    get strengthZ()\r\n    {\r\n        return this.strength3D.zCurve;\r\n    }\r\n\r\n    set strengthZ(v)\r\n    {\r\n        this.strength3D.zCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Low values create soft, smooth noise, and high values create rapidly changing noise.\r\n     *\r\n     * 低值产生柔和、平滑的噪声，高值产生快速变化的噪声。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '低值产生柔和、平滑的噪声，高值产生快速变化的噪声。' })\r\n    frequency = 0.5;\r\n\r\n    /**\r\n     * Scroll the noise map over the particle system.\r\n     *\r\n     * 在粒子系统上滚动噪声图。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '在粒子系统上滚动噪声图。' })\r\n    scrollSpeed = new MinMaxCurve();\r\n\r\n    /**\r\n     * Higher frequency noise will reduce the strength by a proportional amount, if enabled.\r\n     *\r\n     * 如果启用高频率噪音，将按比例减少强度。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '如果启用高频率噪音，将按比例减少强度。' })\r\n    damping = true;\r\n\r\n    /**\r\n     * Layers of noise that combine to produce final noise.\r\n     *\r\n     * 一层一层的噪声组合在一起产生最终的噪声。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '一层一层的噪声组合在一起产生最终的噪声。' })\r\n    octaveCount = 1;\r\n\r\n    /**\r\n     * When combining each octave, scale the intensity by this amount.\r\n     *\r\n     * 当组合每个八度时，按这个比例调整强度。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '当组合每个八度时，按这个比例调整强度。' })\r\n    octaveMultiplier = 0.5;\r\n\r\n    /**\r\n     * When combining each octave, zoom in by this amount.\r\n     *\r\n     * 当组合每个八度时，放大这个数字。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '当组合每个八度时，放大这个数字。' })\r\n    octaveScale = 2;\r\n\r\n    /**\r\n     * Generate 1D, 2D or 3D noise.\r\n     *\r\n     * 生成一维、二维或三维噪声。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '生成一维、二维或三维噪声。', componentParam: { enumClass: ParticleSystemNoiseQuality } })\r\n    quality = ParticleSystemNoiseQuality.High;\r\n\r\n    /**\r\n     * Enable remapping of the final noise values, allowing for noise values to be translated into different values.\r\n     *\r\n     * 允许重新映射最终的噪声值，允许将噪声值转换为不同的值。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '允许重新映射最终的噪声值，允许将噪声值转换为不同的值。' })\r\n    remapEnabled = false;\r\n\r\n    /**\r\n     * Define how the noise values are remapped.\r\n     *\r\n     * 定义如何重新映射噪声值。\r\n     */\r\n    @oav({ tooltip: '生成一维、二维或三维噪声。' })\r\n    get remap()\r\n    {\r\n        return this.remap3D.xCurve;\r\n    }\r\n\r\n    set remap(v)\r\n    {\r\n        this.remap3D.xCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Define how the noise values are remapped.\r\n     *\r\n     * 定义如何重新映射噪声值。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '生成一维、二维或三维噪声。' })\r\n    remap3D = serialization.setValue(new MinMaxCurveVector3(), {\r\n        xCurve: { between0And1: true, constant: 1, constantMin: 1, constantMax: 1, curveMultiplier: 1 },\r\n        yCurve: { between0And1: true, constant: 1, constantMin: 1, constantMax: 1, curveMultiplier: 1 },\r\n        zCurve: { between0And1: true, constant: 1, constantMin: 1, constantMax: 1, curveMultiplier: 1 }\r\n    });\r\n\r\n    /**\r\n     * Define how the noise values are remapped on the X axis, when using the ParticleSystem.NoiseModule.separateAxes option.\r\n     *\r\n     * 在使用分别控制每个轴时，如何在X轴上重新映射噪声值。\r\n     */\r\n    get remapX()\r\n    {\r\n        return this.remap3D.xCurve;\r\n    }\r\n\r\n    set remapX(v)\r\n    {\r\n        this.remap3D.xCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Define how the noise values are remapped on the Y axis, when using the ParticleSystem.NoiseModule.separateAxes option.\r\n     *\r\n     * 在使用分别控制每个轴时，如何在Y轴上重新映射噪声值。\r\n     */\r\n    get remapY()\r\n    {\r\n        return this.remap3D.yCurve;\r\n    }\r\n\r\n    set remapY(v)\r\n    {\r\n        this.remap3D.yCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Define how the noise values are remapped on the Z axis, when using the ParticleSystem.NoiseModule.separateAxes option.\r\n     *\r\n     * 在使用分别控制每个轴时，如何在Z轴上重新映射噪声值。\r\n     */\r\n    get remapZ()\r\n    {\r\n        return this.remap3D.zCurve;\r\n    }\r\n\r\n    set remapZ(v)\r\n    {\r\n        this.remap3D.zCurve = v;\r\n    }\r\n\r\n    /**\r\n     * 初始化粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    initParticleState(particle: Particle)\r\n    {\r\n        particle[NoiseStrengthRate] = Math.random();\r\n        particle[NoiseParticleRate] = Math.random();\r\n    }\r\n\r\n    /**\r\n     * 更新粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    updateParticleState(particle: Particle)\r\n    {\r\n        this.particleSystem.removeParticlePosition(particle, NoisePreOffset);\r\n        if (!this.enabled) return;\r\n\r\n        let strengthX = 1;\r\n        let strengthY = 1;\r\n        let strengthZ = 1;\r\n        if (this.separateAxes)\r\n        {\r\n            const strength3D = this.strength3D.getValue(particle.rateAtLifeTime, particle[NoiseStrengthRate]);\r\n            strengthX = strength3D.x;\r\n            strengthY = strength3D.y;\r\n            strengthZ = strength3D.z;\r\n        }\r\n        else\r\n        {\r\n            strengthX = strengthY = strengthZ = this.strength.getValue(particle.rateAtLifeTime, particle[NoiseStrengthRate]);\r\n        }\r\n        //\r\n        const frequency = ParticleNoiseModule._frequencyScale * this.frequency;\r\n        //\r\n        const offsetPos = new Vector3(strengthX, strengthY, strengthZ);\r\n        //\r\n        offsetPos.scaleNumber(ParticleNoiseModule._strengthScale);\r\n        if (this.damping)\r\n        {\r\n            offsetPos.scaleNumber(1 / this.frequency);\r\n        }\r\n        const time = particle.rateAtLifeTime * ParticleNoiseModule._timeScale % 1;\r\n        //\r\n        offsetPos.x *= this._getNoiseValue((1 / 3 * 0 + time) * frequency, particle[NoiseParticleRate] * frequency);\r\n        offsetPos.y *= this._getNoiseValue((1 / 3 * 1 + time) * frequency, particle[NoiseParticleRate] * frequency);\r\n        offsetPos.z *= this._getNoiseValue((1 / 3 * 2 + time) * frequency, particle[NoiseParticleRate] * frequency);\r\n        //\r\n\r\n        this.particleSystem.addParticlePosition(particle, offsetPos, this.particleSystem.main.simulationSpace, NoisePreOffset);\r\n    }\r\n\r\n    // 以下两个值用于与Unity中数据接近\r\n    static _frequencyScale = 5;\r\n    static _strengthScale = 0.3;\r\n    static _timeScale = 5;\r\n\r\n    /**\r\n     * 绘制噪音到图片\r\n     *\r\n     * @param image 图片数据\r\n     */\r\n    drawImage(image: ImageData)\r\n    {\r\n        const strength = this._getDrawImageStrength();\r\n        let strengthX = strength.x;\r\n        let strengthY = strength.y;\r\n        let strengthZ = strength.z;\r\n        //\r\n        strengthX *= ParticleNoiseModule._strengthScale;\r\n        strengthY *= ParticleNoiseModule._strengthScale;\r\n        strengthZ *= ParticleNoiseModule._strengthScale;\r\n\r\n        if (this.damping)\r\n        {\r\n            strengthX /= this.frequency;\r\n            strengthY /= this.frequency;\r\n            strengthZ /= this.frequency;\r\n        }\r\n        //\r\n        const frequency = ParticleNoiseModule._frequencyScale * this.frequency;\r\n        //\r\n        const data = image.data;\r\n\r\n        const imageWidth = image.width;\r\n        const imageHeight = image.height;\r\n\r\n        // var datas: number[] = [];\r\n        // var min = Number.MAX_VALUE;\r\n        // var max = Number.MIN_VALUE;\r\n\r\n        for (let x = 0; x < imageWidth; x++)\r\n        {\r\n            for (let y = 0; y < imageHeight; y++)\r\n            {\r\n                const xv = x / imageWidth * frequency;\r\n                const yv = 1 - y / imageHeight * frequency;\r\n\r\n                let value = this._getNoiseValue(xv, yv);\r\n\r\n                // datas.push(value);\r\n                // if (min > value) min = value;\r\n                // if (max < value) max = value;\r\n\r\n                if (xv < 1 / 3)\r\n                { value = (value * strengthX + 1) / 2 * 256; }\r\n                else if (xv < 2 / 3)\r\n                { value = (value * strengthY + 1) / 2 * 256; }\r\n                else\r\n                { value = (value * strengthZ + 1) / 2 * 256; }\r\n\r\n                const cell = (x + y * imageWidth) * 4;\r\n                data[cell] = data[cell + 1] = data[cell + 2] = Math.floor(value);\r\n                data[cell + 3] = 255; // alpha\r\n            }\r\n        }\r\n        // console.log(datas, min, max);\r\n    }\r\n\r\n    private _getDrawImageStrength()\r\n    {\r\n        let strengthX = 1;\r\n        let strengthY = 1;\r\n        let strengthZ = 1;\r\n        if (this.separateAxes)\r\n        {\r\n            if (this.strengthX.mode === MinMaxCurveMode.Curve || this.strengthX.mode === MinMaxCurveMode.TwoCurves)\r\n            {\r\n                strengthX = this.strengthX.curveMultiplier;\r\n            }\r\n            else if (this.strengthX.mode === MinMaxCurveMode.Constant)\r\n            {\r\n                strengthX = this.strengthX.constant;\r\n            }\r\n            else if (this.strengthX.mode === MinMaxCurveMode.TwoConstants)\r\n            {\r\n                strengthX = this.strengthX.constantMax;\r\n            }\r\n\r\n            if (this.strengthY.mode === MinMaxCurveMode.Curve || this.strengthY.mode === MinMaxCurveMode.TwoCurves)\r\n            {\r\n                strengthY = this.strengthY.curveMultiplier;\r\n            }\r\n            else if (this.strengthY.mode === MinMaxCurveMode.Constant)\r\n            {\r\n                strengthY = this.strengthY.constant;\r\n            }\r\n            else if (this.strengthY.mode === MinMaxCurveMode.TwoConstants)\r\n            {\r\n                strengthY = this.strengthY.constantMax;\r\n            }\r\n\r\n            if (this.strengthZ.mode === MinMaxCurveMode.Curve || this.strengthZ.mode === MinMaxCurveMode.TwoCurves)\r\n            {\r\n                strengthZ = this.strengthZ.curveMultiplier;\r\n            }\r\n            else if (this.strengthZ.mode === MinMaxCurveMode.Constant)\r\n            {\r\n                strengthZ = this.strengthZ.constant;\r\n            }\r\n            else if (this.strengthZ.mode === MinMaxCurveMode.TwoConstants)\r\n            {\r\n                strengthZ = this.strengthZ.constantMax;\r\n            }\r\n        }\r\n        else\r\n        {\r\n            // eslint-disable-next-line no-lonely-if\r\n            if (this.strength.mode === MinMaxCurveMode.Curve || this.strength.mode === MinMaxCurveMode.TwoCurves)\r\n            {\r\n                strengthX = strengthY = strengthZ = this.strength.curveMultiplier;\r\n            }\r\n            else if (this.strength.mode === MinMaxCurveMode.Constant)\r\n            {\r\n                strengthX = strengthY = strengthZ = this.strength.constant;\r\n            }\r\n            else if (this.strength.mode === MinMaxCurveMode.TwoConstants)\r\n            {\r\n                strengthX = strengthY = strengthZ = this.strength.constantMax;\r\n            }\r\n        }\r\n\r\n        return { x: strengthX, y: strengthY, z: strengthZ };\r\n    }\r\n\r\n    /**\r\n     * 获取噪音值\r\n     *\r\n     * @param x\r\n     * @param y\r\n     */\r\n    private _getNoiseValue(x: number, y: number)\r\n    {\r\n        let value = this._getNoiseValueBase(x, y);\r\n        for (let l = 1, ln = this.octaveCount; l < ln; l++)\r\n        {\r\n            const value0 = this._getNoiseValueBase(x * this.octaveScale, y * this.octaveScale);\r\n            value += (value0 - value) * this.octaveMultiplier;\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * 获取单层噪音值\r\n     *\r\n     * @param x\r\n     * @param y\r\n     */\r\n    private _getNoiseValueBase(x: number, y: number)\r\n    {\r\n        const scrollValue = this._scrollValue;\r\n        if (this.quality === ParticleSystemNoiseQuality.Low)\r\n        {\r\n            return noise.perlin1(x + scrollValue);\r\n        }\r\n        if (this.quality === ParticleSystemNoiseQuality.Medium)\r\n        {\r\n            return noise.perlin2(x, y + scrollValue);\r\n        }\r\n        // if (this.quality == ParticleSystemNoiseQuality.High)\r\n\r\n        return noise.perlin3(x, y, scrollValue);\r\n    }\r\n\r\n    /**\r\n     * 更新\r\n     *\r\n     * @param interval\r\n     */\r\n    update(interval: number)\r\n    {\r\n        this._scrollValue += this.scrollSpeed.getValue(this.particleSystem._emitInfo.rateAtDuration) * interval / 1000;\r\n    }\r\n    private _scrollValue = 0;\r\n}\r\nconst NoiseStrengthRate = '_Noise_strength_rate';\r\nconst NoiseParticleRate = '_Noise_particle_rate';\r\nconst NoisePreOffset = '_Noise_preOffset';\r\n","import { MinMaxCurveVector3, Vector2, Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { mathUtil } from '@feng3d/polyfill';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleModule } from './ParticleModule';\r\n\r\n/**\r\n * 粒子系统 旋转角度随速度变化模块\r\n */\r\nexport class ParticleRotationBySpeedModule extends ParticleModule\r\n{\r\n    /**\r\n     * Set the rotation by speed on each axis separately.\r\n     * 在每个轴上分别设置随速度变化的旋转。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Set the rotation by speed on each axis separately.\" })\r\n    @oav({ tooltip: '在每个轴上分别设置随速度变化的旋转。' })\r\n    separateAxes = false;\r\n\r\n    /**\r\n     * 角速度，随速度变化的旋转。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '角速度，随速度变化的旋转。' })\r\n    angularVelocity = serialization.setValue(new MinMaxCurveVector3(), { xCurve: { constant: 45, constantMin: 45, constantMax: 45, curveMultiplier: 45 }, yCurve: { constant: 45, constantMin: 45, constantMax: 45, curveMultiplier: 45 }, zCurve: { constant: 45, constantMin: 45, constantMax: 45, curveMultiplier: 45 } });\r\n\r\n    /**\r\n     * Apply the rotation curve between these minimum and maximum speeds.\r\n     *\r\n     * 在这些最小和最大速度之间应用旋转曲线。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '在这些最小和最大速度之间应用旋转曲线。' })\r\n    range = new Vector2(0, 1);\r\n\r\n    /**\r\n     * Rotation by speed curve for the X axis.\r\n     *\r\n     * X轴的旋转随速度变化曲线。\r\n     */\r\n    get x()\r\n    {\r\n        return this.angularVelocity.xCurve;\r\n    }\r\n\r\n    set x(v)\r\n    {\r\n        this.angularVelocity.xCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Rotation multiplier around the X axis.\r\n     *\r\n     * 绕X轴旋转乘法器\r\n     */\r\n    get xMultiplier()\r\n    {\r\n        return this.x.curveMultiplier;\r\n    }\r\n\r\n    set xMultiplier(v)\r\n    {\r\n        this.x.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Rotation by speed curve for the Y axis.\r\n     *\r\n     * Y轴的旋转随速度变化曲线。\r\n     */\r\n    get y()\r\n    {\r\n        return this.angularVelocity.yCurve;\r\n    }\r\n\r\n    set y(v)\r\n    {\r\n        this.angularVelocity.yCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Rotation multiplier around the Y axis.\r\n     *\r\n     * 绕Y轴旋转乘法器\r\n     */\r\n    get yMultiplier()\r\n    {\r\n        return this.y.curveMultiplier;\r\n    }\r\n\r\n    set yMultiplier(v)\r\n    {\r\n        this.y.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Rotation by speed curve for the Z axis.\r\n     *\r\n     * Z轴的旋转随速度变化曲线。\r\n     */\r\n    get z()\r\n    {\r\n        return this.angularVelocity.zCurve;\r\n    }\r\n\r\n    set z(v)\r\n    {\r\n        this.angularVelocity.zCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Rotation multiplier around the Z axis.\r\n     *\r\n     * 绕Z轴旋转乘法器\r\n     */\r\n    get zMultiplier()\r\n    {\r\n        return this.z.curveMultiplier;\r\n    }\r\n\r\n    set zMultiplier(v)\r\n    {\r\n        this.z.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * 初始化粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    initParticleState(particle: Particle)\r\n    {\r\n        particle[RotationBySpeedRate] = Math.random();\r\n        particle[RotationBySpeedPreAngularVelocity] = new Vector3();\r\n    }\r\n\r\n    /**\r\n     * 更新粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    updateParticleState(particle: Particle)\r\n    {\r\n        const preAngularVelocity: Vector3 = particle[RotationBySpeedPreAngularVelocity];\r\n        particle.angularVelocity.sub(preAngularVelocity);\r\n        preAngularVelocity.set(0, 0, 0);\r\n        if (!this.enabled) return;\r\n\r\n        const velocity = particle.velocity.length;\r\n        const rate = mathUtil.clamp((velocity - this.range.x) / (this.range.y - this.range.x), 0, 1);\r\n\r\n        const v = this.angularVelocity.getValue(rate, particle[RotationBySpeedRate]);\r\n        if (!this.separateAxes)\r\n        {\r\n            v.x = v.y = 0;\r\n        }\r\n        particle.angularVelocity.add(v);\r\n        preAngularVelocity.copy(v);\r\n    }\r\n}\r\nconst RotationBySpeedRate = '_RotationBySpeed_rate';\r\nconst RotationBySpeedPreAngularVelocity = '_RotationBySpeed_preAngularVelocity';\r\n","import { MinMaxCurveVector3, Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleModule } from './ParticleModule';\r\n\r\n/**\r\n * 粒子系统 旋转角度随时间变化模块\r\n */\r\nexport class ParticleRotationOverLifetimeModule extends ParticleModule\r\n{\r\n    /**\r\n     * Set the rotation over lifetime on each axis separately.\r\n     * 在每个轴上分别设置基于生命周期的旋转。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Set the rotation over lifetime on each axis separately.\" })\r\n    @oav({ tooltip: '在每个轴上分别设置基于生命周期的旋转。' })\r\n    separateAxes = false;\r\n\r\n    /**\r\n     * 角速度，基于生命周期的旋转。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '角速度，基于生命周期的旋转。' })\r\n    angularVelocity = serialization.setValue(new MinMaxCurveVector3(), { xCurve: { constant: 45, constantMin: 45, constantMax: 45, curveMultiplier: 45 }, yCurve: { constant: 45, constantMin: 45, constantMax: 45, curveMultiplier: 45 }, zCurve: { constant: 45, constantMin: 45, constantMax: 45, curveMultiplier: 45 } });\r\n\r\n    /**\r\n     * Rotation over lifetime curve for the X axis.\r\n     *\r\n     * X轴的旋转寿命曲线。\r\n     */\r\n    get x()\r\n    {\r\n        return this.angularVelocity.xCurve;\r\n    }\r\n\r\n    set x(v)\r\n    {\r\n        this.angularVelocity.xCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Rotation multiplier around the X axis.\r\n     *\r\n     * 绕X轴旋转乘法器\r\n     */\r\n    get xMultiplier()\r\n    {\r\n        return this.x.curveMultiplier;\r\n    }\r\n\r\n    set xMultiplier(v)\r\n    {\r\n        this.x.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Rotation over lifetime curve for the Y axis.\r\n     *\r\n     * Y轴的旋转寿命曲线。\r\n     */\r\n    get y()\r\n    {\r\n        return this.angularVelocity.yCurve;\r\n    }\r\n\r\n    set y(v)\r\n    {\r\n        this.angularVelocity.yCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Rotation multiplier around the Y axis.\r\n     *\r\n     * 绕Y轴旋转乘法器\r\n     */\r\n    get yMultiplier()\r\n    {\r\n        return this.y.curveMultiplier;\r\n    }\r\n\r\n    set yMultiplier(v)\r\n    {\r\n        this.y.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Rotation over lifetime curve for the Z axis.\r\n     *\r\n     * Z轴的旋转寿命曲线。\r\n     */\r\n    get z()\r\n    {\r\n        return this.angularVelocity.zCurve;\r\n    }\r\n\r\n    set z(v)\r\n    {\r\n        this.angularVelocity.zCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Rotation multiplier around the Z axis.\r\n     *\r\n     * 绕Z轴旋转乘法器\r\n     */\r\n    get zMultiplier()\r\n    {\r\n        return this.z.curveMultiplier;\r\n    }\r\n\r\n    set zMultiplier(v)\r\n    {\r\n        this.z.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * 初始化粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    initParticleState(particle: Particle)\r\n    {\r\n        particle[RotationOverLifetimeRate] = Math.random();\r\n        particle[RotationOverLifetimePreAngularVelocity] = new Vector3();\r\n    }\r\n\r\n    /**\r\n     * 更新粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    updateParticleState(particle: Particle)\r\n    {\r\n        const preAngularVelocity: Vector3 = particle[RotationOverLifetimePreAngularVelocity];\r\n        particle.angularVelocity.sub(preAngularVelocity);\r\n        preAngularVelocity.set(0, 0, 0);\r\n        if (!this.enabled) return;\r\n\r\n        const v = this.angularVelocity.getValue(particle.rateAtLifeTime, particle[RotationOverLifetimeRate]);\r\n        if (!this.separateAxes)\r\n        {\r\n            v.x = v.y = 0;\r\n        }\r\n        particle.angularVelocity.add(v);\r\n        preAngularVelocity.copy(v);\r\n    }\r\n}\r\nconst RotationOverLifetimeRate = '_RotationOverLifetime_rate';\r\nconst RotationOverLifetimePreAngularVelocity = '_RotationOverLifetime_preAngularVelocity';\r\n","import { Vector3 } from '@feng3d/math';\r\nimport { ParticleShapeModule } from '../modules/ParticleShapeModule';\r\nimport { Particle } from '../Particle';\r\n\r\n/**\r\n * 粒子系统 发射形状\r\n */\r\nexport class ParticleSystemShape\r\n{\r\n    protected _module: ParticleShapeModule;\r\n\r\n    constructor(module: ParticleShapeModule)\r\n    {\r\n        this._module = module;\r\n    }\r\n\r\n    /**\r\n     * 计算粒子的发射位置与方向\r\n     *\r\n     * @param _particle\r\n     * @param _position\r\n     * @param _dir\r\n     */\r\n    calcParticlePosDir(_particle: Particle, _position: Vector3, _dir: Vector3)\r\n    {\r\n\r\n    }\r\n}\r\n","import { Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { mathUtil } from '@feng3d/polyfill';\r\nimport { ParticleSystemShapeMultiModeValue } from '../enums/ParticleSystemShapeMultiModeValue';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleSystemShape } from './ParticleSystemShape';\r\n\r\n/**\r\n * 粒子系统 发射圆盘\r\n */\r\nexport class ParticleSystemShapeCircle extends ParticleSystemShape\r\n{\r\n    @oav({ tooltip: '半径' })\r\n    get radius()\r\n    {\r\n        return this._module.radius;\r\n    }\r\n\r\n    set radius(v)\r\n    {\r\n        this._module.radius = v;\r\n    }\r\n\r\n    @oav({ tooltip: '弧度' })\r\n    get arc()\r\n    {\r\n        return this._module.arc;\r\n    }\r\n\r\n    set arc(v)\r\n    {\r\n        this._module.arc = v;\r\n    }\r\n\r\n    /**\r\n     * The mode used for generating particles around the arc.\r\n     *\r\n     * 在弧线周围产生粒子的模式。\r\n     */\r\n    // @oav({ tooltip: \"The mode used for generating particles around the arc.\", component: \"OAVEnum\", componentParam: { enumClass: ParticleSystemShapeMultiModeValue } })\r\n    @oav({ tooltip: '在弧线周围产生粒子的模式。', component: 'OAVEnum', componentParam: { enumClass: ParticleSystemShapeMultiModeValue } })\r\n    get arcMode()\r\n    {\r\n        return this._module.arcMode;\r\n    }\r\n\r\n    set arcMode(v)\r\n    {\r\n        this._module.arcMode = v;\r\n    }\r\n\r\n    /**\r\n     * Control the gap between emission points around the arc.\r\n     *\r\n     * 控制弧线周围发射点之间的间隙。\r\n     */\r\n    @oav({ tooltip: '控制弧线周围发射点之间的间隙。' })\r\n    get arcSpread()\r\n    {\r\n        return this._module.arcSpread;\r\n    }\r\n\r\n    set arcSpread(v)\r\n    {\r\n        this._module.arcSpread = v;\r\n    }\r\n\r\n    /**\r\n     * When using one of the animated modes, how quickly to move the emission position around the arc.\r\n     * 当使用一个动画模式时，如何快速移动发射位置周围的弧。\r\n     */\r\n    @oav({ tooltip: '当使用一个动画模式时，如何快速移动发射位置周围的弧。' })\r\n    get arcSpeed()\r\n    {\r\n        return this._module.arcSpeed;\r\n    }\r\n\r\n    set arcSpeed(v)\r\n    {\r\n        this._module.arcSpeed = v;\r\n    }\r\n\r\n    /**\r\n     * 是否从圆形边缘发射。\r\n     */\r\n    @oav({ tooltip: '是否从圆形边缘发射。' })\r\n    emitFromEdge = false;\r\n\r\n    /**\r\n     * 计算粒子的发射位置与方向\r\n     *\r\n     * @param particle\r\n     * @param position\r\n     * @param dir\r\n     */\r\n    calcParticlePosDir(particle: Particle, position: Vector3, dir: Vector3)\r\n    {\r\n        const radius = this.radius;\r\n        const arc = this.arc;\r\n        // 在圆心的方向\r\n        let radiusAngle = 0;\r\n        if (this.arcMode === ParticleSystemShapeMultiModeValue.Random)\r\n        {\r\n            radiusAngle = Math.random() * arc;\r\n        }\r\n        else if (this.arcMode === ParticleSystemShapeMultiModeValue.Loop)\r\n        {\r\n            const totalAngle = particle.birthTime * this.arcSpeed.getValue(particle.birthRateAtDuration) * 360;\r\n            radiusAngle = totalAngle % arc;\r\n        }\r\n        else if (this.arcMode === ParticleSystemShapeMultiModeValue.PingPong)\r\n        {\r\n            const totalAngle = particle.birthTime * this.arcSpeed.getValue(particle.birthRateAtDuration) * 360;\r\n            radiusAngle = totalAngle % arc;\r\n            if (Math.floor(totalAngle / arc) % 2 === 1)\r\n            {\r\n                radiusAngle = arc - radiusAngle;\r\n            }\r\n        }\r\n        if (this.arcSpread > 0)\r\n        {\r\n            radiusAngle = Math.floor(radiusAngle / arc / this.arcSpread) * arc * this.arcSpread;\r\n        }\r\n        radiusAngle = mathUtil.degToRad(radiusAngle);\r\n        // 计算位置\r\n        dir.set(Math.cos(radiusAngle), Math.sin(radiusAngle), 0);\r\n        dir.scaleNumberTo(radius, position);\r\n        if (!this.emitFromEdge)\r\n        {\r\n            position.scaleNumber(Math.random());\r\n        }\r\n    }\r\n}\r\n","import { Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { mathUtil } from '@feng3d/polyfill';\r\nimport { ParticleSystemShapeConeEmitFrom } from '../enums/ParticleSystemShapeConeEmitFrom';\r\nimport { ParticleSystemShapeMultiModeValue } from '../enums/ParticleSystemShapeMultiModeValue';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleSystemShape } from './ParticleSystemShape';\r\n\r\n/**\r\n * 粒子系统发射圆锥体，用于定义基于圆锥体的粒子发射时的初始状态。\r\n */\r\nexport class ParticleSystemShapeCone extends ParticleSystemShape\r\n{\r\n    /**\r\n     * Angle of the cone.\r\n     * 圆锥的角度。\r\n     */\r\n    // @oav({ tooltip: \"Angle of the cone.\" })\r\n    @oav({ tooltip: '圆锥的角度。' })\r\n    get angle()\r\n    {\r\n        return this._module.angle;\r\n    }\r\n\r\n    set angle(v)\r\n    {\r\n        this._module.angle = v;\r\n    }\r\n\r\n    /**\r\n     * 圆锥体底部半径。\r\n     */\r\n    @oav({ tooltip: '圆锥体底部半径。' })\r\n    get radius()\r\n    {\r\n        return this._module.radius;\r\n    }\r\n\r\n    set radius(v)\r\n    {\r\n        this._module.radius = v;\r\n    }\r\n\r\n    /**\r\n     * Length of the cone.\r\n     *\r\n     * 圆锥的长度（高度）。\r\n     */\r\n    // @oav({ tooltip: \"Length of the cone.\" })\r\n    @oav({ tooltip: '圆锥的长度（高度）。' })\r\n    get length()\r\n    {\r\n        return this._module.length;\r\n    }\r\n\r\n    set length(v)\r\n    {\r\n        this._module.length = v;\r\n    }\r\n\r\n    /**\r\n     * Circle arc angle.\r\n     */\r\n    @oav({ tooltip: '圆弧角。' })\r\n    get arc()\r\n    {\r\n        return this._module.arc;\r\n    }\r\n\r\n    set arc(v)\r\n    {\r\n        this._module.arc = v;\r\n    }\r\n\r\n    /**\r\n     * The mode used for generating particles around the arc.\r\n     * 在弧线周围产生粒子的模式。\r\n     */\r\n    @oav({ tooltip: '在弧线周围产生粒子的模式。', component: 'OAVEnum', componentParam: { enumClass: ParticleSystemShapeMultiModeValue } })\r\n    get arcMode()\r\n    {\r\n        return this._module.arcMode;\r\n    }\r\n\r\n    set arcMode(v)\r\n    {\r\n        this._module.arcMode = v;\r\n    }\r\n\r\n    /**\r\n     * Control the gap between emission points around the arc.\r\n     * 控制弧线周围发射点之间的间隙。\r\n     */\r\n    @oav({ tooltip: '控制弧线周围发射点之间的间隙。' })\r\n    get arcSpread()\r\n    {\r\n        return this._module.arcSpread;\r\n    }\r\n\r\n    set arcSpread(v)\r\n    {\r\n        this._module.arcSpread = v;\r\n    }\r\n\r\n    /**\r\n     * When using one of the animated modes, how quickly to move the emission position around the arc.\r\n     * 当使用一个动画模式时，如何快速移动发射位置周围的弧。\r\n     */\r\n    @oav({ tooltip: '当使用一个动画模式时，如何快速移动发射位置周围的弧。' })\r\n    get arcSpeed()\r\n    {\r\n        return this._module.arcSpeed;\r\n    }\r\n\r\n    set arcSpeed(v)\r\n    {\r\n        this._module.arcSpeed = v;\r\n    }\r\n\r\n    /**\r\n     * 粒子系统圆锥体发射类型。\r\n     */\r\n    @oav({ tooltip: '粒子系统圆锥体发射类型。', component: 'OAVEnum', componentParam: { enumClass: ParticleSystemShapeConeEmitFrom } })\r\n    emitFrom = ParticleSystemShapeConeEmitFrom.Base;\r\n\r\n    /**\r\n     * 计算粒子的发射位置与方向\r\n     *\r\n     * @param particle\r\n     * @param position\r\n     * @param dir\r\n     */\r\n    calcParticlePosDir(particle: Particle, position: Vector3, dir: Vector3)\r\n    {\r\n        const radius = this.radius;\r\n        let angle = this.angle;\r\n        const arc = this.arc;\r\n        angle = mathUtil.clamp(angle, 0, 87);\r\n        // 在圆心的方向\r\n        let radiusAngle = 0;\r\n        if (this.arcMode === ParticleSystemShapeMultiModeValue.Random)\r\n        {\r\n            radiusAngle = Math.random() * arc;\r\n        }\r\n        else if (this.arcMode === ParticleSystemShapeMultiModeValue.Loop)\r\n        {\r\n            const totalAngle = particle.birthTime * this.arcSpeed.getValue(particle.birthRateAtDuration) * 360;\r\n            radiusAngle = totalAngle % arc;\r\n        }\r\n        else if (this.arcMode === ParticleSystemShapeMultiModeValue.PingPong)\r\n        {\r\n            const totalAngle = particle.birthTime * this.arcSpeed.getValue(particle.birthRateAtDuration) * 360;\r\n            radiusAngle = totalAngle % arc;\r\n            if (Math.floor(totalAngle / arc) % 2 === 1)\r\n            {\r\n                radiusAngle = arc - radiusAngle;\r\n            }\r\n        }\r\n        // else if (this.arcMode == ParticleSystemShapeMultiModeValue.BurstSpread)\r\n        // {\r\n        // }\r\n        if (this.arcSpread > 0)\r\n        {\r\n            radiusAngle = Math.floor(radiusAngle / arc / this.arcSpread) * arc * this.arcSpread;\r\n        }\r\n        radiusAngle = mathUtil.degToRad(radiusAngle);\r\n        // 在圆的位置\r\n        let radiusRate = 1;\r\n        if (this.emitFrom === ParticleSystemShapeConeEmitFrom.Base || this.emitFrom === ParticleSystemShapeConeEmitFrom.Volume)\r\n        {\r\n            radiusRate = Math.random();\r\n        }\r\n        // 在圆的位置\r\n        const basePos = new Vector3(Math.cos(radiusAngle), Math.sin(radiusAngle), 0);\r\n        // 底面位置\r\n        const bottomPos = basePos.scaleNumberTo(radius).scaleNumber(radiusRate);\r\n        // 顶面位置\r\n        const topPos = basePos.scaleNumberTo(radius + this.length * Math.tan(mathUtil.degToRad(angle))).scaleNumber(radiusRate);\r\n        topPos.z = this.length;\r\n\r\n        // 计算方向\r\n        dir.copy(topPos).sub(bottomPos).normalize();\r\n        // 计算位置\r\n        position.copy(bottomPos);\r\n        if (this.emitFrom === ParticleSystemShapeConeEmitFrom.Volume || this.emitFrom === ParticleSystemShapeConeEmitFrom.VolumeShell)\r\n        {\r\n            // 上下点进行插值\r\n            position.lerpNumber(topPos, Math.random());\r\n        }\r\n    }\r\n}\r\n","import { Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { ParticleSystemShapeMultiModeValue } from '../enums/ParticleSystemShapeMultiModeValue';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleSystemShape } from './ParticleSystemShape';\r\n\r\n/**\r\n * 粒子系统 发射边\r\n */\r\nexport class ParticleSystemShapeEdge extends ParticleSystemShape\r\n{\r\n    /**\r\n     * 边长的一半。\r\n     */\r\n    @oav({ tooltip: '边长的一半。' })\r\n    get radius()\r\n    {\r\n        return this._module.radius;\r\n    }\r\n\r\n    set radius(v)\r\n    {\r\n        this._module.radius = v;\r\n    }\r\n\r\n    /**\r\n     * The mode used for generating particles around the radius.\r\n     *\r\n     * 在弧线周围产生粒子的模式。\r\n     */\r\n    @oav({ tooltip: '在弧线周围产生粒子的模式。', component: 'OAVEnum', componentParam: { enumClass: ParticleSystemShapeMultiModeValue } })\r\n    get radiusMode()\r\n    {\r\n        return this._module.radiusMode;\r\n    }\r\n\r\n    set radiusMode(v)\r\n    {\r\n        this._module.radiusMode = v;\r\n    }\r\n\r\n    /**\r\n     * Control the gap between emission points around the radius.\r\n     *\r\n     * 控制弧线周围发射点之间的间隙。\r\n     */\r\n    @oav({ tooltip: '控制弧线周围发射点之间的间隙。' })\r\n    get radiusSpread()\r\n    {\r\n        return this._module.radiusSpread;\r\n    }\r\n\r\n    set radiusSpread(v)\r\n    {\r\n        this._module.radiusSpread = v;\r\n    }\r\n\r\n    /**\r\n     * When using one of the animated modes, how quickly to move the emission position around the radius.\r\n     *\r\n     * 当使用一个动画模式时，如何快速移动发射位置周围的弧。\r\n     */\r\n    @oav({ tooltip: '当使用一个动画模式时，如何快速移动发射位置周围的弧。' })\r\n    get radiusSpeed()\r\n    {\r\n        return this._module.radiusSpeed;\r\n    }\r\n\r\n    set radiusSpeed(v)\r\n    {\r\n        this._module.radiusSpeed = v;\r\n    }\r\n\r\n    /**\r\n     * 计算粒子的发射位置与方向\r\n     *\r\n     * @param particle\r\n     * @param position\r\n     * @param dir\r\n     */\r\n    calcParticlePosDir(particle: Particle, position: Vector3, dir: Vector3)\r\n    {\r\n        const arc = 360 * this.radius;\r\n        // 在圆心的方向\r\n        let radiusAngle = 0;\r\n        if (this.radiusMode === ParticleSystemShapeMultiModeValue.Random)\r\n        {\r\n            radiusAngle = Math.random() * arc;\r\n        }\r\n        else if (this.radiusMode === ParticleSystemShapeMultiModeValue.Loop)\r\n        {\r\n            const totalAngle = particle.birthTime * this.radiusSpeed.getValue(particle.birthRateAtDuration) * 360;\r\n            radiusAngle = totalAngle % arc;\r\n        }\r\n        else if (this.radiusMode === ParticleSystemShapeMultiModeValue.PingPong)\r\n        {\r\n            const totalAngle = particle.birthTime * this.radiusSpeed.getValue(particle.birthRateAtDuration) * 360;\r\n            radiusAngle = totalAngle % arc;\r\n            if (Math.floor(totalAngle / arc) % 2 === 1)\r\n            {\r\n                radiusAngle = arc - radiusAngle;\r\n            }\r\n        }\r\n        if (this.radiusSpread > 0)\r\n        {\r\n            radiusAngle = Math.floor(radiusAngle / arc / this.radiusSpread) * arc * this.radiusSpread;\r\n        }\r\n        radiusAngle = radiusAngle / arc;\r\n\r\n        //\r\n        dir.set(0, 1, 0);\r\n        position.set(this.radius * (radiusAngle * 2 - 1), 0, 0);\r\n    }\r\n}\r\n","import { Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleSystemShape } from './ParticleSystemShape';\r\n\r\n/**\r\n * 从半球体的体积中发出。\r\n */\r\nexport class ParticleSystemShapeHemisphere extends ParticleSystemShape\r\n{\r\n    @oav({ tooltip: '球体半径' })\r\n    radius = 1;\r\n\r\n    /**\r\n     * 是否从球面发射\r\n     */\r\n    @oav({ tooltip: '是否从球面发射' })\r\n    emitFromShell = false;\r\n\r\n    /**\r\n     * 计算粒子的发射位置与方向\r\n     *\r\n     * @param _particle\r\n     * @param position\r\n     * @param dir\r\n     */\r\n    calcParticlePosDir(_particle: Particle, position: Vector3, dir: Vector3)\r\n    {\r\n        // 计算位置\r\n        dir.copy(Vector3.random()).scaleNumber(2).subNumber(1).normalize();\r\n        dir.z = Math.abs(dir.z);\r\n\r\n        position.copy(dir).scaleNumber(this.radius);\r\n        if (!this.emitFromShell)\r\n        {\r\n            position.scaleNumber(Math.random());\r\n        }\r\n    }\r\n}\r\n","import { Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleSystemShape } from './ParticleSystemShape';\r\n\r\n/**\r\n * 从球体的体积中发射。\r\n */\r\nexport class ParticleSystemShapeSphere extends ParticleSystemShape\r\n{\r\n    /**\r\n     * 球体半径\r\n     */\r\n    @oav({ tooltip: '球体半径' })\r\n    get radius()\r\n    {\r\n        return this._module.radius;\r\n    }\r\n\r\n    set radius(v)\r\n    {\r\n        this._module.radius = v;\r\n    }\r\n\r\n    /**\r\n     * 是否从球面发射\r\n     */\r\n    @oav({ tooltip: '是否从球面发射' })\r\n    emitFromShell = false;\r\n\r\n    /**\r\n     * 计算粒子的发射位置与方向\r\n     *\r\n     * @param _particle\r\n     * @param position\r\n     * @param dir\r\n     */\r\n    calcParticlePosDir(_particle: Particle, position: Vector3, dir: Vector3)\r\n    {\r\n        // 计算位置\r\n        dir.copy(Vector3.random()).scaleNumber(2).subNumber(1).normalize();\r\n\r\n        position.copy(dir).scaleNumber(this.radius);\r\n        if (!this.emitFromShell)\r\n        {\r\n            position.scaleNumber(Math.random());\r\n        }\r\n    }\r\n}\r\n\r\n","import { Geometry } from '@feng3d/core';\r\nimport { Matrix4x4, MinMaxCurve, Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { ParticleSystemMeshShapeType } from '../enums/ParticleSystemMeshShapeType';\r\nimport { ParticleSystemShapeConeEmitFrom } from '../enums/ParticleSystemShapeConeEmitFrom';\r\nimport { ParticleSystemShapeMultiModeValue } from '../enums/ParticleSystemShapeMultiModeValue';\r\nimport { ParticleSystemShapeType } from '../enums/ParticleSystemShapeType';\r\nimport { ParticleSystemShapeType1 } from '../enums/ParticleSystemShapeType1';\r\nimport { ParticleSystemSimulationSpace } from '../enums/ParticleSystemSimulationSpace';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleSystemShape } from '../shapes/ParticleSystemShape';\r\nimport { ParticleSystemShapeBox, ParticleSystemShapeBoxEmitFrom } from '../shapes/ParticleSystemShapeBox';\r\nimport { ParticleSystemShapeCircle } from '../shapes/ParticleSystemShapeCircle';\r\nimport { ParticleSystemShapeCone } from '../shapes/ParticleSystemShapeCone';\r\nimport { ParticleSystemShapeEdge } from '../shapes/ParticleSystemShapeEdge';\r\nimport { ParticleSystemShapeHemisphere } from '../shapes/ParticleSystemShapeHemisphere';\r\nimport { ParticleSystemShapeSphere } from '../shapes/ParticleSystemShapeSphere';\r\nimport { ParticleModule } from './ParticleModule';\r\n\r\n/**\r\n * Shape of the emitter volume, which controls where particles are emitted and their initial direction.\r\n * 发射体体积的形状，它控制粒子发射的位置和初始方向。\r\n */\r\nexport class ParticleShapeModule extends ParticleModule\r\n{\r\n    __class__: 'feng3d.ParticleShapeModule';\r\n    /**\r\n     * Type of shape to emit particles from.\r\n     * 发射粒子的形状类型。\r\n     */\r\n    @serialize\r\n    @watch('_onShapeTypeChanged')\r\n    shapeType: ParticleSystemShapeType;\r\n\r\n    /**\r\n     * Type of shape to emit particles from.\r\n     * 发射粒子的形状类型。\r\n     */\r\n    // @oav({ tooltip: \"Type of shape to emit particles from.\", component: \"OAVEnum\", componentParam: { enumClass: ParticleSystemShape } })\r\n    @oav({ tooltip: '发射粒子的形状类型。', component: 'OAVEnum', componentParam: { enumClass: ParticleSystemShapeType1 } })\r\n    @watch('_onShapeChanged')\r\n    shape: ParticleSystemShapeType1;\r\n\r\n    /**\r\n     * 当前使用的发射形状\r\n     */\r\n    @oav({ component: 'OAVObjectView' })\r\n    activeShape: ParticleSystemShape;\r\n\r\n    /**\r\n     * Align particles based on their initial direction of travel.\r\n     * 根据粒子的初始运动方向排列粒子。\r\n     *\r\n     * Using align to Direction in the Shape module forces the system to be rendered using Local Billboard Alignment.\r\n     * 在形状模块中使用align to Direction迫使系统使用本地看板对齐方式呈现。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Align particles based on their initial direction of travel.\" })\r\n    @oav({ tooltip: '根据粒子的初始运动方向排列粒子。' })\r\n    alignToDirection = false;\r\n\r\n    /**\r\n     * Randomizes the starting direction of particles.\r\n     * 随机化粒子的起始方向。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Randomizes the starting direction of particles.\" })\r\n    @oav({ tooltip: '随机化粒子的起始方向。' })\r\n    randomDirectionAmount = 0;\r\n\r\n    /**\r\n     * Spherizes the starting direction of particles.\r\n     * 使粒子的起始方向球面化。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Spherizes the starting direction of particles.\" })\r\n    @oav({ tooltip: 'Spherizes the starting direction of particles.' })\r\n    sphericalDirectionAmount = 0;\r\n\r\n    /**\r\n     * Angle of the cone.\r\n     *\r\n     * 圆锥的角度。\r\n     */\r\n    @serialize\r\n    angle = 25;\r\n\r\n    /**\r\n     * Circle arc angle.\r\n     *\r\n     * 圆弧角。\r\n     */\r\n    @serialize\r\n    arc = 360;\r\n\r\n    /**\r\n     * The mode used for generating particles around the arc.\r\n     *\r\n     * 在弧线周围产生粒子的模式。\r\n     */\r\n    @serialize\r\n    arcMode = ParticleSystemShapeMultiModeValue.Random;\r\n\r\n    /**\r\n     * When using one of the animated modes, how quickly to move the emission position around the arc.\r\n     *\r\n     * 当使用一个动画模式时，如何快速移动发射位置周围的弧。\r\n     */\r\n    @serialize\r\n    arcSpeed = serialization.setValue(new MinMaxCurve(), { constant: 1, constantMin: 1, constantMax: 1 });\r\n\r\n    /**\r\n     * A multiplier of the arc speed of the emission shape.\r\n     *\r\n     * 发射形状的电弧速度的乘数。\r\n     */\r\n    get arcSpeedMultiplier()\r\n    {\r\n        return this.arcSpeed.curveMultiplier;\r\n    }\r\n\r\n    set arcSpeedMultiplier(v)\r\n    {\r\n        this.arcSpeed.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Control the gap between emission points around the arc.\r\n     *\r\n     * 控制弧线周围发射点之间的间隙。\r\n     */\r\n    @serialize\r\n    arcSpread = 0;\r\n\r\n    /**\r\n     * Scale of the box.\r\n     *\r\n     * 盒子的缩放。\r\n     */\r\n    @serialize\r\n    box = new Vector3(1, 1, 1);\r\n\r\n    /**\r\n     * Length of the cone.\r\n     *\r\n     * 圆锥的长度（高度）。\r\n     */\r\n    @serialize\r\n    length = 5;\r\n\r\n    /**\r\n     * Mesh to emit particles from.\r\n     *\r\n     * 发射粒子的网格。\r\n     *\r\n     * @todo\r\n     */\r\n    mesh: Geometry;\r\n\r\n    /**\r\n     * Emit from a single material, or the whole mesh.\r\n     *\r\n     * 从一个单一的材料，或整个网格发射。\r\n     *\r\n     * @todo\r\n     */\r\n    useMeshMaterialIndex: boolean;\r\n\r\n    /**\r\n     * Emit particles from a single material of a mesh.\r\n     *\r\n     * 从一个网格的单一材料发射粒子。\r\n     *\r\n     * @todo\r\n     */\r\n    meshMaterialIndex: number;\r\n\r\n    /**\r\n     * MeshRenderer to emit particles from.\r\n     *\r\n     * 从 MeshRenderer 发射粒子。\r\n     *\r\n     * @todo\r\n     */\r\n    // meshRenderer: MeshRenderer\r\n    meshRenderer: any;\r\n\r\n    /**\r\n     * SkinnedMeshRenderer to emit particles from.\r\n     *\r\n     * 从 SkinnedMeshRenderer 发射粒子。\r\n     *\r\n     * @todo\r\n     */\r\n    skinnedMeshRenderer: any;\r\n\r\n    /**\r\n     * Apply a scaling factor to the mesh used for generating source positions.\r\n     *\r\n     * 对用于生成源位置的网格应用缩放因子。\r\n     *\r\n     * @todo\r\n     */\r\n    meshScale = 1;\r\n\r\n    /**\r\n     * Where on the mesh to emit particles from.\r\n     *\r\n     * 从网格的什么地方发射粒子。\r\n     *\r\n     * @todo\r\n     */\r\n    meshShapeType = ParticleSystemMeshShapeType.Vertex;\r\n\r\n    /**\r\n     * Modulate the particle colors with the vertex colors, or the material color if no vertex colors exist.\r\n     *\r\n     * 用顶点颜色调节粒子颜色，如果没有顶点颜色，则调节材质颜色。\r\n     *\r\n     * @todo\r\n     */\r\n    useMeshColors = true;\r\n\r\n    /**\r\n     * Move particles away from the surface of the source mesh.\r\n     *\r\n     * 将粒子从源网格的表面移开。\r\n     */\r\n    normalOffset = 0;\r\n\r\n    /**\r\n     * Radius of the shape.\r\n     *\r\n     * 形状的半径。\r\n     */\r\n    @serialize\r\n    radius = 1;\r\n\r\n    /**\r\n     * The mode used for generating particles around the radius.\r\n     *\r\n     * 在弧线周围产生粒子的模式。\r\n     */\r\n    @serialize\r\n    radiusMode = ParticleSystemShapeMultiModeValue.Random;\r\n\r\n    /**\r\n     * When using one of the animated modes, how quickly to move the emission position along the radius.\r\n     *\r\n     * 当使用一个动画模式时，如何快速移动发射位置周围的弧。\r\n     */\r\n    @serialize\r\n    radiusSpeed = serialization.setValue(new MinMaxCurve(), { constant: 1, constantMin: 1, constantMax: 1 });\r\n\r\n    /**\r\n     * A multiplier of the radius speed of the emission shape.\r\n     *\r\n     * 发射形状的半径速度的乘法器。\r\n     */\r\n    get radiusSpeedMultiplier()\r\n    {\r\n        return this.radiusSpeed.curveMultiplier;\r\n    }\r\n\r\n    set radiusSpeedMultiplier(v)\r\n    {\r\n        this.radiusSpeed.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Control the gap between emission points around the radius.\r\n     *\r\n     * 控制弧线周围发射点之间的间隙。\r\n     */\r\n    @serialize\r\n    radiusSpread = 0;\r\n\r\n    private _shapeSphere = new ParticleSystemShapeSphere(this);\r\n    private _shapeHemisphere = new ParticleSystemShapeHemisphere(this);\r\n    private _shapeCone = new ParticleSystemShapeCone(this);\r\n    private _shapeBox = new ParticleSystemShapeBox(this);\r\n    private _shapeCircle = new ParticleSystemShapeCircle(this);\r\n    private _shapeEdge = new ParticleSystemShapeEdge(this);\r\n\r\n    constructor()\r\n    {\r\n        super();\r\n        this.shapeType = ParticleSystemShapeType.Cone;\r\n    }\r\n\r\n    /**\r\n     * 初始化粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    initParticleState(particle: Particle)\r\n    {\r\n        const startSpeed = this.particleSystem.main.startSpeed.getValue(particle.birthRateAtDuration);\r\n        //\r\n        const position = tempPosition.set(0, 0, 0);\r\n        const dir = tempDir.set(0, 0, 1);\r\n        //\r\n        if (this.enabled)\r\n        {\r\n            this.activeShape.calcParticlePosDir(particle, position, dir);\r\n        }\r\n\r\n        dir.scaleNumber(startSpeed);\r\n        if (this.particleSystem.main.simulationSpace === ParticleSystemSimulationSpace.World)\r\n        {\r\n            const localToWorldMatrix = this.particleSystem.transform.localToWorldMatrix;\r\n\r\n            localToWorldMatrix.transformPoint3(position, position);\r\n            localToWorldMatrix.transformVector3(dir, dir);\r\n        }\r\n        particle.position.add(position);\r\n        particle.velocity.add(dir);\r\n\r\n        if (!this.enabled)\r\n        { return; }\r\n\r\n        //\r\n        if (this.alignToDirection)\r\n        {\r\n            const mat = new Matrix4x4();\r\n            mat.lookAt(particle.velocity, Vector3.Y_AXIS);\r\n\r\n            const mat0 = Matrix4x4.fromRotation(particle.rotation.x, particle.rotation.y, particle.rotation.z);\r\n            mat0.append(mat);\r\n\r\n            particle.rotation = mat0.getRotation();\r\n        }\r\n        const length = particle.velocity.length;\r\n        if (this.randomDirectionAmount > 0)\r\n        {\r\n            const velocity = Vector3.random().scaleNumber(2).subNumber(1).normalize(length);\r\n            particle.velocity.lerpNumber(velocity, this.randomDirectionAmount).normalize(length);\r\n        }\r\n        if (this.sphericalDirectionAmount > 0)\r\n        {\r\n            const velocity = particle.position.clone().normalize(length);\r\n            particle.velocity.lerpNumber(velocity, this.sphericalDirectionAmount).normalize(length);\r\n        }\r\n    }\r\n\r\n    private _onShapeTypeChanged()\r\n    {\r\n        const preValue = this.activeShape;\r\n        switch (this.shapeType)\r\n        {\r\n            case ParticleSystemShapeType.Sphere:\r\n                this.shape = ParticleSystemShapeType1.Sphere;\r\n                this._shapeSphere.emitFromShell = false;\r\n                this.activeShape = this._shapeSphere;\r\n                break;\r\n            case ParticleSystemShapeType.SphereShell:\r\n                this.shape = ParticleSystemShapeType1.Sphere;\r\n                this._shapeSphere.emitFromShell = true;\r\n                this.activeShape = this._shapeSphere;\r\n                break;\r\n            case ParticleSystemShapeType.Hemisphere:\r\n                this.shape = ParticleSystemShapeType1.Hemisphere;\r\n                this._shapeHemisphere.emitFromShell = false;\r\n                this.activeShape = this._shapeHemisphere;\r\n                break;\r\n            case ParticleSystemShapeType.HemisphereShell:\r\n                this.shape = ParticleSystemShapeType1.Hemisphere;\r\n                this._shapeHemisphere.emitFromShell = true;\r\n                this.activeShape = this._shapeHemisphere;\r\n                break;\r\n            case ParticleSystemShapeType.Cone:\r\n                this.shape = ParticleSystemShapeType1.Cone;\r\n                this._shapeCone.emitFrom = ParticleSystemShapeConeEmitFrom.Base;\r\n                this.activeShape = this._shapeCone;\r\n                break;\r\n            case ParticleSystemShapeType.ConeShell:\r\n                this.shape = ParticleSystemShapeType1.Cone;\r\n                this._shapeCone.emitFrom = ParticleSystemShapeConeEmitFrom.BaseShell;\r\n                this.activeShape = this._shapeCone;\r\n                break;\r\n            case ParticleSystemShapeType.ConeVolume:\r\n                this.shape = ParticleSystemShapeType1.Cone;\r\n                this._shapeCone.emitFrom = ParticleSystemShapeConeEmitFrom.Volume;\r\n                this.activeShape = this._shapeCone;\r\n                break;\r\n            case ParticleSystemShapeType.ConeVolumeShell:\r\n                this.shape = ParticleSystemShapeType1.Cone;\r\n                this._shapeCone.emitFrom = ParticleSystemShapeConeEmitFrom.VolumeShell;\r\n                this.activeShape = this._shapeCone;\r\n                break;\r\n            case ParticleSystemShapeType.Box:\r\n                this.shape = ParticleSystemShapeType1.Box;\r\n                this._shapeBox.emitFrom = ParticleSystemShapeBoxEmitFrom.Volume;\r\n                this.activeShape = this._shapeBox;\r\n                break;\r\n            case ParticleSystemShapeType.BoxShell:\r\n                this.shape = ParticleSystemShapeType1.Box;\r\n                this._shapeBox.emitFrom = ParticleSystemShapeBoxEmitFrom.Shell;\r\n                this.activeShape = this._shapeBox;\r\n                break;\r\n            case ParticleSystemShapeType.BoxEdge:\r\n                this.shape = ParticleSystemShapeType1.Box;\r\n                this._shapeBox.emitFrom = ParticleSystemShapeBoxEmitFrom.Edge;\r\n                this.activeShape = this._shapeBox;\r\n                break;\r\n            case ParticleSystemShapeType.Mesh:\r\n                this.shape = ParticleSystemShapeType1.Mesh;\r\n                console.warn(`未实现 ParticleSystemShapeType.Mesh`);\r\n                this.activeShape = null;\r\n                break;\r\n            case ParticleSystemShapeType.MeshRenderer:\r\n                this.shape = ParticleSystemShapeType1.MeshRenderer;\r\n                console.warn(`未实现 ParticleSystemShapeType.Mesh`);\r\n                this.activeShape = null;\r\n                break;\r\n            case ParticleSystemShapeType.SkinnedMeshRenderer:\r\n                this.shape = ParticleSystemShapeType1.SkinnedMeshRenderer;\r\n                console.warn(`未实现 ParticleSystemShapeType.Mesh`);\r\n                this.activeShape = null;\r\n                break;\r\n            case ParticleSystemShapeType.Circle:\r\n                this.shape = ParticleSystemShapeType1.Circle;\r\n                this._shapeCircle.emitFromEdge = false;\r\n                this.activeShape = this._shapeCircle;\r\n                break;\r\n            case ParticleSystemShapeType.CircleEdge:\r\n                this.shape = ParticleSystemShapeType1.Circle;\r\n                this._shapeCircle.emitFromEdge = true;\r\n                this.activeShape = this._shapeCircle;\r\n                break;\r\n            case ParticleSystemShapeType.SingleSidedEdge:\r\n                this.shape = ParticleSystemShapeType1.Edge;\r\n                this.activeShape = this._shapeEdge;\r\n                break;\r\n            default:\r\n                console.warn(`错误 ParticleShapeModule.shapeType 值 ${this.shapeType}`);\r\n                break;\r\n        }\r\n        serialization.setValue(this.activeShape, preValue);\r\n        this.emit('refreshView');\r\n    }\r\n\r\n    private _onShapeChanged()\r\n    {\r\n        switch (this.shape)\r\n        {\r\n            case ParticleSystemShapeType1.Sphere:\r\n                this.shapeType = this._shapeSphere.emitFromShell ? ParticleSystemShapeType.SphereShell : ParticleSystemShapeType.Sphere;\r\n                break;\r\n            case ParticleSystemShapeType1.Hemisphere:\r\n                this.shapeType = this._shapeHemisphere.emitFromShell ? ParticleSystemShapeType.HemisphereShell : ParticleSystemShapeType.Hemisphere;\r\n                break;\r\n            case ParticleSystemShapeType1.Cone:\r\n                switch (this._shapeCone.emitFrom)\r\n                {\r\n                    case ParticleSystemShapeConeEmitFrom.Base:\r\n                        this.shapeType = ParticleSystemShapeType.Cone;\r\n                        break;\r\n                    case ParticleSystemShapeConeEmitFrom.BaseShell:\r\n                        this.shapeType = ParticleSystemShapeType.ConeShell;\r\n                        break;\r\n                    case ParticleSystemShapeConeEmitFrom.Volume:\r\n                        this.shapeType = ParticleSystemShapeType.ConeVolume;\r\n                        break;\r\n                    case ParticleSystemShapeConeEmitFrom.VolumeShell:\r\n                        this.shapeType = ParticleSystemShapeType.ConeVolumeShell;\r\n                        break;\r\n                    default:\r\n                        console.warn(`错误ParticleSystemShapeCone.emitFrom值 ${this._shapeCone.emitFrom}`);\r\n                        break;\r\n                }\r\n                break;\r\n            case ParticleSystemShapeType1.Box:\r\n                switch (this._shapeBox.emitFrom)\r\n                {\r\n                    case ParticleSystemShapeBoxEmitFrom.Volume:\r\n                        this.shapeType = ParticleSystemShapeType.Box;\r\n                        break;\r\n                    case ParticleSystemShapeBoxEmitFrom.Shell:\r\n                        this.shapeType = ParticleSystemShapeType.BoxShell;\r\n                        break;\r\n                    case ParticleSystemShapeBoxEmitFrom.Edge:\r\n                        this.shapeType = ParticleSystemShapeType.BoxEdge;\r\n                        break;\r\n                    default:\r\n                        console.warn(`错误ParticleSystemShapeCone.emitFrom值 ${this._shapeCone.emitFrom}`);\r\n                        break;\r\n                }\r\n                break;\r\n            case ParticleSystemShapeType1.Mesh:\r\n                this.shapeType = ParticleSystemShapeType.Mesh;\r\n                break;\r\n            case ParticleSystemShapeType1.MeshRenderer:\r\n                this.shapeType = ParticleSystemShapeType.MeshRenderer;\r\n                break;\r\n            case ParticleSystemShapeType1.SkinnedMeshRenderer:\r\n                this.shapeType = ParticleSystemShapeType.SkinnedMeshRenderer;\r\n                break;\r\n            case ParticleSystemShapeType1.Circle:\r\n                this.shapeType = this._shapeCircle.emitFromEdge ? ParticleSystemShapeType.CircleEdge : ParticleSystemShapeType.Circle;\r\n                break;\r\n            case ParticleSystemShapeType1.Edge:\r\n                this.shapeType = ParticleSystemShapeType.SingleSidedEdge;\r\n                break;\r\n            default:\r\n                console.warn(`错误 ParticleShapeModule.shape 值 ${this.shape}`);\r\n                break;\r\n        }\r\n    }\r\n}\r\n\r\nconst tempPosition = new Vector3(0, 0, 0);\r\nconst tempDir = new Vector3(0, 0, 1);\r\n","import { MinMaxCurveVector3, Vector2 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { mathUtil } from '@feng3d/polyfill';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleModule } from './ParticleModule';\r\n\r\n/**\r\n * Script interface for the Size By Speed module.\r\n *\r\n * 粒子系统 缩放随速度变化模块\r\n */\r\nexport class ParticleSizeBySpeedModule extends ParticleModule\r\n{\r\n    /**\r\n     * Set the size over speed on each axis separately.\r\n     *\r\n     * 在每个轴上分别设置生命周期内的大小。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Set the size over speed on each axis separately.\" })\r\n    @oav({ tooltip: '在每个轴上分别设置生命周期内的大小。' })\r\n    separateAxes = false;\r\n\r\n    /**\r\n     * Curve to control particle size based on speed.\r\n     *\r\n     * 基于速度的粒度控制曲线。\r\n     */\r\n    // @oav({ tooltip: \"Curve to control particle size based on speed.\" })\r\n    @oav({ tooltip: '基于速度的粒度控制曲线。' })\r\n    get size()\r\n    {\r\n        return this.size3D.xCurve;\r\n    }\r\n\r\n    set size(v)\r\n    {\r\n        this.size3D.xCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Curve to control particle size based on speed.\r\n     *\r\n     * 基于寿命的粒度控制曲线。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Curve to control particle size based on speed.\" })\r\n    @oav({ tooltip: '基于寿命的粒度控制曲线。' })\r\n    size3D = serialization.setValue(new MinMaxCurveVector3(), { xCurve: { between0And1: true, constant: 1, constantMin: 1, constantMax: 1, curveMultiplier: 1 }, yCurve: { between0And1: true, constant: 1, constantMin: 1, constantMax: 1, curveMultiplier: 1 }, zCurve: { between0And1: true, constant: 1, constantMin: 1, constantMax: 1, curveMultiplier: 1 } });\r\n\r\n    /**\r\n     * Apply the size curve between these minimum and maximum speeds.\r\n     *\r\n     * 在这些最小和最大速度之间应用尺寸变化。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '在这些最小和最大速度之间应用颜色渐变。' })\r\n    range = new Vector2(0, 1);\r\n\r\n    /**\r\n     * Size multiplier.\r\n     *\r\n     * 尺寸的乘数。\r\n     */\r\n    get sizeMultiplier()\r\n    {\r\n        return this.size.curveMultiplier;\r\n    }\r\n\r\n    set sizeMultiplier(v)\r\n    {\r\n        this.size.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Size over speed curve for the X axis.\r\n     *\r\n     * X轴的尺寸随生命周期变化曲线。\r\n     */\r\n    get x()\r\n    {\r\n        return this.size3D.xCurve;\r\n    }\r\n\r\n    set x(v)\r\n    {\r\n        this.size3D.xCurve;\r\n    }\r\n\r\n    /**\r\n     * X axis size multiplier.\r\n     *\r\n     * X轴尺寸的乘数。\r\n     */\r\n    get xMultiplier()\r\n    {\r\n        return this.x.curveMultiplier;\r\n    }\r\n\r\n    set xMultiplier(v)\r\n    {\r\n        this.x.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Size over speed curve for the Y axis.\r\n     *\r\n     * Y轴的尺寸随生命周期变化曲线。\r\n     */\r\n    get y()\r\n    {\r\n        return this.size3D.yCurve;\r\n    }\r\n\r\n    set y(v)\r\n    {\r\n        this.size3D.yCurve;\r\n    }\r\n\r\n    /**\r\n     * Y axis size multiplier.\r\n     *\r\n     * Y轴尺寸的乘数。\r\n     */\r\n    get yMultiplier()\r\n    {\r\n        return this.y.curveMultiplier;\r\n    }\r\n\r\n    set yMultiplier(v)\r\n    {\r\n        this.y.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Size over speed curve for the Z axis.\r\n     *\r\n     * Z轴的尺寸随生命周期变化曲线。\r\n     */\r\n    get z()\r\n    {\r\n        return this.size3D.zCurve;\r\n    }\r\n\r\n    set z(v)\r\n    {\r\n        this.size3D.zCurve;\r\n    }\r\n\r\n    /**\r\n     * Z axis size multiplier.\r\n     *\r\n     * Z轴尺寸的乘数。\r\n     */\r\n    get zMultiplier()\r\n    {\r\n        return this.z.curveMultiplier;\r\n    }\r\n\r\n    set zMultiplier(v)\r\n    {\r\n        this.z.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * 初始化粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    initParticleState(particle: Particle)\r\n    {\r\n        particle[SizeBySpeedRate] = Math.random();\r\n    }\r\n\r\n    /**\r\n     * 更新粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    updateParticleState(particle: Particle)\r\n    {\r\n        if (!this.enabled) return;\r\n\r\n        const velocity = particle.velocity.length;\r\n        const rate = mathUtil.clamp((velocity - this.range.x) / (this.range.y - this.range.x), 0, 1);\r\n        const size = this.size3D.getValue(rate, particle[SizeBySpeedRate]);\r\n        if (!this.separateAxes)\r\n        {\r\n            size.y = size.z = size.x;\r\n        }\r\n        particle.size.multiply(size);\r\n    }\r\n}\r\n\r\nconst SizeBySpeedRate = '_SizeBySpeed_rate';\r\n","import { MinMaxCurveVector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleModule } from './ParticleModule';\r\n\r\n/**\r\n * 粒子系统 缩放随时间变化模块\r\n */\r\nexport class ParticleSizeOverLifetimeModule extends ParticleModule\r\n{\r\n    /**\r\n     * Set the size over lifetime on each axis separately.\r\n     *\r\n     * 在每个轴上分别设置生命周期内的大小。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Set the size over lifetime on each axis separately.\" })\r\n    @oav({ tooltip: '在每个轴上分别设置生命周期内的大小。' })\r\n    separateAxes = false;\r\n\r\n    /**\r\n     * Curve to control particle size based on lifetime.\r\n     *\r\n     * 基于寿命的粒度控制曲线。\r\n     */\r\n    // @oav({ tooltip: \"Curve to control particle size based on lifetime.\" })\r\n    @oav({ tooltip: '基于寿命的粒度控制曲线。' })\r\n    get size()\r\n    {\r\n        return this.size3D.xCurve;\r\n    }\r\n\r\n    set size(v)\r\n    {\r\n        this.size3D.xCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Size multiplier.\r\n     *\r\n     * 尺寸的乘数。\r\n     */\r\n    get sizeMultiplier()\r\n    {\r\n        return this.size.curveMultiplier;\r\n    }\r\n\r\n    set sizeMultiplier(v)\r\n    {\r\n        this.size.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Curve to control particle size based on lifetime.\r\n     *\r\n     * 基于寿命的粒度控制曲线。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Curve to control particle size based on lifetime.\" })\r\n    @oav({ tooltip: '基于寿命的粒度控制曲线。' })\r\n    size3D = serialization.setValue(new MinMaxCurveVector3(), { xCurve: { between0And1: true, constant: 1, constantMin: 1, constantMax: 1, curveMultiplier: 1 }, yCurve: { between0And1: true, constant: 1, constantMin: 1, constantMax: 1, curveMultiplier: 1 }, zCurve: { between0And1: true, constant: 1, constantMin: 1, constantMax: 1, curveMultiplier: 1 } });\r\n\r\n    /**\r\n     * Size over lifetime curve for the X axis.\r\n     *\r\n     * X轴的尺寸随生命周期变化曲线。\r\n     */\r\n    get x()\r\n    {\r\n        return this.size3D.xCurve;\r\n    }\r\n\r\n    set x(v)\r\n    {\r\n        this.size3D.xCurve;\r\n    }\r\n\r\n    /**\r\n     * X axis size multiplier.\r\n     *\r\n     * X轴尺寸的乘数。\r\n     */\r\n    get xMultiplier()\r\n    {\r\n        return this.x.curveMultiplier;\r\n    }\r\n\r\n    set xMultiplier(v)\r\n    {\r\n        this.x.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Size over lifetime curve for the Y axis.\r\n     *\r\n     * Y轴的尺寸随生命周期变化曲线。\r\n     */\r\n    get y()\r\n    {\r\n        return this.size3D.yCurve;\r\n    }\r\n\r\n    set y(v)\r\n    {\r\n        this.size3D.yCurve;\r\n    }\r\n\r\n    /**\r\n     * Y axis size multiplier.\r\n     *\r\n     * Y轴尺寸的乘数。\r\n     */\r\n    get yMultiplier()\r\n    {\r\n        return this.y.curveMultiplier;\r\n    }\r\n\r\n    set yMultiplier(v)\r\n    {\r\n        this.y.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Size over lifetime curve for the Z axis.\r\n     *\r\n     * Z轴的尺寸随生命周期变化曲线。\r\n     */\r\n    get z()\r\n    {\r\n        return this.size3D.zCurve;\r\n    }\r\n\r\n    set z(v)\r\n    {\r\n        this.size3D.zCurve;\r\n    }\r\n\r\n    /**\r\n     * Z axis size multiplier.\r\n     *\r\n     * Z轴尺寸的乘数。\r\n     */\r\n    get zMultiplier()\r\n    {\r\n        return this.z.curveMultiplier;\r\n    }\r\n\r\n    set zMultiplier(v)\r\n    {\r\n        this.z.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * 初始化粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    initParticleState(particle: Particle)\r\n    {\r\n        particle[SizeOverLifetimeRate] = Math.random();\r\n    }\r\n\r\n    /**\r\n     * 更新粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    updateParticleState(particle: Particle)\r\n    {\r\n        if (!this.enabled) return;\r\n\r\n        const size = this.size3D.getValue(particle.rateAtLifeTime, particle[SizeOverLifetimeRate]);\r\n        if (!this.separateAxes)\r\n        {\r\n            size.y = size.z = size.x;\r\n        }\r\n        particle.size.multiply(size);\r\n    }\r\n}\r\n\r\nconst SizeOverLifetimeRate = '_SizeOverLifetime_rate';\r\n","import { ParticleSystemSubEmitterProperties } from '../enums/ParticleSystemSubEmitterProperties';\r\nimport { ParticleSystemSubEmitterType } from '../enums/ParticleSystemSubEmitterType';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleSystem } from '../ParticleSystem';\r\nimport { ParticleModule } from './ParticleModule';\r\n\r\n/**\r\n * Script interface for the SubEmittersModule.\r\n *\r\n * The sub-emitters module allows you to spawn particles in child emitters from the positions of particles in the parent system.\r\n *\r\n * This module triggers child particle emission on events such as the birth, death, and collision of particles in the parent system.\r\n */\r\nexport class ParticleSubEmittersModule extends ParticleModule\r\n{\r\n    /**\r\n     * The total number of sub-emitters.\r\n     */\r\n    get subEmittersCount()\r\n    {\r\n        return this.subEmitters.length;\r\n    }\r\n\r\n    private subEmitters: { subEmitter: ParticleSystem, type: ParticleSystemSubEmitterType, properties: ParticleSystemSubEmitterProperties, emitProbability: number }[] = [];\r\n\r\n    /**\r\n     * Add a new sub-emitter.\r\n     */\r\n    AddSubEmitter(subEmitter: ParticleSystem, type: ParticleSystemSubEmitterType, properties: ParticleSystemSubEmitterProperties, emitProbability: number)\r\n    {\r\n        subEmitter._isSubParticleSystem = true;\r\n\r\n        this.subEmitters.push({ subEmitter, type, properties, emitProbability });\r\n    }\r\n\r\n    /**\r\n     * Gets the probability that the sub-emitter emits particles.\r\n     *\r\n     * @param index The index of the sub-emitter.\r\n     */\r\n    GetSubEmitterEmitProbability(index: number)\r\n    {\r\n        if (!this.subEmitters[index]) return 0;\r\n\r\nreturn this.subEmitters[index].emitProbability;\r\n    }\r\n\r\n    /**\r\n     * Gets the properties of the sub - emitter at the given index.\r\n     *\r\n     * @param index The index of the sub-emitter.\r\n     */\r\n    GetSubEmitterProperties(index: number)\r\n    {\r\n        if (!this.subEmitters[index]) return null;\r\n\r\nreturn this.subEmitters[index].properties;\r\n    }\r\n\r\n    /**\r\n     * Gets the sub - emitter Particle System at the given index.\r\n     *\r\n     * @param index The index of the desired sub-emitter.\r\n     */\r\n    GetSubEmitterSystem(index: number)\r\n    {\r\n        if (!this.subEmitters[index]) return null;\r\n\r\nreturn this.subEmitters[index].subEmitter;\r\n    }\r\n\r\n    /**\r\n     * Gets the type of the sub - emitter at the given index.\r\n     *\r\n     * @param index The index of the desired sub-emitter.\r\n     */\r\n    GetSubEmitterType(index: number)\r\n    {\r\n        if (!this.subEmitters[index]) return null;\r\n\r\nreturn this.subEmitters[index].type;\r\n    }\r\n\r\n    /**\r\n     * Removes a sub - emitter from the given index in the array.\r\n     *\r\n     * @param index The index of the desired sub-emitter.\r\n     */\r\n    RemoveSubEmitter(index: number)\r\n    {\r\n        if (!this.subEmitters[index]) return;\r\n        this.subEmitters.splice(index, 1);\r\n    }\r\n\r\n    /**\r\n     * Sets the probability that the sub - emitter emits particles.\r\n     *\r\n     * @param index The index of the sub-emitter you want to modify.\r\n     * @param emitProbability The probability value.\r\n     */\r\n    SetSubEmitterEmitProbability(index: number, emitProbability: number)\r\n    {\r\n        if (!this.subEmitters[index]) return;\r\n        this.subEmitters[index].emitProbability = emitProbability;\r\n    }\r\n\r\n    /**\r\n     * Sets the properties of the sub - emitter at the given index.\r\n     *\r\n     * @param index The index of the sub-emitter you want to modify.\r\n     * @param properties The new properties to assign to this sub-emitter.\r\n     */\r\n    SetSubEmitterProperties(index: number, properties: ParticleSystemSubEmitterProperties)\r\n    {\r\n        if (!this.subEmitters[index]) return;\r\n        this.subEmitters[index].properties = properties;\r\n    }\r\n\r\n    /**\r\n     * Sets the Particle System to use as the sub - emitter at the given index.\r\n     */\r\n    SetSubEmitterSystem(index: number, subEmitter: ParticleSystem)\r\n    {\r\n        if (!this.subEmitters[index]) return;\r\n        this.subEmitters[index].subEmitter = subEmitter;\r\n    }\r\n\r\n    /**\r\n     * Sets the type of the sub - emitter at the given index.\r\n     *\r\n     * @param index The index of the sub-emitter you want to modify.\r\n     * @param type The new spawning type to assign to this sub-emitter.\r\n     */\r\n    SetSubEmitterType(index: number, type: ParticleSystemSubEmitterType)\r\n    {\r\n        if (!this.subEmitters[index]) return;\r\n        this.subEmitters[index].type = type;\r\n    }\r\n\r\n    /**\r\n     * 更新粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    updateParticleState(particle: Particle)\r\n    {\r\n        for (let i = 0, n = this.subEmittersCount; i < n; i++)\r\n        {\r\n            const emitterType = this.GetSubEmitterType(i);\r\n            if (emitterType === ParticleSystemSubEmitterType.Birth)\r\n            {\r\n                this.particleSystem.TriggerSubEmitter(i, [particle]);\r\n            }\r\n        }\r\n    }\r\n}\r\n","import { GeometryLike, Material } from '@feng3d/core';\r\nimport { Vector3 } from '@feng3d/math';\r\nimport { ParticleSystemRenderMode } from '../enums/ParticleSystemRenderMode';\r\nimport { ParticleSystemRenderSpace } from '../enums/ParticleSystemRenderSpace';\r\nimport { ParticleSystemSortMode } from '../enums/ParticleSystemSortMode';\r\nimport { SpriteMaskInteraction } from '../enums/SpriteMaskInteraction';\r\nimport { ParticleModule } from './ParticleModule';\r\n\r\n/**\r\n * Use this class to render particles on to the screen.\r\n */\r\nexport class ParticleSystemRenderer extends ParticleModule\r\n{\r\n    /**\r\n     * The number of currently active custom vertex streams.\r\n     */\r\n    activeVertexStreamsCount: number;\r\n\r\n    /**\r\n     * Control the direction that particles face.\r\n     */\r\n    alignment: ParticleSystemRenderSpace;\r\n\r\n    /**\r\n     * Allow billboard particles to roll around their z-axis.\r\n     */\r\n    allowRoll: boolean;\r\n\r\n    /**\r\n     * How much do the particles stretch depending on the Camera's speed.\r\n     */\r\n    cameraVelocityScale: number;\r\n\r\n    /**\r\n     * Enables GPU Instancing on platforms that support it.\r\n     */\r\n    enableGPUInstancing: boolean;\r\n\r\n    /**\r\n     * Flip a percentage of the particles, along each axis.\r\n     */\r\n    flip: Vector3;\r\n\r\n    /**\r\n     * Enables freeform stretching behavior.\r\n     */\r\n    freeformStretching: boolean;\r\n\r\n    /**\r\n     * How much are the particles stretched in their direction of motion, defined as the length of the particle compared to its width.\r\n     */\r\n    lengthScale: number;\r\n\r\n    /**\r\n     * Specifies how the Particle System Renderer interacts with SpriteMask.\r\n     */\r\n    maskInteraction: SpriteMaskInteraction;\r\n\r\n    /**\r\n     * Clamp the maximum particle size.\r\n     */\r\n    maxParticleSize: number;\r\n\r\n    /**\r\n     * The Mesh that the particle uses instead of a billboarded Texture.\r\n     */\r\n    mesh: GeometryLike;\r\n\r\n    /**\r\n     * The number of Meshes the system uses for particle rendering.\r\n     */\r\n    meshCount: number;\r\n\r\n    /**\r\n     * Clamp the minimum particle size.\r\n     */\r\n    minParticleSize: number;\r\n\r\n    /**\r\n     * Specifies how much a billboard particle orients its normals towards the Camera.\r\n     */\r\n    normalDirection: number;\r\n\r\n    /**\r\n     * Modify the pivot point used for rotating particles.\r\n     */\r\n    pivot: Vector3;\r\n\r\n    /**\r\n     * Specifies how the system draws particles.\r\n     */\r\n    renderMode: ParticleSystemRenderMode;\r\n\r\n    /**\r\n     * Rotate the particles based on the direction they are stretched in.This is added on top of other particle rotation.\r\n     */\r\n    rotateWithStretchDirection: boolean;\r\n\r\n    /**\r\n     * Apply a shadow bias to prevent self - shadowing artifacts.The specified value is the proportion of the particle size.\r\n     */\r\n    shadowBias: number;\r\n\r\n    /**\r\n     * Biases Particle System sorting amongst other transparencies.\r\n     */\r\n    sortingFudge: number;\r\n\r\n    /**\r\n     * Specifies how to sort particles within a system.\r\n     */\r\n    sortMode: ParticleSystemSortMode;\r\n\r\n    /**\r\n     * Set the Material that the TrailModule uses to attach trails to particles.\r\n     */\r\n    trailMaterial: Material;\r\n\r\n    /**\r\n     * Specifies how much particles stretch depending on their velocity.\r\n     */\r\n    velocityScale: number;\r\n}\r\n","import { MinMaxCurve, MinMaxCurveMode, Vector2 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { mathUtil } from '@feng3d/polyfill';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { ParticleSystemAnimationType } from '../enums/ParticleSystemAnimationType';\r\nimport { UVChannelFlags } from '../enums/UVChannelFlags';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleModule } from './ParticleModule';\r\n\r\n/**\r\n * 粒子系统纹理表动画模块。\r\n */\r\nexport class ParticleTextureSheetAnimationModule extends ParticleModule\r\n{\r\n    /**\r\n     * Defines the tiling of the texture.\r\n     *\r\n     * 定义纹理的平铺。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Defines the tiling of the texture.\" })\r\n    @oav({ tooltip: '定义纹理的平铺。' })\r\n    tiles = new Vector2(1, 1);\r\n\r\n    /**\r\n     * Specifies the animation type.\r\n     *\r\n     * 指定动画类型。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Specifies the animation type.\" })\r\n    @oav({ tooltip: '指定动画类型。', component: 'OAVEnum', componentParam: { enumClass: ParticleSystemAnimationType } })\r\n    animation = ParticleSystemAnimationType.WholeSheet;\r\n\r\n    /**\r\n     * Curve to control which frame of the texture sheet animation to play.\r\n     *\r\n     * 曲线控制哪个帧的纹理表动画播放。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Curve to control which frame of the texture sheet animation to play.\" })\r\n    @oav({ tooltip: '曲线控制哪个帧的纹理表动画播放。' })\r\n    frameOverTime = serialization.setValue(new MinMaxCurve(), { mode: MinMaxCurveMode.Curve, curveMin: { keys: [{ time: 0, value: 0, inTangent: 1, outTangent: 1 }, { time: 1, value: 1, inTangent: 1, outTangent: 1 }] } });\r\n\r\n    /**\r\n     * Use a random row of the texture sheet for each particle emitted.\r\n     *\r\n     * 对每个发射的粒子使用纹理表的随机行。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Use a random row of the texture sheet for each particle emitted.\" })\r\n    @oav({ tooltip: '对每个发射的粒子使用纹理表的随机行。' })\r\n    useRandomRow = true;\r\n\r\n    /**\r\n     * Explicitly select which row of the texture sheet is used, when useRandomRow is set to false.\r\n     *\r\n     * 当useRandomRow设置为false时，显式选择使用纹理表的哪一行。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Explicitly select which row of the texture sheet is used, when useRandomRow is set to false.\" })\r\n    @oav({ tooltip: '当useRandomRow设置为false时，显式选择使用纹理表的哪一行。' })\r\n    get rowIndex() { return this._rowIndex; }\r\n    set rowIndex(v)\r\n    {\r\n        this._rowIndex = mathUtil.clamp(v, 0, this.tiles.y - 1);\r\n    }\r\n    private _rowIndex = 0;\r\n\r\n    /**\r\n     * Define a random starting frame for the texture sheet animation.\r\n     *\r\n     * 为纹理表动画定义一个随机的起始帧。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Define a random starting frame for the texture sheet animation.\" })\r\n    @oav({ tooltip: '为纹理表动画定义一个随机的起始帧。' })\r\n    startFrame = new MinMaxCurve();\r\n\r\n    /**\r\n     * Specifies how many times the animation will loop during the lifetime of the particle.\r\n     *\r\n     * 指定在粒子的生命周期内动画将循环多少次。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Specifies how many times the animation will loop during the lifetime of the particle.\" })\r\n    @oav({ tooltip: '指定在粒子的生命周期内动画将循环多少次。' })\r\n    cycleCount = 1;\r\n\r\n    /**\r\n     * Flip the UV coordinate on particles, causing them to appear mirrored.\r\n     *\r\n     * 在粒子上翻转UV坐标，使它们呈现镜像翻转。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Flip the UV coordinate on particles, causing them to appear mirrored.\" })\r\n    @oav({ tooltip: '在粒子上翻转UV坐标，使它们呈现镜像翻转。' })\r\n    flipUV = new Vector2();\r\n\r\n    /**\r\n     * Choose which UV channels will receive texture animation.\r\n     *\r\n     * 选择哪个UV通道将接收纹理动画。\r\n     *\r\n     * todo 目前引擎中只有一套UV\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Choose which UV channels will receive texture animation.\", component: \"OAVEnum\", componentParam: { enumClass: UVChannelFlags } })\r\n    @oav({ tooltip: '选择哪个UV通道将接收纹理动画。', component: 'OAVEnum', componentParam: { enumClass: UVChannelFlags } })\r\n    uvChannelMask = UVChannelFlags.Everything;\r\n\r\n    /**\r\n     * Flip the U coordinate on particles, causing them to appear mirrored horizontally.\r\n     *\r\n     * 在粒子上翻转U坐标，使它们呈现水平镜像。\r\n     */\r\n    get flipU()\r\n    {\r\n        return this.flipUV.x;\r\n    }\r\n\r\n    set flipU(v)\r\n    {\r\n        this.flipUV.x = v;\r\n    }\r\n\r\n    /**\r\n     * Flip the V coordinate on particles, causing them to appear mirrored vertically.\r\n     *\r\n     * 在粒子上翻转V坐标，使它们垂直镜像。\r\n     */\r\n    get flipV()\r\n    {\r\n        return this.flipUV.y;\r\n    }\r\n\r\n    set flipV(v)\r\n    {\r\n        this.flipUV.y = v;\r\n    }\r\n\r\n    /**\r\n     * Frame over time mutiplier.\r\n     *\r\n     * 帧随时间变化的乘数。\r\n     */\r\n    get frameOverTimeMultiplier()\r\n    {\r\n        return this.frameOverTime.curveMultiplier;\r\n    }\r\n\r\n    set frameOverTimeMultiplier(v)\r\n    {\r\n        this.frameOverTime.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Defines the tiling of the texture in the X axis.\r\n     *\r\n     * 定义纹理在X轴上的平铺。\r\n     */\r\n    get numTilesX()\r\n    {\r\n        return this.tiles.x;\r\n    }\r\n\r\n    set numTilesX(v)\r\n    {\r\n        this.tiles.x = v;\r\n    }\r\n\r\n    /**\r\n     * Defines the tiling of the texture in the Y axis.\r\n     *\r\n     * 定义纹理在Y轴上的平铺。\r\n     */\r\n    get numTilesY()\r\n    {\r\n        return this.tiles.y;\r\n    }\r\n\r\n    set numTilesY(v)\r\n    {\r\n        this.tiles.y = v;\r\n    }\r\n\r\n    /**\r\n     * Starting frame multiplier.\r\n     *\r\n     * 起始帧乘数。\r\n     */\r\n    get startFrameMultiplier()\r\n    {\r\n        return this.startFrame.curveMultiplier;\r\n    }\r\n\r\n    set startFrameMultiplier(v)\r\n    {\r\n        this.startFrame.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * 初始化粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    initParticleState(particle: Particle)\r\n    {\r\n        particle[TextureSheetAnimationFrameOverTime] = Math.random();\r\n        particle[TextureSheetAnimationStartFrame] = Math.random();\r\n        particle[TextureSheetAnimationRandomRow] = Math.random();\r\n    }\r\n\r\n    /**\r\n     * 更新粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    updateParticleState(particle: Particle)\r\n    {\r\n        particle.tilingOffset.set(1, 1, 0, 0);\r\n        particle.flipUV.set(0, 0);\r\n        if (!this.enabled) return;\r\n\r\n        const segmentsX = this.tiles.x;\r\n        const segmentsY = this.tiles.y;\r\n        const step = this.tiles.clone().reciprocal();\r\n        const uvPos = new Vector2();\r\n        const frameOverTime = this.frameOverTime.getValue(particle.rateAtLifeTime, particle[TextureSheetAnimationFrameOverTime]);\r\n        let frameIndex = this.startFrame.getValue(particle.rateAtLifeTime, particle[TextureSheetAnimationStartFrame]);\r\n        let rowIndex = this.rowIndex;\r\n        const cycleCount = this.cycleCount;\r\n\r\n        if (this.animation === ParticleSystemAnimationType.WholeSheet)\r\n        {\r\n            frameIndex = Math.round(frameIndex + frameOverTime * segmentsX * segmentsY * cycleCount);\r\n            uvPos.set(frameIndex % segmentsX, Math.floor(frameIndex / segmentsX) % segmentsY).scale(step);\r\n        }\r\n        else if (this.animation === ParticleSystemAnimationType.SingleRow)\r\n        {\r\n            frameIndex = Math.round(frameIndex + frameOverTime * segmentsX * cycleCount);\r\n            if (this.useRandomRow)\r\n            {\r\n                rowIndex = Math.round(segmentsY * particle[TextureSheetAnimationRandomRow]);\r\n            }\r\n            uvPos.set(frameIndex % segmentsX, rowIndex).scale(step);\r\n        }\r\n\r\n        particle.tilingOffset.set(step.x, step.y, uvPos.x, uvPos.y);\r\n        particle.flipUV = this.flipUV;\r\n    }\r\n}\r\n\r\nconst TextureSheetAnimationFrameOverTime = '_TextureSheetAnimation_rateAtLifeTime';\r\nconst TextureSheetAnimationStartFrame = '_TextureSheetAnimation_startFrame';\r\nconst TextureSheetAnimationRandomRow = '_TextureSheetAnimation_randomRow';\r\n","import { MinMaxCurveVector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { ParticleSystemSimulationSpace } from '../enums/ParticleSystemSimulationSpace';\r\nimport { Particle } from '../Particle';\r\nimport { ParticleModule } from './ParticleModule';\r\n\r\n/**\r\n * 粒子系统 速度随时间变化模块\r\n *\r\n * Controls the velocity of each particle during its lifetime.\r\n * 控制每个粒子在其生命周期内的速度。\r\n */\r\nexport class ParticleVelocityOverLifetimeModule extends ParticleModule\r\n{\r\n    __class__: 'feng3d.ParticleVelocityOverLifetimeModule';\r\n\r\n    /**\r\n     * Curve to control particle speed based on lifetime.\r\n     *\r\n     * 基于寿命的粒子速度控制曲线。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Curve to control particle speed based on lifetime.\" })\r\n    @oav({ tooltip: '基于寿命的粒子速度控制曲线。' })\r\n    velocity = new MinMaxCurveVector3();\r\n\r\n    /**\r\n     * Specifies if the velocities are in local space (rotated with the transform) or world space.\r\n     *\r\n     * 指定速度是在局部空间(与变换一起旋转)还是在世界空间。\r\n     */\r\n    @serialize\r\n    // @oav({ tooltip: \"Specifies if the velocities are in local space (rotated with the transform) or world space.\", component: \"OAVEnum\", componentParam: { enumClass: ParticleSystemSimulationSpace } })\r\n    @oav({ tooltip: '指定速度是在局部空间(与变换一起旋转)还是在世界空间。', component: 'OAVEnum', componentParam: { enumClass: ParticleSystemSimulationSpace } })\r\n    space = ParticleSystemSimulationSpace.Local;\r\n\r\n    /**\r\n     * Curve to control particle speed based on lifetime, on the X axis.\r\n     *\r\n     * 曲线控制粒子速度基于寿命，在X轴上。\r\n     */\r\n    get x()\r\n    {\r\n        return this.velocity.xCurve;\r\n    }\r\n\r\n    set x(v)\r\n    {\r\n        this.velocity.xCurve = v;\r\n    }\r\n\r\n    /**\r\n     * X axis speed multiplier.\r\n     *\r\n     * X轴速度倍增器。\r\n     */\r\n    get xMultiplier()\r\n    {\r\n        return this.x.curveMultiplier;\r\n    }\r\n\r\n    set xMultiplier(v)\r\n    {\r\n        this.x.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Curve to control particle speed based on lifetime, on the Y axis.\r\n     *\r\n     * 曲线控制粒子速度基于寿命，在Y轴上。\r\n     */\r\n    get y()\r\n    {\r\n        return this.velocity.yCurve;\r\n    }\r\n\r\n    set y(v)\r\n    {\r\n        this.velocity.yCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Y axis speed multiplier.\r\n     *\r\n     * Y轴速度倍增器。\r\n     */\r\n    get yMultiplier()\r\n    {\r\n        return this.y.curveMultiplier;\r\n    }\r\n\r\n    set yMultiplier(v)\r\n    {\r\n        this.y.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * Curve to control particle speed based on lifetime, on the Z axis.\r\n     *\r\n     * 曲线控制粒子速度基于寿命，在Z轴上。\r\n     */\r\n    get z()\r\n    {\r\n        return this.velocity.zCurve;\r\n    }\r\n\r\n    set z(v)\r\n    {\r\n        this.velocity.zCurve = v;\r\n    }\r\n\r\n    /**\r\n     * Z axis speed multiplier.\r\n     *\r\n     * Z轴速度倍增器。\r\n     */\r\n    get zMultiplier()\r\n    {\r\n        return this.z.curveMultiplier;\r\n    }\r\n\r\n    set zMultiplier(v)\r\n    {\r\n        this.z.curveMultiplier = v;\r\n    }\r\n\r\n    /**\r\n     * 初始化粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    initParticleState(particle: Particle)\r\n    {\r\n        particle[VelocityOverLifetimeRate] = Math.random();\r\n    }\r\n\r\n    /**\r\n     * 更新粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    updateParticleState(particle: Particle)\r\n    {\r\n        this.particleSystem.removeParticleVelocity(particle, VelocityOverLifetimePreVelocity);\r\n        if (!this.enabled) return;\r\n\r\n        const velocity = this.velocity.getValue(particle.rateAtLifeTime, particle[VelocityOverLifetimeRate]);\r\n        this.particleSystem.addParticleVelocity(particle, velocity, this.space, VelocityOverLifetimePreVelocity);\r\n    }\r\n}\r\n\r\nconst VelocityOverLifetimeRate = '_VelocityOverLifetime_rate';\r\nconst VelocityOverLifetimePreVelocity = '_VelocityOverLifetime_preVelocity';\r\n","import { Vector3, Color4, Vector4, Vector2 } from '@feng3d/math';\r\nimport { ParticleSystemEmitInfo } from './ParticleSystem';\r\n\r\n/**\r\n * 粒子\r\n */\r\nexport class Particle\r\n{\r\n\t/**\r\n\t * 出生时间\r\n\t */\r\n\tbirthTime = 0;\r\n\r\n\t/**\r\n\t * 寿命\r\n\t */\r\n\tlifetime = 5;\r\n\r\n\t/**\r\n\t * 位置\r\n\t */\r\n\tposition = new Vector3();\r\n\r\n\t/**\r\n\t * 速度\r\n\t */\r\n\tvelocity = new Vector3();\r\n\r\n\t/**\r\n\t * 加速度\r\n\t */\r\n\tacceleration = new Vector3();\r\n\r\n\t/**\r\n\t * 旋转角度\r\n\t */\r\n\trotation = new Vector3();\r\n\r\n\t/**\r\n\t * 角速度\r\n\t */\r\n\tangularVelocity = new Vector3();\r\n\r\n\t/**\r\n\t * 尺寸\r\n\t */\r\n\tsize = new Vector3(1, 1, 1);\r\n\r\n\t/**\r\n\t * 起始尺寸\r\n\t */\r\n\tstartSize = new Vector3(1, 1, 1);\r\n\r\n\t/**\r\n\t * 颜色\r\n\t */\r\n\tcolor = new Color4();\r\n\r\n\t/**\r\n\t * 起始颜色\r\n\t */\r\n\tstartColor = new Color4();\r\n\r\n\t/**\r\n\t * 纹理UV缩放和偏移。\r\n\t */\r\n\ttilingOffset = new Vector4(1, 1, 0, 0);\r\n\r\n\t/**\r\n\t * 在粒子上翻转UV坐标，使它们呈现水平镜像。\r\n\t */\r\n\tflipUV = new Vector2();\r\n\r\n\t/**\r\n\t * 出生时在周期的位置（在发射时被更新）\r\n\t */\r\n\tbirthRateAtDuration: number;\r\n\r\n\t/**\r\n\t * 此时粒子在生命周期的位置（在更新状态前被更新）\r\n\t */\r\n\trateAtLifeTime: number;\r\n\r\n\t/**\r\n\t * 缓存，用于存储计算时临时数据\r\n\t */\r\n\tcache = {};\r\n\r\n\t/**\r\n\t * 上次记录的时间\r\n\t */\r\n\tpreTime: number;\r\n\r\n\t/**\r\n\t * 当前记录的时间\r\n\t */\r\n\tcurTime: number;\r\n\r\n\t/**\r\n\t * 上次记录位置\r\n\t */\r\n\tprePosition: Vector3;\r\n\r\n\t/**\r\n\t * 当前记录位置\r\n\t */\r\n\tcurPosition: Vector3;\r\n\r\n\t/**\r\n\t * 子发射器信息\r\n\t */\r\n\tsubEmitInfo: ParticleSystemEmitInfo;\r\n\r\n\t/**\r\n\t * 更新状态\r\n\t */\r\n\tupdateState(time: number)\r\n\t{\r\n\t\tconst preTime = Math.max(this.curTime, this.birthTime);\r\n\t\ttime = Math.max(this.birthTime, time);\r\n\r\n\t\t//\r\n\t\tconst deltaTime = time - preTime;\r\n\r\n\t\t// 计算速度\r\n\t\tthis.velocity.add(this.acceleration.scaleNumberTo(deltaTime));\r\n\r\n\t\t// 计算位置\r\n\t\tthis.position.x += this.velocity.x * deltaTime;\r\n\t\tthis.position.y += this.velocity.y * deltaTime;\r\n\t\tthis.position.z += this.velocity.z * deltaTime;\r\n\r\n\t\t// 计算角度\r\n\t\tthis.rotation.add(this.angularVelocity.scaleNumberTo(deltaTime));\r\n\r\n\t\t// 记录粒子此次移动的起始时间以及起始位置\r\n\t\tthis.prePosition = this.curPosition.clone();\r\n\t\tthis.curPosition = this.position.clone();\r\n\t\tthis.preTime = this.curTime;\r\n\t\tthis.curTime = time;\r\n\t}\r\n}\r\n","import { Texture2D, Material } from '@feng3d/core';\r\nimport { Color4, Vector4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { shaderConfig, BlendFactor, ColorMask, CullFace } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsUniformsTypes\r\n    {\r\n        Particles_Additive: ParticlesAdditiveUniforms\r\n    }\r\n\r\n    export interface MixinsDefaultMaterial\r\n    {\r\n        'Particle-Material': Material;\r\n    }\r\n}\r\n\r\n/**\r\n * UnityShader \"Particles/Additive\"\r\n */\r\nexport class ParticlesAdditiveUniforms\r\n{\r\n    __class__: 'feng3d.ParticlesAdditiveUniforms';\r\n\r\n    @serialize\r\n    @oav()\r\n    _TintColor = new Color4(0.5, 0.5, 0.5, 0.5);\r\n\r\n    /**\r\n     * 粒子贴图\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '粒子贴图' })\r\n    _MainTex = Texture2D.defaultParticle;\r\n\r\n    /**\r\n     * 粒子贴图使用的UV变换\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '粒子贴图使用的UV变换' })\r\n    _MainTex_ST = new Vector4(1, 1, 0, 0);\r\n\r\n    /**\r\n     * @todo\r\n     */\r\n    @serialize\r\n    @oav()\r\n    _InvFade = 1.0;\r\n}\r\n\r\nshaderConfig.shaders['Particles_Additive'].cls = ParticlesAdditiveUniforms;\r\nshaderConfig.shaders['Particles_Additive'].renderParams = {\r\n    enableBlend: true,\r\n    sfactor: BlendFactor.SRC_ALPHA,\r\n    dfactor: BlendFactor.ONE,\r\n    colorMask: ColorMask.RGB,\r\n    cullFace: CullFace.NONE,\r\n    depthMask: false,\r\n};\r\n\r\nMaterial.setDefault('Particle-Material', { shaderName: 'Particles_Additive' });\r\n","import { Texture2D } from '@feng3d/core';\r\nimport { Vector4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { shaderConfig, BlendFactor, ColorMask, CullFace } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\n\r\n/**\r\n * UnityShader \"Particles/Alpha Blended Premultiply\"\r\n */\r\nexport class ParticlesAlphaBlendedPremultiplyUniforms\r\n{\r\n    __class__: 'feng3d.ParticlesAlphaBlendedPremultiplyUniforms';\r\n\r\n    /**\r\n     * 粒子贴图\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '粒子贴图' })\r\n    _MainTex = Texture2D.defaultParticle;\r\n\r\n    /**\r\n     * 粒子贴图使用的UV变换\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '粒子贴图使用的UV变换' })\r\n    _MainTex_ST = new Vector4(1, 1, 0, 0);\r\n\r\n    /**\r\n     * @todo\r\n     */\r\n    @serialize\r\n    @oav()\r\n    u_softParticlesFactor = 1.0;\r\n}\r\n\r\nshaderConfig.shaders['Particles_AlphaBlendedPremultiply'].cls = ParticlesAlphaBlendedPremultiplyUniforms;\r\nshaderConfig.shaders['Particles_AlphaBlendedPremultiply'].renderParams = {\r\n    enableBlend: true,\r\n    sfactor: BlendFactor.ONE,\r\n    dfactor: BlendFactor.ONE_MINUS_SRC_ALPHA,\r\n    colorMask: ColorMask.RGB,\r\n    cullFace: CullFace.NONE,\r\n    depthMask: false,\r\n};\r\n","import { AddComponentMenu, Camera, createNodeMenu, GameObject, Geometry, Material, QuadGeometry, RegisterComponent, Renderable, RunEnvironment, Scene, Transform } from '@feng3d/core';\r\nimport { Matrix3x3, Matrix4x4, Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { ArrayUtils } from '@feng3d/polyfill';\r\nimport { Attribute, RenderAtomic } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watcher } from '@feng3d/watcher';\r\nimport { ParticleSystemSimulationSpace } from './enums/ParticleSystemSimulationSpace';\r\nimport { ParticleColorBySpeedModule } from './modules/ParticleColorBySpeedModule';\r\nimport { ParticleColorOverLifetimeModule } from './modules/ParticleColorOverLifetimeModule';\r\nimport { ParticleEmissionModule } from './modules/ParticleEmissionModule';\r\nimport { ParticleForceOverLifetimeModule } from './modules/ParticleForceOverLifetimeModule';\r\nimport { ParticleInheritVelocityModule } from './modules/ParticleInheritVelocityModule';\r\nimport { ParticleLimitVelocityOverLifetimeModule } from './modules/ParticleLimitVelocityOverLifetimeModule';\r\nimport { ParticleMainModule } from './modules/ParticleMainModule';\r\nimport { ParticleModule } from './modules/ParticleModule';\r\nimport { ParticleNoiseModule } from './modules/ParticleNoiseModule';\r\nimport { ParticleRotationBySpeedModule } from './modules/ParticleRotationBySpeedModule';\r\nimport { ParticleRotationOverLifetimeModule } from './modules/ParticleRotationOverLifetimeModule';\r\nimport { ParticleShapeModule } from './modules/ParticleShapeModule';\r\nimport { ParticleSizeBySpeedModule } from './modules/ParticleSizeBySpeedModule';\r\nimport { ParticleSizeOverLifetimeModule } from './modules/ParticleSizeOverLifetimeModule';\r\nimport { ParticleSubEmittersModule } from './modules/ParticleSubEmittersModule';\r\nimport { ParticleTextureSheetAnimationModule } from './modules/ParticleTextureSheetAnimationModule';\r\nimport { ParticleVelocityOverLifetimeModule } from './modules/ParticleVelocityOverLifetimeModule';\r\nimport { Particle } from './Particle';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        ParticleSystem: ParticleSystem\r\n    }\r\n    export interface MixinsDefaultGeometry\r\n    {\r\n        'Billboard-Geometry': QuadGeometry;\r\n    }\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        'Particle System': GameObject;\r\n    }\r\n\r\n    export interface MixinsGameObjectEventMap\r\n    {\r\n        /**\r\n         * 粒子系统播放完一个周期\r\n         */\r\n        particleCycled: ParticleSystem;\r\n\r\n        /**\r\n         * 粒子效果播放结束\r\n         */\r\n        particleCompleted: ParticleSystem;\r\n    }\r\n}\r\n\r\n/**\r\n * 粒子系统\r\n */\r\n@AddComponentMenu('Effects/ParticleSystem')\r\n@RegisterComponent()\r\nexport class ParticleSystem extends Renderable\r\n{\r\n    __class__: 'feng3d.ParticleSystem';\r\n\r\n    /**\r\n     * Is the particle system playing right now ?\r\n     *\r\n     * 粒子系统正在运行吗?\r\n     */\r\n    get isPlaying()\r\n    {\r\n        return this._isPlaying;\r\n    }\r\n    private _isPlaying = false;\r\n\r\n    /**\r\n     * Is the particle system stopped right now ?\r\n     *\r\n     * 粒子系统现在停止了吗?\r\n     */\r\n    get isStopped()\r\n    {\r\n        return !this._isPlaying && this.time === 0;\r\n    }\r\n\r\n    /**\r\n     * Is the particle system paused right now ?\r\n     *\r\n     * 粒子系统现在暂停了吗?\r\n     */\r\n    get isPaused()\r\n    {\r\n        return !this._isPlaying && this.time !== 0;\r\n    }\r\n\r\n    /**\r\n     * The current number of particles (Read Only).\r\n     *\r\n     * 当前粒子数(只读)。\r\n     */\r\n    get particleCount()\r\n    {\r\n        return this._activeParticles.length;\r\n    }\r\n\r\n    /**\r\n     * Playback position in seconds.\r\n     *\r\n     * 回放位置(秒)\r\n     */\r\n    time = 0;\r\n\r\n    @serialize\r\n    @oav({ block: 'Main', component: 'OAVObjectView' })\r\n    get main() { return this._main; }\r\n    set main(v)\r\n    {\r\n        if (this._main)\r\n        {\r\n            watcher.unwatch(this._main, 'simulationSpace', this._simulationSpaceChanged, this);\r\n        }\r\n        ArrayUtils.replace(this._modules, this._main, v);\r\n        v.particleSystem = this;\r\n        this._main = v;\r\n        watcher.watch(this._main, 'simulationSpace', this._simulationSpaceChanged, this);\r\n    }\r\n    private _main: ParticleMainModule;\r\n\r\n    @serialize\r\n    @oav({ block: 'Emission', component: 'OAVObjectView' })\r\n    get emission() { return this._emission; }\r\n    set emission(v)\r\n    {\r\n        ArrayUtils.replace(this._modules, this._emission, v);\r\n        v.particleSystem = this;\r\n        this._emission = v;\r\n    }\r\n    private _emission: ParticleEmissionModule;\r\n\r\n    @serialize\r\n    @oav({ block: 'Shape', component: 'OAVObjectView' })\r\n    get shape() { return this._shape; }\r\n    set shape(v)\r\n    {\r\n        ArrayUtils.replace(this._modules, this._shape, v);\r\n        v.particleSystem = this;\r\n        this._shape = v;\r\n    }\r\n    private _shape: ParticleShapeModule;\r\n\r\n    @serialize\r\n    @oav({ block: 'Velocity Over Lifetime', component: 'OAVObjectView' })\r\n    get velocityOverLifetime() { return this._velocityOverLifetime; }\r\n    set velocityOverLifetime(v)\r\n    {\r\n        ArrayUtils.replace(this._modules, this._velocityOverLifetime, v);\r\n        v.particleSystem = this;\r\n        this._velocityOverLifetime = v;\r\n    }\r\n    private _velocityOverLifetime: ParticleVelocityOverLifetimeModule;\r\n\r\n    @serialize\r\n    // @oav({ tooltip: \"limit velocity over lifetime module.\", block: \"limitVelocityOverLifetime\", component: \"OAVObjectView\" })\r\n    @oav({ tooltip: '基于时间轴限制速度模块。', block: 'Limit Velocity Over Lifetime', component: 'OAVObjectView' })\r\n    get limitVelocityOverLifetime() { return this._limitVelocityOverLifetime; }\r\n    set limitVelocityOverLifetime(v)\r\n    {\r\n        ArrayUtils.replace(this._modules, this._limitVelocityOverLifetime, v);\r\n        v.particleSystem = this;\r\n        this._limitVelocityOverLifetime = v;\r\n    }\r\n    private _limitVelocityOverLifetime: ParticleLimitVelocityOverLifetimeModule;\r\n\r\n    /**\r\n     * Script interface for the Particle System velocity inheritance module.\r\n     *\r\n     * 粒子系统速度继承模块。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '粒子系统速度继承模块。', block: 'Inherit Velocity', component: 'OAVObjectView' })\r\n    get inheritVelocity() { return this._inheritVelocity; }\r\n    set inheritVelocity(v)\r\n    {\r\n        ArrayUtils.replace(this._modules, this._inheritVelocity, v);\r\n        v.particleSystem = this;\r\n        this._inheritVelocity = v;\r\n    }\r\n    private _inheritVelocity: ParticleInheritVelocityModule;\r\n\r\n    @serialize\r\n    @oav({ block: 'Force Over Lifetime', component: 'OAVObjectView' })\r\n    get forceOverLifetime() { return this._forceOverLifetime; }\r\n    set forceOverLifetime(v)\r\n    {\r\n        ArrayUtils.replace(this._modules, this._forceOverLifetime, v);\r\n        v.particleSystem = this;\r\n        this._forceOverLifetime = v;\r\n    }\r\n    private _forceOverLifetime: ParticleForceOverLifetimeModule;\r\n\r\n    @serialize\r\n    @oav({ block: 'Color Over Lifetime', component: 'OAVObjectView' })\r\n    get colorOverLifetime() { return this._colorOverLifetime; }\r\n    set colorOverLifetime(v)\r\n    {\r\n        ArrayUtils.replace(this._modules, this._colorOverLifetime, v);\r\n        v.particleSystem = this;\r\n        this._colorOverLifetime = v;\r\n    }\r\n    private _colorOverLifetime: ParticleColorOverLifetimeModule;\r\n\r\n    /**\r\n     * 颜色随速度变化模块。\r\n     */\r\n    @serialize\r\n    @oav({ block: 'Color By Speed', component: 'OAVObjectView' })\r\n    get colorBySpeed() { return this._colorBySpeed; }\r\n    set colorBySpeed(v)\r\n    {\r\n        ArrayUtils.replace(this._modules, this._colorBySpeed, v);\r\n        v.particleSystem = this;\r\n        this._colorBySpeed = v;\r\n    }\r\n    private _colorBySpeed: ParticleColorBySpeedModule;\r\n\r\n    @serialize\r\n    @oav({ block: 'sizeOverLifetime', component: 'OAVObjectView' })\r\n    get sizeOverLifetime() { return this._sizeOverLifetime; }\r\n    set sizeOverLifetime(v)\r\n    {\r\n        ArrayUtils.replace(this._modules, this._sizeOverLifetime, v);\r\n        v.particleSystem = this;\r\n        this._sizeOverLifetime = v;\r\n    }\r\n    private _sizeOverLifetime: ParticleSizeOverLifetimeModule;\r\n\r\n    /**\r\n     * 缩放随速度变化模块\r\n     */\r\n    @serialize\r\n    @oav({ block: 'Size By Speed', component: 'OAVObjectView' })\r\n    get sizeBySpeed() { return this._sizeBySpeed; }\r\n    set sizeBySpeed(v)\r\n    {\r\n        ArrayUtils.replace(this._modules, this._sizeBySpeed, v);\r\n        v.particleSystem = this;\r\n        this._sizeBySpeed = v;\r\n    }\r\n    private _sizeBySpeed: ParticleSizeBySpeedModule;\r\n\r\n    @serialize\r\n    @oav({ block: 'Rotation Over Lifetime', component: 'OAVObjectView' })\r\n    get rotationOverLifetime() { return this._rotationOverLifetime; }\r\n    set rotationOverLifetime(v)\r\n    {\r\n        ArrayUtils.replace(this._modules, this._rotationOverLifetime, v);\r\n        v.particleSystem = this;\r\n        this._rotationOverLifetime = v;\r\n    }\r\n    private _rotationOverLifetime: ParticleRotationOverLifetimeModule;\r\n\r\n    /**\r\n     * 旋转角度随速度变化模块\r\n     */\r\n    @serialize\r\n    @oav({ block: 'Rotation By Speed', component: 'OAVObjectView' })\r\n    get rotationBySpeed() { return this._rotationBySpeed; }\r\n    set rotationBySpeed(v)\r\n    {\r\n        ArrayUtils.replace(this._modules, this._rotationBySpeed, v);\r\n        v.particleSystem = this;\r\n        this._rotationBySpeed = v;\r\n    }\r\n    private _rotationBySpeed: ParticleRotationBySpeedModule;\r\n\r\n    /**\r\n     * 旋转角度随速度变化模块\r\n     */\r\n    @serialize\r\n    @oav({ block: 'Noise', component: 'OAVObjectView' })\r\n    get noise() { return this._noise; }\r\n    set noise(v)\r\n    {\r\n        ArrayUtils.replace(this._modules, this._noise, v);\r\n        v.particleSystem = this;\r\n        this._noise = v;\r\n    }\r\n    private _noise: ParticleNoiseModule;\r\n\r\n    /**\r\n     * 旋转角度随速度变化模块\r\n     */\r\n    @serialize\r\n    @oav({ block: 'Sub Emitters', component: 'OAVObjectView' })\r\n    get subEmitters() { return this._subEmitters; }\r\n    set subEmitters(v)\r\n    {\r\n        ArrayUtils.replace(this._modules, this._subEmitters, v);\r\n        v.particleSystem = this;\r\n        this._subEmitters = v;\r\n    }\r\n    private _subEmitters: ParticleSubEmittersModule;\r\n\r\n    /**\r\n     * 粒子系统纹理表动画模块。\r\n     */\r\n    @serialize\r\n    @oav({ tooltip: '粒子系统纹理表动画模块。', block: 'Texture Sheet Animation', component: 'OAVObjectView' })\r\n    get textureSheetAnimation() { return this._textureSheetAnimation; }\r\n    set textureSheetAnimation(v)\r\n    {\r\n        ArrayUtils.replace(this._modules, this._textureSheetAnimation, v);\r\n        v.particleSystem = this;\r\n        this._textureSheetAnimation = v;\r\n    }\r\n    private _textureSheetAnimation: ParticleTextureSheetAnimationModule;\r\n\r\n    @oav({ tooltip: '粒子系统渲染模块。', block: 'Renderer' })\r\n    geometry = Geometry.getDefault('Billboard-Geometry');\r\n\r\n    @oav({ block: 'Renderer' })\r\n    material = Material.getDefault('Particle-Material');\r\n\r\n    @oav({ block: 'Renderer' })\r\n    @serialize\r\n    castShadows = true;\r\n\r\n    @oav({ block: 'Renderer' })\r\n    @serialize\r\n    receiveShadows = true;\r\n\r\n    get single() { return true; }\r\n\r\n    constructor()\r\n    {\r\n        super();\r\n\r\n        this.main = new ParticleMainModule();\r\n        this.emission = new ParticleEmissionModule();\r\n        this.shape = new ParticleShapeModule();\r\n        this.velocityOverLifetime = new ParticleVelocityOverLifetimeModule();\r\n        this.inheritVelocity = new ParticleInheritVelocityModule();\r\n        this.forceOverLifetime = new ParticleForceOverLifetimeModule();\r\n        this.limitVelocityOverLifetime = new ParticleLimitVelocityOverLifetimeModule();\r\n        this.colorOverLifetime = new ParticleColorOverLifetimeModule();\r\n        this.colorBySpeed = new ParticleColorBySpeedModule();\r\n        this.sizeOverLifetime = new ParticleSizeOverLifetimeModule();\r\n        this.sizeBySpeed = new ParticleSizeBySpeedModule();\r\n        this.rotationOverLifetime = new ParticleRotationOverLifetimeModule();\r\n        this.rotationBySpeed = new ParticleRotationBySpeedModule();\r\n        this.noise = new ParticleNoiseModule();\r\n        this.subEmitters = new ParticleSubEmittersModule();\r\n        this.textureSheetAnimation = new ParticleTextureSheetAnimationModule();\r\n\r\n        this.main.enabled = true;\r\n        this.emission.enabled = true;\r\n        this.shape.enabled = true;\r\n    }\r\n\r\n    update(interval: number)\r\n    {\r\n        if (!this.isPlaying) return;\r\n\r\n        const deltaTime = this.main.simulationSpeed * interval / 1000;\r\n        this.time = this.time + deltaTime;\r\n\r\n        const emitInfo = this._emitInfo;\r\n\r\n        emitInfo.preTime = emitInfo.currentTime;\r\n        emitInfo.currentTime = this.time - emitInfo.startDelay;\r\n        emitInfo.preWorldPos.copy(emitInfo.currentWorldPos);\r\n\r\n        // 粒子系统位置\r\n        emitInfo.currentWorldPos.copy(this.transform.worldPosition);\r\n\r\n        // 粒子系统位移\r\n        emitInfo.moveVec.copy(emitInfo.currentWorldPos).sub(emitInfo.preWorldPos);\r\n        // 粒子系统速度\r\n        emitInfo.speed.copy(emitInfo.moveVec).divideNumber(deltaTime);\r\n\r\n        this._modules.forEach((m) =>\r\n        {\r\n            m.update(deltaTime);\r\n        });\r\n\r\n        this._updateActiveParticlesState(deltaTime);\r\n\r\n        // 完成一个循环\r\n        if (this.main.loop && Math.floor(emitInfo.preTime / this.main.duration) < Math.floor(emitInfo.currentTime / this.main.duration))\r\n        {\r\n            // 重新计算喷发概率\r\n            this.emission.bursts.forEach((element) =>\r\n            {\r\n                element.calculateProbability();\r\n            });\r\n            this.emit('particleCycled', this);\r\n        }\r\n\r\n        // 发射粒子\r\n        if (!this._isSubParticleSystem) // 子粒子系统自身不会自动发射粒子\r\n        {\r\n            const emits = this._emit(emitInfo);\r\n\r\n            emits.sort((a, b) => a.time - b.time);\r\n            emits.forEach((v) =>\r\n            {\r\n                this._emitParticles(v);\r\n            });\r\n        }\r\n\r\n        // 判断非循环的效果是否播放结束\r\n        if (!this.main.loop && this._activeParticles.length === 0 && emitInfo.currentTime > this.main.duration)\r\n        {\r\n            this.stop();\r\n            this.emit('particleCompleted', this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 停止\r\n     */\r\n    stop()\r\n    {\r\n        this._isPlaying = false;\r\n        this.time = 0;\r\n\r\n        this._particlePool = this._particlePool.concat(this._activeParticles);\r\n        this._activeParticles.length = 0;\r\n    }\r\n\r\n    /**\r\n     * 播放\r\n     */\r\n    play()\r\n    {\r\n        this._isPlaying = true;\r\n        this.time = 0;\r\n\r\n        this._particlePool = this._particlePool.concat(this._activeParticles);\r\n        this._activeParticles.length = 0;\r\n\r\n        const startDelay = this.main.startDelay.getValue(Math.random());\r\n\r\n        this._emitInfo\r\n            = {\r\n            preTime: -startDelay,\r\n            currentTime: -startDelay,\r\n            preWorldPos: new Vector3(),\r\n            currentWorldPos: new Vector3(),\r\n            rateAtDuration: 0,\r\n            _leftRateOverDistance: 0,\r\n            _isRateOverDistance: false,\r\n            startDelay,\r\n            moveVec: new Vector3(),\r\n            speed: new Vector3(),\r\n            position: new Vector3(),\r\n        };\r\n\r\n        // 重新计算喷发概率\r\n        this.emission.bursts.forEach((element) =>\r\n        {\r\n            element.calculateProbability();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 暂停\r\n     */\r\n    pause()\r\n    {\r\n        this._isPlaying = false;\r\n    }\r\n\r\n    /**\r\n     * 继续\r\n     */\r\n    continue()\r\n    {\r\n        if (this.time === 0)\r\n        {\r\n            this.play();\r\n        }\r\n        else\r\n        {\r\n            this._isPlaying = true;\r\n            this._emitInfo.preTime = Math.max(0, this._emitInfo.currentTime);\r\n        }\r\n    }\r\n\r\n    beforeRender(renderAtomic: RenderAtomic, scene: Scene, camera: Camera)\r\n    {\r\n        super.beforeRender(renderAtomic, scene, camera);\r\n\r\n        if (Boolean(scene.runEnvironment & RunEnvironment.feng3d) && !this._awaked)\r\n        {\r\n            if (this.main.playOnAwake && !this._isPlaying)\r\n            {\r\n                this.play();\r\n            }\r\n            this._awaked = true;\r\n        }\r\n\r\n        renderAtomic.instanceCount = this._activeParticles.length;\r\n        //\r\n        renderAtomic.shaderMacro.HAS_PARTICLE_ANIMATOR = true;\r\n\r\n        renderAtomic.shaderMacro.ENABLED_PARTICLE_SYSTEM_textureSheetAnimation = this.textureSheetAnimation.enabled;\r\n\r\n        // 计算公告牌矩阵\r\n        const isbillboard = !this.shape.alignToDirection && this.geometry === Geometry.getDefault('Billboard-Geometry');\r\n        const billboardMatrix = new Matrix3x3();\r\n        if (isbillboard)\r\n        {\r\n            const cameraMatrix = camera.transform.localToWorldMatrix.clone();\r\n            let localCameraForward = cameraMatrix.getAxisZ();\r\n            let localCameraUp = cameraMatrix.getAxisY();\r\n            if (this.main.simulationSpace === ParticleSystemSimulationSpace.Local)\r\n            {\r\n                localCameraForward = this.gameObject.transform.worldToLocalRotationMatrix.transformPoint3(localCameraForward);\r\n                localCameraUp = this.gameObject.transform.worldToLocalRotationMatrix.transformPoint3(localCameraUp);\r\n            }\r\n            const matrix4x4 = new Matrix4x4();\r\n            matrix4x4.lookAt(localCameraForward, localCameraUp);\r\n            billboardMatrix.formMatrix4x4(matrix4x4);\r\n        }\r\n\r\n        const positions: number[] = [];\r\n        const scales: number[] = [];\r\n        const rotations: number[] = [];\r\n        const colors: number[] = [];\r\n        const tilingOffsets: number[] = [];\r\n        const flipUVs: number[] = [];\r\n        for (let i = 0, n = this._activeParticles.length; i < n; i++)\r\n        {\r\n            const particle = this._activeParticles[i];\r\n            positions.push(particle.position.x, particle.position.y, particle.position.z);\r\n            scales.push(particle.size.x, particle.size.y, particle.size.z);\r\n\r\n            rotations.push(particle.rotation.x, particle.rotation.y, particle.rotation.z);\r\n            colors.push(particle.color.r, particle.color.g, particle.color.b, particle.color.a);\r\n            tilingOffsets.push(particle.tilingOffset.x, particle.tilingOffset.y, particle.tilingOffset.z, particle.tilingOffset.w);\r\n            flipUVs.push(particle.flipUV.x, particle.flipUV.y);\r\n        }\r\n\r\n        if (isbillboard)\r\n        {\r\n            for (let i = 0, n = rotations.length; i < n; i += 3)\r\n            {\r\n                rotations[i + 2] = -rotations[i + 2];\r\n            }\r\n        }\r\n\r\n        //\r\n        this._attributes.a_particle_position.data = positions;\r\n        this._attributes.a_particle_scale.data = scales;\r\n        this._attributes.a_particle_rotation.data = rotations;\r\n        this._attributes.a_particle_color.data = colors;\r\n        this._attributes.a_particle_tilingOffset.data = tilingOffsets;\r\n        this._attributes.a_particle_flipUV.data = flipUVs;\r\n\r\n        //\r\n        renderAtomic.uniforms.u_particle_billboardMatrix = billboardMatrix;\r\n\r\n        if (this.main.simulationSpace === ParticleSystemSimulationSpace.World)\r\n        {\r\n            renderAtomic.uniforms.u_modelMatrix = () => new Matrix4x4();\r\n            renderAtomic.uniforms.u_ITModelMatrix = () => new Matrix4x4();\r\n        }\r\n\r\n        for (const key in this._attributes)\r\n        {\r\n            renderAtomic.attributes[key] = this._attributes[key];\r\n        }\r\n    }\r\n\r\n    private _awaked = false;\r\n\r\n    /**\r\n     * 粒子池，用于存放未发射或者死亡粒子\r\n     */\r\n    private _particlePool: Particle[] = [];\r\n    /**\r\n     * 活跃的粒子列表\r\n     */\r\n    private _activeParticles: Particle[] = [];\r\n\r\n    /**\r\n     * 属性数据列表\r\n     */\r\n    private _attributes = {\r\n        a_particle_position: new Attribute({ name: 'a_particle_position', data: [], size: 3, divisor: 1 }),\r\n        a_particle_scale: new Attribute({ name: 'a_particle_scale', data: [], size: 3, divisor: 1 }),\r\n        a_particle_rotation: new Attribute({ name: 'a_particle_rotation', data: [], size: 3, divisor: 1 }),\r\n        a_particle_color: new Attribute({ name: 'a_particle_color', data: [], size: 4, divisor: 1 }),\r\n        a_particle_tilingOffset: new Attribute({ name: 'a_particle_tilingOffset', data: [], size: 4, divisor: 1 }),\r\n        a_particle_flipUV: new Attribute({ name: 'a_particle_flipUV', data: [], size: 2, divisor: 1 }),\r\n    };\r\n\r\n    private readonly _modules: ParticleModule[] = [];\r\n\r\n    /**\r\n     * 发射粒子\r\n     *\r\n     * @param startTime 发射起始时间\r\n     * @param endTime 发射终止时间\r\n     * @param startPos 发射起始位置\r\n     * @param stopPos 发射终止位置\r\n     */\r\n    private _emit(emitInfo: ParticleSystemEmitInfo)\r\n    {\r\n        //\r\n        let emits: { time: number, num: number, position: Vector3, emitInfo: ParticleSystemEmitInfo }[] = [];\r\n\r\n        const startTime = emitInfo.preTime;\r\n        let endTime = emitInfo.currentTime;\r\n\r\n        if (!this.emission.enabled) return emits;\r\n\r\n        // 判断是否开始发射\r\n        if (endTime <= 0) return emits;\r\n\r\n        const loop = this.main.loop;\r\n        const duration = this.main.duration;\r\n\r\n        // 判断是否结束发射\r\n        if (!loop && startTime >= duration) return emits;\r\n\r\n        // 计算最后发射时间\r\n        if (!loop) endTime = Math.min(endTime, duration);\r\n\r\n        // 计算此处在发射周期的位置\r\n        let rateAtDuration = (endTime % duration) / duration;\r\n        if (rateAtDuration === 0 && endTime >= duration) rateAtDuration = 1;\r\n\r\n        emitInfo.rateAtDuration = rateAtDuration;\r\n\r\n        // 处理移动发射粒子\r\n        const moveEmits = this._emitWithMove(emitInfo);\r\n        emits = emits.concat(moveEmits);\r\n\r\n        // 单粒子发射周期\r\n        const timeEmits = this._emitWithTime(emitInfo, duration);\r\n        emits = emits.concat(timeEmits);\r\n\r\n        return emits;\r\n    }\r\n\r\n    /**\r\n     * 计算在指定移动的位移线段中发射的粒子列表。\r\n     *\r\n     * @param rateAtDuration\r\n     * @param prePos\r\n     * @param currentPos\r\n     */\r\n    private _emitWithMove(emitInfo: ParticleSystemEmitInfo)\r\n    {\r\n        const emits: { time: number; num: number; position: Vector3; emitInfo: ParticleSystemEmitInfo; }[] = [];\r\n        if (this.main.simulationSpace === ParticleSystemSimulationSpace.World)\r\n        {\r\n            if (emitInfo._isRateOverDistance)\r\n            {\r\n                const moveVec = emitInfo.currentWorldPos.subTo(emitInfo.preWorldPos);\r\n                const moveDistance = moveVec.length;\r\n                const worldPos = emitInfo.currentWorldPos;\r\n                // 本次移动距离\r\n                if (moveDistance > 0)\r\n                {\r\n                    // 移动方向\r\n                    const moveDir = moveVec.clone().normalize();\r\n                    // 剩余移动量\r\n                    let leftRateOverDistance = emitInfo._leftRateOverDistance + moveDistance;\r\n                    // 发射频率\r\n                    const rateOverDistance = this.emission.rateOverDistance.getValue(emitInfo.rateAtDuration);\r\n                    // 发射间隔距离\r\n                    const invRateOverDistance = 1 / rateOverDistance;\r\n                    // 发射间隔位移\r\n                    const invRateOverDistanceVec = moveDir.scaleNumberTo(1 / rateOverDistance);\r\n                    // 上次发射位置\r\n                    const lastRateOverDistance = emitInfo.preWorldPos.addTo(moveDir.negateTo().scaleNumber(emitInfo._leftRateOverDistance));\r\n\r\n                    while (invRateOverDistance < leftRateOverDistance)\r\n                    {\r\n                        emits.push({\r\n                            position: lastRateOverDistance.add(invRateOverDistanceVec).clone().sub(worldPos),\r\n                            time: emitInfo.preTime + (emitInfo.currentTime - emitInfo.preTime) * (1 - leftRateOverDistance / moveDistance),\r\n                            num: 1,\r\n                            emitInfo\r\n                        });\r\n                        leftRateOverDistance -= invRateOverDistance;\r\n                    }\r\n                    emitInfo._leftRateOverDistance = leftRateOverDistance;\r\n                }\r\n            }\r\n            emitInfo._isRateOverDistance = true;\r\n        }\r\n        else\r\n        {\r\n            emitInfo._isRateOverDistance = false;\r\n            emitInfo._leftRateOverDistance = 0;\r\n        }\r\n\r\n        return emits;\r\n    }\r\n\r\n    /**\r\n     * 计算在指定时间段内发射的粒子列表\r\n     *\r\n     * @param rateAtDuration\r\n     * @param preRealTime\r\n     * @param duration\r\n     * @param realEmitTime\r\n     */\r\n    private _emitWithTime(emitInfo: ParticleSystemEmitInfo, duration: number)\r\n    {\r\n        const rateAtDuration = emitInfo.rateAtDuration;\r\n        const preTime = emitInfo.preTime;\r\n        const currentTime = emitInfo.currentTime;\r\n\r\n        const emits: { time: number; num: number; position: Vector3; emitInfo: ParticleSystemEmitInfo }[] = [];\r\n\r\n        const step = 1 / this.emission.rateOverTime.getValue(rateAtDuration);\r\n        const bursts = this.emission.bursts;\r\n        // 遍历所有发射周期\r\n        const cycleStartIndex = Math.floor(preTime / duration);\r\n        const cycleEndIndex = Math.ceil(currentTime / duration);\r\n        for (let k = cycleStartIndex; k < cycleEndIndex; k++)\r\n        {\r\n            const cycleStartTime = k * duration;\r\n            const cycleEndTime = (k + 1) * duration;\r\n            // 单个周期内的起始与结束时间\r\n            const startTime = Math.max(preTime, cycleStartTime);\r\n            const endTime = Math.min(currentTime, cycleEndTime);\r\n            // 处理稳定发射\r\n            const singleStart = Math.ceil(startTime / step) * step;\r\n            for (let i = singleStart; i < endTime; i += step)\r\n            {\r\n                emits.push({ time: i, num: 1, emitInfo, position: emitInfo.position.clone() });\r\n            }\r\n            // 处理喷发\r\n            const inCycleStart = startTime - cycleStartTime;\r\n            const inCycleEnd = endTime - cycleStartTime;\r\n            for (let i = 0; i < bursts.length; i++)\r\n            {\r\n                const burst = bursts[i];\r\n                if (burst.isProbability && inCycleStart <= burst.time && burst.time < inCycleEnd)\r\n                {\r\n                    emits.push({ time: cycleStartTime + burst.time, num: burst.count.getValue(rateAtDuration), emitInfo, position: emitInfo.position.clone() });\r\n                }\r\n            }\r\n        }\r\n\r\n        return emits;\r\n    }\r\n\r\n    /**\r\n     * 发射粒子\r\n     * @param birthTime 发射时间\r\n     * @param num 发射数量\r\n     */\r\n    private _emitParticles(v: { time: number; num: number; position: Vector3; emitInfo: ParticleSystemEmitInfo })\r\n    {\r\n        const num = v.num;\r\n        const birthTime = v.time;\r\n        const position = v.position;\r\n        const emitInfo = v.emitInfo;\r\n        for (let i = 0; i < num; i++)\r\n        {\r\n            if (this._activeParticles.length >= this.main.maxParticles) return;\r\n            const lifetime = this.main.startLifetime.getValue(emitInfo.rateAtDuration);\r\n            const birthRateAtDuration = (birthTime - emitInfo.startDelay) / this.main.duration;\r\n            const rateAtLifeTime = (emitInfo.currentTime - birthTime) / lifetime;\r\n\r\n            if (rateAtLifeTime < 1)\r\n            {\r\n                const particle = this._particlePool.pop() || new Particle();\r\n                particle.cache = {};\r\n                particle.position.copy(position);\r\n                particle.birthTime = birthTime;\r\n                particle.lifetime = lifetime;\r\n                particle.rateAtLifeTime = rateAtLifeTime;\r\n                //\r\n                particle.birthRateAtDuration = birthRateAtDuration - Math.floor(birthRateAtDuration);\r\n                //\r\n                particle.preTime = emitInfo.currentTime;\r\n                particle.curTime = emitInfo.currentTime;\r\n                particle.prePosition = position.clone();\r\n                particle.curPosition = position.clone();\r\n\r\n                //\r\n                this._activeParticles.push(particle);\r\n                this._initParticleState(particle);\r\n                this._updateParticleState(particle, 0);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 更新活跃粒子状态\r\n     */\r\n    private _updateActiveParticlesState(deltaTime: number)\r\n    {\r\n        for (let i = this._activeParticles.length - 1; i >= 0; i--)\r\n        {\r\n            const particle = this._activeParticles[i];\r\n\r\n            particle.rateAtLifeTime = (particle.curTime + deltaTime - particle.birthTime) / particle.lifetime;\r\n            if (particle.rateAtLifeTime < 0 || particle.rateAtLifeTime > 1)\r\n            {\r\n                this._activeParticles.splice(i, 1);\r\n                this._particlePool.push(particle);\r\n                particle.subEmitInfo = null;\r\n            }\r\n            else\r\n            {\r\n                this._updateParticleState(particle, deltaTime);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 初始化粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    private _initParticleState(particle: Particle)\r\n    {\r\n        this._modules.forEach((v) => { v.initParticleState(particle); });\r\n    }\r\n\r\n    /**\r\n     * 更新粒子状态\r\n     * @param particle 粒子\r\n     */\r\n    private _updateParticleState(particle: Particle, deltaTime: number)\r\n    {\r\n        //\r\n        this._modules.forEach((v) => { v.updateParticleState(particle); });\r\n        particle.updateState(particle.curTime + deltaTime);\r\n    }\r\n\r\n    private _simulationSpaceChanged()\r\n    {\r\n        if (!this.transform) return;\r\n        if (this._activeParticles.length === 0) return;\r\n\r\n        if (this._main.simulationSpace === ParticleSystemSimulationSpace.Local)\r\n        {\r\n            const worldToLocalMatrix = this.transform.worldToLocalMatrix;\r\n            this._activeParticles.forEach((p) =>\r\n            {\r\n                worldToLocalMatrix.transformPoint3(p.position, p.position);\r\n                worldToLocalMatrix.transformVector3(p.velocity, p.velocity);\r\n                worldToLocalMatrix.transformVector3(p.acceleration, p.acceleration);\r\n            });\r\n        }\r\n        else\r\n        {\r\n            const localToWorldMatrix = this.transform.localToWorldMatrix;\r\n            this._activeParticles.forEach((p) =>\r\n            {\r\n                localToWorldMatrix.transformPoint3(p.position, p.position);\r\n                localToWorldMatrix.transformVector3(p.velocity, p.velocity);\r\n                localToWorldMatrix.transformVector3(p.acceleration, p.acceleration);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 给指定粒子添加指定空间的位移。\r\n     *\r\n     * @param particle 粒子。\r\n     * @param position 速度。\r\n     * @param space 速度所在空间。\r\n     * @param name  速度名称。如果不为 undefined 时保存，调用 removeParticleVelocity 可以移除该部分速度。\r\n     */\r\n    addParticlePosition(particle: Particle, position: Vector3, space: ParticleSystemSimulationSpace, name?: string)\r\n    {\r\n        if (name !== undefined)\r\n        {\r\n            this.removeParticleVelocity(particle, name);\r\n            particle.cache[name] = { value: position.clone(), space };\r\n        }\r\n\r\n        if (space !== this.main.simulationSpace)\r\n        {\r\n            if (space === ParticleSystemSimulationSpace.World)\r\n            {\r\n                this.transform.worldToLocalMatrix.transformPoint3(position, position);\r\n            }\r\n            else\r\n            {\r\n                this.transform.localToWorldMatrix.transformPoint3(position, position);\r\n            }\r\n        }\r\n        //\r\n        particle.position.add(position);\r\n    }\r\n\r\n    /**\r\n     * 移除指定粒子上的位移\r\n     *\r\n     * @param particle 粒子。\r\n     * @param name 位移名称。\r\n     */\r\n    removeParticlePosition(particle: Particle, name: string)\r\n    {\r\n        const obj: { value: Vector3, space: ParticleSystemSimulationSpace } = particle.cache[name];\r\n        if (obj)\r\n        {\r\n            delete particle.cache[name];\r\n\r\n            const space = obj.space;\r\n            const value = obj.value;\r\n            if (space !== this.main.simulationSpace)\r\n            {\r\n                if (space === ParticleSystemSimulationSpace.World)\r\n                {\r\n                    this.transform.worldToLocalMatrix.transformPoint3(value, value);\r\n                }\r\n                else\r\n                {\r\n                    this.transform.localToWorldMatrix.transformPoint3(value, value);\r\n                }\r\n            }\r\n            //\r\n            particle.position.sub(value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 给指定粒子添加指定空间的速度。\r\n     *\r\n     * @param particle 粒子。\r\n     * @param velocity 速度。\r\n     * @param space 速度所在空间。\r\n     * @param name  速度名称。如果不为 undefined 时保存，调用 removeParticleVelocity 可以移除该部分速度。\r\n     */\r\n    addParticleVelocity(particle: Particle, velocity: Vector3, space: ParticleSystemSimulationSpace, name?: string)\r\n    {\r\n        if (name !== undefined)\r\n        {\r\n            this.removeParticleVelocity(particle, name);\r\n            particle.cache[name] = { value: velocity.clone(), space };\r\n        }\r\n\r\n        if (space !== this.main.simulationSpace)\r\n        {\r\n            if (space === ParticleSystemSimulationSpace.World)\r\n            {\r\n                this.transform.worldToLocalMatrix.transformVector3(velocity, velocity);\r\n            }\r\n            else\r\n            {\r\n                this.transform.localToWorldMatrix.transformVector3(velocity, velocity);\r\n            }\r\n        }\r\n        //\r\n        particle.velocity.add(velocity);\r\n    }\r\n\r\n    /**\r\n     * 移除指定粒子上的速度\r\n     *\r\n     * @param particle 粒子。\r\n     * @param name 速度名称。\r\n     */\r\n    removeParticleVelocity(particle: Particle, name: string)\r\n    {\r\n        const obj: { value: Vector3, space: ParticleSystemSimulationSpace } = particle.cache[name];\r\n        if (obj)\r\n        {\r\n            delete particle.cache[name];\r\n\r\n            const space = obj.space;\r\n            const value = obj.value;\r\n            if (space !== this.main.simulationSpace)\r\n            {\r\n                if (space === ParticleSystemSimulationSpace.World)\r\n                {\r\n                    this.transform.worldToLocalMatrix.transformVector3(value, value);\r\n                }\r\n                else\r\n                {\r\n                    this.transform.localToWorldMatrix.transformVector3(value, value);\r\n                }\r\n            }\r\n            //\r\n            particle.velocity.sub(value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 给指定粒子添加指定空间的速度。\r\n     *\r\n     * @param particle 粒子。\r\n     * @param acceleration 加速度。\r\n     * @param space 加速度所在空间。\r\n     * @param name  加速度名称。如果不为 undefined 时保存，调用 removeParticleVelocity 可以移除该部分速度。\r\n     */\r\n    addParticleAcceleration(particle: Particle, acceleration: Vector3, space: ParticleSystemSimulationSpace, name?: string)\r\n    {\r\n        if (name !== undefined)\r\n        {\r\n            this.removeParticleAcceleration(particle, name);\r\n            particle.cache[name] = { value: acceleration.clone(), space };\r\n        }\r\n\r\n        if (space !== this.main.simulationSpace)\r\n        {\r\n            if (space === ParticleSystemSimulationSpace.World)\r\n            {\r\n                this.transform.worldToLocalMatrix.transformVector3(acceleration, acceleration);\r\n            }\r\n            else\r\n            {\r\n                this.transform.localToWorldMatrix.transformVector3(acceleration, acceleration);\r\n            }\r\n        }\r\n        //\r\n        particle.acceleration.add(acceleration);\r\n    }\r\n\r\n    /**\r\n     * 移除指定粒子上的加速度\r\n     *\r\n     * @param particle 粒子。\r\n     * @param name 加速度名称。\r\n     */\r\n    removeParticleAcceleration(particle: Particle, name: string)\r\n    {\r\n        const obj: { value: Vector3, space: ParticleSystemSimulationSpace } = particle.cache[name];\r\n        if (obj)\r\n        {\r\n            delete particle.cache[name];\r\n\r\n            const space = obj.space;\r\n            const value = obj.value;\r\n            if (space !== this.main.simulationSpace)\r\n            {\r\n                if (space === ParticleSystemSimulationSpace.World)\r\n                {\r\n                    this.transform.worldToLocalMatrix.transformVector3(value, value);\r\n                }\r\n                else\r\n                {\r\n                    this.transform.localToWorldMatrix.transformVector3(value, value);\r\n                }\r\n            }\r\n            //\r\n            particle.acceleration.sub(value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 触发子发射器\r\n     *\r\n     * @param subEmitterIndex 子发射器索引\r\n     */\r\n    TriggerSubEmitter(subEmitterIndex: number, particles: Particle[] = null)\r\n    {\r\n        if (!this.subEmitters.enabled) return;\r\n\r\n        const subEmitter = this.subEmitters.GetSubEmitterSystem(subEmitterIndex);\r\n        if (!subEmitter) return;\r\n\r\n        if (!subEmitter.enabled) return;\r\n\r\n        const probability = this.subEmitters.GetSubEmitterEmitProbability(subEmitterIndex);\r\n        this.subEmitters.GetSubEmitterProperties(subEmitterIndex);\r\n        this.subEmitters.GetSubEmitterType(subEmitterIndex);\r\n\r\n        particles = particles || this._activeParticles;\r\n\r\n        let emits: {\r\n            time: number;\r\n            num: number;\r\n            position: Vector3;\r\n            emitInfo: ParticleSystemEmitInfo;\r\n        }[] = [];\r\n\r\n        particles.forEach((particle) =>\r\n        {\r\n            if (Math.random() > probability) return;\r\n\r\n            // 粒子所在世界坐标\r\n            const particleWoldPos = this.transform.localToWorldMatrix.transformPoint3(particle.position);\r\n            // 粒子在子粒子系统的坐标\r\n            const subEmitPos = subEmitter.transform.worldToLocalMatrix.transformPoint3(particleWoldPos);\r\n            if (!particle.subEmitInfo)\r\n            {\r\n                const startDelay = this.main.startDelay.getValue(Math.random());\r\n                particle.subEmitInfo = {\r\n                    preTime: particle.preTime - particle.birthTime - startDelay,\r\n                    currentTime: particle.preTime - particle.birthTime - startDelay,\r\n                    preWorldPos: particleWoldPos.clone(),\r\n                    currentWorldPos: particleWoldPos.clone(),\r\n                    rateAtDuration: 0,\r\n                    _leftRateOverDistance: 0,\r\n                    _isRateOverDistance: false,\r\n                    startDelay,\r\n                    moveVec: new Vector3(),\r\n                    speed: new Vector3(),\r\n                    position: subEmitPos,\r\n                };\r\n            }\r\n            else\r\n            {\r\n                particle.subEmitInfo.preTime = particle.preTime - particle.birthTime - particle.subEmitInfo.startDelay;\r\n                particle.subEmitInfo.currentTime = particle.curTime - particle.birthTime - particle.subEmitInfo.startDelay;\r\n\r\n                particle.subEmitInfo.position.copy(subEmitPos);\r\n            }\r\n\r\n            const subEmits = subEmitter._emit(particle.subEmitInfo);\r\n\r\n            emits = emits.concat(subEmits);\r\n        });\r\n\r\n        emits.sort((a, b) => a.time - b.time);\r\n        emits.forEach((v) =>\r\n        {\r\n            subEmitter._emitParticles(v);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 是否为被上级粒子系统引用的子粒子系统。\r\n     */\r\n    _isSubParticleSystem = false;\r\n\r\n    /**\r\n     * 发射信息\r\n     */\r\n    _emitInfo: ParticleSystemEmitInfo;\r\n}\r\n\r\n/**\r\n * 粒子系统发射器状态信息\r\n */\r\nexport interface ParticleSystemEmitInfo\r\n{\r\n    /**\r\n     * 上次粒子系统时间\r\n     */\r\n    preTime: number;\r\n\r\n    /**\r\n     * 当前粒子系统时间\r\n     */\r\n    currentTime: number;\r\n\r\n    /**\r\n     * 上次世界坐标\r\n     */\r\n    preWorldPos: Vector3;\r\n\r\n    /**\r\n     * 当前世界坐标\r\n     */\r\n    currentWorldPos: Vector3;\r\n\r\n    /**\r\n     * 发射器本地位置\r\n     */\r\n    position: Vector3;\r\n\r\n    /**\r\n     * Start delay in seconds.\r\n     * 启动延迟(以秒为单位)。在调用.play()时初始化值。\r\n     */\r\n    startDelay: number;\r\n\r\n    /**\r\n     * 此次位移\r\n     */\r\n    moveVec: Vector3;\r\n\r\n    /**\r\n     * 当前移动速度\r\n     */\r\n    speed: Vector3;\r\n\r\n    /**\r\n     * 此时在发射周期的位置\r\n     */\r\n    rateAtDuration: number;\r\n\r\n    /**\r\n     * 用于处理移动发射的剩余移动距离。\r\n     */\r\n    _leftRateOverDistance: number;\r\n\r\n    /**\r\n     * 是否已经执行位移发射。\r\n     */\r\n    _isRateOverDistance: boolean;\r\n}\r\n\r\nGeometry.setDefault('Billboard-Geometry', new QuadGeometry());\r\n\r\nGameObject.registerPrimitive('Particle System', (g) =>\r\n{\r\n    g.addComponent(ParticleSystem);\r\n    g.getComponent(Transform).rx = -90;\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n    {\r\n        path: 'Effects/Particle System',\r\n        priority: -1,\r\n        click: () =>\r\n            GameObject.createPrimitive('Particle System')\r\n    }\r\n);\r\n\r\n","import { RegisterComponent, Renderable, Geometry, Material, GameObject, createNodeMenu } from '@feng3d/core';\r\nimport { TerrainData } from './TerrainData';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        Terrain: Terrain\r\n    }\r\n\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        Terrain: GameObject;\r\n    }\r\n}\r\n\r\n/**\r\n * The Terrain component renders the terrain.\r\n */\r\n// @ov({ component: \"OVTerrain\" })\r\n@RegisterComponent()\r\nexport class Terrain extends Renderable\r\n{\r\n    __class__: 'feng3d.Terrain';\r\n\r\n    /**\r\n     * 地形资源\r\n     */\r\n    assign: TerrainData;\r\n\r\n    geometry = Geometry.getDefault('Terrain-Geometry');\r\n\r\n    constructor()\r\n    {\r\n        super();\r\n        this.material = Material.getDefault('Terrain-Material');\r\n    }\r\n}\r\n\r\nGameObject.registerPrimitive('Terrain', (g) =>\r\n{\r\n    g.addComponent(Terrain);\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n    {\r\n        path: '3D Object/Terrain',\r\n        priority: -20000,\r\n        click: () =>\r\n            GameObject.createPrimitive('Terrain')\r\n    }\r\n);\r\n","import { Vector3 } from '@feng3d/math';\r\n\r\n/**\r\n * The TerrainData class stores heightmaps, detail mesh positions, tree instances, and terrain texture alpha maps.\r\n *\r\n * The Terrain component links to the terrain data and renders it.\r\n */\r\nexport class TerrainData\r\n{\r\n    /**\r\n     * Width of the terrain in samples(Read Only).\r\n     */\r\n    get heightmapWidth()\r\n    {\r\n        return this.heightmapResolution;\r\n    }\r\n\r\n    /**\r\n     * Height of the terrain in samples(Read Only).\r\n     */\r\n    get heightmapHeight()\r\n    {\r\n        return this.heightmapResolution;\r\n    }\r\n\r\n    /**\r\n     * Resolution of the heightmap.\r\n     */\r\n    heightmapResolution = 513;\r\n\r\n    /**\r\n     * The size of each heightmap sample.\r\n     */\r\n    get heightmapScale()\r\n    {\r\n        return this.size.divideNumberTo(this.heightmapResolution);\r\n    }\r\n\r\n    /**\r\n     * The total size in world units of the terrain.\r\n     */\r\n    size = new Vector3(500, 600, 500);\r\n\r\n    // /**\r\n    //  * Height of the alpha map.\r\n    //  * 混合贴图高度\r\n    //  * @see https://blog.csdn.net/qq_29523119/article/details/52776731\r\n    //  */\r\n    // alphamapHeight\r\n\r\n    // /**\r\n    //  * Number of alpha map layers.\r\n    //  */\r\n    // alphamapLayers\r\n\r\n    // /**\r\n    //  * Resolution of the alpha map.\r\n    //  */\r\n    // alphamapResolution\r\n\r\n    // /**\r\n    //  * Alpha map textures used by the Terrain. Used by Terrain Inspector for undo.\r\n    //  */\r\n    // alphamapTextures\r\n\r\n    // /**\r\n    //  * Width of the alpha map.\r\n    //  */\r\n    // alphamapWidth\r\n\r\n    // /**\r\n    //  * Resolution of the base map used for rendering far patches on the terrain.\r\n    //  */\r\n    // baseMapResolution\r\n\r\n    // /**\r\n    //  * Detail height of the TerrainData.\r\n    //  */\r\n    // detailHeight\r\n\r\n    // /**\r\n    //  * Contains the detail texture / meshes that the terrain has.\r\n    //  */\r\n    // detailPrototypes\r\n\r\n    // /**\r\n    //  * Detail Resolution of the TerrainData.\r\n    //  */\r\n    // detailResolution\r\n\r\n    // /**\r\n    //  * Detail width of the TerrainData.\r\n    //  */\r\n    // detailWidth\r\n\r\n    // /**\r\n    //  * Splat texture used by the terrain.\r\n    //  */\r\n    // splatPrototypes\r\n\r\n    // /**\r\n    //  * The thickness of the terrain used for collision detection.\r\n    //  */\r\n    // thickness\r\n\r\n    // /**\r\n    //  * Returns the number of tree instances.\r\n    //  */\r\n    // treeInstanceCount\r\n\r\n    // /**\r\n    //  * Contains the current trees placed in the terrain.\r\n    //  */\r\n    // treeInstances\r\n\r\n    // /**\r\n    //  * The list of tree prototypes this are the ones available in the inspector.\r\n    //  */\r\n    // treePrototypes\r\n\r\n    // /**\r\n    //  * Amount of waving grass in the terrain.\r\n    //  */\r\n    // wavingGrassAmount\r\n\r\n    // /**\r\n    //  * Speed of the waving grass.\r\n    //  */\r\n    // wavingGrassSpeed\r\n\r\n    // /**\r\n    //  * Strength of the waving grass in the terrain.\r\n    //  */\r\n    // wavingGrassStrength\r\n\r\n    // /**\r\n    //  * Color of the waving grass that the terrain has.\r\n    //  */\r\n    // wavingGrassTint\r\n}\r\n","import { Geometry, geometryUtils, ImageUtil, Texture2D } from '@feng3d/core';\r\nimport { Color4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { gPartial } from '@feng3d/polyfill';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsGeometryTypes\r\n    {\r\n        TerrainGeometry: TerrainGeometry\r\n    }\r\n\r\n    export interface MixinsDefaultGeometry\r\n    {\r\n        'Terrain-Geometry': TerrainGeometry;\r\n    }\r\n}\r\n\r\n/**\r\n * 地形几何体\r\n */\r\nexport class TerrainGeometry extends Geometry\r\n{\r\n    /**\r\n     * 高度图路径\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('_onHeightMapChanged')\r\n    heightMap = Texture2D.default;\r\n\r\n    /**\r\n     * 地形宽度\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    width = 10;\r\n\r\n    /**\r\n     * 地形高度\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    height = 1;\r\n\r\n    /**\r\n     * 地形深度\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    depth = 10;\r\n\r\n    /**\r\n     * 横向网格段数\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    segmentsW = 30;\r\n\r\n    /**\r\n     * 纵向网格段数\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    segmentsH = 30;\r\n\r\n    /**\r\n     * 最大地形高度\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    maxElevation = 255;\r\n\r\n    /**\r\n     * 最小地形高度\r\n     */\r\n    @serialize\r\n    @oav()\r\n    @watch('invalidateGeometry')\r\n    minElevation = 0;\r\n\r\n    private _heightImageData = defaultHeightMap;\r\n\r\n    /**\r\n     * 创建高度地形 拥有segmentsW*segmentsH个顶点\r\n     */\r\n    constructor(raw?: gPartial<TerrainGeometry>)\r\n    {\r\n        super();\r\n        this.name = 'terrain';\r\n        serialization.setValue(this, raw);\r\n    }\r\n\r\n    private _onHeightMapChanged()\r\n    {\r\n        if (!this.heightMap['_pixels'])\r\n        {\r\n            this._heightImageData = defaultHeightMap;\r\n            this.invalidateGeometry();\r\n\r\n            this.heightMap.once('loadCompleted', () =>\r\n            {\r\n                const img = this.heightMap['_pixels'] as HTMLImageElement;\r\n                this._heightImageData = ImageUtil.fromImage(img).imageData;\r\n                this.invalidateGeometry();\r\n            });\r\n\r\n            return;\r\n        }\r\n        const img = this.heightMap['_pixels'] as HTMLImageElement;\r\n        this._heightImageData = ImageUtil.fromImage(img).imageData;\r\n        this.invalidateGeometry();\r\n    }\r\n\r\n    /**\r\n     * 创建顶点坐标\r\n     */\r\n    protected buildGeometry()\r\n    {\r\n        if (!this._heightImageData)\r\n        { return; }\r\n        let x: number; let\r\n            z: number;\r\n        let numInds = 0;\r\n        let base = 0;\r\n        // 一排顶点数据\r\n        const tw = this.segmentsW + 1;\r\n        // 总顶点数量\r\n        let numVerts = (this.segmentsH + 1) * tw;\r\n        // 一个格子所占高度图X轴像素数\r\n        const uDiv = (this._heightImageData.width - 1) / this.segmentsW;\r\n        // 一个格子所占高度图Y轴像素数\r\n        const vDiv = (this._heightImageData.height - 1) / this.segmentsH;\r\n        let u: number; let\r\n            v: number;\r\n        let y: number;\r\n\r\n        const vertices: number[] = [];\r\n        const indices: number[] = [];\r\n\r\n        numVerts = 0;\r\n        let col: number;\r\n        for (let zi = 0; zi <= this.segmentsH; ++zi)\r\n        {\r\n            for (let xi = 0; xi <= this.segmentsW; ++xi)\r\n            {\r\n                // 顶点坐标\r\n                x = (xi / this.segmentsW - 0.5) * this.width;\r\n                z = (zi / this.segmentsH - 0.5) * this.depth;\r\n                // 格子对应高度图uv坐标\r\n                u = xi * uDiv;\r\n                v = (this.segmentsH - zi) * vDiv;\r\n\r\n                // 获取颜色值\r\n                col = this.getPixel(this._heightImageData, u, v) & 0xff;\r\n                // 计算高度值\r\n                y = (col > this.maxElevation) ? (this.maxElevation / 0xff) * this.height : ((col < this.minElevation) ? (this.minElevation / 0xff) * this.height : (col / 0xff) * this.height);\r\n\r\n                // 保存顶点坐标\r\n                vertices[numVerts++] = x;\r\n                vertices[numVerts++] = y;\r\n                vertices[numVerts++] = z;\r\n\r\n                if (xi !== this.segmentsW && zi !== this.segmentsH)\r\n                {\r\n                    // 增加 一个顶点同时 生成一个格子或两个三角形\r\n                    base = xi + zi * tw;\r\n                    indices[numInds++] = base;\r\n                    indices[numInds++] = base + tw;\r\n                    indices[numInds++] = base + tw + 1;\r\n                    indices[numInds++] = base;\r\n                    indices[numInds++] = base + tw + 1;\r\n                    indices[numInds++] = base + 1;\r\n                }\r\n            }\r\n        }\r\n        const uvs = this.buildUVs();\r\n        this.positions = vertices;\r\n        this.uvs = uvs;\r\n        this.indices = indices;\r\n        this.normals = geometryUtils.createVertexNormals(this.indices, this.positions, true);\r\n        this.tangents = geometryUtils.createVertexTangents(this.indices, this.positions, this.uvs, true);\r\n    }\r\n\r\n    /**\r\n     * 创建uv坐标\r\n     */\r\n    private buildUVs()\r\n    {\r\n        let numUvs = (this.segmentsH + 1) * (this.segmentsW + 1) * 2;\r\n        const uvs: number[] = [];\r\n\r\n        numUvs = 0;\r\n        // 计算每个顶点的uv坐标\r\n        for (let yi = 0; yi <= this.segmentsH; ++yi)\r\n        {\r\n            for (let xi = 0; xi <= this.segmentsW; ++xi)\r\n            {\r\n                uvs[numUvs++] = xi / this.segmentsW;\r\n                uvs[numUvs++] = 1 - yi / this.segmentsH;\r\n            }\r\n        }\r\n\r\n        return uvs;\r\n    }\r\n\r\n    /**\r\n     * 获取位置在（x，z）处的高度y值\r\n     * @param x x坐标\r\n     * @param z z坐标\r\n     * @return 高度\r\n     */\r\n    getHeightAt(x: number, z: number): number\r\n    {\r\n        // 得到高度图中的值\r\n        const u = (x / this.width + 0.5) * (this._heightImageData.width - 1);\r\n        const v = (-z / this.depth + 0.5) * (this._heightImageData.height - 1);\r\n\r\n        const col = this.getPixel(this._heightImageData, u, v) & 0xff;\r\n\r\n        let h: number;\r\n        if (col > this.maxElevation)\r\n        {\r\n            h = (this.maxElevation / 0xff) * this.height;\r\n        }\r\n        else if (col < this.minElevation)\r\n        {\r\n            h = (this.minElevation / 0xff) * this.height;\r\n        }\r\n        else\r\n        {\r\n            h = (col / 0xff) * this.height;\r\n        }\r\n\r\n        return h;\r\n    }\r\n\r\n    /**\r\n     * 获取像素值\r\n     */\r\n    private getPixel(imageData: ImageData, u: number, v: number)\r\n    {\r\n        // 取整\r\n        u = ~~u;\r\n        v = ~~v;\r\n\r\n        const index = (v * imageData.width + u) * 4;\r\n        const data = imageData.data;\r\n        // const red = data[index];// 红色色深\r\n        // const green = data[index + 1];// 绿色色深\r\n        const blue = data[index + 2];// 蓝色色深\r\n        // const alpha = data[index + 3];// 透明度\r\n\r\n        return blue;\r\n    }\r\n}\r\n\r\n/**\r\n * 默认高度图\r\n */\r\nconst defaultHeightMap = new ImageUtil(1024, 1024, new Color4(0, 0, 0, 0)).imageData;\r\n\r\nGeometry.setDefault('Terrain-Geometry', new TerrainGeometry());\r\n","import { Material, StandardUniforms, Texture2D } from '@feng3d/core';\r\nimport { Vector4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { shaderConfig } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsUniformsTypes\r\n    {\r\n        terrain: TerrainUniforms\r\n    }\r\n\r\n    export interface MixinsDefaultMaterial\r\n    {\r\n        'Terrain-Material': Material;\r\n    }\r\n}\r\n\r\nexport class TerrainUniforms extends StandardUniforms\r\n{\r\n    declare __class__: 'feng3d.TerrainUniforms';\r\n\r\n    @serialize\r\n    @oav({ block: 'terrain' })\r\n    s_splatTexture1 = Texture2D.default;\r\n\r\n    @serialize\r\n    @oav({ block: 'terrain' })\r\n    s_splatTexture2 = Texture2D.default;\r\n\r\n    @serialize\r\n    @oav({ block: 'terrain' })\r\n    s_splatTexture3 = Texture2D.default;\r\n\r\n    @serialize\r\n    @oav({ block: 'terrain' })\r\n    s_blendTexture = Texture2D.default;\r\n\r\n    @serialize\r\n    @oav({ block: 'terrain' })\r\n    u_splatRepeats = new Vector4(1, 1, 1, 1);\r\n}\r\n\r\nshaderConfig.shaders['terrain'].cls = TerrainUniforms;\r\n\r\nMaterial.setDefault('Terrain-Material', { shaderName: 'terrain' });\r\n","import { Texture2D } from '@feng3d/core';\r\nimport { EventEmitter } from '@feng3d/event';\r\nimport { Vector2, Vector4 } from '@feng3d/math';\r\nimport { RenderAtomic, TextureMagFilter, TextureMinFilter, TextureWrap } from '@feng3d/renderer';\r\n\r\n/**\r\n * 地形材质\r\n */\r\nexport class TerrainMergeMethod extends EventEmitter\r\n{\r\n    splatMergeTexture = Texture2D.default;\r\n\r\n    blendTexture = Texture2D.default;\r\n\r\n    splatRepeats = new Vector4(1, 1, 1, 1);\r\n\r\n    /**\r\n     * 构建材质\r\n     */\r\n    constructor()\r\n    {\r\n        super();\r\n\r\n        this.splatMergeTexture.minFilter = TextureMinFilter.NEAREST;\r\n        this.splatMergeTexture.magFilter = TextureMagFilter.NEAREST;\r\n        this.splatMergeTexture.wrapS = TextureWrap.REPEAT;\r\n        this.splatMergeTexture.wrapT = TextureWrap.REPEAT;\r\n    }\r\n\r\n    beforeRender(renderAtomic: RenderAtomic)\r\n    {\r\n        renderAtomic.uniforms.s_blendTexture = this.blendTexture;\r\n        renderAtomic.uniforms.s_splatMergeTexture = this.splatMergeTexture;\r\n        renderAtomic.uniforms.u_splatMergeTextureSize = this.splatMergeTexture.getSize();\r\n        renderAtomic.uniforms.u_splatRepeats = this.splatRepeats;\r\n        //\r\n        renderAtomic.uniforms.u_imageSize = new Vector2(2048.0, 1024.0);\r\n        renderAtomic.uniforms.u_tileSize = new Vector2(512.0, 512.0);\r\n        renderAtomic.uniforms.u_maxLod = 7;\r\n        renderAtomic.uniforms.u_uvPositionScale = 0.001;\r\n        renderAtomic.uniforms.u_tileOffset = [\r\n            new Vector4(0.5, 0.5, 0.0, 0.0),\r\n            new Vector4(0.5, 0.5, 0.5, 0.0),\r\n            new Vector4(0.5, 0.5, 0.0, 0.5),\r\n        ];\r\n        renderAtomic.uniforms.u_lod0vec = new Vector4(0.5, 1, 0, 0);\r\n    }\r\n}\r\n","import { AddComponentMenu, Camera, Component, GameObject, HideFlags, RegisterComponent, Scene, TransformLayout } from '@feng3d/core';\r\nimport { IEvent } from '@feng3d/event';\r\nimport { Vector2, Vector4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { RenderAtomic } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watcher } from '@feng3d/watcher';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        Transform2D: Transform2D;\r\n    }\r\n\r\n    export interface MixinsGameObject\r\n    {\r\n        /**\r\n         * 游戏对象上的2D变换。\r\n         */\r\n        transform2D: Transform2D;\r\n    }\r\n\r\n    export interface MixinsComponent\r\n    {\r\n        /**\r\n         * 游戏对象上的2D变换。\r\n         */\r\n        transform2D: Transform2D;\r\n    }\r\n}\r\n\r\n/**\r\n * 2D变换\r\n *\r\n * 提供了比Transform更加适用于2D元素的API\r\n *\r\n * 通过修改Transform的数值实现\r\n */\r\n@AddComponentMenu('Layout/Transform2D')\r\n@RegisterComponent()\r\nexport class Transform2D extends Component\r\n{\r\n    get single() { return true; }\r\n\r\n    transformLayout: TransformLayout;\r\n\r\n    /**\r\n     * 描述了2D对象在未经过变换前的位置与尺寸\r\n     */\r\n    get rect()\r\n    {\r\n        const transformLayout = this.transformLayout;\r\n        this._rect.set(-transformLayout.pivot.x * transformLayout.size.x, -transformLayout.pivot.y * transformLayout.size.y, transformLayout.size.x, transformLayout.size.y);\r\n\r\n        return this._rect;\r\n    }\r\n    private _rect = new Vector4(0, 0, 100, 100);\r\n\r\n    /**\r\n     * 位移\r\n     */\r\n    @oav({ tooltip: '当anchorMin.x == anchorMax.x时对position.x赋值生效，当 anchorMin.y == anchorMax.y 时对position.y赋值生效，否则赋值无效，自动被覆盖。', componentParam: { step: 1, stepScale: 1, stepDownup: 1 } })\r\n    @serialize\r\n    get position() { return this._position; }\r\n    set position(v) { this._position.copy(v); }\r\n    private readonly _position = new Vector2();\r\n\r\n    /**\r\n     * 尺寸，宽高。\r\n     */\r\n    @oav({ tooltip: '宽度，不会影响到缩放值。当 anchorMin.x == anchorMax.x 时对 size.x 赋值生效，当anchorMin.y == anchorMax.y时对 size.y 赋值生效，否则赋值无效，自动被覆盖。', componentParam: { step: 1, stepScale: 1, stepDownup: 1 } })\r\n    @serialize\r\n    get size() { return this._size; }\r\n    set size(v) { this._size.copy(v); }\r\n    private _size = new Vector2(1, 1);\r\n\r\n    /**\r\n     * 与最小最大锚点形成的边框的left、right、top、bottom距离。当 anchorMin.x != anchorMax.x 时对 layout.x layout.y 赋值生效，当 anchorMin.y != anchorMax.y 时对 layout.z layout.w 赋值生效，否则赋值无效，自动被覆盖。\r\n     */\r\n    @oav({ tooltip: '与最小最大锚点形成的边框的left、right、top、bottom距离。当 anchorMin.x != anchorMax.x 时对 layout.x layout.y 赋值生效，当 anchorMin.y != anchorMax.y 时对 layout.z layout.w 赋值生效，否则赋值无效，自动被覆盖。', componentParam: { step: 1, stepScale: 1, stepDownup: 1 } })\r\n    @serialize\r\n    get layout() { return this._layout; }\r\n    set layout(v) { this._layout.copy(v); }\r\n    private _layout = new Vector4();\r\n\r\n    /**\r\n     * 最小锚点，父Transform2D中左上角锚定的规范化位置。\r\n     */\r\n    @oav({ tooltip: '父Transform2D中左上角锚定的规范化位置。', componentParam: { step: 0.01, stepScale: 0.01, stepDownup: 0.01 } })\r\n    @serialize\r\n    get anchorMin() { return this._anchorMin; }\r\n    set anchorMin(v) { this._anchorMin.copy(v); }\r\n    private _anchorMin = new Vector2(0.5, 0.5);\r\n\r\n    /**\r\n     * 最大锚点，父Transform2D中左上角锚定的规范化位置。\r\n     */\r\n    @oav({ tooltip: '最大锚点，父Transform2D中左上角锚定的规范化位置。', componentParam: { step: 0.01, stepScale: 0.01, stepDownup: 0.01 } })\r\n    @serialize\r\n    get anchorMax() { return this._anchorMax; }\r\n    set anchorMax(v) { this._anchorMax.copy(v); }\r\n    private _anchorMax = new Vector2(0.5, 0.5);\r\n\r\n    /**\r\n     * The normalized position in this RectTransform that it rotates around.\r\n     */\r\n    @oav({ tooltip: '中心点' })\r\n    @serialize\r\n    get pivot() { return this._pivot; }\r\n    set pivot(v) { this._pivot.copy(v); }\r\n    private _pivot = new Vector2(0.5, 0.5);\r\n\r\n    /**\r\n     * 旋转\r\n     */\r\n    @oav({ tooltip: '旋转', componentParam: { step: 0.01, stepScale: 30, stepDownup: 50 } })\r\n    get rotation() { return this._rotation; }\r\n    set rotation(v) { this._rotation = v; }\r\n    private _rotation = 0;\r\n\r\n    /**\r\n     * 缩放\r\n     */\r\n    @oav({ tooltip: '缩放', componentParam: { step: 0.01, stepScale: 1, stepDownup: 1 } })\r\n    get scale() { return this._scale; }\r\n    set scale(v) { this._scale.copy(v); }\r\n    private readonly _scale = new Vector2(1, 1);\r\n\r\n    /**\r\n     * 创建一个实体，该类为虚类\r\n     */\r\n    constructor()\r\n    {\r\n        super();\r\n\r\n        watcher.watch(this as Transform2D, 'transformLayout', this._onTransformLayoutChanged, this);\r\n    }\r\n\r\n    init()\r\n    {\r\n        super.init();\r\n\r\n        // 处理依赖组件\r\n        let transformLayout = this.getComponent(TransformLayout);\r\n        if (!transformLayout)\r\n        {\r\n            transformLayout = this.gameObject.addComponent(TransformLayout);\r\n        }\r\n        this.transformLayout = transformLayout;\r\n\r\n        watcher.bind(this.transform.rotation, 'z', this as Transform2D, 'rotation');\r\n        watcher.bind(this.transform.scale, 'x', this.scale, 'x');\r\n        watcher.bind(this.transform.scale, 'y', this.scale, 'y');\r\n\r\n        this.on('addComponent', this._onAddComponent, this);\r\n        this.on('removeComponent', this._onRemovedComponent, this);\r\n    }\r\n\r\n    private _onAddComponent(event: IEvent<{ gameobject: GameObject; component: Component; }>)\r\n    {\r\n        if (event.data.gameobject !== this.gameObject) return;\r\n        const component = event.data.component;\r\n        if (component instanceof TransformLayout)\r\n        {\r\n            component.hideFlags = component.hideFlags | HideFlags.HideInInspector;\r\n            this.transformLayout = component;\r\n        }\r\n    }\r\n\r\n    private _onRemovedComponent(event: IEvent<{ gameobject: GameObject; component: Component; }>)\r\n    {\r\n        if (event.data.gameobject !== this.gameObject) return;\r\n        const component = event.data.component;\r\n        if (component instanceof TransformLayout)\r\n        {\r\n            this.transformLayout = null;\r\n        }\r\n    }\r\n\r\n    private _onTransformLayoutChanged(newValue: TransformLayout, oldValue: TransformLayout, _object: Transform2D, _property: string)\r\n    {\r\n        if (oldValue)\r\n        {\r\n            watcher.unbind(oldValue.position, 'x', this.position, 'x');\r\n            watcher.unbind(oldValue.position, 'y', this.position, 'y');\r\n            watcher.unbind(oldValue.anchorMin, 'x', this.anchorMin, 'x');\r\n            watcher.unbind(oldValue.anchorMin, 'y', this.anchorMin, 'y');\r\n            watcher.unbind(oldValue.anchorMax, 'x', this.anchorMax, 'x');\r\n            watcher.unbind(oldValue.anchorMax, 'y', this.anchorMax, 'y');\r\n            //\r\n            watcher.unbind(oldValue.leftTop, 'x', this.layout, 'x');\r\n            watcher.unbind(oldValue.rightBottom, 'x', this.layout, 'y');\r\n            watcher.unbind(oldValue.leftTop, 'y', this.layout, 'z');\r\n            watcher.unbind(oldValue.rightBottom, 'y', this.layout, 'w');\r\n            //\r\n            watcher.unbind(oldValue.size, 'x', this.size, 'x');\r\n            watcher.unbind(oldValue.size, 'y', this.size, 'y');\r\n            watcher.unbind(oldValue.pivot, 'x', this.pivot, 'x');\r\n            watcher.unbind(oldValue.pivot, 'y', this.pivot, 'y');\r\n        }\r\n        if (newValue)\r\n        {\r\n            watcher.bind(newValue.position, 'x', this.position, 'x');\r\n            watcher.bind(newValue.position, 'y', this.position, 'y');\r\n            watcher.bind(newValue.anchorMin, 'x', this.anchorMin, 'x');\r\n            watcher.bind(newValue.anchorMin, 'y', this.anchorMin, 'y');\r\n            watcher.bind(newValue.anchorMax, 'x', this.anchorMax, 'x');\r\n            watcher.bind(newValue.anchorMax, 'y', this.anchorMax, 'y');\r\n            //\r\n            watcher.bind(newValue.leftTop, 'x', this.layout, 'x');\r\n            watcher.bind(newValue.rightBottom, 'x', this.layout, 'y');\r\n            watcher.bind(newValue.leftTop, 'y', this.layout, 'z');\r\n            watcher.bind(newValue.rightBottom, 'y', this.layout, 'w');\r\n            //\r\n            watcher.bind(newValue.size, 'x', this.size, 'x');\r\n            watcher.bind(newValue.size, 'y', this.size, 'y');\r\n            watcher.bind(newValue.pivot, 'x', this.pivot, 'x');\r\n            watcher.bind(newValue.pivot, 'y', this.pivot, 'y');\r\n        }\r\n    }\r\n\r\n    beforeRender(renderAtomic: RenderAtomic, _scene: Scene, _camera: Camera)\r\n    {\r\n        renderAtomic.uniforms.u_rect = this.rect;\r\n    }\r\n}\r\n\r\nObject.defineProperty(GameObject.prototype, 'transform2D',\r\n    {\r\n        get(this: GameObject) { return this.getComponent(Transform2D); },\r\n    });\r\n\r\nObject.defineProperty(Component.prototype, 'transform2D',\r\n    {\r\n        get() { return this._gameObject && this._gameObject.transform2D; },\r\n    });\r\n","import { AddComponentMenu, Behaviour, createNodeMenu, GameObject, RegisterComponent } from '@feng3d/core';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { Transform2D } from './core/Transform2D';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        Button: Button;\r\n    }\r\n\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        Button: GameObject;\r\n    }\r\n}\r\n\r\n/**\r\n * 按钮状态\r\n */\r\nexport enum ButtonState\r\n{\r\n    /**\r\n     * 弹起状态，默认状态。\r\n     */\r\n    up = 'up',\r\n    /**\r\n     * 鼠标在按钮上状态。\r\n     */\r\n    over = 'over',\r\n    /**\r\n     * 鼠标按下状态。\r\n     */\r\n    down = 'down',\r\n    /**\r\n     * 选中时弹起状态。\r\n     */\r\n    selected_up = 'selected_up',\r\n    /**\r\n     * 选中时鼠标在按钮上状态。\r\n     */\r\n    selected_over = 'selected_over',\r\n    /**\r\n     * 选中时鼠标按下状态。\r\n     */\r\n    selected_down = 'selected_down',\r\n    /**\r\n     * 禁用状态。\r\n     */\r\n    disabled = 'disabled',\r\n}\r\n\r\n/**\r\n * 按钮\r\n */\r\n@AddComponentMenu('UI/Button')\r\n@RegisterComponent()\r\nexport class Button extends Behaviour\r\n{\r\n    /**\r\n     * 按钮所处状态。\r\n     */\r\n    @oav({ block: 'Layout', tooltip: '按钮所处状态。', component: 'OAVEnum', componentParam: { enumClass: ButtonState } })\r\n    @watch('_onStateChanged')\r\n    state = ButtonState.up;\r\n\r\n    /**\r\n     * 所有状态数据，每一个状态数据中记录了子对象的当前数据。\r\n     */\r\n    @serialize\r\n    allStateData = {};\r\n\r\n    private _stateInvalid = true;\r\n\r\n    /**\r\n     * 保存当前状态，例如在编辑器中编辑完按钮某一状态后调用该方法进行保存当前状态数据。\r\n     */\r\n    @oav()\r\n    saveState()\r\n    {\r\n        const stateData = {};\r\n        // 出现相同名称时，只保存第一个数据\r\n        const childMap: { [name: string]: GameObject } = {};\r\n        this.gameObject.children.forEach((child) =>\r\n        {\r\n            if (childMap[child.name]) return;\r\n            childMap[child.name] = child;\r\n        });\r\n        for (const childname in childMap)\r\n        {\r\n            const jsonObj = serialization.serialize(childMap[childname]);\r\n            serialization.deleteClassKey(jsonObj);\r\n            stateData[childname] = jsonObj;\r\n        }\r\n        this.allStateData[this.state] = stateData;\r\n    }\r\n\r\n    private _onStateChanged()\r\n    {\r\n        this._stateInvalid = true;\r\n    }\r\n\r\n    /**\r\n     * 每帧执行\r\n     */\r\n    update(_interval?: number)\r\n    {\r\n        if (this._stateInvalid)\r\n        {\r\n            this._updateState();\r\n            this._stateInvalid = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 更新状态\r\n     */\r\n    private _updateState()\r\n    {\r\n        const statedata = this.allStateData[this.state];\r\n        if (!statedata) return;\r\n        const childMap: { [name: string]: GameObject } = {};\r\n        this.gameObject.children.forEach((child) =>\r\n        {\r\n            if (childMap[child.name]) return;\r\n            childMap[child.name] = child;\r\n        });\r\n        for (const childname in childMap)\r\n        {\r\n            childMap[childname] = serialization.setValue(childMap[childname], statedata[childname]);\r\n        }\r\n    }\r\n}\r\n\r\nGameObject.registerPrimitive('Button', (g) =>\r\n{\r\n    const transform2D = g.addComponent(Transform2D);\r\n\r\n    transform2D.size.x = 160;\r\n    transform2D.size.y = 30;\r\n    g.addComponent(Button);\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n    {\r\n        path: 'UI/Button',\r\n        priority: -2,\r\n        click: () =>\r\n            GameObject.createPrimitive('Button')\r\n    }\r\n);\r\n\r\n","/**\r\n * UIRenderMode for the Canvas.\r\n *\r\n * Canvas的渲染模式\r\n */\r\nexport enum UIRenderMode\r\n{\r\n    /**\r\n     * Render at the end of the Scene using a 2D Canvas.\r\n     *\r\n     * 在场景的最后使用2D画布渲染。\r\n     */\r\n    ScreenSpaceOverlay,\r\n    /**\r\n     * Render using the Camera configured on the Canvas.\r\n     *\r\n     * 使用在画布上配置的摄像机进行渲染。\r\n     */\r\n    ScreenSpaceCamera,\r\n    /**\r\n     * Render using any Camera in the Scene that can render the layer.\r\n     *\r\n     * 使用场景中任何可以渲染图层的相机渲染。\r\n     */\r\n    WorldSpace,\r\n}\r\n","import { Behaviour, GameObject, RegisterComponent, View } from '@feng3d/core';\r\nimport { Matrix4x4, Ray3, Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { UIRenderMode } from '../enums/UIRenderMode';\r\nimport { Transform2D } from './Transform2D';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        Canvas: Canvas\r\n    }\r\n\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        Canvas: GameObject;\r\n    }\r\n}\r\n\r\n/**\r\n * Element that can be used for screen rendering.\r\n *\r\n * 能够被用于屏幕渲染的元素\r\n */\r\n@RegisterComponent()\r\nexport class Canvas extends Behaviour\r\n{\r\n    /**\r\n     * Is the Canvas in World or Overlay mode?\r\n     *\r\n     * 画布是在世界或覆盖模式?\r\n     */\r\n    @serialize\r\n    @oav({ component: 'OAVEnum', tooltip: '画布是在世界或覆盖模式', componentParam: { enumClass: UIRenderMode } })\r\n    renderMode = UIRenderMode.ScreenSpaceOverlay;\r\n\r\n    /**\r\n     * 获取鼠标射线（与鼠标重叠的摄像机射线）\r\n     */\r\n    mouseRay = new Ray3(new Vector3(), new Vector3(0, 0, 1));\r\n\r\n    /**\r\n     * 投影矩阵\r\n     *\r\n     * 渲染前自动更新\r\n     */\r\n    projection = new Matrix4x4();\r\n\r\n    /**\r\n     * 最近距离\r\n     */\r\n    @serialize\r\n    @oav()\r\n    near = -1000;\r\n\r\n    /**\r\n     * 最远距离\r\n     */\r\n    @serialize\r\n    @oav()\r\n    far = 10000;\r\n\r\n    init()\r\n    {\r\n        // this.transform.hideFlags = this.transform.hideFlags | HideFlags.Hide;\r\n        // this.gameObject.hideFlags = this.gameObject.hideFlags | HideFlags.DontTransform;\r\n    }\r\n\r\n    /**\r\n     * 更新布局\r\n     *\r\n     * @param width 画布宽度\r\n     * @param height 画布高度\r\n     */\r\n    layout(width: number, height: number)\r\n    {\r\n        this.transform2D.size.x = width;\r\n        this.transform2D.size.y = height;\r\n\r\n        this.transform2D.pivot.set(0, 0);\r\n\r\n        this.transform.x = 0;\r\n        this.transform.y = 0;\r\n        this.transform.z = 0;\r\n\r\n        this.transform.rx = 0;\r\n        this.transform.ry = 0;\r\n        this.transform.rz = 0;\r\n\r\n        this.transform.sx = 1;\r\n        this.transform.sy = 1;\r\n        this.transform.sz = 1;\r\n\r\n        const near = this.near;\r\n        const far = this.far;\r\n        this.projection.identity().appendTranslation(0, 0, -(far + near) / 2).appendScale(2 / width, -2 / height, 2 / (far - near)).appendTranslation(-1, 1, 0);\r\n    }\r\n\r\n    /**\r\n     * 计算鼠标射线\r\n     *\r\n     * @param view\r\n     */\r\n    calcMouseRay3D(view: View)\r\n    {\r\n        this.mouseRay.origin.set(view.mousePos.x, view.mousePos.y, 0);\r\n    }\r\n}\r\n\r\nGameObject.registerPrimitive('Canvas', (g) =>\r\n{\r\n    g.addComponent(Transform2D);\r\n    g.addComponent(Canvas);\r\n});\r\n","import { AddComponentMenu, Geometry, Material, RegisterComponent, Renderable, TransformLayout, View } from '@feng3d/core';\r\nimport { Ray3, Vector3 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { CullFace, RenderAtomic } from '@feng3d/renderer';\r\nimport { Canvas } from './Canvas';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        CanvasRenderer: CanvasRenderer;\r\n    }\r\n}\r\n\r\n/**\r\n * 可在画布上渲染组件，使得拥有该组件的GameObject可以在画布上渲染。\r\n */\r\n@AddComponentMenu('Rendering/CanvasRenderer')\r\n@RegisterComponent()\r\nexport class CanvasRenderer extends Renderable\r\n{\r\n    readonly renderAtomic = new RenderAtomic();\r\n\r\n    geometry = Geometry.getDefault('Default-UIGeometry');\r\n\r\n    @oav()\r\n    material = Material.getDefault('Default-UIMaterial');\r\n\r\n    /**\r\n     * 与世界空间射线相交\r\n     *\r\n     * @param worldRay 世界空间射线\r\n     *\r\n     * @return 相交信息\r\n     */\r\n    worldRayIntersection(worldRay: Ray3)\r\n    {\r\n        const canvas = this.getComponentsInParent(Canvas)[0];\r\n        if (canvas)\r\n        {\r\n            worldRay = canvas.mouseRay;\r\n        }\r\n\r\n        const localRay = this.transform.rayWorldToLocal(worldRay);\r\n        if (this.transform2D)\r\n        {\r\n            const size = new Vector3(this.transform2D.size.x, this.transform2D.size.y, 1);\r\n            const pivot = new Vector3(this.transform2D.pivot.x, this.transform2D.pivot.y, 0);\r\n            localRay.origin.divide(size).add(pivot);\r\n            localRay.direction.divide(size).normalize();\r\n        }\r\n\r\n        const pickingCollisionVO = this.localRayIntersection(localRay);\r\n        if (pickingCollisionVO)\r\n        {\r\n            pickingCollisionVO.cullFace = CullFace.NONE;\r\n        }\r\n\r\n        return pickingCollisionVO;\r\n    }\r\n\r\n    protected _updateBounds()\r\n    {\r\n        const bounding = this.geometry.bounding.clone();\r\n        const transformLayout = this.getComponent(TransformLayout);\r\n        if (transformLayout)\r\n        {\r\n            bounding.scale(transformLayout.size);\r\n        }\r\n        this._selfLocalBounds = bounding;\r\n    }\r\n\r\n    /**\r\n     * 渲染\r\n     */\r\n    static draw(view: View)\r\n    {\r\n        const gl = view.gl.gl;\r\n        const scene = view.scene;\r\n\r\n        const canvasList = scene.getComponentsInChildren(Canvas).filter((v) => v.isVisibleAndEnabled);\r\n        canvasList.forEach((canvas) =>\r\n        {\r\n            canvas.layout(gl.canvas.width, gl.canvas.height);\r\n\r\n            // 更新鼠标射线\r\n            canvas.calcMouseRay3D(view);\r\n\r\n            const renderables = canvas.getComponentsInChildren(CanvasRenderer).filter((v) => v.isVisibleAndEnabled);\r\n            renderables.forEach((renderable) =>\r\n            {\r\n                // 绘制\r\n                const renderAtomic = renderable.renderAtomic;\r\n\r\n                renderAtomic.uniforms.u_viewProjection = canvas.projection;\r\n\r\n                renderable.beforeRender(renderAtomic, null, null);\r\n\r\n                view.gl.render(renderAtomic);\r\n            });\r\n        });\r\n    }\r\n}\r\n","import { Geometry, geometryUtils } from '@feng3d/core';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsGeometryTypes\r\n    {\r\n        UIGeometry: UIGeometry\r\n    }\r\n\r\n    export interface MixinsDefaultGeometry\r\n    {\r\n        'Default-UIGeometry': UIGeometry;\r\n    }\r\n}\r\n\r\n/**\r\n * UI几何体\r\n */\r\nexport class UIGeometry extends Geometry\r\n{\r\n    __class__: 'UIGeometry';\r\n\r\n    constructor()\r\n    {\r\n        super();\r\n\r\n        this.positions = [0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0];\r\n        this.uvs = [0, 0, 1, 0, 1, 1, 0, 1];\r\n        this.indices = [0, 1, 2, 0, 2, 3];\r\n\r\n        this.normals = geometryUtils.createVertexNormals(this.indices, this.positions, true);\r\n        this.tangents = geometryUtils.createVertexTangents(this.indices, this.positions, this.uvs, true);\r\n    }\r\n}\r\n\r\nGeometry.setDefault('Default-UIGeometry', new UIGeometry());\r\n","import { Material, Texture2D } from '@feng3d/core';\r\nimport { Color4, Vector4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { shaderConfig } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsUniformsTypes\r\n    {\r\n        ui: UIUniforms\r\n    }\r\n\r\n    export interface MixinsUniforms extends UIUniforms\r\n    {\r\n    }\r\n\r\n    export interface MixinsDefaultMaterial\r\n    {\r\n        'Default-UIMaterial': Material;\r\n    }\r\n}\r\n\r\nexport class UIUniforms\r\n{\r\n    __class__: 'UIUniforms';\r\n\r\n    /**\r\n     * UI几何体尺寸，在shader中进行对几何体缩放。\r\n     */\r\n    u_rect = new Vector4(0, 0, 100, 100);\r\n\r\n    /**\r\n     * 颜色\r\n     */\r\n    @serialize\r\n    @oav()\r\n    u_color = new Color4();\r\n\r\n    /**\r\n     * 纹理数据\r\n     */\r\n    @oav()\r\n    @serialize\r\n    s_texture = Texture2D.default;\r\n\r\n    /**\r\n     * 控制图片的显示区域。\r\n     */\r\n    u_uvRect = new Vector4(0, 0, 1, 1);\r\n}\r\n\r\nshaderConfig.shaders['ui'] = {\r\n    vertex: `\r\n    attribute vec2 a_position;\r\n    attribute vec2 a_uv;\r\n    \r\n    uniform vec4 u_uvRect;\r\n    uniform vec4 u_rect;\r\n    uniform mat4 u_modelMatrix;\r\n    uniform mat4 u_viewProjection;\r\n    \r\n    varying vec2 v_uv;\r\n    varying vec2 v_position;\r\n\r\n    void main() \r\n    {\r\n        vec2 position = u_rect.xy + a_position * u_rect.zw;\r\n        gl_Position = u_viewProjection * u_modelMatrix * vec4(position, 0.0, 1.0);\r\n        v_uv = u_uvRect.xy + a_uv * u_uvRect.zw;\r\n        v_position = position.xy;\r\n    }\r\n    `,\r\n    fragment: `\r\n    precision mediump float;\r\n\r\n    uniform sampler2D s_texture;\r\n    varying vec2 v_uv;\r\n    varying vec2 v_position;\r\n    \r\n    uniform vec4 u_color;\r\n    \r\n    void main() \r\n    {\r\n        vec4 color = texture2D(s_texture, v_uv);\r\n        gl_FragColor = color * u_color;\r\n    }\r\n    \r\n    `,\r\n    cls: UIUniforms,\r\n    renderParams: { enableBlend: true, depthtest: false },\r\n};\r\n\r\nMaterial.setDefault('Default-UIMaterial', { shaderName: 'ui' });\r\n","import { AddComponentMenu, Camera, Component, createNodeMenu, GameObject, RegisterComponent, Scene, Texture2D } from '@feng3d/core';\r\nimport { Color4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { RenderAtomic } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { CanvasRenderer } from './core/CanvasRenderer';\r\nimport { Transform2D } from './core/Transform2D';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        Image: Image\r\n    }\r\n\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        Image: GameObject;\r\n    }\r\n}\r\n\r\n/**\r\n * 图片组件\r\n *\r\n * 用于显示图片\r\n */\r\n@AddComponentMenu('UI/Image')\r\n@RegisterComponent()\r\nexport class Image extends Component\r\n{\r\n    /**\r\n     * The source texture of the Image element.\r\n     *\r\n     * 图像元素的源纹理。\r\n     */\r\n    @oav()\r\n    @serialize\r\n    image = Texture2D.default;\r\n\r\n    /**\r\n     * Tinting color for this Image.\r\n     *\r\n     * 为该图像着色。\r\n     */\r\n    @oav()\r\n    @serialize\r\n    color = new Color4();\r\n\r\n    /**\r\n     * 使图片显示实际尺寸\r\n     */\r\n    @oav({ tooltip: '使图片显示实际尺寸', componentParam: { label: 'ReSize' } })\r\n    setNativeSize()\r\n    {\r\n        const imagesize = this.image.getSize();\r\n        this.transform2D.size.x = imagesize.x;\r\n        this.transform2D.size.y = imagesize.y;\r\n    }\r\n\r\n    beforeRender(renderAtomic: RenderAtomic, scene: Scene, camera: Camera)\r\n    {\r\n        super.beforeRender(renderAtomic, scene, camera);\r\n\r\n        renderAtomic.uniforms.s_texture = this.image;\r\n        renderAtomic.uniforms.u_color = this.color;\r\n    }\r\n}\r\n\r\nGameObject.registerPrimitive('Image', (g) =>\r\n{\r\n    const transform2D = g.addComponent(Transform2D);\r\n    g.addComponent(CanvasRenderer);\r\n\r\n    transform2D.size.x = 100;\r\n    transform2D.size.y = 100;\r\n    g.addComponent(Image);\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n    {\r\n        path: 'UI/Image',\r\n        priority: -2,\r\n        click: () =>\r\n            GameObject.createPrimitive('Image')\r\n    }\r\n);\r\n\r\n","import { functionwrap, View } from '@feng3d/core';\r\nimport { CanvasRenderer } from '../core/CanvasRenderer';\r\n\r\nexport { };\r\n\r\nfunctionwrap.extendFunction(View.prototype, 'render', function (_r, _interval)\r\n{\r\n    CanvasRenderer.draw(this);\r\n});\r\n","import { AddComponentMenu, Camera, Component, createNodeMenu, GameObject, RegisterComponent, Scene } from '@feng3d/core';\r\nimport { Color4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { RenderAtomic } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { CanvasRenderer } from './core/CanvasRenderer';\r\nimport { Transform2D } from './core/Transform2D';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        Rect: Rect;\r\n    }\r\n\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        Rect: GameObject;\r\n    }\r\n}\r\n\r\n/**\r\n * 矩形纯色组件\r\n *\r\n * 用于填充UI中背景等颜色。\r\n */\r\n@AddComponentMenu('UI/Rect')\r\n@RegisterComponent()\r\nexport class Rect extends Component\r\n{\r\n    /**\r\n     * 填充颜色。\r\n     */\r\n    @oav()\r\n    @serialize\r\n    color = new Color4();\r\n\r\n    beforeRender(renderAtomic: RenderAtomic, scene: Scene, camera: Camera)\r\n    {\r\n        super.beforeRender(renderAtomic, scene, camera);\r\n\r\n        renderAtomic.uniforms.u_color = this.color;\r\n    }\r\n}\r\n\r\nGameObject.registerPrimitive('Rect', (g) =>\r\n{\r\n    const transform2D = g.addComponent(Transform2D);\r\n    g.addComponent(CanvasRenderer);\r\n\r\n    transform2D.size.x = 100;\r\n    transform2D.size.y = 100;\r\n    g.addComponent(Rect);\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n    {\r\n        path: 'UI/Rect',\r\n        priority: -2,\r\n        click: () =>\r\n            GameObject.createPrimitive('Rect')\r\n    }\r\n);\r\n","import { TextStyle } from './TextStyle';\r\n\r\n/**\r\n * 文本度量\r\n *\r\n * 用于度量指定样式的文本的宽度。\r\n *\r\n * 从pixi.js移植\r\n *\r\n * @see https://github.com/pixijs/pixi.js/blob/dev/packages/text/src/TextMetrics.js\r\n */\r\nexport class TextMetrics\r\n{\r\n    /**\r\n     * 被测量的文本。\r\n     */\r\n    text: string;\r\n\r\n    /**\r\n     * 被测量的样式。\r\n     */\r\n    style: TextStyle;\r\n\r\n    /**\r\n     * 测量出的宽度。\r\n     */\r\n    width: number;\r\n\r\n    /**\r\n     * 测量出的高度。\r\n     */\r\n    height: number;\r\n\r\n    /**\r\n     * 根据样式分割成的多行文本。\r\n     */\r\n    lines: string[];\r\n\r\n    /**\r\n     * An array of the line widths for each line matched to `lines`\r\n     */\r\n    lineWidths: number[];\r\n\r\n    /**\r\n     * The measured line height for this style\r\n     */\r\n    lineHeight: number;\r\n\r\n    /**\r\n     * The maximum line width for all measured lines\r\n     */\r\n    maxLineWidth: number;\r\n\r\n    /**\r\n     * The font properties object from TextMetrics.measureFont\r\n     */\r\n    fontProperties: IFontMetrics;\r\n\r\n    /**\r\n     * Cached canvas element for measuring text\r\n     */\r\n    static _canvas = (() =>\r\n    {\r\n        const c = document.createElement('canvas');\r\n\r\n        c.width = c.height = 10;\r\n\r\nreturn c;\r\n    })();\r\n\r\n    /**\r\n     * Cache for context to use.\r\n     */\r\n    static _context = <CanvasRenderingContext2D>TextMetrics._canvas.getContext('2d');\r\n\r\n    /**\r\n     * Cache of {@see PIXI.TextMetrics.FontMetrics} objects.\r\n     */\r\n    static _fonts: { [key: string]: IFontMetrics } = {};\r\n\r\n    /**\r\n     * String used for calculate font metrics.\r\n     * These characters are all tall to help calculate the height required for text.\r\n     */\r\n    static METRICS_STRING = '|ÉqÅ';\r\n\r\n    /**\r\n     * Baseline symbol for calculate font metrics.\r\n     */\r\n    static BASELINE_SYMBOL = 'M';\r\n\r\n    /**\r\n     * Baseline multiplier for calculate font metrics.\r\n     */\r\n    static BASELINE_MULTIPLIER = 2;\r\n\r\n    /**\r\n     * Cache of new line chars.\r\n     */\r\n    static _newlines = [\r\n        0x000A, // line feed\r\n        0x000D, // carriage return\r\n    ];\r\n\r\n    /**\r\n     * Cache of breaking spaces.\r\n     */\r\n    static _breakingSpaces = [\r\n        0x0009, // character tabulation\r\n        0x0020, // space\r\n        0x2000, // en quad\r\n        0x2001, // em quad\r\n        0x2002, // en space\r\n        0x2003, // em space\r\n        0x2004, // three-per-em space\r\n        0x2005, // four-per-em space\r\n        0x2006, // six-per-em space\r\n        0x2008, // punctuation space\r\n        0x2009, // thin space\r\n        0x200A, // hair space\r\n        0x205F, // medium mathematical space\r\n        0x3000, // ideographic space\r\n    ];\r\n\r\n    /**\r\n     * @param text - the text that was measured\r\n     * @param style - the style that was measured\r\n     * @param width - the measured width of the text\r\n     * @param height - the measured height of the text\r\n     * @param lines - an array of the lines of text broken by new lines and wrapping if specified in style\r\n     * @param lineWidths - an array of the line widths for each line matched to `lines`\r\n     * @param lineHeight - the measured line height for this style\r\n     * @param maxLineWidth - the maximum line width for all measured lines\r\n     * @param fontProperties - the font properties object from TextMetrics.measureFont\r\n     */\r\n    constructor(text: string, style: TextStyle, width: number, height: number, lines: string[], lineWidths: number[], lineHeight: number, maxLineWidth: number, fontProperties: IFontMetrics)\r\n    {\r\n        this.text = text;\r\n        this.style = style;\r\n        this.width = width;\r\n        this.height = height;\r\n        this.lines = lines;\r\n        this.lineWidths = lineWidths;\r\n        this.lineHeight = lineHeight;\r\n        this.maxLineWidth = maxLineWidth;\r\n        this.fontProperties = fontProperties;\r\n    }\r\n\r\n    /**\r\n     * Measures the supplied string of text and returns a Rectangle.\r\n     *\r\n     * @param text - the text to measure.\r\n     * @param style - the text style to use for measuring\r\n     * @param wordWrap - optional override for if word-wrap should be applied to the text.\r\n     * @param canvas - optional specification of the canvas to use for measuring.\r\n     * @return measured width and height of the text.\r\n     */\r\n    static measureText(text: string, style: TextStyle, wordWrap: boolean, canvas = TextMetrics._canvas)\r\n    {\r\n        wordWrap = (wordWrap === undefined || wordWrap === null) ? style.wordWrap : wordWrap;\r\n        const font = style.toFontString();\r\n        const fontProperties = TextMetrics.measureFont(font);\r\n\r\n        // fallback in case UA disallow canvas data extraction\r\n        // (toDataURI, getImageData functions)\r\n        if (fontProperties.fontSize === 0)\r\n        {\r\n            fontProperties.fontSize = style.fontSize;\r\n            fontProperties.ascent = style.fontSize;\r\n        }\r\n\r\n        const context = canvas.getContext('2d');\r\n        if (!context)\r\n        {\r\n            throw `获取 CanvasRenderingContext2D 失败！`;\r\n        }\r\n        context.font = font;\r\n\r\n        const outputText = wordWrap ? TextMetrics.wordWrap(text, style, canvas) : text;\r\n        const lines = outputText.split(/(?:\\r\\n|\\r|\\n)/);\r\n        const lineWidths = new Array(lines.length);\r\n        let maxLineWidth = 0;\r\n\r\n        for (let i = 0; i < lines.length; i++)\r\n        {\r\n            const lineWidth = context.measureText(lines[i]).width + ((lines[i].length - 1) * style.letterSpacing);\r\n\r\n            lineWidths[i] = lineWidth;\r\n            maxLineWidth = Math.max(maxLineWidth, lineWidth);\r\n        }\r\n        let width = maxLineWidth + style.strokeThickness;\r\n\r\n        if (style.dropShadow)\r\n        {\r\n            width += style.dropShadowDistance;\r\n        }\r\n\r\n        const lineHeight = style.lineHeight || fontProperties.fontSize + style.strokeThickness;\r\n        let height = Math.max(lineHeight, fontProperties.fontSize + style.strokeThickness)\r\n            + ((lines.length - 1) * (lineHeight + style.leading));\r\n\r\n        if (style.dropShadow)\r\n        {\r\n            height += style.dropShadowDistance;\r\n        }\r\n\r\n        return new TextMetrics(\r\n            text,\r\n            style,\r\n            width,\r\n            height,\r\n            lines,\r\n            lineWidths,\r\n            lineHeight + style.leading,\r\n            maxLineWidth,\r\n            fontProperties\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Applies newlines to a string to have it optimally fit into the horizontal\r\n     * bounds set by the Text object's wordWrapWidth property.\r\n     *\r\n     * @private\r\n     * @param text - String to apply word wrapping to\r\n     * @param style - the style to use when wrapping\r\n     * @param canvas - optional specification of the canvas to use for measuring.\r\n     * @return New string with new lines applied where required\r\n     */\r\n    static wordWrap(text: string, style: TextStyle, canvas = TextMetrics._canvas)\r\n    {\r\n        const context = canvas.getContext('2d');\r\n        if (!context)\r\n        {\r\n            throw `获取 CanvasRenderingContext2D 失败！`;\r\n        }\r\n\r\n        let width = 0;\r\n        let line = '';\r\n        let lines = '';\r\n\r\n        const cache = {};\r\n        const { letterSpacing, whiteSpace } = style;\r\n\r\n        // How to handle whitespaces\r\n        const collapseSpaces = TextMetrics.collapseSpaces(whiteSpace);\r\n        const collapseNewlines = TextMetrics.collapseNewlines(whiteSpace);\r\n\r\n        // whether or not spaces may be added to the beginning of lines\r\n        let canPrependSpaces = !collapseSpaces;\r\n\r\n        // There is letterSpacing after every char except the last one\r\n        // t_h_i_s_' '_i_s_' '_a_n_' '_e_x_a_m_p_l_e_' '_!\r\n        // so for convenience the above needs to be compared to width + 1 extra letterSpace\r\n        // t_h_i_s_' '_i_s_' '_a_n_' '_e_x_a_m_p_l_e_' '_!_\r\n        // ________________________________________________\r\n        // And then the final space is simply no appended to each line\r\n        const wordWrapWidth = style.wordWrapWidth + letterSpacing;\r\n\r\n        // break text into words, spaces and newline chars\r\n        const tokens = TextMetrics.tokenize(text);\r\n\r\n        for (let i = 0; i < tokens.length; i++)\r\n        {\r\n            // get the word, space or newlineChar\r\n            let token = tokens[i];\r\n\r\n            // if word is a new line\r\n            if (TextMetrics.isNewline(token))\r\n            {\r\n                // keep the new line\r\n                if (!collapseNewlines)\r\n                {\r\n                    lines += TextMetrics.addLine(line);\r\n                    canPrependSpaces = !collapseSpaces;\r\n                    line = '';\r\n                    width = 0;\r\n                    continue;\r\n                }\r\n\r\n                // if we should collapse new lines\r\n                // we simply convert it into a space\r\n                token = ' ';\r\n            }\r\n\r\n            // if we should collapse repeated whitespaces\r\n            if (collapseSpaces)\r\n            {\r\n                // check both this and the last tokens for spaces\r\n                const currIsBreakingSpace = TextMetrics.isBreakingSpace(token);\r\n                const lastIsBreakingSpace = TextMetrics.isBreakingSpace(line[line.length - 1]);\r\n\r\n                if (currIsBreakingSpace && lastIsBreakingSpace)\r\n                {\r\n                    continue;\r\n                }\r\n            }\r\n\r\n            // get word width from cache if possible\r\n            const tokenWidth = TextMetrics.getFromCache(token, letterSpacing, cache, context);\r\n\r\n            // word is longer than desired bounds\r\n            if (tokenWidth > wordWrapWidth)\r\n            {\r\n                // if we are not already at the beginning of a line\r\n                if (line !== '')\r\n                {\r\n                    // start newlines for overflow words\r\n                    lines += TextMetrics.addLine(line);\r\n                    line = '';\r\n                    width = 0;\r\n                }\r\n\r\n                // break large word over multiple lines\r\n                if (TextMetrics.canBreakWords(token, style.breakWords))\r\n                {\r\n                    // break word into characters\r\n                    const characters = TextMetrics.wordWrapSplit(token);\r\n\r\n                    // loop the characters\r\n                    for (let j = 0; j < characters.length; j++)\r\n                    {\r\n                        let char = characters[j];\r\n\r\n                        let k = 1;\r\n                        // we are not at the end of the token\r\n\r\n                        while (characters[j + k])\r\n                        {\r\n                            const nextChar = characters[j + k];\r\n                            const lastChar = char[char.length - 1];\r\n\r\n                            // should not split chars\r\n                            if (!TextMetrics.canBreakChars(lastChar, nextChar, token, j, style.breakWords))\r\n                            {\r\n                                // combine chars & move forward one\r\n                                char += nextChar;\r\n                            }\r\n                            else\r\n                            {\r\n                                break;\r\n                            }\r\n\r\n                            k++;\r\n                        }\r\n\r\n                        j += char.length - 1;\r\n\r\n                        const characterWidth = TextMetrics.getFromCache(char, letterSpacing, cache, context);\r\n\r\n                        if (characterWidth + width > wordWrapWidth)\r\n                        {\r\n                            lines += TextMetrics.addLine(line);\r\n                            canPrependSpaces = false;\r\n                            line = '';\r\n                            width = 0;\r\n                        }\r\n\r\n                        line += char;\r\n                        width += characterWidth;\r\n                    }\r\n                }\r\n\r\n                // run word out of the bounds\r\n                else\r\n                {\r\n                    // if there are words in this line already\r\n                    // finish that line and start a new one\r\n                    if (line.length > 0)\r\n                    {\r\n                        lines += TextMetrics.addLine(line);\r\n                        line = '';\r\n                        width = 0;\r\n                    }\r\n\r\n                    const isLastToken = i === tokens.length - 1;\r\n\r\n                    // give it its own line if it's not the end\r\n                    lines += TextMetrics.addLine(token, !isLastToken);\r\n                    canPrependSpaces = false;\r\n                    line = '';\r\n                    width = 0;\r\n                }\r\n            }\r\n\r\n            // word could fit\r\n            else\r\n            {\r\n                // word won't fit because of existing words\r\n                // start a new line\r\n                if (tokenWidth + width > wordWrapWidth)\r\n                {\r\n                    // if its a space we don't want it\r\n                    canPrependSpaces = false;\r\n\r\n                    // add a new line\r\n                    lines += TextMetrics.addLine(line);\r\n\r\n                    // start a new line\r\n                    line = '';\r\n                    width = 0;\r\n                }\r\n\r\n                // don't add spaces to the beginning of lines\r\n                if (line.length > 0 || !TextMetrics.isBreakingSpace(token) || canPrependSpaces)\r\n                {\r\n                    // add the word to the current line\r\n                    line += token;\r\n\r\n                    // update width counter\r\n                    width += tokenWidth;\r\n                }\r\n            }\r\n        }\r\n\r\n        lines += TextMetrics.addLine(line, false);\r\n\r\n        return lines;\r\n    }\r\n\r\n    /**\r\n     * Convienience function for logging each line added during the wordWrap\r\n     * method\r\n     *\r\n     * @private\r\n     * @param  line        - The line of text to add\r\n     * @param  newLine     - Add new line character to end\r\n     * @return A formatted line\r\n     */\r\n    static addLine(line: string, newLine = true)\r\n    {\r\n        line = TextMetrics.trimRight(line);\r\n\r\n        line = (newLine) ? `${line}\\n` : line;\r\n\r\n        return line;\r\n    }\r\n\r\n    /**\r\n     * Gets & sets the widths of calculated characters in a cache object\r\n     *\r\n     * @private\r\n     * @param key            The key\r\n     * @param letterSpacing  The letter spacing\r\n     * @param cache          The cache\r\n     * @param context        The canvas context\r\n     * @return The from cache.\r\n     */\r\n    static getFromCache(key: string, letterSpacing: number, cache: { [key: string]: number }, context: CanvasRenderingContext2D)\r\n    {\r\n        let width = cache[key];\r\n\r\n        if (width === undefined)\r\n        {\r\n            const spacing = ((key.length) * letterSpacing);\r\n\r\n            width = context.measureText(key).width + spacing;\r\n            cache[key] = width;\r\n        }\r\n\r\n        return width;\r\n    }\r\n\r\n    /**\r\n     * Determines whether we should collapse breaking spaces\r\n     *\r\n     * @private\r\n     * @param whiteSpace  The TextStyle property whiteSpace\r\n     * @return should collapse\r\n     */\r\n    static collapseSpaces(whiteSpace: string)\r\n    {\r\n        return (whiteSpace === 'normal' || whiteSpace === 'pre-line');\r\n    }\r\n\r\n    /**\r\n     * Determines whether we should collapse newLine chars\r\n     *\r\n     * @private\r\n     * @param whiteSpace  The white space\r\n     * @return should collapse\r\n     */\r\n    static collapseNewlines(whiteSpace: string)\r\n    {\r\n        return (whiteSpace === 'normal');\r\n    }\r\n\r\n    /**\r\n     * trims breaking whitespaces from string\r\n     *\r\n     * @private\r\n     * @param text  The text\r\n     * @return trimmed string\r\n     */\r\n    static trimRight(text: string)\r\n    {\r\n        if (typeof text !== 'string')\r\n        {\r\n            return '';\r\n        }\r\n\r\n        for (let i = text.length - 1; i >= 0; i--)\r\n        {\r\n            const char = text[i];\r\n\r\n            if (!TextMetrics.isBreakingSpace(char))\r\n            {\r\n                break;\r\n            }\r\n\r\n            text = text.slice(0, -1);\r\n        }\r\n\r\n        return text;\r\n    }\r\n\r\n    /**\r\n     * Determines if char is a newline.\r\n     *\r\n     * @private\r\n     * @param char  The character\r\n     * @return True if newline, False otherwise.\r\n     */\r\n    static isNewline(char: string)\r\n    {\r\n        if (typeof char !== 'string')\r\n        {\r\n            return false;\r\n        }\r\n\r\n        return (TextMetrics._newlines.indexOf(char.charCodeAt(0)) >= 0);\r\n    }\r\n\r\n    /**\r\n     * Determines if char is a breaking whitespace.\r\n     *\r\n     * @private\r\n     * @param char  The character\r\n     * @return True if whitespace, False otherwise.\r\n     */\r\n    static isBreakingSpace(char: string)\r\n    {\r\n        if (typeof char !== 'string')\r\n        {\r\n            return false;\r\n        }\r\n\r\n        return (TextMetrics._breakingSpaces.indexOf(char.charCodeAt(0)) >= 0);\r\n    }\r\n\r\n    /**\r\n     * Splits a string into words, breaking-spaces and newLine characters\r\n     *\r\n     * @private\r\n     * @param text       The text\r\n     * @return A tokenized array\r\n     */\r\n    static tokenize(text: string)\r\n    {\r\n        const tokens: string[] = [];\r\n        let token = '';\r\n\r\n        if (typeof text !== 'string')\r\n        {\r\n            return tokens;\r\n        }\r\n\r\n        for (let i = 0; i < text.length; i++)\r\n        {\r\n            const char = text[i];\r\n\r\n            if (TextMetrics.isBreakingSpace(char) || TextMetrics.isNewline(char))\r\n            {\r\n                if (token !== '')\r\n                {\r\n                    tokens.push(token);\r\n                    token = '';\r\n                }\r\n\r\n                tokens.push(char);\r\n\r\n                continue;\r\n            }\r\n\r\n            token += char;\r\n        }\r\n\r\n        if (token !== '')\r\n        {\r\n            tokens.push(token);\r\n        }\r\n\r\n        return tokens;\r\n    }\r\n\r\n    /**\r\n     * Overridable helper method used internally by TextMetrics, exposed to allow customizing the class's behavior.\r\n     *\r\n     * It allows one to customise which words should break\r\n     * Examples are if the token is CJK or numbers.\r\n     * It must return a boolean.\r\n     *\r\n     * @param _token       The token\r\n     * @param breakWords  The style attr break words\r\n     * @return whether to break word or not\r\n     */\r\n    static canBreakWords(_token: string, breakWords: boolean)\r\n    {\r\n        return breakWords;\r\n    }\r\n\r\n    /**\r\n     * Overridable helper method used internally by TextMetrics, exposed to allow customizing the class's behavior.\r\n     *\r\n     * It allows one to determine whether a pair of characters\r\n     * should be broken by newlines\r\n     * For example certain characters in CJK langs or numbers.\r\n     * It must return a boolean.\r\n     *\r\n     * @param _char      The character\r\n     * @param _nextChar  The next character\r\n     * @param _token     The token/word the characters are from\r\n     * @param _index     The index in the token of the char\r\n     * @param _breakWords  The style attr break words\r\n     * @return whether to break word or not\r\n     */\r\n    static canBreakChars(_char: string, _nextChar: string, _token: string, _index: number, _breakWords: boolean) // eslint-disable-line no-unused-vars\r\n    {\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Overridable helper method used internally by TextMetrics, exposed to allow customizing the class's behavior.\r\n     *\r\n     * It is called when a token (usually a word) has to be split into separate pieces\r\n     * in order to determine the point to break a word.\r\n     * It must return an array of characters.\r\n     *\r\n     * @example\r\n     * // Correctly splits emojis, eg \"🤪🤪\" will result in two element array, each with one emoji.\r\n     * TextMetrics.wordWrapSplit = (token) => [...token];\r\n     *\r\n     * @param token The token to split\r\n     * @return The characters of the token\r\n     */\r\n    static wordWrapSplit(token: string)\r\n    {\r\n        return token.split('');\r\n    }\r\n\r\n    /**\r\n     * Calculates the ascent, descent and fontSize of a given font-style\r\n     *\r\n     * @param font - String representing the style of the font\r\n     * @return Font properties object\r\n     *\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/textBaseline\r\n     */\r\n    static measureFont(font: string)\r\n    {\r\n        // as this method is used for preparing assets, don't recalculate things if we don't need to\r\n        if (TextMetrics._fonts[font])\r\n        {\r\n            return TextMetrics._fonts[font];\r\n        }\r\n\r\n        const properties: IFontMetrics = <any>{};\r\n\r\n        const canvas = TextMetrics._canvas;\r\n        const context = TextMetrics._context;\r\n\r\n        context.font = font;\r\n\r\n        const metricsString = TextMetrics.METRICS_STRING + TextMetrics.BASELINE_SYMBOL;\r\n        const width = Math.ceil(context.measureText(metricsString).width);\r\n        let baseline = Math.ceil(context.measureText(TextMetrics.BASELINE_SYMBOL).width);\r\n        const height = 3 * baseline;\r\n\r\n        baseline = baseline * TextMetrics.BASELINE_MULTIPLIER | 0;\r\n\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n\r\n        context.fillStyle = '#f00';\r\n        context.fillRect(0, 0, width, height);\r\n\r\n        context.font = font;\r\n\r\n        context.textBaseline = 'alphabetic';\r\n        context.fillStyle = '#000';\r\n        context.fillText(metricsString, 0, baseline);\r\n\r\n        const imagedata = context.getImageData(0, 0, width, height).data;\r\n        const pixels = imagedata.length;\r\n        const line = width * 4;\r\n\r\n        let i = 0;\r\n        let idx = 0;\r\n        let stop = false;\r\n\r\n        // ascent. scan from top to bottom until we find a non red pixel\r\n        for (i = 0; i < baseline; ++i)\r\n        {\r\n            for (let j = 0; j < line; j += 4)\r\n            {\r\n                if (imagedata[idx + j] !== 255)\r\n                {\r\n                    stop = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (!stop)\r\n            {\r\n                idx += line;\r\n            }\r\n            else\r\n            {\r\n                break;\r\n            }\r\n        }\r\n\r\n        properties.ascent = baseline - i;\r\n\r\n        idx = pixels - line;\r\n        stop = false;\r\n\r\n        // descent. scan from bottom to top until we find a non red pixel\r\n        for (i = height; i > baseline; --i)\r\n        {\r\n            for (let j = 0; j < line; j += 4)\r\n            {\r\n                if (imagedata[idx + j] !== 255)\r\n                {\r\n                    stop = true;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (!stop)\r\n            {\r\n                idx -= line;\r\n            }\r\n            else\r\n            {\r\n                break;\r\n            }\r\n        }\r\n\r\n        properties.descent = i - baseline;\r\n        properties.fontSize = properties.ascent + properties.descent;\r\n\r\n        TextMetrics._fonts[font] = properties;\r\n\r\n        return properties;\r\n    }\r\n\r\n    /**\r\n     * Clear font metrics in metrics cache.\r\n     *\r\n     * @param font - font name. If font name not set then clear cache for all fonts.\r\n     */\r\n    static clearMetrics(font = '')\r\n    {\r\n        if (font)\r\n        {\r\n            delete TextMetrics._fonts[font];\r\n        }\r\n        else\r\n        {\r\n            TextMetrics._fonts = {};\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * A number, or a string containing a number.\r\n */\r\ninterface IFontMetrics\r\n{\r\n    /**\r\n     * Font ascent\r\n     */\r\n    ascent: number;\r\n    /**\r\n     * Font descent\r\n     */\r\n    descent: number;\r\n    /**\r\n     * Font size\r\n     */\r\n    fontSize: number;\r\n}\r\n\r\n","import { EventEmitter } from '@feng3d/event';\r\nimport { Color4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { serialization, serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\n\r\n/**\r\n * 文本上渐变方向。\r\n */\r\nexport enum TEXT_GRADIENT\r\n{\r\n    /**\r\n     * 纵向梯度。\r\n     */\r\n    LINEAR_VERTICAL = 0,\r\n    /**\r\n     * 横向梯度。\r\n     */\r\n    LINEAR_HORIZONTAL = 1,\r\n}\r\n\r\n/**\r\n * 通用字体。\r\n */\r\nexport enum FontFamily\r\n{\r\n    'Arial' = 'Arial',\r\n    'serif' = 'serif',\r\n    'sans-serif' = 'sans-serif',\r\n    'monospace' = 'monospace',\r\n    'cursive' = 'cursive',\r\n    'fantasy' = 'fantasy',\r\n    'system-ui' = 'system-ui',\r\n    '宋体' = '宋体',\r\n}\r\n\r\n/**\r\n * 字体样式。\r\n */\r\nexport enum FontStyle\r\n{\r\n    'normal' = 'normal',\r\n    'italic' = 'italic',\r\n    'oblique' = 'oblique',\r\n}\r\n\r\n/**\r\n * 字体变体。\r\n */\r\nexport enum FontVariant\r\n{\r\n    'normal' = 'normal',\r\n    'small-caps' = 'small-caps',\r\n}\r\n\r\nexport enum FontWeight\r\n{\r\n    'normal' = 'normal',\r\n    'bold' = 'bold',\r\n    'bolder' = 'bolder',\r\n    'lighter' = 'lighter',\r\n    // '100' = '100',\r\n    // '200' = '200',\r\n    // '300' = '300',\r\n    // '400' = '400',\r\n    // '500' = '500',\r\n    // '600' = '600',\r\n    // '700' = '700',\r\n    // '800' = '800',\r\n    // '900' = '900',\r\n}\r\n\r\n/**\r\n * 设置创建的角的类型，它可以解决带尖刺的文本问题。\r\n */\r\nexport enum CanvasLineJoin\r\n{\r\n    'round' = 'round',\r\n    'bevel' = 'bevel',\r\n    'miter' = 'miter',\r\n}\r\n\r\n/**\r\n * 画布文本基线\r\n */\r\nexport enum CanvasTextBaseline\r\n{\r\n    'top' = 'top',\r\n    'hanging' = 'hanging',\r\n    'middle' = 'middle',\r\n    'alphabetic' = 'alphabetic',\r\n    'ideographic' = 'ideographic',\r\n    'bottom' = 'bottom',\r\n}\r\n\r\n/**\r\n * 文本对齐方式\r\n */\r\nexport enum TextAlign\r\n{\r\n    'left' = 'left',\r\n    'center' = 'center',\r\n    'right' = 'right',\r\n}\r\n\r\nexport enum WhiteSpaceHandle\r\n{\r\n    'normal' = 'normal',\r\n    'pre' = 'pre',\r\n    'pre-line' = 'pre-line',\r\n}\r\n\r\nexport interface TextStyleEventMap\r\n{\r\n    /**\r\n     * 发生变化\r\n     */\r\n    changed\r\n}\r\n\r\n/**\r\n * 文本样式\r\n *\r\n * 从pixi.js移植\r\n *\r\n * @see https://github.com/pixijs/pixi.js/blob/dev/packages/text/src/TextStyle.js\r\n */\r\nexport class TextStyle<T extends TextStyleEventMap = TextStyleEventMap> extends EventEmitter<T>\r\n{\r\n    /**\r\n     * @param style 样式参数\r\n     */\r\n    constructor(style?: Partial<TextStyle>)\r\n    {\r\n        super();\r\n        serialization.setValue(this, style);\r\n    }\r\n\r\n    /**\r\n     * 字体。\r\n     */\r\n    @oav({ block: 'Font', tooltip: '字体。', component: 'OAVEnum', componentParam: { enumClass: FontFamily } })\r\n    @watch('invalidate')\r\n    @serialize\r\n    fontFamily = FontFamily.Arial;\r\n\r\n    /**\r\n     * 字体尺寸。\r\n     */\r\n    @oav({ block: 'Font', tooltip: '字体尺寸。' })\r\n    @watch('invalidate')\r\n    @serialize\r\n    fontSize = 26;\r\n\r\n    /**\r\n     * 字体样式。\r\n     */\r\n    @oav({ block: 'Font', tooltip: '字体样式。', component: 'OAVEnum', componentParam: { enumClass: FontStyle } })\r\n    @watch('invalidate')\r\n    @serialize\r\n    fontStyle = FontStyle.normal;\r\n\r\n    /**\r\n     * 字体变体。\r\n     */\r\n    @oav({ block: 'Font', tooltip: '字体变体。', component: 'OAVEnum', componentParam: { enumClass: FontVariant } })\r\n    @watch('invalidate')\r\n    @serialize\r\n    fontVariant = FontVariant.normal;\r\n\r\n    /**\r\n     * 字型粗细。\r\n     */\r\n    @oav({ block: 'Font', tooltip: '字型粗细。', component: 'OAVEnum', componentParam: { enumClass: FontWeight } })\r\n    @watch('invalidate')\r\n    @serialize\r\n    fontWeight = FontWeight.normal;\r\n\r\n    /**\r\n     * 用于填充文本的颜色。\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/fillStyle\r\n     */\r\n    @oav({ block: 'Fill', tooltip: '用于填充文本的颜色。' })\r\n    @watch('invalidate')\r\n    @serialize\r\n    fill = new Color4(0, 0, 0, 1);\r\n    // fill = new MinMaxGradient();\r\n\r\n    /**\r\n     * 如果填充是一个创建渐变的颜色数组，这可以改变渐变的方向。\r\n     */\r\n    @oav({ block: 'Fill', tooltip: '如果填充是一个创建渐变的颜色数组，这可以改变渐变的方向。', component: 'OAVEnum', componentParam: { enumClass: TEXT_GRADIENT } })\r\n    @watch('invalidate')\r\n    @serialize\r\n    fillGradientType = TEXT_GRADIENT.LINEAR_VERTICAL;\r\n\r\n    /**\r\n     * 如果填充是一个颜色数组来创建渐变，这个数组可以设置停止点\r\n     */\r\n    @oav({ block: 'Fill' })\r\n    @watch('invalidate')\r\n    @serialize\r\n    fillGradientStops: number[] = [];\r\n\r\n    /**\r\n     * 将用于文本笔划的画布填充样式。\r\n     */\r\n    @oav({ block: 'Stroke', tooltip: '将用于文本笔划的画布填充样式。' })\r\n    @watch('invalidate')\r\n    @serialize\r\n    stroke = new Color4(0, 0, 0, 1);\r\n\r\n    /**\r\n     * 一个表示笔画厚度的数字。\r\n     */\r\n    @oav({ block: 'Stroke', tooltip: '一个表示笔画厚度的数字。' })\r\n    @watch('invalidate')\r\n    @serialize\r\n    strokeThickness = 0;\r\n\r\n    /**\r\n     * lineJoin属性设置创建的角的类型，它可以解决带尖刺的文本问题。\r\n     */\r\n    @oav({ block: 'Stroke', tooltip: 'lineJoin属性设置创建的角的类型，它可以解决带尖刺的文本问题。', component: 'OAVEnum', componentParam: { enumClass: CanvasLineJoin } })\r\n    @watch('invalidate')\r\n    @serialize\r\n    lineJoin = CanvasLineJoin.miter;\r\n\r\n    /**\r\n     * 当使用“miter”lineJoin模式时，miter限制使用。这可以减少或增加呈现文本的尖锐性。\r\n     */\r\n    @oav({ block: 'Stroke', tooltip: '当使用“miter”lineJoin模式时，miter限制使用。这可以减少或增加呈现文本的尖锐性。' })\r\n    @watch('invalidate')\r\n    @serialize\r\n    miterLimit = 10;\r\n\r\n    /**\r\n     * 字母之间的间距，默认为0\r\n     */\r\n    @oav({ block: 'Layout', tooltip: '字母之间的间距，默认为0' })\r\n    @watch('invalidate')\r\n    @serialize\r\n    letterSpacing = 0;\r\n\r\n    /**\r\n     * 呈现文本的基线。\r\n     */\r\n    @oav({ block: 'Layout', tooltip: '呈现文本的基线。', component: 'OAVEnum', componentParam: { enumClass: CanvasTextBaseline } })\r\n    @watch('invalidate')\r\n    @serialize\r\n    textBaseline = CanvasTextBaseline.alphabetic;\r\n\r\n    /**\r\n     * 是否为文本设置一个投影。\r\n     */\r\n    @oav({ block: 'Drop Shadow', tooltip: '是否为文本设置一个投影。' })\r\n    @watch('invalidate')\r\n    @serialize\r\n    dropShadow = false;\r\n\r\n    /**\r\n     * 投影颜色。\r\n     */\r\n    @oav({ block: 'Drop Shadow', tooltip: '投影颜色。' })\r\n    @watch('invalidate')\r\n    @serialize\r\n    dropShadowColor = new Color4(0, 0, 0, 1);\r\n\r\n    /**\r\n     * 投影角度。\r\n     */\r\n    @oav({ block: 'Drop Shadow', tooltip: '投影角度。' })\r\n    @watch('invalidate')\r\n    @serialize\r\n    dropShadowAngle = 30;\r\n\r\n    /**\r\n     * 阴影模糊半径。\r\n     */\r\n    @oav({ block: 'Drop Shadow', tooltip: '阴影模糊半径。' })\r\n    @watch('invalidate')\r\n    @serialize\r\n    dropShadowBlur = 0;\r\n\r\n    /**\r\n     * 投影距离。\r\n     */\r\n    @oav({ block: 'Drop Shadow', tooltip: '投影距离。' })\r\n    @watch('invalidate')\r\n    @serialize\r\n    dropShadowDistance = 5;\r\n\r\n    /**\r\n     * 是否应使用自动换行。\r\n     */\r\n    @oav({ block: 'Multiline', tooltip: '是否应使用自动换行。' })\r\n    @watch('invalidate')\r\n    @serialize\r\n    wordWrap = false;\r\n\r\n    /**\r\n     * 能否把单词分多行。\r\n     */\r\n    @oav({ block: 'Multiline' })\r\n    @watch('invalidate')\r\n    @serialize\r\n    breakWords = false;\r\n\r\n    /**\r\n     * 多行文本对齐方式。\r\n     */\r\n    @oav({ block: 'Multiline', tooltip: '多行文本对齐方式。', component: 'OAVEnum', componentParam: { enumClass: TextAlign } })\r\n    @watch('invalidate')\r\n    @serialize\r\n    align = TextAlign.left;\r\n\r\n    /**\r\n     * 如何处理换行与空格。\r\n     * Default is 'pre' (preserve, preserve).\r\n     *\r\n     *  value       | New lines     |   Spaces\r\n     *  ---         | ---           |   ---\r\n     * 'normal'     | Collapse      |   Collapse\r\n     * 'pre'        | Preserve      |   Preserve\r\n     * 'pre-line'   | Preserve      |   Collapse\r\n     */\r\n    @oav({ block: 'Multiline', tooltip: '如何处理换行与空格。', component: 'OAVEnum', componentParam: { enumClass: WhiteSpaceHandle } })\r\n    @watch('invalidate')\r\n    @serialize\r\n    whiteSpace = WhiteSpaceHandle.pre;\r\n\r\n    /**\r\n     * 文本的换行宽度。\r\n     */\r\n    @oav({ block: 'Multiline', tooltip: '文本的换行宽度。' })\r\n    @watch('invalidate')\r\n    @serialize\r\n    wordWrapWidth = 100;\r\n\r\n    /**\r\n     * 行高。\r\n     */\r\n    @oav({ block: 'Multiline', tooltip: '行高。' })\r\n    @watch('invalidate')\r\n    @serialize\r\n    lineHeight = 0;\r\n\r\n    /**\r\n     * 行距。\r\n     */\r\n    @oav({ block: 'Multiline', tooltip: '行距。' })\r\n    @watch('invalidate')\r\n    @serialize\r\n    leading = 0;\r\n\r\n    /**\r\n     * 内边距，用于文字被裁减问题。\r\n     */\r\n    @oav({ block: 'Texture', tooltip: '内边距，用于文字被裁减问题。' })\r\n    @watch('invalidate')\r\n    @serialize\r\n    padding = 0;\r\n\r\n    /**\r\n     * 是否修剪透明边界。\r\n     */\r\n    @oav({ block: 'Texture', tooltip: '是否修剪透明边界。' })\r\n    @watch('invalidate')\r\n    @serialize\r\n    trim = false;\r\n\r\n    /**\r\n     * 使数据失效\r\n     */\r\n    invalidate()\r\n    {\r\n        this.emit('changed');\r\n    }\r\n\r\n    /**\r\n     *\r\n     * 生成用于' TextMetrics.measureFont() '的字体样式字符串。\r\n     */\r\n    toFontString()\r\n    {\r\n        const fontSizeString = `${this.fontSize}px`;\r\n\r\n        // 通过引用每个字体名来清除fontFamily属性\r\n        // 这将支持带有空格的字体名称\r\n        let fontFamilies: string[] = this.fontFamily as any;\r\n\r\n        if (!Array.isArray(this.fontFamily))\r\n        {\r\n            fontFamilies = this.fontFamily.split(',');\r\n        }\r\n\r\n        for (let i = fontFamilies.length - 1; i >= 0; i--)\r\n        {\r\n            // 修剪任何多余的空白\r\n            let fontFamily = fontFamilies[i].trim();\r\n\r\n            // 检查字体是否已经包含字符串\r\n            if (!(/([\\\"\\'])[^\\'\\\"]+\\1/).test(fontFamily) && FontFamily[fontFamily] === undefined)\r\n            {\r\n                fontFamily = `\"${fontFamily}\"`;\r\n            }\r\n            fontFamilies[i] = fontFamily;\r\n        }\r\n\r\n        return `${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${fontSizeString} ${fontFamilies.join(',')}`;\r\n    }\r\n}\r\n","import { mathUtil } from '@feng3d/polyfill';\r\nimport { TextMetrics } from './TextMetrics';\r\nimport { TextStyle, TEXT_GRADIENT } from './TextStyle';\r\n\r\n/**\r\n * 绘制文本\r\n *\r\n * @param canvas 画布\r\n * @param _text 文本\r\n * @param style 文本样式\r\n * @param resolution 分辨率\r\n */\r\nexport function drawText(canvas: HTMLCanvasElement, _text: string, style: TextStyle, resolution = 1)\r\n{\r\n    canvas = canvas || document.createElement('canvas');\r\n\r\n    if (style.fontSize < 1) style.fontSize = 1;\r\n\r\n    const _font = style.toFontString();\r\n\r\n    const context = canvas.getContext('2d');\r\n    const measured = TextMetrics.measureText(_text || ' ', style, style.wordWrap, canvas);\r\n    const width = measured.width;\r\n    const height = measured.height;\r\n    const lines = measured.lines;\r\n    const lineHeight = measured.lineHeight;\r\n    const lineWidths = measured.lineWidths;\r\n    const maxLineWidth = measured.maxLineWidth;\r\n    const fontProperties = measured.fontProperties;\r\n\r\n    canvas.width = Math.ceil((Math.max(1, width) + (style.padding * 2)) * resolution);\r\n    canvas.height = Math.ceil((Math.max(1, height) + (style.padding * 2)) * resolution);\r\n\r\n    context.scale(resolution, resolution);\r\n\r\n    context.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    context.font = _font;\r\n    context.lineWidth = style.strokeThickness;\r\n    context.textBaseline = style.textBaseline;\r\n    context.lineJoin = style.lineJoin;\r\n    context.miterLimit = style.miterLimit;\r\n\r\n    let linePositionX: number;\r\n    let linePositionY: number;\r\n\r\n    // 需要2个通过如果一个阴影;第一个绘制投影，第二个绘制文本\r\n    const passesCount = style.dropShadow ? 2 : 1;\r\n\r\n    for (let i = 0; i < passesCount; ++i)\r\n    {\r\n        const isShadowPass = style.dropShadow && i === 0;\r\n        const dsOffsetText = isShadowPass ? height * 2 : 0; // 我们只想要投影，所以把文本放到屏幕外\r\n        const dsOffsetShadow = dsOffsetText * resolution;\r\n\r\n        if (isShadowPass)\r\n        {\r\n            // 在Safari上，带有渐变和阴影的文本不能正确定位\r\n            // 如果画布的比例不是1: https://bugs.webkit.org/show_bug.cgi?id=197689\r\n            // 因此，我们将样式设置为纯黑色，同时生成这个投影\r\n            context.fillStyle = 'black';\r\n            context.strokeStyle = 'black';\r\n\r\n            context.shadowColor = style.dropShadowColor.toRGBA();\r\n            context.shadowBlur = style.dropShadowBlur;\r\n            context.shadowOffsetX = Math.cos(style.dropShadowAngle * mathUtil.DEG2RAD) * style.dropShadowDistance;\r\n            context.shadowOffsetY = (Math.sin(style.dropShadowAngle * mathUtil.DEG2RAD) * style.dropShadowDistance) + dsOffsetShadow;\r\n        }\r\n        else\r\n        {\r\n            // 设置画布文本样式\r\n            context.fillStyle = _generateFillStyle(canvas, style, lines, resolution);\r\n            context.strokeStyle = style.stroke.toRGBA();\r\n\r\n            context.shadowColor = '';\r\n            context.shadowBlur = 0;\r\n            context.shadowOffsetX = 0;\r\n            context.shadowOffsetY = 0;\r\n        }\r\n\r\n        // 一行一行绘制\r\n        for (let i = 0; i < lines.length; i++)\r\n        {\r\n            linePositionX = style.strokeThickness / 2;\r\n            linePositionY = ((style.strokeThickness / 2) + (i * lineHeight)) + fontProperties.ascent;\r\n\r\n            if (style.align === 'right')\r\n            {\r\n                linePositionX += maxLineWidth - lineWidths[i];\r\n            }\r\n            else if (style.align === 'center')\r\n            {\r\n                linePositionX += (maxLineWidth - lineWidths[i]) / 2;\r\n            }\r\n\r\n            if (style.stroke && style.strokeThickness)\r\n            {\r\n                drawLetterSpacing(\r\n                    canvas,\r\n                    style,\r\n                    lines[i],\r\n                    linePositionX + style.padding,\r\n                    linePositionY + style.padding - dsOffsetText,\r\n                    true\r\n                );\r\n            }\r\n\r\n            if (style.fill)\r\n            {\r\n                drawLetterSpacing(\r\n                    canvas,\r\n                    style,\r\n                    lines[i],\r\n                    linePositionX + style.padding,\r\n                    linePositionY + style.padding - dsOffsetText\r\n                );\r\n            }\r\n        }\r\n    }\r\n\r\n    // 除去透明边缘。\r\n    if (style.trim)\r\n    {\r\n        const trimmed = trimCanvas(canvas);\r\n\r\n        if (trimmed.data)\r\n        {\r\n            canvas.width = trimmed.width;\r\n            canvas.height = trimmed.height;\r\n            context.putImageData(trimmed.data, 0, 0);\r\n        }\r\n    }\r\n\r\nreturn canvas;\r\n}\r\n\r\n/**\r\n * 生成填充样式。可以自动生成一个基于填充样式为数组的渐变。\r\n *\r\n * @param style 文本样式。\r\n * @param lines 多行文本。\r\n * @return 填充样式。\r\n */\r\nfunction _generateFillStyle(canvas: HTMLCanvasElement, style: TextStyle, lines: string[], resolution = 1)\r\n{\r\n    const context = canvas.getContext('2d');\r\n    const stylefill = style.fill;\r\n    if (!Array.isArray(stylefill))\r\n    {\r\n        return stylefill.toRGBA();\r\n    }\r\n    else if (stylefill.length === 1)\r\n    {\r\n        return stylefill[0];\r\n    }\r\n\r\n    // 画布颜色渐变。\r\n    let gradient: CanvasGradient;\r\n    let totalIterations: number;\r\n    let currentIteration: number;\r\n    let stop: number;\r\n\r\n    const width = Math.ceil(canvas.width / resolution);\r\n    const height = Math.ceil(canvas.height / resolution);\r\n\r\n    const fill: string[] = <any>stylefill.slice();\r\n    const fillGradientStops = style.fillGradientStops.slice();\r\n\r\n    // 初始化渐变关键帧\r\n    if (!fillGradientStops.length)\r\n    {\r\n        const lengthPlus1 = fill.length + 1;\r\n\r\n        for (let i = 1; i < lengthPlus1; ++i)\r\n        {\r\n            fillGradientStops.push(i / lengthPlus1);\r\n        }\r\n    }\r\n\r\n    // 设置渐变起点与终点。\r\n    fill.unshift(stylefill[0]);\r\n    fillGradientStops.unshift(0);\r\n\r\n    fill.push(stylefill[stylefill.length - 1]);\r\n    fillGradientStops.push(1);\r\n\r\n    if (style.fillGradientType === TEXT_GRADIENT.LINEAR_VERTICAL)\r\n    {\r\n        // 创建纵向渐变\r\n        gradient = context.createLinearGradient(width / 2, 0, width / 2, height);\r\n\r\n        // 我们需要重复渐变，这样每一行文本都有相同的垂直渐变效果\r\n        totalIterations = (fill.length + 1) * lines.length;\r\n        currentIteration = 0;\r\n        for (let i = 0; i < lines.length; i++)\r\n        {\r\n            currentIteration += 1;\r\n            for (let j = 0; j < fill.length; j++)\r\n            {\r\n                if (typeof fillGradientStops[j] === 'number')\r\n                {\r\n                    stop = (fillGradientStops[j] / lines.length) + (i / lines.length);\r\n                }\r\n                else\r\n                {\r\n                    stop = currentIteration / totalIterations;\r\n                }\r\n                gradient.addColorStop(stop, fill[j]);\r\n                currentIteration++;\r\n            }\r\n        }\r\n    }\r\n    else\r\n    {\r\n        // 从画布的中间左侧开始渐变，并在画布的中间右侧结束\r\n        gradient = context.createLinearGradient(0, height / 2, width, height / 2);\r\n\r\n        totalIterations = fill.length + 1;\r\n        currentIteration = 1;\r\n\r\n        for (let i = 0; i < fill.length; i++)\r\n        {\r\n            if (typeof fillGradientStops[i] === 'number')\r\n            {\r\n                stop = fillGradientStops[i];\r\n            }\r\n            else\r\n            {\r\n                stop = currentIteration / totalIterations;\r\n            }\r\n            gradient.addColorStop(stop, fill[i]);\r\n            currentIteration++;\r\n        }\r\n    }\r\n\r\n    return gradient;\r\n}\r\n\r\n/**\r\n * Render the text with letter-spacing.\r\n * 绘制文本。\r\n *\r\n * @param text 文本。\r\n * @param x X轴位置。\r\n * @param y Y轴位置。\r\n * @param isStroke\r\n */\r\nfunction drawLetterSpacing(canvas: HTMLCanvasElement, style: TextStyle, text: string, x: number, y: number, isStroke = false)\r\n{\r\n    const context = canvas.getContext('2d');\r\n    const letterSpacing = style.letterSpacing;\r\n\r\n    if (letterSpacing === 0)\r\n    {\r\n        if (isStroke)\r\n        {\r\n            context.strokeText(text, x, y);\r\n        }\r\n        else\r\n        {\r\n            context.fillText(text, x, y);\r\n        }\r\n\r\n        return;\r\n    }\r\n\r\n    let currentPosition = x;\r\n\r\n    // 使用 Array.from 可以解决表情符号的分割问题。 如  \"🌷\",\"🎁\",\"💩\",\"😜\" \"👍\"\r\n    // https://medium.com/@giltayar/iterating-over-emoji-characters-the-es6-way-f06e4589516\r\n    // https://github.com/orling/grapheme-splitter\r\n    const stringArray = Array.from(text);\r\n    let previousWidth = context.measureText(text).width;\r\n    let currentWidth = 0;\r\n\r\n    for (let i = 0; i < stringArray.length; ++i)\r\n    {\r\n        const currentChar = stringArray[i];\r\n\r\n        if (isStroke)\r\n        {\r\n            context.strokeText(currentChar, currentPosition, y);\r\n        }\r\n        else\r\n        {\r\n            context.fillText(currentChar, currentPosition, y);\r\n        }\r\n        currentWidth = context.measureText(text.substring(i + 1)).width;\r\n        currentPosition += previousWidth - currentWidth + letterSpacing;\r\n        previousWidth = currentWidth;\r\n    }\r\n}\r\n\r\n/**\r\n  * 除去边界透明部分\r\n  *\r\n  * @param canvas 画布\r\n  */\r\nfunction trimCanvas(canvas: HTMLCanvasElement)\r\n{\r\n    let width = canvas.width;\r\n    let height = canvas.height;\r\n\r\n    const context = canvas.getContext('2d');\r\n    const imageData = context.getImageData(0, 0, width, height);\r\n    const pixels = imageData.data;\r\n    const len = pixels.length;\r\n\r\n    let top = NaN;\r\n    let left = NaN;\r\n    let right = NaN;\r\n    let bottom = NaN;\r\n\r\n    let data: ImageData = null;\r\n    let i: number;\r\n    let x: number;\r\n    let y: number;\r\n\r\n    for (i = 0; i < len; i += 4)\r\n    {\r\n        if (pixels[i + 3] !== 0)\r\n        {\r\n            x = (i / 4) % width;\r\n            y = ~~((i / 4) / width);\r\n\r\n            if (isNaN(top))\r\n            {\r\n                top = y;\r\n            }\r\n\r\n            if (isNaN(left))\r\n            {\r\n                left = x;\r\n            }\r\n            else if (x < left)\r\n            {\r\n                left = x;\r\n            }\r\n\r\n            if (isNaN(right))\r\n            {\r\n                right = x + 1;\r\n            }\r\n            else if (right < x)\r\n            {\r\n                right = x + 1;\r\n            }\r\n\r\n            if (isNaN(bottom))\r\n            {\r\n                bottom = y;\r\n            }\r\n            else if (bottom < y)\r\n            {\r\n                bottom = y;\r\n            }\r\n        }\r\n    }\r\n\r\n    if (!isNaN(top))\r\n    {\r\n        width = right - left;\r\n        height = bottom - top + 1;\r\n        data = context.getImageData(left, top, width, height);\r\n    }\r\n\r\n    return {\r\n        height,\r\n        width,\r\n        data,\r\n    };\r\n}\r\n","import { AddComponentMenu, Camera, Component, createNodeMenu, GameObject, RegisterComponent, Scene, Texture2D } from '@feng3d/core';\r\nimport { Vector4 } from '@feng3d/math';\r\nimport { oav } from '@feng3d/objectview';\r\nimport { RenderAtomic } from '@feng3d/renderer';\r\nimport { serialize } from '@feng3d/serialization';\r\nimport { watch } from '@feng3d/watcher';\r\nimport { CanvasRenderer } from './core/CanvasRenderer';\r\nimport { Transform2D } from './core/Transform2D';\r\nimport { drawText } from './text/drawText';\r\nimport { TextStyle } from './text/TextStyle';\r\n\r\ndeclare global\r\n{\r\n    export interface MixinsComponentMap\r\n    {\r\n        Text: Text;\r\n    }\r\n\r\n    export interface MixinsPrimitiveGameObject\r\n    {\r\n        Text: GameObject;\r\n    }\r\n}\r\n\r\n/**\r\n * 文本组件\r\n *\r\n * 用于显示文字。\r\n */\r\n@AddComponentMenu('UI/Text')\r\n@RegisterComponent()\r\nexport class Text extends Component\r\n{\r\n    /**\r\n     * 文本内容。\r\n     */\r\n    @oav()\r\n    @serialize\r\n    @watch('invalidate')\r\n    text = 'Hello 🌷 world\\nHello 🌷 world';\r\n\r\n    /**\r\n     * 是否根据文本自动调整宽高。\r\n     */\r\n    @oav({ tooltip: '是否根据文本自动调整宽高。' })\r\n    @serialize\r\n    autoSize = true;\r\n\r\n    @oav()\r\n    @serialize\r\n    @watch('_styleChanged')\r\n    style = new TextStyle();\r\n\r\n    /**\r\n     * 显示图片的区域，(0, 0, 1, 1)表示完整显示图片。\r\n     */\r\n    private _uvRect = new Vector4(0, 0, 1, 1);\r\n\r\n    private _image = new Texture2D();\r\n    private _canvas: HTMLCanvasElement;\r\n    private _invalid = true;\r\n\r\n    beforeRender(renderAtomic: RenderAtomic, scene: Scene, camera: Camera)\r\n    {\r\n        super.beforeRender(renderAtomic, scene, camera);\r\n\r\n        let canvas = this._canvas;\r\n\r\n        if (!this._canvas || this._invalid)\r\n        {\r\n            canvas = this._canvas = drawText(this._canvas, this.text, this.style);\r\n            this._image['_pixels'] = canvas; this._image.wrapS;\r\n            this._image.invalidate();\r\n            this._invalid = false;\r\n        }\r\n\r\n        if (this.autoSize)\r\n        {\r\n            this.transform2D.size.x = canvas.width;\r\n            this.transform2D.size.y = canvas.height;\r\n        }\r\n\r\n        // 调整缩放使得更改尺寸时文字不被缩放。\r\n        this._uvRect.z = this.transform2D.size.x / canvas.width;\r\n        this._uvRect.w = this.transform2D.size.y / canvas.height;\r\n\r\n        //\r\n        renderAtomic.uniforms.s_texture = this._image;\r\n        renderAtomic.uniforms.u_uvRect = this._uvRect;\r\n    }\r\n\r\n    invalidate()\r\n    {\r\n        this._invalid = true;\r\n    }\r\n\r\n    private _styleChanged(property: string, oldValue: TextStyle, newValue: TextStyle)\r\n    {\r\n        if (oldValue) oldValue.off('changed', this.invalidate, this);\r\n        if (newValue) newValue.on('changed', this.invalidate, this);\r\n    }\r\n}\r\n\r\nGameObject.registerPrimitive('Text', (g) =>\r\n{\r\n    const transform2D = g.addComponent(Transform2D);\r\n    g.addComponent(CanvasRenderer);\r\n\r\n    transform2D.size.x = 160;\r\n    transform2D.size.y = 30;\r\n    g.addComponent(Text);\r\n});\r\n\r\n// 在 Hierarchy 界面新增右键菜单项\r\ncreateNodeMenu.push(\r\n    {\r\n        path: 'UI/Text',\r\n        priority: -2,\r\n        click: () =>\r\n            GameObject.createPrimitive('Text')\r\n    }\r\n);\r\n\r\n","export * from '@feng3d/assets';\r\nexport * from '@feng3d/bezier';\r\nexport * from '@feng3d/core';\r\nexport * from '@feng3d/event';\r\nexport * from '@feng3d/filesystem';\r\nexport * from '@feng3d/math';\r\nexport * from '@feng3d/objectview';\r\nexport * from '@feng3d/parsers';\r\nexport * from '@feng3d/particlesystem';\r\nexport * from '@feng3d/polyfill';\r\nexport * from '@feng3d/renderer';\r\nexport * from '@feng3d/serialization';\r\nexport * from '@feng3d/shortcut';\r\nexport * from '@feng3d/task';\r\nexport * from '@feng3d/terrain';\r\nexport * from '@feng3d/ui';\r\nexport * from '@feng3d/watcher';\r\n\r\n/**\r\n * 版本号\r\n */\r\nexport const version = '0.1.3';\r\n"],"names":["ov","param","constructor","Object","getOwnPropertyDescriptor","prototype","objectviewKey","objectview","component","componentParam","oav","target","propertyKey","addOAV","ObjectView","this","defaultBaseObjectViewClass","defaultObjectViewClass","defaultObjectAttributeViewClass","defaultObjectAttributeBlockView","defaultTypeAttributeView","OAVComponent","OBVComponent","OVComponent","setDefaultTypeAttributeView","type","getObjectView","object","p","autocreate","excludeAttrs","assign","classConfig","getObjectInfo","editable","undefined","objectAttributeInfos","filter","v","exclude","objectBlockInfos","forEach","itemList","vv","objectIsEmpty","owner","Cls","console","assert","getAttributeView","attributeViewInfo","defaultViewClass","tempComponent","getBlockView","blockViewInfo","attributeDefinitionVec","attributeDefinition","name","push","resultclassConfig","classConfigVec","protoKey","length","i","mergeClassDefinition","filterReg","attributeNames","key","result","exec","value","Function","sort","element","block","blockDefinitionVec","getDefaultClassConfig","getInheritClassDefinition","getAttributeType","attribute","indexOf","obj","property","data","getPropertyDescriptor","get","set","propertyIsWritable","tempIKey","a","b","priority","_i","getObjectBlockInfos","oldClassDefinition","newClassDefinition","newAttributeDefinition","isfound","oldAttributeDefinition","oldIndex","splice","newBlockDefinition","oldBlockDefinition","blockDefinition","objectBlockInfo","dic","tempVec","blockName","pushDic","Boolean","getPrototypeOf","Array","includes","defineProperty","configurable","enumerable","searchElement","fromIndex","n","writable","ArrayUtils","equal","array","arr","keys","concatToSelf","items","arguments","concat","unique","compare","ids","map","Number","isNaN","deleteMap","ki","j","kj","id","replace","isAdd","isreplace","create","itemFunc","binarySearch","start","end","insert","binarySearchInsert","middle","isUnique","deleteItem","item","index","ObjectUtils","isBaseType","runFunc","func","isObject","getPropertyValue","split","len","getPropertyChains","propertys","hosts","fill","parentPropertyIndices","host","cp","cv","vks","ps","ci","reverse","join","k","assignShallow","source","assignDeep","handlers","deep","MAX_SAFE_INTEGER","concatHandlers","assignDeepDefaultHandlers","equalDeep","akeys","bkeys","isArray","__class__","ClassUtils","classUtilsHandlers","defaultInstMap","getQualifiedClassName","classUtils","hasOwnProperty","className","globalThis","_classNameSpaces","tryClassName","getDefinitionByName","registerClass","warn","readCache","_definitionCache","paths","definition","getDefaultInstanceByName","defaultInst","getInstanceByName","freeze","cls","getInstanceByDefinition","__create__","addClassNameSpace","namespace","DataTransform","blobToArrayBuffer","blob","callback","reader","FileReader","onload","e","readAsArrayBuffer","arrayBufferToBlob","arrayBuffer","Blob","arrayBufferToUint8","Uint8Array","uint8ToArrayBuffer","uint8Array","buffer","arrayToArrayBuffer","uint8ArrayToArray","u8a","canvasToDataURL","canvas","quality","toDataURL","canvasToImage","dataURL","dataURLToImage","blobToDataURL","readAsDataURL","dataURLtoBlob","dataurl","mime","match","bstr","atob","u8arr","charCodeAt","dataURLDrawCanvas","img","dataURLToArrayBuffer","arrayBufferToDataURL","Image","src","imageToDataURL","imageToCanvas","document","createElement","width","height","getContext","drawImage","imageToArrayBuffer","arraybuffer","dataUrl","image","imageDataToDataURL","imageData","imageDataToCanvas","putImageData","imagedataToImage","arrayBufferToImage","_this","blobToText","readAsText","stringToArrayBuffer","str","stringToUint8Array","arrayBufferToString","arrayBufferToObject","JSON","parse","utf8","unescape","encodeURIComponent","uint8ArrayToString","slice","apply","String","fromCharCode","decodeURIComponent","escape","dataTransform","MapUtils","getKeys","_v","getValues","values","_k","MathUtil","DEG2RAD","Math","PI","RAD2DEG","PRECISION","uuid","chars","rnd","r","random","clamp","lowerlimit","upperlimit","uclideanModulo","m","mapLinear","x","a1","a2","b1","b2","lerp","t","smoothstep","min","max","smootherstep","randInt","low","high","floor","randFloat","randFloatSpread","range","degToRad","degrees","radToDeg","radians","isPowerOfTwo","nearestPowerOfTwo","pow","round","log","LN2","nextPowerOfTwo","toRound","precision","equals","abs","gcd","lcm","mathUtil","lazy","getvalue","lazyItem","serialize","serializeKey","propertyHandler","Serialization","omitDefault","serializeHandlers","deserializeHandlers","differentHandlers","setValueHandlers","handler","serialization","root","serializedMap","Map","autoRefID","__root__","rootKey","deleteClassKey","deserialize","refs","refid","serializeIsRawKey","serializeRefKey","ref","different","setValue","clone","getSerializableMembers","serializableMembers","serializePropertys","spv","has","tpv","newtpv","serializeIsRefKey","toString","serializable","arr_1","object_1","object_2","inst","diff","currentRef","arr_2","obj_1","newParam_1","newParam","_handlers","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint16Array","Uint32Array","Uint8ClampedArray","from","watch","onChange","oldValue","Watcher","_binds","thisObject","__watchs__","_property","watchs","oldPropertyDescriptor","orgSet_1","call","notifyListener","propertywatchs","reduce","unwatch","bind","object0","property0","object1","property1","fun0","fun1","unbind","binds","watchchain","notIndex","__watchchains__","watchchains","currentp","substr","nextp_1","watchchainFun","newValue","unwatchchain","getObjectPropertyValue","nv","nextp","watchobject","getObjectPropertyChains","unwatchobject","watcher","EventEmitter","targetEmitterMap","emitterTargetMap","getEventEmitter","getOrCreateEventEmitter","eventEmitter","eventNames","emitterListenerMap","listenerCount","_b","_a","once","listener","on","emitEvent","event","currentTarget","targets","handleEvent","handelEventShare","handelEventBubbles","handelEventBroadcast","emit","bubbles","broadcast","share","isStopShare","isStopBubbles","isStopBroadcast","isStopTransmit","isStop","handles","objectListener","__anyEventType__","listeners","off","delete","offAll","onAny","offAny","eventTarget","callListeners","getShareTargets","bubbleTargets","getBubbleTargets","broadcastTargets","getBroadcastTargets","AnyEmitter","anyEmitter","globalEmitter","objectEmitter","EquationSolving","getSign","equalNumber","getDerivative","f","delta","isContinuous","_f","hasSolution","errorcallback","Error","fa","fb","binary","fr","line","tangent","f1","f2","f1Sign","f1a","f1b","f2Sign","f2a","f2b","fx","f1x","f2x","secant","xn$1","xn1","fxn1","xn","fxn","f1xn","f2xn","equationSolving","Bezier","linear","p0","p1","linearDerivative","linearSecondDerivative","_t","_p0","_p1","quadratic","p2","quadraticDerivative","quadraticSecondDerivative","cubic","p3","cubicDerivative","cubicSecondDerivative","bn","processs","bnDerivative","bnSecondDerivative","bnND","dn","factorial","getValue","getSecondDerivative","getExtremums","numSamples","samples","resultTs","resultVs","guessT","ts","vs","getMonotoneIntervals","monotoneIntervalTs","monotoneIntervalVs","extremums","getTFromValue","targetV","monotoneIntervals","results","bezier","fps","sps","unshift","pop","merge","mergeType","pps","shift","nfp","nsp","ps0","n_1","ps1","n_2","n_3","getSamples","num","HighFunction","as","square","y","nx","ny","innerWeight","outerWeight","clockwise","verts","exx","eyy","eix","eiy","eox","eoy","cx","cy","sx","sy","ex","ey","cx2p0x","cy2p0y","angle0","atan2","angle1","startAngle","angleDiff","absAngleDiff","radius","sqrt","segCount","angleInc","angle","sin","cos","Time","time","timeSinceLevelLoad","fixedTime","unscaledTime","fixedUnscaledTime","realtimeSinceStartup","captureDeltaTime","Mathf","Sin","Cos","Tan","tan","Asin","asin","Acos","acos","Atan","atan","Atan2","Sqrt","Abs","Min","args","Max","Pow","Exp","power","exp","Log","Log10","log10","Ceil","ceil","Floor","Round","CeilToInt","FloorToInt","RoundToInt","Sign","Clamp","Clamp01","Lerp","LerpUnclamped","LerpAngle","Repeat","MoveTowards","current","maxDelta","MoveTowardsAngle","deltaAngle","DeltaAngle","SmoothStep","to","Gamma","absmax","gamma","negative","absval","Approximately","Epsilon","SmoothDamp","currentVelocity","smoothTime","maxSpeed","deltaTime","SmoothDamp2","SmoothDamp1","Infinity","omega","change","originalTo","maxChange","temp","output","SmoothDampAngle","SmoothDampAngle2","SmoothDampAngle1","PingPong","InverseLerp","LineIntersection","p4","bx","by","dx","dy","bDotDPerp","LineSegmentIntersection","u","RoundToMultipleOf","roundingValue","GetClosestPowerOfTen","positiveNumber","GetNumberOfDecimalsForMinimumDifference","minDifference","kMaxDecimals","GetNumberOfDecimalsForMinimumDifference1","NegativeInfinity","Deg2Rad","Rad2Deg","Vector2","normalize","other","kEpsilon","maxDistanceDelta","toVectorX","toVectorY","sqDist","dist","Scale","Reflect","inDirection","inNormal","factor","Dot","Perpendicular","lhs","rhs","Angle","denominator","sqrMagnitude","kEpsilonNormalSqrt","dot","SignedAngle","Distance","distance","ClampMagnitude","vector","maxLength","mag","changeX","changeY","tempX","tempY","outputX","outputY","origMinusCurrentX","origMinusCurrentY","polar","add","addTo","vout","sub","subTo","multiply","multiplyTo","divide","divideTo","copy","distanceSquared","negate","reciprocal","reciprocalTo","out","scaleNumber","s","scaleNumberTo","scale","scaleTo","offset","alpha","lerpTo","lerpNumber","lerpNumberTo","clampTo","toArray","zero","one","up","down","left","right","positiveInfinity","negativeInfinity","__decorate","Vector3","z","fromArray","size","double","subNumber","fromVector2","lengthSquared","setZero","toVector2","dz","thickness","invLength","addScaledVector","scalar","addScaledVectorTo","cross","crossTo","isZero","tangents","t1","t2","norm","inorm","randVec","almostZero","isAntiparallelTo","negateTo","addNumber","addNumberTo","subNumberTo","multiplyNumber","multiplyNumberTo","divideNumber","divideNumberTo","inverse","inverseTo","unit","ninv","less","lessequal","greater","greaterequal","reflect","normal","roundToZero","isParallel","crossmat","outMatrix","applyQuaternion","q","qx","qy","qz","qw","w","ix","iy","iz","iw","applyMatrix4x4","mat","transformPoint3","toVector4","vector4","toVectorZ","sqdist","outputZ","changeZ","sqrmag","tempZ","origMinusCurrentZ","Cross","Normalize","Magnitude","Project","onNormal","sqrMag","ProjectOnPlane","planeNormal","axis","unsignedAngle","crossX","crossY","crossZ","diffX","diffY","diffZ","SqrMagnitude","X_AXIS","Y_AXIS","Z_AXIS","ZERO","ONE","forward","back","Color3","g","fromUnit","color","fromColor4","color4","setTo","toInt","toHexString","intR","intG","intB","ToHex","mix","rate","mixTo","toVector3","vector3","toUpperCase","WHITE","BLACK","ColorKeywords","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","Vector4","fromVector3","v3","div","divTo","transformVector4","toVectorW","Equals","toColor4","Color4","WrapMode","fromUnit24","fromColor3","color3","intA","toRGBA","c","toColor3","randomAlpha","BezierCurve","bezierCurve","error","exports","MinMaxCurveMode","AnimationCurve","maxtan","preWrapMode","postWrapMode","inTangent","outTangent","addKey","deleteKey","getKey","indexOfKeys","getPoint","wrapMode","cycle","dcycle","Loop","isfind","prekey","xstart","ystart","tanstart","xend","yend","tanend","ct","sys","point","findKey","addKeyAtCurve","AnimationCurveVector3","xCurve","yCurve","zCurve","CoordinateSystem","PlaneClassification","RotationOrder","MinMaxCurve","mode","Constant","constant","constantMin","constantMax","curve","curveMin","curveMax","curveMultiplier","between0And1","randomBetween","Curve","TwoConstants","TwoCurves","MinMaxCurveVector3","DefaultCoordinateSystem","LEFT_HANDED","DefaultRotationOrder","YXZ","Line3","origin","direction","fromPoints","fromPosAndDir","position","getPointWithZ","distanceWithPoint","closestPointWithPoint","closestPointParameterWithPoint","onWithPoint","intersectWithLine3D","line3D","getPlane","intersectWithLine3","applyMatri4x4","transformVector3","Plane","d","fromNormalAndPoint","getOrigin","projectPoint","randomPoint","getNormal","classifyPoint","INTERSECT","BACK","FRONT","parallelWithLine3D","parallelWithPlane3D","plane3D","intersectWithPlane3D","a0","b0","c0","d0","c1","d1","invLen","intersectWithTwoPlane3D","plane0","plane1","n1","n2","n3","d2","d3","n1xn2","n2xn3","n3xn1","plane","Segment3","getLength","getLengthSquared","getLine","pout","getPointDistance","projectOnWithPoint","getPositionByPoint","toFixed","vec","getNormalWithPoint","l1","getPointDistanceSquare","s0","s1","intersectionWithLine","intersectionWithSegment","segment","clampPoint","Triangle3","fromPositions","positions","getPoints","getSegments","getPlane3d","getBarycenter","getCircumcenter","getInnercenter","getOrthocenter","crossSegment","bp","getBarycentricCoordinates","u1","u2","u3","u4","v1","v2","v4","p0x","p0y","p0z","p1x","p1y","p1z","p2x","p2y","p2z","d1x","d1y","d1z","d2x","d2y","d2z","nz","oneOverDenom","blendWithPoint","area","n0","area0","area1","area2","distanceSquaredWithPoint","decomposeWithPoint","decomposeWithPoints","v0","decomposeWithSegment","decomposeWithLine","rasterize","aabb","translateVector3","scaleVector3","rasterizeCustom","voxelSize","xi","yi","zi","xv","yv","zv","triangle","containsPoint","Box3","formPositions","getCenter","getSize","isEmpty","init","toPoints","points","minX","minY","minZ","maxX","maxY","maxZ","l","empty","expandByPoint","applyMatrix","applyMatrixTo","contains","translate","inflate","inflatePoint","intersection","intersectionTo","intersects","rayIntersection","outTargetNormal","MAX_VALUE","halfExtentsX","halfExtentsY","halfExtentsZ","centerX","centerY","centerZ","px","py","pz","vx","vy","vz","rayEntryDistance","closestPointToPoint","offsetPosition","union","intersectsSphere","sphere","closestPoint","center","intersectsPlane","intersectsTriangle","extents","f0","axes","satForAxes","triangleNormal","overlaps","box3","l2","overlapsX","overlapsY","overlapsZ","toTriangles","triangles","testAxis","Matrix3x3","elements","identity","setTrace","vec3","getTrace","vmult","smult","mmult","sum","solve","eqns","nr","np","multiplier","getElement","row","column","setElement","i_1","reverseTo","setRotationFromQuaternion","x2","y2","z2","xx","xy","xz","yy","yz","zz","wx","wy","wz","transpose","Mt","M","transposeTo","formMatrix4x4","matrix4x4","arr4","arr3","toMatrix4x4","outMatrix4x4","outdata","indata","Quaternion","fromEuler","mult","ax","ay","az","aw","bz","bw","multTo","multiplyVector","fromAxisAngle","sinA","cosA","toAxisAngle","targetAxis","fromUnitVectors","slerp","qb","cosHalfTheta","sqrSinHalfTheta","EPSILON","sinHalfTheta","halfTheta","ratioA","ratioB","slerpTo","qa","w1","x1","y1","z1","w2","toEulerAngles","asinvalue","val","normalizeFast","fromMatrix","matrix","toTRS","rotatePoint","integrate","angularVelocity","dt","angularFactor","halfDt","integrateTo","toEuler","order","heading","attitude","bank","test","sqx","sqy","sqz","cosX","coxY","cosZ","sinX","sinY","sinZ","XYZ","ZXY","ZYX","YZX","XZY","Ray3","_super","__extends","toMatrix","Matrix4x4","xy2","xz2","xw2","yz2","yw2","zw2","ww","GradientMode","rawData","fromTRS","rotation","fromAxisRotate","fromRotation","rx","ry","rz","fromQuaternion","fromScale","sz","fromPosition","getPosition","setPosition","getRotation","setRotation","getScale","setScale","oldS","te","getAxisX","setAxisX","getAxisY","setAxisY","getAxisZ","sinq","cosq","lcosq","append","m111","m121","m131","m141","m112","m122","m132","m142","m113","m123","m133","m143","m114","m124","m134","m144","m211","m221","m231","m241","m212","m222","m232","m242","m213","m223","m233","m243","m214","m224","m234","m244","NaN","appendRotation","pivotPoint","rotationMat","appendTranslation","appendScale","scaleMat","cosY","ae","af","be","bf","ce","cf","de","df","ac","ad","bc","bd","m11","m12","m13","m21","m22","m23","m31","m32","m33","invert","determinant","m41","m42","m43","m14","m24","m34","m44","prepend","prependRotation","_pivotPoint","prependScale","xScale","yScale","zScale","prependScale1","prependTranslation","translationMat","moveRight","moveUp","moveForward","vin","m0","m1","m2","m4","m5","m6","m8","m9","m10","m3","m7","m15","transformPoints","transformRotation","rotationMatrix","newrotation","transformRay","inRay","outRay","tmp","r2","lookAt","upAxis","xAxis","yAxis","zAxis","getMaxScaleOnAxis","scaleXSq","scaleYSq","scaleZSq","setOrtho","top","bottom","near","far","setPerspectiveFromFOV","fov","aspect","tanfov2","setPerspective","toMatrix3x3","GetColumn","m00","m20","m30","m01","m02","m03","GetRow","SetColumn","SetRow","MultiplyPoint","res","MultiplyPoint3x4","MultiplyVector","TransformPlane","Translate","Rotate","elements0","elements1","Euler","fromRotationMatrix","reorder","newOrder","quaternion","euler","Frustum","p5","planes","frustum","me","me0","me1","me2","me3","me4","me5","me6","me7","me8","me9","me10","me11","me12","me13","me14","me15","negRadius","intersectsBox","box","Rectangle","copyFrom","sourceRect","toIntersect","setEmpty","containsRect","rect","r1","toCompare","offsetPoint","toUnion","topLeft","bottomRight","Sphere","targetNormal","det","maxRadiusSq","distanceToPoint","radiusSum","deltaLengthSq","getBoundingBox","applyMatrix4","TriangleGeometry","fromBox","isClosed","ss","every","getBox","onface","cpv","classifySegment","segments","pc","classifyTriangle","_triangle","line3d","decomposeTriangle","triangleGeometry","MinMaxGradientMode","Gradient","Blend","alphaKeys","colorKeys","fromColors","colors","times","colors1","getAlpha","getColor","nt","Fixed","MinMaxGradient","Color","colorMin","colorMax","gradient","gradientMin","gradientMax","TwoColors","TwoGradients","RandomColor","Noise","seed","_seed","_p","perlin1","perm","X","gi00","gi10","dot1","grad1","fade","perlin2","Y","gi01","gi11","n00","dot2","grad2","n10","n01","n11","nx0","nx1","perlin3","Z","gi000","gi100","gi010","gi110","gi001","gi101","gi011","gi111","n000","grad3","n100","n010","n110","n001","n101","n011","n111","nx00","nx01","nx10","nx11","nxy0","nxy1","perlinN","pp","PS","PF","P","gradN","createGrad","numEdge","bits","getBits","dns","bit","bitn","gi","grad","permutation","createGradCache","gradBase","createGradBase","getBitsChace","noise","arcLengthDivisions","needsUpdate","getResolution","divisions","_optionalTarget","getPointAt","optionalTarget","getUtoTmapping","getSpacedPoints","lengths","getLengths","cacheArcLengths","cache","last","updateArcLengths","targetArcLength","arcLengths","il","comparison","lengthBefore","getTangent","pt1","pt2","getTangentAt","computeFrenetFrames","closed","normals","binormals","tx","ty","tz","theta","LineCurve2","_divisions","CurvePath","curves","autoClose","closePath","startPoint","endPoint","curveLengths","getCurveLengths","segmentLength","lens","cacheLengths","sums","resolution","pts","Earcut","triangulate","holeIndices","dim","invSize","hasHoles","outerLen","outerNode","linkedList","next","prev","list","queue","steiner","getLeftmost","compareX","eliminateHole","filterPoints","eliminateHoles","earcutLinked","signedArea","insertNode","removeNode","again","ear","pass","zOrder","prevZ","nextZ","tail","numMerges","pSize","qSize","inSize","sortLinked","indexCurve","stop","isEarHashed","isEar","cureLocalIntersections","splitEarcut","pointInTriangle","minTX","minTY","maxTX","maxTY","locallyInside","isValidDiagonal","splitPolygon","hole","hx","hy","mx","my","tanMin","sectorContainsSector","findHoleBridge","leftmost","intersectsPolygon","inside","middleInside","q1","q2","o1","sign","o2","o3","o4","onSegment","Node","an","ShapeUtils","contour","isClockWise","triangulateShape","holes","vertices","faces","removeDupEndPts","addContour","holeIndex","Interpolations","CatmullRom","QuadraticBezier","QuadraticBezierP0","QuadraticBezierP1","QuadraticBezierP2","CubicBezier","CubicBezierP0","CubicBezierP1","CubicBezierP2","CubicBezierP3","CubicBezierCurve2","EllipseCurve2","aX","aY","xRadius","yRadius","aStartAngle","aEndAngle","aClockwise","aRotation","twoPi","samePoints","QuadraticBezierCurve2","SplineCurve2","intPoint","weight","Path2","currentPoint","moveTo","lineTo","quadraticCurveTo","aCPx","aCPy","bezierCurveTo","aCP1x","aCP1y","aCP2x","aCP2y","splineThru","npts","arc","aRadius","x0","y0","absarc","absellipse","ellipse","firstPoint","lastPoint","Shape2","getPointsHoles","holesPts","extractPoints","shape","extractArray","pv","pv1","cv1","geometry","indices","holeArray","vertPos","ShapePath2","subPaths","currentPath","toShapes","isCCW","noHoles","toShapesNoHoles","inSubpaths","shapes","tmpPath_1","tmpShape_1","isPointInsidePolygon","inPt","inPolygon","polyLen","edgeLowPt","edgeHighPt","edgeDx","edgeDy","perpEdge","solid","tmpPath","tmpShape","holesFirst","tmpPoints","tmpHoles","betterShapeHoles","newShapes","newShapeHoles","mainIdx","h","ambiguous","toChange","sIdx","sLen","sho","hIdx","ho","holeUnassigned","s2Idx","froms","tos","jl","Font","charGeometryCache","generateShapes","text","lineHeight","align","unitsPerEm","offsetX","offsetY","lines","lineWidths","maxLineWidth","ni","lineStr","nj","char","glyph","glyphs","ha","ret","createPath","path","createPaths","pl","pathShapes","generateCharGeometry","calculateGeometry","fontSize","textBaseline","tabCharWidth","textInfo","font","numVertices","numIndices","lineItem","charVertices","charItem","offsetVertices","offsetIndices","calculateTextInfo","ascender","descender","baselineOffsetY","lineWidth","alignOffsetX","charOffsetX","updateCharGeometry","targetVertices","targetIndices","sourceVertices","sourceIndices","offsetVertices3","offsetVertices2","offsetVerticesIndex","calculateTextStyle","uvs","verticesIndex","normalsIndex","uvsIndex","calculateNormalUV","cpx","cpy","cpx1","cpy1","cpx2","cpy2","o","outline","_cachedOutline","action","trim","familyName","AttributeUsage","GLArrayType","ArcCurve2","CatmullRomCurve3","curveType","tension","isCatmullRomCurve3","dt0","dt1","dt2","initNonuniformCatmullRom","initCatmullRom","calc","CubicPoly","c2","c3","t0","x3","t3","CubicBezierCurve3","LineCurve3","QuadraticBezierCurve3","BlendEquation","BlendFactor","ColorMask","CullFace","DepthFunc","FrontFace","RenderMode","StencilFunc","StencilOp","Texture","active","gl","texture","getTexture","textureType","bindTexture","texParameteri","TEXTURE_MIN_FILTER","minFilter","TEXTURE_MAG_FILTER","magFilter","TEXTURE_WRAP_S","wrapS","TEXTURE_WRAP_T","wrapT","texParameterfAnisotropy","anisotropy","invalid","clear","textures","createTexture","format","pixelStorei","UNPACK_FLIP_Y_WEBGL","flipY","UNPACK_PREMULTIPLY_ALPHA_WEBGL","premulAlpha","TEXTURE_CUBE_MAP","pixels","activePixels","TEXTURE_CUBE_MAP_POSITIVE_X","TEXTURE_CUBE_MAP_POSITIVE_Y","TEXTURE_CUBE_MAP_POSITIVE_Z","TEXTURE_CUBE_MAP_NEGATIVE_X","TEXTURE_CUBE_MAP_NEGATIVE_Y","TEXTURE_CUBE_MAP_NEGATIVE_Z","isRenderTarget","texImage2D","OFFSCREEN_WIDTH","OFFSCREEN_HEIGHT","TEXTURE_2D","_pixel","generateMipmap","WebGLRenderer","glList","tex","deleteTexture","GLCache","compileShaderResults","attributes","renderBuffers","frameBuffers","_gl","GLCapabilities","capabilities","isWebGL2","gl2","WebGL2RenderingContext","extensions","EXT_texture_filter_anisotropic","maxAnisotropy","getParameter","MAX_TEXTURE_MAX_ANISOTROPY_EXT","maxPrecision","getShaderPrecisionFormat","VERTEX_SHADER","HIGH_FLOAT","FRAGMENT_SHADER","MEDIUM_FLOAT","getMaxPrecision","maxTextures","MAX_TEXTURE_IMAGE_UNITS","maxVertexTextures","MAX_VERTEX_TEXTURE_IMAGE_UNITS","maxTextureSize","MAX_TEXTURE_SIZE","maxCubemapSize","MAX_CUBE_MAP_TEXTURE_SIZE","maxAttributes","MAX_VERTEX_ATTRIBS","maxVertexUniforms","MAX_VERTEX_UNIFORM_VECTORS","maxVaryings","MAX_VARYING_VECTORS","maxFragmentUniforms","MAX_FRAGMENT_UNIFORM_VECTORS","vertexTextures","floatFragmentTextures","getExtension","floatVertexTextures","maxSamples","MAX_SAMPLES","stencilBits","STENCIL_BITS","GLExtension","initExtensions","cacheGLQuery","wrap","ANGLE_instanced_arrays","EXT_blend_minmax","MIN_EXT","MAX_EXT","EXT_color_buffer_half_float","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_depth_texture","WEBGL_draw_buffers","WEBGL_lose_context","oldGetExtension","texParameterf","TEXTURE_MAX_ANISOTROPY_EXT","vertexAttribDivisor","divisor","vertexAttribDivisorANGLE","drawElementsInstanced","count","instanceCount","drawElementsInstancedANGLE","drawArraysInstanced","first","drawArraysInstancedANGLE","contextAttributes","preActiveAttributes","contextIds","contextId","clearColor","clearDepth","enable","DEPTH_TEST","depthFunc","LEQUAL","render","renderAtomic","getInstanceCount","shaderMacro","getShaderMacro","shader","getShader","shaderResult","activeShaderProgram","checkedRenderAtomic","checkRenderData","useProgram","program","renderParams","updateRenderParams","activeAttributes","activeUniforms","uniforms","draw","renderMode","getAttributeByKey","activeInfo","uniform","getUniformByKey","indexBuffer","getIndexBuffer","getRenderParams","attributeInfos","location","disableVertexAttribArray","uniformInfos","uniformData","setContext3DUniform","INT","uniform1i","FLOAT_MAT3","uniformMatrix3fv","FLOAT_MAT4","uniformMatrix4fv","FLOAT","uniform1f","FLOAT_VEC2","uniform2f","FLOAT_VEC3","uniform3f","FLOAT_VEC4","uniform4f","SAMPLER_2D","SAMPLER_CUBE","textureInfo","activeTexture","textureID","arrayType","drawElements","vertexNum","attr","drawArrays","Attribute","normalized","stride","usage","STATIC_DRAW","_data","invalidate","enableVertexAttribArray","getBuffer","bindBuffer","ARRAY_BUFFER","vertexAttribPointer","createBuffer","bufferData","deleteBuffer","FrameBuffer","_invalid","frameBuffer","createFramebuffer","deleteFramebuffer","Index","UNSIGNED_INT","_indices","ELEMENT_ARRAY_BUFFER","TextureDataType","TextureFormat","TextureMagFilter","TextureMinFilter","TextureType","TextureWrap","RenderParams","raw","TRIANGLES","cullFace","frontFace","CW","enableBlend","blendEquation","FUNC_ADD","sfactor","SRC_ALPHA","dfactor","ONE_MINUS_SRC_ALPHA","depthtest","LESS","depthMask","colorMask","RGBA","useViewPort","viewPort","useScissor","scissor","usePolygonOffset","polygonOffsetFactor","polygonOffsetUnits","useStencil","stencilFunc","ALWAYS","stencilFuncRef","stencilFuncMask","stencilOpFail","KEEP","stencilOpZFail","stencilOpZPass","stencilMask","cullfaceEnum","colorMaskB","R","G","B","A","NONE","CULL_FACE","disable","BLEND","blendFunc","viewport","POLYGON_OFFSET_FILL","polygonOffset","SCISSOR_TEST","STENCIL_TEST","stencilOp","tooltip","enumClass","shaderMacroKeys","ShaderMacroUtils","getMacroVariablesFromShaderCode","vertex","fragment","variables0","getMacroVariablesFromCode","variables1","code","variables","reg","shaderMacroUtils","shaderConfig","shaders","modules","ShaderLib","_shaderCache","_shaderConfig","shaderName","shaderlib","uninclude","vertexMacroVariables","fragmentMacroVariables","shaderCode","includeRegExp","moduleshader","lastIndex","getShaderNames","clearCache","Shader","setShader","updateShaderCode","shaderKey","compileShaderProgram","vMacroCode","getMacroCode","fMacroCode","compileShaderCode","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","deleteShader","createLinkProgram","vertexShader","fragmentShader","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","vshader","fshader","shaderProgram","numAttributes","ACTIVE_ATTRIBUTES","getActiveAttrib","getAttribLocation","numUniforms","ACTIVE_UNIFORMS","getActiveUniform","names","baseName","substring","getUniformLocation","valueObj","macroHeader","macroName","RenderAtomic","_attributes","_renderParams","_index","_shader","getAttributes","getUniforms","LoaderDataFormat","RenderBuffer","_OFFSCREEN_WIDTH","_OFFSCREEN_HEIGHT","renderBuffer","createRenderbuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","DEPTH_COMPONENT16","deleteRenderbuffer","task","Task","parallel","fns","fn","callbackNum","series","parallelResults","done","seriesResults","Loader","loadText","url","onCompleted","onRequestProgress","onError","xmlHttpRequestLoad","dataFormat","TEXT","onProgress","loadBinary","BINARY","loadImage","crossOrigin","_event","onerror","err","loader","loadItem","request","XMLHttpRequest","open","setRequestHeader","responseType","onreadystatechange","_ev","readyState","status","content","responseText","response","onRequestReadystatechange","onprogress","loaded","total","send","DBStatus","databases","_IndexedDB","_dbStatus","support","indexedDB","getDatabase","dbname","_open","upgrade","onupgrade","unOpen","onsuccessCallbacks","onupgradeneededCallbacks","opening","upgrading","oldDatabase","close","version","onupgradeneeded","newdatabase","callbacks","onsuccess","opened","deleteDatabase","hasObjectStore","objectStroreName","_err","database","objectStoreNames","getObjectStoreNames","createObjectStore","deleteObjectStore","getAllKeys","request_1","transaction","objectStore","objectStoreGet","objectStorePut","request_2","put","objectStoreDelete","request_3","objectStoreClear","request_4","_indexedDB","FSType","FS","HttpFS","rootPath","http","URL","lastIndexOf","readArrayBuffer","getAbsolutePath","readString","readObject","readImage","_evt","basefs","directorytoken","IndexedDBFS","DBname","projectname","ArrayBuffer","stringify","isDirectory","exists","readdir","allfilepaths","subfilemap","dirp","subfile","files","mkdir","deleteFile","writeArrayBuffer","writeString","writeObject","writeImage","copyFile","dest","hasProject","initproject","indexedDBFS","PathUtils","normalizeDir","isHttpURL","getName","basename","extname","dirname","getChildFilePath","parentPath","childName","charAt","getChildFolderPath","childFolderName","getDirDepth","pathUtils","ReadFS","fs","_images","_state","_fs","readStrings","ReadWriteFS","writeFile","ext","meta","json","jpg","png","mp3","js","html","dirpath","getAllPathsInFolder","dirs","currentdir","handle","getChildPath","childpath","moveFile","renameFile","oldPath","newPath","moveFiles","movelists","copyFiles","deletelists","deleteFiles","copylists","copyitem","rename","filepaths","renamelists","move","removelists","RunEnvironment","HideFlags","EventProxy","pageX","pageY","clientX","clientY","rightmouse","keyCode","deltaY","listentypes","handleMouseMoveBug","onMouseKey","MouseEvent","button","mousedownposition","KeyboardEvent","WheelEvent","_target","removeEventListener","addEventListener","KeyState","_keyStateDic","pressKey","releaseKey","getKeyState","ShortCutCapture","shortCut","command","stateCommand","when","_shortCut","_keyState","keyState","_key","_command","_stateCommand","_when","_keys","_states","getStates","_commands","getCommands","_stateCommands","getStateCommand","onCapture","inWhen","checkActivityStates","checkActivityKeys","dispatchCommands","executeStateCommands","commands","stateCommands","not","deactivityState","state","activityState","states","getState","getKeyValue","stateStrs","State","keyStrs","Key","commandStrs","commandStr","stateCommandStrs","StateCommand","destroy","boardKeyDic","KeyBoard","toLocaleLowerCase","getCode","code_1","windowEventProxy","self","KeyCapture","shortcut","_mouseKeyDic","onKeydown","onKeyup","mouseEvents","onMouseOnce","onMousewheel","mouseKey","boardKey","ShortCut","keyCapture","captureDic","stateDic","addShortCuts","shortcuts","shortcut_1","shortcutUniqueKey","getShortcutUniqueKey","removeShortCuts","shortCutCapture","removeAllShortCuts","Feng3dObject","hideFlags","None","_disposed","objectLib","dispose","getObject","getObjects","objects","filterResult","DontSave","RegisterComponent","info","dependencies","Component","_componentMap","getComponentType","_onAnyListener","_gameObject","tag","transform","addComponent","getComponent","getComponentInChildren","includeInactive","getComponentInParent","getComponents","getComponentsInChildren","getComponentsInParent","beforeRender","_renderAtomic","_scene","_camera","setGameObject","gameObject","getDependencies","__proto__","isSingleComponent","isSingle","single","Behaviour","enabled","runEnvironment","all","activeSelf","update","_interval","AddComponentMenu","componentOrder","menuConfig","AssetType","PropertyClipPathItemType","AnimationClip","assetType","anim","loop","PropertyClip","_cacheValues","cliptime","frame","_propertyValues","propertyValues","getpropertyValue","propertyValue","interpolation","prevalue","nextValue","Animation","animations","isplaying","playspeed","_fps","_objectCache","animation","interval","_updateAni","propertyClips","propertyClip","propertyHost","getPropertyHost","propertyName","cacheIndex","autoobjectCacheID","GameObject","find","componentClass","_onAnimationChanged","_onTimeChanged","dragparam","accepttype","datatype","defaultItem","SkeletonJoint","parentIndex","children","_invertMatrix","createNodeMenu","BoundingBox","_selfLocalBounds","_selfWorldBounds","_worldBounds","_selfBoundsInvalid","_selfWorldBoundsInvalid","_worldBoundsInvalid","_invalidateSelfLocalBounds","_invalidateSelfWorldBounds","_updateSelfBounds","_updateSelfWorldBounds","_updateWorldBounds","bounds","selfLocalBounds","localToWorldMatrix","selfWorldBounds","boundingBox","worldBounds","_invalidateWorldBounds","parent","CHAR_DOT","CHAR_COLON","CHAR_FORWARD_SLASH","CHAR_BACKWARD_SLASH","process","platform","env","cwd","ERR_INVALID_ARG_TYPE","expected","actual","determiner","msg","startsWith","endsWith","oneOf","TypeError","thing","validateString","isPathSeparator","isPosixPathSeparator","isWindowsDeviceRoot","normalizeString","allowAboveRoot","separator","lastSegmentLength","lastSlash","dots","lastSlashIndex","_format","sep","pathObject","dir","base","Win32Path","delimiter","win32","posix","resolve","_pathSegments","resolvedDevice","resolvedTail","resolvedAbsolute","path_1","toLowerCase","rootEnd","device","isAbsolute","firstPart","joined","arg","needsReplace","slashCount","firstLen","relative","fromOrig","toOrig","fromStart","fromEnd","fromLen","toStart","toEnd","toLen","lastCommonSep","fromCode","toNamespacedPath","resolvedPath","matchedSlash","extIdx","firstNonSlashEnd","startDot","startPart","preDotState","PosixPath","path_2","trailingSeparator","hasRoot","Ticker","frameRate","onframe","nextframe","offframe","addTickerFunc","removeTickerFunc","repeat","repeatCount","Timer","ticker","currentCount","runfunc","reset","tickerFuncs","running","affers","runtime","Date","now","localrequestAnimationFrame","requestAnimationFrame","_global_1","window","setTimeout","setAssetTypeClass","assetTypeClassMap","runTickerFuncs","currenttime","needTickerFuncItems","affer","FileAsset","isLoaded","isLoading","assetPath","rs","getAssetByPath","initAsset","getAssetData","read","assetData","_getAssetData","eventtype","readMeta","readFile","write","mtimeMs","writeMeta","saveFile","deleteMeta","ReadRS","deleteAssetById","assetId","readPreview","_preview","previewPath","writePreview","deletePreview","getAssetById","metaPath","FolderAsset","folder","getChildrenAssetByPath","extenson","_rootPath","_idMap","_pathMap","resources","asset","addAsset","createAsset","_asset","fileName","guid","birthtimeMs","AssetData","addAssetData","getValidChildName","childrenNames","childrenAssets","newName","readAsset","readAssetData","getLoadedAssetData","readAssetDatas","assetids","getAssetsByType","getLoadedAssetDatasByType","getAllLoadedAssetDatas","getChildrenPathsByPath","getAllPaths","getAllIds","getAllAssets","deleteAsset0","deleteAssetByPath","getAssetsWithObject","isAssetData","deserializeWithAssets","_result","_assetId","assetMap","idAssetMap","deleteAssetData","_delete","deleteAssetDataById","assetPropertySign","ShadowType","GeometryUtils","createIndices","createUVs","idx","uvIdx","createVertexNormals","useFaceWeights","faceNormalsResult","createFaceNormals","faceWeights","faceNormals","f3","lenV","lenI","createVertexTangents","faceTangentsResult","createFaceTangents","faceTangents","index1","index2","index3","vi","dv1","dv2","denom","z0","dx1","dy1","dz1","cz","y3","dx2","dy2","dz2","applyTransformation","i1","i2","bakeNormals","bakeTangents","invTranspose","vi0","ni0","ti0","mergeGeometry","geometrys","_loop_1","startIndex_1","raycast","ray","shortestCollisionDistance","FRONT_AND_BACK","i0","coeff","s0x","s0y","s0z","s1x","s1y","s1z","nl","nDotV","D","Q1Q2","Q1Q1","Q2Q2","RQ1","RQ2","collisionTriangleIndex","rayPosition","rayDirection","localPosition","localNormal","uv","getCollisionUV","triangleIndex","uIndex","uv0x","uv0y","uv1x","uv1y","uv2x","uv2y","getAABB","geometryUtils","Geometry","preview","scaleU","scaleV","_indexBuffer","a_position","a_color","a_uv","a_normal","a_tangent","a_skinIndices","a_skinWeights","a_skinIndices1","a_skinWeights1","_geometryInvalid","_useFaceWeights","numVertex","numTriangles","updateGrometry","invalidateGeometry","invalidateBounds","buildGeometry","addGeometry","addAttributes","oldNumVertex","totalIndices","attributeName","addAttribute","cloneFrom","_bounding","getVertices","getFaces","SCALEU","SCALEV","setDefault","_defaultGeometry","NotEditable","getDefault","ImageDatas","LightPicker","model","_model","pointLights","directionalLights","spotLights","scene","activePointLights","activeDirectionalLights","activeSpotLights","NUM_LIGHT","castShadowPointLights","unCastShadowPointLights","pointShadowMaps","isVisibleAndEnabled","shadowType","No_Shadows","receiveShadows","shadowMap","NUM_POINTLIGHT","NUM_POINTLIGHT_CASTSHADOW","u_pointLights","u_castShadowPointLights","u_pointShadowMaps","castShadowSpotLights","unCastShadowSpotLights","spotShadowMaps","spotShadowMatrix","shadowCamera","viewProjection","NUM_SPOT_LIGHTS","NUM_SPOT_LIGHTS_CASTSHADOW","u_spotLights","u_castShadowSpotLights","u_spotShadowMatrix","u_spotShadowMaps","castShadowDirectionalLights","unCastShadowDirectionalLights","directionalShadowMatrix","directionalShadowMaps","NUM_DIRECTIONALLIGHT","NUM_DIRECTIONALLIGHT_CASTSHADOW","u_directionalLights","u_castShadowDirectionalLights","u_directionalShadowMatrixs","u_directionalShadowMaps","TextureInfo","UNSIGNED_BYTE","LINEAR","_wrapS","REPEAT","_wrapT","CLAMP_TO_EDGE","pixel","updateActivePixels","_activePixels","_dataURL","ImageData","HTMLImageElement","HTMLCanvasElement","old","_pixels","noPixels","imageDatas","ImageUtil","fillcolor","fromImage","fillRect","canvasImg","ctxt","getImageData","drawPixel","oldColor","getPixel","setPixel","pos","drawLine","drawPoint","half","drawImageData","imageUtil","drawDefaultParticle","drawColorPickerRect","leftTop","rightTop","leftBottom","rightBottom","drawColorRect","colorHeight","alphaWidth","drawMinMaxGradient","dirw","drawCurve","prepos","curpos","drawBetweenTwoCurves","curve1","curveColor","prepos0","curpos0","prepos1","curpos1","clearBackColor","backColor","defaultNormal","defaultParticle","Texture2D","_loadings","_source","onItemLoadCompleted","onLoadCompleted","fromUrl","default","TextureCube","texturecube","OAVCubeMap","_loading","setTexture2D","ImageNames","_loadItemTexture","setTexture2DPath","_loadItemImagePath","getTextureImage","texture_1","_rawDataChanged","_onItemLoadCompleted","imagepath","FogMode","StandardUniforms","u_PointSize","s_diffuse","u_diffuse","u_alphaThreshold","s_normal","s_specular","u_specular","u_glossiness","s_ambient","u_ambient","s_envMap","u_reflectivity","u_fogMinDistance","u_fogMaxDistance","u_fogColor","u_fogDensity","u_fogMode","standard","Material","_onShaderChanged","material","IS_POINTS_MODE","POINTS","loadingNum","newuniforms","_onUniformsChanged","_onRenderParamsChanged","newMaterial","_defaultMaterials","Material$1","RayCastable","_updateBounds","worldRayIntersection","_worldRay","_onScenetransformChanged","_onBoundsInvalid","Renderable","castShadows","_lightPicker","_onGetSelfBounds","camera","components","worldRay","localRay","rayWorldToLocal","localRayIntersection","rayOriginIsInsideBounds","_onGeometryChanged","bounding","ScriptComponent","feng3d","scriptInit","_updateScriptInstance","_scriptInstance","_invalidateScriptInstance","oldInstance","scriptName","scriptInstance","Transform","_position","_rotation","_orientation","_scale","_matrix","_matrixInvalid","_rotationMatrix","_rotationMatrixInvalid","_localToWorldMatrix","_localToWorldMatrixInvalid","_ITlocalToWorldMatrix","_ITlocalToWorldMatrixInvalid","_worldToLocalMatrix","_worldToLocalMatrixInvalid","_localToWorldRotationMatrix","_localToWorldRotationMatrixInvalid","_positionChanged","_rotationChanged","_scaleChanged","u_modelMatrix","u_ITModelMatrix","ITlocalToWorldMatrix","angles","_updateMatrix","translateLocal","moveBackward","moveLeft","moveDown","_invalidateSceneTransform","pitch","rotate","yaw","roll","rotateTo","positionMatrix","_updateLocalToWorldMatrix","worldToLocalMatrix","localToWorldRotationMatrix","transformDirection","localToWolrdDirection","localToWolrdBox","transformPoint","localToWorldPoint","transformVector","localToWorldVector","inverseTransformDirection","worldToLocalDirection","worldToLocalPoint","worldToLocalVector","_object","_invalidateTransform","numChildren","getChildAt","step","stepScale","stepDownup","gameobject","_activeSelf","mouseEnabled","_components","_children","_activeInHierarchy","_activeInHierarchyInvalid","_invalidateActiveInHierarchy","_updateActiveInHierarchy","removeComponentsByType","addComponentAt","numComponents","_boundingBox","_parent","removeChildAt","addChild","setActive","Type","dependency","compnent","getComponentAt","setComponentIndex","setComponentAt","removeComponentAt","removeComponent","hasComponent","getComponentIndex","swapComponentsAt","swapComponents","removeComponents","com","addScript","scriptComponent","child","checkitem","childIndex","removeChild","_setParent","addChildren","childarray","childKey","remove","removeChildren","removeChildInternal","getChildren","disposeWithChildren","onSelfLoadCompleted","isSelfLoaded","disposed","activeInHierarchy","updateScene","newScene","updateChildrenScene","createPrimitive","createHandler","_registerPrimitives","registerPrimitive","click","SkeletonComponent","joints","isInitJoints","initSkeleton","_globalPropertiesInvalid","updateGlobalProperties","_globalMatrices","jointGameobjects","jointGameObjectMap","createSkeletonGameObject","_jointsInvalid","_globalMatrixsInvalid","globalMatrixs","jointNum","globalMatrix","invertMatrix","jointPose","jointGameobject","parentGlobalMatrix","invalidjoint","jointIndex","skeleton","createJoint","parentGameobject","skeletonJoint","SkinnedMeshRenderer","cacheU_skeletonGlobalMatriices","DontTransform","frameId","clipName","skeletonGlobalMatriices","u_skeletonGlobalMatriices","HAS_SKELETON_ANIMATION","NUM_SKELETONJOINT","skinSkeleton","cacheSkeletonComponent","skeletonComponent","globalMatrices","initMatrix","defaultSkeletonGlobalMatriices","SkinSkeleton","numJoint","SkinSkeletonTemp","cache_map","resetJointIndices","jointIndices","parseInt","ReadWriteRS","laterSaveFunc","save","laterSave","allAssets","writeAsset","moveAsset","filename","fp","parentAsset","assets","ca","moveLastAsset","la","deleteAsset","deleteLastAsset","audioCtx","globalGain","DistanceModelType","AudioListener","_volume","gain","createGain","connect","destination","_enabledChanged","setTargetAtTime","currentTime","forwardX","positionX","setValueAtTime","positionY","positionZ","forwardY","forwardZ","upX","upY","upZ","setOrientation","disconnect","AudioContext","zeroGain","Projection","AudioSource","_loop","_enablePosition","panner","createPanner","orientationX","orientationY","orientationZ","panningModel","distanceModel","refDistance","maxDistance","rolloffFactor","coneInnerAngle","coneOuterAngle","coneOuterGain","volume","_connect","_disconnect","_coneInnerAngle","_coneOuterAngle","_coneOuterGain","_distanceModel","_maxDistance","_panningModel","_refDistance","_rolloffFactor","play","createBufferSource","scenePosition","_onUrlChanged","url_1","decodeAudioData","_getAudioNodes","LensBase","aspectRatio","_inverseMatrix","_invertMatrixInvalid","_projectionType","_updateInverseMatrix","project","point3d","unproject","inverseMatrix","unprojectRay","sp","unprojectWithDepth","nX","nY","sZ","OrthographicLens","Orthographic","PerspectiveLens","Perspective","p44","Camera","_viewProjection","_viewProjectionInvalid","_backups","_frustum","_frustumInvalid","projectionType","projection","_lens","invalidateViewProjection","getRay3D","ray3D","sX","sY","getScaleByDepth","depth","lt","rb","BillboardComponent","_onUpdateLocalToWorldMatrix","_invalidHoldSizeMatrix","_onCameraChanged","cameraPos","worldPosition","CartoonComponent","outlineSize","outlineColor","outlineMorphFactor","diffuseSegment","diffuseSegmentValue","specularSegment","_cartoon_Anti_aliasing","u_diffuseSegment","u_diffuseSegmentValue","u_specularSegment","u_outlineSize","u_outlineColor","u_outlineMorphFactor","Graphics","context2D","watchContext2D","watchFuncs","oldFunc","HoldSizeComponent","holdSize","depthScale","_getDepthScale","cameraTranform","OutLineComponent","WireframeComponent","ControllerBase","targetObject","_interpolate","_targetObject","FPSController","acceleration","ischange","_auto","onMousedown","onMouseup","keyDirectionDic","keyDownDic","auto","preMousePoint","mousePoint","velocity","onMouseMove","up_1","accelerationVec","displacement","stopDirectionVelocity","LookAtController","lookAtObject","_origin","_upAxis","_pos","lookAtPosition","_lookAtPosition","_lookAtObject","HoverController","panAngle","tiltAngle","minTiltAngle","maxTiltAngle","minPanAngle","maxPanAngle","steps","yFactor","wrapPanAngle","_currentPanAngle","_currentTiltAngle","_panAngle","_tiltAngle","_distance","_minPanAngle","_maxPanAngle","_minTiltAngle","_maxTiltAngle","_steps","_yFactor","_wrapPanAngle","interpolate","MeshRenderer","Raycaster","pick","gameObjects","pickingCollisionVOs","pickingCollisionVO","bestCollisionVO","pickAll","raycaster","Mouse3DManager","mouseInput","_mouseEventTypes","_selectedGameObject","setSelectedGameObject","view","mouseRay3D","mouseCheckObjects","_mouseInputChanged","mouseEventTypes","onMouseEvent","dispatch","preMouseDownGameObject","gameObjectClickNum","MouseInput","catchMouseMove","WindowMouseInput","mouseEvent","mouseX","mouseY","Script","TransformLayout","_size","_leftTop","_rightBottom","anchorMin","anchorMax","pivot","_layoutInvalid","_invalidateLayout","_invalidateSize","_invalidatePivot","_onAdded","_onRemoved","TransformLayout_1","_updateLayout","transformLayout","parentSize","parentPivot","anchorLeftTop","anchorRightBottom","PlaneGeometry","segmentsW","segmentsH","yUp","vertexPositionData","buildPosition","vertexNormalData","buildNormal","vertexTangentData","buildTangent","uvData","buildUVs","buildIndices","positionIndex","normalIndex","tangentIndex","tw","LightType","RenderTargetTexture2D","NEAREST","FrameBufferObject","depthBuffer","frameBufferObject","frameBufferObjects","bindFramebuffer","FRAMEBUFFER","framebuffer","framebufferTexture2D","COLOR_ATTACHMENT0","framebufferRenderbuffer","DEPTH_ATTACHMENT","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","deactive","invalidateSize","Light","intensity","shadowBias","shadowRadius","debugShadowMap","updateDebugShadowMap","viewCamera","debugShadowMapObject","Hide","lightType","Point","textureMaterial","s_texture","DirectionalLight","Directional","updateShadowByCamera","models","pre","shadowCameraNear","orthographicLens","ForwardRenderer","blenditems","getPickCache","unblenditems","u_projectionMatrix","u_viewProjection","u_viewMatrix","u_cameraMatrix","u_cameraPos","u_skyBoxSize","u_scaleByDepth","u_sceneAmbientColor","ambientColor","ctime","_Time","renderable","u_mvMatrix","u_ITMVMatrix","forwardRenderer","OutlineRenderer","outlineRenderer","ShadowRenderer","drawForPointLight","drawForSpotLight","drawForDirectionalLight","renderer","light","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","castShadowsModels","getModelsByCamera","u_lightType","u_lightPosition","u_shadowCameraNear","u_shadowCameraFar","shadowCameraFar","drawGameObject","vpWidth","shadowMapSize","vpHeight","cube2DViewPorts","face","cubeDirections","cubeUps","getPickByDirectionalLight","shadowShader","shadowRenderer","WireframeRenderer","LINES","wireframes","wireframe","wireframeColor","LINE_LOOP","LINE_STRIP","oldIndexBuffer","wireframeindexBuffer","wireframeindices","wireframeShader","u_wireframeColor","wireframeRenderer","PointLight","_range","invalidRange","SpotLight","Spot","penumbra","perspectiveLens","_invalidRange","_invalidAngle","SkyBox","s_skyboxTexture","ScenePickCache","_activeModels","_blenditems","activeModels","camerapos","_unblenditems","Scene","background","_pickMap","_mouseCheckObjects","_models","_visibleAndEnabledModels","_skyBoxs","_activeSkyBoxs","_directionalLights","_activeDirectionalLights","_pointLights","_activePointLights","_spotLights","_activeSpotLights","_animations","_activeAnimations","_behaviours","_activeBehaviours","behaviours","skyBoxs","checkList","checkObject","_light","openlist","visibleAndEnabledModels","SkyBoxRenderer","skybox","activeSkyBoxs","drawSkyBox","skyboxRenderer","View","_contextAttributes","stencil","mousePos","viewRect","contextLost","style","body","appendChild","preventDefault","mouse3DManager","cameras","setSize","selectedGameObject","selectedObject","clientWidth","clientHeight","clientRect","getBoundingClientRect","calcMouseRay3D","clearStencil","STENCIL_BUFFER_BIT","screenToGpuPosition","screenPos","gpuPos","getObjectsInGlobalArea","include","createNewScene","directionalLight","Hard_Shadows","CustomGeometry","PointGeometry","numPoints","positionData","normalData","SegmentGeometry","addSegment","Segment","numSegments","colorData","startColor","endColor","ColorUniforms","u_diffuseInput","PointUniforms","u_color","SegmentUniforms","u_segmentColor","TextureUniforms","CapsuleGeometry","startIndex","comp1","comp2","horangle","ringradius","verangle","normLen","tanLen","CylinderGeometry","topRadius","bottomRadius","topClosed","bottomClosed","surfaceClosed","revolutionAngle","revolutionAngleDelta","addVertex","dr","latNormElev","latNormBase","na0","na1","naComp1","naComp2","addTriangleClockWise","cwVertexIndex0","cwVertexIndex1","cwVertexIndex2","ConeGeometry","CubeGeometry","segmentsD","tile6","outerPos","hw","hh","hd","dw","dh","dd","tl","tr","bl","br","inc","fidx","uidx","uTileDim","vTileDim","uTileStep","vTileStep","tl0u","tl0v","tl1u","tl1v","du","dv","ParametricGeometry","slices","stacks","doubleside","sliceCount","QuadGeometry","SphereGeometry","TorusGeometry","tubeRadius","segmentsR","segmentsT","_vertexPositionStride","_vertexNormalStride","_vertexTangentStride","vertexIndex","_vertexPositionData","_vertexNormalData","_vertexTangentData","currentTriangleIndex","_rawIndices","revolutionAngleR","revolutionAngleT","_numVertices","_vertexIndex","_currentTriangleIndex","startPositionIndex","revolutionAngleDeltaR","revolutionAngleDeltaT","MouseRenderer","readPixels","drawRenderables","uObjectID","u_objectID","mouseRenderer","SceneUtil","getBlenditems","getActiveRenderers","renderers","sceneUtil","mouse","Particles_Additive","Particles_AlphaBlendedPremultiply","shadow","terrain","alphatest_frag","alphatest_pars_frag","ambient_frag","ambient_pars_frag","cartoon_pars_frag","color_frag","color_pars_frag","color_pars_vert","color_vert","diffuse_frag","diffuse_pars_frag","envmap_frag","envmap_pars_frag","fog_frag","fog_pars_frag","lights_frag","lights_pars_frag","lights_pars_vert","lights_vert","normalmap_pars_vert","normalmap_vert","normal_frag","normal_pars_frag","normal_pars_vert","normal_vert","particle_frag","particle_pars_frag","particle_pars_vert","particle_vert","pointsize_pars_vert","pointsize_vert","position_pars_vert","position_vert","project_pars_vert","project_vert","shadowmap_pars_frag","skeleton_pars_vert","skeleton_vert","specular_frag","specular_pars_frag","tangent_pars_vert","tangent_vert","terrainDefault_pars_frag","terrainMerge_pars_frag","terrain_frag","terrain_pars_frag","uv_pars_vert","uv_vert","worldposition_pars_vert","worldposition_vert","CanvasTexture2D","_canvasChanged","ImageDataTexture2D","_imageDataChanged","ImageTexture2D","_imageChanged","imageSource","VideoTexture2D","_videoChanged","video","Uuid","objectUuid","WeakMap","getArrayUuid","getObjectUuid","__uuid__","FunctionWrap","_wrapFResult","extendFunction","funcName","extendFunc","oldFun","args1","beforeFunc","afterFunc","__functionwrap__","functionwraps","original","space","funcs","unwrap","wrapFunc","wrapAsyncFunc","funcHost","params","cuuid","functionwrap","Debug","labal","timeEnd","debug","RegExps","audio","classReg","regExps","Stats","container","cssText","showPanel","memPanel","beginTime","performance","prevTime","frames","fpsPanel","addPanel","StatsPanel","msPanel","memory","REVISION","dom","begin","usedJSHeapSize","jsHeapSizeLimit","domElement","setMode","panel","display","instance","fg","bg","PR","devicePixelRatio","WIDTH","HEIGHT","TEXT_X","TEXT_Y","GRAPH_X","GRAPH_Y","GRAPH_WIDTH","GRAPH_HEIGHT","context0","context","fillStyle","fillText","globalAlpha","maxValue","Water","sun","u_sunColor","u_sunDirection","u_time","WaterUniforms","u_alpha","u_size","u_distortionScale","u_waterColor","s_normalSampler","s_mirrorSampler","u_textureMatrix","water","ArrayBufferAsset","AudioAsset","ObjectAsset","_dataChanged","_onDataChanged","GameObjectAsset","prefabId","GeometryAsset","TextAsset","txt","textContent","JSAsset","JsonAsset","MaterialAsset","ScriptAsset","script","_update","_parentScriptName","_scriptName","_invalidate","ShaderAsset","TextureAsset","TextureCubeAsset","_realIndices","MD5AnimConverter","convert","md5AnimData","completed","animationClip","numFrames","__chache__","translatePose","frameData","animationclip","hierarchy","flags","translation","numJoints","baseframe","orientation","setPropertyClipFrame","getPropertyClip","md5AnimConverter","MD5MeshConverter","md5MeshData","_maxJointCount","calculateMaxJointCount","skeletonjoints","createSkeleton","meshs","createGeometry","skeletonGameObject","skinnedModel","numMeshData","meshData","vertexData","numVerts","zeroWeights","countZeroWeightJoints","weights","totalJoints","countWeight","startWeight","bias","createSkeletonJoint","joint","quat","md5Mesh","tris","jointIndices0","jointIndices1","jointWeights0","jointWeights1","weightJoints","weightBiass","skinIndices","skinWeights","skinIndices1","skinWeights1","md5MeshConverter","MTLConverter","mtl","materials","materialInfo","kd","ks","mtlConverter","OBJConverter","objData","objs","createSubObj","objConverter","subObjs","materialObj","createMaterialObj","subObj","indexIds","translateVertexData","vertexNormal","vertexIndices","normalIndices","vn","uvIndices","vt","MD5AnimParser","parserLine","md5AnimParser","MD5VersionReg","commandlineReg","numFramesReg","numJointsReg","frameRateReg","numAnimatedComponentsReg","hierarchyStartReg","hierarchyReg","endBlockReg","boundsStartReg","number32Reg","baseframeStartReg","frameStartReg","numbersReg","currentFrame","MD5Version","commandline","numAnimatedComponents","parseFloat","numbers","MD5MeshParser","md5MeshParser","numMeshesReg","jointsStartReg","jointsReg","meshStartReg","annotationReg","shaderReg","numvertsReg","vertReg","numtrisReg","triReg","numweightsReg","weightReg","currentMesh","numMeshes","mesh","numverts","numtris","numweights","MD5Loader","load","loadAnim","md5Loader","AnimInfo","AnimInfo1","BoneRotation","rotations","getRotationItem","keyFrameTime","rotationQuaternion","key1","key2","Factor","BoneObject","Parent","Translation","BoneTranslation","Scaling","BoneScaling","Rotation","transformation","globalTransformation","calculateTransformation","pScaling","getScaling","pRotation","pTranslation","getTranslation","buildAnimationclip","scalings","scaling","translations","getMatrix","scalingVector","Factor1","Factor2","Factor3","Factor4","FactorTimesTwo","InverseFactorTimesTwo","InverseFactor","OutTan","InTan","TranslationVector","FBitmap","Geoset","Anims","Globalsequences","durations","Interval","Layer","layers","Model","War3Model","geosets","bones","getMesh","war3Model","pivotPoints","ObjectId","parentskeletonJoint","geoset","Vertices","TVertices","Faces","skins","BuildAnimatedMeshSkin","MaterialID","getFBitmap","Feng3dMaterial","animationclips","sequences","sequence","bone","createAnimationClips","TextureID","numVertexs","iGroupIndex","VertexGroup","group","Groups","numBones","boneIndex","MDLParser","onParseComplete","token","_line","_parseIndex","_reachedEOF","_charLineIndex","getNextToken","COMMENT_TOKEN","ignoreLine","VERSION_TOKEN","_version","parseVersion","MODEL","parseModel","SEQUENCES","parseSequences","GLOBALSEQUENCES","globalsequences","parseGlobalsequences","TEXTURES","parseTextures","MATERIALS","parseMaterials","GEOSET","parseGeoset","GEOSETANIM","BONE","parseBone","HELPER","parseHelper","parsePivotPoints","parseLiteralString","jumpChunk","sendUnknownKeywordError","sendParseError","getNextInt","ch","BlendTime","MinimumExtent","parseVector3D","MaximumExtent","parseAnim","duration","bitmaps","bitmap","parseBitmap","parseMaterial","parseVertices","Normals","parseNormals","parseTVertices","parseVertexGroup","parseFaces","parseGroups","BoundsRadius","getNextNumber","parseAnim1","SelectionGroup","Unselectable","GeosetId","GeosetAnimId","Billboarded","parseBoneTranslation","parseBoneScaling","parseBoneRotation","boneScaling","check","currentIndex","GlobalSeqId","boneTranslation","boneRotation","parseVector3D4","tVertices","parsePoint","vertexGroup","groups","Matrices","ReplaceableId","layer","parseLayer","staticSigned","FilterMode","Alpha","Unshaded","Unfogged","TwoSided","SphereEnvMap","NoDepthTest","NoDepthSet","parseInterval","Rarity","MoveSpeed","skipWhiteSpace","getNextChar","sendEOFError","stack","putBack","keyword","mdlParser","currentMaterial","MDLLoader","mdlurl","showMesh","mdlLoader","MTLParser","parser","mtlParser","newmtlReg","kaReg","kdReg","ksReg","nsReg","niReg","dReg","illumReg","map_Bump_Reg","map_Ka_Reg","map_Kd_Reg","map_Ks_Reg","ka","ns","illum","map_Bump","map_Ka","map_Kd","map_Ks","currentObj","currentSubObj","MTLLoader","mtlData","mtlLoader","OBJParser","objParser","mtlReg","objReg","vertexReg","vnReg","vtReg","usemtlReg","faceV3Reg","faceVReg","faceVUNReg","faceVN3Reg","gReg","sReg","ParticleSystemAnimationType","ParticleSystemInheritVelocityMode","ParticleSystemMeshShapeType","ParticleSystemNoiseQuality","ParticleSystemRenderMode","ParticleSystemRenderSpace","ParticleSystemScalingMode","ParticleSystemShapeConeEmitFrom","ParticleSystemShapeMultiModeValue","ParticleSystemShapeType","ParticleSystemShapeType1","ParticleSystemSimulationSpace","ParticleSystemSortMode","ParticleSystemSubEmitterProperties","ParticleSystemSubEmitterType","SpriteMaskInteraction","UVChannelFlags","ObjLoader","objLoader","ParticleSystemShapeBoxEmitFrom","ParticleModule","initParticleState","_particle","updateParticleState","ParticleColorBySpeedModule","particle","ColorBySpeedRate","ParticleColorOverLifetimeModule","ColorOverLifetimeRate","rateAtLifeTime","ParticleEmissionBurst","probability","_isProbability","calculateProbability","ParticleEmissionModule","rateOverTime","rateOverDistance","bursts","getBursts","setBursts","ParticleForceOverLifetimeModule","force","Local","randomized","ForceOverLifetimeRate","particleSystem","removeParticleAcceleration","ForceOverLifetimePreForce","addParticleAcceleration","ParticleInheritVelocityModule","Initial","InheritVelocityRate","main","simulationSpace","_emitInfo","speed","Current","moveVec","ParticleLimitVelocityOverLifetimeModule","separateAxes","limit","limit3D","dampen","LimitVelocityOverLifetimeRate","pVelocity","World","ParticleMainModule","prewarm","startDelay","startLifetime","startSpeed","useStartSize3D","startSize3D","useStartRotation3D","startRotation3D","randomizeRotationDirection","gravityModifier","simulationSpeed","scalingMode","playOnAwake","maxParticles","startSize","startSizeX","startSizeY","startSizeZ","startRotation","startRotationX","startRotationY","startRotationZ","birthRateAtDuration","gravity","worldGravity","rateAtDuration","MainPreGravity","ParticleNoiseModule","strength3D","frequency","scrollSpeed","damping","octaveCount","octaveMultiplier","octaveScale","High","remapEnabled","remap3D","_scrollValue","NoiseStrengthRate","NoiseParticleRate","removeParticlePosition","NoisePreOffset","strengthX","strengthY","strengthZ","strength","_frequencyScale","offsetPos","_strengthScale","_timeScale","_getNoiseValue","addParticlePosition","_getDrawImageStrength","imageWidth","imageHeight","cell","_getNoiseValueBase","ln","scrollValue","Low","Medium","ParticleRotationBySpeedModule","RotationBySpeedRate","RotationBySpeedPreAngularVelocity","preAngularVelocity","ParticleRotationOverLifetimeModule","RotationOverLifetimeRate","RotationOverLifetimePreAngularVelocity","ParticleSystemShape","module","_module","calcParticlePosDir","_dir","ParticleSystemShapeBox","emitFrom","Volume","Shell","Edge","boxX","boxY","boxZ","ParticleSystemShapeCircle","emitFromEdge","arcMode","arcSpread","arcSpeed","radiusAngle","Random","totalAngle","birthTime","ParticleSystemShapeCone","Base","radiusRate","basePos","bottomPos","topPos","VolumeShell","ParticleSystemShapeEdge","radiusMode","radiusSpread","radiusSpeed","ParticleSystemShapeHemisphere","emitFromShell","ParticleSystemShapeSphere","ParticleShapeModule","alignToDirection","randomDirectionAmount","sphericalDirectionAmount","meshScale","meshShapeType","Vertex","useMeshColors","normalOffset","_shapeSphere","_shapeHemisphere","_shapeCone","_shapeBox","_shapeCircle","_shapeEdge","shapeType","Cone","tempPosition","tempDir","activeShape","mat0","_onShapeTypeChanged","preValue","SphereShell","Hemisphere","HemisphereShell","ConeShell","BaseShell","ConeVolume","ConeVolumeShell","Box","BoxShell","BoxEdge","Mesh","Circle","CircleEdge","SingleSidedEdge","_onShapeChanged","ParticleSizeBySpeedModule","size3D","SizeBySpeedRate","ParticleSizeOverLifetimeModule","SizeOverLifetimeRate","ParticleSubEmittersModule","subEmitters","AddSubEmitter","subEmitter","properties","emitProbability","_isSubParticleSystem","GetSubEmitterEmitProbability","GetSubEmitterProperties","GetSubEmitterSystem","GetSubEmitterType","RemoveSubEmitter","SetSubEmitterEmitProbability","SetSubEmitterProperties","SetSubEmitterSystem","SetSubEmitterType","subEmittersCount","Birth","TriggerSubEmitter","ParticleSystemRenderer","ParticleTextureSheetAnimationModule","tiles","WholeSheet","frameOverTime","useRandomRow","_rowIndex","startFrame","cycleCount","flipUV","uvChannelMask","Everything","TextureSheetAnimationFrameOverTime","TextureSheetAnimationStartFrame","TextureSheetAnimationRandomRow","tilingOffset","segmentsX","segmentsY","uvPos","frameIndex","rowIndex","SingleRow","ParticleVelocityOverLifetimeModule","VelocityOverLifetimeRate","removeParticleVelocity","VelocityOverLifetimePreVelocity","addParticleVelocity","Particle","lifetime","updateState","preTime","curTime","prePosition","curPosition","ParticlesAdditiveUniforms","_TintColor","_MainTex","_MainTex_ST","_InvFade","RGB","ParticlesAlphaBlendedPremultiplyUniforms","u_softParticlesFactor","ParticleSystem","_isPlaying","_awaked","_particlePool","_activeParticles","a_particle_position","a_particle_scale","a_particle_rotation","a_particle_color","a_particle_tilingOffset","a_particle_flipUV","_modules","emission","velocityOverLifetime","inheritVelocity","forceOverLifetime","limitVelocityOverLifetime","colorOverLifetime","colorBySpeed","sizeOverLifetime","sizeBySpeed","rotationOverLifetime","rotationBySpeed","textureSheetAnimation","_main","_simulationSpaceChanged","_emission","_shape","_velocityOverLifetime","_limitVelocityOverLifetime","_inheritVelocity","_forceOverLifetime","_colorOverLifetime","_colorBySpeed","_sizeOverLifetime","_sizeBySpeed","_rotationOverLifetime","_rotationBySpeed","_noise","_subEmitters","_textureSheetAnimation","isPlaying","emitInfo","preWorldPos","currentWorldPos","_updateActiveParticlesState","emits","_emit","_emitParticles","_leftRateOverDistance","_isRateOverDistance","pause","continue","HAS_PARTICLE_ANIMATOR","ENABLED_PARTICLE_SYSTEM_textureSheetAnimation","isbillboard","billboardMatrix","cameraMatrix","localCameraForward","localCameraUp","worldToLocalRotationMatrix","scales","tilingOffsets","flipUVs","u_particle_billboardMatrix","startTime","endTime","moveEmits","_emitWithMove","timeEmits","_emitWithTime","moveDistance","worldPos","moveDir","leftRateOverDistance","invRateOverDistance","invRateOverDistanceVec","lastRateOverDistance","cycleStartIndex","cycleEndIndex","cycleStartTime","cycleEndTime","inCycleStart","inCycleEnd","burst","isProbability","_initParticleState","_updateParticleState","subEmitInfo","worldToLocalMatrix_1","localToWorldMatrix_1","subEmitterIndex","particles","particleWoldPos","subEmitPos","subEmits","Terrain","TerrainData","heightmapResolution","TerrainGeometry","heightMap","maxElevation","minElevation","_heightImageData","defaultHeightMap","_onHeightMapChanged","col","numInds","uDiv","vDiv","numUvs","getHeightAt","TerrainUniforms","s_splatTexture1","s_splatTexture2","s_splatTexture3","s_blendTexture","u_splatRepeats","TerrainMergeMethod","splatMergeTexture","blendTexture","splatRepeats","s_splatMergeTexture","u_splatMergeTextureSize","u_imageSize","u_tileSize","u_maxLod","u_uvPositionScale","u_tileOffset","u_lod0vec","ButtonState","Transform2D","_rect","_layout","_anchorMin","_anchorMax","_pivot","_onTransformLayoutChanged","_onAddComponent","_onRemovedComponent","HideInInspector","layout","u_rect","transform2D","UIRenderMode","Button","allStateData","_stateInvalid","saveState","stateData","childMap","childname","jsonObj","_onStateChanged","_updateState","statedata","Canvas","ScreenSpaceOverlay","mouseRay","CanvasRenderer","CanvasRenderer_1","UIGeometry","UIUniforms","u_uvRect","setNativeSize","imagesize","label","_r","Rect","TEXT_GRADIENT","FontFamily","FontStyle","FontVariant","FontWeight","CanvasLineJoin","CanvasTextBaseline","TextAlign","WhiteSpaceHandle","TextMetrics","fontProperties","measureText","wordWrap","_canvas","toFontString","measureFont","ascent","letterSpacing","strokeThickness","dropShadow","dropShadowDistance","leading","whiteSpace","collapseSpaces","collapseNewlines","canPrependSpaces","wordWrapWidth","tokens","tokenize","isNewline","addLine","currIsBreakingSpace","isBreakingSpace","lastIsBreakingSpace","tokenWidth","getFromCache","canBreakWords","breakWords","characters","wordWrapSplit","nextChar","lastChar","canBreakChars","characterWidth","isLastToken","newLine","trimRight","spacing","_newlines","_breakingSpaces","_token","_char","_nextChar","_breakWords","_fonts","_context","metricsString","METRICS_STRING","BASELINE_SYMBOL","baseline","BASELINE_MULTIPLIER","imagedata","descent","clearMetrics","TextStyle","fontFamily","Arial","fontStyle","fontVariant","fontWeight","fillGradientType","LINEAR_VERTICAL","fillGradientStops","stroke","lineJoin","miter","miterLimit","alphabetic","dropShadowColor","dropShadowAngle","dropShadowBlur","padding","fontSizeString","fontFamilies","drawText","_text","linePositionX","linePositionY","_font","measured","clearRect","passesCount","isShadowPass","dsOffsetText","dsOffsetShadow","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","_generateFillStyle","drawLetterSpacing","trimmed","trimCanvas","totalIterations","currentIteration","stylefill","lengthPlus1","createLinearGradient","addColorStop","isStroke","currentPosition","stringArray","previousWidth","currentWidth","currentChar","strokeText","Text","autoSize","_uvRect","_image","_styleChanged","lineData","epsilon","closeStroke","lineStyle","alignment","cap","dashedLinePatternUnit","linePoints","pattern","currentStepDashedLinePoints","dashedLinePoints","patternIndex","isFill","currentPartternWidth","nextPoint","currentSegmentWidth","leftSegmentWidth","alphaX","alphaY","transformDashedLine","dashedLinePattern","eps","closedShape","closedPath","midPointX","midPointY","indexCount","indexStart","widthSquared","miterLimitSquared","perpx","perpy","perp1x","perp1y","ratio","dx0","dy0","pdist","imx","imy","omx","omy","insideWeight","eps2","buildSingleLineGeometry"],"mappings":"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"}