/*!
 * feng3d - v0.5.0
 * Compiled Tue, 26 Jul 2022 08:36:39 UTC
 *
 * feng3d is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
var feng3d=function(t){"use strict";function e(t){return function(e){Object.getOwnPropertyDescriptor(e.prototype,l)||(e.prototype[l]={});var n=e.prototype[l];n.component=t.component,n.componentParam=t.componentParam}}function n(t){return function(e,n){r.addOAV(e,n,t)}}var i=function(){function t(){this.defaultBaseObjectViewClass="",this.defaultObjectViewClass="",this.defaultObjectAttributeViewClass="",this.defaultObjectAttributeBlockView="",this.defaultTypeAttributeView={},this.OAVComponent={},this.OBVComponent={},this.OVComponent={}}return t.prototype.setDefaultTypeAttributeView=function(t,e){this.defaultTypeAttributeView[t]=e},t.prototype.getObjectView=function(t,e){var n={autocreate:!0,excludeAttrs:[]};Object.assign(n,e);var i=this.getObjectInfo(t,n.autocreate,n.excludeAttrs);i.editable=void 0===i.editable||i.editable,Object.assign(i,e),i.objectAttributeInfos=i.objectAttributeInfos.filter((function(t){return!t.exclude})),i.objectBlockInfos.forEach((function(t){t.itemList=t.itemList.filter((function(t){return!t.exclude}))})),i.objectAttributeInfos.forEach((function(t){t.editable=t.editable&&i.editable})),(h(i.component)||""===i.component)&&(i.owner instanceof Object?i.component=this.defaultObjectViewClass:i.component=this.defaultBaseObjectViewClass);var r=this.OVComponent[i.component];return console.assert(null!==r,"没有定义 "+i.component+" 对应的对象界面类，需要在 "+i.component+" 中使用@OVComponent()标记"),new r(i)},t.prototype.getAttributeView=function(t){if(h(t.component)||""===t.component){var e=this.defaultTypeAttributeView[t.type],n=e?e.component:"";null!==n&&""!==n&&(t.component=e.component,t.componentParam=e.componentParam||t.componentParam)}(h(t.component)||""===t.component)&&(t.component=this.defaultObjectAttributeViewClass);var i=this.OAVComponent[t.component];return console.assert(null!==i,"没有定义 "+t.component+" 对应的属性界面类，需要在 "+t.component+" 中使用@OVAComponent()标记"),new i(t)},t.prototype.getBlockView=function(t){(h(t.component)||""===t.component)&&(t.component=this.defaultObjectAttributeBlockView);var e=this.OBVComponent[t.component];return console.assert(null!==e,"没有定义 "+t.component+" 对应的块界面类，需要在 "+t.component+" 中使用@OVBComponent()标记"),new e(t)},t.prototype.addOAV=function(t,e,n){Object.getOwnPropertyDescriptor(t,l)||(t[l]={});var i=t[l]||{},r=i.attributeDefinitionVec=i.attributeDefinitionVec||[],o=Object.assign({name:e},n);r.push(o)},t.prototype.getObjectInfo=function(t,e,n){if(void 0===e&&(e=!0),void 0===n&&(n=[]),"string"==typeof t||"number"==typeof t||"boolean"==typeof t)return{objectAttributeInfos:[],objectBlockInfos:[],owner:t,component:"",componentParam:void 0};var i=function(t,e){void 0===e&&(e=!0);var n,i=[],r=t;for(;r;){var a=r[l];a&&i.push(a),r=r[c]}if(i.length>0){n={};for(var s=i.length-1;s>=0;s--)o(n,i[s])}else e&&(n=function(t,e){void 0===e&&(e=/(([a-zA-Z0-9])+|(\d+))/);var n=[];for(var i in t){var r=e.exec(i);if(r&&r[0]===i){var o=t[i];if(void 0===o||o instanceof Function)continue;n.push(i)}}n=n.sort();var a=[];return n.forEach((function(t){a.push({name:t,block:""})})),{component:"",attributeDefinitionVec:a,blockDefinitionVec:[]}}(t));return n}(t,e),r=[];function p(t){return h(t)?"null":"number"==typeof t?"number":t.constructor.name}return(i=i||{component:"",componentParam:null,attributeDefinitionVec:[],blockDefinitionVec:[]}).attributeDefinitionVec.forEach((function(e){if(-1===n.indexOf(e.name)){var i=void 0===e.editable||e.editable;i=i&&function(t,e){var n=s(t,e);if(!n)return!1;if(n.get&&!n.set)return!1;return!0}(t,e.name);var o={owner:t,type:p(t[e.name])};Object.assign(o,e),o.editable=i,r.push(o)}})),r.forEach((function(t,e){t[u]=e})),r.sort((function(t,e){return(t.priority||0)-(e.priority||0)||t[u]-e[u]})),r.forEach((function(t,e){delete t[u]})),{objectAttributeInfos:r,objectBlockInfos:a(t,r,i.blockDefinitionVec),owner:t,component:i.component,componentParam:i.componentParam}},t}(),r=new i;function o(t,e){e.component&&e.component.length>0&&(t.component=e.component,t.componentParam=e.componentParam),t.attributeDefinitionVec=t.attributeDefinitionVec||[],e.attributeDefinitionVec&&e.attributeDefinitionVec.length>0&&e.attributeDefinitionVec.forEach((function(e){var n=!1;if(t.attributeDefinitionVec.forEach((function(i){if(e&&i.name===e.name){Object.assign(i,e);var r=t.attributeDefinitionVec.indexOf(i);t.attributeDefinitionVec.splice(r,1),t.attributeDefinitionVec.push(i),n=!0}})),!n){var i={};Object.assign(i,e),t.attributeDefinitionVec.push(i)}})),t.blockDefinitionVec=t.blockDefinitionVec||[],e.blockDefinitionVec&&e.blockDefinitionVec.length>0&&e.blockDefinitionVec.forEach((function(e){var n=!1;if(t.blockDefinitionVec.forEach((function(t){e&&e.name===t.name&&(Object.assign(t,e),n=!0)})),!n){var i={};Object.assign(i,e),t.blockDefinitionVec.push(i)}}))}function a(t,e,n){var i,r,o=[],a={},s=0,u=[];for(s=0;s<e.length;s++){var c=e[s].block||"";h(i=a[c])&&(i=a[c]={name:c,owner:t,itemList:[]},u.push(i)),i.itemList.push(e[s])}var l={};if(n)for(s=0;s<n.length;s++)h(i=a[(r=n[s]).name])&&(i={name:r.name,owner:t,itemList:[]}),i.component=r.component,i.componentParam=r.componentParam,o.push(i),l[i.name]=!0;for(s=0;s<u.length;s++)!1===Boolean(l[u[s].name])&&o.push(u[s]);return o}function s(t,e){var n=Object.getOwnPropertyDescriptor(t,e);if(n)return n;var i=Object.getPrototypeOf(t);return i?s(i,e):void 0}var u="___tempI",c="__proto__",l="__objectview__";function h(t){return null==t}Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{configurable:!0,enumerable:!1,value:function(t,e){for(var n=e,i=this.length;n<i;n++)if(t===this[n])return!0;return!1},writable:!0});var p=function(){function t(){}return t.equal=function(t,e){if(t.length!==e.length)return!1;for(var n=Object.keys(e),i=0,r=n.length;i<r;i++){var o=n[i];if(t[o]!==e[o])return!1}return!0},t.concatToSelf=function(t){for(var e=arguments,n=[],i=1;i<arguments.length;i++)n[i-1]=e[i];var r=[];return n.forEach((function(t){r=r.concat(t)})),r.forEach((function(e){return t.push(e)})),t},t.unique=function(t,e){void 0===e&&(e=function(t,e){return t===e});for(var n=Object.keys(t).map((function(t){return Number(t)})).filter((function(t){return!isNaN(t)})),i={},r=0,o=n.length;r<o;r++){var a=n[r];if(!i[a])for(var s=r+1;s<o;s++){var u=n[s];e(t[a],t[u])&&(i[u]=!0)}}for(r=n.length-1;r>=0;r--){var c=n[r];i[c]&&t.splice(c,1)}return t},t.replace=function(t,e,n,i){void 0===i&&(i=!0);for(var r=!1,o=0;o<t.length;o++)if(t[o]===e){t[o]=n,r=!0;break}return!r&&i&&t.push(n),t},t.create=function(t,e){for(var n=[],i=0;i<t;i++)n[i]=e(i);return n},t.binarySearch=function(e,n,i,r,o){var a=t.binarySearchInsert(e,n,i,r,o);return e[a]===n?a:-1},t.binarySearchInsert=function(e,n,i,r,o){if(void 0===r&&(r=0),void 0===o&&(o=e.length),r===o)return r;if(0===i(e[r],n))return r;var a=~~((r+o)/2);return i(e[a],n)<0?r=a+1:o=a,t.binarySearchInsert(e,n,i,r,o)},t.isUnique=function(t,e){void 0===e&&(e=function(t,e){return t===e});for(var n=t.length-1;n>=0;n--)for(var i=0;i<n;i++)if(e(t[n],t[i]))return!1;return!0},t.deleteItem=function(t,e){var n=t.indexOf(e);return-1!==n&&t.splice(n,1),n},t}(),f=function(){function t(){}return t.isBaseType=function(t){return null==t||"boolean"==typeof t||"string"==typeof t||"number"==typeof t},t.runFunc=function(t,e){return e(t),t},t.isObject=function(t){return"Object"===(null==t?void 0:t.constructor.name)},t.getPropertyValue=function(e,n){"string"==typeof n&&(n=n.split("."));for(var i=e,r=n.length,o=0;o<r;o++){if(t.objectIsEmpty(i))return;i=i[n[o]]}return i},t.getPropertyChains=function(e){for(var n=[],i=Object.keys(e),r=new Array(i.length).fill(e),o=new Array(i.length).fill(-1),a=0,s=function(){var e=r[a],s=i[a],u=e[s],c=void 0;if(t.objectIsEmpty(u)||t.isBaseType(u)||0===(c=Object.keys(u)).length){for(var l=[s],h=a;-1!==(h=o[h]);)l.push(i[h]);l.reverse(),n.push(l.join("."))}else c.forEach((function(t){i.push(t),r.push(u),o.push(a)}));a++};a<i.length;)s();return n},t.assignShallow=function(e,n){return t.objectIsEmpty(n)||Object.keys(n).forEach((function(t){e[t]=n[t]})),e},t.assignDeep=function(e,n,i,r){if(void 0===i&&(i=[]),void 0===r&&(r=Number.MAX_SAFE_INTEGER),t.objectIsEmpty(n))return e;if(r<1)return e;var o=Object.keys(n),a=i.concat(t.assignDeepDefaultHandlers);return o.forEach((function(t){for(var o=0;o<a.length;o++)if(a[o](e,n,t,i,r))return;e[t]=n[t]})),e},t.equalDeep=function(e,n){if(e===n)return!0;if(t.isBaseType(e)||t.isBaseType(n))return e===n;if("function"==typeof e||"function"==typeof n)return e===n;var i=Object.keys(e),r=Object.keys(n);if(!p.equal(i,r))return!1;if(Array.isArray(e)&&Array.isArray(n))return e.length===n.length;for(var o=0;o<i.length;o++){var a=i[o];if(!t.equalDeep(e[a],n[a]))return!1}return!0},t.objectIsEmpty=function(t){return null==t},t.getPropertyDescriptor=function(e,n){var i=Object.getOwnPropertyDescriptor(e,n);if(i)return i;var r=Object.getPrototypeOf(e);return r?t.getPropertyDescriptor(r,n):void 0},t.propertyIsWritable=function(e,n){var i=t.getPropertyDescriptor(e,n);return!!i&&!(i.get&&!i.set)},t.assignDeepDefaultHandlers=[function(t,e,n){return t[n]===e[n]},function(e,n,i){return!(!t.isBaseType(e[i])&&!t.isBaseType(n[i]))&&(e[i]=n[i],!0)},function(e,n,i,r,o){return!(!Array.isArray(n[i])&&!t.isObject(n[i]))&&(t.assignDeep(e[i],n[i],r,o-1),!0)}],t}(),d="__class__",m=function(){function t(){this.classUtilsHandlers=[],this.defaultInstMap={}}return t.prototype.getQualifiedClassName=function(t){if(f.objectIsEmpty(t))return"null";var e=y.classUtilsHandlers;e&&e.forEach((function(e){e(t)}));var n=t.prototype?t.prototype:Object.getPrototypeOf(t);if(n.hasOwnProperty(d))return n.__class__;var i=n.constructor.name;if(globalThis[i]===n.constructor)return i;for(var r=0;r<g.length;r++){var o=g[r]+"."+i;if(this.getDefinitionByName(o)===n.constructor)return i=o,_(n.constructor,i),i}return console.warn("未在给出的命名空间 "+g+" 内找到 "+t+"-"+i+" 的定义"),i},t.prototype.getDefinitionByName=function(t,e){if(void 0===e&&(e=!0),"null"===t)return null;if(!t)return null;if(globalThis[t])return globalThis[t];if(e&&v[t])return v[t];for(var n=t.split("."),i=n.length,r=globalThis,o=0;o<i;o++){if(!(r=r[n[o]]))return null}return v[t]=r,r},t.prototype.getDefaultInstanceByName=function(t){if(void 0===t)return null;var e=this.defaultInstMap[t];return e||(e=this.defaultInstMap[t]=this.getInstanceByName(t),Object.freeze(e),e)},t.prototype.getInstanceByName=function(t){var e=this.getDefinitionByName(t);return console.assert(e,"无法获取名称为 "+t+" 的实例!"),this.getInstanceByDefinition(e)},t.prototype.getInstanceByDefinition=function(t){if(console.assert(!!t),t)return t.__create__?t.__create__():new t},t.prototype.addClassNameSpace=function(t){-1===g.indexOf(t)&&g.push(t)},t}(),y=new m,v={},g=["feng3d"];function _(t,e){var n=t.prototype;e||(e=n.constructor.name),v[e]=t,Object.defineProperty(n,d,{value:e,writable:!0,enumerable:!1})}var b=function(){function t(){}return t.prototype.blobToArrayBuffer=function(t,e){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.readAsArrayBuffer(t)},t.prototype.arrayBufferToBlob=function(t){return new Blob([t])},t.prototype.arrayBufferToUint8=function(t){return new Uint8Array(t)},t.prototype.uint8ToArrayBuffer=function(t){return t.buffer},t.prototype.arrayToArrayBuffer=function(t){return new Uint8Array(t).buffer},t.prototype.uint8ArrayToArray=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e},t.prototype.canvasToDataURL=function(t,e,n){return void 0===e&&(e="png"),void 0===n&&(n=1),"png"===e?t.toDataURL("image/png"):t.toDataURL("image/jpeg",n)},t.prototype.canvasToImage=function(t,e,n,i){void 0===e&&(e="png"),void 0===n&&(n=1);var r=this.canvasToDataURL(t,e,n);this.dataURLToImage(r,i)},t.prototype.blobToDataURL=function(t,e){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.readAsDataURL(t)},t.prototype.dataURLtoBlob=function(t){for(var e=t.split(","),n=e[0].match(/:(.*?);/)[1],i=atob(e[1]),r=i.length,o=new Uint8Array(r);r--;)o[r]=i.charCodeAt(r);return new Blob([o],{type:n})},t.prototype.dataURLDrawCanvas=function(t,e,n){this.dataURLToImage(t,(function(t){n(t)}))},t.prototype.dataURLToArrayBuffer=function(t,e){var n=this.dataURLtoBlob(t);this.blobToArrayBuffer(n,e)},t.prototype.arrayBufferToDataURL=function(t,e){var n=this.arrayBufferToBlob(t);this.blobToDataURL(n,e)},t.prototype.dataURLToImage=function(t,e){var n=new Image;n.onload=function(){e(n)},n.src=t},t.prototype.imageToDataURL=function(t,e){void 0===e&&(e=1);var n=this.imageToCanvas(t);return this.canvasToDataURL(n,"png",e)},t.prototype.imageToCanvas=function(t){var e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),e},t.prototype.imageToArrayBuffer=function(t,e){if(t.arraybuffer)e(t.arraybuffer);else{var n=this.imageToDataURL(t);this.dataURLToArrayBuffer(n,(function(n){t.arraybuffer=n,n.image=t,e(n)}))}},t.prototype.imageDataToDataURL=function(t,e){void 0===e&&(e=1);var n=this.imageDataToCanvas(t);return this.canvasToDataURL(n,"png",e)},t.prototype.imageDataToCanvas=function(t){var e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").putImageData(t,0,0),e},t.prototype.imagedataToImage=function(t,e,n){void 0===e&&(e=1);var i=this.imageDataToDataURL(t,e);this.dataURLToImage(i,n)},t.prototype.arrayBufferToImage=function(t,e){var n=this;t.image?e(t.image):this.arrayBufferToDataURL(t,(function(i){n.dataURLToImage(i,(function(n){n.arraybuffer=t,t.image=n,e(n)}))}))},t.prototype.blobToText=function(t,e){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.readAsText(t)},t.prototype.stringToArrayBuffer=function(t){var e=this.stringToUint8Array(t);return this.uint8ToArrayBuffer(e)},t.prototype.arrayBufferToString=function(t,e){var n=this.arrayBufferToBlob(t);this.blobToText(n,e)},t.prototype.arrayBufferToObject=function(t,e){this.arrayBufferToString(t,(function(t){var n=JSON.parse(t);e(n)}))},t.prototype.stringToUint8Array=function(t){var e=unescape(encodeURIComponent(t));return new Uint8Array(e.split("").map((function(t){return t.charCodeAt(0)})))},t.prototype.uint8ArrayToString=function(t,e){var n=[].slice.apply(t).map((function(t){return String.fromCharCode(t)})).join("");e(decodeURIComponent(escape(n)))},t}(),x=new b,w=function(){function t(){}return t.getKeys=function(t){var e=[];return t.forEach((function(t,n){e.push(n)})),e},t.getValues=function(t){var e=[];return t.forEach((function(t,n){e.push(t)})),e},t}(),S=function(){function t(){this.DEG2RAD=Math.PI/180,this.RAD2DEG=180/Math.PI,this.PRECISION=1e-6,this.uuid=function(t){void 0===t&&(t=36);var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=new Array(t),i=0,r=0;return function(){for(var o=0;o<t;o++)8===o||13===o||18===o||23===o?n[o]="-":14===o?n[o]="4":(i<=2&&(i=33554432+16777216*Math.random()|0),r=15&i,i>>=4,n[o]=e[19===o?3&r|8:r]);return n.join("")}}()}return t.prototype.clamp=function(t,e,n){return(t-e)*(t-n)<=0?t:t<e?e<n?e:n:e>n?e:n},t.prototype.uclideanModulo=function(t,e){return(t%e+e)%e},t.prototype.mapLinear=function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},t.prototype.lerp=function(t,e,n){return(1-n)*t+n*e},t.prototype.smoothstep=function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},t.prototype.smootherstep=function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},t.prototype.randInt=function(t,e){return t+Math.floor(Math.random()*(e-t+1))},t.prototype.randFloat=function(t,e){return t+Math.random()*(e-t)},t.prototype.randFloatSpread=function(t){return t*(.5-Math.random())},t.prototype.degToRad=function(t){return t*this.DEG2RAD},t.prototype.radToDeg=function(t){return t*this.RAD2DEG},t.prototype.isPowerOfTwo=function(t){return 0==(t&t-1)&&0!==t},t.prototype.nearestPowerOfTwo=function(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))},t.prototype.nextPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},t.prototype.toRound=function(t,e,n){return void 0===n&&(n=360),t+Math.round((e-t)/n)*n},t.prototype.equals=function(t,e,n){return void 0===n&&(n=this.PRECISION),Math.abs(t-e)<n},t.prototype.gcd=function(t,e){if(e)for(;(t%=e)&&(e%=t););return t+e},t.prototype.lcm=function(t,e){return t*e/this.gcd(t,e)},t}(),P=new S,M={getvalue:function(t){return"function"==typeof t?t():t}};function C(t,e){Object.getOwnPropertyDescriptor(t,L)||Object.defineProperty(t,L,{value:[]}),t[L].push(e)}function T(t,e,n,i){for(var r=i.handlers,o=0;o<r.length;o++)if(r[o](t,e,n,i))return!0;return!0}var A=function(){function t(){this.omitDefault=!0,this.serializeHandlers=[],this.deserializeHandlers=[],this.differentHandlers=[],this.setValueHandlers=[]}return t.prototype.serialize=function(t){var e=this.serializeHandlers.sort((function(t,e){return e.priority-t.priority})).map((function(t){return t.handler})),n={handlers:e,serialization:this,root:t,serializedMap:new Map,autoRefID:1},i={};return T(i,{__root__:t},j,n),i[j]},t.prototype.deleteClassKey=function(t){if(!f.isBaseType(t))for(var e in delete t.__class__,t)this.deleteClassKey(t[e])},t.prototype.deserialize=function(t){var e=this.deserializeHandlers.sort((function(t,e){return e.priority-t.priority})).map((function(t){return t.handler})),n={handlers:e,serialization:this,refs:{}},i={};T(i,{__root__:t},j,n);var r=i[j];return Object.keys(n.refs).forEach((function(t){var e=n.refs[t],i=e.target[e.property];delete i[I],delete i[D],e.refs.forEach((function(t){t.target[t.property]=i}))})),r},t.prototype.different=function(t,e){var n=this.differentHandlers.sort((function(t,e){return e.priority-t.priority})).map((function(t){return t.handler})),i={__root__:{}};return T({__root__:t},{__root__:e},j,{different:i,handlers:n,serialization:this}),i[j]},t.prototype.setValue=function(t,e){if(f.isBaseType(e)||t===e)return t;var n=this.setValueHandlers.sort((function(t,e){return e.priority-t.priority})).map((function(t){return t.handler}));return T({__root__:t},{__root__:e},j,{handlers:n,serialization:this}),t},t.prototype.clone=function(t){return this.deserialize(this.serialize(t))},t}();function O(t,e){e=e||[],t[R]&&O(t[R],e);var n=t[L];return n&&p.concatToSelf(e,n),p.unique(e),e}var E=new A;E.serializeHandlers.push({priority:0,handler:function(t,e,n){var i=e[n];return!!f.isBaseType(i)&&(t[n]=i,!0)}},{priority:0,handler:function(t,e,n,i){var r=e[n],o=i.serializedMap;if(o.has(r)){var a=i.serializedMap.get(r),s=a.target[a.property];if(!f.isBaseType(s)){s[D]||(s[D]=i.autoRefID++,s[I]=!0);var u={};return u[D]=s[D],u[z]=!0,t[n]=u,!0}}else o.set(r,{target:t,property:n});return!1}},{priority:0,handler:function(t,e,n){var i=e[n];if(i&&"function"==typeof i){var r={__class__:"function"};return r.data=i.toString(),t[n]=r,!0}return!1}},{priority:0,handler:function(t,e,n){var i=e[n];return!(!i||!1!==i.serializable)}},{priority:0,handler:function(t,e,n){var i=e[n];if(i&&i.serialize){var r={};return t[n]=r,r.__class__=y.getQualifiedClassName(i),i.serialize(r),!0}return!1}},{priority:0,handler:function(t,e,n,i){var r=e[n];if(Array.isArray(r)){var o=t[n]||[];return t[n]=o,Object.keys(r).forEach((function(t){T(o,r,t,i)})),!0}return!1}},{priority:0,handler:function(t,e,n,i){var r=e[n];if(f.isObject(r)){var o={};return t[n]=o,Object.keys(r).forEach((function(t){T(o,r,t,i)})),!0}return!1}},{priority:-1e4,handler:function(t,e,n,i){var r=t[n],o=e[n];if(!i.serialization.omitDefault){var a={};t[n]=a;var s=y.getQualifiedClassName(o);return O(o).forEach((function(t){T(a,o,t,i)})),a.__class__=s,!0}if(f.objectIsEmpty(r)||r.constructor!==o.constructor){s=y.getQualifiedClassName(o);var u=o.constructor.inst;u||(u=o.constructor.inst=new o.constructor),u instanceof o.constructor||(u=o.constructor.inst=new o.constructor),(c=i.serialization.different(o,u)).__class__=s,t[n]=c}else{var c;(c=i.serialization.different(o,r))&&(t[n]=c)}return!0}}),E.deserializeHandlers=[{priority:0,handler:function(t,e,n){var i=e[n];return!!f.isBaseType(i)&&(t[n]=i,!0)}},{priority:0,handler:function(t,e,n,i){var r=e[n],o=i.refs;if(void 0!==r[D]){var a=r[D],s=o[a]=o[a]||{refs:[],target:null,property:null};if(!r[I])return s.refs.push({target:t,property:n}),!0;s.target=t,s.property=n}return!1}},{priority:0,handler:function(t,e,n){var i=e[n];return!(!i||"function"!==i.__class__)&&(console.warn("不支持序列化 function "+i.data),!0)}},{priority:0,handler:function(t,e,n){var i=e[n];return!f.isObject(i)&&!Array.isArray(i)&&(t[n]=i,!0)}},{priority:0,handler:function(t,e,n,i){var r=e[n];if(Array.isArray(r)){var o=t[n]||[];return Object.keys(r).forEach((function(t){T(o,r,t,i)})),t[n]=o,!0}return!1}},{priority:0,handler:function(t,e,n,i){var r=t[n],o=e[n];if(f.isObject(o)&&f.objectIsEmpty(o.__class__)){var a={};return r&&(a=r),Object.keys(o).forEach((function(t){T(a,o,t,i)})),t[n]=a,!0}return!1}},{priority:0,handler:function(t,e,n){var i=t[n],r=e[n],o=y.getInstanceByName(r.__class__);if(o&&o.deserialize){i&&i.constructor===o.constructor&&(o=i);var a=o.deserialize(r);return a&&(o=a),t[n]=o,!0}return!1}},{priority:-1e4,handler:function(t,e,n,i){var r=t[n],o=e[n],a=y.getInstanceByName(o.__class__);return a?(r&&r.constructor===a.constructor&&(a=r),Object.keys(o).forEach((function(t){t!==d&&T(a,o,t,i)})),t[n]=a,!0):(console.warn("未处理"),!1)}}],E.differentHandlers=[{priority:0,handler:function(t,e,n){return t[n]===e[n]}},{priority:0,handler:function(t,e,n,i){return!!f.objectIsEmpty(e[n])&&(i.different[n]=i.serialization.serialize(t[n]),!0)}},{priority:0,handler:function(t,e,n,i){var r=t[n];return!!f.isBaseType(r)&&(i.different[n]=r,!0)}},{priority:0,handler:function(t,e,n,i){var r=i.different,o=t[n],a=e[n];if(Array.isArray(o)){var s=Object.keys(o),u=[],c={different:u,handlers:i.handlers,serialization:i.serialization};return s.forEach((function(t){T(o,a,t,c)})),Object.keys(u).length>0&&(r[n]=u),!0}return!1}},{priority:0,handler:function(t,e,n,i){var r=t[n];return e[n].constructor!==r.constructor&&(i.different[n]=i.serialization.serialize(r),!0)}},{priority:-1e4,handler:function(t,e,n,i){var r=i.different,o=t[n],a=e[n],s=O(o);o.constructor===Object&&(s=Object.keys(o));var u={},c={different:u,handlers:i.handlers,serialization:i.serialization};return s.forEach((function(t){T(o,a,t,c)})),Object.keys(u).length>0&&(r[n]=u),!0}}],E.setValueHandlers=[{priority:0,handler:function(t,e,n,i){return t[n]===e[n]}},{priority:0,handler:function(t,e,n,i){var r=t[n],o=e[n];return!!f.objectIsEmpty(r)&&(t[n]=i.serialization.deserialize(o),!0)}},{priority:0,handler:function(t,e,n){var i=e[n];return!!f.isBaseType(i)&&(t[n]=i,!0)}},{priority:0,handler:function(t,e,n,i){var r=t[n],o=e[n];return!!Array.isArray(o)&&(console.assert(!!r),Object.keys(o).forEach((function(t){T(r,o,t,i)})),t[n]=r,!0)}},{priority:0,handler:function(t,e,n,i){var r=e[n];return!f.isObject(r)&&(t[n]=i.serialization.deserialize(r),!0)}},{priority:0,handler:function(t,e,n,i){var r=t[n],o=e[n];return!(!f.isObject(o)||void 0!==o.__class__)&&(console.assert(!!r),Object.keys(o).forEach((function(t){T(r,o,t,i)})),t[n]=r,!0)}},{priority:-1e4,handler:function(t,e,n,i){var r=t[n],o=e[n];y.getQualifiedClassName(t[n])===o.__class__?(Object.keys(o).forEach((function(t){T(r,o,t,i)})),t[n]=r):t[n]=i.serialization.deserialize(o);return!0}}],[Float32Array,Float64Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Uint8ClampedArray].forEach((function(t){t.prototype.serialize=function(t){return t.value=Array.from(this),t},t.prototype.deserialize=function(t){return new this.constructor(t.value)}}));var D="__serialize__Ref__",z="__serialize__IsRef__",I="__serialize__IsRaw__",j="__root__",R="__proto__",L="_serialize__";function N(t){return function(e,n){var i="_"+n;console.assert(e[t],"在对象 "+e+" 上找不到方法 "+t),Object.defineProperty(e,n,{get:function(){return this[i]},set:function(e){if(this[i]!==e){var r=this[i];this[i]=e,this[t](n,r,e)}},enumerable:!0,configurable:!0})}}var F=function(){function t(){this._binds=[]}return t.prototype.watch=function(t,e,n,i){Object.getOwnPropertyDescriptor(t,B)||Object.defineProperty(t,B,{value:{},enumerable:!1,configurable:!0,writable:!1});var r=e,o=t[B];if(!o[r]){var a=Object.getOwnPropertyDescriptor(t,r);o[r]={value:t[r],oldPropertyDescriptor:a,handlers:[]};var s=U(t,r);if(s&&s.set&&s.get){var u=(s={enumerable:s.enumerable,configurable:!0,get:s.get,set:s.set}).set;s.set=function(t){var e=this[r];e!==t&&(u&&u.call(this,t),W(t,e,this,r))}}else{if(s&&(s.get||s.set))return void console.warn("watch "+t+" . "+r+" 失败！");(s={enumerable:!0,configurable:!0}).get=function(){return this[B][r].value},s.set=function(t){var e=this[B][r].value;e!==t&&(this[B][r].value=t,W(t,e,this,r))}}Object.defineProperty(t,r,s)}var c=o[r];c.handlers.reduce((function(t,e){return t||e.handler===n&&e.thisObject===i}),!1)||c.handlers.push({handler:n,thisObject:i})},t.prototype.unwatch=function(t,e,n,i){var r=t[B];if(r){var o=e;if(r[o]){var a=r[o].handlers;void 0===n&&(a.length=0);for(var s=a.length-1;s>=0;s--)a[s].handler!==n||a[s].thisObject!==i&&void 0!==i||a.splice(s,1);if(0===a.length){var u=t[o];delete t[o],r[o].oldPropertyDescriptor&&Object.defineProperty(t,o,r[o].oldPropertyDescriptor),t[o]=u,delete r[o]}0===Object.keys(r).length&&delete t[B]}}},t.prototype.bind=function(t,e,n,i){var r=function(){n[i]=t[e]},o=function(){t[e]=n[i]};this.watch(t,e,r),this.watch(n,i,o),this._binds.push([t,e,r,n,i,o])},t.prototype.unbind=function(t,e,n,i){for(var r=this._binds,o=r.length-1;o>=0;o--){var a=r[o];if((a[1]===e&&a[4]===i||a[1]===i&&a[4]===e)&&(a[0]===t&&a[3]===n||a[0]===n&&a[3]===t)){this.unwatch(a[0],a[1],a[2]),this.unwatch(a[3],a[4],a[5]),r.splice(o,1);break}}},t.prototype.watchchain=function(t,e,n,i){var r=this,o=e.indexOf(".");if(-1!==o){Object.getOwnPropertyDescriptor(t,V)||Object.defineProperty(t,V,{value:{},enumerable:!1,writable:!1,configurable:!0});var a=t[V];a[e]||(a[e]=[]);var s=a[e];if(!s.reduce((function(t,e){return t||e.handler===n&&e.thisObject===i}),!1)){var u=e.substr(0,o),c=e.substr(o+1);t[u]&&this.watchchain(t[u],c,n,i);var l=function(t,e){e&&r.unwatchchain(e,c,n,i),t&&r.watchchain(t,c,n,i);var o=H(e,c),a=H(t,c);o!==a&&n.call(i,a,o,t,c)};this.watch(t,u,l),s.push({handler:n,thisObject:i,watchchainFun:l})}}else this.watch(t,e,n,i)},t.prototype.unwatchchain=function(t,e,n,i){var r=e.indexOf(".");if(-1!==r){var o=e.substr(0,r),a=e.substr(r+1),s=t[V];if(s&&s[e]){for(var u=s[e],c=u.length-1;c>=0;c--){var l=u[c];(G(n)||n===l.handler&&i===l.thisObject)&&(t[o]&&this.unwatchchain(t[o],a,l.handler,l.thisObject),this.unwatch(t,o,l.watchchainFun),u.splice(c,1))}0===u.length&&delete s[e],0===Object.keys(s).length&&delete t[V]}}else this.unwatch(t,e,n,i)},t.prototype.watchobject=function(t,e,n,i){var r=this;K(e).forEach((function(e){r.watchchain(t,e,n,i)}))},t.prototype.unwatchobject=function(t,e,n,i){var r=this;K(e).forEach((function(e){r.unwatchchain(t,e,n,i)}))},t}(),k=new F,B="__watchs__",V="__watchchains__";function W(t,e,n,i){n[B][i].handlers.forEach((function(r){r.handler.call(r.thisObject,t,e,n,i)}))}function U(t,e){var n=Object.getOwnPropertyDescriptor(t,e);if(n)return n;var i=Object.getPrototypeOf(t);return i?U(i,e):void 0}function G(t){return null==t}function H(t,e){"string"==typeof e&&(e=e.split("."));for(var n=t,i=0;i<e.length;i++){if(G(n))return;n=n[e[i]]}return n}function K(t){for(var e=[],n=Object.keys(t),i=new Array(n.length).fill(t),r=new Array(n.length).fill(-1),o=0,a=function(){var t=i[o],a=n[o],s=t[a],u=void 0;if(G(s)||function(t){if(null==t||"boolean"==typeof t||"string"==typeof t||"number"==typeof t)return!0;return!1}(s)||0===(u=Object.keys(s)).length){for(var c=[a],l=o;-1!==(l=r[l]);)c.push(n[l]);c.reverse(),e.push(c.join("."))}else u.forEach((function(t){n.push(t),i.push(s),r.push(o)}));o++};o<n.length;)a();return e}var X=function(){function t(e){void 0===e&&(e=this),console.assert(!t.targetEmitterMap.has(e),"同一个 "+e+" 对象无法对应两个 EventEmitter！"),t.targetEmitterMap.set(e,this),t.emitterTargetMap.set(this,e)}return t.getEventEmitter=function(e){return console.assert(null!=e,"被监听对象无法为undefined或者null！"),e instanceof t?e:this.targetEmitterMap.get(e)},t.getOrCreateEventEmitter=function(e){var n=this.getEventEmitter(e);return n||(n=new t(e)),n},t.prototype.eventNames=function(){return Object.keys(t.emitterListenerMap.get(this))},t.prototype.listenerCount=function(e){var n,i;return(null===(i=null===(n=t.emitterListenerMap.get(this))||void 0===n?void 0:n[e])||void 0===i?void 0:i.length)||0},t.prototype.once=function(t,e,n,i){return void 0===i&&(i=0),this.on(t,e,n,i,!0),this},t.prototype.emitEvent=function(e){var n=t.emitterTargetMap.get(this);if(-1!==e.targets.indexOf(n))return e;var i=t.getOrCreateEventEmitter(n);return i.handleEvent(e),i.handelEventShare(e),i.handelEventBubbles(e),i.handelEventBroadcast(e),e},t.prototype.emit=function(t,e,n,i,r){void 0===n&&(n=!1),void 0===i&&(i=!1),void 0===r&&(r=!0);var o={type:t,data:e,share:r,bubbles:n,broadcast:i,target:void 0,currentTarget:void 0,isStopShare:!1,isStopBubbles:!1,isStopBroadcast:!1,isStopTransmit:!1,isStop:!1,targets:[],handles:[]};return this.emitEvent(o),o},t.prototype.broadcast=function(t,e){return this.emit(t,e,!1,!0)},t.prototype.bubbles=function(t,e){return this.emit(t,e,!0,!1)},t.prototype.has=function(t){return this.listenerCount(t)>0},t.prototype.on=function(e,n,i,r,o){if(void 0===r&&(r=0),void 0===o&&(o=!1),null===n)return this;var a=t.emitterListenerMap.get(this);a||(a={__anyEventType__:[]},t.emitterListenerMap.set(this,a)),i=i||this;var s=a[e]=a[e]||[],u=0;for(u=0;u<s.length;u++){var c=s[u];if(c.listener===n&&c.thisObject===i){s.splice(u,1);break}}return s.push({listener:n,thisObject:i,priority:r,once:o}),this},t.prototype.off=function(e,n,i){if(!e)return t.emitterListenerMap.delete(this),this;var r=t.emitterListenerMap.get(this);if(!r)return this;if(!n)return delete r[e],this;i=i||this;var o=r[e];if(o){for(var a=o.length-1;a>=0;a--){var s=o[a];if(s.listener===n&&s.thisObject===i){o.splice(a,1);break}}0===o.length&&delete r[e]}return this},t.prototype.offAll=function(t){return this.off(t),this},t.prototype.onAny=function(e,n,i,r){void 0===i&&(i=0),void 0===r&&(r=!1);var o=t.emitterListenerMap.get(this);o||(o={__anyEventType__:[]},t.emitterListenerMap.set(this,o));var a=o.__anyEventType__,s=0;for(s=0;s<a.length;s++){var u=a[s];if(u.listener===e&&u.thisObject===n){a.splice(s,1);break}}return a.push({listener:e,thisObject:n,priority:i,once:r}),this},t.prototype.offAny=function(e,n){var i=t.emitterListenerMap.get(this);if(e){if(i)for(var r=i.__anyEventType__,o=r.length-1;o>=0;o--){var a=r[o];if(a.listener===e&&a.thisObject===n){r.splice(o,1);break}}return this}i&&(i.__anyEventType__.length=0)},t.prototype.handleEvent=function(e){var n=t.emitterTargetMap.get(this);e.target=e.target||n,e.currentTarget=n,e.targets.push(n);var i=t.emitterListenerMap.get(this);if(i){var r=i[e.type],o=[];if(r){r.forEach((function(t){return o.push(t)}));for(var a=r.length-1;a>=0;a--)r[a].once&&r.splice(a,1);0===r.length&&delete i[e.type]}if(r=i.__anyEventType__){r.forEach((function(t){return o.push(t)}));for(a=r.length-1;a>=0;a--)r[a].once&&r.splice(a,1)}o.sort((function(t,e){return e.priority-t.priority}));for(a=0;a<o.length&&!e.isStop;a++)o[a].listener.call(o[a].thisObject,e),e.handles.push(o[a])}},t.prototype.handelEventShare=function(e){if(e.share&&!e.isStopShare&&!e.isStop&&!e.isStopTransmit){var n=t.emitterTargetMap.get(this);if("function"==typeof(null==n?void 0:n.getShareTargets)){var i=n.getShareTargets();null==i||i.forEach((function(n){if(void 0!==n&&-1===e.targets.indexOf(n)){var i=t.getOrCreateEventEmitter(n);i.handleEvent(e),i.handelEventShare(e)}}))}}},t.prototype.handelEventBubbles=function(e){if(e.bubbles&&!e.isStopBubbles&&!e.isStop&&!e.isStopTransmit){var n=t.emitterTargetMap.get(this),i=[];"function"==typeof(null==n?void 0:n.getBubbleTargets)?i=n.getBubbleTargets():n.parent&&(i=[n.parent]),null==i||i.forEach((function(n){if(void 0!==n&&-1===e.targets.indexOf(n)){var i=t.getOrCreateEventEmitter(n);i.handleEvent(e),i.handelEventShare(e),i.handelEventBubbles(e)}}))}},t.prototype.handelEventBroadcast=function(e){if(e.broadcast&&!e.isStopBroadcast&&!e.isStop&&!e.isStopTransmit){var n=t.emitterTargetMap.get(this),i=[];"function"==typeof(null==n?void 0:n.getBroadcastTargets)?i=n.getBroadcastTargets():n.children&&Array.isArray(n.children)&&(i=n.children),null==i||i.forEach((function(n){if(void 0!==n&&-1===e.targets.indexOf(n)){var i=t.getOrCreateEventEmitter(n);i.handleEvent(e),i.handelEventShare(e),i.handelEventBroadcast(e)}}))}},t.targetEmitterMap=new Map,t.emitterTargetMap=new Map,t.emitterListenerMap=new Map,t}(),q=function(){function t(){}return t.prototype.eventNames=function(t){var e;return console.assert(null!=t,"被监听对象无法为undefined或者null！"),(null===(e=X.getEventEmitter(t))||void 0===e?void 0:e.eventNames())||[]},t.prototype.listenerCount=function(t,e){var n;return console.assert(null!=t,"被监听对象无法为undefined或者null！"),(null===(n=X.getEventEmitter(t))||void 0===n?void 0:n.listenerCount(e))||0},t.prototype.once=function(t,e,n,i,r){return void 0===i&&(i=null),void 0===r&&(r=0),console.assert(null!=t,"被监听对象无法为undefined或者null！"),X.getOrCreateEventEmitter(t).once(e,n,i,r),this},t.prototype.emitEvent=function(t,e){return console.assert(null!=t,"被监听对象无法为undefined或者null！"),X.getOrCreateEventEmitter(t).emitEvent(e),e},t.prototype.emit=function(t,e,n,i,r,o){return void 0===i&&(i=!1),void 0===r&&(r=!1),void 0===o&&(o=!0),console.assert(null!=t,"被监听对象无法为undefined或者null！"),X.getOrCreateEventEmitter(t).emit(e,n,i,r,o)},t.prototype.has=function(t,e){var n;return console.assert(null!=t,"被监听对象无法为undefined或者null！"),(null===(n=X.getEventEmitter(t))||void 0===n?void 0:n.has(e))||!1},t.prototype.on=function(t,e,n,i,r,o){return void 0===r&&(r=0),void 0===o&&(o=!1),console.assert(null!=t,"被监听对象无法为undefined或者null！"),X.getOrCreateEventEmitter(t).on(e,n,i,r,o),this},t.prototype.off=function(t,e,n,i){var r;return console.assert(null!=t,"被监听对象无法为undefined或者null！"),null===(r=X.getEventEmitter(t))||void 0===r||r.off(e,n,i),this},t.prototype.offAll=function(t,e){var n;return console.assert(null!=t,"被监听对象无法为undefined或者null！"),null===(n=X.getEventEmitter(t))||void 0===n||n.offAll(e),this},t.prototype.onAny=function(t,e,n,i,r){return void 0===i&&(i=0),void 0===r&&(r=!1),console.assert(null!=t,"被监听对象无法为undefined或者null！"),X.getOrCreateEventEmitter(t).onAny(e,n,i,r),this},t.prototype.offAny=function(t,e,n){var i;return console.assert(null!=t,"被监听对象无法为undefined或者null！"),null===(i=X.getEventEmitter(t))||void 0===i||i.offAny(e,n),this},t}(),Y=new q,Z=new X,Q=Y,J=function(){function t(){}return t.prototype.getSign=function(t){return t>0?"+":"-"},t.prototype.equalNumber=function(t,e,n){return void 0===n&&(n=1e-7),Math.abs(t-e)<n},t.prototype.getDerivative=function(t,e){return void 0===e&&(e=1e-9),function(n){return(t(n+e)-t(n))/e}},t.prototype.isContinuous=function(t){return!0},t.prototype.hasSolution=function(t,e,n,i){if(!this.isContinuous(t))return i&&i(new Error("函数 "+t+" 在 ["+e+" ,"+n+"] 区间内不连续，无法为其求解！")),!1;var r=t(e),o=t(n);return!(r*o>0)||(i&&i(new Error("f(a) * f(b) 值为 "+r*o+"，不满足 f(a) * f(b) <= 0，无法为其求解！")),!1)},t.prototype.binary=function(t,e,n,i,r){if(void 0===i&&(i=1e-7),this.hasSolution(t,e,n,r)){var o,a,s=t(e),u=t(n);if(this.equalNumber(s,0,i))return e;if(this.equalNumber(u,0,i))return n;do{s*(a=t(o=(e+n)/2))<0?(n=o,u=a):(e=o,s=a)}while(!this.equalNumber(a,0,i));return o}},t.prototype.line=function(t,e,n,i,r){if(void 0===i&&(i=1e-7),this.hasSolution(t,e,n,r)){var o,a,s=t(e),u=t(n);if(this.equalNumber(s,0,i))return e;if(this.equalNumber(u,0,i))return n;do{s*(a=t(o=e-s*(n-e)/(u-s)))<0?(n=o,u=a):(e=o,s=a)}while(!this.equalNumber(a,0,i));return o}},t.prototype.tangent=function(t,e,n,i,r,o,a){if(void 0===o&&(o=1e-7),this.hasSolution(t,i,r,a)){var s=t(i),u=t(r);if(this.equalNumber(s,0,o))return i;if(this.equalNumber(u,0,o))return r;var c=u-s,l=e(i),h=e(r);if(l*c<=0)a&&a(new Error("["+i+", "+r+"] 上存在解，由于f'("+i+") = "+l+" 在[a, b]上没有保持定号 "+this.getSign(c)+" ，无法使用切线法求解"));else if(h*c<=0)a&&a(new Error("["+i+", "+r+"] 上存在解，由于f'("+r+") = "+h+" 在[a, b]上没有保持定号 "+this.getSign(c)+" ，无法使用切线法求解"));else{var p=u-s,f=n(i),d=n(r);if(f*p<=0)a&&a(new Error("["+i+", "+r+"] 上存在解，由于f''("+i+") = "+f+" 在[a, b]上没有保持定号 "+this.getSign(p)+" ，无法使用切线法求解"));else{if(!(d*p<=0)){var m,y;m=c>0?p>0?r:i:p>0?i:r;do{y=t(m);var v=e(m),g=n(m);if(v*c<=0)return void(a&&a(new Error("["+i+", "+r+"] 上存在解，由于f'("+m+") = "+v+" 在[a, b]上没有保持定号 "+this.getSign(c)+" ，无法使用切线法求解")));if(g*p<=0)return void(a&&a(new Error("["+i+", "+r+"] 上存在解，由于f''("+m+") = "+g+" 在[a, b]上没有保持定号 "+this.getSign(p)+" ，无法使用切线法求解")));m-=y/v}while(!this.equalNumber(y,0,o));return m}a&&a(new Error("["+i+", "+r+"] 上存在解，由于f''("+r+") = "+d+" 在[a, b]上没有保持定号 "+this.getSign(p)+" ，无法使用切线法求解"))}}}},t.prototype.secant=function(t,e,n,i,r){if(void 0===i&&(i=1e-7),this.hasSolution(t,e,n,r)){var o=t(e),a=t(n);if(this.equalNumber(o,0,i))return e;if(this.equalNumber(a,0,i))return n;var s=this.getDerivative(t,i),u=this.getDerivative(s,i),c=a-o,l=s(e),h=s(n);if(l*c<=0)r&&r(new Error("["+e+", "+n+"] 上存在解，由于f'("+e+") = "+l+" 在[a, b]上没有保持定号 "+this.getSign(c)+" ，无法使用切线法求解"));else if(h*c<=0)r&&r(new Error("["+e+", "+n+"] 上存在解，由于f'("+n+") = "+h+" 在[a, b]上没有保持定号 "+this.getSign(c)+" ，无法使用切线法求解"));else{var p=a-o,f=u(e),d=u(n);if(f*p<=0)r&&r(new Error("["+e+", "+n+"] 上存在解，由于f''("+e+") = "+f+" 在[a, b]上没有保持定号 "+this.getSign(p)+" ，无法使用切线法求解"));else{if(!(d*p<=0)){var m,y=c>0?p>0?n:e:p>0?e:n,v=t(y),g=y-i*p/Math.abs(p),_=t(g);if(_*v<0)return g;do{var b=s(g);if(b*c<=0)return void(r&&r(new Error("["+e+", "+n+"] 上存在解，由于f'("+g+") = "+b+" 在[a, b]上没有保持定号 "+this.getSign(c)+" ，无法使用切线法求解")));var x=u(g);if(x*p<=0)return void(r&&r(new Error("["+e+", "+n+"] 上存在解，由于f''("+g+") = "+x+" 在[a, b]上没有保持定号 "+this.getSign(p)+" ，无法使用切线法求解")));m=g-_*(g-y)/(_-v),y=g,v=_,_=t(g=m)}while(!this.equalNumber(_,0,i));return g}r&&r(new Error("["+e+", "+n+"] 上存在解，由于f''("+n+") = "+d+" 在[a, b]上没有保持定号 "+this.getSign(p)+" ，无法使用切线法求解"))}}}},t}(),$=new J,tt=function(){function t(){}return t.prototype.linear=function(t,e,n){return e+t*(n-e)},t.prototype.linearDerivative=function(t,e,n){return n-e},t.prototype.linearSecondDerivative=function(t,e,n){return 0},t.prototype.quadratic=function(t,e,n,i){return(1-t)*(1-t)*e+2*(1-t)*t*n+t*t*i},t.prototype.quadraticDerivative=function(t,e,n,i){return 2*(1-t)*(n-e)+2*t*(i-n)},t.prototype.quadraticSecondDerivative=function(t,e,n,i){return 2*(i-2*n+e)},t.prototype.cubic=function(t,e,n,i,r){return(1-t)*(1-t)*(1-t)*e+3*(1-t)*(1-t)*t*n+3*(1-t)*t*t*i+t*t*t*r},t.prototype.cubicDerivative=function(t,e,n,i,r){return 3*(1-t)*(1-t)*(n-e)+6*(1-t)*t*(i-n)+3*t*t*(r-i)},t.prototype.cubicSecondDerivative=function(t,e,n,i,r){return 6*(1-t)*(i-2*n+e)+6*t*(r-2*i+n)},t.prototype.bn=function(t,e,n){void 0===n&&(n=null),e=e.concat(),n&&n.push(e.concat());for(var i=e.length-1;i>0;i--){for(var r=0;r<i;r++)e[r]=(1-t)*e[r]+t*e[r+1];n&&(e.length=e.length-1,n.push(e.concat()))}return e[0]},t.prototype.bnDerivative=function(t,e){if(e.length<2)return 0;for(var n=0,i=(e=e.concat()).length-1;n<i;n++)e[n]=e[n+1]-e[n];return e.length=e.length-1,e.length*this.bn(t,e)},t.prototype.bnSecondDerivative=function(t,e){if(e.length<3)return 0;for(var n=0,i=(e=e.concat()).length-1;n<i;n++)e[n]=e[n+1]-e[n];return e.length=e.length-1,e.length*this.bnDerivative(t,e)},t.prototype.bnND=function(t,e,n){if(n.length<e+1)return 0;var i=1;n=n.concat();for(var r=0;r<e;r++){for(var o=0,a=n.length-1;o<a;o++)n[o]=n[o+1]-n[o];n.length=n.length-1,i*=n.length}return i*this.bn(t,n)},t.prototype.getValue=function(t,e){return 2===e.length?this.linear(t,e[0],e[1]):3===e.length?this.quadratic(t,e[0],e[1],e[2]):4===e.length?this.cubic(t,e[0],e[1],e[2],e[3]):this.bn(t,e)},t.prototype.getDerivative=function(t,e){return 2===e.length?this.linearDerivative(t,e[0],e[1]):3===e.length?this.quadraticDerivative(t,e[0],e[1],e[2]):4===e.length?this.cubicDerivative(t,e[0],e[1],e[2],e[3]):this.bnDerivative(t,e)},t.prototype.getSecondDerivative=function(t,e){return 2===e.length?this.linearSecondDerivative(t,e[0],e[1]):3===e.length?this.quadraticSecondDerivative(t,e[0],e[1],e[2]):4===e.length?this.cubicSecondDerivative(t,e[0],e[1],e[2],e[3]):this.bnSecondDerivative(t,e)},t.prototype.getExtremums=function(t,e,n){var i=this;void 0===e&&(e=10),void 0===n&&(n=1e-7);for(var r=[],o=0;o<=e;o++)r.push(this.getDerivative(o/e,t));for(var a=[],s=[],u=(o=0,e);o<u;o++)if(r[o]*r[o+1]<0){var c=$.line((function(e){return i.getDerivative(e,t)}),o/e,(o+1)/e,n);a.push(c),s.push(this.getValue(c,t))}return{ts:a,vs:s}},t.prototype.getMonotoneIntervals=function(t,e,n){void 0===e&&(e=10),void 0===n&&(n=1e-7);for(var i=[0,1],r=[t[0],t[t.length-1]],o=this.getExtremums(t,e,n),a=0;a<o.ts.length;a++)i.splice(a+1,0,o.ts[a]),r.splice(a+1,0,o.vs[a]);return{ts:i,vs:r}},t.prototype.getTFromValue=function(t,e,n,i){var r=this;void 0===n&&(n=10),void 0===i&&(i=1e-7);for(var o=this.getMonotoneIntervals(e,n,i),a=o.ts,s=o.vs,u=[],c=0,l=s.length-1;c<l;c++)if((s[c]-t)*(s[c+1]-t)<=0){var h=$.line((function(n){return r.getValue(n,e)-t}),a[c],a[c+1],i);u.push(h)}return u},t.prototype.split=function(t,e){var n=[];et.bn(t,e,n);for(var i=[],r=[],o=n.length-1;o>=0;o--)o===n.length-1?(i.push(n[o][0]),i.push(n[o][0])):(i.unshift(n[o][0]),r.push(n[o].pop()));return[i,r]},t.prototype.merge=function(t,e,n){void 0===n&&(n=0),t=t.concat(),e=e.concat();for(var i,r,o,a=[],s=0,u=t.length;s<u;s++)if(o=a[s]=[],0===s)a[s][0]=t.pop(),e.shift();else if(1===s)a[s][0]=t.pop(),a[s][1]=e.shift(),i=(a[s-1][0]-a[s][0])/(a[s][1]-a[s][0]);else{r=a[s-1];var c=t.pop(),l=e.shift(),h=[];h[0]=c;for(var p=0,f=r.length;p<f;p++)h[p+1]=h[p]+(r[p]-h[p])/i;var d=[];d[r.length]=l;for(p=r.length-1;p>=0;p--)d[p]=d[p+1]-(d[p+1]-r[p])/(1-i);if(1===n){p=0;for(var m=h.length-1;p<=m;p++)o[p]=(h[p]*(m-p)+d[p]*p)/m}else{if(0!==n)throw"合并类型 mergeType "+n+" 错误!";p=0;for(var y=h.length-1;p<=y;p++)o[p]=p<y/2?h[p]:p>y/2?d[p]:(h[p]+d[p])/2}}return a.pop()},t.prototype.getSamples=function(t,e){void 0===e&&(e=100);for(var n=[],i=0;i<=e;i++){var r=this.getValue(i/e,t);n.push(r)}return n},t}(),et=new tt,nt=function(){function t(t){this.as=t}return t.prototype.getValue=function(t){for(var e=0,n=this.as,i=0,r=n.length;i<r;i++)e=e*t+n[i];return e},t}();function it(t,e,n,i,r,o,a,s){var u,c;a?(u=i,c=-n):(u=-i,c=n);var l=t-n*r+u,h=e-i*r+c,p=t+n*o+u,f=e+i*o+c;return s.push(l,h),s.push(p,f),2}function rt(t,e,n,i,r,o,a,s){var u=n-t,c=i-e,l=Math.atan2(u,c),h=Math.atan2(r-t,o-e);s&&l<h?l+=2*Math.PI:!s&&l>h&&(h+=2*Math.PI);var p=l,f=h-l,d=Math.abs(f),m=Math.sqrt(u*u+c*c),y=1+(15*d*Math.sqrt(m)/Math.PI>>0),v=f/y;if(p+=v,s){a.push(t,e),a.push(n,i);for(var g=1,_=p;g<y;g++,_+=v)a.push(t,e),a.push(t+Math.sin(_)*m,e+Math.cos(_)*m);a.push(t,e),a.push(r,o)}else{a.push(n,i),a.push(t,e);for(g=1,_=p;g<y;g++,_+=v)a.push(t+Math.sin(_)*m,e+Math.cos(_)*m),a.push(t,e);a.push(r,o),a.push(t,e)}return 2*y}var ot=function(t,e){return ot=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},ot(t,e)};function at(t,e){function n(){this.constructor=t}ot(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function st(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}var ut=function(){function t(){}return Object.defineProperty(t,"time",{get:function(){throw"未实现"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"timeAsDouble",{get:function(){return t.time},enumerable:!1,configurable:!0}),Object.defineProperty(t,"timeSinceLevelLoad",{get:function(){throw"未实现"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"timeSinceLevelLoadAsDouble",{get:function(){return t.timeSinceLevelLoad},enumerable:!1,configurable:!0}),Object.defineProperty(t,"deltaTime",{get:function(){throw"未实现"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"fixedTime",{get:function(){throw"未实现"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"fixedTimeAsDouble",{get:function(){return t.fixedTime},enumerable:!1,configurable:!0}),Object.defineProperty(t,"unscaledTime",{get:function(){throw"未实现"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"unscaledTimeAsDouble",{get:function(){return t.unscaledTime},enumerable:!1,configurable:!0}),Object.defineProperty(t,"fixedUnscaledTime",{get:function(){throw"未实现"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"fixedUnscaledTimeAsDouble",{get:function(){return t.fixedUnscaledTime},enumerable:!1,configurable:!0}),Object.defineProperty(t,"unscaledDeltaTime",{get:function(){throw"未实现"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"fixedUnscaledDeltaTime",{get:function(){throw"未实现"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"smoothDeltaTime",{get:function(){throw"未实现"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"frameCount",{get:function(){throw"未实现"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"renderedFrameCount",{get:function(){throw"未实现"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"realtimeSinceStartup",{get:function(){throw"未实现"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"realtimeSinceStartupAsDouble",{get:function(){return t.realtimeSinceStartup},enumerable:!1,configurable:!0}),Object.defineProperty(t,"captureFramerate",{get:function(){return 0===t.captureDeltaTime?0:Math.round(1/t.captureDeltaTime)},set:function(e){t.captureDeltaTime=0===e?0:1/e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"inFixedTimeStep",{get:function(){throw"未实现"},enumerable:!1,configurable:!0}),t}(),ct=function(){function t(){}return t.Sin=function(t){return Math.sin(t)},t.Cos=function(t){return Math.cos(t)},t.Tan=function(t){return Math.tan(t)},t.Asin=function(t){return Math.asin(t)},t.Acos=function(t){return Math.acos(t)},t.Atan=function(t){return Math.atan(t)},t.Atan2=function(t,e){return Math.atan2(t,e)},t.Sqrt=function(t){return Math.sqrt(t)},t.Abs=function(t){return Math.abs(t)},t.Min=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];if(Array.isArray(e[0])){var i=e[0],r=i.length;if(0===r)return 0;for(var o=i[0],a=1;a<r;a++)i[a]<o&&(o=i[a]);return o}var s=e[0],u=e[1];return s<u?s:u},t.Max=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];if(Array.isArray(e[0])){var i=e[0],r=i.length;if(0===r)return 0;for(var o=i[0],a=1;a<r;a++)i[a]>o&&(o=i[a]);return o}var s=e[0],u=e[1];return s>u?s:u},t.Pow=function(t,e){return Math.pow(t,e)},t.Exp=function(t){return Math.exp(t)},t.Log=function(t){return Math.log(t)},t.Log10=function(t){return Math.log10(t)},t.Ceil=function(t){return Math.ceil(t)},t.Floor=function(t){return Math.floor(t)},t.Round=function(t){return Math.round(t)},t.CeilToInt=function(t){return Math.ceil(t)},t.FloorToInt=function(t){return Math.floor(t)},t.RoundToInt=function(t){return Math.round(t)},t.Sign=function(t){return t>=0?1:-1},t.Clamp=function(t,e,n){return t<e?t=e:t>n&&(t=n),t},t.Clamp01=function(t){return t<0?0:t>1?1:t},t.Lerp=function(e,n,i){return e+(n-e)*t.Clamp01(i)},t.LerpUnclamped=function(t,e,n){return t+(e-t)*n},t.LerpAngle=function(e,n,i){var r=t.Repeat(n-e,360);return r>180&&(r-=360),e+r*t.Clamp01(i)},t.MoveTowards=function(e,n,i){return t.Abs(n-e)<=i?n:e+t.Sign(n-e)*i},t.MoveTowardsAngle=function(e,n,i){var r=t.DeltaAngle(e,n);return-i<r&&r<i?n:(n=e+r,t.MoveTowards(e,n,i))},t.SmoothStep=function(e,n,i){return n*(i=-2*(i=t.Clamp01(i))*i*i+3*i*i)+e*(1-i)},t.Gamma=function(e,n,i){var r=e<0,o=t.Abs(e);if(o>n)return r?-o:o;var a=t.Pow(o/n,i)*n;return r?-a:a},t.Approximately=function(e,n){return t.Abs(n-e)<t.Max(1e-6*t.Max(t.Abs(e),t.Abs(n)),8*t.Epsilon)},t.SmoothDamp=function(e,n,i,r,o){var a=ut.deltaTime;return t.SmoothDamp2(e,n,i,r,o,a)},t.SmoothDamp1=function(e,n,i,r){var o=ut.deltaTime,a=t.Infinity;return t.SmoothDamp2(e,n,i,r,a,o)},t.SmoothDamp2=function(e,n,i,r,o,a){void 0===o&&(o=t.Infinity),void 0===a&&(a=ut.deltaTime);var s=2/(r=t.Max(1e-4,r)),u=s*a,c=1/(1+u+.48*u*u+.235*u*u*u),l=e-n,h=n,p=o*r,f=(i+s*(l=t.Clamp(l,-p,p)))*a;i=(i-s*f)*c;var d=(n=e-l)+(l+f)*c;return h-e>0==d>h&&(i=((d=h)-h)/a),d},t.SmoothDampAngle=function(e,n,i,r,o){var a=ut.deltaTime;return t.SmoothDampAngle2(e,n,i,r,o,a)},t.SmoothDampAngle1=function(e,n,i,r){var o=ut.deltaTime,a=t.Infinity;return t.SmoothDampAngle2(e,n,i,r,a,o)},t.SmoothDampAngle2=function(e,n,i,r,o,a){return void 0===o&&(o=t.Infinity),void 0===a&&(a=ut.deltaTime),n=e+t.DeltaAngle(e,n),t.SmoothDamp2(e,n,i,r,o,a)},t.Repeat=function(e,n){return t.Clamp(e-t.Floor(e/n)*n,0,n)},t.PingPong=function(e,n){return e=t.Repeat(e,2*n),n-t.Abs(e-n)},t.InverseLerp=function(e,n,i){return e!==n?t.Clamp01((i-e)/(n-e)):0},t.DeltaAngle=function(e,n){var i=t.Repeat(n-e,360);return i>180&&(i-=360),i},t.LineIntersection=function(t,e,n,i,r){var o=e.x-t.x,a=e.y-t.y,s=i.x-n.x,u=i.y-n.y,c=o*u-a*s;if(0===c)return!1;var l=((n.x-t.x)*u-(n.y-t.y)*s)/c;return r.x=t.x+l*o,r.y=t.y+l*a,!0},t.LineSegmentIntersection=function(t,e,n,i,r){var o=e.x-t.x,a=e.y-t.y,s=i.x-n.x,u=i.y-n.y,c=o*u-a*s;if(0===c)return!1;var l=n.x-t.x,h=n.y-t.y,p=(l*u-h*s)/c;if(p<0||p>1)return!1;var f=(l*a-h*o)/c;return!(f<0||f>1)&&(r.x=t.x+p*o,r.y=t.y+p*a,!0)},t.RoundToMultipleOf=function(e,n){return 0===n?e:t.Round(e/n)*n},t.GetClosestPowerOfTen=function(e){return e<=0?1:t.Pow(10,t.RoundToInt(t.Log10(e)))},t.GetNumberOfDecimalsForMinimumDifference=function(e){return t.Clamp(-t.FloorToInt(t.Log10(t.Abs(e))),0,t.kMaxDecimals)},t.GetNumberOfDecimalsForMinimumDifference1=function(t){return Math.max(0,-Math.floor(Math.log10(Math.abs(t))))},t.PI=Math.PI,t.Infinity=1/0,t.NegativeInfinity=-1/0,t.Deg2Rad=2*t.PI/360,t.Rad2Deg=1/t.Deg2Rad,t.kMaxDecimals=15,t.Epsilon=1401298e-51,t}(),lt=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lengthSquared",{get:function(){return this.x*this.x+this.y*this.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"magnitude",{get:function(){return this.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sqrMagnitude",{get:function(){return this.x*this.x+this.y*this.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalized",{get:function(){var e=new t(this.x,this.y);return e.normalize(),e},enumerable:!1,configurable:!0}),t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t.prototype.equals=function(t,e){return void 0===e&&(e=P.PRECISION),!!P.equals(this.x-t.x,0,e)&&!!P.equals(this.y-t.y,0,e)},t.prototype.normalize=function(){var e=this.length;this.length>t.kEpsilon?(this.x/=e,this.y/=e):(this.x=0,this.y=0)},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.toString=function(){return"("+this.x+", "+this.y+")"},t.Lerp=function(e,n,i){return i=P.clamp(i,0,1),new t(e.x+(n.x-e.x)*i,e.y+(n.y-e.y)*i)},t.LerpUnclamped=function(e,n,i){return new t(e.x+(n.x-e.x)*i,e.y+(n.y-e.y)*i)},t.MoveTowards=function(e,n,i){var r=n.x-e.x,o=n.y-e.y,a=r*r+o*o;if(0===a||i>=0&&a<=i*i)return n;var s=Math.sqrt(a);return new t(e.x+r/s*i,e.y+o/s*i)},t.Scale=function(e,n){return new t(e.x*n.x,e.y*n.y)},t.Reflect=function(e,n){var i=-2*t.Dot(n,e);return new t(i*n.x+e.x,i*n.y+e.y)},t.Perpendicular=function(e){return new t(-e.y,e.x)},t.Dot=function(t,e){return t.x*e.x+t.y*e.y},t.Angle=function(e,n){var i=Math.sqrt(e.sqrMagnitude*n.sqrMagnitude);if(i<t.kEpsilonNormalSqrt)return 0;var r=P.clamp(t.Dot(e,n)/i,-1,1);return Math.acos(r)*P.RAD2DEG},t.SignedAngle=function(e,n){return t.Angle(e,n)*ct.Sign(e.x*n.y-e.y*n.x)},t.Distance=function(t,e){return t.distance(e)},t.ClampMagnitude=function(e,n){var i=e.sqrMagnitude;if(i>n*n){var r=Math.sqrt(i);return new t(e.x/r*n,e.y/r*n)}return e.clone()},t.Min=function(e,n){return new t(ct.Min(e.x,n.x),ct.Min(e.y,n.y))},t.Max=function(e,n){return new t(ct.Max(e.x,n.x),ct.Max(e.y,n.y))},t.SmoothDamp=function(e,n,i,r,o){var a=ut.deltaTime;return t.SmoothDamp2(e,n,i,r,o,a)},t.SmoothDamp1=function(e,n,i,r){var o=ut.deltaTime,a=ct.Infinity;return t.SmoothDamp2(e,n,i,r,a,o)},t.SmoothDamp2=function(e,n,i,r,o,a){void 0===o&&(o=ct.Infinity),void 0===a&&(a=ut.deltaTime);var s=2/(r=ct.Max(1e-4,r)),u=s*a,c=1/(1+u+.48*u*u+.235*u*u*u),l=e.x-n.x,h=e.y-n.y,p=n,f=o*r,d=l*l+h*h;if(d>f*f){var m=ct.Sqrt(d);l=l/m*f,h=h/m*f}n.x=e.x-l,n.y=e.y-h;var y=(i.x+s*l)*a,v=(i.y+s*h)*a;i.x=(i.x-s*y)*c,i.y=(i.y-s*v)*c;var g=n.x+(l+y)*c,_=n.y+(h+v)*c,b=p.x-e.x,x=p.y-e.y;return b*(g-p.x)+x*(_-p.y)>0&&(g=p.x,_=p.y,i.x=(g-p.x)/a,i.y=(_-p.y)/a),new t(g,_)},t.polar=function(e,n){return new t(e*Math.cos(n*P.RAD2DEG),e*Math.sin(n*P.RAD2DEG))},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.addTo=function(e,n){return void 0===n&&(n=new t),n.x=this.x+e.x,n.y=this.y+e.y,n},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.subTo=function(e,n){return void 0===n&&(n=new t),n.x=this.x-e.x,n.y=this.y-e.y,n},t.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},t.prototype.multiplyTo=function(e,n){return void 0===n&&(n=new t),n.x=this.x*e.x,n.y=this.y*e.y,n},t.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},t.prototype.divideTo=function(e,n){return void 0===n&&(n=new t),n.x=this.x/e.x,n.y=this.y/e.y,n},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.distance=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},t.prototype.distanceSquared=function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},t.prototype.negate=function(){return this.x*=-1,this.y*=-1,this},t.prototype.reciprocal=function(){return this.x=1/this.x,this.y=1/this.y,this},t.prototype.reciprocalTo=function(e){return void 0===e&&(e=new t),e.copy(this).reciprocal(),e},t.prototype.scaleNumber=function(t){return this.x*=t,this.y*=t,this},t.prototype.scaleNumberTo=function(e,n){return void 0===n&&(n=new t),n.copy(this).scaleNumber(e)},t.prototype.scale=function(t){return this.x*=t.x,this.y*=t.y,this},t.prototype.scaleTo=function(e,n){return void 0===n&&(n=new t),e===n&&(e=e.clone()),n.copy(this).scale(e)},t.prototype.offset=function(t,e){return this.x+=t,this.y+=e,this},t.prototype.lerp=function(t,e){return this.x+=(t.x-this.x)*e.x,this.y+=(t.y-this.y)*e.y,this},t.prototype.lerpTo=function(e,n,i){return void 0===i&&(i=new t),i.copy(this).lerp(e,n)},t.prototype.lerpNumber=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},t.prototype.lerpNumberTo=function(e,n,i){return void 0===i&&(i=new t),i.copy(this).lerpNumber(e,n)},t.prototype.clamp=function(t,e){return this.x=P.clamp(this.x,t.x,e.x),this.y=P.clamp(this.y,t.y,e.y),this},t.prototype.clampTo=function(e,n,i){return void 0===i&&(i=new t),i.copy(this).clamp(e,n)},t.prototype.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},t.prototype.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},t.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},t.prototype.toArray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},t.zero=Object.freeze(new t),t.one=Object.freeze(new t(1,1)),t.up=Object.freeze(new t(0,1)),t.down=Object.freeze(new t(0,-1)),t.left=Object.freeze(new t(-1,0)),t.right=Object.freeze(new t(1,0)),t.positiveInfinity=Object.freeze(new t(1/0,1/0)),t.negativeInfinity=Object.freeze(new t(-1/0,-1/0)),t.kEpsilon=1e-5,t.kEpsilonNormalSqrt=1e-15,st([n(),C],t.prototype,"x",void 0),st([n(),C],t.prototype,"y",void 0),t}(),ht=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=0,this.y=0,this.z=0,this.x=t,this.y=e,this.z=n}return t.fromArray=function(e,n){return void 0===n&&(n=0),(new t).fromArray(e,n)},t.random=function(e,n){void 0===e&&(e=1),void 0===n&&(n=!1);var i=new t(Math.random(),Math.random(),Math.random());return n&&i.scaleNumber(2).subNumber(1),i.scaleNumber(e),i},t.fromVector2=function(e,n){return void 0===n&&(n=0),(new t).fromVector2(e,n)},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.lengthSquared)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lengthSquared",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z},enumerable:!1,configurable:!0}),t.prototype.set=function(t,e,n){return this.x=t,this.y=e,this.z=n,this},t.prototype.setZero=function(){this.x=this.y=this.z=0},t.prototype.fromVector2=function(t,e){return void 0===e&&(e=0),this.x=t.x,this.y=t.y,this.z=e,this},t.prototype.fromArray=function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},t.prototype.toVector2=function(t){return void 0===t&&(t=new lt),t.set(this.x,this.y)},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.addTo=function(e,n){return void 0===n&&(n=new t),n.x=this.x+e.x,n.y=this.y+e.y,n.z=this.z+e.z,n},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.subTo=function(e,n){return void 0===n&&(n=new t),n.x=this.x-e.x,n.y=this.y-e.y,n.z=this.z-e.z,n},t.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},t.prototype.multiplyTo=function(e,n){return void 0===n&&(n=new t),n.x=this.x*e.x,n.y=this.y*e.y,n.z=this.z*e.z,n},t.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},t.prototype.divideTo=function(e,n){return void 0===n&&(n=new t),n.x=this.x/e.x,n.y=this.y/e.y,n.z=this.z/e.z,n},t.prototype.equals=function(t,e){return void 0===e&&(e=P.PRECISION),!!P.equals(this.x-t.x,0,e)&&(!!P.equals(this.y-t.y,0,e)&&!!P.equals(this.z-t.z,0,e))},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t.prototype.distance=function(t){var e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return Math.sqrt(e*e+n*n+i*i)},t.prototype.distanceSquared=function(t){var e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i},t.prototype.normalize=function(t){void 0===t&&(t=1);var e=this.lengthSquared;if(e>0){var n=t/(e=Math.sqrt(e));this.x*=n,this.y*=n,this.z*=n}else this.x=0,this.y=0,this.z=0;return this},t.prototype.addScaledVector=function(t,e){return this.x=this.x+t*e.x,this.y=this.y+t*e.y,this.z=this.z+t*e.z,this},t.prototype.addScaledVectorTo=function(e,n,i){return void 0===i&&(i=new t),i.x=this.x+e*n.x,i.y=this.y+e*n.y,i.z=this.z+e*n.z,i},t.prototype.cross=function(t){return this.set(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},t.prototype.crossTo=function(e,n){return void 0===n&&(n=new t),n.x=this.y*e.z-this.z*e.y,n.y=this.z*e.x-this.x*e.z,n.z=this.x*e.y-this.y*e.x,n},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},t.prototype.tangents=function(e,n){var i=this.length;if(i>0){var r=new t,o=1/i;r.set(this.x*o,this.y*o,this.z*o);var a=new t;Math.abs(r.x)<.9?(a.set(1,0,0),r.crossTo(a,e)):(a.set(0,1,0),r.crossTo(a,e)),r.crossTo(e,n)}else e.set(1,0,0),n.set(0,1,0)},t.prototype.almostZero=function(t){return void 0===t&&(t=P.PRECISION),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)},t.prototype.isAntiparallelTo=function(e,n){void 0===n&&(n=P.PRECISION);var i=new t;return this.negateTo(i),i.equals(e,n)},t.prototype.addNumber=function(t){return this.x+=t,this.y+=t,this.z+=t,this},t.prototype.addNumberTo=function(e,n){return void 0===n&&(n=new t),n.x=this.x+e,n.y=this.y+e,n.z=this.z+e,n},t.prototype.subNumber=function(t){return this.x-=t,this.y-=t,this.z-=t,this},t.prototype.subNumberTo=function(e,n){return void 0===n&&(n=new t),n.x=this.x-e,n.y=this.y-e,n.z=this.z-e,n},t.prototype.multiplyNumber=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.prototype.multiplyNumberTo=function(e,n){return void 0===n&&(n=new t),n.x=this.x*e,n.y=this.y*e,n.z=this.z*e,n},t.prototype.divideNumber=function(t){return this.x/=t,this.y/=t,this.z/=t,this},t.prototype.divideNumberTo=function(e,n){return void 0===n&&(n=new t),n.x=this.x/e,n.y=this.y/e,n.z=this.z/e,n},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},t.prototype.negateTo=function(e){return void 0===e&&(e=new t),e.x=-this.x,e.y=-this.y,e.z=-this.z,e},t.prototype.inverse=function(){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this},t.prototype.inverseTo=function(e){return void 0===e&&(e=new t),e.x=1/this.x,e.y=1/this.y,e.z=1/this.z,e},t.prototype.unit=function(e){void 0===e&&(e=new t);var n=this.x,i=this.y,r=this.z,o=n*n+i*i+r*r;return o>0?(o=1/(o=Math.sqrt(o)),e.x=n*o,e.y=i*o,e.z=r*o):(e.x=1,e.y=0,e.z=0),e},t.prototype.scaleNumber=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.prototype.scaleNumberTo=function(e,n){return void 0===n&&(n=new t),n.x=this.x*e,n.y=this.y*e,n.z=this.z*e,n},t.prototype.scale=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},t.prototype.scaleTo=function(e,n){return void 0===n&&(n=new t),n.x=this.x*e.x,n.y=this.y*e.y,n.z=this.z*e.z,n},t.prototype.lerp=function(t,e){return this.x+=(t.x-this.x)*e.x,this.y+=(t.y-this.y)*e.y,this.z+=(t.z-this.z)*e.z,this},t.prototype.lerpTo=function(e,n,i){return void 0===i&&(i=new t),i.x=this.x+(e.x-this.x)*n.x,i.y=this.y+(e.y-this.y)*n.y,i.z=this.z+(e.z-this.z)*n.z,i},t.prototype.lerpNumber=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},t.prototype.lerpNumberTo=function(e,n,i){return void 0===i&&(i=new t),i.x=this.x+(e.x-this.x)*n,i.y=this.y+(e.y-this.y)*n,i.z=this.z+(e.z-this.z)*n,i},t.prototype.less=function(t){return this.x<t.x&&this.y<t.y&&this.z<t.z},t.prototype.lessequal=function(t){return this.x<=t.x&&this.y<=t.y&&this.z<=t.z},t.prototype.greater=function(t){return this.x>t.x&&this.y>t.y&&this.z>t.z},t.prototype.greaterequal=function(t){return this.x>=t.x&&this.y>=t.y&&this.z>=t.z},t.prototype.clamp=function(t,e){return this.x=P.clamp(this.x,t.x,e.x),this.y=P.clamp(this.y,t.y,e.y),this.z=P.clamp(this.z,t.z,e.z),this},t.prototype.clampTo=function(e,n,i){return void 0===i&&(i=new t),i.copy(this).clamp(e,n)},t.prototype.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},t.prototype.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},t.prototype.reflect=function(t){return this.sub(t.multiplyNumberTo(2*this.dot(t)))},t.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},t.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},t.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},t.prototype.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},t.prototype.isParallel=function(t,e){return void 0===e&&(e=P.PRECISION),P.equals(this.crossTo(t).lengthSquared,0,e)},t.prototype.crossmat=function(t){return t.set([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0]),t},t.prototype.applyQuaternion=function(t){var e=this.x,n=this.y,i=this.z,r=t.x,o=t.y,a=t.z,s=t.w,u=s*e+o*i-a*n,c=s*n+a*e-r*i,l=s*i+r*n-o*e,h=-r*e-o*n-a*i;return this.x=u*s+h*-r+c*-a-l*-o,this.y=c*s+h*-o+l*-r-u*-a,this.z=l*s+h*-a+u*-o-c*-r,this},t.prototype.applyMatrix4x4=function(t){return t.transformPoint3(this,this),this},t.prototype.toString=function(){return"<"+this.x+", "+this.y+", "+this.z+">"},t.prototype.toArray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},t.prototype.toVector4=function(t){return t.x=this.x,t.y=this.y,t.z=this.z,t},t.Lerp=function(e,n,i){return i=ct.Clamp01(i),new t(e.x+(n.x-e.x)*i,e.y+(n.y-e.y)*i,e.z+(n.z-e.z)*i)},t.LerpUnclamped=function(e,n,i){return new t(e.x+(n.x-e.x)*i,e.y+(n.y-e.y)*i,e.z+(n.z-e.z)*i)},t.MoveTowards=function(e,n,i){var r=n.x-e.x,o=n.y-e.y,a=n.z-e.z,s=r*r+o*o+a*a;if(0===s||i>=0&&s<=i*i)return n;var u=Math.sqrt(s);return new t(e.x+r/u*i,e.y+o/u*i,e.z+a/u*i)},t.SmoothDamp=function(e,n,i,r,o){var a=ut.deltaTime;return t.SmoothDamp2(e,n,i,r,o,a)},t.SmoothDamp1=function(e,n,i,r){var o=ut.deltaTime,a=ct.Infinity;return t.SmoothDamp2(e,n,i,r,a,o)},t.SmoothDamp2=function(e,n,i,r,o,a){void 0===o&&(o=ct.Infinity),void 0===a&&(a=ut.deltaTime);var s=0,u=0,c=0,l=2/(r=ct.Max(1e-4,r)),h=l*a,p=1/(1+h+.48*h*h+.235*h*h*h),f=e.x-n.x,d=e.y-n.y,m=e.z-n.z,y=n,v=o*r,g=f*f+d*d+m*m;if(g>v*v){var _=Math.sqrt(g);f=f/_*v,d=d/_*v,m=m/_*v}n.x=e.x-f,n.y=e.y-d,n.z=e.z-m;var b=(i.x+l*f)*a,x=(i.y+l*d)*a,w=(i.z+l*m)*a;i.x=(i.x-l*b)*p,i.y=(i.y-l*x)*p,i.z=(i.z-l*w)*p,s=n.x+(f+b)*p,u=n.y+(d+x)*p,c=n.z+(m+w)*p;var S=y.x-e.x,P=y.y-e.y,M=y.z-e.z;return S*(s-y.x)+P*(u-y.y)+M*(c-y.z)>0&&(s=y.x,u=y.y,c=y.z,i.x=(s-y.x)/a,i.y=(u-y.y)/a,i.z=(c-y.z)/a),new t(s,u,c)},t.Scale=function(e,n){return new t(e.x*n.x,e.y*n.y,e.z*n.z)},t.Cross=function(e,n){return new t(e.y*n.z-e.z*n.y,e.z*n.x-e.x*n.z,e.x*n.y-e.y*n.x)},t.Reflect=function(e,n){var i=-2*t.Dot(n,e);return new t(i*n.x+e.x,i*n.y+e.y,i*n.z+e.z)},t.Normalize=function(e){var n=t.Magnitude(e);return n>t.kEpsilon?new t(e.x/n,e.y/n,e.z/n):t.zero.clone()},t.prototype.Normalize=function(){var e=t.Magnitude(this);e>t.kEpsilon?(this.x=this.x/e,this.y=this.y/e,this.z=this.z/e):(this.x=0,this.y=0,this.z=0)},Object.defineProperty(t.prototype,"normalized",{get:function(){return t.Normalize(this)},enumerable:!1,configurable:!0}),t.Dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t.Project=function(e,n){var i=t.Dot(n,n);if(i<ct.Epsilon)return t.zero;var r=t.Dot(e,n);return new t(n.x*r/i,n.y*r/i,n.z*r/i)},t.ProjectOnPlane=function(e,n){var i=t.Dot(n,n);if(i<ct.Epsilon)return e;var r=t.Dot(e,n);return new t(e.x-n.x*r/i,e.y-n.y*r/i,e.z-n.z*r/i)},t.Angle=function(e,n){var i=Math.sqrt(e.sqrMagnitude*n.sqrMagnitude);if(i<t.kEpsilonNormalSqrt)return 0;var r=ct.Clamp(t.Dot(e,n)/i,-1,1);return Math.acos(r)*ct.Rad2Deg},t.SignedAngle=function(e,n,i){var r=t.Angle(e,n),o=e.y*n.z-e.z*n.y,a=e.z*n.x-e.x*n.z,s=e.x*n.y-e.y*n.x;return r*ct.Sign(i.x*o+i.y*a+i.z*s)},t.Distance=function(t,e){var n=t.x-e.x,i=t.y-e.y,r=t.z-e.z;return Math.sqrt(n*n+i*i+r*r)},t.ClampMagnitude=function(e,n){var i=e.sqrMagnitude;if(i>n*n){var r=Math.sqrt(i);return new t(e.x/r*n,e.y/r*n,e.z/r*n)}return e},t.Magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},Object.defineProperty(t.prototype,"magnitude",{get:function(){var t=this,e=t.x,n=t.y,i=t.z;return Math.sqrt(e*e+n*n+i*i)},enumerable:!1,configurable:!0}),t.SqrMagnitude=function(t){return t.x*t.x+t.y*t.y+t.z*t.z},Object.defineProperty(t.prototype,"sqrMagnitude",{get:function(){var t=this,e=t.x,n=t.y,i=t.z;return e*e+n*n+i*i},enumerable:!1,configurable:!0}),t.Min=function(e,n){return new t(ct.Min(e.x,n.x),ct.Min(e.y,n.y),ct.Min(e.z,n.z))},t.Max=function(e,n){return new t(ct.Max(e.x,n.x),ct.Max(e.y,n.y),ct.Max(e.z,n.z))},t.X_AXIS=Object.freeze(new t(1,0,0)),t.Y_AXIS=Object.freeze(new t(0,1,0)),t.Z_AXIS=Object.freeze(new t(0,0,1)),t.ZERO=Object.freeze(new t),t.ONE=Object.freeze(new t(1,1,1)),t.kEpsilon=1e-5,t.kEpsilonNormalSqrt=1e-15,t.zero=Object.freeze(new t(0,0,0)),t.one=Object.freeze(new t(1,1,1)),t.up=Object.freeze(new t(0,1,0)),t.down=Object.freeze(new t(0,-1,0)),t.left=Object.freeze(new t(-1,0,0)),t.right=Object.freeze(new t(1,0,0)),t.forward=Object.freeze(new t(0,0,1)),t.back=Object.freeze(new t(0,0,-1)),t.positiveInfinity=Object.freeze(new t(1/0,1/0,1/0)),t.negativeInfinity=Object.freeze(new t(-1/0,-1/0,-1/0)),st([C,n()],t.prototype,"x",void 0),st([C,n()],t.prototype,"y",void 0),st([C,n()],t.prototype,"z",void 0),t}(),pt=function(){function t(t,e,n){void 0===t&&(t=1),void 0===e&&(e=1),void 0===n&&(n=1),this.r=1,this.g=1,this.b=1,this.r=t,this.g=e,this.b=n}return t.fromUnit=function(e){return(new t).fromUnit(e)},t.fromColor4=function(e){return new t(e.r,e.g,e.b)},t.prototype.setTo=function(t,e,n){return this.r=t,this.g=e,this.b=n,this},t.prototype.fromUnit=function(t){return this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},t.prototype.toInt=function(){return(255*this.r<<16)+(255*this.g<<8)+255*this.b},t.prototype.toHexString=function(){var e=255*this.r|0,n=255*this.g|0,i=255*this.b|0;return"#"+t.ToHex(e)+t.ToHex(n)+t.ToHex(i)},t.prototype.mix=function(t,e){return this.r=this.r*(1-e)+t.r*e,this.g=this.g*(1-e)+t.g*e,this.b=this.b*(1-e)+t.b*e,this},t.prototype.mixTo=function(e,n,i){return void 0===i&&(i=new t),i.copy(this).mix(e,n)},t.prototype.scale=function(t){return this.r*=t,this.g*=t,this.b*=t,this},t.prototype.scaleTo=function(e,n){return void 0===n&&(n=new t),n.copy(this).scale(e)},t.prototype.equals=function(t,e){return void 0===e&&(e=P.PRECISION),!!P.equals(this.r-t.r,0,e)&&(!!P.equals(this.g-t.g,0,e)&&!!P.equals(this.b-t.b,0,e))},t.prototype.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},t.prototype.clone=function(){return new t(this.r,this.g,this.b)},t.prototype.toVector3=function(t){return void 0===t&&(t=new ht),t.x=this.r,t.y=this.g,t.z=this.b,t},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},t.prototype.toArray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},t.ToHex=function(t){var e=t.toString(16);return t<=15?("0"+e).toUpperCase():e.toUpperCase()},t.WHITE=new t,t.BLACK=new t(0,0,0),st([n(),C],t.prototype,"r",void 0),st([n(),C],t.prototype,"g",void 0),st([n(),C],t.prototype,"b",void 0),t}(),ft={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},dt=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=0,this.y=0,this.z=0,this.w=0,this.set(t,e,n,i)}return t.fromArray=function(e,n){return void 0===n&&(n=0),(new t).fromArray(e,n)},t.fromVector3=function(e,n){return void 0===n&&(n=0),(new t).fromVector3(e,n)},t.random=function(){return new t(Math.random(),Math.random(),Math.random(),Math.random())},t.prototype.set=function(t,e,n,i){return void 0===n&&(n=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=n,this.w=i,this},t.prototype.fromArray=function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},t.prototype.fromVector3=function(t,e){return void 0===e&&(e=0),this.x=t.x,this.y=t.y,this.z=t.z,this.w=e,this},t.prototype.toVector3=function(t){return void 0===t&&(t=new ht),t.set(this.x,this.y,this.z),t},t.prototype.toArray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},t.prototype.addTo=function(e,n){return void 0===n&&(n=new t),n.copy(this).add(e)},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},t.prototype.subTo=function(e,n){return void 0===n&&(n=new t),n.copy(this).sub(e)},t.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},t.prototype.multiplyTo=function(e,n){return void 0===n&&(n=new t),n.copy(this).multiply(e)},t.prototype.div=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this},t.prototype.divTo=function(e,n){return void 0===n&&(n=new t),n.copy(this).div(e)},t.prototype.equals=function(t,e){return void 0===e&&(e=P.PRECISION),!!P.equals(this.x-t.x,0,e)&&(!!P.equals(this.y-t.y,0,e)&&(!!P.equals(this.z-t.z,0,e)&&!!P.equals(this.w-t.w,0,e)))},t.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},t.prototype.negateTo=function(e){return void 0===e&&(e=new t),e.copy(this).negate()},t.prototype.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.scaleTo=function(t){return this.clone().scale(t)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},t.prototype.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},t.prototype.lerpTo=function(e,n,i){return void 0===i&&(i=new t),i.copy(this).lerp(e,n)},t.prototype.applyMatrix4x4=function(t){return t.transformVector4(this,this),this},t.prototype.toString=function(){return"<"+this.x+", "+this.y+", "+this.z+", "+this.w+">"},t.Lerp=function(e,n,i){return i=ct.Clamp01(i),new t(e.x+(n.x-e.x)*i,e.y+(n.y-e.y)*i,e.z+(n.z-e.z)*i,e.w+(n.w-e.w)*i)},t.LerpUnclamped=function(e,n,i){return new t(e.x+(n.x-e.x)*i,e.y+(n.y-e.y)*i,e.z+(n.z-e.z)*i,e.w+(n.w-e.w)*i)},t.MoveTowards=function(e,n,i){var r=n.x-e.x,o=n.y-e.y,a=n.z-e.z,s=n.w-e.w,u=r*r+o*o+a*a+s*s;if(0===u||i>=0&&u<=i*i)return n;var c=Math.sqrt(u);return new t(e.x+r/c*i,e.y+o/c*i,e.z+a/c*i,e.w+s/c*i)},t.Scale=function(e,n){return new t(e.x*n.x,e.y*n.y,e.z*n.z,e.w*n.w)},t.prototype.Scale=function(t){this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w},t.prototype.Equals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},t.Normalize=function(e){var n=t.Magnitude(e);return n>t.kEpsilon?new t(e.x/n,e.y/n,e.z/n,e.w/n):t.zero.clone()},t.prototype.Normalize=function(){var e=t.Magnitude(this);e>t.kEpsilon?(this.x=this.x/e,this.y=this.y/e,this.z=this.z/e):(this.x=0,this.y=0,this.z=0)},Object.defineProperty(t.prototype,"normalized",{get:function(){return t.Normalize(this)},enumerable:!1,configurable:!0}),t.Dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},t.Project=function(e,n){var i=t.Dot(e,n)/t.Dot(n,n);return new t(n.x*i,n.y*i,n.z*i,n.w*i)},t.Distance=function(e,n){return t.Magnitude(e.clone().sub(n))},t.Magnitude=function(e){return Math.sqrt(t.Dot(e,e))},Object.defineProperty(t.prototype,"magnitude",{get:function(){return Math.sqrt(t.Dot(this,this))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sqrMagnitude",{get:function(){return t.Dot(this,this)},enumerable:!1,configurable:!0}),t.Min=function(e,n){return new t(ct.Min(e.x,n.x),ct.Min(e.y,n.y),ct.Min(e.z,n.z),ct.Min(e.w,n.w))},t.Max=function(e,n){return new t(ct.Max(e.x,n.x),ct.Max(e.y,n.y),ct.Max(e.z,n.z),ct.Max(e.w,n.w))},t.zero=Object.freeze(new t(0,0,0,0)),t.one=Object.freeze(new t(1,1,1,1)),t.positiveInfinity=Object.freeze(new t(1/0,1/0,1/0,1/0)),t.negativeInfinity=Object.freeze(new t(-1/0,-1/0,-1/0,-1/0)),t.kEpsilon=1e-5,st([C,n()],t.prototype,"x",void 0),st([C,n()],t.prototype,"y",void 0),st([C,n()],t.prototype,"z",void 0),st([C,n()],t.prototype,"w",void 0),t}();pt.prototype.toColor4=function(t){return void 0===t&&(t=new yt),t.r=this.r,t.g=this.g,t.b=this.b,t};var mt,yt=function(){function t(t,e,n,i){void 0===t&&(t=1),void 0===e&&(e=1),void 0===n&&(n=1),void 0===i&&(i=1),this.r=1,this.g=1,this.b=1,this.a=1,this.r=t,this.g=e,this.b=n,this.a=i}return t.fromUnit=function(e){return(new t).fromUnit(e)},t.fromUnit24=function(e,n){return void 0===n&&(n=1),t.fromColor3(pt.fromUnit(e),n)},t.fromColor3=function(e,n){return void 0===n&&(n=1),new t(e.r,e.g,e.b,n)},t.prototype.setTo=function(t,e,n,i){return void 0===i&&(i=1),this.r=t,this.g=e,this.b=n,this.a=i,this},t.prototype.fromUnit=function(t){return this.a=(t>>24&255)/255,this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},t.prototype.fromUnit24=function(t,e){return void 0===e&&(e=1),this.fromUnit(t),this.a=e,this},t.prototype.fromColor3=function(t,e){return void 0===e&&(e=1),this.r=t.r,this.g=t.g,this.b=t.b,this.a=e,this},t.prototype.toInt=function(){return(255*this.a<<24)+(255*this.r<<16)+(255*this.g<<8)+255*this.b},t.prototype.toHexString=function(){var t=255*this.r|0,e=255*this.g|0,n=255*this.b|0,i=255*this.a|0;return"#"+pt.ToHex(i)+pt.ToHex(t)+pt.ToHex(e)+pt.ToHex(n)},t.prototype.toRGBA=function(){return"rgba("+255*this.r+","+255*this.g+","+255*this.b+","+this.a+")"},t.prototype.mix=function(t,e){return void 0===e&&(e=.5),this.r=this.r*(1-e)+t.r*e,this.g=this.g*(1-e)+t.g*e,this.b=this.b*(1-e)+t.b*e,this.a=this.a*(1-e)+t.a*e,this},t.prototype.mixTo=function(e,n,i){return void 0===i&&(i=new t),i.copy(this).mix(e,n)},t.prototype.multiply=function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this.a*=t.a,this},t.prototype.multiplyTo=function(e,n){return void 0===n&&(n=new t),n.copy(this).multiply(e)},t.prototype.multiplyNumber=function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this},t.prototype.equals=function(t,e){return void 0===e&&(e=P.PRECISION),!!P.equals(this.r-t.r,0,e)&&(!!P.equals(this.g-t.g,0,e)&&(!!P.equals(this.b-t.b,0,e)&&!!P.equals(this.a-t.a,0,e)))},t.prototype.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},t.prototype.toColor3=function(t){return void 0===t&&(t=new pt),t.r=this.r,t.g=this.g,t.b=this.b,t},t.prototype.toVector4=function(t){return void 0===t&&(t=new dt),t.x=this.r,t.y=this.g,t.z=this.b,t.w=this.a,t},t.prototype.toArray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t[e+3]=this.a,t},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.random=function(t){return void 0===t&&(t=!1),this.r=Math.random(),this.g=Math.random(),this.b=Math.random(),t&&(this.a=Math.random()),this},t.WHITE=Object.freeze(new t(1,1,1,1)),t.BLACK=Object.freeze(new t(0,0,0,1)),st([n(),C],t.prototype,"r",void 0),st([n(),C],t.prototype,"g",void 0),st([n(),C],t.prototype,"b",void 0),st([n(),C],t.prototype,"a",void 0),t}(),vt=function(){function t(){}return t.prototype.linear=function(t,e,n){return e+t*(n-e)},t.prototype.linearDerivative=function(t,e,n){return n-e},t.prototype.linearSecondDerivative=function(t,e,n){return 0},t.prototype.quadratic=function(t,e,n,i){return(1-t)*(1-t)*e+2*(1-t)*t*n+t*t*i},t.prototype.quadraticDerivative=function(t,e,n,i){return 2*(1-t)*(n-e)+2*t*(i-n)},t.prototype.quadraticSecondDerivative=function(t,e,n,i){return 2*(i-2*n+e)},t.prototype.cubic=function(t,e,n,i,r){return(1-t)*(1-t)*(1-t)*e+3*(1-t)*(1-t)*t*n+3*(1-t)*t*t*i+t*t*t*r},t.prototype.cubicDerivative=function(t,e,n,i,r){return 3*(1-t)*(1-t)*(n-e)+6*(1-t)*t*(i-n)+3*t*t*(r-i)},t.prototype.cubicSecondDerivative=function(t,e,n,i,r){return 6*(1-t)*(i-2*n+e)+6*t*(r-2*i+n)},t.prototype.bn=function(t,e,n){void 0===n&&(n=null),e=e.concat(),n&&n.push(e.concat());for(var i=e.length-1;i>0;i--){for(var r=0;r<i;r++)e[r]=(1-t)*e[r]+t*e[r+1];n&&(e.length=e.length-1,n.push(e.concat()))}return e[0]},t.prototype.bnDerivative=function(t,e){if(e.length<2)return 0;for(var n=0,i=(e=e.concat()).length-1;n<i;n++)e[n]=e[n+1]-e[n];return e.length=e.length-1,e.length*this.bn(t,e)},t.prototype.bnSecondDerivative=function(t,e){if(e.length<3)return 0;for(var n=0,i=(e=e.concat()).length-1;n<i;n++)e[n]=e[n+1]-e[n];return e.length=e.length-1,e.length*this.bnDerivative(t,e)},t.prototype.bnND=function(t,e,n){if(n.length<e+1)return 0;var i=1;n=n.concat();for(var r=0;r<e;r++){for(var o=0,a=n.length-1;o<a;o++)n[o]=n[o+1]-n[o];n.length=n.length-1,i*=n.length}return i*this.bn(t,n)},t.prototype.getValue=function(t,e){return 2===e.length?this.linear(t,e[0],e[1]):3===e.length?this.quadratic(t,e[0],e[1],e[2]):4===e.length?this.cubic(t,e[0],e[1],e[2],e[3]):this.bn(t,e)},t.prototype.getDerivative=function(t,e){return 2===e.length?this.linearDerivative(t,e[0],e[1]):3===e.length?this.quadraticDerivative(t,e[0],e[1],e[2]):4===e.length?this.cubicDerivative(t,e[0],e[1],e[2],e[3]):this.bnDerivative(t,e)},t.prototype.getSecondDerivative=function(t,e){return 2===e.length?this.linearSecondDerivative(t,e[0],e[1]):3===e.length?this.quadraticSecondDerivative(t,e[0],e[1],e[2]):4===e.length?this.cubicSecondDerivative(t,e[0],e[1],e[2],e[3]):this.bnSecondDerivative(t,e)},t.prototype.getExtremums=function(t,e,n){var i=this;void 0===e&&(e=10),void 0===n&&(n=1e-7);for(var r=[],o=0;o<=e;o++)r.push(this.getDerivative(o/e,t));for(var a=[],s=[],u=(o=0,e);o<u;o++)if(r[o]*r[o+1]<0){var c=$.line((function(e){return i.getDerivative(e,t)}),o/e,(o+1)/e,n);a.push(c),s.push(this.getValue(c,t))}return{ts:a,vs:s}},t.prototype.getMonotoneIntervals=function(t,e,n){void 0===e&&(e=10),void 0===n&&(n=1e-7);for(var i=[0,1],r=[t[0],t[t.length-1]],o=this.getExtremums(t,e,n),a=0;a<o.ts.length;a++)i.splice(a+1,0,o.ts[a]),r.splice(a+1,0,o.vs[a]);return{ts:i,vs:r}},t.prototype.getTFromValue=function(t,e,n,i){var r=this;void 0===n&&(n=10),void 0===i&&(i=1e-7);for(var o=this.getMonotoneIntervals(e,n,i),a=o.ts,s=o.vs,u=[],c=0,l=s.length-1;c<l;c++)if((s[c]-t)*(s[c+1]-t)<=0){var h=$.line((function(n){return r.getValue(n,e)-t}),a[c],a[c+1],i);u.push(h)}return u},t.prototype.split=function(t,e){var n=[];gt.bn(t,e,n);for(var i=[],r=[],o=n.length-1;o>=0;o--)o===n.length-1?(i.push(n[o][0]),i.push(n[o][0])):(i.unshift(n[o][0]),r.push(n[o].pop()));return[i,r]},t.prototype.merge=function(t,e,n){void 0===n&&(n=0),t=t.concat(),e=e.concat();for(var i,r,o,a=[],s=0,u=t.length;s<u;s++)if(o=a[s]=[],0===s)a[s][0]=t.pop(),e.shift();else if(1===s)a[s][0]=t.pop(),a[s][1]=e.shift(),i=(a[s-1][0]-a[s][0])/(a[s][1]-a[s][0]);else{r=a[s-1];var c=t.pop(),l=e.shift(),h=[];h[0]=c;for(var p=0,f=r.length;p<f;p++)h[p+1]=h[p]+(r[p]-h[p])/i;var d=[];d[r.length]=l;for(p=r.length-1;p>=0;p--)d[p]=d[p+1]-(d[p+1]-r[p])/(1-i);if(1===n){p=0;for(var m=h.length-1;p<=m;p++)o[p]=(h[p]*(m-p)+d[p]*p)/m}else if(0===n){p=0;for(var y=h.length-1;p<=y;p++)o[p]=p<y/2?h[p]:p>y/2?d[p]:(h[p]+d[p])/2}else console.error("合并类型 mergeType "+n+" 错误!")}return a.pop()},t.prototype.getSamples=function(t,e){void 0===e&&(e=100);for(var n=[],i=0;i<=e;i++){var r=i/e,o=this.getValue(r,t);n.push({t:r,v:o})}return n},t}(),gt=new vt;t.WrapMode=void 0,(mt=t.WrapMode||(t.WrapMode={}))[mt.Clamp=1]="Clamp",mt[mt.Loop=2]="Loop",mt[mt.PingPong=4]="PingPong",mt[mt.Once=5]="Once",mt[mt.Default=6]="Default";var _t,bt=function(){function e(){this.maxtan=1e3,this.preWrapMode=t.WrapMode.Clamp,this.postWrapMode=t.WrapMode.Clamp,this.keys=[{time:0,value:1,inTangent:0,outTangent:0}]}return Object.defineProperty(e.prototype,"numKeys",{get:function(){return this.keys.length},enumerable:!1,configurable:!0}),e.prototype.addKey=function(t){this.keys.push(t),this.sort()},e.prototype.sort=function(){this.keys.sort((function(t,e){return t.time-e.time}))},e.prototype.deleteKey=function(t){var e=this.keys.indexOf(t);-1!==e&&this.keys.splice(e,1)},e.prototype.getKey=function(t){return this.keys[t]},e.prototype.indexOfKeys=function(t){return this.keys.indexOf(t)},e.prototype.getPoint=function(e){var n=t.WrapMode.Clamp,i=0,r=1;this.keys.length>0&&(i=this.keys[0].time),this.keys.length>1&&(r=this.keys[this.keys.length-1].time);var o=r-i,a=2*o;switch(e<i?n=this.preWrapMode:e>r&&(n=this.postWrapMode),n){case t.WrapMode.Clamp:e=P.clamp(e,i,r);break;case t.WrapMode.Loop:e=((e-i)%o+o)%o+i;break;case t.WrapMode.PingPong:(e=((e-i)%a+a)%a+i)>r&&(e=r-(e-r))}for(var s=this.keys,u=this.maxtan,c=0,l=0,h=!1,p=0,f=s.length;p<f;p++){var d=s[p],m=s[p-1];if(p>0&&m.time<=e&&e<=d.time){var y=m.time,v=m.value,g=m.outTangent,_=d.time,b=d.value,x=d.inTangent;if(u>Math.abs(g)&&u>Math.abs(x)){var w=(e-m.time)/(d.time-m.time),S=[v,v+g*(_-y)/3,b-x*(_-y)/3,b];h=!0,c=gt.getValue(w,S),l=gt.getDerivative(w,S)/(_-y);break}h=!0,c=m.value,l=0;break}if(0===p&&e<=d.time){h=!0,c=d.value,l=0;break}if(p===f-1&&e>=d.time){h=!0,c=d.value,l=0;break}}return 0===s.length?{time:e,value:0,inTangent:0,outTangent:0}:(console.assert(h),{time:e,value:c,inTangent:l,outTangent:l})},e.prototype.getValue=function(t){var e=this.getPoint(t);return e?e.value:0},e.prototype.findKey=function(t,e,n){for(var i=this.keys,r=0;r<i.length;r++)if(Math.abs(i[r].time-t)<n&&Math.abs(i[r].value-e)<n)return i[r];return null},e.prototype.addKeyAtCurve=function(t,e,n){var i=this.getPoint(t);return Math.abs(e-i.value)<n?(this.keys.push(i),this.keys.sort((function(t,e){return t.time-e.time})),i):null},e.prototype.getSamples=function(t){void 0===t&&(t=100);for(var e=[],n=0;n<=t;n++){var i=this.getPoint(n/t);e.push(i)}return e},st([C],e.prototype,"preWrapMode",void 0),st([C],e.prototype,"postWrapMode",void 0),st([C],e.prototype,"keys",void 0),e}(),xt=function(){function t(){this.xCurve=new bt,this.yCurve=new bt,this.zCurve=new bt}return t.prototype.getValue=function(t){return new ht(this.xCurve.getValue(t),this.yCurve.getValue(t),this.zCurve.getValue(t))},st([C],t.prototype,"xCurve",void 0),st([C],t.prototype,"yCurve",void 0),st([C],t.prototype,"zCurve",void 0),t}();t.MinMaxCurveMode=void 0,(_t=t.MinMaxCurveMode||(t.MinMaxCurveMode={}))[_t.Constant=0]="Constant",_t[_t.Curve=1]="Curve",_t[_t.TwoConstants=3]="TwoConstants",_t[_t.TwoCurves=2]="TwoCurves";var wt,St,Pt,Mt=function(){function e(){this.mode=t.MinMaxCurveMode.Constant,this.constant=0,this.constantMin=0,this.constantMax=0,this.curve=new bt,this.curveMin=new bt,this.curveMax=new bt,this.curveMultiplier=1,this.between0And1=!1}return e.prototype.getValue=function(e,n){switch(void 0===n&&(n=Math.random()),this.mode){case t.MinMaxCurveMode.Constant:return this.constant;case t.MinMaxCurveMode.Curve:return this.curve.getValue(e)*this.curveMultiplier;case t.MinMaxCurveMode.TwoConstants:return P.lerp(this.constantMin,this.constantMax,n);case t.MinMaxCurveMode.TwoCurves:return P.lerp(this.curveMin.getValue(e),this.curveMax.getValue(e),n)*this.curveMultiplier}return this.constant},st([C],e.prototype,"mode",void 0),st([C],e.prototype,"constant",void 0),st([C],e.prototype,"constantMin",void 0),st([C],e.prototype,"constantMax",void 0),st([C],e.prototype,"curve",void 0),st([C],e.prototype,"curveMin",void 0),st([C],e.prototype,"curveMax",void 0),st([C],e.prototype,"curveMultiplier",void 0),st([C],e.prototype,"between0And1",void 0),e}(),Ct=function(){function t(){this.xCurve=new Mt,this.yCurve=new Mt,this.zCurve=new Mt}return t.prototype.getValue=function(t,e){return void 0===e&&(e=Math.random()),new ht(this.xCurve.getValue(t,e),this.yCurve.getValue(t,e),this.zCurve.getValue(t,e))},st([C],t.prototype,"xCurve",void 0),st([C],t.prototype,"yCurve",void 0),st([C],t.prototype,"zCurve",void 0),t}();t.CoordinateSystem=void 0,(wt=t.CoordinateSystem||(t.CoordinateSystem={}))[wt.LEFT_HANDED=0]="LEFT_HANDED",wt[wt.RIGHT_HANDED=1]="RIGHT_HANDED",P.DefaultCoordinateSystem=t.CoordinateSystem.LEFT_HANDED,t.PlaneClassification=void 0,(St=t.PlaneClassification||(t.PlaneClassification={}))[St.BACK=0]="BACK",St[St.FRONT=1]="FRONT",St[St.INTERSECT=2]="INTERSECT",t.RotationOrder=void 0,(Pt=t.RotationOrder||(t.RotationOrder={}))[Pt.XYZ=0]="XYZ",Pt[Pt.ZXY=1]="ZXY",Pt[Pt.ZYX=2]="ZYX",Pt[Pt.YXZ=3]="YXZ",Pt[Pt.YZX=4]="YZX",Pt[Pt.XZY=5]="XZY",P.DefaultRotationOrder=t.RotationOrder.YXZ;var Tt=function(){function t(t,e){this.origin=t||new ht,this.direction=(e||new ht(0,0,1)).normalize()}return t.fromPoints=function(e,n){return(new t).fromPoints(e,n)},t.fromPosAndDir=function(e,n){return(new t).fromPosAndDir(e,n)},t.random=function(){return new t(ht.random(),ht.random())},t.prototype.fromPoints=function(t,e){return this.origin=t,this.direction=e.subTo(t).normalize(),this},t.prototype.fromPosAndDir=function(t,e){return this.origin=t,this.direction=e.normalize(),this},t.prototype.getPoint=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=new ht),e.copy(this.direction).scaleNumber(t).add(this.origin)},t.prototype.getPointWithZ=function(t,e){return void 0===e&&(e=new ht),this.getPoint((t-this.origin.z)/this.direction.z,e)},t.prototype.distanceWithPoint=function(t){return this.closestPointWithPoint(t).sub(t).length},t.prototype.closestPointParameterWithPoint=function(t){return t.subTo(this.origin).dot(this.direction)},t.prototype.closestPointWithPoint=function(t,e){void 0===e&&(e=new ht);var n=this.closestPointParameterWithPoint(t);return this.getPoint(n,e)},t.prototype.onWithPoint=function(t,e){return void 0===e&&(e=P.PRECISION),!!P.equals(this.distanceWithPoint(t),0,e)},t.prototype.intersectWithLine3D=function(t){if(this.equals(t))return this.clone();if(this.direction.isParallel(t.direction))return null;var e=this.getPlane().intersectWithLine3(t);return this.onWithPoint(e)?e:null},t.prototype.applyMatri4x4=function(t){return t.transformPoint3(this.origin,this.origin),t.transformVector3(this.direction,this.direction),this},t.prototype.equals=function(t,e){return void 0===e&&(e=P.PRECISION),!!this.onWithPoint(t.origin,e)&&!!this.onWithPoint(t.origin.addTo(t.direction),e)},t.prototype.copy=function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},t.prototype.clone=function(){return(new t).copy(this)},t}(),At=function(){function e(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=0),this.a=t,this.b=e,this.c=n,this.d=i}return e.fromPoints=function(t,n,i){return(new e).fromPoints(t,n,i)},e.fromNormalAndPoint=function(t,n){return(new e).fromNormalAndPoint(t,n)},e.random=function(){var t=ht.random().normalize();return new e(t.x,t.y,t.z,Math.random())},e.prototype.set=function(t,e,n,i){return this.a=t,this.b=e,this.c=n,this.d=i,this},e.prototype.getOrigin=function(t){return void 0===t&&(t=new ht),this.projectPoint(new ht,t)},e.prototype.randomPoint=function(t){return void 0===t&&(t=new ht),this.getOrigin(t).add(this.getNormal().cross(ht.random()))},e.prototype.getNormal=function(t){return void 0===t&&(t=new ht),t.set(this.a,this.b,this.c)},e.prototype.fromPoints=function(t,e,n){var i=e.subTo(t).crossTo(n.subTo(e)).normalize();return this.a=i.x,this.b=i.y,this.c=i.z,this.d=-i.dot(t),this},e.prototype.fromNormalAndPoint=function(t,e){return t=t.clone().normalize(),this.a=t.x,this.b=t.y,this.c=t.z,this.d=-t.dot(e),this},e.prototype.distanceWithPoint=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d},e.prototype.onWithPoint=function(t,e){return void 0===e&&(e=P.PRECISION),P.equals(this.distanceWithPoint(t),0,e)},e.prototype.classifyPoint=function(e,n){void 0===n&&(n=P.PRECISION);var i=this.distanceWithPoint(e);return P.equals(i,0,n)?t.PlaneClassification.INTERSECT:i<0?t.PlaneClassification.BACK:t.PlaneClassification.FRONT},e.prototype.parallelWithLine3D=function(t,e){return void 0===e&&(e=P.PRECISION),!!P.equals(t.direction.dot(this.getNormal()),0,e)},e.prototype.parallelWithPlane3D=function(t,e){return void 0===e&&(e=P.PRECISION),!!t.getNormal().isParallel(this.getNormal(),e)},e.prototype.intersectWithLine3=function(t){var e=this.getNormal(),n=t.direction.dot(e);if(P.equals(n,0))return this.onWithPoint(t.origin)?t.clone():null;var i=(-this.d-t.origin.dot(e))/n;return t.getPoint(i)},e.prototype.intersectWithPlane3D=function(t){if(this.parallelWithPlane3D(t))return null;var e,n,i,r=this.getNormal().crossTo(t.getNormal()),o=this.a,a=this.b,s=this.c,u=this.d,c=t.a,l=t.b,h=t.c,p=t.d;if(l*s-a*h!=0)n=(-s*p+h*u+(o*h-c*s)*(e=0))/(l*s-a*h),i=(-l*u+a*p+(c*a-o*l)*e)/(l*s-a*h);else if(o*h-c*s!=0)e=(-h*u+s*p+(l*s-a*h)*(n=0))/(o*h-c*s),i=(-o*p+c*u+(c*a-o*l)*n)/(o*h-c*s);else{if(c*a-o*l==0)throw"无法计算平面相交结果";e=(-a*p+l*u+(l*s-a*h)*(i=0))/(c*a-o*l),n=(-c*u+o*p+(o*h-c*s)*i)/(c*a-o*l)}return new Tt(new ht(e,n,i),r)},e.prototype.normalize=function(){var t=this.a,e=this.b,n=this.c,i=this.d,r=t*t+e*e+n*n;if(r>0){var o=1/Math.sqrt(r);this.a=t*o,this.b=e*o,this.c=n*o,this.d=i*o}else console.warn("无效平面 "+this);return this},e.prototype.negate=function(){return this.a=-this.a,this.b=-this.b,this.c=-this.c,this.d=-this.d,this},e.prototype.projectPoint=function(t,e){return void 0===e&&(e=new ht),this.getNormal(e).scaleNumber(-this.distanceWithPoint(t)).add(t)},e.prototype.closestPointWithPoint=function(t,e){return void 0===e&&(e=new ht),this.projectPoint(t,e)},e.prototype.intersectWithTwoPlane3D=function(t,e){var n=t.getNormal(),i=e.getNormal(),r=this.getNormal(),o=-t.d,a=-e.d,s=-this.d,u=n.crossTo(i),c=i.crossTo(r),l=r.crossTo(n),h=u.dot(r);return P.equals(h,0)?null:(h=1/h,c.scaleNumberTo(o).add(l.scaleNumber(a)).add(u.scaleNumber(s)).scaleNumber(h))},e.prototype.equals=function(t,e){return void 0===e&&(e=P.PRECISION),!!P.equals(this.a-t.a,0,e)&&(!!P.equals(this.b-t.b,0,e)&&(!!P.equals(this.c-t.c,0,e)&&!!P.equals(this.d-t.d,0,e)))},e.prototype.copy=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this},e.prototype.clone=function(){return(new e).copy(this)},e.prototype.toString=function(){return"Plane3D [this.a:"+this.a+", this.b:"+this.b+", this.c:"+this.c+", this.d:"+this.d+"]"},e}();Tt.prototype.getPlane=function(t){return void 0===t&&(t=new At),t.fromNormalAndPoint(ht.random().cross(this.direction),this.origin)};var Ot=function(){function t(t,e){void 0===t&&(t=new ht),void 0===e&&(e=new ht),this.p0=t,this.p1=e}return t.fromPoints=function(e,n){return new t(e,n)},t.random=function(){return new t(ht.random(),ht.random())},t.prototype.getLength=function(){return Math.sqrt(this.getLengthSquared())},t.prototype.getLengthSquared=function(){return this.p0.distanceSquared(this.p1)},t.prototype.getLine=function(t){return void 0===t&&(t=new Tt),t.fromPoints(this.p0.clone(),this.p1.clone())},t.prototype.getPoint=function(t,e){return void 0===e&&(e=new ht),e.copy(this.p0).add(this.p1.subTo(this.p0).scaleNumber(t))},t.prototype.onWithPoint=function(t,e){return void 0===e&&(e=P.PRECISION),P.equals(this.getPointDistance(t),0,e)},t.prototype.projectOnWithPoint=function(t){var e=this.getPositionByPoint(t);return(e=Number(e.toFixed(6)))>=0&&e<=1},t.prototype.getPositionByPoint=function(t){var e=this.p1.subTo(this.p0);return t.subTo(this.p0).dot(e)/e.lengthSquared},t.prototype.getNormalWithPoint=function(t){var e=this.p1.subTo(this.p0),n=t.subTo(this.p0);return e.crossTo(n).crossTo(e).normalize()},t.prototype.getPointDistanceSquare=function(t){var e,n=this.getPositionByPoint(t);if(n<=0)e=t.subTo(this.p0).lengthSquared;else if(n>=1)e=t.subTo(this.p1).lengthSquared;else{var i=t.subTo(this.p0).lengthSquared,r=n*n*this.p1.subTo(this.p0).lengthSquared;e=Math.abs(i-r)}return e},t.prototype.getPointDistance=function(t){var e=this.getPointDistanceSquare(t);return e=Math.sqrt(e)},t.prototype.intersectionWithLine=function(t){var e=this.getLine().intersectWithLine3D(t);return e?e instanceof Tt?this.clone():this.onWithPoint(e)?e:null:null},t.prototype.intersectionWithSegment=function(e){var n=this.intersectionWithLine(e.getLine());if(!n)return null;if(n instanceof t){var i=[this.p0,this.p1].map((function(t){return e.clampPoint(t)}));return this.onWithPoint(i[0])?t.fromPoints(i[0],i[1]):null}return this.onWithPoint(n)?n:null},t.prototype.closestPointWithPoint=function(t,e){return void 0===e&&(e=new ht),this.getLine().closestPointWithPoint(t,e),this.onWithPoint(e)?e:t.distanceSquared(this.p0)<t.distanceSquared(this.p1)?e.copy(this.p0):e.copy(this.p1)},t.prototype.clampPoint=function(t,e){return void 0===e&&(e=new ht),this.getPoint(P.clamp(this.getPositionByPoint(t),0,1),e)},t.prototype.equals=function(t){return this.p0.equals(t.p0)&&this.p1.equals(t.p1)||this.p0.equals(t.p1)&&this.p1.equals(t.p0)},t.prototype.copy=function(t){return this.p0.copy(t.p0),this.p1.copy(t.p1),this},t.prototype.clone=function(){return(new t).copy(this)},t}(),Et=function(){function t(t,e,n){void 0===t&&(t=new ht),void 0===e&&(e=new ht),void 0===n&&(n=new ht),this.p0=t,this.p1=e,this.p2=n}return t.fromPoints=function(e,n,i){return(new t).fromPoints(e,n,i)},t.fromPositions=function(e){return(new t).fromPositions(e)},t.random=function(e){return void 0===e&&(e=1),new t(ht.random(e),ht.random(e),ht.random(e))},t.prototype.getPoints=function(){return[this.p0,this.p1,this.p2]},t.prototype.getSegments=function(){return[Ot.fromPoints(this.p0,this.p1),Ot.fromPoints(this.p1,this.p2),Ot.fromPoints(this.p2,this.p0)]},t.prototype.getPlane3d=function(t){return void 0===t&&(t=new At),t.fromPoints(this.p0,this.p1,this.p2)},t.prototype.getNormal=function(t){return void 0===t&&(t=new ht),t.copy(this.p1).sub(this.p0).cross(this.p2.subTo(this.p1)).normalize()},t.prototype.getBarycenter=function(t){return void 0===t&&(t=new ht),t.copy(this.p0).add(this.p1).add(this.p2).scaleNumber(1/3)},t.prototype.getCircumcenter=function(t){void 0===t&&(t=new ht);var e=this.p2.subTo(this.p1),n=this.p0.subTo(this.p2),i=this.p1.subTo(this.p0),r=2*i.crossTo(e).lengthSquared,o=-e.dot(e)*i.dot(n)/r,a=-n.dot(n)*i.dot(e)/r,s=-i.dot(i)*n.dot(e)/r;return t.copy(this.p0).scaleNumber(o).add(this.p1.scaleNumberTo(a)).add(this.p2.scaleNumberTo(s))},t.prototype.getInnercenter=function(t){void 0===t&&(t=new ht);var e=this.p2.subTo(this.p1).length,n=this.p0.subTo(this.p2).length,i=this.p1.subTo(this.p0).length;return t.copy(this.p0).scaleNumber(e).add(this.p1.scaleNumberTo(n)).add(this.p2.scaleNumberTo(i)).scaleNumber(1/(e+n+i))},t.prototype.getOrthocenter=function(t){void 0===t&&(t=new ht);var e=this.p2.subTo(this.p1),n=this.p0.subTo(this.p2),i=this.p1.subTo(this.p0),r=e.dot(n)*e.dot(i),o=n.dot(i)*n.dot(e),a=i.dot(e)*i.dot(n);return t.copy(this.p0).scaleNumber(r).add(this.p1.scaleNumberTo(o)).add(this.p2.scaleNumberTo(a)).scaleNumber(1/(r+o+a))},t.prototype.fromPoints=function(t,e,n){return this.p0=t,this.p1=e,this.p2=n,this},t.prototype.fromPositions=function(t){return this.p0.set(t[0],t[1],t[2]),this.p1.set(t[3],t[4],t[5]),this.p2.set(t[6],t[7],t[8]),this},t.prototype.getPoint=function(t,e){return void 0===e&&(e=new ht),e.copy(this.p0).scaleNumber(t.x).add(this.p1.scaleNumberTo(t.y)).add(this.p2.scaleNumberTo(t.z))},t.prototype.randomPoint=function(t){void 0===t&&(t=new ht);var e=Math.random(),n=Math.random()*(1-e),i=1-e-n;return this.getPoint(new ht(e,n,i),t)},t.prototype.intersectionWithLine=function(t){var e=this.getPlane3d().intersectWithLine3(t);if(!e)return null;if(e instanceof ht)return this.onWithPoint(e)?e:null;var n=null,i=this.getSegments().reduce((function(e,i){var r=i.intersectionWithLine(t);return r?r instanceof Ot?(n=r,e):(e.push(r),e):e}),[]);return n||(0===i.length?null:1===i.length||i[0].equals(i[1])?i[0]:Ot.fromPoints(i[0],i[1]))},t.prototype.intersectionWithSegment=function(t){var e=this.intersectionWithLine(t.getLine());if(!e)return null;if(e instanceof ht)return t.onWithPoint(e)?e:null;var n=t.clampPoint(e.p0),i=t.clampPoint(e.p1);return e.onWithPoint(n)?n.equals(i)?n:Ot.fromPoints(n,i):null},t.prototype.onWithPoint=function(t,e){void 0===e&&(e=P.PRECISION);var n=this.p0,i=this.p1,r=this.p2,o=n.subTo(i).cross(i.subTo(r)).dot(t.subTo(n));if(!P.equals(o,0,e))return!1;var a=this.getBarycentricCoordinates(t);return e=-e,!(a.x<e||a.y<e||a.z<e)},t.prototype.getBarycentricCoordinates=function(t,e){void 0===e&&(e=new ht);var n,i,r,o,a,s,u,c,l=this.p0.x,h=this.p0.y,p=this.p0.z,f=this.p1.x,d=this.p1.y,m=this.p1.z,y=this.p2.x,v=this.p2.y,g=this.p2.z,_=f-l,b=d-h,x=m-p,w=y-f,S=v-d,P=g-m,M=b*P-x*S,C=x*w-_*P,T=_*S-b*w;Math.abs(M)>=Math.abs(C)&&Math.abs(M)>=Math.abs(T)?(n=h-v,i=d-v,r=t.y-h,o=t.y-v,a=p-g,s=m-g,u=t.z-p,c=t.z-g):Math.abs(C)>=Math.abs(T)?(n=p-g,i=m-g,r=t.z-p,o=t.z-g,a=l-y,s=f-y,u=t.x-l,c=t.x-y):(n=l-y,i=f-y,r=t.x-l,o=t.x-y,a=h-v,s=d-v,u=t.y-h,c=t.y-v);var A=1/(a*i-s*n);return e.x=(c*i-s*o)*A,e.y=(a*r-u*n)*A,e.z=1-e.x-e.y,e},t.prototype.blendWithPoint=function(t){var e=this.p1.subTo(this.p0).crossTo(this.p2.subTo(this.p1)),n=e.length;e.normalize();var i=this.p1.subTo(t).crossTo(this.p2.subTo(this.p1)),r=i.length;i.normalize();var o=r/n*e.dot(i),a=this.p2.subTo(t).crossTo(this.p0.subTo(this.p2)),s=a.length;a.normalize();var u=s/n*e.dot(a),c=this.p0.subTo(t).crossTo(this.p1.subTo(this.p0)),l=c.length;c.normalize();var h=l/n*e.dot(c);return new ht(o,u,h)},t.prototype.closestPointWithPoint=function(t,e){if(void 0===e&&(e=new ht),this.getPlane3d().closestPointWithPoint(t,e),this.onWithPoint(e))return e;var n=this.getSegments().map((function(e){var n=e.closestPointWithPoint(t);return{point:n,d:t.distanceSquared(n)}})).sort((function(t,e){return t.d-e.d}))[0].point;return e.copy(n)},t.prototype.distanceWithPoint=function(t){return this.closestPointWithPoint(t).distance(t)},t.prototype.distanceSquaredWithPoint=function(t){return this.closestPointWithPoint(t).distanceSquared(t)},t.prototype.decomposeWithPoint=function(e){return this.onWithPoint(e)?this.p0.equals(e)||this.p1.equals(e)||this.p2.equals(e)?[this]:Ot.fromPoints(this.p0,this.p1).onWithPoint(e)?[t.fromPoints(this.p0,e,this.p2),t.fromPoints(e,this.p1,this.p2)]:Ot.fromPoints(this.p1,this.p2).onWithPoint(e)?[t.fromPoints(this.p1,e,this.p0),t.fromPoints(e,this.p2,this.p0)]:Ot.fromPoints(this.p2,this.p0).onWithPoint(e)?[t.fromPoints(this.p2,e,this.p1),t.fromPoints(e,this.p0,this.p1)]:[t.fromPoints(e,this.p0,this.p1),t.fromPoints(e,this.p1,this.p2),t.fromPoints(e,this.p2,this.p0)]:[this]},t.prototype.decomposeWithPoints=function(t){return t.reduce((function(t,e){return t=t.reduce((function(t,n){return t.concat(n.decomposeWithPoint(e))}),[])}),[this])},t.prototype.decomposeWithSegment=function(t){var e=this.intersectionWithSegment(t);return e?e instanceof ht?this.decomposeWithPoint(e):this.decomposeWithPoints([e.p0,e.p1]):[this]},t.prototype.decomposeWithLine=function(t){var e=this.intersectionWithLine(t);return e?e instanceof ht?this.decomposeWithPoint(e):this.decomposeWithPoints([e.p0,e.p1]):[this]},t.prototype.area=function(){return.5*this.p1.subTo(this.p0).crossTo(this.p2.subTo(this.p1)).length},t.prototype.rasterize=function(){var t={min:this.p0.clone().min(this.p1).min(this.p2),max:this.p0.clone().max(this.p1).max(this.p2)};t.min.round(),t.max.round();for(var e=new ht,n=[],i=t.min.x;i<=t.max.x;i++)for(var r=t.min.y;r<=t.max.y;r++)for(var o=t.min.z;o<=t.max.z;o++){this.onWithPoint(e.set(i,r,o),.5)&&n.push(i,r,o)}return n},t.prototype.translateVector3=function(t){return this.p0.add(t),this.p1.add(t),this.p2.add(t),this},t.prototype.scaleVector3=function(t){return this.p0.scale(t),this.p1.scale(t),this.p2.scale(t),this},t.prototype.rasterizeCustom=function(t,e){void 0===t&&(t=new ht(1,1,1)),void 0===e&&(e=new ht);var n=this.clone().translateVector3(e.negateTo()).scaleVector3(t.inverseTo()).rasterize(),i=new ht,r=[];return n.forEach((function(o,a){a%3==0&&(i.set(n[a],n[a+1],n[a+2]).scale(t).add(e),r.push({xi:n[a],yi:n[a+1],zi:n[a+2],xv:i.x,yv:i.y,zv:i.z}))})),r},t.prototype.copy=function(t){return this.p0.copy(t.p0),this.p1.copy(t.p1),this.p2.copy(t.p2),this},t.prototype.clone=function(){return(new t).copy(this)},t.containsPoint=function(e,n,i,r){return new t(e,n,i).onWithPoint(r)},t}(),Dt=function(){function t(t,e){void 0===t&&(t=new ht(Number(1/0),Number(1/0),Number(1/0))),void 0===e&&(e=new ht(-1/0,-1/0,-1/0)),this.min=t,this.max=e}return t.formPositions=function(e){return(new t).formPositions(e)},t.fromPoints=function(e){return(new t).fromPoints(e)},t.random=function(){var e=ht.random();return new t(e,ht.random().add(e))},t.prototype.getCenter=function(t){return void 0===t&&(t=new ht),t.copy(this.min).add(this.max).scaleNumber(.5)},t.prototype.getSize=function(t){return void 0===t&&(t=new ht),this.isEmpty()?t.set(0,0,0):this.max.subTo(this.min,t)},t.prototype.init=function(t,e){return this.min=t,this.max=e,this},t.prototype.scale=function(t){return this.min.scale(t),this.max.scale(t),this},t.prototype.toPoints=function(t){t||(t=[new ht,new ht,new ht,new ht,new ht,new ht,new ht,new ht]);var e=this.min,n=this.max;return t[0].set(e.x,e.y,e.z),t[1].set(n.x,e.y,e.z),t[2].set(e.x,n.y,e.z),t[3].set(e.x,e.y,n.z),t[4].set(e.x,n.y,n.z),t[5].set(n.x,e.y,n.z),t[6].set(n.x,n.y,e.z),t[7].set(n.x,n.y,n.z),t},t.prototype.formPositions=function(t){for(var e=Number(1/0),n=Number(1/0),i=Number(1/0),r=-1/0,o=-1/0,a=-1/0,s=0,u=t.length;s<u;s+=3){var c=t[s],l=t[s+1],h=t[s+2];c<e&&(e=c),l<n&&(n=l),h<i&&(i=h),c>r&&(r=c),l>o&&(o=l),h>a&&(a=h)}return this.min.set(e,n,i),this.max.set(r,o,a),this},t.prototype.fromPoints=function(t){var e=this;return this.empty(),t.forEach((function(t){e.expandByPoint(t)})),this},t.prototype.randomPoint=function(t){return void 0===t&&(t=new ht),t.copy(this.min).lerp(this.max,ht.random())},t.prototype.expandByPoint=function(t){return this.min.min(t),this.max.max(t),this},t.prototype.applyMatrix=function(t){if(this.isEmpty())return this;var e=this.toPoints().map((function(e){return e.applyMatrix4x4(t)}));return this.fromPoints(e),this},t.prototype.applyMatrixTo=function(e,n){return void 0===n&&(n=new t),n.copy(this).applyMatrix(e)},t.prototype.clone=function(){return new t(this.min.clone(),this.max.clone())},t.prototype.containsPoint=function(t){return this.min.lessequal(t)&&this.max.greaterequal(t)},t.prototype.contains=function(t){return this.min.lessequal(t.min)&&this.max.greaterequal(t.max)},t.prototype.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},t.prototype.equals=function(t){return this.min.equals(t.min)&&this.max.equals(t.max)},t.prototype.translate=function(t){return this.min.add(t),this.max.add(t),this},t.prototype.inflate=function(t,e,n){this.min.x-=t/2,this.min.y-=e/2,this.min.z-=n/2,this.max.x+=t/2,this.max.y+=e/2,this.max.z+=n/2},t.prototype.inflatePoint=function(t){t=t.scaleNumberTo(.5),this.min.sub(t),this.max.add(t)},t.prototype.intersection=function(t){var e=this.min.clampTo(t.min,t.max),n=this.max.clampTo(t.min,t.max);return this.containsPoint(e)?(this.min.copy(e),this.max.copy(n),this):null},t.prototype.intersectionTo=function(e,n){return void 0===n&&(n=new t),n.copy(this).intersection(e)},t.prototype.intersects=function(t){var e=this.intersectionTo(t).getCenter();return this.containsPoint(e)&&t.containsPoint(e)},t.prototype.rayIntersection=function(t,e,n){if(this.isEmpty())return Number.MAX_VALUE;if(this.containsPoint(t))return 0;var i,r,o,a=(this.max.x-this.min.x)/2,s=(this.max.y-this.min.y)/2,u=(this.max.z-this.min.z)/2,c=this.min.x+a,l=this.min.y+s,h=this.min.z+u,p=t.x-c,f=t.y-l,d=t.z-h,m=e.x,y=e.y,v=e.z,g=Number.MAX_VALUE,_=!1;return m<0&&(g=(a-p)/m)>0&&(o=d+g*v,(r=f+g*y)>-s&&r<s&&o>-u&&o<u&&(n&&(n.x=1,n.y=0,n.z=0),_=!0)),!_&&m>0&&(g=(-a-p)/m)>0&&(o=d+g*v,(r=f+g*y)>-s&&r<s&&o>-u&&o<u&&(n&&(n.x=-1,n.y=0,n.z=0),_=!0)),!_&&y<0&&(g=(s-f)/y)>0&&(o=d+g*v,(i=p+g*m)>-a&&i<a&&o>-u&&o<u&&(n&&(n.x=0,n.y=1,n.z=0),_=!0)),!_&&y>0&&(g=(-s-f)/y)>0&&(o=d+g*v,(i=p+g*m)>-a&&i<a&&o>-u&&o<u&&(n&&(n.x=0,n.y=-1,n.z=0),_=!0)),!_&&v<0&&(g=(u-d)/v)>0&&(i=p+g*m,(r=f+g*y)>-s&&r<s&&i>-a&&i<a&&(n&&(n.x=0,n.y=0,n.z=1),_=!0)),!_&&v>0&&(g=(-u-d)/v)>0&&(i=p+g*m,(r=f+g*y)>-s&&r<s&&i>-a&&i<a&&(n&&(n.x=0,n.y=0,n.z=-1),_=!0)),_?g:Number.MAX_VALUE},t.prototype.closestPointToPoint=function(t,e){return void 0===e&&(e=new ht),this.clampPoint(t,e)},t.prototype.empty=function(){return this.min.x=this.min.y=this.min.z=Number(1/0),this.max.x=this.max.y=this.max.z=-1/0,this},t.prototype.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},t.prototype.offset=function(t,e,n){return this.offsetPosition(new ht(t,e,n))},t.prototype.offsetPosition=function(t){return this.min.add(t),this.max.add(t),this},t.prototype.toString=function(){return"[AABB] (min="+this.min.toString()+", max="+this.max.toString()+")"},t.prototype.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},t.prototype.intersectsSphere=function(t){var e=new ht;return this.clampPoint(t.center,e),e.distanceSquared(t.center)<=t.radius*t.radius},t.prototype.clampPoint=function(t,e){return void 0===e&&(e=new ht),e.copy(t).clamp(this.min,this.max)},t.prototype.intersectsPlane=function(t){var e=1/0,n=-1/0;return this.toPoints().forEach((function(i){var r=t.distanceWithPoint(i);n=r>(e=r<e?r:e)?r:e})),e<0&&n>0},t.prototype.intersectsTriangle=function(t){if(this.isEmpty())return!1;var e=this.getCenter(),n=this.max.subTo(e),i=t.p0.subTo(e),r=t.p1.subTo(e),o=t.p2.subTo(e),a=r.subTo(i),s=o.subTo(r),u=i.subTo(o),c=[0,-a.z,a.y,0,-s.z,s.y,0,-u.z,u.y,a.z,0,-a.x,s.z,0,-s.x,u.z,0,-u.x,-a.y,a.x,0,-s.y,s.x,0,-u.y,u.x,0];if(!zt(c,i,r,o,n))return!1;if(!zt(c=[1,0,0,0,1,0,0,0,1],i,r,o,n))return!1;var l=a.crossTo(s);return zt(c=[l.x,l.y,l.z],i,r,o,n)},t.prototype.overlaps=function(t){var e=this.min,n=this.max,i=t.min,r=t.max,o=i.x<=n.x&&n.x<=r.x||e.x<=r.x&&r.x<=n.x,a=i.y<=n.y&&n.y<=r.y||e.y<=r.y&&r.y<=n.y,s=i.z<=n.z&&n.z<=r.z||e.z<=r.z&&r.z<=n.z;return o&&a&&s},t.prototype.toTriangles=function(t){void 0===t&&(t=[]);var e=this.min,n=this.max;return t.push(Et.fromPoints(new ht(e.x,e.y,e.z),new ht(e.x,n.y,e.z),new ht(n.x,n.y,e.z)),Et.fromPoints(new ht(e.x,e.y,e.z),new ht(n.x,n.y,e.z),new ht(n.x,e.y,e.z)),Et.fromPoints(new ht(e.x,e.y,n.z),new ht(n.x,e.y,n.z),new ht(e.x,n.y,n.z)),Et.fromPoints(new ht(n.x,e.y,n.z),new ht(n.x,n.y,n.z),new ht(e.x,n.y,n.z)),Et.fromPoints(new ht(n.x,e.y,e.z),new ht(n.x,n.y,e.z),new ht(n.x,n.y,n.z)),Et.fromPoints(new ht(n.x,e.y,e.z),new ht(n.x,n.y,n.z),new ht(n.x,e.y,n.z)),Et.fromPoints(new ht(e.x,e.y,n.z),new ht(e.x,n.y,e.z),new ht(e.x,e.y,e.z)),Et.fromPoints(new ht(e.x,e.y,n.z),new ht(e.x,n.y,n.z),new ht(e.x,n.y,e.z)),Et.fromPoints(new ht(e.x,n.y,e.z),new ht(n.x,n.y,n.z),new ht(n.x,n.y,e.z)),Et.fromPoints(new ht(e.x,n.y,e.z),new ht(e.x,n.y,n.z),new ht(n.x,n.y,n.z)),Et.fromPoints(new ht(e.x,e.y,e.z),new ht(n.x,e.y,e.z),new ht(e.x,e.y,n.z)),Et.fromPoints(new ht(n.x,e.y,e.z),new ht(n.x,e.y,n.z),new ht(e.x,e.y,n.z))),t},t}();function zt(t,e,n,i,r){for(var o=0,a=t.length-3;o<=a;o+=3){var s=ht.fromArray(t,o),u=r.x*Math.abs(s.x)+r.y*Math.abs(s.y)+r.z*Math.abs(s.z),c=e.dot(s),l=n.dot(s),h=i.dot(s);if(Math.min(c,l,h)>u||Math.max(c,l,h)<-u)return!1}return!0}var It=function(){function t(t){void 0===t&&(t=[1,0,0,0,1,0,0,0,1]),this.elements=t}return t.prototype.set=function(t){this.elements=t},t.prototype.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this},t.prototype.setZero=function(){var t=this.elements;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,this},t.prototype.setTrace=function(t){var e=this.elements;return e[0]=t.x,e[4]=t.y,e[8]=t.z,this},t.prototype.getTrace=function(t){void 0===t&&(t=new ht);var e=this.elements;return t.x=e[0],t.y=e[4],t.z=e[8],t},t.prototype.vmult=function(t,e){void 0===e&&(e=new ht);var n=this.elements,i=t.x,r=t.y,o=t.z;return e.x=n[0]*i+n[1]*r+n[2]*o,e.y=n[3]*i+n[4]*r+n[5]*o,e.z=n[6]*i+n[7]*r+n[8]*o,e},t.prototype.smult=function(t){for(var e=0;e<this.elements.length;e++)this.elements[e]*=t},t.prototype.mmult=function(e,n){void 0===n&&(n=new t);for(var i=0;i<3;i++)for(var r=0;r<3;r++){for(var o=0,a=0;a<3;a++)o+=e.elements[i+3*a]*this.elements[a+3*r];n.elements[i+3*r]=o}return n},t.prototype.scale=function(e,n){void 0===n&&(n=new t);for(var i=this.elements,r=n.elements,o=0;3!==o;o++)r[3*o+0]=e.x*i[3*o+0],r[3*o+1]=e.y*i[3*o+1],r[3*o+2]=e.z*i[3*o+2];return n},t.prototype.solve=function(t,e){void 0===e&&(e=new ht);var n,i,r=[];for(n=0;n<12;n++)r.push(0);for(n=0;n<3;n++)for(i=0;i<3;i++)r[n+4*i]=this.elements[n+3*i];r[3]=t.x,r[7]=t.y,r[11]=t.z;var o,a,s=3,u=s;do{if(0===r[(n=u-s)+4*n])for(i=n+1;i<u;i++)if(0!==r[n+4*i]){o=4;do{r[(a=4-o)+4*n]+=r[a+4*i]}while(--o);break}if(0!==r[n+4*n])for(i=n+1;i<u;i++){var c=r[n+4*i]/r[n+4*n];o=4;do{r[(a=4-o)+4*i]=a<=n?0:r[a+4*i]-r[a+4*n]*c}while(--o)}}while(--s);if(e.z=r[11]/r[10],e.y=(r[Number(4)+3]-r[Number(4)+2]*e.z)/r[Number(4)+1],e.x=(r[3]-r[2]*e.z-r[1]*e.y)/r[0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw"Could not solve equation! Got x=["+e.toString()+"], b=["+t.toString()+"], A=["+this.toString()+"]";return e},t.prototype.getElement=function(t,e){return this.elements[e+3*t]},t.prototype.setElement=function(t,e,n){this.elements[e+3*t]=n},t.prototype.copy=function(t){for(var e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this},t.prototype.toString=function(){for(var t="",e=0;e<9;e++)t+=this.elements[e]+",";return t},t.prototype.reverse=function(){for(var t,e,n=[],i=0;i<18;i++)n.push(0);for(t=0;t<3;t++)for(e=0;e<3;e++)n[t+6*e]=this.elements[t+3*e];n[3]=1,n[9]=0,n[15]=0,n[4]=0,n[10]=1,n[16]=0,n[5]=0,n[11]=0,n[17]=1;var r,o,a=3,s=a;do{if(0===n[(t=s-a)+6*t])for(e=t+1;e<s;e++)if(0!==n[t+6*e]){r=6;do{n[(o=6-r)+6*t]+=n[o+6*e]}while(--r);break}if(0!==n[t+6*t])for(e=t+1;e<s;e++){var u=n[t+6*e]/n[t+6*t];r=6;do{n[(o=6-r)+6*e]=o<=t?0:n[o+6*e]-n[o+6*t]*u}while(--r)}}while(--a);t=2;do{e=t-1;do{u=n[t+6*e]/n[t+6*t];r=6;do{n[(o=6-r)+6*e]=n[o+6*e]-n[o+6*t]*u}while(--r)}while(e--)}while(--t);t=2;do{u=1/n[t+6*t];r=6;do{n[(o=6-r)+6*t]=n[o+6*t]*u}while(--r)}while(t--);t=2;do{e=2;do{if(o=n[3+e+6*t],isNaN(o)||o===1/0)throw"Could not reverse! A=["+this.toString()+"]";this.setElement(t,e,o)}while(e--)}while(t--);return this},t.prototype.reverseTo=function(e){return void 0===e&&(e=new t),e.copy(this).reverse()},t.prototype.setRotationFromQuaternion=function(t){var e=t.x,n=t.y,i=t.z,r=t.w,o=e+e,a=n+n,s=i+i,u=e*o,c=e*a,l=e*s,h=n*a,p=n*s,f=i*s,d=r*o,m=r*a,y=r*s,v=this.elements;return v[0]=1-(h+f),v[1]=c-y,v[2]=l+m,v[3]=c+y,v[4]=1-(u+f),v[5]=p-d,v[6]=l-m,v[7]=p+d,v[8]=1-(u+h),this},t.prototype.transpose=function(){for(var t=this.elements,e=this.elements.concat(),n=0;3!==n;n++)for(var i=0;3!==i;i++)t[3*n+i]=e[3*i+n];return this},t.prototype.transposeTo=function(e){return void 0===e&&(e=new t),e.copy(this).transpose()},t.prototype.formMatrix4x4=function(t){var e=t.elements,n=this.elements;return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],this},t.prototype.toMatrix4x4=function(t){var e=t.elements,n=this.elements;return e[0]=n[0],e[1]=n[1],e[2]=0,e[3]=0,e[4]=n[3],e[5]=n[4],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=n[6],e[13]=n[7],e[14]=0,e[15]=1,t},t.prototype.toArray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),this.elements.forEach((function(n,i){t[e+i]=n})),t},t}(),jt=function(){function e(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),this.x=0,this.y=0,this.z=0,this.w=1,this.x=t,this.y=e,this.z=n,this.w=i}return e.fromArray=function(t,n){return void 0===n&&(n=0),(new e).fromArray(t,n)},e.random=function(){return(new e).fromEuler(2*Math.PI*Math.random(),2*Math.PI*Math.random(),2*Math.PI*Math.random())},Object.defineProperty(e.prototype,"magnitude",{get:function(){return Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z)},enumerable:!1,configurable:!0}),e.prototype.set=function(t,e,n,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),this.x=t,this.y=e,this.z=n,this.w=i,this},e.prototype.fromArray=function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},e.prototype.toArray=function(t,e){return void 0===e&&(e=0),(t=t||[])[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},e.prototype.mult=function(t){var e=this.x,n=this.y,i=this.z,r=this.w,o=t.x,a=t.y,s=t.z,u=t.w;return this.x=e*u+r*o+n*s-i*a,this.y=n*u+r*a+i*o-e*s,this.z=i*u+r*s+e*a-n*o,this.w=r*u-e*o-n*a-i*s,this},e.prototype.multTo=function(t,n){return void 0===n&&(n=new e),n.copy(this).mult(t)},e.prototype.inverse=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},e.prototype.inverseTo=function(t){return void 0===t&&(t=new e),t.copy(this).inverse()},e.prototype.multiplyVector=function(t,n){void 0===n&&(n=new e);var i=t.x,r=t.y,o=t.z;return n.w=-this.x*i-this.y*r-this.z*o,n.x=this.w*i+this.y*o-this.z*r,n.y=this.w*r-this.x*o+this.z*i,n.z=this.w*o+this.x*r-this.y*i,n},e.prototype.fromAxisAngle=function(t,e){var n=Math.sin(e/2),i=Math.cos(e/2);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=i,this.normalize(),this},e.prototype.toAxisAngle=function(t){void 0===t&&(t=new ht),this.normalize();var e=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/n,t.y=this.y/n,t.z=this.z/n),[t,e]},e.prototype.fromUnitVectors=function(t,e){var n=t.dot(e)+1;if(n<P.PRECISION)n=0,Math.abs(t.x)>Math.abs(t.z)?(this.x=-t.y,this.y=t.x,this.z=0,this.w=n):(this.x=0,this.y=-t.z,this.z=t.y,this.w=n);else{var i=t.crossTo(e);this.x=i.x,this.y=i.y,this.z=i.z,this.w=n}return this.normalize(),this},e.prototype.slerp=function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this.x,i=this.y,r=this.z,o=this.w,a=o*t.w+n*t.x+i*t.y+r*t.z;if(a<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,a=-a):this.copy(t),a>=1)return this.w=o,this.x=n,this.y=i,this.z=r,this;var s=1-a*a;if(s<=Number.EPSILON){var u=1-e;return this.w=u*o+e*this.w,this.x=u*n+e*this.x,this.y=u*i+e*this.y,this.z=u*r+e*this.z,this.normalize(),this}var c=Math.sqrt(s),l=Math.atan2(c,a),h=Math.sin((1-e)*l)/c,p=Math.sin(e*l)/c;return this.w=o*h+this.w*p,this.x=n*h+this.x*p,this.y=i*h+this.y*p,this.z=r*h+this.z*p,this},e.prototype.slerpTo=function(t,n,i){return void 0===i&&(i=new e),t===i&&(t=t.clone()),i.copy(this).slerp(t,n)},e.prototype.lerp=function(t,e,n){var i=t.w,r=t.x,o=t.y,a=t.z,s=e.w,u=e.x,c=e.y,l=e.z;i*s+r*u+o*c+a*l<0&&(s=-s,u=-u,c=-c,l=-l),this.w=i+n*(s-i),this.x=r+n*(u-r),this.y=o+n*(c-o),this.z=a+n*(l-a);var h=1/Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);this.w*=h,this.x*=h,this.y*=h,this.z*=h},e.prototype.toEulerAngles=function(t){(t=t||new ht).x=Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y));var e=2*(this.w*this.y-this.z*this.x);return e=Math.max(-1,Math.min(e,1)),t.y=Math.asin(e),t.z=Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z)),t},e.prototype.normalize=function(t){void 0===t&&(t=1);var e=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=t/(e=Math.sqrt(e)),this.x*=e,this.y*=e,this.z*=e,this.w*=e),this},e.prototype.normalizeFast=function(){var t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t),this},e.prototype.toString=function(){return"{this.x:"+this.x+" this.y:"+this.y+" this.z:"+this.z+" this.w:"+this.w+"}"},e.prototype.fromMatrix=function(t){var e=t.toTRS()[1];return this.fromEuler(e.x,e.y,e.z),this},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.rotatePoint=function(t,e){void 0===e&&(e=new ht);var n=t.x,i=t.y,r=t.z,o=-this.x*n-this.y*i-this.z*r,a=this.w*n+this.y*r-this.z*i,s=this.w*i-this.x*r+this.z*n,u=this.w*r+this.x*i-this.y*n;return e.x=-o*this.x+a*this.w-s*this.z+u*this.y,e.y=-o*this.y+a*this.z+s*this.w-u*this.x,e.z=-o*this.z-a*this.y+s*this.x+u*this.w,e},e.prototype.integrate=function(t,e,n){var i=t.x*n.x,r=t.y*n.y,o=t.z*n.z,a=this.x,s=this.y,u=this.z,c=this.w,l=.5*e;return this.x+=l*(i*c+r*u-o*s),this.y+=l*(r*c+o*a-i*u),this.z+=l*(o*c+i*s-r*a),this.w+=l*(-i*a-r*s-o*u),this},e.prototype.integrateTo=function(t,n,i,r){return void 0===r&&(r=new e),r.copy(this).integrate(t,n,i)},e.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},e.prototype.vmult=function(t,e){void 0===e&&(e=new ht);var n=t.x,i=t.y,r=t.z,o=this.x,a=this.y,s=this.z,u=this.w,c=u*n+a*r-s*i,l=u*i+s*n-o*r,h=u*r+o*i-a*n,p=-o*n-a*i-s*r;return e.x=c*u+p*-o+l*-s-h*-a,e.y=l*u+p*-a+h*-o-c*-s,e.z=h*u+p*-s+c*-a-l*-o,e},e.prototype.toEuler=function(t,e){var n,i,r,o;void 0===e&&(e="YZX");var a=this.x,s=this.y,u=this.z,c=this.w;if("YZX"!==e)throw new Error("Euler order "+e+" not supported yet.");if((o=a*s+u*c)>.499&&(n=2*Math.atan2(a,c),i=Math.PI/2,r=0),o<-.499&&(n=-2*Math.atan2(a,c),i=-Math.PI/2,r=0),isNaN(n)){var l=a*a,h=s*s,p=u*u;n=Math.atan2(2*s*c-2*a*u,1-2*h-2*p),i=Math.asin(2*o),r=Math.atan2(2*a*c-2*s*u,1-2*l-2*p)}t.y=n,t.z=i,t.x=r},e.prototype.fromEuler=function(e,n,i,r){void 0===r&&(r=P.DefaultRotationOrder),e*=P.DEG2RAD,n*=P.DEG2RAD,i*=P.DEG2RAD;var o=Math.cos(e/2),a=Math.cos(n/2),s=Math.cos(i/2),u=Math.sin(e/2),c=Math.sin(n/2),l=Math.sin(i/2);return r===t.RotationOrder.XYZ?(this.x=u*a*s+o*c*l,this.y=o*c*s-u*a*l,this.z=o*a*l+u*c*s,this.w=o*a*s-u*c*l):r===t.RotationOrder.YXZ?(this.x=u*a*s+o*c*l,this.y=o*c*s-u*a*l,this.z=o*a*l-u*c*s,this.w=o*a*s+u*c*l):r===t.RotationOrder.ZXY?(this.x=u*a*s-o*c*l,this.y=o*c*s+u*a*l,this.z=o*a*l+u*c*s,this.w=o*a*s-u*c*l):r===t.RotationOrder.ZYX?(this.x=u*a*s-o*c*l,this.y=o*c*s+u*a*l,this.z=o*a*l-u*c*s,this.w=o*a*s+u*c*l):r===t.RotationOrder.YZX?(this.x=u*a*s+o*c*l,this.y=o*c*s+u*a*l,this.z=o*a*l-u*c*s,this.w=o*a*s-u*c*l):r===t.RotationOrder.XZY&&(this.x=u*a*s-o*c*l,this.y=o*c*s-u*a*l,this.z=o*a*l+u*c*s,this.w=o*a*s+u*c*l),this},e.prototype.equals=function(t,e){if(void 0===e&&(e=P.PRECISION),this.x*t.x>0){if(!P.equals(this.x-t.x,0,e))return!1;if(!P.equals(this.y-t.y,0,e))return!1;if(!P.equals(this.z-t.z,0,e))return!1;if(!P.equals(this.w-t.w,0,e))return!1}else{if(!P.equals(this.x+t.x,0,e))return!1;if(!P.equals(this.y+t.y,0,e))return!1;if(!P.equals(this.z+t.z,0,e))return!1;if(!P.equals(this.w+t.w,0,e))return!1}return!0},st([C],e.prototype,"x",void 0),st([C],e.prototype,"y",void 0),st([C],e.prototype,"z",void 0),st([C],e.prototype,"w",void 0),e}(),Rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return at(e,t),e}(Tt);jt.prototype.toMatrix=function(t){void 0===t&&(t=new Nt);var e=t.elements,n=this,i=n.x,r=n.y,o=n.z,a=n.w,s=2*i*r,u=2*i*o,c=2*i*a,l=2*r*o,h=2*r*a,p=2*o*a,f=i*i,d=r*r,m=o*o,y=a*a;return e[0]=f-d-m+y,e[4]=s-p,e[8]=u+h,e[12]=0,e[1]=s+p,e[5]=-f+d-m+y,e[9]=l-c,e[13]=0,e[2]=u-h,e[6]=l+c,e[10]=-f-d+m+y,e[14]=0,e[3]=0,e[7]=0,e[11]=0,e[15]=1,t};var Lt,Nt=function(){function e(t){void 0===t&&(t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.elements=t}return e.fromTRS=function(t,n,i,r){return void 0===r&&(r=P.DefaultRotationOrder),(new e).fromTRS(t,n,i,r)},e.fromAxisRotate=function(t,n){return(new e).fromAxisRotate(t,n)},e.fromRotation=function(t,n,i,r){return void 0===r&&(r=P.DefaultRotationOrder),(new e).fromRotation(t,n,i,r)},e.fromQuaternion=function(t){return(new e).fromQuaternion(t)},e.fromScale=function(t,n,i){return new e([t,0,0,0,0,n,0,0,0,0,i,0,0,0,0,1])},e.fromPosition=function(t,n,i){return new e([1,0,0,0,0,1,0,0,0,0,1,0,t,n,i,1])},e.prototype.getPosition=function(t){return void 0===t&&(t=new ht),t.x=this.elements[12],t.y=this.elements[13],t.z=this.elements[14],t},e.prototype.setPosition=function(t){return this.elements[12]=t.x,this.elements[13]=t.y,this.elements[14]=t.z,this},e.prototype.getRotation=function(t,e){return void 0===t&&(t=new ht),void 0===e&&(e=P.DefaultRotationOrder),this.toTRS(new ht,t,new ht,e),t},e.prototype.setRotation=function(t,e){void 0===e&&(e=P.DefaultRotationOrder);var n=new ht,i=new ht,r=new ht;return this.toTRS(n,i,r,e),i.copy(t),this.fromTRS(n,i,r),this},e.prototype.getScale=function(t){void 0===t&&(t=new ht);var e=this.elements,n=new ht;return t.x=n.set(e[0],e[1],e[2]).length,t.y=n.set(e[4],e[5],e[6]).length,t.z=n.set(e[8],e[9],e[10]).length,t},e.prototype.setScale=function(t){var e=this.getScale(),n=this.elements,i=t.x/e.x,r=t.y/e.y,o=t.z/e.z;return n[0]*=i,n[1]*=i,n[2]*=i,n[4]*=r,n[5]*=r,n[6]*=r,n[8]*=o,n[9]*=o,n[10]*=o,this},Object.defineProperty(e.prototype,"determinant",{get:function(){return(this.elements[0]*this.elements[5]-this.elements[4]*this.elements[1])*(this.elements[10]*this.elements[15]-this.elements[14]*this.elements[11])-(this.elements[0]*this.elements[9]-this.elements[8]*this.elements[1])*(this.elements[6]*this.elements[15]-this.elements[14]*this.elements[7])+(this.elements[0]*this.elements[13]-this.elements[12]*this.elements[1])*(this.elements[6]*this.elements[11]-this.elements[10]*this.elements[7])+(this.elements[4]*this.elements[9]-this.elements[8]*this.elements[5])*(this.elements[2]*this.elements[15]-this.elements[14]*this.elements[3])-(this.elements[4]*this.elements[13]-this.elements[12]*this.elements[5])*(this.elements[2]*this.elements[11]-this.elements[10]*this.elements[3])+(this.elements[8]*this.elements[13]-this.elements[12]*this.elements[9])*(this.elements[2]*this.elements[7]-this.elements[6]*this.elements[3])},enumerable:!1,configurable:!0}),e.prototype.getAxisX=function(t){return void 0===t&&(t=new ht),t.set(this.elements[0],this.elements[1],this.elements[2])},e.prototype.setAxisX=function(t){return void 0===t&&(t=new ht),this.elements[0]=t.x,this.elements[1]=t.y,this.elements[2]=t.z,this},e.prototype.getAxisY=function(t){return void 0===t&&(t=new ht),t.set(this.elements[4],this.elements[5],this.elements[6])},e.prototype.setAxisY=function(t){return void 0===t&&(t=new ht),this.elements[4]=t.x,this.elements[5]=t.y,this.elements[6]=t.z,this},e.prototype.getAxisZ=function(t){return void 0===t&&(t=new ht),t.set(this.elements[8],this.elements[9],this.elements[10])},e.prototype.fromRotation=function(t,e,n,i){return void 0===i&&(i=P.DefaultRotationOrder),this.fromTRS(new ht,new ht(t,e,n),new ht(1,1,1),i),this},e.prototype.fromQuaternion=function(t){return t.toMatrix(this),this},e.prototype.fromAxisRotate=function(t,e){var n=this,i=t.clone();i.normalize();var r=e*Math.PI/180,o=Math.sin(r),a=Math.cos(r),s=1-a;return[i.x*i.x*s+a,i.x*i.y*s+i.z*o,i.x*i.z*s-i.y*o,0,i.x*i.y*s-i.z*o,i.y*i.y*s+a,i.y*i.z*s+i.x*o,0,i.x*i.z*s+i.y*o,i.y*i.z*s-i.x*o,i.z*i.z*s+a,0,0,0,0,1].forEach((function(t,e){n.elements[e]=t})),this},e.prototype.append=function(t){var e=this.elements[0],n=this.elements[4],i=this.elements[8],r=this.elements[12],o=this.elements[1],a=this.elements[5],s=this.elements[9],u=this.elements[13],c=this.elements[2],l=this.elements[6],h=this.elements[10],p=this.elements[14],f=this.elements[3],d=this.elements[7],m=this.elements[11],y=this.elements[15],v=t.elements[0],g=t.elements[4],_=t.elements[8],b=t.elements[12],x=t.elements[1],w=t.elements[5],S=t.elements[9],P=t.elements[13],M=t.elements[2],C=t.elements[6],T=t.elements[10],A=t.elements[14],O=t.elements[3],E=t.elements[7],D=t.elements[11],z=t.elements[15];return this.elements[0]=e*v+o*g+c*_+f*b,this.elements[1]=e*x+o*w+c*S+f*P,this.elements[2]=e*M+o*C+c*T+f*A,this.elements[3]=e*O+o*E+c*D+f*z,this.elements[4]=n*v+a*g+l*_+d*b,this.elements[5]=n*x+a*w+l*S+d*P,this.elements[6]=n*M+a*C+l*T+d*A,this.elements[7]=n*O+a*E+l*D+d*z,this.elements[8]=i*v+s*g+h*_+m*b,this.elements[9]=i*x+s*w+h*S+m*P,this.elements[10]=i*M+s*C+h*T+m*A,this.elements[11]=i*O+s*E+h*D+m*z,this.elements[12]=r*v+u*g+p*_+y*b,this.elements[13]=r*x+u*w+p*S+y*P,this.elements[14]=r*M+u*C+p*T+y*A,this.elements[15]=r*O+u*E+p*D+y*z,console.assert(NaN!==this.elements[0]&&NaN!==this.elements[4]&&NaN!==this.elements[8]&&NaN!==this.elements[12]),this},e.prototype.appendRotation=function(t,n,i){var r=e.fromAxisRotate(t,n);return i&&this.appendTranslation(-i.x,-i.y,-i.z),this.append(r),i&&this.appendTranslation(i.x,i.y,i.z),this},e.prototype.appendScale=function(t,n,i){var r=e.fromScale(t,n,i);return this.append(r),this},e.prototype.appendTranslation=function(t,e,n){var i=this.elements;return i[0]+=t*i[3],i[4]+=t*i[7],i[8]+=t*i[11],i[12]+=t*i[15],i[1]+=e*i[3],i[5]+=e*i[7],i[9]+=e*i[11],i[13]+=e*i[15],i[2]+=n*i[3],i[6]+=n*i[7],i[10]+=n*i[11],i[14]+=n*i[15],this},e.prototype.clone=function(){var t=new e;return t.copy(this),t},e.prototype.copy=function(t){for(var e=0;e<16;e++)this.elements[e]=t.elements[e];return this},e.prototype.fromArray=function(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=!1),t.length-e<16)throw new Error("vector参数数据长度不够！");for(var i=0;i<16;i++)this.elements[i]=t[e+i];return n&&this.transpose(),this},e.prototype.toArray=function(t,e,n){void 0===t&&(t=[]),void 0===e&&(e=0),void 0===n&&(n=!1),n&&this.transpose();for(var i=0;i<16;i++)t[i+e]=this.elements[i];return n&&this.transpose(),t},e.prototype.random=function(){return this.fromTRS(ht.random(),ht.random(),ht.random()),this},e.prototype.fromTRS=function(e,n,i,r){void 0===r&&(r=P.DefaultRotationOrder);var o=this.elements;o[11]=0,o[15]=1,n=n.scaleNumberTo(P.DEG2RAD);var a=e.x,s=e.y,u=e.z,c=n.x,l=n.y,h=n.z,p=i.x,f=i.y,d=i.z;o[12]=a,o[13]=s,o[14]=u;var m=Math.cos(c),y=Math.sin(c),v=Math.cos(l),g=Math.sin(l),_=Math.cos(h),b=Math.sin(h);if(r===t.RotationOrder.XYZ){var x=m*_,w=m*b,S=y*_,M=y*b;o[0]=v*_,o[4]=-v*b,o[8]=g,o[1]=w+S*g,o[5]=x-M*g,o[9]=-y*v,o[2]=M-x*g,o[6]=S+w*g,o[10]=m*v}else if(r===t.RotationOrder.YXZ){var C=v*_,T=v*b,A=g*_,O=g*b;o[0]=C+O*y,o[4]=A*y-T,o[8]=m*g,o[1]=m*b,o[5]=m*_,o[9]=-y,o[2]=T*y-A,o[6]=O+C*y,o[10]=m*v}else if(r===t.RotationOrder.ZXY){C=v*_,T=v*b,A=g*_,O=g*b;o[0]=C-O*y,o[4]=-m*b,o[8]=A+T*y,o[1]=T+A*y,o[5]=m*_,o[9]=O-C*y,o[2]=-m*g,o[6]=y,o[10]=m*v}else if(r===t.RotationOrder.ZYX){x=m*_,w=m*b,S=y*_,M=y*b;o[0]=v*_,o[4]=S*g-w,o[8]=x*g+M,o[1]=v*b,o[5]=M*g+x,o[9]=w*g-S,o[2]=-g,o[6]=y*v,o[10]=m*v}else if(r===t.RotationOrder.YZX){var E=m*v,D=m*g,z=y*v,I=y*g;o[0]=v*_,o[4]=I-E*b,o[8]=z*b+D,o[1]=b,o[5]=m*_,o[9]=-y*_,o[2]=-g*_,o[6]=D*b+z,o[10]=E-I*b}else if(r===t.RotationOrder.XZY){E=m*v,D=m*g,z=y*v,I=y*g;o[0]=v*_,o[4]=-b,o[8]=g*_,o[1]=E*b+I,o[5]=m*_,o[9]=D*b-z,o[2]=z*b-D,o[6]=y*_,o[10]=I*b+E}else console.error("初始化矩阵时错误旋转顺序 "+r);return o[0]*=p,o[1]*=p,o[2]*=p,o[4]*=f,o[5]*=f,o[6]*=f,o[8]*=d,o[9]*=d,o[10]*=d,this},e.prototype.toTRS=function(e,n,i,r){void 0===e&&(e=new ht),void 0===n&&(n=new ht),void 0===i&&(i=new ht),void 0===r&&(r=P.DefaultRotationOrder);var o=P.clamp,a=this.elements,s=a[0],u=a[4],c=a[8],l=a[1],h=a[5],p=a[9],f=a[2],d=a[6],m=a[10];return e.x=a[12],e.y=a[13],e.z=a[14],i.x=Math.sqrt(s*s+l*l+f*f),s/=i.x,l/=i.x,f/=i.x,i.y=Math.sqrt(u*u+h*h+d*d),u/=i.y,h/=i.y,d/=i.y,i.z=Math.sqrt(c*c+p*p+m*m),c/=i.z,p/=i.z,m/=i.z,r===t.RotationOrder.XYZ?(n.y=Math.asin(o(c,-1,1)),Math.abs(c)<.9999999?(n.x=Math.atan2(-p,m),n.z=Math.atan2(-u,s)):(n.x=Math.atan2(d,h),n.z=0)):r===t.RotationOrder.YXZ?(n.x=Math.asin(-o(p,-1,1)),Math.abs(p)<.9999999?(n.y=Math.atan2(c,m),n.z=Math.atan2(l,h)):(n.y=Math.atan2(-f,s),n.z=0)):r===t.RotationOrder.ZXY?(n.x=Math.asin(o(d,-1,1)),Math.abs(d)<.9999999?(n.y=Math.atan2(-f,m),n.z=Math.atan2(-u,h)):(n.y=0,n.z=Math.atan2(l,s))):r===t.RotationOrder.ZYX?(n.y=Math.asin(-o(f,-1,1)),Math.abs(f)<.9999999?(n.x=Math.atan2(d,m),n.z=Math.atan2(l,s)):(n.x=0,n.z=Math.atan2(-u,h))):r===t.RotationOrder.YZX?(n.z=Math.asin(o(l,-1,1)),Math.abs(l)<.9999999?(n.x=Math.atan2(-p,h),n.y=Math.atan2(-f,s)):(n.x=0,n.y=Math.atan2(c,m))):r===t.RotationOrder.XZY?(n.z=Math.asin(-o(u,-1,1)),Math.abs(u)<.9999999?(n.x=Math.atan2(d,h),n.y=Math.atan2(c,s)):(n.x=Math.atan2(-p,m),n.y=0)):console.error("初始化矩阵时错误旋转顺序 "+r),n.scaleNumber(P.RAD2DEG),[e,n,i]},e.prototype.identity=function(){var t=this.elements;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},e.prototype.invert=function(){var t=this.determinant;if(0===t)return console.error("无法获取逆矩阵"),this;t=1/t;var e=this.elements,n=e[0],i=e[4],r=e[8],o=e[12],a=e[1],s=e[5],u=e[9],c=e[13],l=e[2],h=e[6],p=e[10],f=e[14],d=e[3],m=e[7],y=e[11],v=e[15];return e[0]=t*(s*(p*v-f*y)-u*(h*v-f*m)+c*(h*y-p*m)),e[1]=-t*(a*(p*v-f*y)-u*(l*v-f*d)+c*(l*y-p*d)),e[2]=t*(a*(h*v-f*m)-s*(l*v-f*d)+c*(l*m-h*d)),e[3]=-t*(a*(h*y-p*m)-s*(l*y-p*d)+u*(l*m-h*d)),e[4]=-t*(i*(p*v-f*y)-r*(h*v-f*m)+o*(h*y-p*m)),e[5]=t*(n*(p*v-f*y)-r*(l*v-f*d)+o*(l*y-p*d)),e[6]=-t*(n*(h*v-f*m)-i*(l*v-f*d)+o*(l*m-h*d)),e[7]=t*(n*(h*y-p*m)-i*(l*y-p*d)+r*(l*m-h*d)),e[8]=t*(i*(u*v-c*y)-r*(s*v-c*m)+o*(s*y-u*m)),e[9]=-t*(n*(u*v-c*y)-r*(a*v-c*d)+o*(a*y-u*d)),e[10]=t*(n*(s*v-c*m)-i*(a*v-c*d)+o*(a*m-s*d)),e[11]=-t*(n*(s*y-u*m)-i*(a*y-u*d)+r*(a*m-s*d)),e[12]=-t*(i*(u*f-c*p)-r*(s*f-c*h)+o*(s*p-u*h)),e[13]=t*(n*(u*f-c*p)-r*(a*f-c*l)+o*(a*p-u*l)),e[14]=-t*(n*(s*f-c*h)-i*(a*f-c*l)+o*(a*h-s*l)),e[15]=t*(n*(s*p-u*h)-i*(a*p-u*l)+r*(a*h-s*l)),this},e.prototype.prepend=function(t){var e=this.clone();return this.copy(t),this.append(e),this},e.prototype.prependRotation=function(t,n,i){void 0===i&&(i=new ht);var r=e.fromAxisRotate(t,n);return this.prepend(r),this},e.prototype.prependScale=function(t,n,i){var r=e.fromScale(t,n,i);return this.prepend(r),this},e.prototype.prependScale1=function(t,e,n){var i=this.elements;return i[0]*=t,i[1]*=t,i[2]*=t,i[4]*=e,i[5]*=e,i[6]*=e,i[8]*=n,i[9]*=n,i[10]*=n,this},e.prototype.prependTranslation=function(t,n,i){var r=e.fromPosition(t,n,i);return this.prepend(r),this},e.prototype.moveRight=function(t){var e=this.getAxisX();return e.normalize(),e.scaleNumber(t),this.setPosition(this.getPosition().addTo(e)),this},e.prototype.moveUp=function(t){var e=this.getAxisY();return e.scaleNumber(t),this.setPosition(this.getPosition().addTo(e)),this},e.prototype.moveForward=function(t){var e=this.getAxisZ();return e.scaleNumber(t),this.setPosition(this.getPosition().addTo(e)),this},e.prototype.transformPoint3=function(t,e){void 0===e&&(e=new ht);var n=this.elements,i=n[0],r=n[1],o=n[2],a=n[4],s=n[5],u=n[6],c=n[8],l=n[9],h=n[10],p=n[12],f=n[13],d=n[14],m=t.x,y=t.y,v=t.z;return e.x=m*i+y*a+v*c+p,e.y=m*r+y*s+v*l+f,e.z=m*o+y*u+v*h+d,e},e.prototype.transformVector3=function(t,e){void 0===e&&(e=new ht);var n=this.elements,i=n[0],r=n[1],o=n[2],a=n[4],s=n[5],u=n[6],c=n[8],l=n[9],h=n[10],p=t.x,f=t.y,d=t.z;return e.x=p*i+f*a+d*c,e.y=p*r+f*s+d*l,e.z=p*o+f*u+d*h,e},e.prototype.transformVector4=function(t,e){void 0===e&&(e=new dt);var n=this.elements,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],u=n[5],c=n[6],l=n[7],h=n[8],p=n[9],f=n[10],d=n[11],m=n[12],y=n[13],v=n[14],g=n[15],_=t.x,b=t.y,x=t.z,w=t.w;return e.x=_*i+b*s+x*h+w*m,e.y=_*r+b*u+x*p+w*y,e.z=_*o+b*c+x*f+w*v,e.w=_*a+b*l+x*d+w*g,e},e.prototype.transformPoints=function(t,e){void 0===e&&(e=[]);for(var n=this.elements,i=n[0],r=n[1],o=n[2],a=n[4],s=n[5],u=n[6],c=n[8],l=n[9],h=n[10],p=n[12],f=n[13],d=n[14],m=0;m<t.length;m+=3){var y=t[m],v=t[m+1],g=t[m+2];e[m]=y*i+v*a+g*c+p,e[m+1]=y*r+v*s+g*l+f,e[m+2]=y*o+v*u+g*h+d}return e},e.prototype.transformRotation=function(t,n){void 0===n&&(n=new ht);var i=e.fromRotation(t.x,t.y,t.z);i.append(this);var r=i.toTRS()[1],o=r.x,a=r.y,s=r.z;Math.round((o-t.x)/180)%2!=0&&(o+=180,a=180-a,s+=180);var u=function(t,e,n){return void 0===n&&(n=360),Math.round((e-t)/n)*n+t};return o=u(o,t.x),a=u(a,t.y),s=u(s,t.z),n.x=o,n.y=a,n.z=s,n},e.prototype.transformRay=function(t,e){return void 0===e&&(e=new Rt),this.transformPoint3(t.origin,e.origin),this.transformVector3(t.direction,e.direction),e},e.prototype.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},e.prototype.equals=function(t,e){void 0===e&&(e=P.PRECISION);for(var n=t.elements,i=0;i<16;++i)if(!P.equals(this.elements[i]-n[i],0,e))return!1;return!0},e.prototype.lookAt=function(t,e){var n=this.toTRS(),i=n[0],r=n[2],o=new ht,a=new ht,s=new ht;return e=e||ht.Y_AXIS,s.x=t.x-i.x,s.y=t.y-i.y,s.z=t.z-i.z,s.normalize(),o.x=e.y*s.z-e.z*s.y,o.y=e.z*s.x-e.x*s.z,o.z=e.x*s.y-e.y*s.x,o.normalize(),o.lengthSquared<.005&&(o.x=e.y,o.y=e.x,o.z=0,o.normalize()),a.x=s.y*o.z-s.z*o.y,a.y=s.z*o.x-s.x*o.z,a.z=s.x*o.y-s.y*o.x,this.elements[0]=r.x*o.x,this.elements[1]=r.x*o.y,this.elements[2]=r.x*o.z,this.elements[3]=0,this.elements[4]=r.y*a.x,this.elements[5]=r.y*a.y,this.elements[6]=r.y*a.z,this.elements[7]=0,this.elements[8]=r.z*s.x,this.elements[9]=r.z*s.y,this.elements[10]=r.z*s.z,this.elements[11]=0,this.elements[12]=i.x,this.elements[13]=i.y,this.elements[14]=i.z,this.elements[15]=1,this},e.prototype.getMaxScaleOnAxis=function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))},e.prototype.setOrtho=function(t,e,n,i,r,o){var a=this.elements;return a[0]=2/(e-t),a[4]=0,a[8]=0,a[12]=-(e+t)/(e-t),a[1]=0,a[5]=2/(n-i),a[9]=0,a[13]=-(n+i)/(n-i),a[2]=0,a[6]=0,a[10]=2/(o-r),a[14]=-(o+r)/(o-r),a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},e.prototype.setPerspectiveFromFOV=function(t,e,n,i){var r=this.elements,o=Math.tan(t*Math.PI/360);return r[0]=1/(e*o),r[4]=0,r[8]=0,r[12]=0,r[1]=0,r[5]=1/o,r[9]=0,r[13]=0,r[2]=0,r[6]=0,r[10]=(i+n)/(i-n),r[14]=i*n*-2/(i-n),r[3]=0,r[7]=0,r[11]=1,r[15]=0,this},e.prototype.setPerspective=function(t,e,n,i,r,o){var a=this.elements;return a[0]=2*r/(e-t),a[4]=0,a[8]=0,a[12]=0,a[1]=0,a[5]=2*r/(n-i),a[9]=0,a[13]=0,a[2]=0,a[6]=0,a[10]=(o+r)/(o-r),a[14]=o*r*-2/(o-r),a[3]=0,a[7]=0,a[11]=1,a[15]=0,this},e.prototype.toMatrix3x3=function(t){void 0===t&&(t=new It);var e=t.elements,n=this.elements;return e[0]=n[0],e[1]=n[1],e[2]=0,e[3]=n[4],e[4]=n[5],e[5]=0,e[6]=n[12],e[7]=n[13],e[8]=1,t},e.prototype.toString=function(){return"Matrix4x4 ["+this.elements.toString()+"]"},e.prototype.GetColumn=function(t){var e=this.elements,n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],y=e[14],v=e[15];switch(t){case 0:return new dt(n,i,r,o);case 1:return new dt(a,s,u,c);case 2:return new dt(l,h,p,f);case 3:return new dt(d,m,y,v);default:throw"Invalid column index!"}},e.prototype.GetRow=function(t){var e=this.elements,n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],y=e[14],v=e[15];switch(t){case 0:return new dt(n,a,l,d);case 1:return new dt(i,s,h,m);case 2:return new dt(r,u,p,y);case 3:return new dt(o,c,f,v);default:throw"Invalid row index!"}},e.prototype.SetColumn=function(t,e){this.elements[0+4*t]=e.x,this.elements[1+4*t]=e.y,this.elements[2+4*t]=e.z,this.elements[3+4*t]=e.w},e.prototype.SetRow=function(t,e){this.elements[t+0]=e.x,this.elements[t+4]=e.y,this.elements[t+8]=e.z,this.elements[t+12]=e.w},e.prototype.MultiplyPoint=function(t,e){var n;void 0===e&&(e=new ht);var i=this.elements,r=i[0],o=i[1],a=i[2],s=i[3],u=i[4],c=i[5],l=i[6],h=i[7],p=i[8],f=i[9],d=i[10],m=i[11],y=i[12],v=i[13],g=i[14],_=i[15];return e.x=r*t.x+u*t.y+p*t.z+y,e.y=o*t.x+c*t.y+f*t.z+v,e.z=a*t.x+l*t.y+d*t.z+g,n=1/(n=s*t.x+h*t.y+m*t.z+_),e.x*=n,e.y*=n,e.z*=n,e},e.prototype.MultiplyPoint3x4=function(t,e){void 0===e&&(e=new ht);var n=this.elements,i=n[0],r=n[1],o=n[2],a=n[4],s=n[5],u=n[6],c=n[8],l=n[9],h=n[10],p=n[12],f=n[13],d=n[14];return e.x=i*t.x+a*t.y+c*t.z+p,e.y=r*t.x+s*t.y+l*t.z+f,e.z=o*t.x+u*t.y+h*t.z+d,e},e.prototype.MultiplyVector=function(t,e){void 0===e&&(e=new ht);var n=this.elements,i=n[0],r=n[1],o=n[2],a=n[4],s=n[5],u=n[6],c=n[8],l=n[9],h=n[10];return e.x=i*t.x+a*t.y+c*t.z,e.y=r*t.x+s*t.y+l*t.z,e.z=o*t.x+u*t.y+h*t.z,e},e.prototype.TransformPlane=function(t,e){void 0===e&&(e=new At);var n=this.clone().invert().elements,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],u=n[5],c=n[6],l=n[7],h=n[8],p=n[9],f=n[10],d=n[11],m=n[12],y=n[13],v=n[14],g=n[15],_=t.a,b=t.b,x=t.c,w=t.d;return e.a=i*_+r*b+o*x+a*w,e.b=s*_+u*b+c*x+l*w,e.c=h*_+p*b+f*x+d*w,e.d=m*_+y*b+v*x+g*w,e},e.Scale=function(t,n){return void 0===n&&(n=new e),n.elements=[t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1],n},e.Translate=function(t,n){return void 0===n&&(n=new e),n.elements=[1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1],n},e.Rotate=function(t,n){void 0===n&&(n=new e);var i=2*t.x,r=2*t.y,o=2*t.z,a=t.x*i,s=t.y*r,u=t.z*o,c=t.x*r,l=t.x*o,h=t.y*o,p=t.w*i,f=t.w*r,d=t.w*o;return n.elements=[1-(s+u),c+d,l-f,0,c-d,1-(a+u),h+p,0,l+f,h-p,1-(a+s),0,0,0,0,1],n},Object.defineProperty(e.prototype,"rotation",{get:function(){return(new jt).fromMatrix(this)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lossyScale",{get:function(){return this.getScale()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isIdentity",{get:function(){for(var t=this.elements,n=e.identity.elements,i=0;i<t.length;i++)if(!P.equals(t[i],n[i]))return!1;return!0},enumerable:!1,configurable:!0}),e.zero=new e([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),e.identity=new e([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),st([C],e.prototype,"elements",void 0),e}(),Ft=function(){function e(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=P.DefaultRotationOrder),this.x=t,this.y=e,this.z=n,this.order=i}return e.prototype.set=function(t,e,n,i){return this.x=t,this.y=e,this.z=n,void 0!==i&&(this.order=i),this},e.prototype.random=function(){return this.x=360*Math.random(),this.y=360*Math.random(),this.z=360*Math.random(),this.order=P.randInt(0,5),this},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.order)},e.prototype.fromRotationMatrix=function(e,n){var i,r,o,a=e.elements,s=a[0],u=a[4],c=a[8],l=a[1],h=a[5],p=a[9],f=a[2],d=a[6],m=a[10];switch(void 0===n&&(n=this.order),n){case t.RotationOrder.XYZ:r=Math.asin(P.clamp(c,-1,1)),Math.abs(c)<.9999999?(i=Math.atan2(-p,m),o=Math.atan2(-u,s)):(i=Math.atan2(d,h),o=0);break;case t.RotationOrder.YXZ:i=Math.asin(-P.clamp(p,-1,1)),Math.abs(p)<.9999999?(r=Math.atan2(c,m),o=Math.atan2(l,h)):(r=Math.atan2(-f,s),o=0);break;case t.RotationOrder.ZXY:i=Math.asin(P.clamp(d,-1,1)),Math.abs(d)<.9999999?(r=Math.atan2(-f,m),o=Math.atan2(-u,h)):(r=0,o=Math.atan2(l,s));break;case t.RotationOrder.ZYX:r=Math.asin(-P.clamp(f,-1,1)),Math.abs(f)<.9999999?(i=Math.atan2(d,m),o=Math.atan2(l,s)):(i=0,o=Math.atan2(-u,h));break;case t.RotationOrder.YZX:o=Math.asin(P.clamp(l,-1,1)),Math.abs(l)<.9999999?(i=Math.atan2(-p,h),r=Math.atan2(-f,s)):(i=0,r=Math.atan2(c,m));break;case t.RotationOrder.XZY:o=Math.asin(-P.clamp(u,-1,1)),Math.abs(u)<.9999999?(i=Math.atan2(d,h),r=Math.atan2(c,s)):(i=Math.atan2(-p,m),r=0);break;default:console.warn("THREE.Euler: .fromRotationMatrix() encountered an unknown order: "+n)}return this.x=i*P.RAD2DEG,this.y=r*P.RAD2DEG,this.z=o*P.RAD2DEG,this.order=n,this},e.prototype.fromQuaternion=function(t,e){void 0===e&&(e=this.order);var n=new Nt;return n.fromQuaternion(t),this.fromRotationMatrix(n,e)},e.prototype.fromVector3=function(t,e){return void 0===e&&(e=this.order),this.set(t.x,t.y,t.z,e)},e.prototype.reorder=function(t){var e=new jt;return e.fromEuler(this.x,this.y,this.z,this.order),this.fromQuaternion(e,t)},e.prototype.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order},e.prototype.fromArray=function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.order=t[e+3],this},e.prototype.toArray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.order,t},e.prototype.toVector3=function(t){return void 0===t&&(t=new ht),t.set(this.x,this.y,this.z),t},e}(),kt=function(){function t(t,e,n,i,r,o){void 0===t&&(t=new At),void 0===e&&(e=new At),void 0===n&&(n=new At),void 0===i&&(i=new At),void 0===r&&(r=new At),void 0===o&&(o=new At),this.planes=[t,e,n,i,r,o]}return t.prototype.set=function(t,e,n,i,r,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(o),this},t.prototype.clone=function(){return(new t).copy(this)},t.prototype.copy=function(t){for(var e=this.planes,n=0;n<6;n++)e[n].copy(t.planes[n]);return this},t.prototype.fromMatrix=function(t){var e=this.planes,n=t.elements,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],u=n[5],c=n[6],l=n[7],h=n[8],p=n[9],f=n[10],d=n[11],m=n[12],y=n[13],v=n[14],g=n[15];return e[0].set(a-i,l-s,d-h,g-m).normalize(),e[1].set(a+i,l+s,d+h,g+m).normalize(),e[2].set(a+r,l+u,d+p,g+y).normalize(),e[3].set(a-r,l-u,d-p,g-y).normalize(),e[4].set(a-o,l-c,d-f,g-v).normalize(),e[5].set(a+o,l+c,d+f,g+v).normalize(),this},t.prototype.intersectsSphere=function(t){for(var e=this.planes,n=t.center,i=-t.radius,r=0;r<6;r++){if(e[r].distanceWithPoint(n)<i)return!1}return!0},t.prototype.intersectsBox=function(t){for(var e=this.planes,n=new ht,i=0;i<6;i++){var r=e[i],o=r.getNormal();if(n.x=o.x>0?t.max.x:t.min.x,n.y=o.y>0?t.max.y:t.min.y,n.z=o.z>0?t.max.z:t.min.z,r.distanceWithPoint(n)<0)return!1}return!0},t.prototype.containsPoint=function(t,e){void 0===e&&(e=P.PRECISION);for(var n=this.planes,i=0;i<6;i++)if(n[i].distanceWithPoint(t)<-e)return!1;return!0},t}(),Bt=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=t,this.y=e,this.width=n,this.height=i}return Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},set:function(t){this.width=t-this.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){this.height=t-this.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},set:function(t){this.height+=this.y-t,this.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return new lt(this.left,this.top)},set:function(t){this.top=t.y,this.left=t.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return new lt(this.right,this.bottom)},set:function(t){this.bottom=t.y,this.right=t.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"center",{get:function(){return new lt(this.x+this.width/2,this.y+this.height/2)},enumerable:!1,configurable:!0}),t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t.prototype.init=function(t,e,n,i){return this.x=t,this.y=e,this.width=n,this.height=i,this},t.prototype.contains=function(t,e){return this.x<=t&&this.x+this.width>=t&&this.y<=e&&this.y+this.height>=e},t.prototype.intersection=function(e){if(!this.intersects(e))return new t;var n=new t;return this.x>e.x?(n.x=this.x,n.width=e.x-this.x+e.width,n.width>this.width&&(n.width=this.width)):(n.x=e.x,n.width=this.x-e.x+this.width,n.width>e.width&&(n.width=e.width)),this.y>e.y?(n.y=this.y,n.height=e.y-this.y+e.height,n.height>this.height&&(n.height=this.height)):(n.y=e.y,n.height=this.y-e.y+this.height,n.height>e.height&&(n.height=e.height)),n},t.prototype.inflate=function(t,e){this.x-=t,this.width+=2*t,this.y-=e,this.height+=2*e},t.prototype.intersects=function(t){return Math.max(this.x,t.x)<=Math.min(this.right,t.right)&&Math.max(this.y,t.y)<=Math.min(this.bottom,t.bottom)},t.prototype.isEmpty=function(){return this.width<=0||this.height<=0},t.prototype.setEmpty=function(){this.x=0,this.y=0,this.width=0,this.height=0},t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.containsPoint=function(t){return this.x<t.x&&this.x+this.width>t.x&&this.y<t.y&&this.y+this.height>t.y},t.prototype.containsRect=function(t){var e=t.x+t.width,n=t.y+t.height,i=this.x+this.width,r=this.y+this.height;return t.x>=this.x&&t.x<i&&t.y>=this.y&&t.y<r&&e>this.x&&e<=i&&n>this.y&&n<=r},t.prototype.equals=function(t){return this===t||this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},t.prototype.inflatePoint=function(t){this.inflate(t.x,t.y)},t.prototype.offset=function(t,e){this.x+=t,this.y+=e},t.prototype.offsetPoint=function(t){this.offset(t.x,t.y)},t.prototype.toString=function(){return"(x="+this.x+", y="+this.y+", width="+this.width+", height="+this.height+")"},t.prototype.union=function(t){var e=this.clone();if(t.isEmpty())return e;if(e.isEmpty())return e.copyFrom(t),e;var n=Math.min(e.x,t.x),i=Math.min(e.y,t.y);return e.init(n,i,Math.max(e.right,t.right)-n,Math.max(e.bottom,t.bottom)-i),e},t.prototype.clampPoint=function(t,e){return void 0===e&&(e=new lt),e.copy(t).clamp(this.topLeft,this.bottomRight)},Object.defineProperty(t.prototype,"size",{get:function(){return new lt(this.width,this.height)},enumerable:!1,configurable:!0}),t}(),Vt=function(){function t(t,e){void 0===t&&(t=new ht),void 0===e&&(e=0),this.center=t,this.radius=e}return t.fromPoints=function(e){return(new t).fromPoints(e)},t.fromPositions=function(e){return(new t).fromPositions(e)},t.prototype.rayIntersection=function(t,e,n){if(this.containsPoint(t))return 0;var i,r=t.x-this.center.x,o=t.y-this.center.y,a=t.z-this.center.z,s=e.x,u=e.y,c=e.z,l=s*s+u*u+c*c,h=2*(r*s+o*u+a*c),p=h*h-4*l*(r*r+o*o+a*a-this.radius*this.radius);if(p>=0&&(i=(-h-Math.sqrt(p))/(2*l))>=0)return n.x=r+i*s,n.y=o+i*u,n.z=a+i*c,n.normalize(),i;return-1},t.prototype.containsPoint=function(t){return t.subTo(this.center).lengthSquared<=this.radius*this.radius},t.prototype.fromPoints=function(t){var e=new Dt,n=this.center;e.fromPoints(t).getCenter(n);for(var i=0,r=0,o=t.length;r<o;r++)i=Math.max(i,n.distanceSquared(t[r]));return this.radius=Math.sqrt(i),this},t.prototype.fromPositions=function(t){var e=new Dt,n=new ht,i=this.center;e.formPositions(t).getCenter(i);for(var r=0,o=0,a=t.length;o<a;o+=3)r=Math.max(r,i.distanceSquared(n.set(t[o],t[o+1],t[o+2])));return this.radius=Math.sqrt(r),this},t.prototype.copy=function(t){return this.center.copy(t.center),this.radius=t.radius,this},t.prototype.clone=function(){return(new t).copy(this)},t.prototype.isEmpty=function(){return this.radius<=0},t.prototype.distanceToPoint=function(t){return t.distance(this.center)-this.radius},t.prototype.intersectsSphere=function(t){var e=this.radius+t.radius;return t.center.distanceSquared(this.center)<=e*e},t.prototype.intersectsBox=function(t){return t.intersectsSphere(this)},t.prototype.intersectsPlane=function(t){return Math.abs(t.distanceWithPoint(this.center))<=this.radius},t.prototype.clampPoint=function(t,e){void 0===e&&(e=new ht);var n=this.center.distanceSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.scaleNumber(this.radius).add(this.center)),e},t.prototype.getBoundingBox=function(t){return void 0===t&&(t=new Dt),t.init(this.center.subNumberTo(this.radius),this.center.addNumberTo(this.radius)),t},t.prototype.applyMatrix4=function(t){return this.center.applyMatrix4x4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},t.prototype.translate=function(t){return this.center.add(t),this},t.prototype.equals=function(t){return t.center.equals(this.center)&&t.radius===this.radius},t.prototype.toString=function(){return"Sphere [center:"+this.center.toString()+", radius:"+this.radius+"]"},t}(),Wt=function(){function t(t){void 0===t&&(t=[]),this.triangles=t}return t.fromBox=function(e){return(new t).fromBox(e)},t.prototype.fromBox=function(t){return this.triangles.length=0,t.toTriangles(this.triangles),this},t.prototype.getPoints=function(){var t=this.triangles.reduce((function(t,e){return t.concat(e.getPoints())}),[]);return p.unique(t,(function(t,e){return t.equals(e)})),t},t.prototype.isClosed=function(){var t=this.triangles.reduce((function(t,e){return t.concat(e.getSegments())}),[]);return t.every((function(e){return 1===t.filter((function(t){return e.p0.equals(t.p1)&&e.p1.equals(t.p0)})).length}))},t.prototype.getBox=function(t){return void 0===t&&(t=new Dt),t.fromPoints(this.getPoints())},t.prototype.closestPointWithPoint=function(t,e){void 0===e&&(e=new ht);var n=this.triangles.map((function(e){var n=e.closestPointWithPoint(t);return{p:n,d:t.distanceSquared(n)}})).sort((function(t,e){return t.d-e.d}));return e.copy(n[0].p)},t.prototype.classifyPoint=function(t){if(!this.isClosed())return 1;var e=this.triangles.reduce((function(e,n){return e||n.onWithPoint(t)}),!1);if(e)return 0;var n=this.closestPointWithPoint(t),i=n.subTo(t);return this.triangles.filter((function(t){return t.onWithPoint(n)})).map((function(t){return t.getNormal().dot(i)})).sort((function(t,e){return Math.abs(e)-Math.abs(t)}))[0]>0?-1:1},t.prototype.containsPoint=function(t){return this.classifyPoint(t)<=0},t.prototype.classifySegment=function(t){var e=this,n=this.intersectionWithSegment(t);if(!n)return this.classifyPoint(t.p0)>0?1:-1;if(n.segments.length>1)return 2;if(1===n.segments.length){var i=[n.segments[0].p0,n.segments[0].p1].map((function(t){return e.classifyPoint(t)}));return i[0]*i[1]<0?2:i[0]+i[1]===0?0:i[0]+i[1]<0?-1:1}if(n.points.length)throw"未实现"},t.prototype.classifyTriangle=function(t){throw"未实现"},t.prototype.intersectionWithLine=function(t){var e=[],n=[];return this.triangles.forEach((function(i){var r=i.intersectionWithLine(t);r&&(r instanceof Ot?e.push(r):n.push(r))})),p.unique(e,(function(t,e){return t.equals(e)})),n=n.filter((function(t){return e.every((function(e){return!e.onWithPoint(t)}))})),p.unique(n,(function(t,e){return t.equals(e)})),e.length+n.length===0?null:{segments:e,points:n}},t.prototype.intersectionWithSegment=function(t){var e=t.getLine(),n=this.intersectionWithLine(e);if(!n)return null;var i=n.points=n.points.filter((function(e){return t.onWithPoint(e)}));return n.segments=n.segments.reduce((function(e,n){var r=t.clampPoint(n.p0),o=t.clampPoint(n.p1);return n.onWithPoint(r)?r.equals(o)?(i.push(r),e):(e.push(Ot.fromPoints(r,o)),e):e}),[]),n.segments.length+n.points.length===0?null:n},t.prototype.decomposeTriangle=function(t){throw"未实现"},t.prototype.copy=function(t){return this.triangles=t.triangles.map((function(t){return t.clone()})),this},t.prototype.clone=function(){return(new t).copy(this)},t}();t.GradientMode=void 0,(Lt=t.GradientMode||(t.GradientMode={}))[Lt.Blend=0]="Blend",Lt[Lt.Fixed=1]="Fixed";var Ut,Gt=function(){function e(){this.mode=t.GradientMode.Blend,this.alphaKeys=[{alpha:1,time:0},{alpha:1,time:1}],this.colorKeys=[{color:new pt(1,1,1),time:0},{color:new pt(1,1,1),time:1}]}return e.prototype.fromColors=function(t,e){if(!e){e=[];for(var n=0;n<t.length;n++)e[n]=n/(t.length-1)}var i=t.map((function(t){return(new pt).fromUnit(t)}));for(n=0;n<i.length;n++)this.colorKeys[n]={color:i[n],time:e[n]};return this},e.prototype.getValue=function(t){var e=this.getAlpha(t),n=this.getColor(t);return new yt(n.r,n.g,n.b,e)},e.prototype.getAlpha=function(e){var n=this.alphaKeys;if(1===n.length)return n[0].alpha;if(e<=n[0].time)return n[0].alpha;if(e>=n[n.length-1].time)return n[n.length-1].alpha;for(var i=0,r=n.length-1;i<r;i++){var o=n[i].time,a=n[i].alpha,s=n[i+1].time,u=n[i+1].alpha;if(e===o)return a;if(e===s)return u;if(o<e&&e<s)return this.mode===t.GradientMode.Fixed?u:P.mapLinear(e,o,s,a,u)}return 1},e.prototype.getColor=function(e){var n=this.colorKeys;if(1===n.length)return n[0].color;if(e<=n[0].time)return n[0].color;if(e>=n[n.length-1].time)return n[n.length-1].color;for(var i=0,r=n.length-1;i<r;i++){var o=n[i].time,a=n[i].color,s=n[i+1].time,u=n[i+1].color;if(e===o)return a;if(e===s)return u;if(o<e&&e<s)return this.mode===t.GradientMode.Fixed?u:a.mixTo(u,(e-o)/(s-o))}return new pt},st([C],e.prototype,"mode",void 0),st([C],e.prototype,"alphaKeys",void 0),st([C],e.prototype,"colorKeys",void 0),e}();t.MinMaxGradientMode=void 0,(Ut=t.MinMaxGradientMode||(t.MinMaxGradientMode={}))[Ut.Color=0]="Color",Ut[Ut.Gradient=1]="Gradient",Ut[Ut.TwoColors=2]="TwoColors",Ut[Ut.TwoGradients=3]="TwoGradients",Ut[Ut.RandomColor=4]="RandomColor";var Ht=function(){function e(){this.mode=t.MinMaxGradientMode.Color,this.color=new yt,this.colorMin=new yt,this.colorMax=new yt,this.gradient=new Gt,this.gradientMin=new Gt,this.gradientMax=new Gt}return e.prototype.getValue=function(e,n){var i,r;switch(void 0===n&&(n=Math.random()),this.mode){case t.MinMaxGradientMode.Color:return this.color;case t.MinMaxGradientMode.Gradient:return this.gradient.getValue(e);case t.MinMaxGradientMode.TwoColors:return this.colorMin.mixTo(this.colorMax,n);case t.MinMaxGradientMode.TwoGradients:return i=this.gradientMin.getValue(e),r=this.gradientMax.getValue(e),i.mixTo(r,n);case t.MinMaxGradientMode.RandomColor:return this.gradient.getValue(n)}return this.color},st([C],e.prototype,"mode",void 0),st([C],e.prototype,"color",void 0),st([C],e.prototype,"colorMin",void 0),st([C],e.prototype,"colorMax",void 0),st([C],e.prototype,"gradient",void 0),st([C],e.prototype,"gradientMin",void 0),st([C],e.prototype,"gradientMax",void 0),e}(),Kt=function(){function t(t){void 0===t&&(t=0),this._seed=0,this._p=[],this.seed=t}return t.prototype.perlin1=function(t){var e=this._p,n=Math.floor(t);t-=n;var i=e[n&=255]%2,r=e[n+1]%2;return oe(re(Jt[i],t),re(Jt[r],t-1),ae(t))},t.prototype.perlin2=function(t,e){var n=this._p,i=Math.floor(t),r=Math.floor(e);t-=i,e-=r;var o=n[(i&=255)+n[r&=255]]%4,a=n[i+1+n[r]]%4,s=n[i+n[r+1]]%4,u=n[i+1+n[r+1]]%4,c=ie($t[o],t,e),l=ie($t[a],t-1,e),h=ie($t[s],t,e-1),p=ie($t[u],t-1,e-1),f=ae(t),d=ae(e),m=oe(c,l,f),y=oe(h,p,f);return oe(m,y,d)},t.prototype.perlin3=function(t,e,n){var i=this._p,r=Math.floor(t),o=Math.floor(e),a=Math.floor(n);t-=r,e-=o,n-=a;var s=i[(r&=255)+i[(o&=255)+i[a&=255]]]%12,u=i[r+1+i[o+i[a]]]%12,c=i[r+i[o+1+i[a]]]%12,l=i[r+1+i[o+1+i[a]]]%12,h=i[r+i[o+i[a+1]]]%12,p=i[r+1+i[o+i[a+1]]]%12,f=i[r+i[o+1+i[a+1]]]%12,d=i[r+1+i[o+1+i[a+1]]]%12,m=ne(te[s],t,e,n),y=ne(te[u],t-1,e,n),v=ne(te[c],t,e-1,n),g=ne(te[l],t-1,e-1,n),_=ne(te[h],t,e,n-1),b=ne(te[p],t-1,e,n-1),x=ne(te[f],t,e-1,n-1),w=ne(te[d],t-1,e-1,n-1),S=ae(t),P=ae(e),M=ae(n),C=oe(m,y,S),T=oe(_,b,S),A=oe(v,g,S),O=oe(x,w,S),E=oe(C,A,P),D=oe(T,O,P);return oe(E,D,M)},t.prototype.perlinN=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];for(var i=this._p,r=e.length,o=[],a=[],s=[],u=0;u<r;u++){var c=e[u],l=Math.floor(c);c-=l,l&=255,o[u]=c,a[u]=l,s[u]=ae(c)}for(var h=Xt(r),p=h.length,f=Zt(r),d=[],m=(u=0,f.length);u<m;u++){for(var y=f[u],v=y.length,g=0;v>0;)g=i[a[--v]+y[v]+g];var _=h[g%p];v=y.length;for(var b=0;v>0;)b+=_[--v]*(o[v]-y[v]);d[u]=b}for(u=0;u<r;u++){var x=0;for(m=d.length;x<m;x+=2)d[x/2]=oe(d[x],d[x+1],s[u]);d.length=d.length>>1}return d[0]},Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(t){this._seed=t;var e=this._p;t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(var n=0;n<256;n++){var i=void 0;i=1&n?ee[n]^255&t:ee[n]^t>>8&255,e[n]=e[n+256]=i}},enumerable:!1,configurable:!0}),t}();function Xt(t){if(qt[t])return qt[t];var e=Yt(t-1),n=[];if(t>1)for(var i=t-1;i>=0;i--)for(var r=0;r<e.length;r++){var o=e[r].concat();o.splice(i,0,0),n.push(o)}else n=e;return qt[t]=n,n}var qt={};function Yt(t){if(t<2)return[[1],[-1]];for(var e=Yt(t-1),n=0,i=e.length;n<i;n++){var r=e[n];e[n]=r.concat(1),e[n+i]=r.concat(-1)}return e}function Zt(t){if(Qt[t])return Qt[t];if(t<2)return[[0],[1]];for(var e=Zt(t-1),n=0,i=e.length;n<i;n++){var r=e[n];e[n]=r.concat(0),e[n+i]=r.concat(1)}return Qt[t]=e,e}var Qt={},Jt=[[1],[-1]],$t=[[1,0],[-1,0],[0,1],[0,-1]],te=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],ee=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];function ne(t,e,n,i){return t[0]*e+t[1]*n+t[2]*i}function ie(t,e,n){return t[0]*e+t[1]*n}function re(t,e){return t[0]*e}function oe(t,e,n){return(1-n)*t+n*e}function ae(t){return t*t*t*(t*(6*t-15)+10)}var se=new Kt,ue=function(){function t(){this.arcLengthDivisions=200,this.needsUpdate=!1}return t.prototype.getResolution=function(t){return t},t.prototype.getPoint=function(t,e){return console.warn("Curve: .getPoint() not implemented."),null},t.prototype.getPointAt=function(t,e){var n=this.getUtoTmapping(t);return this.getPoint(n,e)},t.prototype.getPoints=function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},t.prototype.getSpacedPoints=function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},t.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]},t.prototype.getLengths=function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,n=[],i=this.getPoint(0),r=0;n.push(0);for(var o=1;o<=t;o++)r+=(e=this.getPoint(o/t)).distance(i),n.push(r),i=e;return this.cacheArcLengths=n,n},t.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},t.prototype.getUtoTmapping=function(t,e){var n,i=this.getLengths(),r=0,o=i.length;n=e||t*i[o-1];for(var a,s=0,u=o-1;s<=u;)if((a=i[r=Math.floor(s+(u-s)/2)]-n)<0)s=r+1;else{if(!(a>0)){u=r;break}u=r-1}if(i[r=u]===n)return r/(o-1);var c=i[r];return(r+(n-c)/(i[r+1]-c))/(o-1)},t.prototype.getTangent=function(t,e){var n=1e-4,i=t-n,r=t+n;i<0&&(i=0),r>1&&(r=1);var o=this.getPoint(i),a=this.getPoint(r),s=e;return s.copy(a).sub(o).normalize(),s},t.prototype.getTangentAt=function(t,e){var n=this.getUtoTmapping(t);return this.getTangent(n,e)},t.prototype.computeFrenetFrames=function(t,e){for(var n=new ht,i=[],r=[],o=[],a=new ht,s=new Nt,u=0;u<=t;u++){var c=u/t;i[u]=this.getTangentAt(c,new ht),i[u].normalize()}r[0]=new ht,o[0]=new ht;var l=Number.MAX_VALUE,h=Math.abs(i[0].x),p=Math.abs(i[0].y),f=Math.abs(i[0].z);h<=l&&(l=h,n.set(1,0,0)),p<=l&&(l=p,n.set(0,1,0)),f<=l&&n.set(0,0,1),i[0].crossTo(n,a).normalize(),i[0].crossTo(a,r[0]),i[0].crossTo(r[0],o[0]);for(u=1;u<=t;u++){if(r[u]=r[u-1].clone(),o[u]=o[u-1].clone(),i[u-1].crossTo(i[u],a),a.length>Number.EPSILON){a.normalize();var d=Math.acos(P.clamp(i[u-1].dot(i[u]),-1,1));s.fromAxisRotate(a,d*P.RAD2DEG),s.transformPoint3(r[u],r[u])}i[u].crossTo(r[u],o[u])}if(!0===e){d=Math.acos(P.clamp(r[0].dot(r[t]),-1,1));d/=t,i[0].dot(r[0].crossTo(r[t],a))>0&&(d=-d);for(u=1;u<=t;u++)s.fromAxisRotate(i[u],d*u*P.RAD2DEG).transformPoint3(r[u],r[u]),i[u].crossTo(r[u],o[u])}return{tangents:i,normals:r,binormals:o}},t}(),ce=function(t){function e(e,n){void 0===e&&(e=new lt),void 0===n&&(n=new lt);var i=t.call(this)||this;return i.v1=e,i.v2=n,i}return at(e,t),e.prototype.getResolution=function(t){return 1},e.prototype.getPoint=function(t,e){var n=e||new lt;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.scaleNumber(t).add(this.v1)),n},e.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},e.prototype.getTangent=function(t,e){void 0===e&&(e=new lt);var n=e;return n.copy(this.v2).sub(this.v1).normalize(),n},e}(ue),le=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curves=[],e.autoClose=!1,e}return at(e,t),e.prototype.add=function(t){this.curves.push(t)},e.prototype.closePath=function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new ce(e,t))},e.prototype.getPoint=function(t){for(var e=t*this.getLength(),n=this.getCurveLengths(),i=0;i<n.length;){if(n[i]>=e){var r=n[i]-e,o=this.curves[i],a=o.getLength(),s=0===a?0:1-r/a;return o.getPointAt(s)}i++}return null},e.prototype.getLength=function(){var t=this.getCurveLengths();return t[t.length-1]},e.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},e.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t},e.prototype.getSpacedPoints=function(t){void 0===t&&(t=40);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},e.prototype.getPoints=function(t){void 0===t&&(t=12);for(var e,n=[],i=0,r=this.curves;i<r.length;i++)for(var o=r[i],a=o.getResolution(t),s=o.getPoints(a),u=0;u<s.length;u++){var c=s[u];e&&e.equals(c)||(n.push(c),e=c)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},e}(ue),he=function(){function t(){}return t.triangulate=function(t,e,n){void 0===n&&(n=2);var i,r,o,a,s,u,c,l=e&&e.length,h=l?e[0]*n:t.length,p=pe(t,0,h,n,!0),f=[];if(!p||p.next===p.prev)return f;if(l&&(p=function(t,e,n,i){var r,o,a,s=[];for(r=0,o=e.length;r<o;r++)(a=pe(t,e[r]*i,r<o-1?e[r+1]*i:t.length,i,!1))===a.next&&(a.steiner=!0),s.push(Se(a));for(s.sort(_e),r=0;r<s.length;r++)be(s[r],n),n=fe(n,n.next);return n}(t,e,p,n)),t.length>80*n){i=o=t[0],r=a=t[1];for(var d=n;d<h;d+=n)(s=t[d])<i&&(i=s),(u=t[d+1])<r&&(r=u),s>o&&(o=s),u>a&&(a=u);c=0!==(c=Math.max(o-i,a-r))?1/c:0}return de(p,f,n,i,r,c),f},t}();function pe(t,e,n,i,r){var o,a;if(r===function(t,e,n,i){for(var r=0,o=e,a=n-i;o<n;o+=i)r+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return r}(t,e,n,i)>0)for(o=e;o<n;o+=i)a=Ie(o,t[o],t[o+1],a);else for(o=n-i;o>=e;o-=i)a=Ie(o,t[o],t[o+1],a);return a&&Te(a,a.next)&&(je(a),a=a.next),a}function fe(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!Te(i,i.next)&&0!==Ce(i.prev,i,i.next))i=i.next;else{if(je(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function de(t,e,n,i,r,o,a){if(t){!a&&o&&function(t,e,n,i){var r=t;do{f.objectIsEmpty(r.z)&&(r.z=we(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,o,a,s,u,c=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,i=n,s=0,e=0;e<c&&(s++,i=i.nextZ);e++);for(u=c;s>0||u>0&&i;)0!==s&&(0===u||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,u--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(a>1)}(r)}(t,i,r,o);for(var s,u,c=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?ye(t,i,r,o):me(t))e.push(s.i/n),e.push(t.i/n),e.push(u.i/n),je(t),t=u.next,c=u.next;else if((t=u)===c){a?1===a?de(t=ve(fe(t),e,n),e,n,i,r,o,2):2===a&&ge(t,e,n,i,r,o):de(fe(t),e,n,i,r,o,1);break}}}function me(t){var e=t.prev,n=t,i=t.next;if(Ce(e,n,i)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(Pe(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&Ce(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function ye(t,e,n,i){var r=t.prev,o=t,a=t.next;if(Ce(r,o,a)>=0)return!1;for(var s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,u=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,c=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,l=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,h=we(s,u,e,n,i),p=we(c,l,e,n,i),f=t.prevZ,d=t.nextZ;f&&f.z>=h&&d&&d.z<=p;){if(f!==t.prev&&f!==t.next&&Pe(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Ce(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,d!==t.prev&&d!==t.next&&Pe(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Ce(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&Pe(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Ce(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;d&&d.z<=p;){if(d!==t.prev&&d!==t.next&&Pe(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Ce(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function ve(t,e,n){var i=t;do{var r=i.prev,o=i.next.next;!Te(r,o)&&Ae(r,i,i.next,o)&&De(r,o)&&De(o,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(o.i/n),je(i),je(i.next),i=t=o),i=i.next}while(i!==t);return fe(i)}function ge(t,e,n,i,r,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Me(a,s)){var u=ze(a,s);return a=fe(a,a.next),u=fe(u,u.next),de(a,e,n,i,r,o),void de(u,e,n,i,r,o)}s=s.next}a=a.next}while(a!==t)}function _e(t,e){return t.x-e.x}function be(t,e){if(e=function(t,e){var n,i=e,r=t.x,o=t.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>a){if(a=s,s===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===a)return n;var u,c=n,l=n.x,h=n.y,p=1/0;i=n;do{r>=i.x&&i.x>=l&&r!==i.x&&Pe(o<h?r:a,o,l,h,o<h?a:r,o,i.x,i.y)&&(u=Math.abs(o-i.y)/(r-i.x),De(i,t)&&(u<p||u===p&&(i.x>n.x||i.x===n.x&&xe(n,i)))&&(n=i,p=u)),i=i.next}while(i!==c);return n}(t,e),e){var n=ze(e,t);fe(e,e.next),fe(n,n.next)}}function xe(t,e){return Ce(t.prev,t,e.prev)<0&&Ce(e.next,t,t.next)<0}function we(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Se(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Pe(t,e,n,i,r,o,a,s){return(r-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(i-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(r-a)*(i-s)>=0}function Me(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Ae(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(De(t,e)&&De(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(Ce(t.prev,t,e.prev)||Ce(t,e.prev,e))||Te(t,e)&&Ce(t.prev,t,t.next)>0&&Ce(e.prev,e,e.next)>0)}function Ce(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Te(t,e){return t.x===e.x&&t.y===e.y}function Ae(t,e,n,i){var r=Ee(Ce(t,e,n)),o=Ee(Ce(t,e,i)),a=Ee(Ce(n,i,t)),s=Ee(Ce(n,i,e));return r!==o&&a!==s||(!(0!==r||!Oe(t,n,e))||(!(0!==o||!Oe(t,i,e))||(!(0!==a||!Oe(n,t,i))||!(0!==s||!Oe(n,e,i)))))}function Oe(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Ee(t){return t>0?1:t<0?-1:0}function De(t,e){return Ce(t.prev,t,t.next)<0?Ce(t,e,t.next)>=0&&Ce(t,t.prev,e)>=0:Ce(t,e,t.prev)<0||Ce(t,t.next,e)<0}function ze(t,e){var n=new Re(t.i,t.x,t.y),i=new Re(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function Ie(t,e,n,i){var r=new Re(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function je(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}var Re=function(t,e,n){this.z=null,this.prevZ=null,this.nextZ=null,this.prev=null,this.next=null,this.steiner=!1,this.i=t,this.x=e,this.y=n};var Le=function(){function t(){}return t.area=function(t){for(var e=t.length,n=0,i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*n},t.isClockWise=function(e){return t.area(e)<0},t.triangulateShape=function(t,e){var n=[],i=[],r=[];Ne(t),Fe(n,t);var o=t.length;e.forEach(Ne);for(var a=0;a<e.length;a++)i.push(o),o+=e[a].length,Fe(n,e[a]);var s=he.triangulate(n,i);for(a=0;a<s.length;a+=3)r.push(s.slice(a,a+3));return r},t}();function Ne(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Fe(t,e){for(var n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}var ke=function(){function t(){}return t.CatmullRom=function(t,e,n,i,r){var o=.5*(i-e),a=.5*(r-n),s=t*t;return(2*n-2*i+o+a)*(t*s)+(-3*n+3*i-2*o-a)*s+o*t+n},t.QuadraticBezier=function(t,e,n,i){return function(t,e){var n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,i)},t.CubicBezier=function(t,e,n,i,r){return function(t,e){var n=1-t;return n*n*n*e}(t,e)+function(t,e){var n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,i)+function(t,e){return t*t*t*e}(t,r)},t}();var Be=function(t){function e(e,n,i,r){void 0===e&&(e=new lt),void 0===n&&(n=new lt),void 0===i&&(i=new lt),void 0===r&&(r=new lt);var o=t.call(this)||this;return o.v0=e,o.v1=n,o.v2=i,o.v3=r,o}return at(e,t),e.prototype.getPoint=function(t,e){void 0===e&&(e=new lt);var n=e,i=this.v0,r=this.v1,o=this.v2,a=this.v3;return n.set(ke.CubicBezier(t,i.x,r.x,o.x,a.x),ke.CubicBezier(t,i.y,r.y,o.y,a.y)),n},e}(ue),Ve=function(t){function e(e,n,i,r,o,a,s,u){void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===o&&(o=0),void 0===a&&(a=2*Math.PI),void 0===s&&(s=!1),void 0===u&&(u=0);var c=t.call(this)||this;return c.aX=e,c.aY=n,c.xRadius=i,c.yRadius=r,c.aStartAngle=o,c.aEndAngle=a,c.aClockwise=s,c.aRotation=u,c}return at(e,t),e.prototype.getResolution=function(t){return 2*t},e.prototype.getPoint=function(t,e){void 0===e&&(e=new lt);for(var n=e,i=2*Math.PI,r=this.aEndAngle-this.aStartAngle,o=Math.abs(r)<Number.EPSILON;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=o?0:i),!0!==this.aClockwise||o||(r===i?r=-i:r-=i);var a=this.aStartAngle+t*r,s=this.aX+this.xRadius*Math.cos(a),u=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var c=Math.cos(this.aRotation),l=Math.sin(this.aRotation),h=s-this.aX,p=u-this.aY;s=h*c-p*l+this.aX,u=h*l+p*c+this.aY}return n.set(s,u),n},e}(ue),We=function(t){function e(e,n,i){void 0===e&&(e=new lt),void 0===n&&(n=new lt),void 0===i&&(i=new lt);var r=t.call(this)||this;return r.v0=e,r.v1=n,r.v2=i,r}return at(e,t),e.prototype.getPoint=function(t,e){void 0===e&&(e=new lt);var n=e,i=this.v0,r=this.v1,o=this.v2;return n.set(ke.QuadraticBezier(t,i.x,r.x,o.x),ke.QuadraticBezier(t,i.y,r.y,o.y)),n},e}(ue),Ue=function(t){function e(e){void 0===e&&(e=[]);var n=t.call(this)||this;return n.points=e,n}return at(e,t),e.prototype.getResolution=function(t){return t*this.points.length},e.prototype.getPoint=function(t,e){var n=e||new lt,i=this.points,r=(i.length-1)*t,o=Math.floor(r),a=r-o,s=i[0===o?o:o-1],u=i[o],c=i[o>i.length-2?i.length-1:o+1],l=i[o>i.length-3?i.length-1:o+2];return n.set(ke.CatmullRom(a,s.x,u.x,c.x,l.x),ke.CatmullRom(a,s.y,u.y,c.y,l.y)),n},e}(ue),Ge=function(t){function e(e){var n=t.call(this)||this;return n.currentPoint=new lt,e&&n.fromPoints(e),n}return at(e,t),e.prototype.fromPoints=function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this},e.prototype.moveTo=function(t,e){return this.currentPoint.set(t,e),this},e.prototype.lineTo=function(t,e){var n=new ce(this.currentPoint.clone(),new lt(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this},e.prototype.quadraticCurveTo=function(t,e,n,i){var r=new We(this.currentPoint.clone(),new lt(t,e),new lt(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this},e.prototype.bezierCurveTo=function(t,e,n,i,r,o){var a=new Be(this.currentPoint.clone(),new lt(t,e),new lt(n,i),new lt(r,o));return this.curves.push(a),this.currentPoint.set(r,o),this},e.prototype.splineThru=function(t){var e=[this.currentPoint.clone()].concat(t),n=new Ue(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this},e.prototype.arc=function(t,e,n,i,r,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=1),void 0===i&&(i=0),void 0===r&&(r=2*Math.PI),void 0===o&&(o=!1);var a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(t+a,e+s,n,i,r,o),this},e.prototype.absarc=function(t,e,n,i,r,o){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=1),void 0===i&&(i=0),void 0===r&&(r=2*Math.PI),void 0===o&&(o=!1),this.absellipse(t,e,n,n,i,r,o),this},e.prototype.ellipse=function(t,e,n,i,r,o,a,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=1),void 0===i&&(i=1),void 0===r&&(r=0),void 0===o&&(o=2*Math.PI),void 0===a&&(a=!1),void 0===s&&(s=0);var u=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+u,e+c,n,i,r,o,a,s),this},e.prototype.absellipse=function(t,e,n,i,r,o,a,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=1),void 0===i&&(i=1),void 0===r&&(r=0),void 0===o&&(o=2*Math.PI),void 0===a&&(a=!1),void 0===s&&(s=0);var u=new Ve(t,e,n,i,r,o,a,s);if(this.curves.length>0){var c=u.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(u);var l=u.getPoint(1);return this.currentPoint.copy(l),this},e}(le),He=function(t){function e(e){var n=t.call(this,e)||this;return n.holes=[],n}return at(e,t),e.prototype.getPointsHoles=function(t){for(var e=[],n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e},e.prototype.extractPoints=function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},e.prototype.extractArray=function(t){var e=this.extractPoints(t);return{points:e.shape.reduce((function(t,e){return t.push(e.x,e.y),t}),[]),holes:e.holes.reduce((function(t,e){var n=e.reduce((function(t,e){return t.push(e.x,e.y),t}),[]);return t.push(n),t}),[])}},e.prototype.triangulate=function(t){void 0===t&&(t={points:[],indices:[]});var n=this.extractArray();return e.triangulate(n.points,n.holes,t),t},e.triangulate=function(t,e,n){void 0===e&&(e=[]),void 0===n&&(n={points:[],indices:[]});var i=n.points,r=n.indices;if(t.length>=6){for(var o=[],a=0;a<e.length;a++){var s=e[a];o.push(t.length/2),t=t.concat(s)}var u=he.triangulate(t,o,2);if(!u)return;var c=i.length/2;for(a=0;a<u.length;a+=3)r.push(u[a]+c),r.push(u[a+1]+c),r.push(u[a+2]+c);for(a=0;a<t.length;a++)i.push(t[a])}return n},e}(Ge),Ke=function(){function t(){this.color=new yt,this.subPaths=[],this.subPaths=[],this.currentPath=null}return t.prototype.moveTo=function(t,e){return this.currentPath=new Ge,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},t.prototype.lineTo=function(t,e){return this.currentPath.lineTo(t,e),this},t.prototype.quadraticCurveTo=function(t,e,n,i){return this.currentPath.quadraticCurveTo(t,e,n,i),this},t.prototype.bezierCurveTo=function(t,e,n,i,r,o){return this.currentPath.bezierCurveTo(t,e,n,i,r,o),this},t.prototype.splineThru=function(t){return this.currentPath.splineThru(t),this},t.prototype.closePath=function(){this.currentPath.closePath()},t.prototype.toShapes=function(t,e){function n(t){for(var e=[],n=0,i=t.length;n<i;n++){var r=t[n],o=new He;o.curves=r.curves,e.push(o)}return e}function i(t,e){for(var n=e.length,i=!1,r=n-1,o=0;o<n;r=o++){var a=e[r],s=e[o],u=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(a=e[o],u=-u,s=e[r],c=-c),t.y<a.y||t.y>s.y)continue;if(t.y===a.y){if(t.x===a.x)return!0}else{var l=c*(t.x-a.x)-u*(t.y-a.y);if(0===l)return!0;if(l<0)continue;i=!i}}else{if(t.y!==a.y)continue;if(s.x<=t.x&&t.x<=a.x||a.x<=t.x&&t.x<=s.x)return!0}}return i}void 0===t&&(t=!1),void 0===e&&(e=!1);var r,o,a,s=this.subPaths;if(0===s.length)return[];if(!0===e)return n(s);var u=[];if(1===s.length)return o=s[0],(a=new He).curves=o.curves,u.push(a),u;var c=!Le.isClockWise(s[0].getPoints());t&&(c=!c);var l,h,p=[],f=[],d=[],m=0;f[m]=void 0,d[m]=[];for(var y=0,v=s.length;y<v;y++)l=(o=s[y]).getPoints(),r=Le.isClockWise(l),t&&(r=!r),r?(!c&&f[m]&&m++,f[m]={s:new He,p:l},f[m].s.curves=o.curves,c&&m++,d[m]=[]):d[m].push({h:o,p:l[0]});if(!f[0])return n(s);if(f.length>1){for(var g=!1,_=[],b=0,x=f.length;b<x;b++)p[b]=[];for(b=0,x=f.length;b<x;b++)for(var w=d[b],S=0;S<w.length;S++){for(var P=w[S],M=!0,C=0;C<f.length;C++)i(P.p,f[C].p)&&(b!==C&&_.push({froms:b,tos:C,hole:S}),M?(M=!1,p[C].push(P)):g=!0);M&&p[b].push(P)}_.length>0&&(g||(d=p))}y=0;for(var T=f.length;y<T;y++){a=f[y].s,u.push(a);for(var A=0,O=(h=d[y]).length;A<O;A++)a.holes.push(h[A].h)}return u},t}(),Xe=function(){function t(t){this.isCCW=!1,this.charGeometryCache={},this.data=t}return t.prototype.generateShapes=function(t,e,n,i){void 0===i&&(i="left"),void 0===e&&(e=100),void 0===n&&(n=1.25*e);for(var r=[],o=function(t,e,n,i,r){void 0===r&&(r="left");for(var o=e/i.unitsPerEm,a=[],s=0,u=0,c=t.split("\n"),l=[],h=0,p=0,f=c.length;p<f;p++){var d=c[p];p>0&&(s=0);for(var m=0,y=(g=Array.from?Array.from(d):String(d).split("")).length;m<y;m++){if(9===(_=g[m]).charCodeAt(0))s+=20;else{var v=i.glyphs[_]||i.glyphs["?"];v&&(s+=v.ha*o)}}l[p]=s,h=Math.max(h,s)}for(p=0,f=c.length;p<f;p++){d=c[p];s=0,u=-n*p,"center"===r?s=(h-l[p])/2:"right"===r&&(s=h-l[p]);var g;for(m=0,y=(g=Array.from?Array.from(d):String(d).split("")).length;m<y;m++){var _;if(9===(_=g[m]).charCodeAt(0))s+=20;else{var b=qe(_,o,s,u,i);s+=b.offsetX,a.push(b.path)}}}return a}(t,e,n,this.data,i),a=0,s=o.length;a<s;a++)for(var u=o[a].toShapes(this.isCCW),c=0,l=u.length;c<l;c++)r.push(u[c]);return r},t.prototype.generateCharGeometry=function(t,e){if(void 0===e&&(e={points:[],indices:[]}),this.charGeometryCache[t])return this.charGeometryCache[t];for(var n=qe(t,1,0,0,this.data),i=n.path,r=n.offsetX,o=i.toShapes(this.isCCW),a=0,s=o.length;a<s;a++)o[a].triangulate(e);return this.charGeometryCache[t]={geometry:e,width:r},this.charGeometryCache[t]},t.prototype.calculateGeometry=function(t,e,n,i,r,o){void 0===i&&(i="left"),void 0===r&&(r="alphabetic"),void 0===o&&(o=128),void 0===n&&(n=1.25*e),n=n/e*this.data.unitsPerEm;var a=function(t,e,n){for(var i={text:e,font:t,width:0,numVertices:0,numIndices:0,lines:[]},r=e.split("\n"),o=0,a=r.length;o<a;o++){i.lines[o]={text:r[o],width:0,numVertices:0,numIndices:0,chars:[]};var s=i.lines[o];o>0&&(s.width=0);for(var u=Array.from?Array.from(s.text):String(s.text).split(""),c=0,l=u.length;c<l;c++){var h=u[c];if("\t"===h)s.width+=n;else{var p=t.generateCharGeometry(h),f=s.chars[c]={text:h,width:p.width,offsetX:s.width,offsetVertices:i.numVertices,offsetIndices:i.numIndices,numVertices:p.geometry.points.length,numIndices:p.geometry.indices.length,geometry:p.geometry};s.width+=f.width,s.numVertices+=f.numVertices,s.numIndices+=f.numIndices,i.numVertices+=f.numVertices,i.numIndices+=f.numIndices}}i.width=Math.max(i.width,s.width)}return i}(this,t,o),s=function(t,e,n,i,r){var o=t.font.data,a=o.unitsPerEm,s=o.ascender,u=o.descender,c=e/a,l=new Float32Array(t.numVertices/2*3),h=new Uint32Array(t.numIndices),p=0;"top"===r?p=s:"bottom"===r?p=u:"middle"===r?p=(s+u)/2:"alphabetic"===r&&(p=0);for(var f=t.lines,d=t.width,m=0,y=f.length;m<y;m++){var v=f[m],g=v.width,_=v.chars,b=0,x=-n*m;"center"===i?b=(d-g)/2:"right"===i&&(b=d-g);for(var w=0,S=_.length;w<S;w++){var P=_[w];if(P){var M=P.offsetX,C=P.offsetVertices,T=P.offsetIndices,A=P.geometry;O({offsetX:b+M,offsetY:x-p,scale:c,targetVertices:l,targetIndices:h,offsetVertices:C,offsetIndices:T,sourceVertices:A.points,sourceIndices:A.indices})}}}return{vertices:l,indices:h};function O(t){for(var e=t.offsetX,n=t.offsetY,i=t.scale,r=t.targetVertices,o=t.targetIndices,a=t.offsetVertices,s=t.offsetIndices,u=t.sourceVertices,c=t.sourceIndices,l=a/2*3,h=0,p=0,f=u.length/2;p<f;p++)r[l++]=(u[h++]+e)*i,r[l++]=-(u[h++]+n)*i,r[l++]=0;var d=a/2;for(p=0,f=c.length;p<f;p++)o[s+p]=c[p]+d}}(a,e,n,i,r),u=s.vertices,c=s.indices,l=function(t){for(var e=new Float32Array(t.length),n=new Float32Array(t.length/3*2),i=0,r=0,o=0,a=0,s=t.length/3;a<s;a++)n[o++]=t[i++],n[o++]=t[i++],i++,e[r++]=0,e[r++]=0,e[r++]=1;return{normals:e,uvs:n}}(u);return{vertices:u,normals:l.normals,uvs:l.uvs,indices:c}},t}();function qe(t,e,n,i,r){var o=r.glyphs[t]||r.glyphs["?"];if(o){var a,s,u,c,l,h,p,f,d=new Ke;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),y=0,v=m.length;y<v;){var g=m[y++];switch(g){case"m":a=m[y++]*e+n,s=m[y++]*e+i,d.moveTo(a,s);break;case"l":a=m[y++]*e+n,s=m[y++]*e+i,d.lineTo(a,s);break;case"q":u=m[y++]*e+n,c=m[y++]*e+i,l=m[y++]*e+n,h=m[y++]*e+i,d.quadraticCurveTo(l,h,u,c);break;case"b":u=m[y++]*e+n,c=m[y++]*e+i,l=m[y++]*e+n,h=m[y++]*e+i,p=m[y++]*e+n,f=m[y++]*e+i,d.bezierCurveTo(l,h,p,f,u,c);break;case"z":d.closePath();break;default:console.assert(""===g.trim())}}return{offsetX:o.ha*e,path:d}}console.error('    Font: character "'+t+'" does not exists in font family '+r.familyName+".")}var Ye,Ze,Qe=function(t){function e(e,n,i,r,o,a){return void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===o&&(o=2*Math.PI),void 0===a&&(a=!1),t.call(this,e,n,i,i,r,o,a)||this}return at(e,t),e}(Ve),Je=function(t){function e(e,n,i,r){void 0===e&&(e=[]),void 0===n&&(n=!1),void 0===i&&(i="centripetal"),void 0===r&&(r=.5);var o=t.call(this)||this;return o.isCatmullRomCurve3=!0,o.points=e,o.closed=n,o.curveType=i,o.tension=r,o}return at(e,t),e.prototype.getPoint=function(t,e){void 0===e&&(e=new ht);var n,i,r=e,o=this.points,a=o.length,s=(a-(this.closed?0:1))*t,u=Math.floor(s),c=s-u;this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/a)+1)*a:0===c&&u===a-1&&(u=a-2,c=1),this.closed||u>0?n=o[(u-1)%a]:(tn.copy(o[0]).sub(o[1]).add(o[0]),n=tn);var l=o[u%a],h=o[(u+1)%a];if(this.closed||u+2<a?i=o[(u+2)%a]:(tn.copy(o[a-1]).sub(o[a-2]).add(o[a-1]),i=tn),"centripetal"===this.curveType||"chordal"===this.curveType){var p="chordal"===this.curveType?.5:.25,f=Math.pow(n.distanceSquared(l),p),d=Math.pow(l.distanceSquared(h),p),m=Math.pow(h.distanceSquared(i),p);d<1e-4&&(d=1),f<1e-4&&(f=d),m<1e-4&&(m=d),en.initNonuniformCatmullRom(n.x,l.x,h.x,i.x,f,d,m),nn.initNonuniformCatmullRom(n.y,l.y,h.y,i.y,f,d,m),rn.initNonuniformCatmullRom(n.z,l.z,h.z,i.z,f,d,m)}else"catmullrom"===this.curveType&&(en.initCatmullRom(n.x,l.x,h.x,i.x,this.tension),nn.initCatmullRom(n.y,l.y,h.y,i.y,this.tension),rn.initCatmullRom(n.z,l.z,h.z,i.z,this.tension));return r.set(en.calc(c),nn.calc(c),rn.calc(c)),r},e}(ue),$e=function(){function t(){this.c0=0,this.c1=0,this.c2=0,this.c3=0}return t.prototype.init=function(t,e,n,i){this.c0=t,this.c1=n,this.c2=-3*t+3*e-2*n-i,this.c3=2*t-2*e+n+i},t.prototype.initCatmullRom=function(t,e,n,i,r){this.init(e,n,r*(n-t),r*(i-e))},t.prototype.initNonuniformCatmullRom=function(t,e,n,i,r,o,a){var s=(e-t)/r-(n-t)/(r+o)+(n-e)/o,u=(n-e)/o-(i-e)/(o+a)+(i-n)/a;s*=o,u*=o,this.init(e,n,s,u)},t.prototype.calc=function(t){var e=t*t,n=e*t;return this.c0+this.c1*t+this.c2*e+this.c3*n},t}(),tn=new ht,en=new $e,nn=new $e,rn=new $e,on=function(t){function e(e,n,i,r){void 0===e&&(e=new ht),void 0===n&&(n=new ht),void 0===i&&(i=new ht),void 0===r&&(r=new ht);var o=t.call(this)||this;return o.v0=e,o.v1=n,o.v2=i,o.v3=r,o}return at(e,t),e.prototype.getPoint=function(t,e){void 0===e&&(e=new ht);var n=e,i=this.v0,r=this.v1,o=this.v2,a=this.v3;return n.set(ke.CubicBezier(t,i.x,r.x,o.x,a.x),ke.CubicBezier(t,i.y,r.y,o.y,a.y),ke.CubicBezier(t,i.z,r.z,o.z,a.z)),n},e}(ue),an=function(t){function e(e,n){void 0===e&&(e=new ht),void 0===n&&(n=new ht);var i=t.call(this)||this;return i.v1=e,i.v2=n,i}return at(e,t),e.prototype.getResolution=function(t){return 1},e.prototype.getPoint=function(t,e){void 0===e&&(e=new ht);var n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyNumber(t).add(this.v1)),n},e.prototype.getPointAt=function(t,e){return void 0===e&&(e=new ht),this.getPoint(t,e)},e}(ue),sn=function(t){function e(e,n,i){void 0===e&&(e=new ht),void 0===n&&(n=new ht),void 0===i&&(i=new ht);var r=t.call(this)||this;return r.v0=e,r.v1=n,r.v2=i,r}return at(e,t),e.prototype.getPoint=function(t,e){void 0===e&&(e=new ht);var n=e,i=this.v0,r=this.v1,o=this.v2;return n.set(ke.QuadraticBezier(t,i.x,r.x,o.x),ke.QuadraticBezier(t,i.y,r.y,o.y),ke.QuadraticBezier(t,i.z,r.z,o.z)),n},e}(ue);t.AttributeUsage=void 0,(Ye=t.AttributeUsage||(t.AttributeUsage={})).STATIC_DRAW="STATIC_DRAW",Ye.DYNAMIC_DRAW="DYNAMIC_DRAW",Ye.STREAM_DRAW="STREAM_DRAW",t.GLArrayType=void 0,(Ze=t.GLArrayType||(t.GLArrayType={})).BYTE="BYTE",Ze.SHORT="SHORT",Ze.UNSIGNED_BYTE="UNSIGNED_BYTE",Ze.UNSIGNED_SHORT="UNSIGNED_SHORT",Ze.FLOAT="FLOAT",Ze.UNSIGNED_INT="UNSIGNED_INT",Ze.HALF_FLOAT="HALF_FLOAT";var un,cn,ln,hn,pn,fn,dn,mn,yn,vn=function(){function t(){}return t.active=function(t,e){var n=this.getTexture(t,e),i=t[e.textureType];return t.bindTexture(i,n),t.texParameteri(i,t.TEXTURE_MIN_FILTER,t[e.minFilter]),t.texParameteri(i,t.TEXTURE_MAG_FILTER,t[e.magFilter]),t.texParameteri(i,t.TEXTURE_WRAP_S,t[e.wrapS]),t.texParameteri(i,t.TEXTURE_WRAP_T,t[e.wrapT]),t.texParameterfAnisotropy(i,e.anisotropy),n},t.getTexture=function(t,e){e.invalid&&(this.clear(e),e.invalid=!1);var n=t.cache.textures.get(e);if(!n){if(!(n=t.createTexture()))throw console.error("createTexture 失败！"),"";t.cache.textures.set(e,n);var i=t[e.textureType],r=t[e.format],o=t[e.type];switch(t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipY?1:0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premulAlpha?1:0),t.bindTexture(i,n),i){case t.TEXTURE_CUBE_MAP:for(var a=e.activePixels,s=[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Z],u=0;u<s.length;u++)e.isRenderTarget?t.texImage2D(s[u],0,r,e.OFFSCREEN_WIDTH,e.OFFSCREEN_HEIGHT,0,r,o,null):t.texImage2D(s[u],0,r,r,o,a[u]);break;case t.TEXTURE_2D:var c=e.activePixels;e.isRenderTarget?t.texImage2D(i,0,r,e.OFFSCREEN_WIDTH,e.OFFSCREEN_HEIGHT,0,r,o,null):t.texImage2D(i,0,r,r,o,c);break;default:throw""}e.generateMipmap&&t.generateMipmap(i)}return n},t.clear=function(t){xn.glList.forEach((function(e){var n=e.cache.textures.get(t);n&&(e.deleteTexture(n),e.cache.textures.delete(t))}))},t}(),gn=function(t){this.compileShaderResults={},this.textures=new Map,this.attributes=new Map,this.indices=new Map,this.renderBuffers=new Map,this.frameBuffers=new Map,t.cache=this,this._gl=t},_n=function(t){t.capabilities=this,this.isWebGL2=!1;var e=null;"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext&&(e=t,this.isWebGL2=!0),t.extensions.EXT_texture_filter_anisotropic?this.maxAnisotropy=t.getParameter(t.extensions.EXT_texture_filter_anisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT):this.maxAnisotropy=0,this.maxPrecision=function(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}("highp"),this.maxTextures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxCubemapSize=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxAttributes=t.getParameter(t.MAX_VERTEX_ATTRIBS),this.maxVertexUniforms=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),this.maxVaryings=t.getParameter(t.MAX_VARYING_VECTORS),this.maxFragmentUniforms=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),this.vertexTextures=this.maxVertexTextures>0,this.floatFragmentTextures=this.isWebGL2||!!t.getExtension("OES_texture_float"),this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures,this.maxSamples=this.isWebGL2?t.getParameter(e.MAX_SAMPLES):0,this.stencilBits=t.getParameter(t.STENCIL_BITS)},bn=function(){function t(t){console.assert(!t.extensions,t+" "+t.extensions+" 存在！"),t.extensions=this,this.initExtensions(t),this.cacheGLQuery(t),this.wrap(t)}return t.prototype.initExtensions=function(t){this.ANGLE_instanced_arrays=t.getExtension("ANGLE_instanced_arrays"),this.EXT_blend_minmax=t.getExtension("EXT_blend_minmax"),this.EXT_blend_minmax&&(t.MIN_EXT=this.EXT_blend_minmax.MIN_EXT,t.MAX_EXT=this.EXT_blend_minmax.MAX_EXT),this.EXT_color_buffer_half_float=t.getExtension("EXT_color_buffer_half_float"),this.EXT_frag_depth=t.getExtension("EXT_frag_depth"),this.EXT_sRGB=t.getExtension("EXT_sRGB"),this.EXT_shader_texture_lod=t.getExtension("EXT_shader_texture_lod"),this.EXT_texture_filter_anisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.OES_element_index_uint=t.getExtension("OES_element_index_uint"),this.OES_standard_derivatives=t.getExtension("OES_standard_derivatives"),this.OES_texture_float=t.getExtension("OES_texture_float"),this.OES_texture_float_linear=t.getExtension("OES_texture_float_linear"),this.OES_texture_half_float=t.getExtension("OES_texture_half_float"),this.OES_texture_half_float_linear=t.getExtension("OES_texture_half_float_linear"),this.OES_vertex_array_object=t.getExtension("OES_vertex_array_object"),this.WEBGL_color_buffer_float=t.getExtension("WEBGL_color_buffer_float"),this.WEBGL_compressed_texture_atc=t.getExtension("WEBGL_compressed_texture_atc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_atc"),this.WEBGL_compressed_texture_etc1=t.getExtension("WEBGL_compressed_texture_etc1"),this.WEBGL_compressed_texture_pvrtc=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this.WEBGL_compressed_texture_s3tc=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this.WEBGL_debug_renderer_info=t.getExtension("WEBGL_debug_renderer_info"),this.WEBGL_debug_shaders=t.getExtension("WEBGL_debug_shaders"),this.WEBGL_depth_texture=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture"),this.WEBGL_draw_buffers=t.getExtension("WEBGL_draw_buffers"),this.WEBGL_lose_context=t.getExtension("WEBGL_lose_context")||t.getExtension("WEBKIT_WEBGL_lose_context")||t.getExtension("MOZ_WEBGL_lose_context")},t.prototype.cacheGLQuery=function(t){var e=t.getExtension;t.getExtension=function(n){return t.extensions[n]||(t.extensions[n]=e.apply(t,arguments)),t.extensions[n]}},t.prototype.wrap=function(t){t.texParameterfAnisotropy||(t.texParameterfAnisotropy=function(e,n){n<=0||(t.extensions.EXT_texture_filter_anisotropic?(n>t.capabilities.maxAnisotropy&&(n=t.capabilities.maxAnisotropy,console.warn(n+" 超出 maxAnisotropy 的最大值 "+t.capabilities.maxAnisotropy+" ！,使用最大值替换。")),t.texParameterf(e,t.extensions.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n)):console.warn("浏览器不支持各向异性过滤（anisotropy）特性！"))}),t.vertexAttribDivisor||(t.vertexAttribDivisor=function(e,n){t.extensions.ANGLE_instanced_arrays?t.extensions.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(e,n):console.warn("浏览器 不支持 drawElementsInstanced ！")}),t.drawElementsInstanced||(t.drawElementsInstanced=function(e,n,i,r,o){t.extensions.ANGLE_instanced_arrays?t.extensions.ANGLE_instanced_arrays.drawElementsInstancedANGLE(e,n,i,r,o):console.warn("浏览器 不支持 drawElementsInstanced ！")}),t.drawArraysInstanced||(t.drawArraysInstanced=function(e,n,i,r){t.extensions.ANGLE_instanced_arrays?t.extensions.ANGLE_instanced_arrays.drawArraysInstancedANGLE(e,n,i,r):console.warn("浏览器 不支持 drawArraysInstanced ！")})},t}(),xn=function(){function t(e,n){this.preActiveAttributes=[];for(var i=["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"],r=null,o=0;o<i.length;++o)try{(r=e.getContext(i[o],n)).contextId=i[o],r.contextAttributes=n;break}catch(t){}if(!r)throw"无法初始化WEBGL";this.gl=r,new gn(r),new bn(r),new _n(r),r.clearColor(0,0,0,1),r.clearDepth(1),r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL),t.glList.push(r),console.assert(!r.render,r+" "+r.render+" 存在！")}return t.prototype.render=function(t){if(0!==t.getInstanceCount()){var e=t.getShaderMacro(),n=t.getShader();n.shaderMacro=e;var i=n.activeShaderProgram(this.gl);if(i){var r=this.checkRenderData(t);r&&(this.gl.useProgram(i.program),r.renderParams.updateRenderParams(this.gl),this.activeAttributes(r,i.attributes),this.activeUniforms(r,i.uniforms),this.draw(r,this.gl[r.renderParams.renderMode]))}}},t.prototype.checkRenderData=function(t){var e=t.getShader(),n=e.activeShaderProgram(this.gl);if(!n)return console.warn("缺少着色器，无法渲染!"),null;var i={};for(var r in n.attributes){var o=t.getAttributeByKey(r);if(!o)return console.warn("缺少顶点 attribute 数据 "+r+" ，无法渲染!"),null;i[r]=o}var a={};for(var r in n.uniforms){var s=n.uniforms[r];s.name&&(r=s.name);var u=t.getUniformByKey(r);if(void 0===u)return console.warn("缺少 uniform 数据 "+r+" ,无法渲染！"),null;a[r]=u}var c=t.getIndexBuffer();return{shader:e,attributes:i,uniforms:a,renderParams:t.getRenderParams(),index:c,instanceCount:t.getInstanceCount()}},t.prototype.activeAttributes=function(t,e){var n=this.gl,i=[];for(var r in e){var o=e[r];t.attributes[r].active(n,o.location),i.push(o.location);var a=this.preActiveAttributes.indexOf(o.location);-1!==a&&this.preActiveAttributes.splice(a,1)}this.preActiveAttributes.forEach((function(t){n.disableVertexAttribArray(t)})),this.preActiveAttributes=i},t.prototype.activeUniforms=function(t,e){var n=t.uniforms;for(var i in e){for(var r=e[i],o=r.paths,a=n[o[0]],s=1;s<o.length;s++)a=a[o[s]];this.setContext3DUniform(r,a)}},t.prototype.setContext3DUniform=function(t,e){var n=this.gl,i=e;e.toArray&&(i=e.toArray());var r=t.location;switch(t.type){case n.INT:n.uniform1i(r,e);break;case n.FLOAT_MAT3:n.uniformMatrix3fv(r,!1,i);break;case n.FLOAT_MAT4:n.uniformMatrix4fv(r,!1,i);break;case n.FLOAT:n.uniform1f(r,e);break;case n.FLOAT_VEC2:n.uniform2f(r,i[0],i[1]);break;case n.FLOAT_VEC3:n.uniform3f(r,i[0],i[1],i[2]);break;case n.FLOAT_VEC4:n.uniform4f(r,i[0],i[1],i[2],i[3]);break;case n.SAMPLER_2D:case n.SAMPLER_CUBE:var o=e;n.activeTexture(n["TEXTURE"+t.textureID]),vn.active(n,o),n.uniform1i(r,t.textureID);break;default:console.error("无法识别的uniform类型 "+t.name+" "+e)}},t.prototype.draw=function(t,e){var n=this.gl,i=~~M.getvalue(t.instanceCount),r=t.index;if(r){r.active(n);var o=n[r.type];if(0===r.count)return;i>1?n.drawElementsInstanced(e,r.count,o,r.offset,i):n.drawElements(e,r.count,o,r.offset)}else{var a=function(t){for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];return n.data.length/n.size}return 0}(t.attributes);if(0===a)return void console.warn("顶点数量为0，不进行渲染！");i>1?n.drawArraysInstanced(e,0,a,i):n.drawArrays(e,0,a)}},t.glList=[],t}(),wn=function(){function e(e){this.size=3,this.type=t.GLArrayType.FLOAT,this.normalized=!1,this.stride=0,this.offset=0,this.divisor=0,this.usage=t.AttributeUsage.STATIC_DRAW,this.invalid=!0,Object.assign(this,e)}return Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.invalidate()},enumerable:!1,configurable:!0}),e.prototype.invalidate=function(){this.invalid=!0},e.prototype.active=function(t,e){t.enableVertexAttribArray(e);var n=this.getBuffer(t);t.bindBuffer(t.ARRAY_BUFFER,n),t.vertexAttribPointer(e,this.size,t[this.type],this.normalized,this.stride,this.offset),t.vertexAttribDivisor(e,this.divisor)},e.prototype.getBuffer=function(t){this.invalid&&(this.clear(this),this.invalid=!1);var e=t.cache.attributes.get(this);if(!e){if(!(e=t.createBuffer()))throw console.error("createBuffer 失败！"),"";t.cache.attributes.set(this,e),t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.data),t[this.usage])}return e},e.prototype.clear=function(t){xn.glList.forEach((function(e){var n=e.cache.attributes.get(t);n&&(e.deleteBuffer(n),e.cache.attributes.delete(t))}))},e}(),Sn=function(){function t(){this._invalid=!0}return t.active=function(t,e){e._invalid&&(e._invalid=!1,this.clear(e));var n=t.cache.frameBuffers.get(e);if(!n){if(!(n=t.createFramebuffer()))return console.warn("Failed to create frame buffer object"),null;t.cache.frameBuffers.set(e,n)}return n},t.clear=function(t){xn.glList.forEach((function(e){var n=e.cache.frameBuffers.get(t);n&&(e.deleteFramebuffer(n),e.cache.frameBuffers.delete(t))}))},t}(),Pn=function(){function e(e){this.type=t.GLArrayType.UNSIGNED_INT,this.offset=0,this._invalid=!0,Object.assign(this,e)}return Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},set:function(t){this._indices=t,this.invalidate()},enumerable:!1,configurable:!0}),e.prototype.invalidate=function(){this._invalid=!0},Object.defineProperty(e.prototype,"count",{get:function(){return this.indices?this.indices.length:0},enumerable:!1,configurable:!0}),e.prototype.active=function(t){var n=e.getBuffer(t,this);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)},e.getBuffer=function(t,e){e._invalid&&(this.clear(e),e._invalid=!1);var n=t.cache.indices.get(e);if(!n){if(!(n=t.createBuffer()))throw console.error("createBuffer 失败！"),"";t.cache.indices.set(e,n),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint32Array(e.indices),t.STATIC_DRAW)}return n},e.clear=function(t){xn.glList.forEach((function(e){var n=e.cache.indices.get(t);n&&(e.deleteBuffer(n),e.cache.indices.delete(t))}))},e}();function Mn(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}t.BlendEquation=void 0,(un=t.BlendEquation||(t.BlendEquation={})).FUNC_ADD="FUNC_ADD",un.FUNC_SUBTRACT="FUNC_SUBTRACT",un.FUNC_REVERSE_SUBTRACT="FUNC_REVERSE_SUBTRACT",un.MIN_EXT="MIN_EXT",un.MAX_EXT="MAX_EXT",un.MIN="MIN",un.MAX="MAX",t.BlendFactor=void 0,(cn=t.BlendFactor||(t.BlendFactor={})).ZERO="ZERO",cn.ONE="ONE",cn.SRC_COLOR="SRC_COLOR",cn.ONE_MINUS_SRC_COLOR="ONE_MINUS_SRC_COLOR",cn.DST_COLOR="DST_COLOR",cn.ONE_MINUS_DST_COLOR="ONE_MINUS_DST_COLOR",cn.SRC_ALPHA="SRC_ALPHA",cn.ONE_MINUS_SRC_ALPHA="ONE_MINUS_SRC_ALPHA",cn.DST_ALPHA="DST_ALPHA",cn.ONE_MINUS_DST_ALPHA="ONE_MINUS_DST_ALPHA",cn.CONSTANT_COLOR="CONSTANT_COLOR",cn.ONE_MINUS_CONSTANT_COLOR="ONE_MINUS_CONSTANT_COLOR",cn.CONSTANT_ALPHA="CONSTANT_ALPHA",cn.ONE_MINUS_CONSTANT_ALPHA="ONE_MINUS_CONSTANT_ALPHA",cn.SRC_ALPHA_SATURATE="SRC_ALPHA_SATURATE",t.ColorMask=void 0,(ln=t.ColorMask||(t.ColorMask={}))[ln.NONE=0]="NONE",ln[ln.R=1]="R",ln[ln.G=2]="G",ln[ln.B=4]="B",ln[ln.A=8]="A",ln[ln.RGB=7]="RGB",ln[ln.RGBA=15]="RGBA",t.CullFace=void 0,(hn=t.CullFace||(t.CullFace={})).NONE="NONE",hn.FRONT="FRONT",hn.BACK="BACK",hn.FRONT_AND_BACK="FRONT_AND_BACK",t.DepthFunc=void 0,(pn=t.DepthFunc||(t.DepthFunc={})).NEVER="NEVER",pn.LESS="LESS",pn.EQUAL="EQUAL",pn.LEQUAL="LEQUAL",pn.GREATER="GREATER",pn.NOTEQUAL="NOTEQUAL",pn.GEQUAL="GEQUAL",pn.ALWAYS="ALWAYS",t.FrontFace=void 0,(fn=t.FrontFace||(t.FrontFace={})).CW="CW",fn.CCW="CCW",t.RenderMode=void 0,(dn=t.RenderMode||(t.RenderMode={})).POINTS="POINTS",dn.LINE_LOOP="LINE_LOOP",dn.LINE_STRIP="LINE_STRIP",dn.LINES="LINES",dn.TRIANGLES="TRIANGLES",dn.TRIANGLE_STRIP="TRIANGLE_STRIP",dn.TRIANGLE_FAN="TRIANGLE_FAN",function(t){t.NEVER="NEVER",t.LESS="LESS",t.EQUAL="EQUAL",t.LEQUAL="LEQUAL",t.GREATER="GREATER",t.NOTEQUAL="NOTEQUAL",t.GEQUAL="GEQUAL",t.ALWAYS="ALWAYS"}(mn||(mn={})),function(t){t.KEEP="KEEP",t.ZERO="ZERO",t.REPLACE="REPLACE",t.INCR="INCR",t.INCR_WRAP="INCR_WRAP",t.DECR="DECR",t.DECR_WRAP="DECR_WRAP",t.INVERT="INVERT"}(yn||(yn={}));var Cn,Tn,An,On,En,Dn,zn=function(){function e(e){this.renderMode=t.RenderMode.TRIANGLES,this.cullFace=t.CullFace.BACK,this.frontFace=t.FrontFace.CW,this.enableBlend=!1,this.blendEquation=t.BlendEquation.FUNC_ADD,this.sfactor=t.BlendFactor.SRC_ALPHA,this.dfactor=t.BlendFactor.ONE_MINUS_SRC_ALPHA,this.depthtest=!0,this.depthFunc=t.DepthFunc.LESS,this.depthMask=!0,this.colorMask=t.ColorMask.RGBA,this.useViewPort=!1,this.viewPort={x:0,y:0,width:100,height:100},this.useScissor=!1,this.scissor={x:0,y:0,width:100,height:100},this.usePolygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.useStencil=!1,this.stencilFunc=mn.ALWAYS,this.stencilFuncRef=0,this.stencilFuncMask=1,this.stencilOpFail=yn.KEEP,this.stencilOpZFail=yn.KEEP,this.stencilOpZPass=yn.KEEP,this.stencilMask=1,Object.assign(this,e)}return e.prototype.updateRenderParams=function(e){var n=this.cullFace,i=e[this.blendEquation],r=e[this.sfactor],o=e[this.dfactor],a=e[this.cullFace],s=e[this.frontFace],u=this.enableBlend,c=this.depthtest,l=this.depthMask,h=e[this.depthFunc],p=this.viewPort,f=this.useViewPort,d=this.useScissor,m=this.scissor,y=this.colorMask,v=[t.ColorMask.R,t.ColorMask.G,t.ColorMask.B,t.ColorMask.A].map((function(t){return!!(y&t)})),g=this.usePolygonOffset,_=this.polygonOffsetFactor,b=this.polygonOffsetUnits,x=this.useStencil,w=e[this.stencilFunc],S=this.stencilFuncRef,P=this.stencilFuncMask,M=e[this.stencilOpFail],C=e[this.stencilOpZFail],T=e[this.stencilOpZPass],A=this.stencilMask;f||(p={x:0,y:0,width:e.canvas.width,height:e.canvas.height}),n!==t.CullFace.NONE?(e.enable(e.CULL_FACE),e.cullFace(a),e.frontFace(s)):e.disable(e.CULL_FACE),u?(e.enable(e.BLEND),e.blendEquation(i),e.blendFunc(r,o)):e.disable(e.BLEND),c?(e.enable(e.DEPTH_TEST),e.depthFunc(h)):e.disable(e.DEPTH_TEST),e.depthMask(l),e.colorMask(v[0],v[1],v[2],v[3]),e.viewport(p.x,p.y,p.width,p.height),g?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(_,b)):e.disable(e.POLYGON_OFFSET_FILL),d?(e.enable(e.SCISSOR_TEST),e.scissor(m.x,m.y,m.width,m.height)):e.disable(e.SCISSOR_TEST),x?(0===e.capabilities.stencilBits&&console.warn(e+" 不支持 stencil，参考 https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/getContext WebGL context attributes: stencil"),e.enable(e.STENCIL_TEST),e.stencilFunc(w,S,P),e.stencilOp(M,C,T),e.stencilMask(A)):e.disable(e.STENCIL_TEST)},Mn([C,n({component:"OAVEnum",tooltip:"渲染模式，默认RenderMode.TRIANGLES",componentParam:{enumClass:t.RenderMode}})],e.prototype,"renderMode",void 0),Mn([C,n({component:"OAVEnum",tooltip:"剔除面",componentParam:{enumClass:t.CullFace}})],e.prototype,"cullFace",void 0),Mn([C,n({component:"OAVEnum",tooltip:"正面方向，默认FrontFace.CW 顺时针为正面",componentParam:{enumClass:t.FrontFace}})],e.prototype,"frontFace",void 0),Mn([C,n({tooltip:"是否开启混合"})],e.prototype,"enableBlend",void 0),Mn([C,n({component:"OAVEnum",tooltip:"混合方式，默认BlendEquation.FUNC_ADD",componentParam:{enumClass:t.BlendEquation}})],e.prototype,"blendEquation",void 0),Mn([C,n({component:"OAVEnum",tooltip:"源混合因子，默认BlendFactor.SRC_ALPHA",componentParam:{enumClass:t.BlendFactor}})],e.prototype,"sfactor",void 0),Mn([C,n({component:"OAVEnum",tooltip:"目标混合因子，默认BlendFactor.ONE_MINUS_SRC_ALPHA",componentParam:{enumClass:t.BlendFactor}})],e.prototype,"dfactor",void 0),Mn([C,n({tooltip:"是否开启深度检查"})],e.prototype,"depthtest",void 0),Mn([C,n({component:"OAVEnum",tooltip:"深度检测方法",componentParam:{enumClass:t.DepthFunc}})],e.prototype,"depthFunc",void 0),Mn([C,n({tooltip:"是否开启深度标记"})],e.prototype,"depthMask",void 0),Mn([C,n({component:"OAVEnum",tooltip:"深度检测方法",componentParam:{enumClass:t.ColorMask}})],e.prototype,"colorMask",void 0),Mn([n({tooltip:"是否使用 viewRect"}),C],e.prototype,"useViewPort",void 0),Mn([n({tooltip:"绘制在画布上的区域"}),C],e.prototype,"viewPort",void 0),Mn([n({tooltip:"https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/scissor"}),C],e.prototype,"useScissor",void 0),Mn([n({tooltip:"https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/scissor"}),C],e.prototype,"scissor",void 0),Mn([n({tooltip:"The WebGLRenderingContext.polygonOffset() method of the WebGL API specifies the scale factors and units to calculate depth values."}),C],e.prototype,"usePolygonOffset",void 0),Mn([n({tooltip:"A GLfloat which sets the scale factor for the variable depth offset for each polygon. The default value is 0."}),C],e.prototype,"polygonOffsetFactor",void 0),Mn([n({tooltip:"A GLfloat which sets the multiplier by which an implementation-specific value is multiplied with to create a constant depth offset. The default value is 0."}),C],e.prototype,"polygonOffsetUnits",void 0),Mn([n({tooltip:"Activates stencil testing and updates to the stencil buffer. See WebGLRenderingContext.stencilFunc()."}),C],e.prototype,"useStencil",void 0),Mn([n({tooltip:"A GLenum specifying the test function. The default function is gl.ALWAYS. ",component:"OAVEnum",componentParam:{enumClass:mn}}),C],e.prototype,"stencilFunc",void 0),Mn([n({tooltip:"A GLint specifying the reference value for the stencil test. This value is clamped to the range 0 to 2^n -1 where n is the number of bitplanes in the stencil buffer. The default value is 0. "}),C],e.prototype,"stencilFuncRef",void 0),Mn([n({tooltip:"A GLuint specifying a bit-wise mask that is used to AND the reference value and the stored stencil value when the test is done. The default value is all 1."}),C],e.prototype,"stencilFuncMask",void 0),Mn([n({tooltip:"A GLenum specifying the function to use when the stencil test fails. The default value is gl.KEEP.",component:"OAVEnum",componentParam:{enumClass:yn}}),C],e.prototype,"stencilOpFail",void 0),Mn([n({tooltip:"A GLenum specifying the function to use when the stencil test passes, but the depth test fails. The default value is gl.KEEP.",component:"OAVEnum",componentParam:{enumClass:yn}}),C],e.prototype,"stencilOpZFail",void 0),Mn([n({tooltip:"A GLenum specifying the function to use when both the stencil test and the depth test pass, or when the stencil test passes and there is no depth buffer or depth testing is disabled. The default value is gl.KEEP.",component:"OAVEnum",componentParam:{enumClass:yn}}),C],e.prototype,"stencilOpZPass",void 0),Mn([n({tooltip:"A GLuint specifying a bit mask to enable or disable writing of individual bits in the stencil planes. By default, the mask is all 1."}),C],e.prototype,"stencilMask",void 0),e}(),In=["if","ifdef","defined"],jn=function(){function t(){}return t.prototype.getMacroVariablesFromShaderCode=function(t,e){for(var n=this.getMacroVariablesFromCode(t),i=this.getMacroVariablesFromCode(e),r=0;r<i.length;r++){var o=i[r];-1===n.indexOf(o)&&n.push(o)}return n},t.prototype.getMacroVariablesFromCode=function(t){for(var e=[],n=t.split("\n"),i=0;i<n.length;i++){var r=n[i];if(-1!==r.indexOf("#if"))for(var o=/(\w+)/g,a=o.exec(r);a;){var s=a[1];null!==s&&isNaN(Number(s))&&-1===In.indexOf(s)&&-1===e.indexOf(s)&&e.push(s),a=o.exec(r)}}return e},t}(),Rn=new jn,Ln={shaders:{},modules:{}},Nn=function(){function t(){this._shaderCache={}}return Object.defineProperty(t.prototype,"shaderConfig",{get:function(){return this._shaderConfig=this._shaderConfig||Ln,this._shaderConfig},set:function(t){this._shaderConfig=t},enumerable:!1,configurable:!0}),t.prototype.getShader=function(t){if(this._shaderCache[t])return this._shaderCache[t];var e=Fn.shaderConfig.shaders[t],n=Fn.uninclude(e.vertex),i=Fn.uninclude(e.fragment),r=Rn.getMacroVariablesFromCode(n),o=Rn.getMacroVariablesFromCode(i);return this._shaderCache[t]={vertex:n,fragment:i,vertexMacroVariables:r,fragmentMacroVariables:o},this._shaderCache[t]},t.prototype.uninclude=function(t){for(var e=/#include<(.+)>/g,n=e.exec(t);n;){var i=this.shaderConfig.modules[n[1]];i||console.error("无法找到着色器 "+n[1]),i=this.uninclude(i),t=t.replace(n[0],i),e.lastIndex=0,n=e.exec(t)}return t},t.prototype.getShaderNames=function(){return Object.keys(this.shaderConfig.shaders)},t.prototype.clearCache=function(){this._shaderCache={}},t}(),Fn=new Nn,kn=function(){function t(t){this.shaderMacro={},Object.assign(this,t)}return t.prototype.setShader=function(t,e){this.vertex=t,this.fragment=e},t.prototype.activeShaderProgram=function(t){this.updateShaderCode();var e=this.vertex+this.fragment,n=t.cache.compileShaderResults[e];if(n)return n;try{n=t.cache.compileShaderResults[e]=this.compileShaderProgram(t,this.vertex,this.fragment)}catch(t){return console.error(this.shaderName+" 编译失败！\n"+t),null}return n},t.prototype.updateShaderCode=function(){if(this.shaderName){var t=Fn.getShader(this.shaderName),e=this.getMacroCode(t.vertexMacroVariables,this.shaderMacro);this.vertex=e+t.vertex;var n=this.getMacroCode(t.fragmentMacroVariables,this.shaderMacro);this.fragment=n+t.fragment}},t.prototype.compileShaderCode=function(t,e,n){var i=t.createShader(e);if(!i)throw"unable to create shader";if(t.shaderSource(i,n),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS)){var r=t.getShaderInfoLog(i);throw t.deleteShader(i),"Failed to compile shader: "+r}return i},t.prototype.createLinkProgram=function(t,e,n){var i=t.createProgram();if(!i)throw"创建 WebGLProgram 失败！";if(t.attachShader(i,e),t.attachShader(i,n),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){var r=t.getProgramInfoLog(i);throw t.deleteProgram(i),t.deleteShader(n),t.deleteShader(e),"Failed to link program: "+r}return i},t.prototype.compileShaderProgram=function(t,e,n){for(var i=this.compileShaderCode(t,t.VERTEX_SHADER,e),r=this.compileShaderCode(t,t.FRAGMENT_SHADER,n),o=this.createLinkProgram(t,i,r),a=t.getProgramParameter(o,t.ACTIVE_ATTRIBUTES),s={},u=0;u<a;){s[(p=t.getActiveAttrib(o,u++)).name]={name:p.name,size:p.size,type:p.type,location:t.getAttribLocation(o,p.name)}}var c=t.getProgramParameter(o,t.ACTIVE_UNIFORMS),l={};u=0;for(var h=0;u<c;){var p,f=/(\w+)/g,d=(p=t.getActiveUniform(o,u++)).name,m=[d];if(p.size>1){console.assert("[0]"===d.substr(-3,3));for(var y=d.substring(0,d.length-3),v=1;v<p.size;v++)m[v]=y+"["+v+"]"}for(v=0;v<m.length;v++){d=m[v];for(var g=f.exec(d),_=[];g;)_.push(g[1]),g=f.exec(d);l[d]={name:_[0],paths:_,size:p.size,type:p.type,location:t.getUniformLocation(o,d),textureID:h},p.type!==t.SAMPLER_2D&&p.type!==t.SAMPLER_CUBE||h++}}return{program:o,vertex:i,fragment:r,attributes:s,uniforms:l}},t.prototype.getMacroCode=function(t,e){var n="";return t.forEach((function(t){var i=e[t];"boolean"==typeof i?i&&(n+="#define "+t+"\n"):"number"==typeof i&&(n+="#define "+t+" "+i+"\n")})),n.length>0?n+"\n":n},t}(),Bn=function(){function t(t){this._attributes={},this.uniforms={},this.shaderMacro={},this._renderParams=new zn,Object.assign(this,t)}return Object.defineProperty(t.prototype,"index",{get:function(){return this._index},set:function(t){this._index=t instanceof Pn?t:new Pn(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attributes",{get:function(){return this._attributes},set:function(t){for(var e in this._attributes={},t)t[e]instanceof wn?this._attributes[e]=t[e]:this._attributes[e]=new wn(t[e])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shader",{get:function(){return this._shader},set:function(t){this._shader=t instanceof kn?t:new kn(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderParams",{get:function(){return this._renderParams},set:function(t){this._renderParams=t instanceof zn?t:new zn(t)},enumerable:!1,configurable:!0}),t.prototype.getIndexBuffer=function(){return void 0!==this.index?this.index:this.next&&this.next.getIndexBuffer()},t.prototype.getAttributes=function(t){return void 0===t&&(t={}),this.next&&this.next.getAttributes(t),Object.assign(t,this.attributes),t},t.prototype.getAttributeByKey=function(t){return void 0!==this.attributes[t]?this.attributes[t]:this.next&&this.next.getAttributeByKey(t)},t.prototype.getUniforms=function(t){return void 0===t&&(t={}),this.next&&this.next.getUniforms(t),Object.assign(t,this.uniforms),t},t.prototype.getUniformByKey=function(t){return void 0!==this.uniforms[t]?M.getvalue(this.uniforms[t]):this.next&&this.next.getUniformByKey(t)},t.prototype.getInstanceCount=function(){return void 0!==this.instanceCount?M.getvalue(this.instanceCount):this.next&&this.next.getInstanceCount()},t.prototype.getShader=function(){return void 0!==this.shader?this.shader:this.next&&this.next.getShader()},t.prototype.getRenderParams=function(t){return void 0===t&&(t=new zn),this.next&&this.next.getRenderParams(t),Object.assign(t,this.renderParams),t},t.prototype.getShaderMacro=function(t){return void 0===t&&(t={}),this.next&&this.next.getShaderMacro(t),Object.assign(t,this.shaderMacro),t},t}();t.TextureDataType=void 0,(Cn=t.TextureDataType||(t.TextureDataType={})).UNSIGNED_BYTE="UNSIGNED_BYTE",Cn.UNSIGNED_SHORT_5_6_5="UNSIGNED_SHORT_5_6_5",Cn.UNSIGNED_SHORT_4_4_4_4="UNSIGNED_SHORT_4_4_4_4",Cn.UNSIGNED_SHORT_5_5_5_1="UNSIGNED_SHORT_5_5_5_1",t.TextureFormat=void 0,(Tn=t.TextureFormat||(t.TextureFormat={})).ALPHA="ALPHA",Tn.RGB="RGB",Tn.RGBA="RGBA",Tn.LUMINANCE="LUMINANCE",Tn.LUMINANCE_ALPHA="LUMINANCE_ALPHA",t.TextureMagFilter=void 0,(An=t.TextureMagFilter||(t.TextureMagFilter={})).LINEAR="LINEAR",An.NEAREST="NEAREST",t.TextureMinFilter=void 0,(On=t.TextureMinFilter||(t.TextureMinFilter={})).LINEAR="LINEAR",On.NEAREST="NEAREST",On.NEAREST_MIPMAP_NEAREST="NEAREST_MIPMAP_NEAREST",On.LINEAR_MIPMAP_NEAREST="LINEAR_MIPMAP_NEAREST",On.NEAREST_MIPMAP_LINEAR="NEAREST_MIPMAP_LINEAR",On.LINEAR_MIPMAP_LINEAR="LINEAR_MIPMAP_LINEAR",t.TextureType=void 0,(En=t.TextureType||(t.TextureType={})).TEXTURE_2D="TEXTURE_2D",En.TEXTURE_CUBE_MAP="TEXTURE_CUBE_MAP",t.TextureWrap=void 0,(Dn=t.TextureWrap||(t.TextureWrap={})).REPEAT="REPEAT",Dn.CLAMP_TO_EDGE="CLAMP_TO_EDGE",Dn.MIRRORED_REPEAT="MIRRORED_REPEAT";var Vn,Wn=function(){function t(){this._OFFSCREEN_WIDTH=1024,this._OFFSCREEN_HEIGHT=1024,this._invalid=!0}return Object.defineProperty(t.prototype,"OFFSCREEN_WIDTH",{get:function(){return this._OFFSCREEN_WIDTH},set:function(t){this._OFFSCREEN_WIDTH=t,this.invalidate()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"OFFSCREEN_HEIGHT",{get:function(){return this._OFFSCREEN_HEIGHT},set:function(t){this._OFFSCREEN_HEIGHT=t,this.invalidate()},enumerable:!1,configurable:!0}),t.prototype.invalidate=function(){this._invalid=!0},t.active=function(t,e){e._invalid&&(this.clear(e),e._invalid=!1);var n=t.cache.renderBuffers.get(e);if(!n){if(!(n=t.createRenderbuffer()))return void console.warn("Failed to create renderbuffer object");t.cache.renderBuffers.set(e,n),t.bindRenderbuffer(t.RENDERBUFFER,n),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e.OFFSCREEN_WIDTH,e.OFFSCREEN_HEIGHT)}return n},t.clear=function(t){xn.glList.forEach((function(e){var n=e.cache.renderBuffers.get(t);n&&(e.deleteRenderbuffer(n),e.cache.renderBuffers.delete(t))}))},t}(),Un=new(function(){function t(){}return t.prototype.parallel=function(t){return function(e){if(0!==t.length){var n=0;t.forEach((function(i){var r=0;i((function(){1===++r?++n===t.length&&e():console.warn((i.name?"函数"+i.name:"匿名函数")+" 多次调用回调函数，当前次数 "+r)}))}))}else e()}},t.prototype.series=function(t){return function(e){if(0!==t.length){var n=0,i=function(){var r=t[n],o=0;r((function(){1===++o?++n<t.length?i():e&&e():console.warn((r.name?"函数"+r.name:"匿名函数")+" 多次调用回调函数，当前次数 "+o)}))};i()}else e()}},t.prototype.parallelResults=function(t,e,n){var i=new Map,r=t.map((function(t){return function(n){e(t,(function(e){i.set(t,e),n()}))}}));this.parallel(r)((function(){var e=t.map((function(t){return i.get(t)}));i.clear(),n(e)}))},t.prototype.seriesResults=function(t,e,n){var i=new Map,r=t.map((function(t){return function(n){e(t,(function(e){i.set(t,e),n()}))}}));this.series(r)((function(){var e=t.map((function(t){return i.get(t)}));i.clear(),n(e)}))},t}());t.LoaderDataFormat=void 0,(Vn=t.LoaderDataFormat||(t.LoaderDataFormat={})).BINARY="binary",Vn.TEXT="text",Vn.IMAGE="image";var Gn=function(){function e(){}return e.prototype.loadText=function(e,n,i,r){Kn({url:e,dataFormat:t.LoaderDataFormat.TEXT,onCompleted:n,onProgress:i,onError:r})},e.prototype.loadBinary=function(e,n,i,r){Kn({url:e,dataFormat:t.LoaderDataFormat.BINARY,onCompleted:n,onProgress:i,onError:r})},e.prototype.loadImage=function(t,e,n,i){var r=new Image;r.crossOrigin="Anonymous",r.onload=function(t){e&&e(r)},r.onerror=function(e){console.error("Error while trying to load texture: "+t),r.src="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z";var n=new Error(t+" 加载失败！");i&&i(n)},r.src=t},e}(),Hn=new Gn;function Kn(e){var n=new XMLHttpRequest;n.open("Get",e.url,!0),n.setRequestHeader("Access-Control-Allow-Origin","*"),n.responseType=e.dataFormat===t.LoaderDataFormat.BINARY?"arraybuffer":"",n.onreadystatechange=function(e,n){return function(i){if(4===e.readyState)if(e.onreadystatechange=null,e.status>=200&&e.status<300){var r=n.dataFormat===t.LoaderDataFormat.TEXT?e.responseText:e.response;n.onCompleted&&n.onCompleted(r)}else{var o=new Error(n.url+" 加载失败！");n.onError&&n.onError(o),n.onCompleted&&n.onCompleted(null)}}}(n,e),n.onprogress=function(t,e){return function(t){e.onProgress&&e.onProgress(t.loaded,t.total)}}(0,e),n.send()}var Xn,qn={},Yn=function(){function t(){this._dbStatus={}}return t.prototype.support=function(){return"undefined"!=typeof indexedDB},t.prototype.getDatabase=function(t,e){qn[t]?e(null,qn[t]):this._open(t,e)},t.prototype._open=function(t,e,n,i){var r=this;if(void 0===n&&(n=!1),this._dbStatus[t]||(this._dbStatus[t]={status:Xn.unOpen,onsuccessCallbacks:[],onupgradeneededCallbacks:[]}),this._dbStatus[t].onsuccessCallbacks.push(e),n&&(console.assert(!!i),this._dbStatus[t].onupgradeneededCallbacks.push(i)),this._dbStatus[t].status!==Xn.opening&&this._dbStatus[t].status!==Xn.upgrading){var o;if(n){var a=qn[t];a.close(),delete qn[t],o=indexedDB.open(t,a.version+1),this._dbStatus[t].status=Xn.upgrading}else o=indexedDB.open(t),this._dbStatus[t].status=Xn.opening;o.onupgradeneeded=function(e){var n=e.target.result;o.onupgradeneeded=null;var i=r._dbStatus[t].onupgradeneededCallbacks.concat();r._dbStatus[t].onupgradeneededCallbacks.length=0,i.forEach((function(t){t(n)}))},o.onsuccess=function(e){qn[t]=e.target.result,o.onsuccess=null,r._dbStatus[t].status=Xn.opened;var n=r._dbStatus[t].onsuccessCallbacks.concat();r._dbStatus[t].onsuccessCallbacks.length=0,n.forEach((function(e){e(null,qn[t])}))},o.onerror=function(e){o.onerror=null,r._dbStatus[t].status=Xn.error;var n=r._dbStatus[t].onsuccessCallbacks.concat();r._dbStatus[t].onsuccessCallbacks.length=0,n.forEach((function(t){t(e,null)}))}}},t.prototype.deleteDatabase=function(t,e){var n=indexedDB.deleteDatabase(t);n.onsuccess=function(i){delete qn[t],e&&e(null),n.onsuccess=null},n.onerror=function(t){e&&e(t),n.onerror=null}},t.prototype.hasObjectStore=function(t,e,n){this.getDatabase(t,(function(t,i){n(i.objectStoreNames.contains(e))}))},t.prototype.getObjectStoreNames=function(t,e){this.getDatabase(t,(function(t,n){for(var i=[],r=0;r<n.objectStoreNames.length;r++)i.push(n.objectStoreNames.item(r));e(null,i)}))},t.prototype.createObjectStore=function(t,e,n){var i=this;this.getDatabase(t,(function(r,o){o.objectStoreNames.contains(e)?n&&n(null):i._open(t,n,!0,(function(t){t.createObjectStore(e)}))}))},t.prototype.deleteObjectStore=function(t,e,n){var i=this;this.getDatabase(t,(function(r,o){o.objectStoreNames.contains(e)?i._open(t,n,!0,(function(t){t.deleteObjectStore(e)})):n&&n(null)}))},t.prototype.getAllKeys=function(t,e,n){this.getDatabase(t,(function(t,i){try{var r=i.transaction([e],"readwrite").objectStore(e).getAllKeys();r.onsuccess=function(t){n&&n(null,t.target.result),r.onsuccess=null}}catch(t){n&&n(t,null)}}))},t.prototype.objectStoreGet=function(t,e,n,i){this.getDatabase(t,(function(t,r){var o=r.transaction([e],"readwrite").objectStore(e).get(n);o.onsuccess=function(t){var e=t.target.result;i&&i(void 0!==e?null:new Error("没有找到资源 "+n),e),o.onsuccess=null}}))},t.prototype.objectStorePut=function(t,e,n,i,r){this.getDatabase(t,(function(t,o){try{var a=o.transaction([e],"readwrite").objectStore(e).put(i,n);a.onsuccess=function(t){r&&r(null),a.onsuccess=null}}catch(t){r&&r(t)}}))},t.prototype.objectStoreDelete=function(t,e,n,i){this.getDatabase(t,(function(t,r){try{var o=r.transaction([e],"readwrite").objectStore(e).delete(n);o.onsuccess=function(t){i&&i(),o.onsuccess=null}}catch(t){i&&i(t)}}))},t.prototype.objectStoreClear=function(t,e,n){this.getDatabase(t,(function(t,i){try{var r=i.transaction([e],"readwrite").objectStore(e).clear();r.onsuccess=function(t){n&&n(),r.onsuccess=null}}catch(t){n&&n(t)}}))},t}(),Zn=new Yn;!function(t){t[t.unOpen=0]="unOpen",t[t.opening=1]="opening",t[t.opened=2]="opened",t[t.upgrading=3]="upgrading",t[t.error=4]="error"}(Xn||(Xn={}));var Qn,Jn=function(){};t.FSType=void 0,(Qn=t.FSType||(t.FSType={})).http="http",Qn.native="native",Qn.indexedDB="indexedDB";var $n=function(){function e(e){if(void 0===e&&(e=""),this.rootPath="",this.type=t.FSType.http,this.rootPath=e,""===this.rootPath&&"undefined"!=typeof document){var n=document.URL.split("?").shift();this.rootPath=n.substring(0,n.lastIndexOf("/")+1)}}return e.prototype.readArrayBuffer=function(t,e){Hn.loadBinary(this.getAbsolutePath(t),(function(t){e(null,t)}),null,(function(t){e(t,null)}))},e.prototype.readString=function(t,e){Hn.loadText(this.getAbsolutePath(t),(function(t){e(null,t)}),null,(function(t){e(t,null)}))},e.prototype.readObject=function(t,e){Hn.loadText(this.getAbsolutePath(t),(function(t){var n=JSON.parse(t);e(null,n)}),null,(function(t){e(t,null)}))},e.prototype.readImage=function(t,e){var n=new Image;n.onload=function(){e(null,n)},n.onerror=function(n){e(new Error("加载图片"+t+"失败"),null)},n.src=this.getAbsolutePath(t)},e.prototype.getAbsolutePath=function(t){return this.rootPath+t},e}();Jn.basefs=new $n;var ti="!!!___directory___!!!",ei=function(){function e(t,e){void 0===t&&(t="feng3d-editor"),void 0===e&&(e="testproject"),this.DBname=t,this.projectname=e}return Object.defineProperty(e.prototype,"type",{get:function(){return t.FSType.indexedDB},enumerable:!1,configurable:!0}),e.prototype.readArrayBuffer=function(t,e){Zn.objectStoreGet(this.DBname,this.projectname,t,(function(t,n){if(t)e(t,n);else if(n instanceof ArrayBuffer)e(null,n);else if(n instanceof Object){var i=JSON.stringify(n,null,"\t").replace(/[\n\t]+([\d\.e\-\[\]]+)/g,"$1"),r=x.stringToArrayBuffer(i);e(null,r)}else{r=x.stringToArrayBuffer(n);e(null,r)}}))},e.prototype.readString=function(t,e){Zn.objectStoreGet(this.DBname,this.projectname,t,(function(t,n){if(t)e(t,n);else if(n instanceof ArrayBuffer)x.arrayBufferToString(n,(function(t){e(null,t)}));else if(n instanceof Object){var i=JSON.stringify(n,null,"\t").replace(/[\n\t]+([\d\.e\-\[\]]+)/g,"$1");e(null,i)}else e(null,n)}))},e.prototype.readObject=function(t,e){Zn.objectStoreGet(this.DBname,this.projectname,t,(function(t,n){if(t)e(t,n);else if(n instanceof ArrayBuffer)x.arrayBufferToString(n,(function(t){var n=JSON.parse(t);e(null,n)}));else if(n instanceof Object)e(null,n);else{console.assert("string"==typeof n);var i=JSON.parse(n);e(null,i)}}))},e.prototype.readImage=function(t,e){this.readArrayBuffer(t,(function(t,n){t?e(t,null):x.arrayBufferToImage(n,(function(t){e(null,t)}))}))},e.prototype.getAbsolutePath=function(t){return t},e.prototype.isDirectory=function(t,e){this.readString(t,(function(t,n){e(n===ti)}))},e.prototype.exists=function(t,e){Zn.objectStoreGet(this.DBname,this.projectname,t,(function(t,n){e(!!n)}))},e.prototype.readdir=function(t,e){Zn.getAllKeys(this.DBname,this.projectname,(function(n,i){if(i){var r={};i.forEach((function(e){var n=""===t?t:t+"/";if(e.substr(0,n.length)===n&&e!==t){var i=e.substr(n.length).split("/").shift();r[i]=1}}));var o=Object.keys(r);e(null,o)}else e(n,null)}))},e.prototype.mkdir=function(t,e){var n=this;this.exists(t,(function(i){i?e(new Error("文件夹"+t+"已存在无法新建")):Zn.objectStorePut(n.DBname,n.projectname,t,ti,e)}))},e.prototype.deleteFile=function(t,e){Zn.objectStoreDelete(this.DBname,this.projectname,t,e),Z.emit("fs.delete",t)},e.prototype.writeArrayBuffer=function(t,e,n){Zn.objectStorePut(this.DBname,this.projectname,t,e,n),Z.emit("fs.write",t)},e.prototype.writeString=function(t,e,n){Zn.objectStorePut(this.DBname,this.projectname,t,e,n),Z.emit("fs.write",t)},e.prototype.writeObject=function(t,e,n){Zn.objectStorePut(this.DBname,this.projectname,t,e,n),Z.emit("fs.write",t)},e.prototype.writeImage=function(t,e,n){var i=this;x.imageToArrayBuffer(e,(function(e){i.writeArrayBuffer(t,e,n),Z.emit("fs.write",t)}))},e.prototype.copyFile=function(t,e,n){var i=this;Zn.objectStoreGet(this.DBname,this.projectname,t,(function(t,r){t?n(t):Zn.objectStorePut(i.DBname,i.projectname,e,r,n)}))},e.prototype.hasProject=function(t,e){Zn.getObjectStoreNames(this.DBname,(function(n,i){e(!n&&-1!==i.indexOf(t))}))},e.prototype.initproject=function(t,e){this.projectname=t,Zn.createObjectStore(this.DBname,t,e)},e}(),ni=new ei,ii=function(){function t(){}return t.prototype.normalizeDir=function(t){return"/"===t[t.length-1]&&(t=t.substr(0,t.length-1)),t},t.prototype.isHttpURL=function(t){return-1!==t.indexOf("http://")||-1!==t.indexOf("https://")||-1!==t.indexOf("file:///")},t.prototype.getName=function(t){console.assert(void 0!==t);var e=this.basename(t);return this.isDirectory(t)?e:e=e.split(".").shift()},t.prototype.basename=function(t){console.assert(void 0!==t);var e=t.split("/"),n=e.pop();return""===n&&(n=e.pop()),n},t.prototype.extname=function(t){console.assert(void 0!==t);var e=this.basename(t),n=e.indexOf(".");return-1===n?"":e.substr(n)},t.prototype.dirname=function(t){console.assert(void 0!==t);var e=t.split("/");return this.isDirectory(t)&&e.pop(),e.pop(),e.join("/")},t.prototype.getChildFilePath=function(t,e){return console.assert(void 0!==t),console.assert(void 0!==e),"/"!==t.charAt(t.length-1)&&(t+="/"),t+e},t.prototype.getChildFolderPath=function(t,e){return"/"!==t.charAt(t.length-1)&&(t+="/"),"/"!==e.charAt(e.length-1)&&(e+="/"),t+e},t.prototype.isDirectory=function(t){return""===t.split("/").pop()},t.prototype.getDirDepth=function(t){var e=t.split("/").length;return this.isDirectory(t)&&e--,e-1},t}(),ri=new ii,oi=function(){function t(t){this._images={},this._state={},this.fs=t}return Object.defineProperty(t.prototype,"fs",{get:function(){return this._fs||Jn.basefs},set:function(t){this._fs=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.fs.type},enumerable:!1,configurable:!0}),t.prototype.readArrayBuffer=function(t,e){this.fs.readArrayBuffer(t,e)},t.prototype.readString=function(t,e){this.fs.readString(t,e)},t.prototype.readObject=function(t,e){this.fs.readObject(t,e)},t.prototype.readImage=function(t,e){this.fs.readImage(t,e)},t.prototype.getAbsolutePath=function(t){return this.fs.getAbsolutePath(t)},t.prototype.readStrings=function(t,e){var n=this;Un.parallelResults(t,(function(t,e){n.readString(t,(function(t,n){e(t||n)}))}),e)},t}();Jn.fs=new oi;var ai=function(t,e){return ai=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},ai(t,e)};var si=function(t){function e(e){return t.call(this,e)||this}return function(t,e){function n(){this.constructor=t}ai(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.exists=function(t,e){this.fs.exists(t,e)},e.prototype.readdir=function(t,e){this.fs.readdir(t,e)},e.prototype.mkdir=function(t,e){var n=this;t=ri.normalizeDir(t),this.fs.exists(t,(function(i){i?e&&e(null):n.fs.mkdir(t,e)}))},e.prototype.deleteFile=function(t,e){this.fs.deleteFile(t,e)},e.prototype.writeFile=function(t,e,n){var i=this,r=ri.extname(t),o={meta:"txt",json:"object",jpg:"arraybuffer",png:"arraybuffer",mp3:"arraybuffer",js:"txt",ts:"txt",map:"txt",html:"txt"}[r=r.split(".").pop()];"tsconfig.json"!==t&&".vscode/settings.json"!==t||(o="txt"),"txt"===o?x.arrayBufferToString(e,(function(e){i.fs.writeString(t,e,(function(t){n(t)}))})):"object"===o?x.arrayBufferToObject(e,(function(e){i.fs.writeObject(t,e,(function(t){n(t)}))})):"arraybuffer"===o?this.writeArrayBuffer(t,e,(function(t){n(t)})):console.error("无法导入文件 "+t)},e.prototype.writeArrayBuffer=function(t,e,n){var i=this,r=ri.dirname(t);this.mkdir(r,(function(r){r?n&&n(r):i.fs.writeArrayBuffer(t,e,n)}))},e.prototype.writeString=function(t,e,n){var i=this,r=ri.dirname(t);this.mkdir(r,(function(r){r?n&&n(r):i.fs.writeString(t,e,n)}))},e.prototype.writeObject=function(t,e,n){var i=this,r=ri.dirname(t);this.mkdir(r,(function(r){r?n&&n(r):i.fs.writeObject(t,e,n)}))},e.prototype.writeImage=function(t,e,n){var i=this,r=ri.dirname(t);this.mkdir(r,(function(r){r?n&&n(r):i.fs.writeImage(t,e,n)}))},e.prototype.copyFile=function(t,e,n){this.fs.copyFile(t,e,n)},e.prototype.isDirectory=function(t,e){this.fs.isDirectory(t,e)},e.prototype.initproject=function(t,e){this.fs.initproject(t,e)},e.prototype.hasProject=function(t,e){this.fs.hasProject(t,e)},e.prototype.getAllPathsInFolder=function(t,e){var n=this;void 0===t&&(t="");var i=[t],r=[],o="",a=function(){i.length>0?(o=i.shift(),n.readdir(o,(function(t,e){var s=function(){if(0!==e.length){var t=o+(""===o?"":"/")+e.shift();r.push(t),n.isDirectory(t,(function(e){e&&i.push(t),s()}))}else a()};s()}))):e(null,r)};a()},e.prototype.moveFile=function(t,e,n){var i=this;this.copyFile(t,e,(function(e){e?n&&n(e):i.deleteFile(t,n)}))},e.prototype.renameFile=function(t,e,n){this.moveFile(t,e,n)},e.prototype.moveFiles=function(t,e){var n=this;this.copyFiles(t.concat(),(function(i){if(i)e&&e(i);else{var r=t.reduce((function(t,e){return t.push(e[0]),t}),[]);n.deleteFiles(r,e)}}))},e.prototype.copyFiles=function(t,e){var n=this;if(t.length>0){var i=t.shift();this.copyFile(i[0],i[1],(function(i){i?e&&e(i):n.copyFiles(t,e)}))}else e&&e(null)},e.prototype.deleteFiles=function(t,e){var n=this;t.length>0?this.deleteFile(t.shift(),(function(i){i?e&&e(i):n.deleteFiles(t,e)})):e&&e(null)},e.prototype.rename=function(t,e,n){var i=this;this.isDirectory(t,(function(r){r?i.getAllPathsInFolder(t,(function(r,o){if(r)n&&n(r);else{var a=[[t,e]];o.forEach((function(n){a.push([n,n.replace(t,e)])})),i.moveFiles(a,n)}})):i.renameFile(t,e,n)}))},e.prototype.move=function(t,e,n){this.rename(t,e,n)},e.prototype.delete=function(t,e){var n=this;this.isDirectory(t,(function(i){i?n.getAllPathsInFolder(t,(function(i,r){if(i)e&&e(i);else{var o=r.concat(t);n.deleteFiles(o,e)}})):n.deleteFile(t,e)}))},e}(oi),ui=function(t,e){return ui=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},ui(t,e)};function ci(t,e){function n(){this.constructor=t}ui(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var li,hi,pi=function(t){function e(e){var n=t.call(this)||this;return n.pageX=0,n.pageY=0,n.clientX=0,n.clientY=0,n.rightmouse=!1,n.key="",n.keyCode=0,n.deltaY=0,n.listentypes=[],n.handleMouseMoveBug=!0,n.onMouseKey=function(t){if(void 0!==t.clientX&&(n.clientX=t.clientX,n.clientY=t.clientY,n.pageX=t.pageX,n.pageY=t.pageY),t instanceof MouseEvent&&(n.rightmouse=2===t.button,n.handleMouseMoveBug)){if("mousedown"===t.type&&(n.mousedownposition={x:t.clientX,y:t.clientY}),"mousemove"===t.type&&n.mousedownposition&&n.mousedownposition.x===t.clientX&&n.mousedownposition.y===t.clientY)return;"mouseup"===t.type&&(n.mousedownposition=null)}t instanceof KeyboardEvent&&(n.keyCode=t.keyCode,n.key=t.key),t instanceof WheelEvent&&(n.deltaY=t.deltaY),n.emit(t.type,t)},n.target=e,n}return ci(e,t),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){var e=this;this._target!==t&&(this._target&&this.listentypes.forEach((function(t){e._target.removeEventListener(t,e.onMouseKey)})),this._target=t,this._target&&this.listentypes.forEach((function(t){e._target.addEventListener(t,e.onMouseKey)})))},enumerable:!1,configurable:!0}),e.prototype.once=function(t,e,n,i){return this.on(t,e,n,i,!0),this},e.prototype.on=function(e,n,i,r,o){return void 0===r&&(r=0),void 0===o&&(o=!1),t.prototype.on.call(this,e,n,i,r,o),-1===this.listentypes.indexOf(e)&&(this.listentypes.push(e),this._target.addEventListener(e,this.onMouseKey)),this},e.prototype.off=function(e,n,i){var r=this;return t.prototype.off.call(this,e,n,i),e?this.has(e)||(this._target.removeEventListener(e,this.onMouseKey),this.listentypes.splice(this.listentypes.indexOf(e),1)):(this.listentypes.forEach((function(t){r._target.removeEventListener(t,r.onMouseKey)})),this.listentypes.length=0),this},e.prototype.clear=function(){this.clientX=0,this.clientY=0,this.rightmouse=!1,this.key="",this.keyCode=0,this.deltaY=0},e}(X),fi=function(t){function e(){var e=t.call(this)||this;return e._keyStateDic={},e}return ci(e,t),e.prototype.pressKey=function(t,e){e instanceof MouseEvent&&-1!==["click","mousedown","mouseup"].indexOf(e.type)&&(t=["","middle","right"][e.button]+e.type),this._keyStateDic[t]=!0,this.emit(t,e)},e.prototype.releaseKey=function(t,e){e instanceof MouseEvent&&-1!==["click","mousedown","mouseup"].indexOf(e.type)&&(t=["","middle","right"][e.button]+e.type),this._keyStateDic[t]=!1,this.emit(t,e)},e.prototype.getKeyState=function(t){return!!this._keyStateDic[t]},e}(X),di=function(){function t(t,e,n,i,r){this._shortCut=t,this._keyState=t.keyState,this._key=e,this._command=n,this._stateCommand=i,this._when=r,this._keys=this.getKeys(e),this._states=this.getStates(r),this._commands=this.getCommands(n),this._stateCommands=this.getStateCommand(i),this.init()}return t.prototype.init=function(){for(var t=0;t<this._keys.length;t++)this._keyState.on(this._keys[t].key,this.onCapture,this)},t.prototype.onCapture=function(t){var e=this.checkActivityStates(this._states);this.checkActivityKeys(this._keys)&&e&&(this.dispatchCommands(this._commands,t),this.executeStateCommands(this._stateCommands))},t.prototype.dispatchCommands=function(t,e){for(var n=0;n<t.length;n++)this._shortCut.emit(t[n],e)},t.prototype.executeStateCommands=function(t){for(var e=0;e<t.length;e++){var n=t[e];n.not?this._shortCut.deactivityState(n.state):this._shortCut.activityState(n.state)}},t.prototype.checkActivityStates=function(t){for(var e=0;e<t.length;e++)if(!this.getState(t[e]))return!1;return!0},t.prototype.getState=function(t){var e=this._shortCut.getState(t.state);return t.not&&(e=!e),e},t.prototype.checkActivityKeys=function(t){for(var e=0;e<t.length;e++)if(!this.getKeyValue(t[e]))return!1;return!0},t.prototype.getKeyValue=function(t){var e=this._keyState.getKeyState(t.key);return t.not&&(e=!e),e},t.prototype.getStates=function(t){var e=[];if(!t)return e;var n=t.trim();if(0===n.length)return e;for(var i=n.split("+"),r=0;r<i.length;r++)e.push(new yi(i[r]));return e},t.prototype.getKeys=function(t){for(var e=t.split("+"),n=[],i=0;i<e.length;i++)n.push(new mi(e[i]));return n},t.prototype.getCommands=function(t){var e=[];if(!t)return e;for(var n=(t=t.trim()).split(","),i=0;i<n.length;i++){var r=n[i].trim();r.length>0&&e.push(r)}return e},t.prototype.getStateCommand=function(t){var e=[];if(!t)return e;for(var n=(t=t.trim()).split(","),i=0;i<n.length;i++){var r=n[i].trim();r.length>0&&e.push(new vi(r))}return e},t.prototype.destroy=function(){for(var t=0;t<this._keys.length;t++)this._keyState.off(this._keys[t].key,this.onCapture,this);this._shortCut=null,this._keys=null,this._states=null},t}(),mi=function(t){"!"===(t=t.trim()).charAt(0)&&(this.not=!0,t=t.substr(1).trim()),this.key=t},yi=function(t){"!"===(t=t.trim()).charAt(0)&&(this.not=!0,t=t.substr(1).trim()),this.state=t},vi=function(t){"!"===(t=t.trim()).charAt(0)&&(this.not=!0,t=t.substr(1).trim()),this.state=t},gi={17:"ctrl",16:"shift",32:"escape",18:"alt",46:"del"},_i=function(){function t(){}return t.getKey=function(t){var e=gi[t];return null==e&&t>=65&&t<=90&&(e=String.fromCharCode(t).toLocaleLowerCase()),e},t.getCode=function(t){var e=(t=t.toLocaleLowerCase()).charCodeAt(0);if(1===t.length&&e>=65&&e<=90)return e;for(var n in gi)if(gi[n]===t)return Number(n);return console.error("无法获取按键 "+t+" 的值！"),e},t}(),bi=new pi(self),xi=function(){function t(t){if(this._mouseKeyDic={},this.shortcut=t,this._keyState=t.keyState,bi){bi.on("keydown",this.onKeydown,this),bi.on("keyup",this.onKeyup,this);for(var e=["dblclick","click","mousedown","mouseup","mousemove","mouseover","mouseout"],n=0;n<e.length;n++)bi.on(e[n],this.onMouseOnce,this);bi.on("wheel",this.onMousewheel,this)}}return t.prototype.onMouseOnce=function(t){if(this.shortcut.enable){var e=t.type;this._keyState.pressKey(e,t.data),this._keyState.releaseKey(e,t.data)}},t.prototype.onMousewheel=function(t){if(this.shortcut.enable){var e=t.type;this._keyState.pressKey(e,t.data),this._keyState.releaseKey(e,t.data)}},t.prototype.onKeydown=function(t){if(this.shortcut.enable){var e=_i.getKey(t.data.keyCode);(e=e||t.data.key)?(e=e.toLocaleLowerCase(),this._keyState.pressKey(e,t.data)):console.error("无法识别按钮 "+t.data.key)}},t.prototype.onKeyup=function(t){if(this.shortcut.enable){var e=_i.getKey(t.data.keyCode);(e=e||t.data.key)?(e=e.toLocaleLowerCase(),this._keyState.releaseKey(e,t.data)):console.error("无法识别按钮 "+t.data.key)}},t}(),wi=function(t){function e(){var e=t.call(this)||this;return e.enable=!0,e.keyState=new fi,e.keyCapture=new xi(e),e.captureDic={},e.stateDic={},e}return ci(e,t),e.prototype.addShortCuts=function(t){for(var e=0;e<t.length;e++){var n=t[e],i=this.getShortcutUniqueKey(n);this.captureDic[i]=this.captureDic[i]||new di(this,n.key,n.command,n.stateCommand,n.when)}},e.prototype.removeShortCuts=function(t){for(var e=0;e<t.length;e++){var n=this.getShortcutUniqueKey(t[e]),i=this.captureDic[n];null!==di&&i.destroy(),delete this.captureDic[n]}},e.prototype.removeAllShortCuts=function(){var t,e=this,n=[];for(t in this.captureDic)n.push(t);n.forEach((function(t){e.captureDic[t].destroy(),delete e.captureDic[t]}))},e.prototype.activityState=function(t){this.stateDic[t]=!0},e.prototype.deactivityState=function(t){delete this.stateDic[t]},e.prototype.getState=function(t){return!!this.stateDic[t]},e.prototype.getShortcutUniqueKey=function(t){return t.key+","+t.command+","+t.stateCommand+","+t.when},e}(X),Si=new wi,Pi=function(t,e){return Pi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},Pi(t,e)};function Mi(t,e){function n(){this.constructor=t}Pi(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function Ci(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}t.RunEnvironment=void 0,(li=t.RunEnvironment||(t.RunEnvironment={}))[li.feng3d=1]="feng3d",li[li.editor=2]="editor",li[li.all=255]="all",t.HideFlags=void 0,(hi=t.HideFlags||(t.HideFlags={}))[hi.None=0]="None",hi[hi.HideInHierarchy=1]="HideInHierarchy",hi[hi.HideInInspector=2]="HideInInspector",hi[hi.DontSaveInEditor=4]="DontSaveInEditor",hi[hi.NotEditable=8]="NotEditable",hi[hi.DontSaveInBuild=16]="DontSaveInBuild",hi[hi.DontUnloadUnusedAsset=32]="DontUnloadUnusedAsset",hi[hi.DontTransform=64]="DontTransform",hi[hi.Hide=3]="Hide",hi[hi.DontSave=20]="DontSave",hi[hi.HideAndDontSave=61]="HideAndDontSave";var Ti=function(e){function n(){var i=e.call(this)||this;return i.hideFlags=t.HideFlags.None,i._disposed=!1,Object.defineProperty(i,"uuid",{value:P.uuid()}),Object.defineProperty(i,"disposed",{value:!1,configurable:!0}),console.assert(!n.objectLib[i.uuid],"唯一标识符存在重复！？"),n.objectLib[i.uuid]=i,i}return Mi(n,e),Object.defineProperty(n.prototype,"disposed",{get:function(){return this._disposed},enumerable:!1,configurable:!0}),n.prototype.dispose=function(){Object.defineProperty(this,"disposed",{value:!0,configurable:!1})},n.getObject=function(t){return this.objectLib[t]},n.getObjects=function(t){var e=this,n=Object.keys(this.objectLib).map((function(t){return e.objectLib[t]})),i=n;return t&&(i=n.filter((function(e){return e instanceof t}))),i},Ci([C],n.prototype,"hideFlags",void 0),n}(X);Object.defineProperty(Ti,"objectLib",{value:{}}),E.serializeHandlers.push({priority:0,handler:function(e,n,i){var r=n[i];return!!(r instanceof Ti&&r.hideFlags&t.HideFlags.DontSave)}});function Ai(t){return function(e){var n=t=t||{};n.name=n.name||t.name||e.name,n.type=e,n.dependencies=n.dependencies||[],e.prototype.__component__=n,Ei._componentMap[n.name]?console.warn("重复定义组件"+n.name+"，"+Ei._componentMap[n.name]+" "+e+" ！"):Ei._componentMap[n.name]=e}}function Oi(t){return Ei._componentMap[t]}var Ei=function(t){function e(){var e=t.call(this)||this;return e.onAny(e._onAnyListener,e),e}return Mi(e,t),Object.defineProperty(e.prototype,"gameObject",{get:function(){return this._gameObject},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tag",{get:function(){return this._gameObject.tag},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transform",{get:function(){return this._gameObject&&this._gameObject.transform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"single",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.init=function(){},e.prototype.addComponent=function(t){return this._gameObject.addComponent(t)},e.prototype.getComponent=function(t){return this._gameObject.getComponent(t)},e.prototype.getComponentInChildren=function(t,e){return void 0===e&&(e=!1),this._gameObject.getComponentInChildren(t,e)},e.prototype.getComponentInParent=function(t,e){return void 0===e&&(e=!1),this._gameObject.getComponentInParent(t,e)},e.prototype.getComponents=function(t,e){return void 0===e&&(e=[]),this._gameObject.getComponents(t,e)},e.prototype.getComponentsInChildren=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=[]),this._gameObject.getComponentsInChildren(t,e,n)},e.prototype.getComponentsInParent=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=[]),this._gameObject.getComponentsInParent(t,e,n)},e.prototype.getShareTargets=function(){return[this._gameObject]},e.prototype.dispose=function(){this._gameObject=null,this._disposed=!0},e.prototype.beforeRender=function(t,e,n){},e.prototype._onAnyListener=function(t){this._gameObject&&this._gameObject.emitEvent(t)},e.prototype.setGameObject=function(t){this._gameObject=t},e.getDependencies=function(t){for(var e,n=t.prototype,i=[];n;)i=i.concat((null===(e=n.__component__)||void 0===e?void 0:e.dependencies)||[]),n=n.__proto__;return i},e.isSingleComponent=function(t){for(var e,n=t.prototype,i=!1;n&&!i;)i=!!(null===(e=n.__component__)||void 0===e?void 0:e.single),n=n.__proto__;return i},e._componentMap={},e}(Ti),Di=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.enabled=!0,n.runEnvironment=t.RunEnvironment.all,n}return Mi(i,e),Object.defineProperty(i.prototype,"isVisibleAndEnabled",{get:function(){return this.enabled&&this.gameObject&&this.gameObject.activeSelf},enumerable:!1,configurable:!0}),i.prototype.update=function(t){},i.prototype.dispose=function(){this.enabled=!1,e.prototype.dispose.call(this)},Ci([n(),C],i.prototype,"enabled",void 0),i=Ci([Ai()],i)}(Ei);function zi(t,e){return void 0===e&&(e=0),function(n){ji.component||(ji.component=[]),ji.component.push({path:t,order:e,type:n.name}),ji.component.sort((function(t,e){return t.path<e.path?-1:1})),ji.component.sort((function(t,e){return t.order-e.order}))}}var Ii,ji={};t.AssetType=void 0,(Ii=t.AssetType||(t.AssetType={})).folder="folder",Ii.audio="audio",Ii.ts="ts",Ii.js="js",Ii.txt="txt",Ii.json="json",Ii.mtl="mtl",Ii.obj="obj",Ii.md5mesh="md5mesh",Ii.md5anim="md5anim",Ii.mdl="mdl",Ii.texture="texture",Ii.texturecube="texturecube",Ii.material="material",Ii.geometry="geometry",Ii.gameobject="gameobject",Ii.scene="scene",Ii.anim="anim",Ii.shader="shader",Ii.script="script";var Ri,Li=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.assetType=t.AssetType.anim,n.loop=!0,n}return Mi(i,e),Ci([n(),C],i.prototype,"name",void 0),Ci([C],i.prototype,"length",void 0),Ci([n(),C],i.prototype,"loop",void 0),Ci([C],i.prototype,"propertyClips",void 0),i}(Ti),Ni=function(){function t(){this._cacheValues={}}return t.prototype.getValue=function(t,e){var n=this,i=Math.round(e*t/1e3);if(void 0!==this._cacheValues[i])return this._cacheValues[i];this._propertyValues=this._propertyValues||this.propertyValues.map((function(t){return[t[0],n.getpropertyValue(t[1])]}));var r=this._propertyValues,o=r[0][1];if(t<=r[0][0]);else if(t>=r[r.length-1][0])o=r[r.length-1][1];else for(var a=0;a<r.length-1;a++)if(r[a][0]<=t&&t<r[a+1][0]){o=this.interpolation(r[a][1],r[a+1][1],(t-r[a][0])/(r[a+1][0]-r[a][0]));break}return this._cacheValues[i]=o,o},t.prototype.interpolation=function(t,e,n){var i;return t instanceof jt?(i=t.clone()).lerp(t,e,n):i=t instanceof ht?new ht(t.x*(1-n)+e.x*n,t.y*(1-n)+e.y*n,t.z*(1-n)+e.z*n):t*(1-n)+e*n,i},t.prototype.getpropertyValue=function(t){return"Number"===this.type?t[0]:"Vector3"===this.type?ht.fromArray(t):"Quaternion"===this.type?jt.fromArray(t):(console.error("未处理 动画数据类型 "+this.type),void console.error(""))},Ci([C],t.prototype,"path",void 0),Ci([C],t.prototype,"propertyName",void 0),Ci([C],t.prototype,"type",void 0),Ci([C],t.prototype,"propertyValues",void 0),t}();t.PropertyClipPathItemType=void 0,(Ri=t.PropertyClipPathItemType||(t.PropertyClipPathItemType={}))[Ri.GameObject=0]="GameObject",Ri[Ri.Component=1]="Component";var Fi=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.animations=[],t.time=0,t.isplaying=!1,t.playspeed=1,t.num=0,t._fps=24,t._objectCache=new Map,t}return Mi(i,e),Object.defineProperty(i.prototype,"clipName",{get:function(){return this.animation?this.animation.name:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"frame",{get:function(){if(!this.animation)return-1;var t=this.animation.length,e=(this.time%t+t)%t;return Math.round(this._fps*e/1e3)},enumerable:!1,configurable:!0}),i.prototype.update=function(t){this.isplaying&&(this.time+=t*this.playspeed)},i.prototype.dispose=function(){this.animation=null,this.animations=null,e.prototype.dispose.call(this)},i.prototype._updateAni=function(){if(this.animation&&this.num++%2==0)for(var t=this.animation.length,e=(this.time%t+t)%t,n=this.animation.propertyClips,i=0;i<n.length;i++){var r=n[i];if(0!==r.propertyValues.length){var o=this.getPropertyHost(r);o&&(o[r.propertyName]=r.getValue(e,this._fps))}}},i.prototype.getPropertyHost=function(e){if(e.cacheIndex&&this._objectCache[e.cacheIndex])return this._objectCache[e.cacheIndex];e.cacheIndex||(e.cacheIndex=ki++);for(var n=this.gameObject,i=e.path,r=0;r<i.length;r++){var o=i[r];switch(o[0]){case t.PropertyClipPathItemType.GameObject:n=n.find(o[1]);break;case t.PropertyClipPathItemType.Component:var a=Oi(o[1]);n=n.getComponent(a);break;default:console.error("无法获取 PropertyHost "+o)}if(!n)return null}return this._objectCache[e.cacheIndex]=n,n},i.prototype._onAnimationChanged=function(){this.time=0},i.prototype._onTimeChanged=function(){this._updateAni()},Ci([n({component:"OAVDefault",componentParam:{dragparam:{accepttype:"animationclip",datatype:"animationclip"}}}),C,N("_onAnimationChanged")],i.prototype,"animation",void 0),Ci([n({component:"OAVArray",componentParam:{dragparam:{accepttype:"animationclip",datatype:"animationclip"},defaultItem:function(){return new Li}}}),C],i.prototype,"animations",void 0),Ci([n(),N("_onTimeChanged")],i.prototype,"time",void 0),Ci([n(),C],i.prototype,"isplaying",void 0),Ci([n(),C],i.prototype,"playspeed",void 0),i=Ci([zi("Animator/Animation"),Ai()],i)}(Di),ki=1,Bi=function(){function t(){this.parentIndex=-1,this.children=[]}return Object.defineProperty(t.prototype,"invertMatrix",{get:function(){return this._invertMatrix||(this._invertMatrix=this.matrix.clone().invert()),this._invertMatrix},enumerable:!1,configurable:!0}),Ci([C],t.prototype,"parentIndex",void 0),Ci([C],t.prototype,"name",void 0),Ci([C],t.prototype,"matrix",void 0),t}(),Vi=[],Wi=function(){function t(t){this._selfLocalBounds=new Dt,this._selfWorldBounds=new Dt,this._worldBounds=new Dt,this._selfBoundsInvalid=!0,this._selfWorldBoundsInvalid=!0,this._worldBoundsInvalid=!0,this._gameObject=t,t.on("selfBoundsChanged",this._invalidateSelfLocalBounds,this),t.on("scenetransformChanged",this._invalidateSelfWorldBounds,this)}return Object.defineProperty(t.prototype,"selfLocalBounds",{get:function(){return this._selfBoundsInvalid&&(this._updateSelfBounds(),this._selfBoundsInvalid=!1),this._selfLocalBounds},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selfWorldBounds",{get:function(){return this._selfWorldBoundsInvalid&&(this._updateSelfWorldBounds(),this._selfWorldBoundsInvalid=!1),this._selfWorldBounds},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldBounds",{get:function(){return this._worldBoundsInvalid&&(this._updateWorldBounds(),this._worldBoundsInvalid=!1),this._worldBounds},enumerable:!1,configurable:!0}),t.prototype._updateSelfBounds=function(){var t=this._selfLocalBounds.empty(),e={bounds:[]};this._gameObject.emit("getSelfBounds",e),e.bounds.forEach((function(e){t.union(e)})),t.isEmpty()&&t.fromPoints([new ht])},t.prototype._updateSelfWorldBounds=function(){this._selfWorldBounds.copy(this.selfLocalBounds).applyMatrix(this._gameObject.transform.localToWorldMatrix)},t.prototype._updateWorldBounds=function(){var t=this;this._worldBounds.copy(this.selfWorldBounds),this._gameObject.children.forEach((function(e){t._worldBounds.union(e.boundingBox.worldBounds)}))},t.prototype._invalidateSelfLocalBounds=function(){this._selfBoundsInvalid||(this._selfBoundsInvalid=!0,this._invalidateSelfWorldBounds())},t.prototype._invalidateSelfWorldBounds=function(){this._selfWorldBoundsInvalid||(this._selfWorldBoundsInvalid=!0,this._invalidateWorldBounds())},t.prototype._invalidateWorldBounds=function(){if(!this._worldBoundsInvalid){this._worldBoundsInvalid=!0;var t=this._gameObject.parent;t&&t.boundingBox._invalidateWorldBounds()}},t}(),Ui=46,Gi=58,Hi=47,Ki=92,Xi={platform:"win32",env:{},cwd:function(){return""}},qi=function(t){function e(e,n,i){var r,o;if(Zi("string"==typeof e,"'name' must be a string"),"string"==typeof n&&n.startsWith("not ")?(r="must not be",n=n.replace(/^not /,"")):r="must be",e.endsWith(" argument"))o="The "+e+" "+r+" "+Yi(n,"type");else{var a=e.includes(".")?"property":"argument";o='The "'+e+'" '+a+" "+r+" "+Yi(n,"type")}return o+=". Received type "+typeof i,t.call(this,o)||this}return Mi(e,t),e}(TypeError);function Yi(t,e){if(Zi("string"==typeof e,"`thing` has to be of type string"),Array.isArray(t)){var n=t.length;return Zi(n>0,"At least one expected value needs to be specified"),t=t.map((function(t){return String(t)})),n>2?"one of "+e+" "+t.slice(0,n-1).join(", ")+", or "+t[n-1]:2===n?"one of "+e+" "+t[0]+" or "+t[1]:"of "+e+" "+t[0]}return"of "+e+" "+String(t)}function Zi(t,e){if(!t)throw e}function Qi(t,e){if("string"!=typeof t)throw new qi(e,"string",t)}function Ji(t){return t===Hi||t===Ki}function $i(t){return t===Hi}function tr(t){return t>=65&&t<=90||t>=97&&t<=122}function er(t,e,n,i){for(var r="",o=0,a=-1,s=0,u=-1,c=0;c<=t.length;++c){if(c<t.length)u=t.charCodeAt(c);else{if(i(u))break;u=Hi}if(i(u)){if(a===c-1||1===s);else if(a!==c-1&&2===s){if(r.length<2||2!==o||r.charCodeAt(r.length-1)!==Ui||r.charCodeAt(r.length-2)!==Ui){if(r.length>2){var l=r.lastIndexOf(n);-1===l?(r="",o=0):o=(r=r.slice(0,l)).length-1-r.lastIndexOf(n),a=c,s=0;continue}if(2===r.length||1===r.length){r="",o=0,a=c,s=0;continue}}e&&(r.length>0?r+=n+"..":r="..",o=2)}else r.length>0?r+=n+t.slice(a+1,c):r=t.slice(a+1,c),o=c-a-1;a=c,s=0}else u===Ui&&-1!==s?++s:s=-1}return r}function nr(t,e){var n=e.dir||e.root,i=e.base||(e.name||"")+(e.ext||"");return n?n===e.root?n+i:n+t+i:i}var ir=function(){function t(){this.sep="\\",this.delimiter=";",this.win32=null,this.posix=null}return t.prototype.resolve=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];for(var i="",r="",o=!1,a=arguments.length-1;a>=-1;a--){var s=void 0;if(a>=0?s=t[a]:i?void 0!==(s=Xi.env["="+i]||Xi.cwd())&&s.slice(0,3).toLowerCase()===i.toLowerCase()+"\\"||(s=i+"\\"):s=Xi.cwd(),Qi(s,"path"),0!==s.length){var u=s.length,c=0,l="",h=!1,p=s.charCodeAt(0);if(u>1)if(Ji(p))if(h=!0,Ji(s.charCodeAt(1))){for(var f=2,d=f;f<u&&!Ji(s.charCodeAt(f));++f);if(f<u&&f!==d){var m=s.slice(d,f);for(d=f;f<u&&Ji(s.charCodeAt(f));++f);if(f<u&&f!==d){for(d=f;f<u&&!Ji(s.charCodeAt(f));++f);f===u?(l="\\\\"+m+"\\"+s.slice(d),c=f):f!==d&&(l="\\\\"+m+"\\"+s.slice(d,f),c=f)}}}else c=1;else tr(p)&&s.charCodeAt(1)===Gi&&(l=s.slice(0,2),c=2,u>2&&Ji(s.charCodeAt(2))&&(h=!0,c=3));else Ji(p)&&(c=1,h=!0);if(!(l.length>0&&i.length>0&&l.toLowerCase()!==i.toLowerCase())&&(0===i.length&&l.length>0&&(i=l),o||(r=s.slice(c)+"\\"+r,o=h),i.length>0&&o))break}}return i+(o?"\\":"")+(r=er(r,!o,"\\",Ji))||"."},t.prototype.normalize=function(t){Qi(t,"path");var e=t.length;if(0===e)return".";var n,i,r=0,o=!1,a=t.charCodeAt(0);if(e>1)if(Ji(a))if(o=!0,Ji(t.charCodeAt(1))){for(var s=2,u=s;s<e&&!Ji(t.charCodeAt(s));++s);if(s<e&&s!==u){var c=t.slice(u,s);for(u=s;s<e&&Ji(t.charCodeAt(s));++s);if(s<e&&s!==u){for(u=s;s<e&&!Ji(t.charCodeAt(s));++s);if(s===e)return"\\\\"+c+"\\"+t.slice(u)+"\\";s!==u&&(n="\\\\"+c+"\\"+t.slice(u,s),r=s)}}}else r=1;else tr(a)&&t.charCodeAt(1)===Gi&&(n=t.slice(0,2),r=2,e>2&&Ji(t.charCodeAt(2))&&(o=!0,r=3));else if(Ji(a))return"\\";return 0!==(i=r<e?er(t.slice(r),!o,"\\",Ji):"").length||o||(i="."),i.length>0&&Ji(t.charCodeAt(e-1))&&(i+="\\"),void 0===n?o?i.length>0?"\\"+i:"\\":i.length>0?i:"":o?i.length>0?n+"\\"+i:n+"\\":i.length>0?n+i:n},t.prototype.isAbsolute=function(t){Qi(t,"path");var e=t.length;if(0===e)return!1;var n=t.charCodeAt(0);return!!Ji(n)||!!(tr(n)&&e>2&&t.charCodeAt(1)===Gi&&Ji(t.charCodeAt(2)))},t.prototype.join=function(){var t,e,n=arguments;if(0===arguments.length)return".";for(var i=0;i<arguments.length;++i){var r=n[i];Qi(r,"path"),r.length>0&&(void 0===t?t=e=r:t+="\\"+r)}if(void 0===t)return".";var o=!0,a=0;if(Ji(e.charCodeAt(0))){++a;var s=e.length;s>1&&Ji(e.charCodeAt(1))&&(++a,s>2&&(Ji(e.charCodeAt(2))?++a:o=!1))}if(o){for(;a<t.length&&Ji(t.charCodeAt(a));++a);a>=2&&(t="\\"+t.slice(a))}return or.normalize(t)},t.prototype.relative=function(t,e){if(Qi(t,"from"),Qi(e,"to"),t===e)return"";var n=or.resolve(t),i=or.resolve(e);if(n===i)return"";if((t=n.toLowerCase())===(e=i.toLowerCase()))return"";for(var r=0;r<t.length&&t.charCodeAt(r)===Ki;++r);for(var o=t.length;o-1>r&&t.charCodeAt(o-1)===Ki;--o);for(var a=o-r,s=0;s<e.length&&e.charCodeAt(s)===Ki;++s);for(var u=e.length;u-1>s&&e.charCodeAt(u-1)===Ki;--u);for(var c=u-s,l=a<c?a:c,h=-1,p=0;p<=l;++p){if(p===l){if(c>l){if(e.charCodeAt(s+p)===Ki)return i.slice(s+p+1);if(2===p)return i.slice(s+p)}a>l&&(t.charCodeAt(r+p)===Ki?h=p:2===p&&(h=3));break}var f=t.charCodeAt(r+p);if(f!==e.charCodeAt(s+p))break;f===Ki&&(h=p)}if(p!==l&&-1===h)return i;var d="";for(-1===h&&(h=0),p=r+h+1;p<=o;++p)p!==o&&t.charCodeAt(p)!==Ki||(0===d.length?d+="..":d+="\\..");return d.length>0?d+i.slice(s+h,u):(s+=h,i.charCodeAt(s)===Ki&&++s,i.slice(s,u))},t.prototype.toNamespacedPath=function(t){if("string"!=typeof t)return t;if(0===t.length)return"";var e=or.resolve(t);if(e.length>=3)if(e.charCodeAt(0)===Ki){if(e.charCodeAt(1)===Ki){var n=e.charCodeAt(2);if(63!==n&&n!==Ui)return"\\\\?\\UNC\\"+e.slice(2)}}else if(tr(e.charCodeAt(0))&&e.charCodeAt(1)===Gi&&e.charCodeAt(2)===Ki)return"\\\\?\\"+e;return t},t.prototype.dirname=function(t){Qi(t,"path");var e=t.length;if(0===e)return".";var n=-1,i=-1,r=!0,o=0,a=t.charCodeAt(0);if(e>1)if(Ji(a)){if(n=o=1,Ji(t.charCodeAt(1))){for(var s=2,u=s;s<e&&!Ji(t.charCodeAt(s));++s);if(s<e&&s!==u){for(u=s;s<e&&Ji(t.charCodeAt(s));++s);if(s<e&&s!==u){for(u=s;s<e&&!Ji(t.charCodeAt(s));++s);if(s===e)return t;s!==u&&(n=o=s+1)}}}}else tr(a)&&t.charCodeAt(1)===Gi&&(n=o=2,e>2&&Ji(t.charCodeAt(2))&&(n=o=3));else if(Ji(a))return t;for(var c=e-1;c>=o;--c)if(Ji(t.charCodeAt(c))){if(!r){i=c;break}}else r=!1;if(-1===i){if(-1===n)return".";i=n}return t.slice(0,i)},t.prototype.basename=function(t,e){void 0!==e&&Qi(e,"ext"),Qi(t,"path");var n,i=0,r=-1,o=!0;t.length>=2&&(tr(t.charCodeAt(0))&&t.charCodeAt(1)===Gi&&(i=2));if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";var a=e.length-1,s=-1;for(n=t.length-1;n>=i;--n){var u=t.charCodeAt(n);if(Ji(u)){if(!o){i=n+1;break}}else-1===s&&(o=!1,s=n+1),a>=0&&(u===e.charCodeAt(a)?-1==--a&&(r=n):(a=-1,r=s))}return i===r?r=s:-1===r&&(r=t.length),t.slice(i,r)}for(n=t.length-1;n>=i;--n)if(Ji(t.charCodeAt(n))){if(!o){i=n+1;break}}else-1===r&&(o=!1,r=n+1);return-1===r?"":t.slice(i,r)},t.prototype.extname=function(t){Qi(t,"path");var e=0,n=-1,i=0,r=-1,o=!0,a=0;t.length>=2&&t.charCodeAt(1)===Gi&&tr(t.charCodeAt(0))&&(e=i=2);for(var s=t.length-1;s>=e;--s){var u=t.charCodeAt(s);if(Ji(u)){if(!o){i=s+1;break}}else-1===r&&(o=!1,r=s+1),u===Ui?-1===n?n=s:1!==a&&(a=1):-1!==n&&(a=-1)}return-1===n||-1===r||0===a||1===a&&n===r-1&&n===i+1?"":t.slice(n,r)},t.prototype.format=function(t){if(null===t||"object"!=typeof t)throw new qi("pathObject","Object",t);return nr("\\",t)},t.prototype.parse=function(t){Qi(t,"path");var e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;var n=t.length,i=0,r=t.charCodeAt(0);if(n>1){if(Ji(r)){if(i=1,Ji(t.charCodeAt(1))){for(var o=2,a=o;o<n&&!Ji(t.charCodeAt(o));++o);if(o<n&&o!==a){for(a=o;o<n&&Ji(t.charCodeAt(o));++o);if(o<n&&o!==a){for(a=o;o<n&&!Ji(t.charCodeAt(o));++o);o===n?i=o:o!==a&&(i=o+1)}}}}else if(tr(r)&&t.charCodeAt(1)===Gi){if(i=2,!(n>2))return e.root=e.dir=t,e;if(Ji(t.charCodeAt(2))){if(3===n)return e.root=e.dir=t,e;i=3}}}else if(Ji(r))return e.root=e.dir=t,e;i>0&&(e.root=t.slice(0,i));for(var s=-1,u=i,c=-1,l=!0,h=t.length-1,p=0;h>=i;--h)if(Ji(r=t.charCodeAt(h))){if(!l){u=h+1;break}}else-1===c&&(l=!1,c=h+1),r===Ui?-1===s?s=h:1!==p&&(p=1):-1!==s&&(p=-1);return-1===s||-1===c||0===p||1===p&&s===c-1&&s===u+1?-1!==c&&(e.base=e.name=t.slice(u,c)):(e.name=t.slice(u,s),e.base=t.slice(u,c),e.ext=t.slice(s,c)),e.dir=u>0&&u!==i?t.slice(0,u-1):e.root,e},t}(),rr=function(){function t(){this.sep="/",this.delimiter=":",this.win32=null,this.posix=null}return t.prototype.resolve=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];for(var i="",r=!1,o=arguments.length-1;o>=-1&&!r;o--){var a=void 0;Qi(a=o>=0?t[o]:Xi.cwd(),"path"),0!==a.length&&(i=a+"/"+i,r=a.charCodeAt(0)===Hi)}return i=er(i,!r,"/",$i),r?i.length>0?"/"+i:"/":i.length>0?i:"."},t.prototype.normalize=function(t){if(Qi(t,"path"),0===t.length)return".";var e=t.charCodeAt(0)===Hi,n=t.charCodeAt(t.length-1)===Hi;return 0!==(t=er(t,!e,"/",$i)).length||e||(t="."),t.length>0&&n&&(t+="/"),e?"/"+t:t},t.prototype.isAbsolute=function(t){return Qi(t,"path"),t.length>0&&t.charCodeAt(0)===Hi},t.prototype.join=function(){var t,e=arguments;if(0===arguments.length)return".";for(var n=0;n<arguments.length;++n){var i=e[n];Qi(i,"path"),i.length>0&&(void 0===t?t=i:t+="/"+i)}return void 0===t?".":ar.normalize(t)},t.prototype.relative=function(t,e){if(Qi(t,"from"),Qi(e,"to"),t===e)return"";if((t=ar.resolve(t))===(e=ar.resolve(e)))return"";for(var n=1;n<t.length&&t.charCodeAt(n)===Hi;++n);for(var i=t.length,r=i-n,o=1;o<e.length&&e.charCodeAt(o)===Hi;++o);for(var a=e.length-o,s=r<a?r:a,u=-1,c=0;c<=s;++c){if(c===s){if(a>s){if(e.charCodeAt(o+c)===Hi)return e.slice(o+c+1);if(0===c)return e.slice(o+c)}else r>s&&(t.charCodeAt(n+c)===Hi?u=c:0===c&&(u=0));break}var l=t.charCodeAt(n+c);if(l!==e.charCodeAt(o+c))break;l===Hi&&(u=c)}var h="";for(c=n+u+1;c<=i;++c)c!==i&&t.charCodeAt(c)!==Hi||(0===h.length?h+="..":h+="/..");return h.length>0?h+e.slice(o+u):(o+=u,e.charCodeAt(o)===Hi&&++o,e.slice(o))},t.prototype.toNamespacedPath=function(t){return t},t.prototype.dirname=function(t){if(Qi(t,"path"),0===t.length)return".";for(var e=t.charCodeAt(0)===Hi,n=-1,i=!0,r=t.length-1;r>=1;--r)if(t.charCodeAt(r)===Hi){if(!i){n=r;break}}else i=!1;return-1===n?e?"/":".":e&&1===n?"//":t.slice(0,n)},t.prototype.basename=function(t,e){void 0!==e&&Qi(e,"ext"),Qi(t,"path");var n,i=0,r=-1,o=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";var a=e.length-1,s=-1;for(n=t.length-1;n>=0;--n){var u=t.charCodeAt(n);if(u===Hi){if(!o){i=n+1;break}}else-1===s&&(o=!1,s=n+1),a>=0&&(u===e.charCodeAt(a)?-1==--a&&(r=n):(a=-1,r=s))}return i===r?r=s:-1===r&&(r=t.length),t.slice(i,r)}for(n=t.length-1;n>=0;--n)if(t.charCodeAt(n)===Hi){if(!o){i=n+1;break}}else-1===r&&(o=!1,r=n+1);return-1===r?"":t.slice(i,r)},t.prototype.extname=function(t){Qi(t,"path");for(var e=-1,n=0,i=-1,r=!0,o=0,a=t.length-1;a>=0;--a){var s=t.charCodeAt(a);if(s!==Hi)-1===i&&(r=!1,i=a+1),s===Ui?-1===e?e=a:1!==o&&(o=1):-1!==e&&(o=-1);else if(!r){n=a+1;break}}return-1===e||-1===i||0===o||1===o&&e===i-1&&e===n+1?"":t.slice(e,i)},t.prototype.format=function(t){if(null===t||"object"!=typeof t)throw new qi("pathObject","Object",t);return nr("/",t)},t.prototype.parse=function(t){Qi(t,"path");var e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;var n,i=t.charCodeAt(0)===Hi;i?(e.root="/",n=1):n=0;for(var r=-1,o=0,a=-1,s=!0,u=t.length-1,c=0;u>=n;--u){var l=t.charCodeAt(u);if(l!==Hi)-1===a&&(s=!1,a=u+1),l===Ui?-1===r?r=u:1!==c&&(c=1):-1!==r&&(c=-1);else if(!s){o=u+1;break}}return-1===r||-1===a||0===c||1===c&&r===a-1&&r===o+1?-1!==a&&(e.base=e.name=0===o&&i?t.slice(1,a):t.slice(o,a)):(0===o&&i?(e.name=t.slice(1,r),e.base=t.slice(1,a)):(e.name=t.slice(o,r),e.base=t.slice(o,a)),e.ext=t.slice(r,a)),o>0?e.dir=t.slice(0,o-1):i&&(e.dir="/"),e},t}(),or=new ir,ar=new rr;ar.win32=or.win32=or,ar.posix=or.posix=ar;var sr=or,ur=function(){function t(){this.frameRate=60}return t.prototype.onframe=function(t,e,n){var i=this;return void 0===n&&(n=0),this.on((function(){return 1e3/i.frameRate}),t,e,n),this},t.prototype.nextframe=function(t,e,n){var i=this;return void 0===n&&(n=0),this.once((function(){return 1e3/i.frameRate}),t,e,n),this},t.prototype.offframe=function(t,e){var n=this;return this.off((function(){return 1e3/n.frameRate}),t,e),this},t.prototype.on=function(t,e,n,i){return void 0===i&&(i=0),pr({interval:t,func:e,thisObject:n,priority:i,once:!1}),this},t.prototype.once=function(t,e,n,i){return void 0===i&&(i=0),pr({interval:t,func:e,thisObject:n,priority:i,once:!0}),this},t.prototype.off=function(t,e,n){return fr({interval:t,func:e,thisObject:n}),this},t.prototype.repeat=function(t,e,n,i,r){if(void 0===r&&(r=0),!((e=~~e)<1))return new lr(this,t,e,n,i,r)},t}(),cr=new ur,lr=function(){function t(t,e,n,i,r,o){void 0===o&&(o=0),this.currentCount=0,this.ticker=t,this.interval=e,this.func=i,this.thisObject=r,this.priority=o}return t.prototype.start=function(){return this.ticker.on(this.interval,this.runfunc,this,this.priority),this},t.prototype.stop=function(){return this.ticker.off(this.interval,this.runfunc,this),this},t.prototype.reset=function(){return this.stop(),this.currentCount=0,this},t.prototype.runfunc=function(){this.currentCount++,this.repeatCount--,this.func.call(this.thisObject,M.getvalue(this.interval)),this.repeatCount<1&&this.stop()},t}(),hr=[];function pr(t){mr?yr.push([pr,[t]]):(void 0===t.priority&&(t.priority=0),t.runtime=Date.now()+M.getvalue(t.interval),hr.push(t))}function fr(t){if(mr)yr.push([fr,[t]]);else for(var e=hr.length-1;e>=0;e--){var n=hr[e];M.getvalue(n.interval)===M.getvalue(t.interval)&&n.func===t.func&&n.thisObject===t.thisObject&&hr.splice(e,1)}}var dr,mr=!1,yr=[];if("undefined"==typeof requestAnimationFrame){var vr;"undefined"!=typeof window&&(vr=window,dr=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame),void 0===dr&&(dr=function(t){return vr.setTimeout(t,1e3/cr.frameRate)})}else dr=requestAnimationFrame;function gr(t,e){_r[t]=e}!function t(){mr=!0,hr.sort((function(t,e){return t.priority-e.priority}));for(var e,n,i=Date.now(),r=[],o=hr.length-1;o>=0;o--){var a=hr[o];if(a.runtime<i){if(r.push(a),a.once){hr.splice(o,1);continue}a.runtime=(e=a.runtime,n=M.getvalue(a.interval),e+Math.ceil((i-e)/n)*n)}}for(r.reverse(),p.unique(r,(function(t,e){return t.func===e.func&&t.thisObject===e.thisObject})),r.forEach((function(t){t.func.call(t.thisObject,M.getvalue(t.interval))})),mr=!1,o=0;o<yr.length;o++){var s=yr[o];s[0].apply(null,s[1])}yr.length=0,dr(t)}();var _r={},br=function(){function t(){this.isLoaded=!1,this.isLoading=!1}return Object.defineProperty(t.prototype,"extenson",{get:function(){return console.assert(!!this.assetPath),ri.extname(this.assetPath)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parentAsset",{get:function(){var t=ri.dirname(this.assetPath);return this.rs.getAssetByPath(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fileName",{get:function(){return console.assert(!!this.assetPath),ri.getName(this.assetPath)},enumerable:!1,configurable:!0}),t.prototype.initAsset=function(){},t.prototype.getAssetData=function(t){var e=this;if(!this.isLoaded)return t&&this.read((function(n){console.assert(!n),e.getAssetData(t)})),null;var n=this._getAssetData();return t&&t(n),n},t.prototype._getAssetData=function(){return this.data},t.prototype.read=function(t){var e=this;if(this.isLoaded)t();else{var n="loaded";Y.once(this,n,(function(){e.isLoaded=!0,e.isLoading=!1,t()})),this.isLoading||(this.isLoading=!0,this.readMeta((function(t){t?Y.emit(e,n):e.readFile((function(t){Y.emit(e,n)}))})))}},t.prototype.write=function(t){var e=this;this.meta.mtimeMs=Date.now(),this.writeMeta((function(n){n?t&&t(n):e.saveFile((function(e){t&&t(e)}))}))},t.prototype.delete=function(t){var e=this;this.deleteMeta((function(n){n?t&&t(n):e.deleteFile((function(n){wr.rs.deleteAssetById(e.assetId),t&&t()}))}))},t.prototype.readPreview=function(t){var e=this;this._preview?t(null,this._preview):this.rs.fs.readImage(this.previewPath,(function(n,i){e._preview=i,t(n,i)}))},t.prototype.writePreview=function(t,e){this._preview!==t?(this._preview=t,this.rs.fs.writeImage(this.previewPath,t,e)):e&&e(null)},t.prototype.deletePreview=function(t){this.rs.fs.deleteFile(this.previewPath,t)},t.prototype.deleteFile=function(t){var e=this;this.rs.fs.deleteFile(this.assetPath,t),cr.once(1e3,(function(){e.rs.getAssetById(e.assetId)||e.deletePreview()}))},Object.defineProperty(t.prototype,"metaPath",{get:function(){return this.assetPath+".meta"},enumerable:!1,configurable:!0}),t.prototype.readMeta=function(t){var e=this;this.rs.fs.readObject(this.metaPath,(function(n,i){e.meta=i,t&&t(n)}))},t.prototype.writeMeta=function(t){this.rs.fs.writeObject(this.metaPath,this.meta,t)},t.prototype.deleteMeta=function(t){this.rs.fs.deleteFile(this.metaPath,t)},Object.defineProperty(t.prototype,"previewPath",{get:function(){return"previews/"+this.assetId+".png"},enumerable:!1,configurable:!0}),Ci([C],t.prototype,"assetPath",void 0),Ci([C],t.prototype,"assetId",void 0),t}(),xr=function(n){function i(){var e=null!==n&&n.apply(this,arguments)||this;return e.assetType=t.AssetType.folder,e}return Mi(i,n),Object.defineProperty(i.prototype,"childrenAssets",{get:function(){return this.rs.getChildrenAssetByPath(this.assetPath)},enumerable:!1,configurable:!0}),i.prototype.initAsset=function(){},i.prototype.delete=function(t){n.prototype.delete.call(this,t)},i.prototype.saveFile=function(t){this.rs.fs.mkdir(this.assetPath,t)},i.prototype.readFile=function(t){t&&t(null)},i.extenson="",i=Ci([e({component:"OVFolderAsset"})],i)}(br);gr("folder",xr);var wr=function(){function t(t){this._rootPath="Assets",this._idMap={},this._pathMap={},this.resources="resource.json",this._fs=t}return Object.defineProperty(t.prototype,"fs",{get:function(){return this._fs||Jn.fs},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rootPath",{get:function(){return this._rootPath},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this.getAssetByPath(this.rootPath)},enumerable:!1,configurable:!0}),t.prototype.init=function(t){var e=this;this.fs.readObject(this.resources,(function(n,i){i?(E.deserialize(i).forEach((function(t){t.rs=e,e.addAsset(t)})),t()):e.createAsset(xr,e.rootPath,null,null,(function(e,n){t()}))}))},t.prototype.createAsset=function(t,e,n,i,r){i=i||this.root;var o=new t,a=P.uuid();o.rs=this,E.setValue(o,n),o.assetId=a,o.meta={guid:a,mtimeMs:Date.now(),birthtimeMs:Date.now(),assetType:o.assetType},o.initAsset(),Sr.addAssetData(o.assetId,o.data);var s=sr.extname(e);""===s&&(s=t.extenson),console.assert(void 0!==s,"对象 "+t+" 没有设置 extenson 值，参考 FolderAsset.extenson"),e=(e=ri.getName(e))||"new "+o.assetType,i?(e=this.getValidChildName(i,e),o.assetPath=i.assetPath+"/"+e+s):o.assetPath=e+s,this.addAsset(o),o.write((function(t){r&&r(null,o)}))},t.prototype.getValidChildName=function(t,e){for(var n=t.childrenAssets.map((function(t){return t.fileName})),i=e,r=1;-1!==n.indexOf(i);)i=e+r,r++;return i},t.prototype.readAsset=function(t,e){var n=this.getAssetById(t);n?n.read((function(t){n&&Sr.addAssetData(n.assetId,n.data),e(t,n)})):e(new Error("不存在资源 "+t),n)},t.prototype.readAssetData=function(t,e){var n=Sr.getLoadedAssetData(t);n?e(null,n):this.readAsset(t,(function(t,n){e(t,n&&n.getAssetData())}))},t.prototype.readAssetDatas=function(e,n){var i=[],r=e.map((function(e){return function(n){t.rs.readAssetData(e,(function(t,e){console.assert(!!e),i.push(e),n()}))}}));Un.parallel(r)((function(){console.assert(e.length===i.filter((function(t){return null!==t})).length),n(null,i)}))},t.prototype.getAssetsByType=function(t){var e=this;return Object.keys(this._idMap).map((function(t){return e._idMap[t]})).filter((function(e){return e instanceof t}))},t.prototype.getLoadedAssetDatasByType=function(t){return Sr.getAllLoadedAssetDatas().filter((function(e){return e instanceof t}))},t.prototype.getAssetById=function(t){return this._idMap[t]},t.prototype.getAssetByPath=function(t){return this._pathMap[t]},t.prototype.getChildrenPathsByPath=function(t){return this.getAllPaths().filter((function(e){return ri.dirname(e)===t}))},t.prototype.getChildrenAssetByPath=function(t){var e=this;return this.getChildrenPathsByPath(t).map((function(t){return e.getAssetByPath(t)}))},t.prototype.addAsset=function(t){this._idMap[t.assetId]=t,this._pathMap[t.assetPath]=t},t.prototype.getAllIds=function(){return Object.keys(this._idMap)},t.prototype.getAllPaths=function(){return Object.keys(this._pathMap)},t.prototype.getAllAssets=function(){var t=this;return this.getAllIds().map((function(e){return t.getAssetById(e)}))},t.prototype.deleteAssetById=function(t){this.deleteAsset0(this.getAssetById(t))},t.prototype.deleteAssetByPath=function(t){this.deleteAsset0(this._pathMap[t])},t.prototype.deleteAsset0=function(t){delete this._idMap[t.assetId],delete this._pathMap[t.assetPath]},t.prototype.getAssetsWithObject=function(t,e){var n=this;if(void 0===e&&(e=[]),f.isBaseType(t))return[];(Sr.isAssetData(t)&&e.push(t.assetId),f.isObject(t)||Array.isArray(t))&&Object.keys(t).forEach((function(i){n.getAssetsWithObject(t[i],e)}));return e},t.prototype.deserializeWithAssets=function(t,e){var n=this.getAssetsWithObject(t);p.deleteItem(n,t.assetId),this.readAssetDatas(n,(function(n,i){var r=y.getInstanceByName(t.__class__);E.setValue(r,t),e(r)}))},t.rs=new t,t}(),Sr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Mi(e,t),Object.defineProperty(e.prototype,"assetName",{get:function(){var t=wr.rs.getAssetById(this.assetId);return t?t.fileName:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"assetId",{get:function(){return this._assetId},set:function(t){this._assetId!==t&&(void 0===this._assetId?this._assetId=t:console.error("不允许修改 assetId"))},enumerable:!1,configurable:!0}),e.addAssetData=function(t,e){if(e)return(this.assetMap.has(e)||this.idAssetMap.has(t))&&console.warn("同一个材质被保存在多个资源中！"),this.assetMap.set(e,t),this.idAssetMap.set(t,e),e},e.deleteAssetData=function(t){if(t){console.assert(this.assetMap.has(t));var e=this.assetMap.get(t);this._delete(e,t)}},e.deleteAssetDataById=function(t){console.assert(this.idAssetMap.has(t));var e=this.idAssetMap.get(t);this._delete(t,e)},e._delete=function(t,e){this.assetMap.delete(e),this.idAssetMap.delete(t)},e.isAssetData=function(t){return!!this.assetMap.has(t)||t instanceof e},e.serialize=function(t){var e={};return e.__class__=y.getQualifiedClassName(t),e.assetId=t.assetId,e},e.deserialize=function(t){var e=this.getLoadedAssetData(t.assetId);return console.assert(!!e,"资源 "+t.assetId+" 未加载，请使用 ReadRS.deserializeWithAssets 进行序列化包含加载的资源对象。"),e},e.getLoadedAssetData=function(t){return this.idAssetMap.get(t)},e.getAllLoadedAssetDatas=function(){return w.getKeys(this.assetMap)},e.assetPropertySign="assetId",e.assetMap=new Map,e.idAssetMap=new Map,Ci([C],e.prototype,"assetName",null),Ci([C],e.prototype,"assetId",null),e}(Ti);E.setValueHandlers.push({priority:0,handler:function(t,e,n,i){var r=t[n],o=e[n];if(Sr.isAssetData(o))return"__root__"!==n&&(t[n]=Sr.deserialize(o),!0);if(Sr.isAssetData(r)){if(null===o.__class__){var a=y.getQualifiedClassName(r),s=y.getInstanceByName(a);i.serialization.setValue(s,o),t[n]=s}else t[n]=i.serialization.deserialize(o);return!0}return!1}}),E.serializeHandlers.push({priority:0,handler:function(t,e,n){var i=e[n];return!!Sr.isAssetData(i)&&("__root__"!==n&&(t[n]=Sr.serialize(i),!0))}}),E.deserializeHandlers.push({priority:0,handler:function(t,e,n,i){var r=t[n],o=e[n];return Sr.isAssetData(o)?"__root__"!==n&&(t[n]=Sr.deserialize(o),!0):!!Sr.isAssetData(r)&&(t[n]=i.serialization.deserialize(o),!0)}},{priority:0,handler:function(t,e,n,i){var r=t[n],o=e[n];return Sr.isAssetData(o)?"__root__"!==n&&(t[n]=Sr.deserialize(o),!0):!!Sr.assetMap.has(r)&&(t[n]=i.serialization.deserialize(o),!0)}}),E.differentHandlers.push({priority:0,handler:function(t,e,n,i){var r=i.different,o=t[n];return!!Sr.isAssetData(o)&&("__root__"!==n&&(r[n]=Sr.serialize(o),!0))}});var Pr,Mr=function(){function e(){}return e.prototype.createIndices=function(t){for(var e=t.length/3,n=[],i=0;i<e;i++)n[i]=i;return n},e.prototype.createUVs=function(t){for(var e=0,n=0,i=[],r=t.length/3*2;e<r;)i[e++]=.5*n,i[e++]=1-(1&n),3==++n&&(n=0);return i},e.prototype.createVertexNormals=function(t,e,n){void 0===n&&(n=!1);var i=this.createFaceNormals(t,e,n),r=i.faceWeights,o=i.faceNormals,a=0,s=0,u=1,c=2,l=e.length,h=new Array(l);for(a=0;a<l;)h[a]=0,h[a+1]=0,h[a+2]=0,a+=3;for(var p=0,f=0,d=t.length,m=0,y=0;p<d;)y=n?r[f++]:1,m=0+3*t[p++],h[m++]+=o[s]*y,h[m++]+=o[u]*y,h[m]+=o[c]*y,m=0+3*t[p++],h[m++]+=o[s]*y,h[m++]+=o[u]*y,h[m]+=o[c]*y,m=0+3*t[p++],h[m++]+=o[s]*y,h[m++]+=o[u]*y,h[m]+=o[c]*y,s+=3,u+=3,c+=3;for(a=0;a<l;){var v=h[a],g=h[a+1],_=h[a+2],b=1/Math.sqrt(v*v+g*g+_*_);h[a]=v*b,h[a+1]=g*b,h[a+2]=_*b,a+=3}return h},e.prototype.createVertexTangents=function(t,e,n,i){void 0===i&&(i=!1);var r=this.createFaceTangents(t,e,n,i),o=r.faceWeights,a=r.faceTangents,s=0,u=e.length,c=new Array(u);for(s=0;s<u;)c[s]=0,c[s+1]=0,c[s+2]=0,s+=3;var l=0,h=t.length,p=0,f=0,d=0,m=1,y=2;for(s=0;s<h;)f=i?o[l++]:1,p=0+3*t[s++],c[p++]+=a[d]*f,c[p++]+=a[m]*f,c[p]+=a[y]*f,p=0+3*t[s++],c[p++]+=a[d]*f,c[p++]+=a[m]*f,c[p]+=a[y]*f,p=0+3*t[s++],c[p++]+=a[d]*f,c[p++]+=a[m]*f,c[p]+=a[y]*f,d+=3,m+=3,y+=3;for(s=0;s<u;){var v=c[s],g=c[s+1],_=c[s+2],b=1/Math.sqrt(v*v+g*g+_*_);c[s]=v*b,c[s+1]=g*b,c[s+2]=_*b,s+=3}return c},e.prototype.createFaceTangents=function(t,e,n,i){void 0===i&&(i=!1);for(var r=0,o=0,a=0,s=0,u=0,c=t.length,l=0,h=0,p=0,f=0,d=0,m=0,y=0,v=0,g=0,_=0,b=0,x=0,w=0,S=0,P=new Array(t.length),M=[];r<c;){if(a=t[r],s=t[r+1],u=t[r+2],h=n[0+2*a+1],p=n[0+2*s+1]-h,f=n[0+2*u+1]-h,m=e[l=0+3*a],y=e[l+1],v=e[l+2],g=e[l=0+3*s]-m,_=e[l+1]-y,b=e[l+2]-v,x=f*g-p*(e[l=0+3*u]-m),w=f*_-p*(e[l+1]-y),S=f*b-p*(e[l+2]-v),d=Math.sqrt(x*x+w*w+S*S),i){var C=1e4*d;C<1&&(C=1),M[o++]=C}d=1/d,P[r++]=d*x,P[r++]=d*w,P[r++]=d*S}return{faceTangents:P,faceWeights:M}},e.prototype.createFaceNormals=function(t,e,n){void 0===n&&(n=!1);for(var i=0,r=0,o=0,a=0,s=t.length,u=0,c=0,l=0,h=0,p=0,f=0,d=0,m=0,y=0,v=0,g=0,_=0,b=0,x=0,w=0,S=0,P=0,M=0,C=new Array(s),T=[];i<s;){if(u=e[a=3*t[i++]],h=e[a+1],d=e[a+2],c=e[a=3*t[i++]],p=e[a+1],m=e[a+2],l=e[a=3*t[i++]],f=e[a+1],w=(g=e[a+2]-d)*(b=p-h)-(v=f-h)*(x=m-d),S=(y=l-u)*x-g*(_=c-u),P=v*_-y*b,M=Math.sqrt(w*w+S*S+P*P),n){var A=1e4*M;A<1&&(A=1),T[o++]=A}M=1/M,C[r++]=w*M,C[r++]=S*M,C[r++]=P*M}return{faceNormals:C,faceWeights:T}},e.prototype.applyTransformation=function(t,e,n,i){var r,o,a,s=e.length/3,u=new ht,c=!!n,l=!!i,h=new Nt;(c||l)&&(h.copy(t),h.invert(),h.transpose());var p=0,f=0,d=0;for(r=0;r<s;++r)o=p+1,a=p+2,u.x=e[p],u.y=e[o],u.z=e[a],u=t.transformPoint3(u),e[p]=u.x,e[o]=u.y,e[a]=u.z,p+=3,c&&(o=f+1,a=f+2,u.x=n[f],u.y=n[o],u.z=n[a],(u=h.transformVector3(u)).normalize(),n[f]=u.x,n[o]=u.y,n[a]=u.z,f+=3),l&&(o=d+1,a=d+2,u.x=i[d],u.y=i[o],u.z=i[a],(u=h.transformVector3(u)).normalize(),i[d]=u.x,i[o]=u.y,i[a]=u.z,d+=3)},e.prototype.mergeGeometry=function(t){for(var e={},n=function(n){var i=t[n];if(0===n)e.indices=i.indices.concat(),e.positions=i.positions.concat(),i.uvs&&(e.uvs=i.uvs.concat()),i.normals&&(e.normals=i.normals.concat()),i.tangents&&(e.tangents=i.tangents.concat());else{var r=e.positions.length/3;i.indices.forEach((function(t){return e.indices.push(t+r)})),i.positions.forEach((function(t){return e.positions.push(t)})),e.uvs&&i.uvs.forEach((function(t){return e.uvs.push(t)})),e.normals&&i.normals.forEach((function(t){return e.normals.push(t)})),e.tangents&&i.tangents.forEach((function(t){return e.tangents.push(t)}))}},i=0;i<t.length;i++)n(i);return e},e.prototype.raycast=function(e,n,i,r,o,a){if(void 0===o&&(o=Number.MAX_VALUE),void 0===a&&(a=t.CullFace.NONE),a===t.CullFace.FRONT_AND_BACK)return null;for(var s=0,u=0,c=0,l=0,h=0,p=0,f=0,d=0,m=0,y=0,v=0,g=0,_=0,b=0,x=0,w=0,S=0,P=0,M=0,C=0,T=0,A=0,O=0,E=0,D=0,z=0,I=0,j=0,R=0,L=0,N=0,F=0,k=0,B=0,V=0,W=0,U=0,G=0,H=0,K=-1,X=n.length,q={},Y=0;Y<X;Y+=3){u=3*n[Y],c=3*n[Y+1],l=3*n[Y+2],P=i[u],M=i[u+1],C=i[u+2],T=i[c],A=i[c+1],O=i[c+2],E=i[l],D=i[l+1],d=(I=A-M)*(N=i[l+2]-C)-(j=O-C)*(L=D-M),m=j*(R=E-P)-(z=T-P)*N,y=z*L-I*R,d*=F=1/Math.sqrt(d*d+m*m+y*y),m*=F,y*=F;var Z=e.origin,Q=e.direction;if(k=d*Q.x+m*Q.y+y*Q.z,a===t.CullFace.FRONT&&k>0||a===t.CullFace.BACK&&k<0||a===t.CullFace.NONE&&0!==k){if(B=-(d*P+m*M+y*C),s=-(d*Z.x+m*Z.y+y*Z.z+B)/k,(w=(b=1/((W=z*z+I*I+j*j)*(U=R*R+L*L+N*N)-(V=z*R+I*L+j*N)*V))*(U*(G=(h=(v=Z.x+s*Q.x)-P)*z+(p=(g=Z.y+s*Q.y)-M)*I+(f=(_=Z.z+s*Q.z)-C)*j)-V*(H=h*R+p*L+f*N)))<0)continue;if((S=b*(-V*G+W*H))<0)continue;(x=1-w-S)>=0&&s>=0&&s<o&&(o=s,K=Y/3,q.rayEntryDistance=s,q.localPosition=new ht(v,g,_),q.localNormal=new ht(d,m,y),r&&(q.uv=J(n,r,Y,w,S,x)),q.index=Y)}}return K>=0?q:null;function J(t,e,n,i,r,o){var a=2*t[n],s=e[a],u=e[a+1],c=e[a=2*t[n+1]],l=e[a+1],h=e[a=2*t[n+2]],p=e[a+1],f=new lt;return f.x=o*s+i*c+r*h,f.y=o*u+i*l+r*p,f}},e.prototype.getAABB=function(t){return Dt.formPositions(t)},e}(),Cr=new Mr,Tr=function(e){function i(){var n=e.call(this)||this;return n.preview="",n.assetType=t.AssetType.geometry,n.scaleU=1,n.scaleV=1,n._indexBuffer=new Pn,n._attributes={a_position:new wn({name:"a_position",data:[],size:3}),a_color:new wn({name:"a_color",data:[],size:4}),a_uv:new wn({name:"a_uv",data:[],size:2}),a_normal:new wn({name:"a_normal",data:[],size:3}),a_tangent:new wn({name:"a_tangent",data:[],size:3}),a_skinIndices:new wn({name:"a_skinIndices",data:[],size:4}),a_skinWeights:new wn({name:"a_skinWeights",data:[],size:4}),a_skinIndices1:new wn({name:"a_skinIndices1",data:[],size:4}),a_skinWeights1:new wn({name:"a_skinWeights1",data:[],size:4})},n._geometryInvalid=!0,n._useFaceWeights=!1,n}return Mi(i,e),Object.defineProperty(i.prototype,"geometryInfo",{get:function(){return["Geometry Info","  Vertices    "+this.numVertex,"  Triangles    "+this.numTriangles,"  Attributes    "+Object.keys(this._attributes).join(",")].join("\n")},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"indices",{get:function(){return this.updateGrometry(),this._indexBuffer.indices},set:function(t){this._indexBuffer.indices=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"positions",{get:function(){return this._attributes.a_position.data},set:function(t){this._attributes.a_position.data=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"colors",{get:function(){return this._attributes.a_color.data},set:function(t){this._attributes.a_color.data=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"uvs",{get:function(){return this._attributes.a_uv.data},set:function(t){this._attributes.a_uv.data=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"normals",{get:function(){return this._attributes.a_normal.data},set:function(t){this._attributes.a_normal.data=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tangents",{get:function(){return this._attributes.a_tangent.data},set:function(t){this._attributes.a_tangent.data=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skinIndices",{get:function(){return this._attributes.a_skinIndices.data},set:function(t){this._attributes.a_skinIndices.data=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skinWeights",{get:function(){return this._attributes.a_skinWeights.data},set:function(t){this._attributes.a_skinWeights.data=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skinIndices1",{get:function(){return this._attributes.a_skinIndices1.data},set:function(t){this._attributes.a_skinIndices1.data=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skinWeights1",{get:function(){return this._attributes.a_skinWeights1.data},set:function(t){this._attributes.a_skinWeights1.data=t},enumerable:!1,configurable:!0}),i.prototype.invalidateGeometry=function(){this._geometryInvalid=!0,this.invalidateBounds()},i.prototype.updateGrometry=function(){this._geometryInvalid&&(this._geometryInvalid=!1,this.buildGeometry())},i.prototype.buildGeometry=function(){},Object.defineProperty(i.prototype,"numVertex",{get:function(){return this.positions.length/3},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"numTriangles",{get:function(){return this.indices.length/3},enumerable:!1,configurable:!0}),i.prototype.addGeometry=function(t,e){if(this.updateGrometry(),t.updateGrometry(),e&&(t=t.clone()).applyTransformation(e),this.indices){for(var n=this._attributes,i=t._attributes,r=this.numVertex,o=this.indices,a=t.indices,s=o.concat(),u=0;u<a.length;u++)s[o.length+u]=a[u]+r;for(var c in this.indices=s,n){var l=n[c],h=i[c];l.data=l.data.concat(h.data)}}else this.cloneFrom(t)},i.prototype.applyTransformation=function(t){this.updateGrometry();var e=this.positions,n=this.normals,i=this.tangents;Cr.applyTransformation(t,e,n,i),this.positions=e,this.normals=n,this.tangents=i},i.prototype.invalidateBounds=function(){this._bounding=null,this.emit("boundsInvalid",this)},Object.defineProperty(i.prototype,"bounding",{get:function(){if(this.updateGrometry(),!this._bounding){var t=this.positions;if(!t||0===t.length)return new Dt;this._bounding=Dt.formPositions(this.positions)}return this._bounding},enumerable:!1,configurable:!0}),i.prototype.raycast=function(e,n,i){return void 0===n&&(n=Number.MAX_VALUE),void 0===i&&(i=t.CullFace.NONE),Cr.raycast(e,this.indices,this.positions,this.uvs,n,i)},i.prototype.getVertices=function(t){void 0===t&&(t=[]);for(var e=this.positions,n=0,i=e.length;n<i;n+=3)t.push(new ht(e[n],e[n+1],e[n+2]));return t},i.prototype.getFaces=function(t){void 0===t&&(t=[]);for(var e=this.indices,n=0,i=e.length;n<i;n+=3)t.push([e[n],e[n+1],e[n+2]]);return t},i.prototype.clone=function(){var t=new(0,this.constructor);return t.cloneFrom(this),t},i.prototype.cloneFrom=function(t){for(var e in t.updateGrometry(),this.indices=t.indices.concat(),t._attributes){var n=this._attributes[e],i=t._attributes[e];n.data=i.data.concat()}},i.prototype.beforeRender=function(t){for(var e in this.updateGrometry(),t.index=this._indexBuffer,this._attributes)this._attributes.hasOwnProperty(e)&&(t.attributes[e]=this._attributes[e]);t.shaderMacro.SCALEU=this.scaleU,t.shaderMacro.SCALEV=this.scaleV},i.prototype.clear=function(){for(var t in this._attributes){this._attributes[t].data=[]}},i.setDefault=function(e,n,i){this._defaultGeometry[e]=n,i&&E.setValue(n,i),E.setValue(n,{name:e,assetId:e,hideFlags:t.HideFlags.NotEditable}),Sr.addAssetData(e,n)},i.getDefault=function(t){return this._defaultGeometry[t]},i._defaultGeometry={},Ci([n({component:"OAVFeng3dPreView"})],i.prototype,"preview",void 0),Ci([n()],i.prototype,"name",void 0),Ci([n({component:"OAVMultiText",priority:-10})],i.prototype,"geometryInfo",null),Ci([n({tooltip:"标记需要更新几何体，在更改几何体数据后需要调用该函数。"})],i.prototype,"invalidateGeometry",null),Ci([C,n()],i.prototype,"scaleU",void 0),Ci([C,n()],i.prototype,"scaleV",void 0),i}(Ti);t.ShadowType=void 0,(Pr=t.ShadowType||(t.ShadowType={}))[Pr.No_Shadows=0]="No_Shadows",Pr[Pr.Hard_Shadows=1]="Hard_Shadows",Pr[Pr.PCF_Shadows=2]="PCF_Shadows",Pr[Pr.PCF_Soft_Shadows=3]="PCF_Soft_Shadows";var Ar,Or=function(){function e(t){this._model=t}return e.prototype.beforeRender=function(e){var n=this,i=[],r=[],o=[],a=this._model.gameObject.scene;a&&(i=a.activePointLights,r=a.activeDirectionalLights,o=a.activeSpotLights),e.shaderMacro.NUM_LIGHT=i.length+r.length+o.length;var s=[],u=[],c=[];i.forEach((function(e){e.isVisibleAndEnabled&&(e.shadowType!==t.ShadowType.No_Shadows&&n._model.receiveShadows?(s.push(e),c.push(e.shadowMap)):u.push(e))})),e.shaderMacro.NUM_POINTLIGHT=u.length,e.shaderMacro.NUM_POINTLIGHT_CASTSHADOW=s.length,e.uniforms.u_pointLights=u,e.uniforms.u_castShadowPointLights=s,e.uniforms.u_pointShadowMaps=c;var l=[],h=[],p=[],f=[];o.forEach((function(e){e.isVisibleAndEnabled&&(e.shadowType!==t.ShadowType.No_Shadows&&n._model.receiveShadows?(l.push(e),f.push(e.shadowCamera.viewProjection),p.push(e.shadowMap)):h.push(e))})),e.shaderMacro.NUM_SPOT_LIGHTS=h.length,e.shaderMacro.NUM_SPOT_LIGHTS_CASTSHADOW=l.length,e.uniforms.u_spotLights=h,e.uniforms.u_castShadowSpotLights=l,e.uniforms.u_spotShadowMatrix=f,e.uniforms.u_spotShadowMaps=p;var d=[],m=[],y=[],v=[];r.forEach((function(e){e.isVisibleAndEnabled&&(e.shadowType!==t.ShadowType.No_Shadows&&n._model.receiveShadows?(d.push(e),y.push(e.shadowCamera.viewProjection),v.push(e.shadowMap)):m.push(e))})),e.shaderMacro.NUM_DIRECTIONALLIGHT=m.length,e.shaderMacro.NUM_DIRECTIONALLIGHT_CASTSHADOW=d.length,e.uniforms.u_directionalLights=m,e.uniforms.u_castShadowDirectionalLights=d,e.uniforms.u_directionalShadowMatrixs=y,e.uniforms.u_directionalShadowMaps=v},e}(),Er=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.format=t.TextureFormat.RGBA,n.type=t.TextureDataType.UNSIGNED_BYTE,n.generateMipmap=!1,n.flipY=!1,n.premulAlpha=!1,n.minFilter=t.TextureMinFilter.LINEAR,n.magFilter=t.TextureMagFilter.LINEAR,n._wrapS=t.TextureWrap.REPEAT,n._wrapT=t.TextureWrap.REPEAT,n.anisotropy=0,n.invalid=!0,n.isRenderTarget=!1,n.OFFSCREEN_WIDTH=1024,n.OFFSCREEN_HEIGHT=1024,n}return Mi(i,e),Object.defineProperty(i.prototype,"wrapS",{get:function(){return this.isPowerOfTwo?this._wrapS:t.TextureWrap.CLAMP_TO_EDGE},set:function(t){this._wrapS=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wrapT",{get:function(){return this.isPowerOfTwo?this._wrapT:t.TextureWrap.CLAMP_TO_EDGE},set:function(t){this._wrapT=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isPowerOfTwo",{get:function(){if(this.isRenderTarget)return!(0===this.OFFSCREEN_WIDTH||!P.isPowerOfTwo(this.OFFSCREEN_WIDTH))&&!(0===this.OFFSCREEN_HEIGHT||!P.isPowerOfTwo(this.OFFSCREEN_HEIGHT));var t=this.activePixels;if(!t)return!1;Array.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++){var n=t[e];if(0===n.width||!P.isPowerOfTwo(n.width))return!1;if(0===n.height||!P.isPowerOfTwo(n.height))return!1}return!0},enumerable:!1,configurable:!0}),i.prototype.getSize=function(){if(this.isRenderTarget)return new lt(this.OFFSCREEN_WIDTH,this.OFFSCREEN_HEIGHT);var t=this.activePixels;if(!t)return new lt(1,1);if(Array.isArray(t)||(t=[t]),0===t.length)return new lt(1,1);var e=t[0];return new lt(e.width,e.height)},i.prototype.checkRenderData=function(t){if(!t)return!1;if(Array.isArray(t)||(t=[t]),0===t.length)return!1;for(var e=0;e<t.length;e++){var n=t[e];if(!n)return!1;if(0===n.width)return!1;if(0===n.height)return!1}return!0},i.prototype.invalidate=function(){this.invalid=!0},Object.defineProperty(i.prototype,"activePixels",{get:function(){return this.updateActivePixels(),this._activePixels},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dataURL",{get:function(){return this.updateActivePixels(),this._dataURL||(this._activePixels instanceof ImageData?this._dataURL=x.imageDataToDataURL(this._activePixels):this._activePixels instanceof HTMLImageElement?this._dataURL=x.imageToDataURL(this._activePixels):this._activePixels instanceof HTMLCanvasElement&&(this._dataURL=x.canvasToDataURL(this._activePixels))),this._dataURL},enumerable:!1,configurable:!0}),i.prototype.updateActivePixels=function(){var e=this._activePixels;this.checkRenderData(this._pixels)?this._activePixels=this._pixels:Array.isArray(this.noPixels)?this._activePixels=this.noPixels.map((function(e){return t.imageDatas[e]})):this._activePixels=t.imageDatas[this.noPixels],e!==this._activePixels&&(this._dataURL=null)},Ci([C,n({component:"OAVEnum",componentParam:{enumClass:t.TextureFormat}}),N("invalidate")],i.prototype,"format",void 0),Ci([C,n({component:"OAVEnum",componentParam:{enumClass:t.TextureDataType}}),N("invalidate")],i.prototype,"type",void 0),Ci([C,n(),N("invalidate")],i.prototype,"generateMipmap",void 0),Ci([C,n(),N("invalidate")],i.prototype,"flipY",void 0),Ci([C,n(),N("invalidate")],i.prototype,"premulAlpha",void 0),Ci([C,n({component:"OAVEnum",componentParam:{enumClass:t.TextureMinFilter}})],i.prototype,"minFilter",void 0),Ci([C,n({component:"OAVEnum",componentParam:{enumClass:t.TextureMagFilter}})],i.prototype,"magFilter",void 0),Ci([C,n({component:"OAVEnum",componentParam:{enumClass:t.TextureWrap}})],i.prototype,"wrapS",null),Ci([C,n({component:"OAVEnum",componentParam:{enumClass:t.TextureWrap}})],i.prototype,"wrapT",null),Ci([C,n()],i.prototype,"anisotropy",void 0),Ci([N("invalidate")],i.prototype,"OFFSCREEN_WIDTH",void 0),Ci([N("invalidate")],i.prototype,"OFFSCREEN_HEIGHT",void 0),i}(Ti),Dr=function(){function t(t,e,n){void 0===t&&(t=1),void 0===e&&(e=1),void 0===n&&(n=new yt(0,0,0,0)),this.init(t,e,n)}return t.fromImage=function(e){return(new t).fromImage(e)},t.prototype.init=function(t,e,n){void 0===t&&(t=1),void 0===e&&(e=1),void 0===n&&(n=new yt(0,0,0,0)),this.imageData=new ImageData(t,e),this.fillRect(new Bt(0,0,t,e),n)},t.prototype.fromImage=function(t){if(!t)return null;var e=document.createElement("canvas");e.width=t.width,e.height=t.height;var n=e.getContext("2d");return console.assert(!!n),n.drawImage(t,0,0),this.imageData=n.getImageData(0,0,t.width,t.height),this},t.prototype.drawPixel=function(t,e,n){var i=this.getPixel(t,e);return i.mix(n,n.a),this.setPixel(t,e,i),this},t.prototype.getPixel=function(t,e){var n=4*(t+e*this.imageData.width);return new yt(this.imageData.data[n]/255,this.imageData.data[n+1]/255,this.imageData.data[n+2]/255,this.imageData.data[n+3]/255)},t.prototype.setPixel=function(t,e,n){var i=4*((t=Math.round(t))+(e=Math.round(e))*this.imageData.width);return this.imageData.data[i]=255*n.r,this.imageData.data[i+1]=255*n.g,this.imageData.data[i+2]=255*n.b,this.imageData.data[i+3]=255*n.a,this},t.prototype.clear=function(t){void 0===t&&(t=new yt(0,0,0,0));for(var e=0;e<this.imageData.width;e++)for(var n=0;n<this.imageData.height;n++)this.setPixel(e,n,t)},t.prototype.fillRect=function(t,e){void 0===e&&(e=new yt);for(var n=t.x>0?t.x:0;n<this.imageData.width&&n<t.x+t.width;n++)for(var i=t.y>0?t.y:0;i<this.imageData.height&&i<t.y+t.height;i++)this.setPixel(n,i,e)},t.prototype.drawLine=function(t,e,n){for(var i=e.subTo(t).length,r=new lt,o=0;o<=i;o++)t.lerpNumberTo(e,o/i,r),this.setPixel(r.x,r.y,n);return this},t.prototype.drawPoint=function(t,e,n,i){void 0===i&&(i=1);var r=Math.floor(i/2),o=t-r;o<0&&(o=0);var a=t-r+i;a>this.imageData.width&&(a=this.imageData.width);var s=e-r;s<0&&(s=0);var u=e-r+i;u>this.imageData.height&&(u=this.imageData.height);for(var c=o;c<a;c++)for(var l=s;l<u;l++)this.setPixel(c,l,n);return this},t.prototype.drawImageData=function(e,n,i){var r=new Bt(0,0,this.imageData.width,this.imageData.height).intersection(new Bt(n,i,e.width,e.height)),o=new t;o.imageData=e;for(var a=r.x;a<r.x+r.width;a++)for(var s=r.y;s<r.y+r.height;s++){var u=o.getPixel(a-n,s-i);this.drawPixel(a,s,u)}return this},t.prototype.toDataURL=function(){return x.imageDataToDataURL(this.imageData)},t.prototype.drawDefaultParticle=function(t){void 0===t&&(t=64);for(var e=new ImageData(t,t),n=t/2,i=0;i<t;i++)for(var r=0;r<t;r++){var o=1-P.clamp(new lt(i-n,r-n).length,0,n)/n;o*=o;var a=4*(i+r*t);e.data[a]=255*o,e.data[a+1]=255*o,e.data[a+2]=255*o,e.data[a+3]=255*o}return this.imageData=e,this},t.prototype.drawColorPickerRect=function(t){for(var e=new pt(1,1,1),n=(new pt).fromUnit(t),i=new pt(0,0,0),r=new pt(0,0,0),o=0;o<this.imageData.width;o++)for(var a=0;a<this.imageData.height;a++){var s=e.mixTo(n,o/this.imageData.width),u=i.mixTo(r,o/this.imageData.width),c=s.mixTo(u,a/this.imageData.height);this.setPixel(o,a,(new yt).fromColor3(c))}return this},t.prototype.drawColorRect=function(t){var e=Math.floor(.8*this.imageData.height),n=Math.floor(t.a*this.imageData.width),i=t.clone();i.a=1;for(var r=new yt(1,1,1),o=new yt(0,0,0),a=0;a<this.imageData.width;a++)for(var s=0;s<this.imageData.height;s++)s<=e?this.setPixel(a,s,i):this.setPixel(a,s,a<n?r:o);return this},t.prototype.drawMinMaxGradient=function(t,e){void 0===e&&(e=!0);for(var n=0;n<this.imageData.width;n++)for(var i=0;i<this.imageData.height;i++){var r=t.getValue(e?n/(this.imageData.width-1):i/(this.imageData.height-1));this.setPixel(n,i,r)}return this},t.prototype.drawCurve=function(t,e,n,i){void 0===i&&(i=null),i=i||new Bt(0,0,this.imageData.width,this.imageData.height);for(var r=e?[1,0]:[1,-1],o=new lt,a=new lt,s=0;s<i.width;s++){var u=t.getValue(s/(i.width-1));u=P.mapLinear(u,r[0],r[1],0,1);var c=Math.round(u*(i.height-1));a.x=i.x+s,a.y=i.y+c,s>0&&this.drawLine(o,a,n),o.x=a.x,o.y=a.y}return this},t.prototype.drawBetweenTwoCurves=function(t,e,n,i,r,o){void 0===i&&(i=new yt),void 0===r&&(r=new yt(1,1,1,.5)),void 0===o&&(o=null),o=o||new Bt(0,0,this.imageData.width,this.imageData.height);for(var a=n?[1,0]:[1,-1],s=new lt,u=new lt,c=new lt,l=new lt,h=0;h<o.width;h++){var p=t.getValue(h/(o.width-1)),f=e.getValue(h/(o.width-1));p=P.mapLinear(p,a[0],a[1],0,1),f=P.mapLinear(f,a[0],a[1],0,1),p=Math.round(p*(o.height-1)),f=Math.round(f*(o.height-1)),u.x=o.x+h,u.y=o.y+p,l.x=o.x+h,l.y=o.y+f,this.drawLine(new lt(o.x+h,o.y+p),new lt(o.x+h,o.y+f),r),h>0&&(this.drawLine(s,u,i),this.drawLine(c,l,i)),s.x=u.x,s.y=u.y,c.x=l.x,c.y=l.y}return this},t.prototype.clearBackColor=function(t){for(var e=0;e<this.imageData.width;e++)for(var n=0;n<this.imageData.height;n++){var i=this.getPixel(e,n),r=1-i.r/t.r;i.r=i.g=i.b=0,i.a=r,this.setPixel(e,n,i)}},t}();t.ImageDatas=void 0,(Ar=t.ImageDatas||(t.ImageDatas={})).black="black",Ar.white="white",Ar.red="red",Ar.green="green",Ar.blue="blue",Ar.defaultNormal="defaultNormal",Ar.defaultParticle="defaultParticle",t.imageDatas=void 0,"undefined"!=typeof document&&(t.imageDatas={black:new Dr(1,1,(new yt).fromUnit24(ft.black)).imageData,white:new Dr(1,1,(new yt).fromUnit24(ft.white)).imageData,red:new Dr(1,1,(new yt).fromUnit24(ft.red)).imageData,green:new Dr(1,1,(new yt).fromUnit24(ft.green)).imageData,blue:new Dr(1,1,(new yt).fromUnit24(ft.blue)).imageData,defaultNormal:new Dr(1,1,(new yt).fromUnit24(8421631)).imageData,defaultParticle:(new Dr).drawDefaultParticle().imageData});var zr=function(e){function n(){var n=e.call(this)||this;return n.textureType=t.TextureType.TEXTURE_2D,n.assetType=t.AssetType.texture,n.noPixels=t.ImageDatas.white,n._loadings=[],n}return Mi(n,e),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return 0===this._loadings.length},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"image",{get:function(){return this._pixels},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"source",{get:function(){return this._source},set:function(t){var e=this;if(this._source=t,!t)return this._pixels=null,void this.invalidate();t.url&&(this._loadings.push(t.url),Hn.loadImage(t.url,(function(n){e._pixels=n,e.invalidate(),p.deleteItem(e._loadings,t.url),e.onItemLoadCompleted()}),null,(function(n){console.error(n),p.deleteItem(e._loadings,t.url),e.onItemLoadCompleted()})))},enumerable:!1,configurable:!0}),n.prototype.onItemLoadCompleted=function(){0===this._loadings.length&&this.emit("loadCompleted")},n.prototype.onLoadCompleted=function(t){this.isLoaded?t():this.once("loadCompleted",t)},n.fromUrl=function(t){var e=new n;return e.source={url:t},e},Ci([C],n.prototype,"source",null),n}(Er);zr.white=E.setValue(new zr,{name:"white-Texture",noPixels:t.ImageDatas.white,hideFlags:t.HideFlags.NotEditable}),zr.default=E.setValue(new zr,{name:"Default-Texture",hideFlags:t.HideFlags.NotEditable}),zr.defaultNormal=E.setValue(new zr,{name:"Default-NormalTexture",noPixels:t.ImageDatas.defaultNormal,hideFlags:t.HideFlags.NotEditable}),zr.defaultParticle=E.setValue(new zr,{name:"Default-ParticleTexture",noPixels:t.ImageDatas.defaultParticle,format:t.TextureFormat.RGBA,hideFlags:t.HideFlags.NotEditable}),Sr.addAssetData("white-Texture",zr.white),Sr.addAssetData("Default-Texture",zr.default),Sr.addAssetData("Default-NormalTexture",zr.defaultNormal),Sr.addAssetData("Default-ParticleTexture",zr.defaultParticle);var Ir=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.textureType=t.TextureType.TEXTURE_CUBE_MAP,n.assetType=t.AssetType.texturecube,n.OAVCubeMap="",n.noPixels=[t.ImageDatas.white,t.ImageDatas.white,t.ImageDatas.white,t.ImageDatas.white,t.ImageDatas.white,t.ImageDatas.white],n._pixels=[null,null,null,null,null,null],n._loading=[],n}return Mi(i,e),Object.defineProperty(i.prototype,"isLoaded",{get:function(){return 0===this._loading.length},enumerable:!1,configurable:!0}),i.prototype.setTexture2D=function(t,e){this.rawData&&"texture"===this.rawData.type||(this.rawData={type:"texture",textures:[]});var n=i.ImageNames.indexOf(t);this.rawData.textures[n]=e,this._loadItemTexture(e,n)},i.prototype.setTexture2DPath=function(t,e){this.rawData&&"path"===this.rawData.type||(this.rawData={type:"path",paths:[]});var n=i.ImageNames.indexOf(t);this.rawData.paths[n]=e,this._loadItemImagePath(e,n)},i.prototype.getTextureImage=function(t,e){if(this.rawData){var n=i.ImageNames.indexOf(t);if("texture"===this.rawData.type){var r=this.rawData.textures[n];if(!r)return void e();r.onLoadCompleted((function(){e(r.image)}))}else if("path"===this.rawData.type){var o=this.rawData.paths[n];if(!o)return void e();Jn.fs.readImage(o,(function(t,n){e(n)}))}}else e()},i.prototype._rawDataChanged=function(){var t=this;this.rawData&&("texture"===this.rawData.type?(this.rawData.textures.forEach((function(e,n){t._loadItemTexture(e,n)})),this.invalidate()):"path"===this.rawData.type&&this.rawData.paths.forEach((function(e,n){t._loadItemImagePath(e,n)})))},i.prototype._loadItemTexture=function(t,e){var n=this;t&&(this._loading.push(t),t.onLoadCompleted((function(){"texture"===n.rawData.type&&n.rawData.textures[e]===t&&(n._pixels[e]=t.image,n.invalidate()),p.deleteItem(n._loading,t),n._onItemLoadCompleted()})))},i.prototype._loadItemImagePath=function(t,e){var n=this;t&&(this._loading.push(t),Jn.fs.readImage(t,(function(i,r){r&&"path"===n.rawData.type&&n.rawData.paths[e]===t&&(n._pixels[e]=r,n.invalidate()),p.deleteItem(n._loading,t),n._onItemLoadCompleted()})))},i.prototype._onItemLoadCompleted=function(){0===this._loading.length&&this.emit("loadCompleted")},i.prototype.onLoadCompleted=function(t){this.isLoaded?t():this.once("loadCompleted",t)},i.ImageNames=["positive_x_url","positive_y_url","positive_z_url","negative_x_url","negative_y_url","negative_z_url"],Ci([n({component:"OAVCubeMap",priority:1})],i.prototype,"OAVCubeMap",void 0),Ci([C,N("_rawDataChanged")],i.prototype,"rawData",void 0),i}(Er);Ir.default=E.setValue(new Ir,{name:"Default-TextureCube",hideFlags:t.HideFlags.NotEditable}),Sr.addAssetData("Default-TextureCube",Ir.default);var jr;t.FogMode=void 0,(jr=t.FogMode||(t.FogMode={}))[jr.NONE=0]="NONE",jr[jr.EXP=1]="EXP",jr[jr.EXP2=2]="EXP2",jr[jr.LINEAR=3]="LINEAR";var Rr=function(){function e(){this.u_PointSize=1,this.s_diffuse=zr.default,this.u_diffuse=new yt(1,1,1,1),this.u_alphaThreshold=0,this.s_normal=zr.defaultNormal,this.s_specular=zr.default,this.u_specular=new pt,this.u_glossiness=50,this.s_ambient=zr.default,this.u_ambient=new yt,this.s_envMap=Ir.default,this.u_reflectivity=1,this.u_fogMinDistance=0,this.u_fogMaxDistance=100,this.u_fogColor=new pt,this.u_fogDensity=.1,this.u_fogMode=t.FogMode.NONE}return Ci([C,n()],e.prototype,"u_PointSize",void 0),Ci([C,n({block:"diffuse"})],e.prototype,"s_diffuse",void 0),Ci([C,n({block:"diffuse"})],e.prototype,"u_diffuse",void 0),Ci([C,n({block:"diffuse"})],e.prototype,"u_alphaThreshold",void 0),Ci([C,n({block:"normalMethod"})],e.prototype,"s_normal",void 0),Ci([C,n({block:"specular"})],e.prototype,"s_specular",void 0),Ci([C,n({block:"specular"})],e.prototype,"u_specular",void 0),Ci([C,n({block:"specular"})],e.prototype,"u_glossiness",void 0),Ci([C,n({block:"ambient"})],e.prototype,"s_ambient",void 0),Ci([C,n({block:"ambient"})],e.prototype,"u_ambient",void 0),Ci([C,n({component:"OAVPick",block:"envMap",componentParam:{accepttype:"texturecube",datatype:"texturecube"}})],e.prototype,"s_envMap",void 0),Ci([C,n({block:"envMap"})],e.prototype,"u_reflectivity",void 0),Ci([C,n({block:"fog"})],e.prototype,"u_fogMinDistance",void 0),Ci([C,n({block:"fog"})],e.prototype,"u_fogMaxDistance",void 0),Ci([C,n({block:"fog"})],e.prototype,"u_fogColor",void 0),Ci([C,n({block:"fog"})],e.prototype,"u_fogDensity",void 0),Ci([C,n({block:"fog",component:"OAVEnum",componentParam:{enumClass:t.FogMode}})],e.prototype,"u_fogMode",void 0),e}();Fn.shaderConfig.shaders.standard={fragment:"precision mediump float;\r\n\r\nvarying vec2 v_uv;\r\nvarying vec3 v_worldPosition;\r\nuniform vec3 u_cameraPos;\r\n\r\n#include<color_pars_frag>\r\n\r\n#include<normal_pars_frag>\r\n#include<diffuse_pars_frag>\r\n#include<alphatest_pars_frag>\r\n\r\n#include<ambient_pars_frag>\r\n#include<specular_pars_frag>\r\n#include<lights_pars_frag>\r\n\r\n#include<envmap_pars_frag>\r\n#include<particle_pars_frag>\r\n#include<fog_pars_frag>\r\n\r\nvoid main()\r\n{\r\n    vec4 finalColor = vec4(1.0,1.0,1.0,1.0);\r\n\r\n    #include<color_frag>\r\n\r\n    #include<normal_frag>\r\n    #include<diffuse_frag>\r\n    #include<alphatest_frag>\r\n\r\n    finalColor = diffuseColor;\r\n\r\n    #include<ambient_frag>\r\n    #include<specular_frag>\r\n    #include<lights_frag>\r\n\r\n    #include<envmap_frag>\r\n    #include<particle_frag>\r\n    #include<fog_frag>\r\n\r\n    gl_FragColor = finalColor;\r\n}",vertex:"precision mediump float;  \r\n\r\n#include<position_pars_vert>\r\n#include<normal_pars_vert>\r\n#include<tangent_pars_vert>\r\n#include<color_pars_vert>\r\n//\r\n#include<skeleton_pars_vert>\r\n#include<particle_pars_vert>\r\n//\r\n#include<worldposition_pars_vert>\r\n#include<project_pars_vert>\r\n//\r\n#include<uv_pars_vert>\r\n#include<normalmap_pars_vert>\r\n//\r\n#include<lights_pars_vert>\r\n#include<pointsize_pars_vert>\r\n\r\nvoid main()\r\n{\r\n    // 初始化\r\n    #include<position_vert>\r\n    #include<normal_vert>\r\n    #include<tangent_vert>\r\n    #include<color_vert>\r\n    #include<uv_vert>\r\n    // 动画\r\n    #include<skeleton_vert>\r\n    #include<particle_vert>\r\n    // 投影\r\n    #include<worldposition_vert>\r\n    #include<project_vert>\r\n    // \r\n    #include<normalmap_vert>\r\n    //\r\n    #include<lights_vert>\r\n    #include<pointsize_vert>\r\n}",cls:Rr};var Lr=function(e){function i(){var t=e.call(this)||this;return t.renderAtomic=new Bn,t.preview="",t.name="",Z.on("asset.shaderChanged",t._onShaderChanged,t),t.shaderName="standard",t.uniforms=new Rr,t.renderParams=new zn,t}return Mi(i,e),i.create=function(t,e,n){var r=new i;return r.init(t,e,n),r},i.prototype.init=function(t,e,n){return this.shaderName=t,e&&E.setValue(this.uniforms,e),n&&E.setValue(this.renderParams,n),this},i.prototype.beforeRender=function(e){Object.assign(e.uniforms,this.renderAtomic.uniforms),e.shader=this.renderAtomic.shader,e.renderParams=this.renderAtomic.renderParams,e.shaderMacro.IS_POINTS_MODE=this.renderParams.renderMode===t.RenderMode.POINTS},Object.defineProperty(i.prototype,"isLoaded",{get:function(){var t=this.uniforms;for(var e in t){var n=t[e];if((n instanceof zr||n instanceof Ir)&&!n.isLoaded)return!1}return!0},enumerable:!1,configurable:!0}),i.prototype.onLoadCompleted=function(t){var e=0,n=this.uniforms;for(var i in n){var r=n[i];(r instanceof zr||r instanceof Ir)&&(r.isLoaded||(e++,r.on("loadCompleted",(function(){0===--e&&t()}))))}0===e&&t()},i.prototype._onShaderChanged=function(){var t=Fn.shaderConfig.shaders[this.shaderName].cls;if(t){if(!this.uniforms||this.uniforms.constructor!==t){var e=new t;this.uniforms=e}}else this.uniforms={};var n=Fn.shaderConfig.shaders[this.shaderName].renderParams;n&&E.setValue(this.renderParams,n),this.renderAtomic.shader=new kn({shaderName:this.shaderName})},i.prototype._onUniformsChanged=function(){this.renderAtomic.uniforms=this.uniforms},i.prototype._onRenderParamsChanged=function(){this.renderAtomic.renderParams=this.renderParams},i.setDefault=function(e,n){var r=this._defaultMaterials[e]=new i;E.setValue(r,n),E.setValue(r,{name:e,hideFlags:t.HideFlags.NotEditable}),Sr.addAssetData(e,r)},i.getDefault=function(t){return this._defaultMaterials[t]},i._defaultMaterials={},Ci([n({component:"OAVFeng3dPreView"})],i.prototype,"preview",void 0),Ci([n({component:"OAVMaterialName"}),C,N("_onShaderChanged")],i.prototype,"shaderName",void 0),Ci([n(),C],i.prototype,"name",void 0),Ci([C,n({component:"OAVObjectView"}),N("_onUniformsChanged")],i.prototype,"uniforms",void 0),Ci([C,n({block:"渲染参数",component:"OAVObjectView"}),N("_onRenderParamsChanged")],i.prototype,"renderParams",void 0),i}(Ti);Lr.setDefault("Default-Material",{shaderName:"standard"});var Nr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Mi(e,t),Object.defineProperty(e.prototype,"selfLocalBounds",{get:function(){return this._selfLocalBounds||this._updateBounds(),this._selfLocalBounds},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selfWorldBounds",{get:function(){return this._selfWorldBounds||this._updateWorldBounds(),this._selfWorldBounds},enumerable:!1,configurable:!0}),e.prototype.worldRayIntersection=function(t){throw"请在子类中实现！"},e.prototype._onScenetransformChanged=function(){this._selfWorldBounds=null},e.prototype._updateWorldBounds=function(){this._selfWorldBounds=this.selfLocalBounds.applyMatrixTo(this.transform.localToWorldMatrix)},e.prototype._onBoundsInvalid=function(){this._selfLocalBounds=null,this._selfWorldBounds=null,this.emit("selfBoundsChanged",this)},e.prototype._updateBounds=function(){throw"请在子类中实现！"},e=Ci([Ai()],e)}(Di),Fr=function(t){function e(){var e=t.call(this)||this;return e.renderAtomic=new Bn,e.geometry=Tr.getDefault("Cube"),e.material=Lr.getDefault("Default-Material"),e.castShadows=!0,e.receiveShadows=!0,e._lightPicker=new Or(e),e}return Mi(e,t),Object.defineProperty(e.prototype,"single",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.init=function(){t.prototype.init.call(this),this.on("scenetransformChanged",this._onScenetransformChanged,this),this.on("getSelfBounds",this._onGetSelfBounds,this)},e.prototype.beforeRender=function(t,e,n){var i=this;this.geometry.beforeRender(t),this.material.beforeRender(t),this._lightPicker.beforeRender(t),this.gameObject.components.forEach((function(r){r!==i&&r.beforeRender(t,e,n)}))},e.prototype.worldRayIntersection=function(t){var e=this.transform.rayWorldToLocal(t);return this.localRayIntersection(e)},e.prototype.localRayIntersection=function(t){var e=new ht,n=this.selfLocalBounds.rayIntersection(t.origin,t.direction,e);return n===Number.MAX_VALUE?null:{gameObject:this.gameObject,localNormal:e,localRay:t,rayEntryDistance:n,rayOriginIsInsideBounds:0===n,geometry:this.geometry,cullFace:this.material.renderParams.cullFace}},Object.defineProperty(e.prototype,"isLoaded",{get:function(){return this.material.isLoaded},enumerable:!1,configurable:!0}),e.prototype.onLoadCompleted=function(t){this.isLoaded&&t(),this.material.onLoadCompleted(t)},e.prototype.dispose=function(){this.geometry=null,this.material=null,t.prototype.dispose.call(this)},e.prototype._onGeometryChanged=function(t,e,n){e&&e.off("boundsInvalid",this._onBoundsInvalid,this),n&&n.on("boundsInvalid",this._onBoundsInvalid,this),this.geometry=this.geometry||Tr.getDefault("Cube"),this._onBoundsInvalid()},e.prototype._updateBounds=function(){this._selfLocalBounds=this.geometry.bounding},e.prototype._onGetSelfBounds=function(t){t.data.bounds.push(this.geometry.bounding)},Ci([n({component:"OAVPick",tooltip:"几何体，提供模型以形状",componentParam:{accepttype:"geometry",datatype:"geometry"}}),C,N("_onGeometryChanged")],e.prototype,"geometry",void 0),Ci([n({component:"OAVPick",tooltip:"材质，提供模型以皮肤",componentParam:{accepttype:"material",datatype:"material"}}),C],e.prototype,"material",void 0),Ci([n({tooltip:"是否投射阴影"}),C],e.prototype,"castShadows",void 0),Ci([n({tooltip:"是否接受阴影"}),C],e.prototype,"receiveShadows",void 0),e=Ci([Ai()],e)}(Nr),kr=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.runEnvironment=t.RunEnvironment.feng3d,n._invalid=!0,n.scriptInit=!1,n}return Mi(i,e),Object.defineProperty(i.prototype,"scriptInstance",{get:function(){return this._invalid&&this._updateScriptInstance(),this._scriptInstance},enumerable:!1,configurable:!0}),i.prototype.init=function(){e.prototype.init.call(this),Z.on("asset.scriptChanged",this._invalidateScriptInstance,this)},i.prototype._updateScriptInstance=function(){var t=this._scriptInstance;if(this._scriptInstance=null,this.scriptName){var e=y.getDefinitionByName(this.scriptName,!1);e?this._scriptInstance=new e:console.warn("无法初始化脚本 "+this.scriptName),this.scriptInit=!1,t&&(y.getQualifiedClassName(t)===this.scriptName&&E.setValue(this._scriptInstance,t),t.component=null,t.dispose()),this._invalid=!1}},i.prototype._invalidateScriptInstance=function(){this._invalid=!0},i.prototype.update=function(){this.scriptInstance&&!this.scriptInit&&(this.scriptInstance.component=this,this.scriptInstance.init(),this.scriptInit=!0),this.scriptInstance&&this.scriptInstance.update()},i.prototype.dispose=function(){this.enabled=!1,this._scriptInstance&&(this._scriptInstance.component=null,this._scriptInstance.dispose(),this._scriptInstance=null),e.prototype.dispose.call(this),Z.off("asset.scriptChanged",this._invalidateScriptInstance,this)},Ci([C,N("_invalidateScriptInstance"),n({component:"OAVPick",componentParam:{accepttype:"file_script"}})],i.prototype,"scriptName",void 0),Ci([C],i.prototype,"scriptInstance",null),i=Ci([zi("Script/Script"),Ai()],i)}(Di),Br=function(t){function e(){var e=t.call(this)||this;return e._position=new ht,e._rotation=new ht,e._orientation=new jt,e._scale=new ht(1,1,1),e._matrix=new Nt,e._matrixInvalid=!1,e._rotationMatrix=new Nt,e._rotationMatrixInvalid=!1,e._localToWorldMatrix=new Nt,e._localToWorldMatrixInvalid=!1,e._ITlocalToWorldMatrix=new Nt,e._ITlocalToWorldMatrixInvalid=!1,e._worldToLocalMatrix=new Nt,e._worldToLocalMatrixInvalid=!1,e._localToWorldRotationMatrix=new Nt,e._localToWorldRotationMatrixInvalid=!1,e._renderAtomic=new Bn,k.watch(e._position,"x",e._positionChanged,e),k.watch(e._position,"y",e._positionChanged,e),k.watch(e._position,"z",e._positionChanged,e),k.watch(e._rotation,"x",e._rotationChanged,e),k.watch(e._rotation,"y",e._rotationChanged,e),k.watch(e._rotation,"z",e._rotationChanged,e),k.watch(e._scale,"x",e._scaleChanged,e),k.watch(e._scale,"y",e._scaleChanged,e),k.watch(e._scale,"z",e._scaleChanged,e),e._renderAtomic.uniforms.u_modelMatrix=function(){return e.localToWorldMatrix},e._renderAtomic.uniforms.u_ITModelMatrix=function(){return e.ITlocalToWorldMatrix},e}return Mi(e,t),Object.defineProperty(e.prototype,"single",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldPosition",{get:function(){return this.localToWorldMatrix.getPosition()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.gameObject.parent&&this.gameObject.parent.transform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._position.x},set:function(t){this._position.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._position.y},set:function(t){this._position.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._position.z},set:function(t){this._position.z=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rx",{get:function(){return this._rotation.x},set:function(t){this._rotation.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ry",{get:function(){return this._rotation.y},set:function(t){this._rotation.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rz",{get:function(){return this._rotation.z},set:function(t){this._rotation.z=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sx",{get:function(){return this._scale.x},set:function(t){this._scale.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sy",{get:function(){return this._scale.y},set:function(t){this._scale.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sz",{get:function(){return this._scale.z},set:function(t){this._scale.z=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(t){this._position.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"orientation",{get:function(){return this._orientation.fromMatrix(this.matrix),this._orientation},set:function(t){var e=t.toEulerAngles();e.scaleNumber(P.RAD2DEG),this.rotation=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"matrix",{get:function(){return this._matrixInvalid&&(this._matrixInvalid=!1,this._updateMatrix()),this._matrix},set:function(t){t.toTRS(this._position,this._rotation,this._scale),this._matrix.fromArray(t.elements),this._matrixInvalid=!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotationMatrix",{get:function(){return this._rotationMatrixInvalid&&(this._rotationMatrix.setRotation(this._rotation),this._rotationMatrixInvalid=!1),this._rotationMatrix},enumerable:!1,configurable:!0}),e.prototype.moveForward=function(t){this.translateLocal(ht.Z_AXIS,t)},e.prototype.moveBackward=function(t){this.translateLocal(ht.Z_AXIS,-t)},e.prototype.moveLeft=function(t){this.translateLocal(ht.X_AXIS,-t)},e.prototype.moveRight=function(t){this.translateLocal(ht.X_AXIS,t)},e.prototype.moveUp=function(t){this.translateLocal(ht.Y_AXIS,t)},e.prototype.moveDown=function(t){this.translateLocal(ht.Y_AXIS,-t)},e.prototype.translate=function(t,e){var n=t.x,i=t.y,r=t.z,o=e/Math.sqrt(n*n+i*i+r*r);this.x+=n*o,this.y+=i*o,this.z+=r*o},e.prototype.translateLocal=function(t,e){var n=t.x,i=t.y,r=t.z,o=e/Math.sqrt(n*n+i*i+r*r),a=this.matrix.clone();a.prependTranslation(n*o,i*o,r*o);var s=a.getPosition();this.x=s.x,this.y=s.y,this.z=s.z,this._invalidateSceneTransform()},e.prototype.pitch=function(t){this.rotate(ht.X_AXIS,t)},e.prototype.yaw=function(t){this.rotate(ht.Y_AXIS,t)},e.prototype.roll=function(t){this.rotate(ht.Z_AXIS,t)},e.prototype.rotateTo=function(t,e,n){this._rotation.set(t,e,n)},e.prototype.rotate=function(t,e,n){var i=Nt.fromPosition(this.position.x,this.position.y,this.position.z);i.appendRotation(t,e,n),this.position=i.getPosition();var r=Nt.fromRotation(this.rx,this.ry,this.rz);r.appendRotation(t,e,n);var o=r.toTRS()[1];Math.round((o.x-this.rx)/180)%2!=0&&(o.x+=180,o.y=180-o.y,o.z+=180);var a=function(t,e,n){return void 0===n&&(n=360),Math.round((e-t)/n)*n+t};o.x=a(o.x,this.rx),o.y=a(o.y,this.ry),o.z=a(o.z,this.rz),this.rotation=o,this._invalidateSceneTransform()},e.prototype.lookAt=function(t,e){this._updateMatrix(),this._matrix.lookAt(t,e),this._matrix.toTRS(this._position,this._rotation,this._scale),this._matrixInvalid=!1},Object.defineProperty(e.prototype,"localToWorldMatrix",{get:function(){return this._localToWorldMatrixInvalid&&(this._localToWorldMatrixInvalid=!1,this._updateLocalToWorldMatrix()),this._localToWorldMatrix},set:function(t){t=t.clone(),this.parent&&t.append(this.parent.worldToLocalMatrix),this.matrix=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ITlocalToWorldMatrix",{get:function(){return this._ITlocalToWorldMatrixInvalid&&(this._ITlocalToWorldMatrixInvalid=!1,this._ITlocalToWorldMatrix.copy(this.localToWorldMatrix),this._ITlocalToWorldMatrix.invert().transpose()),this._ITlocalToWorldMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldToLocalMatrix",{get:function(){return this._worldToLocalMatrixInvalid&&(this._worldToLocalMatrixInvalid=!1,this._worldToLocalMatrix.copy(this.localToWorldMatrix).invert()),this._worldToLocalMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localToWorldRotationMatrix",{get:function(){return this._localToWorldRotationMatrixInvalid&&(this._localToWorldRotationMatrix.copy(this.rotationMatrix),this.parent&&this._localToWorldRotationMatrix.append(this.parent.localToWorldRotationMatrix),this._localToWorldRotationMatrixInvalid=!1),this._localToWorldRotationMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldToLocalRotationMatrix",{get:function(){var t=this.localToWorldRotationMatrix.clone();return t.invert(),t},enumerable:!1,configurable:!0}),e.prototype.transformDirection=function(t){return t=this.localToWolrdDirection(t)},e.prototype.localToWolrdDirection=function(t){return this.parent?t=this.parent.localToWorldRotationMatrix.transformPoint3(t):t.clone()},e.prototype.localToWolrdBox=function(t,e){if(void 0===e&&(e=new Dt),!this.parent)return e.copy(t);var n=this.parent.localToWorldMatrix;return t.applyMatrixTo(n,e),e},e.prototype.transformPoint=function(t){return t=this.localToWorldPoint(t)},e.prototype.localToWorldPoint=function(t){return this.parent?t=this.parent.localToWorldMatrix.transformPoint3(t):t.clone()},e.prototype.transformVector=function(t){return t=this.localToWorldVector(t)},e.prototype.localToWorldVector=function(t){return this.parent?t=this.parent.localToWorldMatrix.transformVector3(t):t.clone()},e.prototype.inverseTransformDirection=function(t){return t=this.worldToLocalDirection(t)},e.prototype.worldToLocalDirection=function(t){return this.parent?t=this.parent.localToWorldRotationMatrix.clone().invert().transformPoint3(t):t.clone()},e.prototype.worldToLocalPoint=function(t,e){return void 0===e&&(e=new ht),this.parent?t=this.parent.worldToLocalMatrix.transformPoint3(t,e):e.copy(t)},e.prototype.worldToLocalVector=function(t){return this.parent?t=this.parent.worldToLocalMatrix.transformVector3(t):t.clone()},e.prototype.rayWorldToLocal=function(t,e){return void 0===e&&(e=new Rt),this.worldToLocalMatrix.transformRay(t,e),e},e.prototype.beforeRender=function(t,e,n){Object.assign(t.uniforms,this._renderAtomic.uniforms)},e.prototype._positionChanged=function(t,e,n,i){P.equals(t,e)||this._invalidateTransform()},e.prototype._rotationChanged=function(t,e,n,i){P.equals(t,e)||(this._invalidateTransform(),this._rotationMatrixInvalid=!0)},e.prototype._scaleChanged=function(t,e,n,i){P.equals(t,e)||this._invalidateTransform()},e.prototype._invalidateTransform=function(){this._matrixInvalid||(this._matrixInvalid=!0,this.emit("transformChanged",this),this._invalidateSceneTransform())},e.prototype._invalidateSceneTransform=function(){if(!this._localToWorldMatrixInvalid&&(this._localToWorldMatrixInvalid=!0,this._worldToLocalMatrixInvalid=!0,this._ITlocalToWorldMatrixInvalid=!0,this._localToWorldRotationMatrixInvalid=!0,this.emit("scenetransformChanged",this),this.gameObject))for(var t=0,e=this.gameObject.numChildren;t<e;t++)this.gameObject.getChildAt(t).transform._invalidateSceneTransform()},e.prototype._updateMatrix=function(){this._matrix.fromTRS(this._position,this._rotation,this._scale)},e.prototype._updateLocalToWorldMatrix=function(){this._localToWorldMatrix.copy(this.matrix),this.parent&&this._localToWorldMatrix.append(this.parent.localToWorldMatrix),this.emit("updateLocalToWorldMatrix",this),console.assert(!isNaN(this._localToWorldMatrix.elements[0]))},Ci([C],e.prototype,"x",null),Ci([C],e.prototype,"y",null),Ci([C],e.prototype,"z",null),Ci([C],e.prototype,"rx",null),Ci([C],e.prototype,"ry",null),Ci([C],e.prototype,"rz",null),Ci([C],e.prototype,"sx",null),Ci([C],e.prototype,"sy",null),Ci([C],e.prototype,"sz",null),Ci([n({tooltip:"本地位移"})],e.prototype,"position",null),Ci([n({tooltip:"本地旋转",component:"OAVVector3",componentParam:{step:.001,stepScale:30,stepDownup:30}})],e.prototype,"rotation",null),Ci([n({tooltip:"本地缩放"})],e.prototype,"scale",null),e=Ci([Ai()],e)}(Ei),Vr=function(e){function i(){var n=e.call(this)||this;return n.assetType=t.AssetType.gameobject,n._activeSelf=!0,n.mouseEnabled=!0,n._components=[],n._children=[],n._activeInHierarchy=!1,n._activeInHierarchyInvalid=!0,n.name="GameObject",n.addComponent(Br),n}return Mi(i,e),Object.defineProperty(i.prototype,"activeSelf",{get:function(){return this._activeSelf},set:function(t){this._activeSelf!==t&&(this._activeSelf=t,this._invalidateActiveInHierarchy())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activeInHierarchy",{get:function(){return this._activeInHierarchyInvalid&&(this._updateActiveInHierarchy(),this._activeInHierarchyInvalid=!1),this._activeInHierarchy},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"components",{get:function(){return this._components.concat()},set:function(t){if(t)for(var e=0,n=t.length;e<n;e++){var i=t[e];i&&(i.single&&this.removeComponentsByType(i.constructor),this.addComponentAt(t[e],this.numComponents))}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"numComponents",{get:function(){return this._components.length},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"transform",{get:function(){return this.getComponent(Br)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"boundingBox",{get:function(){return this._boundingBox||(this._boundingBox=new Wi(this)),this._boundingBox},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"children",{get:function(){return this._children.concat()},set:function(t){if(t){for(var e=this._children.length-1;e>=0;e--)this.removeChildAt(e);for(e=0;e<t.length;e++)this.addChild(t[e])}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"numChildren",{get:function(){return this._children.length},enumerable:!1,configurable:!0}),i.prototype.setActive=function(t){this.activeSelf=t},i.prototype.addComponent=function(t){var e=this,n=this.getComponent(t);return n&&Ei.isSingleComponent(t)||(Ei.getDependencies(t).forEach((function(t){e.addComponent(t)})),n=new t,this.addComponentAt(n,this._components.length)),n},i.prototype.getComponent=function(t){for(var e=0;e<this._components.length;e++)if(this._components[e]instanceof t)return this._components[e];return null},i.prototype.getComponentInChildren=function(t,e){void 0===e&&(e=!1);var n=this.getComponent(t);if(n)return n;for(var i=0;i<this.numChildren;i++){var r=this.children[i];if(e||r.activeSelf){var o=r.getComponentInChildren(t,e);if(o)return o}}return null},i.prototype.getComponentInParent=function(t,e){var n;if((void 0===e&&(e=!1),e||this.activeSelf)&&(n=this.getComponent(t)))return n;if(this.parent&&(n=this.parent.getComponentInParent(t,e)))return n;return null},i.prototype.getComponents=function(t,e){void 0===e&&(e=[]);for(var n=0;n<this._components.length;n++){var i=this._components[n];(!t||i instanceof t)&&e.push(i)}return e},i.prototype.getComponentsInChildren=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=[]),this.getComponents(t,n);for(var i=0;i<this.children.length;i++){var r=this.children[i];(e||r.activeSelf)&&r.getComponentsInChildren(t,e,n)}return n},i.prototype.getComponentsInParent=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=[]),(e||this.activeSelf)&&this.getComponents(t,n),this.parent&&this.parent.getComponentsInParent(t,e,n),n},i.prototype.getComponentAt=function(t){return console.assert(t<this.numComponents,"给出索引超出范围"),this._components[t]},i.prototype.setComponentIndex=function(t,e){console.assert(e>=0&&e<this.numComponents,"给出索引超出范围");var n=this._components.indexOf(t);console.assert(n>=0&&n<this.numComponents,"子组件不在容器内"),this._components.splice(n,1),this._components.splice(e,0,t)},i.prototype.setComponentAt=function(t,e){this._components[e]&&this.removeComponentAt(e),this.addComponentAt(t,e)},i.prototype.removeComponent=function(t){console.assert(this.hasComponent(t),"只能移除在容器中的组件");var e=this.getComponentIndex(t);this.removeComponentAt(e)},i.prototype.getComponentIndex=function(t){return console.assert(-1!==this._components.indexOf(t),"组件不在容器中"),this._components.indexOf(t)},i.prototype.removeComponentAt=function(t){console.assert(t>=0&&t<this.numComponents,"给出索引超出范围");var e=this._components.splice(t,1)[0];return this.emit("removeComponent",{component:e,gameobject:this},!0),e.dispose(),e},i.prototype.swapComponentsAt=function(t,e){console.assert(t>=0&&t<this.numComponents,"第一个子组件的索引位置超出范围"),console.assert(e>=0&&e<this.numComponents,"第二个子组件的索引位置超出范围");var n=this._components[t];this._components[t]=this._components[e],this._components[e]=n},i.prototype.swapComponents=function(t,e){console.assert(this.hasComponent(t),"第一个子组件不在容器中"),console.assert(this.hasComponent(e),"第二个子组件不在容器中"),this.swapComponentsAt(this.getComponentIndex(t),this.getComponentIndex(e))},i.prototype.removeComponentsByType=function(t){for(var e=[],n=this._components.length-1;n>=0;n--)this._components[n].constructor===t&&e.push(this.removeComponentAt(n));return e},i.prototype.hasComponent=function(t){return-1!==this._components.indexOf(t)},i.prototype.addComponentAt=function(t,e){if(t){if(console.assert(e>=0&&e<=this.numComponents,"给出索引超出范围"),this.hasComponent(t))return e=Math.min(e,this._components.length-1),void this.setComponentIndex(t,e);t.single&&this.removeComponentsByType(t.constructor),this._components.splice(e,0,t),t.setGameObject(this),t.init(),this.emit("addComponent",{component:t,gameobject:this},!0)}},i.prototype.find=function(t){if(this.name===t)return this;for(var e=0;e<this._children.length;e++){var n=this._children[e].find(t);if(n)return n}return null},i.prototype.addScript=function(t){var e=new kr;return e.scriptName=t,this.addComponentAt(e,this._components.length),e},i.prototype.contains=function(t){var e=t;do{if(e===this)return!0;e=e.parent}while(e);return!1},i.prototype.addChild=function(t){if(t){if(t.parent===this){var e=this._children.indexOf(t);-1!==e&&this._children.splice(e,1),this._children.push(t)}else{if(t.contains(this))return void console.error("无法添加到自身中!");t._parent&&t._parent.removeChild(t),t._setParent(this),this._children.push(t),t.emit("added",{parent:this}),this.emit("addChild",{child:t,parent:this},!0)}return t}},i.prototype.addChildren=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];for(var i in e){var r=e[i];this.addChild(r)}},i.prototype.remove=function(){this.parent&&this.parent.removeChild(this)},i.prototype.removeChildren=function(){for(var t=this.numChildren-1;t>=0;t--)this.removeChildAt(t)},i.prototype.removeChild=function(t){if(t){var e=this._children.indexOf(t);-1!==e&&this.removeChildInternal(e,t)}},i.prototype.removeChildAt=function(t){var e=this._children[t];return this.removeChildInternal(t,e)},i.prototype.getChildAt=function(t){return this._children[t]},i.prototype.getChildren=function(){return this._children.concat()},i.prototype.removeChildInternal=function(t,e){this._children.splice(t,1),e._setParent(null),e.emit("removed",{parent:this}),this.emit("removeChild",{child:e,parent:this},!0)},i.prototype.dispose=function(){this.parent&&this.parent.removeChild(this);for(var t=this._children.length-1;t>=0;t--)this.removeChildAt(t);for(t=this._components.length-1;t>=0;t--)this.removeComponentAt(t);e.prototype.dispose.call(this)},i.prototype.disposeWithChildren=function(){for(this.dispose();this.numChildren>0;)this.getChildAt(0).dispose()},Object.defineProperty(i.prototype,"isSelfLoaded",{get:function(){var t=this.getComponent(Fr);return!t||t.isLoaded},enumerable:!1,configurable:!0}),i.prototype.onSelfLoadCompleted=function(t){if(this.isSelfLoaded)t();else{var e=this.getComponent(Fr);e?e.onLoadCompleted(t):t()}},Object.defineProperty(i.prototype,"isLoaded",{get:function(){if(!this.isSelfLoaded)return!1;for(var t=0;t<this.children.length;t++){if(!this.children[t].isLoaded)return!1}return!0},enumerable:!1,configurable:!0}),i.prototype.onLoadCompleted=function(t){var e=0;this.isSelfLoaded||(e++,this.onSelfLoadCompleted((function(){0===--e&&t()})));for(var n=0;n<this.children.length;n++){var i=this.children[n];i.isLoaded||(e++,i.onLoadCompleted((function(){0===--e&&t()})))}0===e&&t()},i.find=function(t){return Ti.getObjects(i).filter((function(e){return!e.disposed&&e.name===t}))[0]},i.prototype._updateActiveInHierarchy=function(){var t=this.activeSelf;this.parent&&(t=t&&this.parent.activeInHierarchy),this._activeInHierarchy=t},i.prototype._invalidateActiveInHierarchy=function(){this._activeInHierarchyInvalid||(this._activeInHierarchyInvalid=!0,this._children.forEach((function(t){t._invalidateActiveInHierarchy()})))},i.prototype._setParent=function(t){this._parent=t,this.updateScene(),this.transform._invalidateSceneTransform()},i.prototype.updateScene=function(){var t=this._parent?this._parent._scene:null;this._scene!==t&&(this._scene&&this.emit("removedFromScene",this),this._scene=t,this._scene&&this.emit("addedToScene",this),this.updateChildrenScene())},i.prototype.updateChildrenScene=function(){for(var t=0,e=this._children.length;t<e;t++)this._children[t].updateScene()},i.prototype.getShareTargets=function(){return this.components},i.createPrimitive=function(t,e){var n=new i;n.name=t;var r=this._registerPrimitives[t];return r&&r(n),E.setValue(n,e),n},i.registerPrimitive=function(t,e){this._registerPrimitives[t]&&console.warn("重复注册原始游戏对象 "+t+" ！"),this._registerPrimitives[t]=e},i._registerPrimitives={},Ci([C,n({component:"OAVGameObjectName"})],i.prototype,"name",void 0),Ci([C],i.prototype,"activeSelf",null),Ci([C],i.prototype,"tag",void 0),Ci([C],i.prototype,"mouseEnabled",void 0),Ci([C,n({component:"OAVComponentList"})],i.prototype,"components",null),Ci([C],i.prototype,"prefabId",void 0),Ci([C],i.prototype,"assetId",void 0),Ci([C],i.prototype,"children",null),i}(Ti);Vi.push({path:"Create Empty",click:function(){return new Vr}});var Wr=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.joints=[],t.isInitJoints=!1,t}return Mi(i,e),Object.defineProperty(i.prototype,"globalMatrices",{get:function(){return this.isInitJoints||(this.initSkeleton(),this.isInitJoints=!0),this._globalPropertiesInvalid&&(this.updateGlobalProperties(),this._globalPropertiesInvalid=!1),this._globalMatrices},enumerable:!1,configurable:!0}),i.prototype.initSkeleton=function(){this.jointGameobjects=[],this.jointGameObjectMap={},this.createSkeletonGameObject(),this._globalPropertiesInvalid=!0,this._jointsInvalid=[],this._globalMatrixsInvalid=[],this.globalMatrixs=[],this._globalMatrices=[];for(var t=this.joints.length,e=0;e<t;e++)this._jointsInvalid[e]=!0,this._globalMatrixsInvalid[e]=!0,this.globalMatrixs[e]=new Nt,this._globalMatrices[e]=new Nt},i.prototype.updateGlobalProperties=function(){for(var t=this.joints,e=this.jointGameobjects,n=this.globalMatrixs,i=this._globalMatrixsInvalid,r=0;r<t.length;++r)this._jointsInvalid[r]&&(this._globalMatrices[r].copy(o(r)).prepend(t[r].invertMatrix),this._jointsInvalid[r]=!1);function o(r){if(!i[r])return n[r];var a=t[r],s=e[r];if(n[r]=s.transform.matrix.clone(),a.parentIndex>=0){var u=o(a.parentIndex);n[r].append(u)}return i[r]=!1,n[r]}},i.prototype.invalidjoint=function(t){var e=this;this._globalPropertiesInvalid=!0,this._jointsInvalid[t]=!0,this._globalMatrixsInvalid[t]=!0,this.joints[t].children.forEach((function(t){e.invalidjoint(t)}))},i.prototype.createSkeletonGameObject=function(){for(var e=this,n=e.joints,i=this.jointGameobjects,r=this.jointGameObjectMap,o=0;o<n.length;o++)a(o);function a(o){if(i[o])return i[o].gameObject;var s,u=n[o];-1!==u.parentIndex?(s=a(u.parentIndex),n[u.parentIndex].children.push(o)):s=e.gameObject;var c=s.find(u.name);c||(c=E.setValue(new Vr,{name:u.name,hideFlags:t.HideFlags.DontSave}),s.addChild(c));var l=c.transform,h=u.matrix;return-1!==u.parentIndex&&(h=h.clone().append(n[u.parentIndex].invertMatrix)),l.matrix=h,l.on("transformChanged",(function(){e.invalidjoint(o)})),i[o]=l,r[u.name]=l,c}},Ci([C,n()],i.prototype,"joints",void 0),i=Ci([Ai()],i)}(Ei),Ur=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.cacheU_skeletonGlobalMatriices={},t}return Mi(i,e),Object.defineProperty(i.prototype,"single",{get:function(){return!0},enumerable:!1,configurable:!0}),i.prototype.init=function(){e.prototype.init.call(this),this.hideFlags=t.HideFlags.DontTransform},i.prototype.beforeRender=function(t,n,i){var r=this;e.prototype.beforeRender.call(this,t,n,i);var o=null,a=this.getComponentsInParent(Fi)[0];a&&(o=a.clipName+"&"+a.frame),t.uniforms.u_modelMatrix=function(){return r.u_modelMatrix},t.uniforms.u_ITModelMatrix=function(){return r.u_ITModelMatrix};var s=this.cacheU_skeletonGlobalMatriices[o];s=this.u_skeletonGlobalMatriices,o&&(this.cacheU_skeletonGlobalMatriices[o]=s),t.uniforms.u_skeletonGlobalMatriices=s,t.shaderMacro.HAS_SKELETON_ANIMATION=!0,t.shaderMacro.NUM_SKELETONJOINT=this.skinSkeleton.joints.length},i.prototype.dispose=function(){this.cacheSkeletonComponent=null,e.prototype.dispose.call(this)},Object.defineProperty(i.prototype,"u_modelMatrix",{get:function(){return this.cacheSkeletonComponent?this.cacheSkeletonComponent.transform.localToWorldMatrix:this.transform.localToWorldMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"u_ITModelMatrix",{get:function(){return this.cacheSkeletonComponent?this.cacheSkeletonComponent.transform.ITlocalToWorldMatrix:this.transform.ITlocalToWorldMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"u_skeletonGlobalMatriices",{get:function(){if(!this.cacheSkeletonComponent){for(var t=this.gameObject,e=null;t&&!e;)e=t.getComponent(Wr),t=t.parent;this.cacheSkeletonComponent=e}var n=[];if(this.skinSkeleton&&this.cacheSkeletonComponent)for(var i=this.skinSkeleton.joints,r=this.cacheSkeletonComponent.globalMatrices,o=i.length-1;o>=0;o--)n[o]=r[i[o][0]].clone(),this.initMatrix&&n[o].prepend(this.initMatrix);else n=Gr;return n},enumerable:!1,configurable:!0}),Ci([C,n()],i.prototype,"skinSkeleton",void 0),Ci([C],i.prototype,"initMatrix",void 0),i=Ci([Ai()],i)}(Fr),Gr=function(){for(var t=[new Nt],e=150;e-- >1;)t.push(t[0]);return t}(),Hr=function(){function t(){this.joints=[],this.numJoint=0}return Ci([C],t.prototype,"joints",void 0),Ci([C],t.prototype,"numJoint",void 0),t}(),Kr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cache_map={},e}return Mi(e,t),e.prototype.resetJointIndices=function(t,e){for(var n=t.length,i=0;i<n;i++)void 0===this.cache_map[t[i]]&&(this.cache_map[t[i]]=this.numJoint++),t[i]=this.cache_map[t[i]];for(var r in this.joints.length=0,this.cache_map)this.cache_map.hasOwnProperty(r)&&(this.joints[this.cache_map[r]]=[parseInt(r,10),e.joints[r].name])},e}(Hr),Xr=function(t){function e(e){var n=t.call(this,e)||this;return n.laterSaveFunc=function(t){n.save()},n.laterSave=function(){cr.nextframe(n.laterSaveFunc,n)},n}return Mi(e,t),e.prototype.save=function(t){var e=this.getAllAssets(),n=E.serialize(e);this.fs.writeObject(this.resources,n,t)},e.prototype.createAsset=function(e,n,i,r,o){var a=this;t.prototype.createAsset.call(this,e,n,i,r,(function(t,e){e?a.writeAsset(e,(function(t){o&&o(t,e),a.laterSave()})):o&&o(t,null)}))},e.prototype.writeAsset=function(t,e){t.write(e)},e.prototype.moveAsset=function(t,e,n){var i=this,r=t.fileName+t.extenson;if(-1===e.childrenAssets.map((function(t){return t.fileName+t.extenson})).indexOf(r)){for(var o=e;o;){if(o===t)return void(n&&n(new Error("无法移动达到子文件夹中")));o=o.parentAsset}for(var a=[t],s=0;s<a.length;){var u=a[s];u instanceof xr&&(a=a.concat(u.childrenAssets)),s++}var c=function(){if(0===a.length)return n&&n(null),void i.laterSave();var t=a.pop();i.readAsset(t.assetId,(function(e,r){e?n&&n(e):i.deleteAsset(t,(function(e){if(e)n&&n(e);else{for(var r=t.fileName+t.extenson,o=t.parentAsset;o;)r=o.fileName+"/"+r,o=o.parentAsset;t.assetPath=r,i.addAsset(t),i.writeAsset(t,(function(t){t?n&&n(t):c()}))}}))}))};c()}else n&&n(new Error("目标文件夹中存在同名文件（夹），无法移动"))},e.prototype.deleteAsset=function(t,e){for(var n=this,i=[t],r=0;r<i.length;){var o=i[r];o instanceof xr&&(i=i.concat(o.childrenAssets)),r++}var a=function(){if(0===i.length)return e&&e(null),void n.laterSave();var t=i.pop();t.delete((function(){Sr.deleteAssetData(t.data),a()}))};a()},e}(wr);t.audioCtx=void 0,t.globalGain=void 0;var qr,Yr=function(e){function i(){var n=e.call(this)||this;return n.enabled=!0,n._volume=1,n.gain=t.audioCtx.createGain(),n.gain.connect(t.audioCtx.destination),n._enabledChanged(),n}return Mi(i,e),Object.defineProperty(i.prototype,"volume",{get:function(){return this._volume},set:function(e){this._volume=e,this.gain.gain.setTargetAtTime(e,t.audioCtx.currentTime,.01)},enumerable:!1,configurable:!0}),i.prototype.init=function(){e.prototype.init.call(this),this.on("scenetransformChanged",this._onScenetransformChanged,this),this._onScenetransformChanged()},i.prototype._onScenetransformChanged=function(){var e=this.transform.localToWorldMatrix,n=e.getPosition(),i=e.getAxisZ(),r=e.getAxisY(),o=t.audioCtx.listener;o.forwardX?(o.positionX.setValueAtTime(n.x,t.audioCtx.currentTime),o.positionY.setValueAtTime(n.y,t.audioCtx.currentTime),o.positionZ.setValueAtTime(-n.z,t.audioCtx.currentTime),o.forwardX.setValueAtTime(i.x,t.audioCtx.currentTime),o.forwardY.setValueAtTime(i.y,t.audioCtx.currentTime),o.forwardZ.setValueAtTime(-i.z,t.audioCtx.currentTime),o.upX.setValueAtTime(r.x,t.audioCtx.currentTime),o.upY.setValueAtTime(r.y,t.audioCtx.currentTime),o.upZ.setValueAtTime(-r.z,t.audioCtx.currentTime)):(o.setOrientation(i.x,i.y,-i.z,r.x,r.y,-r.z),o.setPosition(n.x,n.y,-n.z))},i.prototype._enabledChanged=function(){this.gain&&(this.enabled?t.globalGain.connect(this.gain):t.globalGain.disconnect(this.gain))},i.prototype.dispose=function(){this.off("scenetransformChanged",this._onScenetransformChanged,this),e.prototype.dispose.call(this)},Ci([N("_enabledChanged")],i.prototype,"enabled",void 0),Ci([C,n({tooltip:"音量"})],i.prototype,"volume",null),i=Ci([zi("Audio/AudioListener"),Ai()],i)}(Di);!function(){if("undefined"!=typeof window){window.AudioContext=window.AudioContext||window.webkitAudioContext,t.audioCtx=new AudioContext,t.globalGain=t.audioCtx.createGain();var e=t.audioCtx.createGain();e.connect(t.audioCtx.destination),t.globalGain.connect(e),e.gain.setTargetAtTime(0,t.audioCtx.currentTime,.01);var n=t.audioCtx.listener;t.audioCtx.createGain(),n.forwardX?(n.forwardX.value=0,n.forwardY.value=0,n.forwardZ.value=-1,n.upX.value=0,n.upY.value=1,n.upZ.value=0):n.setOrientation(0,0,-1,0,1,0)}}(),t.DistanceModelType=void 0,(qr=t.DistanceModelType||(t.DistanceModelType={})).linear="linear",qr.inverse="inverse",qr.exponential="exponential";var Zr,Qr=function(e){function i(){var n=e.call(this)||this;return n.enabled=!0,n.url="",n._loop=!0,n._enablePosition=!0,n.panner=function(){var e=this.panner=t.audioCtx.createPanner();e.orientationX?(e.orientationX.value=1,e.orientationY.value=0,e.orientationZ.value=0):e.setOrientation(1,0,0);return e}(),n.panningModel="HRTF",n.distanceModel=t.DistanceModelType.inverse,n.refDistance=1,n.maxDistance=1e4,n.rolloffFactor=1,n.coneInnerAngle=360,n.coneOuterAngle=0,n.coneOuterGain=0,n.gain=t.audioCtx.createGain(),n.volume=1,n._enabledChanged(),n._connect(),n}return Mi(i,e),Object.defineProperty(i.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this.source&&(this.source.loop=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"volume",{get:function(){return this._volume},set:function(e){this._volume=e,this.gain.gain.setTargetAtTime(e,t.audioCtx.currentTime,.01)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"enablePosition",{get:function(){return this._enablePosition},set:function(t){this._disconnect(),this._enablePosition=t,this._connect()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"coneInnerAngle",{get:function(){return this._coneInnerAngle},set:function(t){this._coneInnerAngle=t,this.panner.coneInnerAngle=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"coneOuterAngle",{get:function(){return this._coneOuterAngle},set:function(t){this._coneOuterAngle=t,this.panner.coneOuterAngle=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"coneOuterGain",{get:function(){return this._coneOuterGain},set:function(t){this._coneOuterGain=t,this.panner.coneOuterGain=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"distanceModel",{get:function(){return this._distanceModel},set:function(t){this._distanceModel=t,this.panner.distanceModel=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maxDistance",{get:function(){return this._maxDistance},set:function(t){this._maxDistance=t,this.panner.maxDistance=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"panningModel",{get:function(){return this._panningModel},set:function(t){this._panningModel=t,this.panner.panningModel=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"refDistance",{get:function(){return this._refDistance},set:function(t){this._refDistance=t,this.panner.refDistance=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rolloffFactor",{get:function(){return this._rolloffFactor},set:function(t){this._rolloffFactor=t,this.panner.rolloffFactor=t},enumerable:!1,configurable:!0}),i.prototype.init=function(){e.prototype.init.call(this),this.on("scenetransformChanged",this._onScenetransformChanged,this)},i.prototype.play=function(){this.stop(),this.buffer&&(this.source=t.audioCtx.createBufferSource(),this.source.buffer=this.buffer,this._connect(),this.source.loop=this.loop,this.source.start(0))},i.prototype.stop=function(){this.source&&(this.source.stop(0),this._disconnect(),this.source=null)},i.prototype._onScenetransformChanged=function(){var t=this.transform.localToWorldMatrix.getPosition(),e=this.panner;e.orientationX?(e.positionX.value=t.x,e.positionY.value=t.y,e.positionZ.value=-t.z,e.orientationX.value=1,e.orientationY.value=0,e.orientationZ.value=0):(e.setPosition(t.x,t.y,-t.z),e.setOrientation(1,0,0))},i.prototype._onUrlChanged=function(){var e=this;if(this.stop(),this.url){var n=this.url;Jn.fs.readArrayBuffer(this.url,(function(i,r){i?console.warn(i):n===e.url&&t.audioCtx.decodeAudioData(r,(function(t){e.buffer=t}))}))}},i.prototype._connect=function(){for(var t=this._getAudioNodes(),e=0;e<t.length-1;e++)t[e+1].connect(t[e])},i.prototype._disconnect=function(){for(var t=this._getAudioNodes(),e=0;e<t.length-1;e++)t[e+1].disconnect(t[e])},i.prototype._getAudioNodes=function(){var t=[];return t.push(this.gain),this._enablePosition&&t.push(this.panner),this.source&&t.push(this.source),t},i.prototype._enabledChanged=function(){this.gain&&(this.enabled?this.gain.connect(t.globalGain):this.gain.disconnect(t.globalGain))},i.prototype.dispose=function(){this.off("scenetransformChanged",this._onScenetransformChanged,this),this._disconnect(),e.prototype.dispose.call(this)},Ci([N("_enabledChanged")],i.prototype,"enabled",void 0),Ci([C,n({component:"OAVPick",tooltip:"声音文件路径",componentParam:{accepttype:"audio"}}),N("_onUrlChanged")],i.prototype,"url",void 0),Ci([C,n({tooltip:"是否循环播放"})],i.prototype,"loop",null),Ci([C,n({tooltip:"音量"})],i.prototype,"volume",null),Ci([C,n({tooltip:"是否启用位置影响声音"})],i.prototype,"enablePosition",null),Ci([C,n({component:"OAVEnum",tooltip:"距离模式，距离影响声音的方式",componentParam:{enumClass:t.DistanceModelType}})],i.prototype,"distanceModel",null),Ci([C,n({tooltip:"表示音频源和收听者之间的最大距离，之后音量不会再降低。该值仅由linear距离模型使用。默认值是10000。"})],i.prototype,"maxDistance",null),Ci([C,n({tooltip:"表示随着音频源远离收听者而减小音量的参考距离。此值由所有距离模型使用。默认值是1。"})],i.prototype,"refDistance",null),Ci([C,n({tooltip:"描述了音源离开收听者音量降低的速度。此值由所有距离模型使用。默认值是1。"})],i.prototype,"rolloffFactor",null),Ci([n()],i.prototype,"play",null),Ci([n()],i.prototype,"stop",null),i=Ci([zi("Audio/AudioSource"),Ai()],i)}(Di);t.Projection=void 0,(Zr=t.Projection||(t.Projection={}))[Zr.Perspective=0]="Perspective",Zr[Zr.Orthographic=1]="Orthographic";var Jr=function(t){function e(e,n,i){void 0===e&&(e=1),void 0===n&&(n=.3),void 0===i&&(i=1e3);var r=t.call(this)||this;return r._inverseMatrix=new Nt,r._invertMatrixInvalid=!0,r._matrix=new Nt,r._matrixInvalid=!0,r.aspect=e,r.near=n,r.far=i,r}return Mi(e,t),Object.defineProperty(e.prototype,"projectionType",{get:function(){return this._projectionType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"matrix",{get:function(){return this._matrixInvalid&&(this._updateMatrix(),this._matrixInvalid=!1),this._matrix},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inverseMatrix",{get:function(){return this._invertMatrixInvalid&&(this._updateInverseMatrix(),this._invertMatrixInvalid=!1),this._inverseMatrix},enumerable:!1,configurable:!0}),e.prototype.project=function(t,e){return void 0===e&&(e=new ht),this.matrix.transformVector4(dt.fromVector3(t,1)).toVector3(e),e},e.prototype.unproject=function(t,e){return void 0===e&&(e=new ht),this.inverseMatrix.transformVector4(dt.fromVector3(t,1)).toVector3(e),e},e.prototype.unprojectRay=function(t,e,n){void 0===n&&(n=new Rt);var i=this.unproject(new ht(t,e,0)),r=this.unproject(new ht(t,e,1));n.fromPosAndDir(i,r.sub(i));var o=n.getPointWithZ(0);return n.origin=o,n},e.prototype.unprojectWithDepth=function(t,e,n,i){return void 0===i&&(i=new ht),this.unprojectRay(t,e).getPointWithZ(n,i)},e.prototype.invalidate=function(){console.assert(!isNaN(this.aspect)),this._matrixInvalid=!0,this._invertMatrixInvalid=!0,this.emit("lensChanged",this)},e.prototype._updateInverseMatrix=function(){this._inverseMatrix.copy(this.matrix),this._inverseMatrix.invert()},Ci([C,n(),N("invalidate")],e.prototype,"near",void 0),Ci([N("invalidate"),C,n()],e.prototype,"far",void 0),Ci([N("invalidate")],e.prototype,"aspect",void 0),e}(Ti),$r=function(e){function i(n,i,r,o){void 0===n&&(n=1),void 0===i&&(i=1),void 0===r&&(r=.3),void 0===o&&(o=1e3);var a=e.call(this,i,r,o)||this;return a._projectionType=t.Projection.Orthographic,a.size=n,a}return Mi(i,e),i.prototype._updateMatrix=function(){this._matrix.setOrtho(-this.size,this.size,this.size,-this.size,this.near,this.far)},i.prototype.clone=function(){return new i(this.size,this.aspect,this.near,this.far)},Ci([C,n(),N("invalidate")],i.prototype,"size",void 0),i}(Jr),to=function(e){function i(n,i,r,o){void 0===n&&(n=60),void 0===i&&(i=1),void 0===r&&(r=.3),void 0===o&&(o=1e3);var a=e.call(this,i,r,o)||this;return a._projectionType=t.Projection.Perspective,a.fov=n,a}return Mi(i,e),Object.defineProperty(i.prototype,"focalLength",{get:function(){return 1/Math.tan(this.fov*Math.PI/360)},set:function(t){this.fov=360*Math.atan(1/t)/Math.PI},enumerable:!1,configurable:!0}),i.prototype.project=function(t,e){void 0===e&&(e=new ht);var n=this.matrix.transformVector4(dt.fromVector3(t,1));return n.scale(1/n.w),n.toVector3(e),e},i.prototype.unproject=function(t,e){void 0===e&&(e=new ht);var n=dt.fromVector3(t,1),i=1/this.inverseMatrix.transformVector4(n).w,r=n.scaleTo(i);return this.inverseMatrix.transformVector4(r).toVector3(e),e},i.prototype._updateMatrix=function(){this._matrix.setPerspectiveFromFOV(this.fov,this.aspect,this.near,this.far)},i.prototype.clone=function(){return new i(this.fov,this.aspect,this.near,this.far)},Ci([N("invalidate"),C,n()],i.prototype,"fov",void 0),i}(Jr),eo=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._viewProjection=new Nt,t._viewProjectionInvalid=!0,t._backups={fov:60,size:1},t._frustum=new kt,t._frustumInvalid=!0,t}return Mi(i,e),Object.defineProperty(i.prototype,"single",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"projection",{get:function(){return this.lens&&this.lens.projectionType},set:function(e){if(this.projection!==e){var n=1,i=.3,r=1e3;this.lens&&(n=this.lens.aspect,i=this.lens.near,r=this.lens.far,E.setValue(this._backups,this.lens));var o=this._backups?this._backups.fov:60,a=this._backups?this._backups.size:1;e===t.Projection.Perspective?this.lens=new to(o,n,i,r):this.lens=new $r(a,n,i,r)}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lens",{get:function(){return this._lens},set:function(t){this._lens!==t&&(this._lens&&this._lens.off("lensChanged",this.invalidateViewProjection,this),this._lens=t,this._lens&&this._lens.on("lensChanged",this.invalidateViewProjection,this),this.invalidateViewProjection(),this.emit("refreshView"),this.emit("lensChanged"))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"viewProjection",{get:function(){return this._viewProjectionInvalid&&(this._viewProjection.copy(this.transform.worldToLocalMatrix),this._viewProjection.append(this.lens.matrix),this._viewProjectionInvalid=!1),this._viewProjection},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"frustum",{get:function(){return this._frustumInvalid&&(this._frustum.fromMatrix(this.viewProjection),this._frustumInvalid=!1),this._frustum},enumerable:!1,configurable:!0}),i.prototype.init=function(){e.prototype.init.call(this),this.lens=this.lens||new to,this.on("scenetransformChanged",this.invalidateViewProjection,this),this.invalidateViewProjection()},i.prototype.getRay3D=function(t,e,n){return void 0===n&&(n=new Rt),this.lens.unprojectRay(t,e,n).applyMatri4x4(this.transform.localToWorldMatrix)},i.prototype.project=function(t){return this.lens.project(this.transform.worldToLocalMatrix.transformPoint3(t))},i.prototype.unproject=function(t,e,n,i){return void 0===i&&(i=new ht),this.transform.localToWorldMatrix.transformPoint3(this.lens.unprojectWithDepth(t,e,n,i),i)},i.prototype.getScaleByDepth=function(t,e){void 0===e&&(e=new lt(0,1));var n=this.unproject(-.5*e.x,-.5*e.y,t),i=this.unproject(.5*e.x,.5*e.y,t);return n.subTo(i).length},i.prototype.invalidateViewProjection=function(){this._viewProjectionInvalid=!0,this._frustumInvalid=!0},Ci([n({component:"OAVEnum",componentParam:{enumClass:t.Projection}})],i.prototype,"projection",null),Ci([C,n({component:"OAVObjectView"})],i.prototype,"lens",null),i=Ci([zi("Rendering/Camera"),Ai()],i)}(Ei);Vr.registerPrimitive("Camera",(function(t){t.addComponent(eo)})),Vi.push({path:"Camera",priority:-2,click:function(){return Vr.createPrimitive("Camera")}});var no=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Mi(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.transform.on("updateLocalToWorldMatrix",this._onUpdateLocalToWorldMatrix,this),this._invalidHoldSizeMatrix()},e.prototype._onCameraChanged=function(t,e,n){e&&e.off("scenetransformChanged",this._invalidHoldSizeMatrix,this),n&&n.on("scenetransformChanged",this._invalidHoldSizeMatrix,this),this._invalidHoldSizeMatrix()},e.prototype._invalidHoldSizeMatrix=function(){this._gameObject&&this.transform._invalidateSceneTransform()},e.prototype._onUpdateLocalToWorldMatrix=function(){var t=this.transform._localToWorldMatrix;if(t&&this.camera){var e=this.camera,n=e.transform.worldPosition,i=e.transform.localToWorldMatrix.getAxisY();t.lookAt(n,i)}},e.prototype.dispose=function(){this.camera=null,this.transform.off("updateLocalToWorldMatrix",this._onUpdateLocalToWorldMatrix,this),t.prototype.dispose.call(this)},Ci([n(),N("_onCameraChanged")],e.prototype,"camera",void 0),e=Ci([zi("Layout/BillboardComponent"),Ai()],e)}(Ei),io=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.outlineSize=1,e.outlineColor=new yt(.2,.2,.2,1),e.outlineMorphFactor=0,e.diffuseSegment=new dt(.1,.3,.6,1),e.diffuseSegmentValue=new dt(.1,.3,.6,1),e.specularSegment=.5,e._cartoon_Anti_aliasing=!1,e}return Mi(e,t),Object.defineProperty(e.prototype,"cartoon_Anti_aliasing",{get:function(){return this._cartoon_Anti_aliasing},set:function(t){this._cartoon_Anti_aliasing=t},enumerable:!1,configurable:!0}),e.prototype.beforeRender=function(t,e,n){t.uniforms.u_diffuseSegment=this.diffuseSegment,t.uniforms.u_diffuseSegmentValue=this.diffuseSegmentValue,t.uniforms.u_specularSegment=this.specularSegment,t.uniforms.u_outlineSize=this.outlineSize,t.uniforms.u_outlineColor=this.outlineColor,t.uniforms.u_outlineMorphFactor=this.outlineMorphFactor},Ci([n(),C],e.prototype,"outlineSize",void 0),Ci([n(),C],e.prototype,"outlineColor",void 0),Ci([n(),C],e.prototype,"outlineMorphFactor",void 0),Ci([n(),C],e.prototype,"diffuseSegment",void 0),Ci([n(),C],e.prototype,"diffuseSegmentValue",void 0),Ci([n(),C],e.prototype,"specularSegment",void 0),Ci([n(),C],e.prototype,"cartoon_Anti_aliasing",null),e=Ci([zi("Rendering/CartoonComponent"),Ai()],e)}(Ei),ro=function(t){function e(){var e=t.call(this)||this;return e.canvas=document.createElement("canvas"),e.canvas.width=e.width,e.canvas.height=e.height,e.context2D=e.canvas.getContext("2d"),oo(e.context2D),e}return Mi(e,t),e.prototype.draw=function(t,e,n){var i=this,r=document.createElement("canvas");return r.width=t,r.height=e,n(r.getContext("2d")),x.canvasToImage(r,"png",1,(function(t){i.image=t})),this},e}(Ei);function oo(t,e){void 0===e&&(e=["rect"]),e.forEach((function(e){var n=t[e];t[e]=function(){for(var e=arguments,i=[],r=0;r<arguments.length;r++)i[r]=e[r];n.apply(t,i),t.__changed=!0}}))}var ao=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.holdSize=1,e}return Mi(e,t),e.prototype.init=function(){this.transform.on("updateLocalToWorldMatrix",this._onUpdateLocalToWorldMatrix,this)},e.prototype.dispose=function(){this.camera=null,this.transform.off("updateLocalToWorldMatrix",this._onUpdateLocalToWorldMatrix,this),t.prototype.dispose.call(this)},e.prototype._onCameraChanged=function(t,e,n){e&&e.off("scenetransformChanged",this._invalidateSceneTransform,this),n&&n.on("scenetransformChanged",this._invalidateSceneTransform,this),this._invalidateSceneTransform()},e.prototype._invalidateSceneTransform=function(){this._gameObject&&this.transform._invalidateSceneTransform()},e.prototype._onUpdateLocalToWorldMatrix=function(){var t=this.transform._localToWorldMatrix;if(this.holdSize&&this.camera&&t){var e=this._getDepthScale(this.camera),n=t.toTRS();n[2].scaleNumber(e*this.holdSize),t.fromTRS(n[0],n[1],n[2]),console.assert(!isNaN(t.elements[0]))}},e.prototype._getDepthScale=function(t){var e=t.transform.localToWorldMatrix,n=this.transform.worldPosition.subTo(e.getPosition());0===n.length&&(n.x=1);var i=n.dot(e.getAxisZ()),r=t.getScaleByDepth(i);return r=Math.max(Math.min(100,r),.01)},Ci([n(),N("_invalidateSceneTransform")],e.prototype,"holdSize",void 0),Ci([n(),N("_onCameraChanged")],e.prototype,"camera",void 0),e=Ci([zi("Layout/HoldSizeComponent"),Ai()],e)}(Ei),so=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.size=1,e.color=new yt(.2,.2,.2,1),e.outlineMorphFactor=0,e}return Mi(e,t),e.prototype.beforeRender=function(t,e,n){t.uniforms.u_outlineSize=this.size,t.uniforms.u_outlineColor=this.color,t.uniforms.u_outlineMorphFactor=this.outlineMorphFactor},Ci([n(),C],e.prototype,"size",void 0),Ci([n(),C],e.prototype,"color",void 0),Ci([n(),C],e.prototype,"outlineMorphFactor",void 0),e=Ci([zi("Rendering/OutLineComponent"),Ai()],e)}(Ei),uo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.color=new yt(125/255,176/255,250/255),e}return Mi(e,t),Ci([n()],e.prototype,"color",void 0),e=Ci([Ai()],e)}(Ei),co=function(){function t(t){this.targetObject=t}return t.prototype.update=function(t){throw new Error("Abstract method")},Object.defineProperty(t.prototype,"targetObject",{get:function(){return this._targetObject},set:function(t){this._targetObject=t},enumerable:!1,configurable:!0}),t}(),lo=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.acceleration=.001,n.runEnvironment=t.RunEnvironment.feng3d,n.ischange=!1,n}return Mi(i,e),Object.defineProperty(i.prototype,"auto",{get:function(){return this._auto},set:function(t){this._auto!==t&&(this._auto&&(bi.off("mousedown",this.onMousedown,this),bi.off("mouseup",this.onMouseup,this),this.onMouseup()),this._auto=t,this._auto&&(bi.on("mousedown",this.onMousedown,this),bi.on("mouseup",this.onMouseup,this)))},enumerable:!1,configurable:!0}),i.prototype.init=function(){e.prototype.init.call(this),this.keyDirectionDic={},this.keyDirectionDic.a=new ht(-1,0,0),this.keyDirectionDic.d=new ht(1,0,0),this.keyDirectionDic.w=new ht(0,0,1),this.keyDirectionDic.s=new ht(0,0,-1),this.keyDirectionDic.e=new ht(0,1,0),this.keyDirectionDic.q=new ht(0,-1,0),this.keyDownDic={},this.auto=!0},i.prototype.onMousedown=function(){this.ischange=!0,this.preMousePoint=null,this.mousePoint=null,this.velocity=new ht,this.keyDownDic={},bi.on("keydown",this.onKeydown,this),bi.on("keyup",this.onKeyup,this),bi.on("mousemove",this.onMouseMove,this)},i.prototype.onMouseup=function(){this.ischange=!1,this.preMousePoint=null,this.mousePoint=null,bi.off("keydown",this.onKeydown,this),bi.off("keyup",this.onKeyup,this),bi.off("mousemove",this.onMouseMove,this)},i.prototype.dispose=function(){this.auto=!1},i.prototype.update=function(){if(this.ischange){if(this.mousePoint&&this.preMousePoint){var t=this.mousePoint.subTo(this.preMousePoint);t.x*=.15,t.y*=.15;var e=this.transform.localToWorldMatrix;e.appendRotation(e.getAxisX(),t.y,e.getPosition());var n=ht.Y_AXIS.clone();e.getAxisY().dot(n)<0&&n.scaleNumber(-1),e.appendRotation(n,t.x,e.getPosition()),this.transform.localToWorldMatrix=e,this.preMousePoint=this.mousePoint,this.mousePoint=null}var i=new ht;for(var r in this.keyDirectionDic)if(!0===this.keyDownDic[r]){var o=this.keyDirectionDic[r];i.add(o)}i.scaleNumber(this.acceleration),this.velocity.add(i);var a=this.transform.matrix.getAxisX(),s=this.transform.matrix.getAxisY(),u=this.transform.matrix.getAxisZ();a.scaleNumber(this.velocity.x),s.scaleNumber(this.velocity.y),u.scaleNumber(this.velocity.z);var c=a.clone();c.add(s),c.add(u),this.transform.x+=c.x,this.transform.y+=c.y,this.transform.z+=c.z}},i.prototype.onMouseMove=function(t){this.mousePoint=new lt(t.data.clientX,t.data.clientY),this.preMousePoint||(this.preMousePoint=this.mousePoint,this.mousePoint=null)},i.prototype.onKeydown=function(t){var e=String.fromCharCode(t.data.keyCode).toLocaleLowerCase();this.keyDirectionDic[e]&&(this.keyDownDic[e]||this.stopDirectionVelocity(this.keyDirectionDic[e]),this.keyDownDic[e]=!0)},i.prototype.onKeyup=function(t){var e=String.fromCharCode(t.data.keyCode).toLocaleLowerCase();this.keyDirectionDic[e]&&(this.keyDownDic[e]=!1,this.stopDirectionVelocity(this.keyDirectionDic[e]))},i.prototype.stopDirectionVelocity=function(t){t&&(0!==t.x&&(this.velocity.x=0),0!==t.y&&(this.velocity.y=0),0!==t.z&&(this.velocity.z=0))},Ci([n()],i.prototype,"acceleration",void 0),i=Ci([zi("Controller/FPSController"),Ai()],i)}(Di),ho=function(t){function e(e,n){var i=t.call(this,e)||this;return i._origin=new ht(0,0,0),i._upAxis=ht.Y_AXIS,i._pos=new ht,n?i.lookAtObject=n:i.lookAtPosition=new ht,i}return Mi(e,t),Object.defineProperty(e.prototype,"upAxis",{get:function(){return this._upAxis},set:function(t){this._upAxis=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lookAtPosition",{get:function(){return this._lookAtPosition},set:function(t){this._lookAtPosition=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lookAtObject",{get:function(){return this._lookAtObject},set:function(t){this._lookAtObject!==t&&(this._lookAtObject=t)},enumerable:!1,configurable:!0}),e.prototype.update=function(t){this._targetObject&&(this._lookAtPosition?this._targetObject.transform.lookAt(this.lookAtPosition,this._upAxis):this._lookAtObject&&(this._pos=this._lookAtObject.transform.position,this._targetObject.transform.lookAt(this._pos,this._upAxis)))},e}(co),po=function(t){function e(e,n,i,r,o,a,s,u,c,l,h,p){void 0===i&&(i=0),void 0===r&&(r=90),void 0===o&&(o=1e3),void 0===a&&(a=-90),void 0===s&&(s=90),void 0===u&&(u=NaN),void 0===c&&(c=NaN),void 0===l&&(l=8),void 0===h&&(h=2),void 0===p&&(p=!1);var f=t.call(this,e,n)||this;return f._currentPanAngle=0,f._currentTiltAngle=90,f._panAngle=0,f._tiltAngle=90,f._distance=1e3,f._minPanAngle=-1/0,f._maxPanAngle=1/0,f._minTiltAngle=-90,f._maxTiltAngle=90,f._steps=8,f._yFactor=2,f._wrapPanAngle=!1,f.distance=o,f.panAngle=i,f.tiltAngle=r,f.minPanAngle=u||-1/0,f.maxPanAngle=c||1/0,f.minTiltAngle=a,f.maxTiltAngle=s,f.steps=l,f.yFactor=h,f.wrapPanAngle=p,f._currentPanAngle=f._panAngle,f._currentTiltAngle=f._tiltAngle,f}return Mi(e,t),Object.defineProperty(e.prototype,"steps",{get:function(){return this._steps},set:function(t){t=t<1?1:t,this._steps!==t&&(this._steps=t,this.update())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"panAngle",{get:function(){return this._panAngle},set:function(t){t=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,t)),this._panAngle!==t&&(this._panAngle=t,this.update())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tiltAngle",{get:function(){return this._tiltAngle},set:function(t){t=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,t)),this._tiltAngle!==t&&(this._tiltAngle=t,this.update())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},set:function(t){this._distance!==t&&(this._distance=t,this.update())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minPanAngle",{get:function(){return this._minPanAngle},set:function(t){this._minPanAngle!==t&&(this._minPanAngle=t,this.panAngle=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,this._panAngle)))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxPanAngle",{get:function(){return this._maxPanAngle},set:function(t){this._maxPanAngle!==t&&(this._maxPanAngle=t,this.panAngle=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,this._panAngle)))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minTiltAngle",{get:function(){return this._minTiltAngle},set:function(t){this._minTiltAngle!==t&&(this._minTiltAngle=t,this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxTiltAngle",{get:function(){return this._maxTiltAngle},set:function(t){this._maxTiltAngle!==t&&(this._maxTiltAngle=t,this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yFactor",{get:function(){return this._yFactor},set:function(t){this._yFactor!==t&&(this._yFactor=t,this.update())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapPanAngle",{get:function(){return this._wrapPanAngle},set:function(t){this._wrapPanAngle!==t&&(this._wrapPanAngle=t,this.update())},enumerable:!1,configurable:!0}),e.prototype.update=function(e){if(void 0===e&&(e=!0),this._tiltAngle!==this._currentTiltAngle||this._panAngle!==this._currentPanAngle){if(this._wrapPanAngle){for(this._panAngle<0?(this._currentPanAngle+=this._panAngle%360+360-this._panAngle,this._panAngle=this._panAngle%360+360):(this._currentPanAngle+=this._panAngle%360-this._panAngle,this._panAngle=this._panAngle%360);this._panAngle-this._currentPanAngle<-180;)this._currentPanAngle-=360;for(;this._panAngle-this._currentPanAngle>180;)this._currentPanAngle+=360}e?(this._currentTiltAngle+=(this._tiltAngle-this._currentTiltAngle)/(this.steps+1),this._currentPanAngle+=(this._panAngle-this._currentPanAngle)/(this.steps+1)):(this._currentPanAngle=this._panAngle,this._currentTiltAngle=this._tiltAngle),Math.abs(this.tiltAngle-this._currentTiltAngle)<.01&&Math.abs(this._panAngle-this._currentPanAngle)<.01&&(this._currentTiltAngle=this._tiltAngle,this._currentPanAngle=this._panAngle)}this._targetObject&&(this._lookAtPosition?(this._pos.x=this._lookAtPosition.x,this._pos.y=this._lookAtPosition.y,this._pos.z=this._lookAtPosition.z):this._lookAtObject?this._targetObject.transform.parent&&this._lookAtObject.transform.parent?this._targetObject.transform.parent!==this._lookAtObject.transform.parent?(this._pos.x=this._lookAtObject.transform.worldPosition.x,this._pos.y=this._lookAtObject.transform.worldPosition.y,this._pos.z=this._lookAtObject.transform.worldPosition.z,this._targetObject.transform.parent.worldToLocalMatrix.transformPoint3(this._pos,this._pos)):this._pos.copy(this._lookAtObject.transform.position):this._lookAtObject.scene?(this._pos.x=this._lookAtObject.transform.worldPosition.x,this._pos.y=this._lookAtObject.transform.worldPosition.y,this._pos.z=this._lookAtObject.transform.worldPosition.z):this._pos.copy(this._lookAtObject.transform.position):(this._pos.x=this._origin.x,this._pos.y=this._origin.y,this._pos.z=this._origin.z),this._targetObject.transform.x=this._pos.x+this._distance*Math.sin(this._currentPanAngle*P.DEG2RAD)*Math.cos(this._currentTiltAngle*P.DEG2RAD),this._targetObject.transform.z=this._pos.z+this._distance*Math.cos(this._currentPanAngle*P.DEG2RAD)*Math.cos(this._currentTiltAngle*P.DEG2RAD),this._targetObject.transform.y=this._pos.y+this._distance*Math.sin(this._currentTiltAngle*P.DEG2RAD)*this._yFactor,t.prototype.update.call(this))},e}(ho),fo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Mi(e,t),e=Ci([Ai()],e)}(Fr),mo=function(){function t(){}return t.prototype.pick=function(t,e){if(0===e.length)return null;var n=e.reduce((function(e,n){var i=n.getComponent(Nr),r=i&&i.worldRayIntersection(t);return r&&e.push(r),e}),[]);if(0===n.length)return null;n.sort((function(t,e){return t.rayEntryDistance-e.rayEntryDistance}));for(var i=Number.MAX_VALUE,r=null,o=0;o<n.length;++o){var a=n[o];if(!r||a.rayEntryDistance<r.rayEntryDistance){var s=a.geometry.raycast(a.localRay,i,a.cullFace);s&&(a.rayEntryDistance=s.rayEntryDistance,a.index=s.index,a.localNormal=s.localNormal,a.localPosition=s.localPosition,a.uv=s.uv,i=a.rayEntryDistance,r=a)}}return r},t.prototype.pickAll=function(t,e){if(0===e.length)return[];var n=e.reduce((function(e,n){var i=n.getComponent(Nr),r=i&&i.worldRayIntersection(t);return r&&e.push(r),e}),[]);return 0===n.length?[]:n.filter((function(t){var e=t.geometry.raycast(t.localRay,Number.MAX_VALUE,t.cullFace);return!!e&&(t.rayEntryDistance=e.rayEntryDistance,t.index=e.index,t.localNormal=e.localNormal,t.localPosition=e.localPosition,t.uv=e.uv,!0)}))},t}(),yo=new mo,vo=function(){function t(t,e){this._mouseEventTypes=[],this.mouseInput=t,this.viewport=e}return Object.defineProperty(t.prototype,"selectedGameObject",{get:function(){return this._selectedGameObject},set:function(t){this.setSelectedGameObject(t)},enumerable:!1,configurable:!0}),t.prototype.pick=function(t,e,n){if(0!==this._mouseEventTypes.length){var i=yo.pick(t.mouseRay3D,e.mouseCheckObjects);return i&&i.gameObject}},t.prototype._mouseInputChanged=function(t,e,n){var i=this;e&&_o.forEach((function(t){e.off(t,i.onMouseEvent,i)})),n&&_o.forEach((function(t){n.on(t,i.onMouseEvent,i)}))},t.prototype.dispatch=function(t){if(this.viewport&&!M.getvalue(this.viewport).contains(bi.clientX,bi.clientY))return;-1===this._mouseEventTypes.indexOf(t)&&this._mouseEventTypes.push(t)},t.prototype.onMouseEvent=function(t){this.dispatch(t.type)},t.prototype.setSelectedGameObject=function(t){var e=this;this._selectedGameObject!==t&&(this._selectedGameObject&&this._selectedGameObject.emit("mouseout",null,!0),t&&t.emit("mouseover",null,!0)),this._selectedGameObject=t,this._mouseEventTypes.forEach((function(t){switch(t){case"mousedown":e.preMouseDownGameObject!==e._selectedGameObject&&(e.gameObjectClickNum=0,e.preMouseDownGameObject=e._selectedGameObject),e._selectedGameObject&&e._selectedGameObject.emit(t,null,!0);break;case"mouseup":e._selectedGameObject===e.preMouseDownGameObject?e.gameObjectClickNum++:(e.gameObjectClickNum=0,e.preMouseDownGameObject=null),e._selectedGameObject&&e._selectedGameObject.emit(t,null,!0);break;case"mousemove":e._selectedGameObject&&e._selectedGameObject.emit(t,null,!0);break;case"click":e.gameObjectClickNum>0&&e._selectedGameObject&&e._selectedGameObject.emit(t,null,!0);break;case"dblclick":e.gameObjectClickNum>1&&(e._selectedGameObject&&e._selectedGameObject.emit(t,null,!0),e.gameObjectClickNum=0)}})),this._mouseEventTypes.length=0},Ci([N("_mouseInputChanged")],t.prototype,"mouseInput",void 0),t}(),go=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.enable=!0,e.catchMouseMove=!1,e}return Mi(e,t),e.prototype.emit=function(e,n,i){return void 0===i&&(i=!1),this.enable&&(this.catchMouseMove||"mousemove"!==e)?t.prototype.emit.call(this,e,n,i):null},e.prototype.emitEvent=function(e){return this.enable&&(this.catchMouseMove||"mousemove"!==e.type)?t.prototype.emitEvent.call(this,e):e},e}(X),_o=["mouseout","mouseover","mousemove","mousedown","mouseup","click","middlemousedown","middlemouseup","middleclick","rightmousedown","rightmouseup","rightclick","dblclick"],bo=function(t){function e(){var e=t.call(this)||this;return bi.on("click",e.onMouseEvent,e),bi.on("dblclick",e.onMouseEvent,e),bi.on("mousedown",e.onMouseEvent,e),bi.on("mouseup",e.onMouseEvent,e),bi.on("mousemove",e.onMouseEvent,e),e}return Mi(e,t),e.prototype.onMouseEvent=function(t){var e=t.data,n=e.type;e instanceof MouseEvent&&-1!==["click","mousedown","mouseup"].indexOf(e.type)&&(n=["","middle","right"][e.button]+e.type),this.emit(n,{mouseX:e.clientX,mouseY:e.clientY})},e}(go),xo=function(){function t(){}return Object.defineProperty(t.prototype,"gameObject",{get:function(){return this.component.gameObject},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this.gameObject.transform},enumerable:!1,configurable:!0}),t.prototype.init=function(){},t.prototype.update=function(){},t.prototype.dispose=function(){},t}(),wo=function(t){function e(){var e=t.call(this)||this;return e._position=new ht,e._size=new ht(1,1,1),e._leftTop=new ht(0,0,0),e._rightBottom=new ht(0,0,0),e.anchorMin=new ht(.5,.5,.5),e.anchorMax=new ht(.5,.5,.5),e.pivot=new ht(.5,.5,.5),e._layoutInvalid=!0,k.watch(e._position,"x",e._invalidateLayout,e),k.watch(e._position,"y",e._invalidateLayout,e),k.watch(e._position,"z",e._invalidateLayout,e),k.watch(e.anchorMin,"x",e._invalidateLayout,e),k.watch(e.anchorMin,"y",e._invalidateLayout,e),k.watch(e.anchorMin,"z",e._invalidateLayout,e),k.watch(e.anchorMax,"x",e._invalidateLayout,e),k.watch(e.anchorMax,"y",e._invalidateLayout,e),k.watch(e.anchorMax,"z",e._invalidateLayout,e),k.watch(e._leftTop,"x",e._invalidateSize,e),k.watch(e._leftTop,"y",e._invalidateSize,e),k.watch(e._leftTop,"z",e._invalidateSize,e),k.watch(e._rightBottom,"x",e._invalidateSize,e),k.watch(e._rightBottom,"y",e._invalidateSize,e),k.watch(e._rightBottom,"z",e._invalidateSize,e),k.watch(e._size,"x",e._invalidateSize,e),k.watch(e._size,"y",e._invalidateSize,e),k.watch(e._size,"z",e._invalidateSize,e),k.watch(e.pivot,"x",e._invalidatePivot,e),k.watch(e.pivot,"y",e._invalidatePivot,e),k.watch(e.pivot,"z",e._invalidatePivot,e),e.on("added",e._onAdded,e),e.on("removed",e._onRemoved,e),e}var i;return Mi(e,t),i=e,Object.defineProperty(e.prototype,"single",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype._onAdded=function(t){t.data.parent.on("sizeChanged",this._invalidateLayout,this),t.data.parent.on("pivotChanged",this._invalidateLayout,this),this._invalidateLayout()},e.prototype._onRemoved=function(t){t.data.parent.off("sizeChanged",this._invalidateLayout,this),t.data.parent.off("pivotChanged",this._invalidateLayout,this)},Object.defineProperty(e.prototype,"position",{get:function(){return this._updateLayout(),this._position},set:function(t){this._position.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._updateLayout(),this._size},set:function(t){this._size.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftTop",{get:function(){return this._leftTop},set:function(t){this._leftTop.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightBottom",{get:function(){return this._rightBottom},set:function(t){this._rightBottom.copy(t)},enumerable:!1,configurable:!0}),e.prototype.beforeRender=function(t,e,n){},e.prototype._updateLayout=function(){if(this._layoutInvalid){var t=this.gameObject&&this.gameObject.parent&&this.gameObject.parent.getComponent(i);if(t){var e=this._position,n=this._size,r=this._leftTop,o=this._rightBottom,a=this.anchorMin.clone(),s=this.anchorMax.clone(),u=this.pivot.clone(),c=t.size,l=t.pivot,h=new ht(a.x*c.x-l.x*c.x,a.y*c.y-l.y*c.y,a.z*c.z-l.z*c.z),p=new ht(s.x*c.x-l.x*c.x,s.y*c.y-l.y*c.y,s.z*c.z-l.z*c.z);a.x===s.x?(r.x=-u.x*n.x+e.x-h.x,o.x=p.x-(n.x-u.x*n.x+e.x)):(n.x=p.x-o.x-(h.x+r.x),e.x=r.x+u.x*n.x),a.y===s.y?(r.y=-u.y*n.y+e.y-h.y,o.y=p.y-(n.y-u.y*n.y+e.y)):(n.y=p.y-o.y-(h.y+r.y),e.y=r.y+u.y*n.y),a.z===s.z?(r.z=-u.z*n.z+e.z-h.z,o.z=p.z-(n.z-u.z*n.z+e.z)):(n.z=p.z-o.z-(h.z+r.z),e.z=r.z+u.z*n.z),this.transform.position.x=h.x+e.x,this.transform.position.y=h.y+e.y,this.transform.position.z=h.z+e.z,this._layoutInvalid=!1,cr.offframe(this._updateLayout,this)}}},e.prototype._invalidateLayout=function(){this._layoutInvalid=!0,cr.onframe(this._updateLayout,this)},e.prototype._invalidateSize=function(){this._invalidateLayout(),this.emit("sizeChanged",this)},e.prototype._invalidatePivot=function(){this._invalidateLayout(),this.emit("pivotChanged",this)},Ci([n({tooltip:"当anchorMin.x == anchorMax.x时对position.x赋值生效，当 anchorMin.y == anchorMax.y 时对position.y赋值生效，否则赋值无效，自动被覆盖。",componentParam:{step:1,stepScale:1,stepDownup:1}}),C],e.prototype,"position",null),Ci([n({tooltip:"宽度，不会影响到缩放值。当 anchorMin.x == anchorMax.x 时对 size.x 赋值生效，当anchorMin.y == anchorMax.y时对 size.y 赋值生效，否则赋值无效，自动被覆盖。",componentParam:{step:1,stepScale:1,stepDownup:1}}),C],e.prototype,"size",null),Ci([n({tooltip:"与最小最大锚点形成的边框的left、right、top、bottom距离。当 anchorMin.x != anchorMax.x 时对 layout.x layout.y 赋值生效，当 anchorMin.y != anchorMax.y 时对 layout.z layout.w 赋值生效，否则赋值无效，自动被覆盖。",componentParam:{step:1,stepScale:1,stepDownup:1}}),C],e.prototype,"leftTop",null),Ci([n({tooltip:"与最小最大锚点形成的边框的left、right、top、bottom距离。当 anchorMin.x != anchorMax.x 时对 layout.x layout.y 赋值生效，当 anchorMin.y != anchorMax.y 时对 layout.z layout.w 赋值生效，否则赋值无效，自动被覆盖。",componentParam:{step:1,stepScale:1,stepDownup:1}}),C],e.prototype,"rightBottom",null),Ci([n({tooltip:"父Transform2D中左上角锚定的规范化位置。",componentParam:{step:.01,stepScale:.01,stepDownup:.01}}),C],e.prototype,"anchorMin",void 0),Ci([n({tooltip:"最大锚点，父Transform2D中左上角锚定的规范化位置。",componentParam:{step:.01,stepScale:.01,stepDownup:.01}}),C],e.prototype,"anchorMax",void 0),Ci([n({tooltip:"中心点"}),C],e.prototype,"pivot",void 0),e=i=Ci([zi("Layout/TransformLayout"),Ai()],e)}(Ei),So=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.width=1,e.height=1,e.segmentsW=1,e.segmentsH=1,e.yUp=!0,e.name="Plane",e}return Mi(e,t),e.prototype.buildGeometry=function(){var t=this.buildPosition();this.positions=t;var e=this.buildNormal();this.normals=e;var n=this.buildTangent();this.tangents=n;var i=this.buildUVs();this.uvs=i;var r=this.buildIndices();this.indices=r},e.prototype.buildPosition=function(){for(var t,e,n=[],i=0,r=0;r<=this.segmentsH;++r)for(var o=0;o<=this.segmentsW;++o)t=(o/this.segmentsW-.5)*this.width,e=(r/this.segmentsH-.5)*this.height,n[i++]=t,this.yUp?(n[i++]=0,n[i++]=e):(n[i++]=e,n[i++]=0);return n},e.prototype.buildNormal=function(){for(var t=[],e=0,n=0;n<=this.segmentsH;++n)for(var i=0;i<=this.segmentsW;++i)t[e++]=0,this.yUp?(t[e++]=1,t[e++]=0):(t[e++]=0,t[e++]=1);return t},e.prototype.buildTangent=function(){for(var t=[],e=0,n=0;n<=this.segmentsH;++n)for(var i=0;i<=this.segmentsW;++i)this.yUp?(t[e++]=1,t[e++]=0,t[e++]=0):(t[e++]=-1,t[e++]=0,t[e++]=0);return t},e.prototype.buildIndices=function(){for(var t,e=[],n=this.segmentsW+1,i=0,r=0;r<=this.segmentsH;++r)for(var o=0;o<=this.segmentsW;++o)o!==this.segmentsW&&r!==this.segmentsH&&(t=o+r*n,this.yUp?(e[i++]=t,e[i++]=t+n,e[i++]=t+n+1,e[i++]=t,e[i++]=t+n+1,e[i++]=t+1):(e[i++]=t,e[i++]=t+n+1,e[i++]=t+n,e[i++]=t,e[i++]=t+1,e[i++]=t+n+1));return e},e.prototype.buildUVs=function(){for(var t=[],e=0,n=0;n<=this.segmentsH;++n)for(var i=0;i<=this.segmentsW;++i)this.yUp?(t[e++]=i/this.segmentsW,t[e++]=1-n/this.segmentsH):(t[e++]=1-i/this.segmentsW,t[e++]=1-n/this.segmentsH);return t},Ci([n(),C,N("invalidateGeometry")],e.prototype,"width",void 0),Ci([n(),C,N("invalidateGeometry")],e.prototype,"height",void 0),Ci([n(),C,N("invalidateGeometry")],e.prototype,"segmentsW",void 0),Ci([n(),C,N("invalidateGeometry")],e.prototype,"segmentsH",void 0),Ci([n(),C,N("invalidateGeometry")],e.prototype,"yUp",void 0),e}(Tr);Tr.setDefault("Plane",new So,{width:10,height:10}),Vr.registerPrimitive("Plane",(function(t){t.addComponent(fo).geometry=Tr.getDefault("Plane")})),Vi.push({path:"3D Object/Plane",priority:-5,click:function(){return Vr.createPrimitive("Plane")}});var Po,Mo=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.OFFSCREEN_WIDTH=1024,n.OFFSCREEN_HEIGHT=1024,n.format=t.TextureFormat.RGBA,n.minFilter=t.TextureMinFilter.NEAREST,n.magFilter=t.TextureMagFilter.NEAREST,n.isRenderTarget=!0,n}return Mi(n,e),Ci([N("invalidate")],n.prototype,"OFFSCREEN_WIDTH",void 0),Ci([N("invalidate")],n.prototype,"OFFSCREEN_HEIGHT",void 0),n}(zr),Co=function(){function t(t,e){void 0===t&&(t=1024),void 0===e&&(e=1024),this.OFFSCREEN_WIDTH=1024,this.OFFSCREEN_HEIGHT=1024,this._invalid=!0,this.frameBuffer=new Sn,this.texture=new Mo,this.depthBuffer=new Wn,this.OFFSCREEN_WIDTH=t,this.OFFSCREEN_HEIGHT=e}return t.active=function(t,e){e._invalid&&(e._invalid=!1,this.clear(e)),t.cache.frameBufferObjects=t.cache.frameBufferObjects||new Map;var n=t.cache.frameBufferObjects.get(e);if(n)t.bindFramebuffer(t.FRAMEBUFFER,n.framebuffer);else{var i=Sn.active(t,e.frameBuffer),r=vn.active(t,e.texture),o=Wn.active(t,e.depthBuffer);t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,o);var a=t.checkFramebufferStatus(t.FRAMEBUFFER);if(t.FRAMEBUFFER_COMPLETE!==a)return console.warn("Frame buffer object is incomplete: "+a.toString()),null;t.bindTexture(t.TEXTURE_2D,null),t.bindRenderbuffer(t.RENDERBUFFER,null),n={framebuffer:i,texture:r,depthBuffer:o},t.cache.frameBufferObjects.set(e,n)}return n},t.prototype.deactive=function(t){t.bindFramebuffer(t.FRAMEBUFFER,null)},t.prototype.invalidate=function(){this._invalid=!0},t.prototype.invalidateSize=function(){this.texture&&(this.texture.OFFSCREEN_WIDTH=this.OFFSCREEN_WIDTH,this.texture.OFFSCREEN_HEIGHT=this.OFFSCREEN_HEIGHT),this.depthBuffer&&(this.depthBuffer.OFFSCREEN_WIDTH=this.OFFSCREEN_WIDTH,this.depthBuffer.OFFSCREEN_HEIGHT=this.OFFSCREEN_HEIGHT),this._invalid=!0},t.clear=function(t){xn.glList.forEach((function(e){e.cache.frameBufferObjects=e.cache.frameBufferObjects||new Map,e.cache.frameBufferObjects.get(t)&&e.cache.frameBufferObjects.delete(t)}))},Ci([N("invalidateSize")],t.prototype,"OFFSCREEN_WIDTH",void 0),Ci([N("invalidateSize")],t.prototype,"OFFSCREEN_HEIGHT",void 0),Ci([N("invalidate")],t.prototype,"frameBuffer",void 0),Ci([N("invalidate")],t.prototype,"texture",void 0),Ci([N("invalidate")],t.prototype,"depthBuffer",void 0),t}();t.LightType=void 0,(Po=t.LightType||(t.LightType={}))[Po.Directional=0]="Directional",Po[Po.Point=1]="Point",Po[Po.Spot=2]="Spot";var To=function(e){function i(){var n=e.call(this)||this;return n.color=new pt,n.intensity=1,n.shadowType=t.ShadowType.No_Shadows,n.shadowBias=-.005,n.shadowRadius=1,n.frameBufferObject=new Co,n.debugShadowMap=!1,n.shadowCamera=E.setValue(new Vr,{name:"LightShadowCamera"}).addComponent(eo),n}return Mi(i,e),Object.defineProperty(i.prototype,"position",{get:function(){return this.transform.worldPosition},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"direction",{get:function(){return this.transform.localToWorldMatrix.getAxisZ()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shadowCameraNear",{get:function(){return this.shadowCamera.lens.near},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shadowCameraFar",{get:function(){return this.shadowCamera.lens.far},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shadowMapSize",{get:function(){return this.shadowMap.getSize()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shadowMap",{get:function(){return this.frameBufferObject.texture},enumerable:!1,configurable:!0}),i.prototype.updateDebugShadowMap=function(e,n){var i=this.debugShadowMapObject;if(!i){(i=this.debugShadowMapObject=Vr.createPrimitive("Plane",{name:"debugShadowMapObject"})).hideFlags=t.HideFlags.Hide|t.HideFlags.DontSave,i.mouseEnabled=!1,i.addComponent(no);var r=i.getComponent(Fr);r.geometry=E.setValue(new So,{width:this.lightType===t.LightType.Point?1:.5,height:.5,segmentsW:1,segmentsH:1,yUp:!1});var o=r.material=E.setValue(new Lr,{shaderName:"texture",uniforms:{s_texture:this.frameBufferObject.texture}});o.renderParams.enableBlend=!0,o.renderParams.sfactor=t.BlendFactor.ONE,o.renderParams.dfactor=t.BlendFactor.ZERO}var a=2*n.lens.near;i.transform.position=n.transform.worldPosition.addTo(n.transform.localToWorldMatrix.getAxisZ().scaleNumberTo(a)),i.getComponent(no).camera=n,this.debugShadowMap?e.gameObject.addChild(i):i.remove()},Ci([C],i.prototype,"lightType",void 0),Ci([n(),C],i.prototype,"color",void 0),Ci([n(),C],i.prototype,"intensity",void 0),Ci([n({component:"OAVEnum",componentParam:{enumClass:t.ShadowType}}),C],i.prototype,"shadowType",void 0),Ci([n({tooltip:"是否调试阴影图"})],i.prototype,"debugShadowMap",void 0),i}(Di),Ao=function(e){function n(){var n=e.call(this)||this;return n.lightType=t.LightType.Directional,n}return Mi(n,e),Object.defineProperty(n.prototype,"position",{get:function(){return this.shadowCamera.transform.worldPosition},enumerable:!1,configurable:!0}),n.prototype.updateShadowByCamera=function(t,e,n){var i=n.reduce((function(t,e){var n=e.gameObject.boundingBox.worldBounds;return t?(t.union(n),t):n.clone()}),null)||new Dt(new ht,new ht(1,1,1)),r=i.getCenter(),o=i.getSize().length/2;this.shadowCamera.transform.position=r.addTo(this.direction.scaleNumberTo(o+this.shadowCameraNear).negate()),this.shadowCamera.transform.lookAt(r,this.shadowCamera.transform.matrix.getAxisY()),this.orthographicLens?E.setValue(this.orthographicLens,{size:o,near:this.shadowCameraNear,far:this.shadowCameraNear+2*o}):this.shadowCamera.lens=this.orthographicLens=new $r(o,1,this.shadowCameraNear,this.shadowCameraNear+2*o)},n=Ci([zi("Rendering/DirectionalLight"),Ai()],n)}(To);Vr.registerPrimitive("Directional light",(function(t){t.addComponent(Ao)})),Vi.push({path:"Light/Directional light",priority:-2,click:function(){return Vr.createPrimitive("Directional light")}});var Oo=function(){function t(){}return t.prototype.draw=function(t,e,n){var i=e.getPickCache(n).blenditems,r=e.getPickCache(n).unblenditems,o={};o.u_projectionMatrix=n.lens.matrix,o.u_viewProjection=n.viewProjection,o.u_viewMatrix=n.transform.worldToLocalMatrix,o.u_cameraMatrix=n.transform.localToWorldMatrix,o.u_cameraPos=n.transform.worldPosition,o.u_skyBoxSize=n.lens.far/Math.sqrt(3),o.u_scaleByDepth=n.getScaleByDepth(1),o.u_sceneAmbientColor=e.ambientColor;var a=Date.now()/1e3%3600;o._Time=new dt(a/20,a,2*a,3*a),r.concat(i).forEach((function(i){var r=i.renderAtomic;for(var a in o)r.uniforms[a]=o[a];r.uniforms.u_mvMatrix=function(){return M.getvalue(r.uniforms.u_modelMatrix).clone().append(M.getvalue(r.uniforms.u_viewMatrix))},r.uniforms.u_ITMVMatrix=function(){return M.getvalue(r.uniforms.u_mvMatrix).clone().invert().transpose()},r.shaderMacro.RotationOrder=P.DefaultRotationOrder,i.beforeRender(r,e,n),t.render(r)}))},t}(),Eo=new Oo,Do=function(){function e(){}return e.prototype.init=function(){if(!this.renderAtomic){this.renderAtomic=new Bn;var e=this.renderAtomic.renderParams;e.enableBlend=!1,e.cullFace=t.CullFace.FRONT,this.renderAtomic.shader=new kn({shaderName:"outline"})}},e.prototype.draw=function(t,e,n){var i=e.getPickCache(n).unblenditems;this.init();for(var r=0;r<i.length;r++){var o=i[r];if(o.getComponent(so)||o.getComponent(io)){var a=o.renderAtomic;o.beforeRender(a,e,n),this.renderAtomic.next=a,t.render(this.renderAtomic)}}},e}(),zo=new Do,Io=function(){function e(){this.renderAtomic=new Bn}return e.prototype.draw=function(e,n,i){for(var r=n.activePointLights.filter((function(e){return e.shadowType!==t.ShadowType.No_Shadows})),o=0;o<r.length;o++)r[o].updateDebugShadowMap(n,i),this.drawForPointLight(e,r[o],n,i);var a=n.activeSpotLights.filter((function(e){return e.shadowType!==t.ShadowType.No_Shadows}));for(o=0;o<a.length;o++)a[o].updateDebugShadowMap(n,i),this.drawForSpotLight(e,a[o],n,i);var s=n.activeDirectionalLights.filter((function(e){return e.shadowType!==t.ShadowType.No_Shadows}));for(o=0;o<s.length;o++)s[o].updateDebugShadowMap(n,i),this.drawForDirectionalLight(e,s[o],n,i)},e.prototype.drawForSpotLight=function(t,e,n,i){var r=this,o=t.gl;Co.active(o,e.frameBufferObject),o.viewport(0,0,e.frameBufferObject.OFFSCREEN_WIDTH,e.frameBufferObject.OFFSCREEN_HEIGHT),o.clearColor(1,1,1,1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);var a=e.shadowCamera;a.transform.localToWorldMatrix=e.transform.localToWorldMatrix;var s=this.renderAtomic,u=n.getModelsByCamera(a).filter((function(t){return t.castShadows}));s.renderParams.useViewPort=!0,s.renderParams.viewPort=new Bt(0,0,e.frameBufferObject.OFFSCREEN_WIDTH,e.frameBufferObject.OFFSCREEN_HEIGHT),s.uniforms.u_projectionMatrix=a.lens.matrix,s.uniforms.u_viewProjection=a.viewProjection,s.uniforms.u_viewMatrix=a.transform.worldToLocalMatrix,s.uniforms.u_cameraMatrix=a.transform.localToWorldMatrix,s.uniforms.u_cameraPos=a.transform.worldPosition,s.uniforms.u_lightType=e.lightType,s.uniforms.u_lightPosition=e.position,s.uniforms.u_shadowCameraNear=e.shadowCameraNear,s.uniforms.u_shadowCameraFar=e.shadowCameraFar,u.forEach((function(e){r.drawGameObject(t,e,n,i)})),e.frameBufferObject.deactive(o)},e.prototype.drawForPointLight=function(t,e,n,i){var r=this,o=t.gl;Co.active(o,e.frameBufferObject),o.viewport(0,0,e.frameBufferObject.OFFSCREEN_WIDTH,e.frameBufferObject.OFFSCREEN_HEIGHT),o.clearColor(1,1,1,1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);var a=e.shadowMapSize.x,s=e.shadowMapSize.y;Ro[0].init(2*a,s,a,s),Ro[1].init(0,s,a,s),Ro[2].init(3*a,s,a,s),Ro[3].init(a,s,a,s),Ro[4].init(3*a,0,a,s),Ro[5].init(a,0,a,s);var u=e.shadowCamera;u.transform.position=e.transform.position;for(var c=this.renderAtomic,l=0;l<6;l++){u.transform.lookAt(e.position.addTo(No[l]),Lo[l]);var h=n.getModelsByCamera(u).filter((function(t){return t.castShadows}));c.renderParams.useViewPort=!0,c.renderParams.viewPort=Ro[l],c.uniforms.u_projectionMatrix=u.lens.matrix,c.uniforms.u_viewProjection=u.viewProjection,c.uniforms.u_viewMatrix=u.transform.worldToLocalMatrix,c.uniforms.u_cameraMatrix=u.transform.localToWorldMatrix,c.uniforms.u_cameraPos=u.transform.worldPosition,c.uniforms.u_lightType=e.lightType,c.uniforms.u_lightPosition=e.position,c.uniforms.u_shadowCameraNear=e.shadowCameraNear,c.uniforms.u_shadowCameraFar=e.shadowCameraFar,h.forEach((function(e){r.drawGameObject(t,e,n,i)}))}e.frameBufferObject.deactive(o)},e.prototype.drawForDirectionalLight=function(t,e,n,i){var r=this,o=n.getPickByDirectionalLight(e),a=o.filter((function(t){return t.castShadows}));e.updateShadowByCamera(n,i,o),Co.active(t.gl,e.frameBufferObject);var s=t.gl;s.viewport(0,0,e.frameBufferObject.OFFSCREEN_WIDTH,e.frameBufferObject.OFFSCREEN_HEIGHT),s.clearColor(1,1,1,1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT);var u=e.shadowCamera,c=this.renderAtomic;c.renderParams.useViewPort=!0,c.renderParams.viewPort=new Bt(0,0,e.frameBufferObject.OFFSCREEN_WIDTH,e.frameBufferObject.OFFSCREEN_HEIGHT),c.uniforms.u_projectionMatrix=u.lens.matrix,c.uniforms.u_viewProjection=u.viewProjection,c.uniforms.u_viewMatrix=u.transform.worldToLocalMatrix,c.uniforms.u_cameraMatrix=u.transform.localToWorldMatrix,c.uniforms.u_cameraPos=u.transform.worldPosition,c.uniforms.u_lightType=e.lightType,c.uniforms.u_lightPosition=u.transform.worldPosition,c.uniforms.u_shadowCameraNear=e.shadowCameraNear,c.uniforms.u_shadowCameraFar=e.shadowCameraFar,a.forEach((function(e){r.drawGameObject(t,e,n,i)})),e.frameBufferObject.deactive(s)},e.prototype.drawGameObject=function(t,e,n,i){var r=e.renderAtomic;e.beforeRender(r,n,i),r.shadowShader=r.shadowShader||new kn({shaderName:"shadow"}),this.renderAtomic.next=r,this.renderAtomic.renderParams.cullFace=r.renderParams.cullFace,this.renderAtomic.shader=r.shadowShader,t.render(this.renderAtomic),this.renderAtomic.shader=null},e}(),jo=new Io,Ro=[new Bt,new Bt,new Bt,new Bt,new Bt,new Bt],Lo=[new ht(0,1,0),new ht(0,1,0),new ht(0,1,0),new ht(0,1,0),new ht(0,0,1),new ht(0,0,-1)],No=[new ht(1,0,0),new ht(-1,0,0),new ht(0,0,1),new ht(0,0,-1),new ht(0,1,0),new ht(0,-1,0)],Fo=function(){function e(){}return e.prototype.init=function(){this.renderAtomic||(this.renderAtomic=new Bn,this.renderAtomic.renderParams.renderMode=t.RenderMode.LINES)},e.prototype.draw=function(t,e,n){var i=this,r=e.getPickCache(n).unblenditems.reduce((function(t,e){var n=e.getComponent(uo);return n&&t.push({wireframe:n,renderable:e}),t}),[]);0!==r.length&&r.forEach((function(r){i.drawGameObject(t,r.renderable,e,n,r.wireframe.color)}))},e.prototype.drawGameObject=function(e,n,i,r,o){void 0===o&&(o=new yt);var a=n.renderAtomic;n.beforeRender(a,i,r);var s=M.getvalue(a.renderParams.renderMode);if(s!==t.RenderMode.POINTS&&s!==t.RenderMode.LINES&&s!==t.RenderMode.LINE_LOOP&&s!==t.RenderMode.LINE_STRIP){this.init();var u=this.renderAtomic.uniforms;u.u_projectionMatrix=r.lens.matrix,u.u_viewProjection=r.viewProjection,u.u_viewMatrix=r.transform.worldToLocalMatrix,u.u_cameraMatrix=r.transform.localToWorldMatrix,u.u_cameraPos=r.transform.worldPosition,u.u_skyBoxSize=r.lens.far/Math.sqrt(3),u.u_scaleByDepth=r.getScaleByDepth(1),this.renderAtomic.next=a;var c=a.index;if(!(c.count<3)){if(!a.wireframeindexBuffer||a.wireframeindexBuffer.count!==2*c.count){for(var l=[],h=M.getvalue(c.indices),p=0;p<h.length;p+=3)l.push(h[p],h[p+1],h[p],h[p+2],h[p+1],h[p+2]);a.wireframeindexBuffer=new Pn,a.wireframeindexBuffer.indices=l}a.wireframeShader=a.wireframeShader||new kn({shaderName:"wireframe"}),this.renderAtomic.index=a.wireframeindexBuffer,this.renderAtomic.uniforms.u_wireframeColor=o,this.renderAtomic.shader=a.wireframeShader,e.render(this.renderAtomic),this.renderAtomic.shader=null}}},e}(),ko=new Fo,Bo=function(e){function i(){var n=e.call(this)||this;return n.lightType=t.LightType.Point,n._range=10,n.shadowCamera.lens=new to(90,1,.1,n.range),n}return Mi(i,e),Object.defineProperty(i.prototype,"range",{get:function(){return this._range},set:function(t){this._range!==t&&(this._range=t,this.invalidRange())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shadowMapSize",{get:function(){return this.shadowMap.getSize().multiply(new lt(1/4,.5))},enumerable:!1,configurable:!0}),i.prototype.invalidRange=function(){this.shadowCamera&&(this.shadowCamera.lens.far=this.range)},Ci([n(),C],i.prototype,"range",null),i=Ci([zi("Rendering/PointLight"),Ai()],i)}(To);Vr.registerPrimitive("Point Light",(function(t){t.addComponent(Bo)})),Vi.push({path:"Light/Point Light",priority:-1,click:function(){return Vr.createPrimitive("Point Light")}});var Vo=function(e){function i(){var n=e.call(this)||this;return n.lightType=t.LightType.Spot,n.range=10,n.angle=60,n.penumbra=0,n.perspectiveLens=n.shadowCamera.lens=new to(n.angle,1,.1,n.range),n}return Mi(i,e),Object.defineProperty(i.prototype,"coneCos",{get:function(){return Math.cos(.5*this.angle*P.DEG2RAD)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"penumbraCos",{get:function(){return Math.cos(.5*this.angle*P.DEG2RAD*(1-this.penumbra))},enumerable:!1,configurable:!0}),i.prototype._invalidRange=function(){this.shadowCamera&&(this.shadowCamera.lens.far=this.range)},i.prototype._invalidAngle=function(){this.perspectiveLens&&(this.perspectiveLens.fov=this.angle)},Ci([n(),C,N("_invalidRange")],i.prototype,"range",void 0),Ci([n(),C,N("_invalidAngle")],i.prototype,"angle",void 0),Ci([n(),C],i.prototype,"penumbra",void 0),i=Ci([Ai()],i)}(To);Vr.registerPrimitive("Spot Light",(function(t){t.addComponent(Vo)})),Vi.push({path:"Light/Spot Light",priority:-2,click:function(){return Vr.createPrimitive("Spot Light")}});var Wo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.s_skyboxTexture=Ir.default,e}return Mi(e,t),e.prototype.beforeRender=function(t,e,n){var i=this;t.uniforms.s_skyboxTexture=function(){return i.s_skyboxTexture}},Ci([C,n({component:"OAVPick",componentParam:{accepttype:"texturecube",datatype:"texturecube"}})],e.prototype,"s_skyboxTexture",void 0),e=Ci([zi("SkyBox/SkyBox"),Ai()],e)}(Ei),Uo=function(){function t(t,e){this.scene=t,this.camera=e}return Object.defineProperty(t.prototype,"activeModels",{get:function(){if(this._activeModels)return this._activeModels;for(var t=this._activeModels=[],e=this.camera.frustum,n=[this.scene.gameObject];n.length>0;){var i=n.pop();if(i.activeSelf){var r=i.getComponent(Fr);r&&r.enabled&&r.selfWorldBounds&&e.intersectsBox(r.selfWorldBounds)&&t.push(r),n=n.concat(i.children)}}return t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blenditems",{get:function(){if(this._blenditems)return this._blenditems;var t=this.activeModels,e=this.camera.transform.worldPosition;return this._blenditems=t.filter((function(t){return t.material.renderParams.enableBlend})).sort((function(t,n){return n.transform.worldPosition.subTo(e).lengthSquared-t.transform.worldPosition.subTo(e).lengthSquared}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"unblenditems",{get:function(){if(this._unblenditems)return this._unblenditems;var t=this.activeModels,e=this.camera.transform.worldPosition;return this._unblenditems=t.filter((function(t){return!t.material.renderParams.enableBlend})).sort((function(t,n){return t.transform.worldPosition.subTo(e).lengthSquared-n.transform.worldPosition.subTo(e).lengthSquared}))},enumerable:!1,configurable:!0}),t.prototype.clear=function(){this._blenditems=null,this._unblenditems=null,this._activeModels=null},t}(),Go=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.background=new yt(0,0,0,1),n.ambientColor=new yt,n.runEnvironment=t.RunEnvironment.feng3d,n._pickMap=new Map,n}return Mi(i,e),i.prototype.init=function(){e.prototype.init.call(this),this.transform.hideFlags=this.transform.hideFlags|t.HideFlags.Hide,this.gameObject.hideFlags=this.gameObject.hideFlags|t.HideFlags.DontTransform,this._gameObject._scene=this,this._gameObject.updateChildrenScene()},i.prototype.update=function(t){var e=this;t=t||1e3/cr.frameRate,this._mouseCheckObjects=null,this._models=null,this._visibleAndEnabledModels=null,this._skyBoxs=null,this._activeSkyBoxs=null,this._directionalLights=null,this._activeDirectionalLights=null,this._pointLights=null,this._activePointLights=null,this._spotLights=null,this._activeSpotLights=null,this._animations=null,this._activeAnimations=null,this._behaviours=null,this._activeBehaviours=null,this._pickMap.forEach((function(t){return t.clear()})),this.behaviours.forEach((function(n){n.isVisibleAndEnabled&&Boolean(e.runEnvironment&n.runEnvironment)&&n.update(t)}))},Object.defineProperty(i.prototype,"models",{get:function(){return this._models=this._models||this.getComponentsInChildren(Fr),this._models},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"visibleAndEnabledModels",{get:function(){return this._visibleAndEnabledModels=this._visibleAndEnabledModels||this.models.filter((function(t){return t.isVisibleAndEnabled})),this._visibleAndEnabledModels},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skyBoxs",{get:function(){return this._skyBoxs=this._skyBoxs||this.getComponentsInChildren(Wo),this._skyBoxs},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activeSkyBoxs",{get:function(){return this._activeSkyBoxs=this._activeSkyBoxs||this.skyBoxs.filter((function(t){return t.gameObject.activeInHierarchy})),this._activeSkyBoxs},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"directionalLights",{get:function(){return this._directionalLights=this._directionalLights||this.getComponentsInChildren(Ao),this._directionalLights},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activeDirectionalLights",{get:function(){return this._activeDirectionalLights=this._activeDirectionalLights||this.directionalLights.filter((function(t){return t.isVisibleAndEnabled})),this._activeDirectionalLights},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"pointLights",{get:function(){return this._pointLights=this._pointLights||this.getComponentsInChildren(Bo),this._pointLights},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activePointLights",{get:function(){return this._activePointLights=this._activePointLights||this.pointLights.filter((function(t){return t.isVisibleAndEnabled})),this._activePointLights},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"spotLights",{get:function(){return this._spotLights=this._spotLights||this.getComponentsInChildren(Vo),this._spotLights},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activeSpotLights",{get:function(){return this._activeSpotLights=this._activeSpotLights||this.spotLights.filter((function(t){return t.isVisibleAndEnabled})),this._activeSpotLights},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animations",{get:function(){return this._animations=this._animations||this.getComponentsInChildren(Fi),this._animations},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activeAnimations",{get:function(){return this._activeAnimations=this._activeAnimations||this.animations.filter((function(t){return t.isVisibleAndEnabled})),this._activeAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"behaviours",{get:function(){return this._behaviours=this._behaviours||this.getComponentsInChildren(Di),this._behaviours},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activeBehaviours",{get:function(){return this._activeBehaviours=this._activeBehaviours||this.behaviours.filter((function(t){return t.isVisibleAndEnabled})),this._activeBehaviours},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"mouseCheckObjects",{get:function(){if(this._mouseCheckObjects)return this._mouseCheckObjects;var t=this.gameObject.getChildren();this._mouseCheckObjects=[];for(var e=0;e<t.length;){var n=t[e++];n.mouseEnabled&&(n.getComponents(Fr)&&this._mouseCheckObjects.push(n),t=t.concat(n.getChildren()))}return this._mouseCheckObjects},enumerable:!1,configurable:!0}),i.prototype.getPickCache=function(t){if(this._pickMap.get(t))return this._pickMap.get(t);var e=new Uo(this,t);return this._pickMap.set(t,e),e},i.prototype.getPickByDirectionalLight=function(e){for(var n=[this.gameObject],i=[];n.length>0;){var r=n.shift();if(r.activeSelf){var o=r.getComponent(Fr);o&&(o.castShadows||o.receiveShadows)&&!o.material.renderParams.enableBlend&&o.material.renderParams.renderMode===t.RenderMode.TRIANGLES&&i.push(o),r.children.forEach((function(t){n.push(t)}))}}return i},i.prototype.getModelsByCamera=function(t){var e=t.frustum;return this.visibleAndEnabledModels.filter((function(t){var n=t.getComponent(Fr);return!(!n.selfWorldBounds||!e.intersectsBox(n.selfWorldBounds))}))},Ci([C,n()],i.prototype,"background",void 0),Ci([C,n()],i.prototype,"ambientColor",void 0),i=Ci([Ai()],i)}(Ei),Ho=function(){function e(){}return e.prototype.init=function(){if(!this.renderAtomic){var e=this.renderAtomic=new Bn;e.attributes.a_position=new wn({name:"a_position",data:[-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1],size:3});e.index=new Pn,e.index.indices=[0,1,2,2,3,0,6,5,4,4,7,6,2,6,7,7,3,2,4,5,1,1,0,4,4,0,3,3,7,4,2,1,5,5,6,2],e.renderParams.cullFace=t.CullFace.NONE,e.shader=new kn({shaderName:"skybox"})}},e.prototype.draw=function(t,e,n){var i=e.activeSkyBoxs[0];this.drawSkyBox(t,i,e,n)},e.prototype.drawSkyBox=function(t,e,n,i){e&&(this.init(),e.beforeRender(this.renderAtomic,n,i),this.renderAtomic.uniforms.u_viewProjection=i.viewProjection,this.renderAtomic.uniforms.u_viewMatrix=i.transform.worldToLocalMatrix,this.renderAtomic.uniforms.u_cameraMatrix=i.transform.localToWorldMatrix,this.renderAtomic.uniforms.u_cameraPos=i.transform.worldPosition,this.renderAtomic.uniforms.u_skyBoxSize=i.lens.far/Math.sqrt(3),t.render(this.renderAtomic))},e}(),Ko=new Ho,Xo=function(e){function n(t,n,i,r){var o=e.call(this)||this;return o._contextAttributes={stencil:!0},o.mousePos=new lt,o.viewRect=new Bt,o.contextLost=!1,t||((t=document.createElement("canvas")).id="glcanvas",t.style.position="fixed",t.style.left="0px",t.style.top="0px",t.style.width="100%",t.style.height="100%",document.body.appendChild(t)),console.assert(t instanceof HTMLCanvasElement,"canvas参数必须为 HTMLCanvasElement 类型！"),o.canvas=t,r&&Object.assign(o._contextAttributes,r),t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),o.contextLost=!0,console.log("GraphicsDevice: WebGL context lost.")}),!1),t.addEventListener("webglcontextrestored",(function(){o.contextLost=!1,console.log("GraphicsDevice: WebGL context restored.")}),!1),o.scene=n||E.setValue(new Vr,{name:"scene"}).addComponent(Go),o.camera=i,o.start(),o.mouse3DManager=new vo(new bo,(function(){return o.viewRect})),o}return Mi(n,e),Object.defineProperty(n.prototype,"camera",{get:function(){if(!this._camera){var t=this.scene.getComponentsInChildren(eo);0===t.length?(this._camera=E.setValue(new Vr,{name:"defaultCamera"}).addComponent(eo),this.scene.gameObject.addChild(this._camera.gameObject)):this._camera=t[0]}return this._camera},set:function(t){this._camera=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){return this.scene.gameObject},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"gl",{get:function(){return this.canvas.gl||(this.canvas.gl=new xn(this.canvas,this._contextAttributes)),this.canvas.gl},enumerable:!1,configurable:!0}),n.prototype.setSize=function(t,e){this.canvas.width=t,this.canvas.height=e,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px"},n.prototype.start=function(){cr.onframe(this.update,this)},n.prototype.stop=function(){cr.offframe(this.update,this)},n.prototype.update=function(t){this.render(t),this.mouse3DManager.selectedGameObject=this.selectedObject},n.prototype.render=function(t){if(this.scene&&!this.contextLost&&(this.scene.update(t),this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.canvas.width*this.canvas.height!=0)){var e=this.canvas.getBoundingClientRect();this.viewRect.x=e.left,this.viewRect.y=e.top,this.viewRect.width=e.width,this.viewRect.height=e.height,this.mousePos.x=bi.clientX-e.left,this.mousePos.y=bi.clientY-e.top,this.camera.lens.aspect=this.viewRect.width/this.viewRect.height,this.calcMouseRay3D(),this.scene.mouseRay3D=this.mouseRay3D,this.scene.camera=this.camera;var n=this.gl.gl;n.colorMask(!0,!0,!0,!0),n.clearColor(this.scene.background.r,this.scene.background.g,this.scene.background.b,this.scene.background.a),n.clearStencil(0),n.clearDepth(1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT|n.STENCIL_BUFFER_BIT),n.enable(n.DEPTH_TEST),this.selectedObject=this.mouse3DManager.pick(this,this.scene,this.camera),jo.draw(this.gl,this.scene,this.camera),Ko.draw(this.gl,this.scene,this.camera),Eo.draw(this.gl,this.scene,this.camera),zo.draw(this.gl,this.scene,this.camera),ko.draw(this.gl,this.scene,this.camera)}},n.prototype.screenToGpuPosition=function(t){var e=new lt;return e.x=(2*t.x-this.viewRect.width)/this.viewRect.width,e.y=-(2*t.y-this.viewRect.height)/this.viewRect.height,e},n.prototype.project=function(t){var e=this.camera.project(t);return e.x=(e.x+1)*this.viewRect.width/2,e.y=(1-e.y)*this.viewRect.height/2,e},n.prototype.unproject=function(t,e,n,i){void 0===i&&(i=new ht);var r=this.screenToGpuPosition(new lt(t,e));return this.camera.unproject(r.x,r.y,n,i)},n.prototype.getScaleByDepth=function(t,e){void 0===e&&(e=new lt(0,1));var n=this.camera.getScaleByDepth(t,e);return n/=new lt(this.viewRect.width*e.x,this.viewRect.height*e.y).length},n.prototype.calcMouseRay3D=function(){var t=this.screenToGpuPosition(this.mousePos);this.mouseRay3D=this.camera.getRay3D(t.x,t.y)},n.prototype.getObjectsInGlobalArea=function(t,e){var n=this,i=this.viewRect.clampPoint(t),r=this.viewRect.clampPoint(e);i.sub(this.viewRect.topLeft),r.sub(this.viewRect.topLeft);var o=i.clone().min(r),a=i.clone().max(r),s=new Bt(o.x,o.y,a.x-o.x,a.y-o.y);return this.scene.getComponentsInChildren(Br).filter((function(t){if(t===n.scene.transform)return!1;var e=t.getComponent(Fr);if(e){var i=e.selfWorldBounds.toPoints().every((function(t){var e=n.project(t);return s.contains(e.x,e.y)}));return i}var r=n.project(t.worldPosition);return s.contains(r.x,r.y)})).map((function(t){return t.gameObject}))},n.createNewScene=function(){var e=E.setValue(new Vr,{name:"Untitled"}).addComponent(Go);e.background.setTo(.2784,.2784,.2784),e.ambientColor.setTo(.4,.4,.4);var n=Vr.createPrimitive("Camera",{name:"Main Camera"});n.addComponent(Yr),n.transform.position=new ht(0,1,-10),e.gameObject.addChild(n);var i=E.setValue(new Vr,{name:"DirectionalLight"});return i.addComponent(Ao).shadowType=t.ShadowType.Hard_Shadows,i.transform.rx=50,i.transform.ry=-30,i.transform.y=3,e.gameObject.addChild(i),e},n}(Ti),qo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Mi(e,t),Object.defineProperty(e.prototype,"indicesData",{get:function(){return this.indices},set:function(t){this.indices=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attributes",{get:function(){return this._attributes},set:function(t){this._attributes=t},enumerable:!1,configurable:!0}),Ci([C],e.prototype,"indicesData",null),Ci([C],e.prototype,"attributes",null),e}(Tr),Yo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.points=[],e}return Mi(e,t),e.prototype.buildGeometry=function(){var t=this.points.length,e=[],n=[],i=[],r=[],o=[];t=Math.max(1,t);for(var a=0;a<t;a++){var s=this.points[a],u=s&&s.position||ht.ZERO,c=s&&s.color||yt.WHITE,l=s&&s.normal||ht.ZERO,h=s&&s.uv||lt.zero;e[a]=a,n.push(u.x,u.y,u.z),i.push(l.x,l.y,l.z),r.push(h.x,h.y),o.push(c.r,c.g,c.b,c.a)}this.positions=n,this.uvs=r,this.normals=i,this.indices=e,this.colors=o},Ci([C,n(),N("invalidateGeometry")],e.prototype,"points",void 0),e}(Tr),Zo=function(t){function e(){var e=t.call(this)||this;return e.name="Segment",e.segments=[],e}return Mi(e,t),e.prototype.addSegment=function(t){var e=new Qo;E.setValue(e,t),this.segments.push(e),this.invalidateGeometry()},e.prototype.buildGeometry=function(){for(var t=this.segments.length,e=[],n=[],i=[],r=0;r<t;r++){var o=this.segments[r],a=o.start||ht.ZERO,s=o.end||ht.ZERO,u=o.startColor||yt.WHITE,c=o.endColor||yt.WHITE;e.push(2*r,2*r+1),n.push(a.x,a.y,a.z,s.x,s.y,s.z),i.push(u.r,u.g,u.b,u.a,c.r,c.g,c.b,c.a)}this.positions=n,this.colors=i,this.indices=e},Ci([C,n({component:"OAVArray",tooltip:"在指定时间进行额外发射指定数量的粒子",componentParam:{defaultItem:function(){return new Qo}}}),N("invalidateGeometry")],e.prototype,"segments",void 0),e}(Tr),Qo=function(){function t(){this.start=new ht,this.end=new ht,this.startColor=new yt,this.endColor=new yt}return Ci([C,n({tooltip:"起点坐标"})],t.prototype,"start",void 0),Ci([C,n({tooltip:"终点坐标"})],t.prototype,"end",void 0),Ci([C,n({tooltip:"起点颜色"})],t.prototype,"startColor",void 0),Ci([C,n({tooltip:"终点颜色"})],t.prototype,"endColor",void 0),t}();Vr.registerPrimitive("Segment",(function(t){var e=t.addComponent(fo);e.geometry=new Zo,e.material=Lr.getDefault("Segment-Material")})),Vi.push({path:"3D Object/Segment",priority:-1e4,click:function(){return Vr.createPrimitive("Segment")}});var Jo=function(){function t(){this.u_diffuseInput=new yt}return Ci([C,n()],t.prototype,"u_diffuseInput",void 0),t}();Fn.shaderConfig.shaders.color={fragment:"precision mediump float;\r\n\r\nuniform vec4 u_diffuseInput;\r\n\r\nvoid main() \r\n{\r\n    gl_FragColor = u_diffuseInput;\r\n}\r\n",vertex:"attribute vec3 a_position;\r\n\r\nuniform mat4 u_modelMatrix;\r\nuniform mat4 u_viewProjection;\r\n\r\nvoid main()\r\n{\r\n    vec4 worldPosition = u_modelMatrix * vec4(a_position, 1.0);\r\n    gl_Position = u_viewProjection * worldPosition;\r\n}",cls:Jo};var $o=function(){function t(){this.u_color=new yt,this.u_PointSize=1}return Ci([C,n()],t.prototype,"u_color",void 0),Ci([C,n()],t.prototype,"u_PointSize",void 0),t}();Fn.shaderConfig.shaders.point={fragment:"precision mediump float;\r\n\r\nvarying vec4 v_color;\r\nuniform vec4 u_color;\r\n\r\nvoid main() \r\n{\r\n    gl_FragColor = v_color * u_color;\r\n}\r\n",vertex:"attribute vec3 a_position;\r\nattribute vec4 a_color;\r\n\r\nuniform float u_PointSize;\r\n\r\nuniform mat4 u_modelMatrix;\r\nuniform mat4 u_viewProjection;\r\n\r\nvarying vec4 v_color;\r\n\r\nvoid main() \r\n{\r\n    vec4 worldPosition = u_modelMatrix * vec4(a_position, 1.0);\r\n    gl_Position = u_viewProjection * worldPosition;\r\n    gl_PointSize = u_PointSize;\r\n\r\n    v_color = a_color;\r\n}",cls:$o};var ta=function(){function t(){this.u_segmentColor=new yt}return Ci([C,n()],t.prototype,"u_segmentColor",void 0),t}();Fn.shaderConfig.shaders.segment={fragment:"precision mediump float;\r\n\r\nvarying vec4 v_color;\r\n\r\nuniform vec4 u_segmentColor;\r\n\r\nvoid main() \r\n{\r\n    gl_FragColor = v_color * u_segmentColor;\r\n}",vertex:"attribute vec3 a_position;\r\nattribute vec4 a_color;\r\n\r\nuniform mat4 u_modelMatrix;\r\nuniform mat4 u_viewProjection;\r\n\r\nvarying vec4 v_color;\r\n\r\nvoid main() \r\n{\r\n    gl_Position = u_viewProjection * u_modelMatrix * vec4(a_position, 1.0);\r\n    v_color = a_color;\r\n}",cls:ta,renderParams:{renderMode:t.RenderMode.LINES,enableBlend:!0}},Lr.setDefault("Segment-Material",{shaderName:"segment"});var ea=function(){function t(){this.u_color=new yt,this.s_texture=zr.default}return Ci([C,n()],t.prototype,"u_color",void 0),Ci([n(),C],t.prototype,"s_texture",void 0),t}();Fn.shaderConfig.shaders.texture={fragment:"precision mediump float;\r\n\r\nuniform sampler2D s_texture;\r\nvarying vec2 v_uv;\r\n\r\nuniform vec4 u_color;\r\n\r\nvoid main() {\r\n\r\n    vec4 color = texture2D(s_texture, v_uv);\r\n    gl_FragColor = color * u_color;\r\n}\r\n",vertex:"attribute vec3 a_position;\r\nattribute vec2 a_uv;\r\n\r\nvarying vec2 v_uv;\r\nuniform mat4 u_modelMatrix;\r\nuniform mat4 u_viewProjection;\r\n\r\nvoid main() \r\n{\r\n    gl_Position = u_viewProjection * u_modelMatrix * vec4(a_position, 1.0);\r\n    v_uv = a_uv;\r\n}",cls:ea};var na=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.radius=.5,e.height=1,e.segmentsW=16,e.segmentsH=15,e.yUp=!0,e.name="Capsule",e}return Mi(e,t),e.prototype.buildGeometry=function(){for(var t,e,n,i,r,o=[],a=[],s=[],u=0,c=0;c<=this.segmentsH;++c){t=u;for(var l=Math.PI*c/this.segmentsH,h=-this.radius*Math.cos(l),p=this.radius*Math.sin(l),f=0;f<=this.segmentsW;++f){var d=2*Math.PI*f/this.segmentsW,m=p*Math.cos(d),y=p*Math.sin(d),v=1/Math.sqrt(m*m+y*y+h*h),g=Math.sqrt(y*y+m*m),_=c>this.segmentsH/2?this.height/2:-this.height/2;this.yUp?(i=0,r=g>.007?m/g:0,e=-h,n=y):(i=g>.007?m/g:0,r=0,e=y,n=h),f===this.segmentsW?(o[u]=o[t],o[u+1]=o[t+1],o[u+2]=o[t+2],a[u]=.5*(a[t]+m*v),a[u+1]=.5*(a[t+1]+e*v),a[u+2]=.5*(a[t+2]+n*v),s[u]=.5*(s[t]+g>.007?-y/g:1),s[u+1]=.5*(s[t+1]+i),s[u+2]=.5*(s[t+2]+r)):(o[u]=m,o[u+1]=this.yUp?e-_:e,o[u+2]=this.yUp?n:n+_,a[u]=m*v,a[u+1]=e*v,a[u+2]=n*v,s[u]=g>.007?-y/g:1,s[u+1]=i,s[u+2]=r),f>0&&c>0&&c===this.segmentsH&&(o[u]=o[t],o[u+1]=o[t+1],o[u+2]=o[t+2]),u+=3}}this.positions=o,this.normals=a,this.tangents=s;var b=this.buildUVs();this.uvs=b,this.buildIndices()},e.prototype.buildIndices=function(){for(var t=[],e=0,n=0;n<=this.segmentsH;++n)for(var i=0;i<=this.segmentsW;++i)if(i>0&&n>0){var r=(this.segmentsW+1)*n+i,o=(this.segmentsW+1)*n+i-1,a=(this.segmentsW+1)*(n-1)+i-1,s=(this.segmentsW+1)*(n-1)+i;n===this.segmentsH?(t[e++]=r,t[e++]=a,t[e++]=s):1===n?(t[e++]=r,t[e++]=o,t[e++]=a):(t[e++]=r,t[e++]=o,t[e++]=a,t[e++]=r,t[e++]=a,t[e++]=s)}this.indices=t},e.prototype.buildUVs=function(){for(var t=[],e=0,n=0;n<=this.segmentsH;++n)for(var i=0;i<=this.segmentsW;++i)t[e++]=i/this.segmentsW,t[e++]=n/this.segmentsH;return t},Ci([C,n(),N("invalidateGeometry")],e.prototype,"radius",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"height",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"segmentsW",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"segmentsH",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"yUp",void 0),e}(Tr);Tr.setDefault("Capsule",new na),Vr.registerPrimitive("Capsule",(function(t){t.addComponent(fo).geometry=Tr.getDefault("Capsule")})),Vi.push({path:"3D Object/Capsule",priority:-3,click:function(){return Vr.createPrimitive("Capsule")}});var ia=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.topRadius=.5,e.bottomRadius=.5,e.height=2,e.segmentsW=16,e.segmentsH=1,e.topClosed=!0,e.bottomClosed=!0,e.surfaceClosed=!0,e.yUp=!0,e.name="Cylinder",e}return Mi(e,t),e.prototype.buildGeometry=function(){var t,e,n,i,r,o,a,s,u,c,l=0,h=0,p=0,f=[],d=[],m=[],y=2*Math.PI/this.segmentsW;if(this.topClosed&&this.topRadius>0)for(r=-.5*this.height,t=0;t<=this.segmentsW;++t)this.yUp?(u=1,c=0,a=-r,s=0):(u=0,c=-1,a=0,s=r),P(0,a,s,0,u,c,1,0,0),h=t*y,n=this.topRadius*Math.cos(h),i=this.topRadius*Math.sin(h),this.yUp?(a=-r,s=i):(a=i,s=r),t===this.segmentsW?P(f[p+3],f[p+4],f[p+5],0,u,c,1,0,0):P(n,a,s,0,u,c,1,0,0);if(this.bottomClosed&&this.bottomRadius>0)for(r=.5*this.height,p=l,t=0;t<=this.segmentsW;++t)this.yUp?(u=-1,c=0,a=-r,s=0):(u=0,c=1,a=0,s=r),P(0,a,s,0,u,c,1,0,0),h=t*y,n=this.bottomRadius*Math.cos(h),i=this.bottomRadius*Math.sin(h),this.yUp?(a=-r,s=i):(a=i,s=r),t===this.segmentsW?P(n,f[p+1],f[p+2],0,u,c,1,0,0):P(n,a,s,0,u,c,1,0,0);var v=this.bottomRadius-this.topRadius,g=v/this.height,_=0===g?1:this.height/v;if(this.surfaceClosed){var b=void 0,x=void 0,w=void 0,S=void 0;for(e=0;e<=this.segmentsH;++e)for(o=this.topRadius-e/this.segmentsH*(this.topRadius-this.bottomRadius),r=-this.height/2+e/this.segmentsH*this.height,p=l,t=0;t<=this.segmentsW;++t)h=t*y,n=o*Math.cos(h),i=o*Math.sin(h),b=_*Math.cos(h),x=_*Math.sin(h),this.yUp?(u=0,c=-b,a=-r,s=i,w=g,S=x):(u=-b,c=0,a=i,s=r,w=x,S=g),t===this.segmentsW?P(f[p],f[p+1],f[p+2],b,g,x,x,u,c):P(n,a,s,b,w,S,-x,u,c)}function P(t,e,n,i,r,o,a,s,u){f[l]=t,f[l+1]=e,f[l+2]=n,d[l]=i,d[l+1]=r,d[l+2]=o,m[l]=a,m[l+1]=s,m[l+2]=u,l+=3}this.positions=f,this.normals=d,this.tangents=m;var M=this.buildUVs();this.uvs=M;var C=this.buildIndices();this.indices=C},e.prototype.buildIndices=function(){var t,e,n=0,i=[],r=0;if(this.topClosed&&this.topRadius>0)for(t=0;t<=this.segmentsW;++t)n+=2,t>0&&c(n-1,n-3,n-2);if(this.bottomClosed&&this.bottomRadius>0)for(t=0;t<=this.segmentsW;++t)n+=2,t>0&&c(n-2,n-3,n-1);if(this.surfaceClosed){var o=void 0,a=void 0,s=void 0,u=void 0;for(e=0;e<=this.segmentsH;++e)for(t=0;t<=this.segmentsW;++t)n++,t>0&&e>0&&(o=n-1,s=(a=n-2)-this.segmentsW-1,u=o-this.segmentsW-1,c(o,a,s),c(o,s,u))}return i;function c(t,e,n){i[r++]=t,i[r++]=e,i[r++]=n}},e.prototype.buildUVs=function(){var t,e,n,i,r,o=[],a=2*Math.PI/this.segmentsW,s=0;if(this.topClosed)for(t=0;t<=this.segmentsW;++t)r=t*a,n=.5+.5*-Math.cos(r),i=.5+.5*Math.sin(r),o[s++]=.5,o[s++]=.5,o[s++]=n,o[s++]=i;if(this.bottomClosed)for(t=0;t<=this.segmentsW;++t)r=t*a,n=.5+.5*Math.cos(r),i=.5+.5*Math.sin(r),o[s++]=.5,o[s++]=.5,o[s++]=n,o[s++]=i;if(this.surfaceClosed)for(e=0;e<=this.segmentsH;++e)for(t=0;t<=this.segmentsW;++t)o[s++]=t/this.segmentsW,o[s++]=e/this.segmentsH;return o},Ci([C,n(),N("invalidateGeometry")],e.prototype,"topRadius",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"bottomRadius",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"height",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"segmentsW",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"segmentsH",void 0),Ci([n(),C,N("invalidateGeometry")],e.prototype,"topClosed",void 0),Ci([n(),C,N("invalidateGeometry")],e.prototype,"bottomClosed",void 0),Ci([n(),C,N("invalidateGeometry")],e.prototype,"surfaceClosed",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"yUp",void 0),e}(Tr);Tr.setDefault("Cylinder",new ia),Vr.registerPrimitive("Cylinder",(function(t){t.addComponent(fo).geometry=Tr.getDefault("Cylinder")})),Vi.push({path:"3D Object/Cylinder",priority:-4,click:function(){return Vr.createPrimitive("Cylinder")}});var ra=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.__class__="feng3d.ConeGeometry",e.name="Cone",e.topRadius=0,e.topClosed=!1,e.surfaceClosed=!0,e}return Mi(e,t),e}(ia);Tr.setDefault("Cone",new ra),Vr.registerPrimitive("Cone",(function(t){t.addComponent(fo).geometry=Tr.getDefault("Cone")})),Vi.push({path:"3D Object/Cone",priority:-1e4,click:function(){return Vr.createPrimitive("Cone")}});var oa=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Cube",e.width=1,e.height=1,e.depth=1,e.segmentsW=1,e.segmentsH=1,e.segmentsD=1,e.tile6=!1,e}return Mi(e,t),e.prototype.buildGeometry=function(){var t=this.buildPosition();this.positions=t;var e=this.buildNormal();this.normals=e;var n=this.buildTangent();this.tangents=n;var i=this.buildUVs();this.uvs=i;var r=this.buildIndices();this.indices=r},e.prototype.buildPosition=function(){var t,e,n,i=[],r=0,o=this.width/2,a=this.height/2,s=this.depth/2,u=this.width/this.segmentsW,c=this.height/this.segmentsH,l=this.depth/this.segmentsD;for(t=0;t<=this.segmentsW;t++)for(n=t*u-o,e=0;e<=this.segmentsH;e++)i[r++]=n,i[r++]=e*c-a,i[r++]=-s,i[r++]=n,i[r++]=e*c-a,i[r++]=s;for(t=0;t<=this.segmentsW;t++)for(n=t*u-o,e=0;e<=this.segmentsD;e++)i[r++]=n,i[r++]=a,i[r++]=e*l-s,i[r++]=n,i[r++]=-a,i[r++]=e*l-s;for(t=0;t<=this.segmentsD;t++)for(n=s-t*l,e=0;e<=this.segmentsH;e++)i[r++]=-o,i[r++]=e*c-a,i[r++]=n,i[r++]=o,i[r++]=e*c-a,i[r++]=n;return i},e.prototype.buildNormal=function(){var t,e,n=[],i=0;for(t=0;t<=this.segmentsW;t++)for(e=0;e<=this.segmentsH;e++)n[i++]=0,n[i++]=0,n[i++]=-1,n[i++]=0,n[i++]=0,n[i++]=1;for(t=0;t<=this.segmentsW;t++)for(e=0;e<=this.segmentsD;e++)n[i++]=0,n[i++]=1,n[i++]=0,n[i++]=0,n[i++]=-1,n[i++]=0;for(t=0;t<=this.segmentsD;t++)for(e=0;e<=this.segmentsH;e++)n[i++]=-1,n[i++]=0,n[i++]=0,n[i++]=1,n[i++]=0,n[i++]=0;return n},e.prototype.buildTangent=function(){var t,e,n=[],i=0;for(t=0;t<=this.segmentsW;t++)for(e=0;e<=this.segmentsH;e++)n[i++]=1,n[i++]=0,n[i++]=0,n[i++]=-1,n[i++]=0,n[i++]=0;for(t=0;t<=this.segmentsW;t++)for(e=0;e<=this.segmentsD;e++)n[i++]=1,n[i++]=0,n[i++]=0,n[i++]=1,n[i++]=0,n[i++]=0;for(t=0;t<=this.segmentsD;t++)for(e=0;e<=this.segmentsH;e++)n[i++]=0,n[i++]=0,n[i++]=-1,n[i++]=0,n[i++]=0,n[i++]=1;return n},e.prototype.buildIndices=function(){var t,e,n,i,r,o,a=[],s=0,u=0;for(r=0;r<=this.segmentsW;r++)for(o=0;o<=this.segmentsH;o++)r&&o&&(n=(t=2*((r-1)*(this.segmentsH+1)+(o-1)))+2,i=(e=2*(r*(this.segmentsH+1)+(o-1)))+2,a[u++]=t,a[u++]=n,a[u++]=i,a[u++]=t,a[u++]=i,a[u++]=e,a[u++]=e+1,a[u++]=i+1,a[u++]=n+1,a[u++]=e+1,a[u++]=n+1,a[u++]=t+1);for(s+=2*(this.segmentsW+1)*(this.segmentsH+1),r=0;r<=this.segmentsW;r++)for(o=0;o<=this.segmentsD;o++)r&&o&&(n=(t=s+2*((r-1)*(this.segmentsD+1)+(o-1)))+2,i=(e=s+2*(r*(this.segmentsD+1)+(o-1)))+2,a[u++]=t,a[u++]=n,a[u++]=i,a[u++]=t,a[u++]=i,a[u++]=e,a[u++]=e+1,a[u++]=i+1,a[u++]=n+1,a[u++]=e+1,a[u++]=n+1,a[u++]=t+1);for(s+=2*(this.segmentsW+1)*(this.segmentsD+1),r=0;r<=this.segmentsD;r++)for(o=0;o<=this.segmentsH;o++)r&&o&&(n=(t=s+2*((r-1)*(this.segmentsH+1)+(o-1)))+2,i=(e=s+2*(r*(this.segmentsH+1)+(o-1)))+2,a[u++]=t,a[u++]=n,a[u++]=i,a[u++]=t,a[u++]=i,a[u++]=e,a[u++]=e+1,a[u++]=i+1,a[u++]=n+1,a[u++]=e+1,a[u++]=n+1,a[u++]=t+1);return a},e.prototype.buildUVs=function(){var t,e,n,i,r,o,a,s,u,c,l,h,p,f=[];for(this.tile6?(i=o=1/3,r=a=.5):(i=r=1,o=a=0),n=0,s=Number(o),u=Number(a),c=2*o,l=0*a,h=i/this.segmentsW,p=r/this.segmentsH,t=0;t<=this.segmentsW;t++)for(e=0;e<=this.segmentsH;e++)f[n++]=s+t*h,f[n++]=u+(r-e*p),f[n++]=c+(i-t*h),f[n++]=l+(r-e*p);for(s=Number(o),u=0*a,c=0*o,l=0*a,h=i/this.segmentsW,p=r/this.segmentsD,t=0;t<=this.segmentsW;t++)for(e=0;e<=this.segmentsD;e++)f[n++]=s+t*h,f[n++]=u+(r-e*p),f[n++]=c+t*h,f[n++]=l+e*p;for(s=0*o,u=Number(a),c=2*o,l=Number(a),h=i/this.segmentsD,p=r/this.segmentsH,t=0;t<=this.segmentsD;t++)for(e=0;e<=this.segmentsH;e++)f[n++]=s+t*h,f[n++]=u+(r-e*p),f[n++]=c+(i-t*h),f[n++]=l+(r-e*p);return f},Ci([C,n(),N("invalidateGeometry")],e.prototype,"width",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"height",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"depth",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"segmentsW",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"segmentsH",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"segmentsD",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"tile6",void 0),e}(Tr);Tr.setDefault("Cube",new oa),Vr.registerPrimitive("Cube",(function(t){t.addComponent(fo).geometry=Tr.getDefault("Cube")})),Vi.push({path:"3D Object/Cube",priority:-1,click:function(){return Vr.createPrimitive("Cube")}});var aa=function(t){function e(e,n,i,r){void 0===n&&(n=8),void 0===i&&(i=8),void 0===r&&(r=!1);for(var o=t.call(this)||this,a=[],s=[],u=[],c=n+1,l=0;l<=i;l++)for(var h=l/i,p=0;p<=n;p++){var f=p/n;u.push(f,h);var d=e(f,h);if(a.push(d.x,d.y,d.z),l<i&&p<n){var m=l*c+p,y=l*c+p+1,v=(l+1)*c+p+1,g=(l+1)*c+p;s.push(m,y,g),s.push(y,v,g)}}if(r){a=a.concat(a),u=u.concat(u);for(var _=(i+1)*(n+1),b=(l=0,s.length);l<b;l+=3)s.push(_+s[l],_+s[l+2],_+s[l+1])}return o.indices=s,o.positions=a,o.uvs=u,o.invalidateGeometry(),o}return Mi(e,t),e.prototype.buildGeometry=function(){for(var t=this.positions,e=0,n=t.length/2;e<n;e++)t[e+n]=t[e];this.positions=t,this.normals=Cr.createVertexNormals(this.indices,this.positions,!0),this.tangents=Cr.createVertexTangents(this.indices,this.positions,this.uvs,!0)},e}(Tr),sa=function(t){function e(){var e=t.call(this)||this,n=.5;return e.positions=[-.5,n,0,n,n,0,n,-.5,0,-.5,-.5,0],e.uvs=[0,0,1,0,1,1,0,1],e.indices=[0,1,2,0,2,3],e.normals=Cr.createVertexNormals(e.indices,e.positions,!0),e.tangents=Cr.createVertexTangents(e.indices,e.positions,e.uvs,!0),e}return Mi(e,t),e}(Tr);Tr.setDefault("Quad",new sa),Vr.registerPrimitive("Quad",(function(t){t.addComponent(fo).geometry=Tr.getDefault("Quad")})),Vi.push({path:"3D Object/Quad",priority:-6,click:function(){return Vr.createPrimitive("Quad")}});var ua=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.radius=.5,e.segmentsW=16,e.segmentsH=12,e.yUp=!0,e.name="Sphere",e}return Mi(e,t),e.prototype.buildGeometry=function(){for(var t,e,n,i,r,o=[],a=[],s=[],u=0,c=0;c<=this.segmentsH;++c){t=u;for(var l=Math.PI*c/this.segmentsH,h=-this.radius*Math.cos(l),p=this.radius*Math.sin(l),f=0;f<=this.segmentsW;++f){var d=2*Math.PI*f/this.segmentsW,m=p*Math.cos(d),y=p*Math.sin(d),v=1/Math.sqrt(m*m+y*y+h*h),g=Math.sqrt(y*y+m*m);this.yUp?(i=0,r=g>.007?m/g:0,e=-h,n=y):(i=g>.007?m/g:0,r=0,e=y,n=h),f===this.segmentsW?(o[u]=o[t],o[u+1]=o[t+1],o[u+2]=o[t+2],a[u]=a[t]+m*v*.5,a[u+1]=a[t+1]+e*v*.5,a[u+2]=a[t+2]+n*v*.5,s[u]=g>.007?-y/g:1,s[u+1]=i,s[u+2]=r):(o[u]=m,o[u+1]=e,o[u+2]=n,a[u]=m*v,a[u+1]=e*v,a[u+2]=n*v,s[u]=g>.007?-y/g:1,s[u+1]=i,s[u+2]=r),f>0&&c>0&&c===this.segmentsH&&(o[u]=o[t],o[u+1]=o[t+1],o[u+2]=o[t+2]),u+=3}}this.positions=o,this.normals=a,this.tangents=s;var _=this.buildUVs();this.uvs=_;var b=this.buildIndices();this.indices=b},e.prototype.buildIndices=function(){for(var t=[],e=0,n=0;n<=this.segmentsH;++n)for(var i=0;i<=this.segmentsW;++i)if(i>0&&n>0){var r=(this.segmentsW+1)*n+i,o=(this.segmentsW+1)*n+i-1,a=(this.segmentsW+1)*(n-1)+i-1,s=(this.segmentsW+1)*(n-1)+i;n===this.segmentsH?(t[e++]=r,t[e++]=a,t[e++]=s):1===n?(t[e++]=r,t[e++]=o,t[e++]=a):(t[e++]=r,t[e++]=o,t[e++]=a,t[e++]=r,t[e++]=a,t[e++]=s)}return t},e.prototype.buildUVs=function(){for(var t=[],e=0,n=0;n<=this.segmentsH;++n)for(var i=0;i<=this.segmentsW;++i)t[e++]=i/this.segmentsW,t[e++]=n/this.segmentsH;return t},Ci([C,n(),N("invalidateGeometry")],e.prototype,"radius",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"segmentsW",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"segmentsH",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"yUp",void 0),e}(Tr);Tr.setDefault("Sphere",new ua),Vr.registerPrimitive("Sphere",(function(t){t.addComponent(fo).geometry=Tr.getDefault("Sphere")})),Vi.push({path:"3D Object/Sphere",priority:-2,click:function(){return Vr.createPrimitive("Sphere")}});var ca=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.__class__="feng3d.TorusGeometry",e.radius=.5,e.tubeRadius=.1,e.segmentsR=16,e.segmentsT=8,e.yUp=!0,e.name="Torus",e._vertexPositionStride=3,e._vertexNormalStride=3,e._vertexTangentStride=3,e}return Mi(e,t),e.prototype.addVertex=function(t,e,n,i,r,o,a,s,u,c){this._vertexPositionData[t*this._vertexPositionStride]=e,this._vertexPositionData[t*this._vertexPositionStride+1]=n,this._vertexPositionData[t*this._vertexPositionStride+2]=i,this._vertexNormalData[t*this._vertexNormalStride]=r,this._vertexNormalData[t*this._vertexNormalStride+1]=o,this._vertexNormalData[t*this._vertexNormalStride+2]=a,this._vertexTangentData[t*this._vertexTangentStride]=s,this._vertexTangentData[t*this._vertexTangentStride+1]=u,this._vertexTangentData[t*this._vertexTangentStride+2]=c},e.prototype.addTriangleClockWise=function(t,e,n,i){this._rawIndices[3*t]=e,this._rawIndices[3*t+1]=n,this._rawIndices[3*t+2]=i},e.prototype.buildGeometry=function(){var t,e,n,i,r,o,a,s,u,c;this._numVertices=0,this._vertexIndex=0,this._currentTriangleIndex=0,this._numVertices=(this.segmentsT+1)*(this.segmentsR+1),this.segmentsT,this.segmentsR,this._vertexPositionData=[],this._vertexNormalData=[],this._vertexTangentData=[],this._rawIndices=[],this.buildUVs();var l,h,p,f,d,m,y,v,g,_,b,x,w=2*Math.PI/this.segmentsR,S=2*Math.PI/this.segmentsT;for(e=0;e<=this.segmentsT;++e)for(y=e*(this.segmentsR+1)*this._vertexPositionStride,t=0;t<=this.segmentsR;++t)this._vertexIndex=e*(this.segmentsR+1)+t,u=t*w,c=e*S,o=(x=Math.cos(c))*Math.cos(u),a=x*Math.sin(u),s=Math.sin(c),n=this.radius*Math.cos(u)+this.tubeRadius*o,i=this.radius*Math.sin(u)+this.tubeRadius*a,r=e===this.segmentsT?0:this.tubeRadius*s,this.yUp?(d=-s,m=a,p=0,f=x?o/x:n/this.radius,l=-r,h=i):(d=a,m=s,p=x?o/x:n/this.radius,f=0,l=i,h=r),t===this.segmentsR?this.addVertex(this._vertexIndex,n,this._vertexPositionData[y+1],this._vertexPositionData[y+2],o,d,m,-(x?a/x:i/this.radius),p,f):this.addVertex(this._vertexIndex,n,l,h,o,d,m,-(x?a/x:i/this.radius),p,f),t>0&&e>0&&(v=this._vertexIndex,_=(g=this._vertexIndex-1)-this.segmentsR-1,b=v-this.segmentsR-1,this.addTriangleClockWise(this._currentTriangleIndex++,v,g,_),this.addTriangleClockWise(this._currentTriangleIndex++,v,_,b));this.positions=this._vertexPositionData,this.normals=this._vertexNormalData,this.tangents=this._vertexTangentData,this.indices=this._rawIndices},e.prototype.buildUVs=function(){var t,e,n=[],i=0;for(e=0;e<=this.segmentsT;++e)for(t=0;t<=this.segmentsR;++t)n[2*(i=e*(this.segmentsR+1)+t)]=t/this.segmentsR,n[2*i+1]=e/this.segmentsT;this.uvs=n},Ci([C,n(),N("invalidateGeometry")],e.prototype,"radius",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"tubeRadius",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"segmentsR",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"segmentsT",void 0),Ci([C,n(),N("invalidateGeometry")],e.prototype,"yUp",void 0),e}(Tr);Tr.setDefault("Torus",new ca),Vr.registerPrimitive("Torus",(function(t){t.addComponent(fo).geometry=Tr.getDefault("Torus")})),Vi.push({path:"3D Object/Torus",priority:-1e4,click:function(){return Vr.createPrimitive("Torus")}});var la=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.objects=[],e}return Mi(e,t),e.prototype.draw=function(t,e){var n=bi.clientX,i=bi.clientY,r=-(n-e.x),o=-(e.height-(i-e.y));t.clearColor(0,0,0,0),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.viewport(r,o,e.width,e.height),this.objects.length=1,t.enable(t.SCISSOR_TEST),t.scissor(0,0,1,1),t.disable(t.SCISSOR_TEST);var a=new Uint8Array(4);t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,a);var s=a[0]+255*a[1]+255*a[2]*255+255*a[3]*255*255-a[3];return this.objects[s]},e.prototype.drawRenderables=function(t,e){if(e.gameObject.mouseEnabled){var n=e.gameObject,i=this.objects.length;this.objects[i]=n,e.renderAtomic.uniforms.u_objectID=i}},e.prototype.drawGameObject=function(t,e){},e}(X),ha=new la;Z.on("asset.shaderChanged",(function(){Fn.clearCache()}));var pa=function(){function t(){}return t.prototype.getBlenditems=function(t,e){},t.prototype.getActiveRenderers=function(t,e){for(var n=[],i=e.frustum,r=[t.gameObject];r.length>0;){var o=r.pop();if(o.activeSelf){var a=o.getComponent(Fr);a&&a.enabled&&a.selfWorldBounds&&i.intersectsBox(a.selfWorldBounds)&&n.push(a),r=r.concat(o.children)}}return n},t}(),fa=new pa;E.setValue(Fn.shaderConfig,{shaders:{mouse:{fragment:"precision highp float;\r\n\r\nuniform int u_objectID;\r\n\r\nvoid main()\r\n{\r\n    //支持 255*255*255*255 个索引\r\n    const float invColor = 1.0/255.0;\r\n    float temp = float(u_objectID);\r\n    temp = floor(temp) * invColor;\r\n    gl_FragColor.x = fract(temp);\r\n    temp = floor(temp) * invColor;\r\n    gl_FragColor.y = fract(temp);\r\n    temp = floor(temp) * invColor;\r\n    gl_FragColor.z = fract(temp);\r\n    temp = floor(temp) * invColor;\r\n    gl_FragColor.w = fract(temp);\r\n}",vertex:"attribute vec3 a_position;\r\n\r\nuniform mat4 u_modelMatrix;\r\nuniform mat4 u_viewProjection;\r\n\r\nvoid main()\r\n{\r\n    vec4 worldPosition = u_modelMatrix * vec4(a_position, 1.0);\r\n    gl_Position = u_viewProjection * worldPosition;\r\n}"},outline:{fragment:"precision mediump float;\r\n\r\nuniform vec4 u_outlineColor;\r\n\r\nvoid main() \r\n{\r\n    gl_FragColor = u_outlineColor;\r\n}",vertex:"precision mediump float;  \r\n\r\n//坐标属性\r\nattribute vec3 a_position;\r\nattribute vec3 a_normal;\r\n\r\n#include<uv_pars_vert>\r\n\r\nuniform mat4 u_modelMatrix;\r\nuniform mat4 u_ITModelMatrix;\r\nuniform vec3 u_cameraPos;\r\nuniform mat4 u_viewProjection;\r\nuniform float u_scaleByDepth;\r\nuniform float u_outlineMorphFactor;\r\n\r\n#include<skeleton_pars_vert>\r\n#include<particle_pars_vert>\r\n\r\nuniform float u_outlineSize;\r\n\r\nvoid main() \r\n{\r\n    vec4 position = vec4(a_position, 1.0);\r\n\r\n    #include<uv_vert>\r\n\r\n    #include<skeleton_vert>\r\n    #include<particle_vert>\r\n    \r\n    vec3 normal = a_normal;\r\n\r\n    //全局坐标\r\n    vec4 worldPosition = u_modelMatrix * position;\r\n    //全局法线\r\n    vec3 globalNormal = normalize((u_ITModelMatrix * vec4(normal, 0.0)).xyz);\r\n\r\n    float depth = distance(worldPosition.xyz , u_cameraPos.xyz);\r\n    \r\n    vec3 offsetDir = mix(globalNormal, normalize(worldPosition.xyz), u_outlineMorphFactor);\r\n    //摄像机远近保持粗细一致\r\n    offsetDir = offsetDir * depth * u_scaleByDepth;\r\n    //描边宽度\r\n    offsetDir = offsetDir * u_outlineSize;\r\n\r\n    worldPosition.xyz = worldPosition.xyz + offsetDir;//\r\n\r\n    //计算投影坐标\r\n    gl_Position = u_viewProjection * worldPosition;\r\n}"},Particles_Additive:{fragment:"precision mediump float;\r\n\r\nvarying vec2 v_uv;\r\n\r\nuniform vec4 _TintColor;\r\nuniform sampler2D _MainTex;\r\nuniform vec4 _MainTex_ST;\r\n\r\n#include<particle_pars_frag>\r\n\r\nvoid main()\r\n{\r\n    vec4 finalColor = vec4(1.0, 1.0, 1.0, 1.0);\r\n\r\n    #include<particle_frag>\r\n\r\n    vec2 uv = v_uv;\r\n    uv = uv * _MainTex_ST.xy + _MainTex_ST.zw;\r\n    finalColor = 2.0 * finalColor * _TintColor * texture2D(_MainTex, uv);\r\n\r\n    gl_FragColor = finalColor;\r\n}",vertex:"precision mediump float;  \r\n\r\n//坐标属性\r\nattribute vec3 a_position;\r\nattribute vec2 a_uv;\r\n\r\nuniform mat4 u_modelMatrix;\r\nuniform mat4 u_ITModelMatrix;\r\nuniform mat4 u_viewProjection;\r\n\r\nvarying vec2 v_uv;\r\n\r\n#include<particle_pars_vert>\r\n\r\nvoid main() \r\n{\r\n    vec4 position = vec4(a_position, 1.0);\r\n    //输出uv\r\n    v_uv = a_uv;\r\n    \r\n    #include<particle_vert>\r\n\r\n    //获取全局坐标\r\n    vec4 worldPosition = u_modelMatrix * position;\r\n    //计算投影坐标\r\n    gl_Position = u_viewProjection * worldPosition;\r\n}"},Particles_AlphaBlendedPremultiply:{fragment:"precision mediump float;\r\n\r\nvarying vec2 v_uv;\r\n\r\nuniform sampler2D _MainTex;\r\nuniform vec4 _MainTex_ST;\r\n\r\n#include<particle_pars_frag>\r\n\r\nvoid main()\r\n{\r\n    vec4 finalColor = vec4(1.0, 1.0, 1.0, 1.0);\r\n\r\n    #include<particle_frag>\r\n\r\n    vec2 uv = v_uv;\r\n    uv = uv * _MainTex_ST.xy + _MainTex_ST.zw;\r\n\r\n    finalColor = finalColor *  texture2D(_MainTex, uv) * finalColor.a;\r\n    gl_FragColor = finalColor;\r\n}",vertex:"precision mediump float;  \r\n\r\n//坐标属性\r\nattribute vec3 a_position;\r\nattribute vec2 a_uv;\r\n\r\nuniform mat4 u_modelMatrix;\r\nuniform mat4 u_ITModelMatrix;\r\nuniform mat4 u_viewProjection;\r\n\r\nvarying vec2 v_uv;\r\n\r\n#include<particle_pars_vert>\r\n\r\nvoid main() \r\n{\r\n    vec4 position = vec4(a_position, 1.0);\r\n    //输出uv\r\n    v_uv = a_uv;\r\n    \r\n    #include<particle_vert>\r\n\r\n    //获取全局坐标\r\n    vec4 worldPosition = u_modelMatrix * position;\r\n    //计算投影坐标\r\n    gl_Position = u_viewProjection * worldPosition;\r\n}"},shadow:{fragment:"precision mediump float;\r\n\r\nvarying vec3 v_worldPosition;\r\n\r\nuniform int u_lightType;\r\nuniform vec3 u_lightPosition;\r\nuniform float u_shadowCameraNear;\r\nuniform float u_shadowCameraFar;\r\n\r\n// @see https://github.com/mrdoob/three.js/blob/dev/src/renderers/shaders/ShaderChunk/packing.glsl\r\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\r\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\r\nconst float ShiftRight8 = 1. / 256.;\r\nvec4 packDepthToRGBA( const in float v ) \r\n{\r\n\tvec4 r = vec4( fract( v * PackFactors ), v );\r\n\tr.yzw -= r.xyz * ShiftRight8; // tidy overflow\r\n\treturn r * PackUpscale;\r\n}\r\n\r\nvoid main() \r\n{\r\n    vec3 lightToPosition = (v_worldPosition - u_lightPosition);\r\n    float dp = ( length( lightToPosition ) - u_shadowCameraNear ) / ( u_shadowCameraFar - u_shadowCameraNear ); // need to clamp?\r\n    gl_FragColor = packDepthToRGBA( dp );\r\n}",vertex:"precision mediump float;  \r\n\r\nattribute vec3 a_position;\r\n\r\n#include<uv_pars_vert>\r\n\r\nuniform mat4 u_modelMatrix;\r\nuniform mat4 u_viewProjection;\r\n\r\n#include<skeleton_pars_vert>\r\n#include<particle_pars_vert>\r\n\r\nvarying vec3 v_worldPosition;\r\n\r\nvoid main() \r\n{\r\n    vec4 position = vec4(a_position, 1.0);\r\n\r\n    #include<uv_vert>\r\n\r\n    #include<skeleton_vert>\r\n    #include<particle_vert>\r\n\r\n    vec4 worldPosition = u_modelMatrix * position;\r\n    gl_Position = u_viewProjection * worldPosition;\r\n    v_worldPosition = worldPosition.xyz;\r\n}"},skybox:{fragment:"precision highp float;\r\n\r\nuniform samplerCube s_skyboxTexture;\r\nuniform vec3 u_cameraPos;\r\n\r\nvarying vec3 v_worldPos;\r\n\r\nvoid main()\r\n{\r\n    vec3 cameraDir = normalize(u_cameraPos.xyz - v_worldPos);\r\n    gl_FragColor = textureCube(s_skyboxTexture, -cameraDir);\r\n}",vertex:"attribute vec3 a_position;\r\n\r\nuniform vec3 u_cameraPos;\r\nuniform mat4 u_viewProjection;\r\n\r\nuniform float u_skyBoxSize;\r\n\r\nvarying vec3 v_worldPos;\r\n\r\nvoid main()\r\n{\r\n    vec3 worldPos = a_position.xyz * u_skyBoxSize + u_cameraPos.xyz;\r\n    gl_Position = u_viewProjection * vec4(worldPos.xyz, 1.0);\r\n    v_worldPos = worldPos;\r\n}"},terrain:{fragment:"precision mediump float;\r\n\r\nvarying vec2 v_uv;\r\nvarying vec3 v_worldPosition;\r\nuniform vec3 u_cameraPos;\r\n\r\n#include<normal_pars_frag>\r\n#include<diffuse_pars_frag>\r\n#include<alphatest_pars_frag>\r\n\r\n#include<terrain_pars_frag>\r\n\r\n#include<ambient_pars_frag>\r\n#include<specular_pars_frag>\r\n#include<lights_pars_frag>\r\n\r\n#include<envmap_pars_frag>\r\n#include<fog_pars_frag>\r\n\r\nvoid main()\r\n{\r\n    vec4 finalColor = vec4(1.0, 1.0, 1.0, 1.0);\r\n\r\n    #include<normal_frag>\r\n    #include<diffuse_frag>\r\n    #include<alphatest_frag>\r\n\r\n    #include<terrain_frag>\r\n\r\n    finalColor = diffuseColor;\r\n\r\n    #include<ambient_frag>\r\n    #include<specular_frag>\r\n    #include<lights_frag>\r\n\r\n    #include<envmap_frag>\r\n    #include<fog_frag>\r\n\r\n    gl_FragColor = finalColor;\r\n}",vertex:"precision mediump float;  \r\n\r\n#include<position_pars_vert>\r\n#include<normal_pars_vert>\r\n#include<tangent_pars_vert>\r\n#include<uv_pars_vert>\r\n//\r\n#include<worldposition_pars_vert>\r\n#include<project_pars_vert>\r\n//\r\n#include<normalmap_pars_vert>\r\n//\r\n#include<lights_pars_vert>\r\n#include<pointsize_pars_vert>\r\n\r\nvoid main() \r\n{\r\n    // 初始化\r\n    #include<position_vert>\r\n    #include<normal_vert>\r\n    #include<tangent_vert>\r\n    #include<uv_vert>\r\n    // 投影\r\n    #include<worldposition_vert>\r\n    #include<project_vert>\r\n    // \r\n    #include<normalmap_vert>\r\n    //\r\n    #include<lights_vert>\r\n    #include<pointsize_vert>\r\n}"},wireframe:{fragment:"precision mediump float;\r\n\r\nuniform vec4 u_wireframeColor;\r\n\r\nvoid main() \r\n{\r\n    gl_FragColor = u_wireframeColor;\r\n}",vertex:"precision mediump float;  \r\n\r\nattribute vec3 a_position;\r\nattribute vec4 a_color;\r\n\r\n#include<uv_pars_vert>\r\n\r\nuniform mat4 u_modelMatrix;\r\nuniform mat4 u_viewProjection;\r\n\r\n#include<skeleton_pars_vert>\r\n#include<particle_pars_vert>\r\n\r\nvoid main() \r\n{\r\n    vec4 position = vec4(a_position, 1.0);\r\n\r\n    #include<uv_vert>\r\n\r\n    #include<skeleton_vert>\r\n    #include<particle_vert>\r\n\r\n    gl_Position = u_viewProjection * u_modelMatrix * position;\r\n}"}},modules:{alphatest_frag:"if(diffuseColor.w < u_alphaThreshold) discard;",alphatest_pars_frag:"uniform float u_alphaThreshold;",ambient_frag:"//环境光\r\nvec3 ambientColor = u_ambient.w * u_ambient.xyz * u_sceneAmbientColor.xyz * u_sceneAmbientColor.w;\r\nambientColor = ambientColor * texture2D(s_ambient, v_uv).xyz;",ambient_pars_frag:"uniform vec4 u_sceneAmbientColor;\r\n\r\n//环境\r\nuniform vec4 u_ambient;\r\nuniform sampler2D s_ambient;",cartoon_pars_frag:"#ifdef IS_CARTOON\r\n    #ifdef cartoon_Anti_aliasing\r\n        #extension GL_OES_standard_derivatives : enable\r\n    #endif\r\n\r\n    uniform vec4 u_diffuseSegment;\r\n    uniform vec4 u_diffuseSegmentValue;\r\n    uniform float u_specularSegment;\r\n\r\n    //漫反射\r\n    float cartoonLightDiffuse(vec3 normal,vec3 lightDir)\r\n    {\r\n        float diff = dot(normal, lightDir);\r\n        diff = diff * 0.5 + 0.5;\r\n\r\n        #ifdef cartoon_Anti_aliasing\r\n            float w = fwidth(diff) * 2.0;\r\n            if (diff < u_diffuseSegment.x + w) \r\n            {\r\n                diff = mix(u_diffuseSegment.x, u_diffuseSegment.y, smoothstep(u_diffuseSegment.x - w, u_diffuseSegment.x + w, diff));\r\n            //  diff = mix(u_diffuseSegment.x, u_diffuseSegment.y, clamp(0.5 * (diff - u_diffuseSegment.x) / w, 0, 1));\r\n            } else if (diff < u_diffuseSegment.y + w) \r\n            {\r\n                diff = mix(u_diffuseSegment.y, u_diffuseSegment.z, smoothstep(u_diffuseSegment.y - w, u_diffuseSegment.y + w, diff));\r\n            //  diff = mix(u_diffuseSegment.y, u_diffuseSegment.z, clamp(0.5 * (diff - u_diffuseSegment.y) / w, 0, 1));\r\n            } else if (diff < u_diffuseSegment.z + w) \r\n            {\r\n                diff = mix(u_diffuseSegment.z, u_diffuseSegment.w, smoothstep(u_diffuseSegment.z - w, u_diffuseSegment.z + w, diff));\r\n            //  diff = mix(u_diffuseSegment.z, u_diffuseSegment.w, clamp(0.5 * (diff - u_diffuseSegment.z) / w, 0, 1));\r\n            } else \r\n            {\r\n                diff = u_diffuseSegment.w;\r\n            }\r\n        #else\r\n            if (diff < u_diffuseSegment.x) \r\n            {\r\n                diff = u_diffuseSegmentValue.x;\r\n            } else if (diff < u_diffuseSegment.y) \r\n            {\r\n                diff = u_diffuseSegmentValue.y;\r\n            } else if (diff < u_diffuseSegment.z) \r\n            {\r\n                diff = u_diffuseSegmentValue.z;\r\n            } else \r\n            {\r\n                diff = u_diffuseSegmentValue.w;\r\n            }\r\n        #endif\r\n\r\n        return diff;\r\n    }\r\n\r\n    //镜面反射漫反射\r\n    float cartoonLightSpecular(vec3 normal,vec3 lightDir,vec3 cameraDir,float glossiness)\r\n    {\r\n        vec3 halfVec = normalize(lightDir + cameraDir);\r\n        float specComp = max(dot(normal,halfVec),0.0);\r\n        specComp = pow(specComp, glossiness);\r\n\r\n        #ifdef cartoon_Anti_aliasing\r\n            float w = fwidth(specComp);\r\n            if (specComp < u_specularSegment + w) \r\n            {\r\n                specComp = mix(0.0, 1.0, smoothstep(u_specularSegment - w, u_specularSegment + w, specComp));\r\n                // specComp = smoothstep(u_specularSegment - w, u_specularSegment + w, specComp);\r\n            } else \r\n            {\r\n                specComp = 1.0;\r\n            }\r\n        #else\r\n            if(specComp < u_specularSegment)\r\n            {\r\n                specComp = 0.0;\r\n            }else\r\n            {\r\n                specComp = 1.0;\r\n            }\r\n        #endif\r\n\r\n        return specComp;\r\n    }\r\n#endif",color_frag:"#ifdef HAS_a_color\r\nfinalColor = v_color * finalColor;\r\n#endif\r\n",color_pars_frag:"#ifdef HAS_a_color\r\nvarying vec4 v_color;\r\n#endif\r\n",color_pars_vert:"#ifdef HAS_a_color\r\nattribute vec4 a_color;\r\n\r\nvarying vec4 v_color;\r\n#endif\r\n",color_vert:"#ifdef HAS_a_color\r\nv_color = a_color;\r\n#endif",diffuse_frag:"//获取漫反射基本颜色\r\nvec4 diffuseColor = u_diffuse;\r\ndiffuseColor = finalColor * diffuseColor * texture2D(s_diffuse, v_uv);\r\n",diffuse_pars_frag:"//漫反射\r\nuniform vec4 u_diffuse;\r\nuniform sampler2D s_diffuse;",envmap_frag:"finalColor = envmapMethod(finalColor);",envmap_pars_frag:"uniform samplerCube s_envMap;\r\nuniform float u_reflectivity;\r\n\r\nvec4 envmapMethod(vec4 finalColor)\r\n{\r\n    vec3 cameraToVertex = normalize( v_worldPosition - u_cameraPos );\r\n    vec3 reflectVec = reflect( cameraToVertex, v_normal );\r\n    vec4 envColor = textureCube( s_envMap, reflectVec );\r\n    finalColor.xyz *= envColor.xyz * u_reflectivity;\r\n    return finalColor;\r\n}",fog_frag:"finalColor = fogMethod(finalColor);",fog_pars_frag:"#define FOGMODE_NONE    0.\r\n#define FOGMODE_EXP     1.\r\n#define FOGMODE_EXP2    2.\r\n#define FOGMODE_LINEAR  3.\r\n#define E 2.71828\r\n\r\nuniform float u_fogMode;\r\nuniform float u_fogMinDistance;\r\nuniform float u_fogMaxDistance;\r\nuniform float u_fogDensity;\r\nuniform vec3 u_fogColor;\r\n\r\nfloat CalcFogFactor(float fogDistance)\r\n{\r\n\tfloat fogCoeff = 1.0;\r\n\tif (FOGMODE_LINEAR == u_fogMode)\r\n\t{\r\n\t\tfogCoeff = (u_fogMaxDistance - fogDistance) / (u_fogMaxDistance - u_fogMinDistance);\r\n\t}\r\n\telse if (FOGMODE_EXP == u_fogMode)\r\n\t{\r\n\t\tfogCoeff = 1.0 / pow(E, fogDistance * u_fogDensity);\r\n\t}\r\n\telse if (FOGMODE_EXP2 == u_fogMode)\r\n\t{\r\n\t\tfogCoeff = 1.0 / pow(E, fogDistance * fogDistance * u_fogDensity * u_fogDensity);\r\n\t}\r\n\r\n\treturn clamp(fogCoeff, 0.0, 1.0);\r\n}\r\n\r\nvec4 fogMethod(vec4 color)\r\n{\r\n    vec3 fogDistance = u_cameraPos - v_worldPosition.xyz;\r\n\tfloat fog = CalcFogFactor(length(fogDistance));\r\n\tcolor.rgb = fog * color.rgb + (1.0 - fog) * u_fogColor;\r\n    return color;\r\n}",lights_frag:"//渲染灯光\r\n#if NUM_LIGHT > 0\r\n    finalColor.xyz = lightShading(normal, diffuseColor.xyz, specularColor, ambientColor, glossiness);\r\n#endif",lights_pars_frag:"#if NUM_POINTLIGHT > 0\r\n    // 点光源\r\n    struct PointLight\r\n    {\r\n        // 位置\r\n        vec3 position;\r\n        // 颜色\r\n        vec3 color;\r\n        // 强度\r\n        float intensity;\r\n        // 范围\r\n        float range;\r\n    };\r\n    // 点光源列表\r\n    uniform PointLight u_pointLights[NUM_POINTLIGHT];\r\n#endif\r\n\r\n#if NUM_SPOT_LIGHTS > 0\r\n    // 聚光灯\r\n    struct SpotLight\r\n    {\r\n        // 位置\r\n        vec3 position;\r\n        // 颜色\r\n        vec3 color;\r\n        // 强度\r\n        float intensity;\r\n        // 范围\r\n        float range;\r\n        // 方向\r\n        vec3 direction;\r\n        // 椎体cos值\r\n        float coneCos;\r\n        // 半影cos\r\n        float penumbraCos;\r\n    };\r\n    // 方向光源列表\r\n    uniform SpotLight u_spotLights[ NUM_SPOT_LIGHTS ];\r\n#endif\r\n\r\n#if NUM_DIRECTIONALLIGHT > 0\r\n    // 方向光源\r\n    struct DirectionalLight\r\n    {\r\n        // 方向\r\n        vec3 direction;\r\n        // 颜色\r\n        vec3 color;\r\n        // 强度\r\n        float intensity;\r\n    };\r\n    // 方向光源列表\r\n    uniform DirectionalLight u_directionalLights[ NUM_DIRECTIONALLIGHT ];\r\n#endif\r\n\r\n//卡通\r\n#include<cartoon_pars_frag>\r\n\r\n#include<shadowmap_pars_frag>\r\n\r\n//计算光照漫反射系数\r\nfloat calculateLightDiffuse(vec3 normal,vec3 lightDir)\r\n{\r\n    #ifdef IS_CARTOON\r\n        return cartoonLightDiffuse(normal,lightDir);\r\n    #else\r\n        return clamp(dot(normal,lightDir),0.0,1.0);\r\n    #endif\r\n}\r\n\r\n//计算光照镜面反射系数\r\nfloat calculateLightSpecular(vec3 normal,vec3 lightDir,vec3 viewDir,float glossiness)\r\n{\r\n    #ifdef IS_CARTOON\r\n        return cartoonLightSpecular(normal,lightDir,viewDir,glossiness);\r\n    #else\r\n        vec3 halfVec = normalize(lightDir + viewDir);\r\n        float specComp = max(dot(normal,halfVec),0.0);\r\n        specComp = pow(specComp, glossiness);\r\n\r\n        return specComp;\r\n    #endif\r\n}\r\n\r\n//根据距离计算衰减\r\nfloat computeDistanceLightFalloff(float lightDistance, float range)\r\n{\r\n    #ifdef USEPHYSICALLIGHTFALLOFF\r\n        float lightDistanceFalloff = 1.0 / ((lightDistance * lightDistance + 0.0001));\r\n    #else\r\n        float lightDistanceFalloff = max(0., 1.0 - lightDistance / range);\r\n    #endif\r\n    \r\n    return lightDistanceFalloff;\r\n}\r\n\r\n//渲染点光源\r\nvec3 lightShading(vec3 normal, vec3 diffuseColor, vec3 specularColor, vec3 ambientColor, float glossiness)\r\n{\r\n    //视线方向\r\n    vec3 viewDir = normalize(u_cameraPos - v_worldPosition);\r\n\r\n    vec3 resultColor = vec3(0.0,0.0,0.0);\r\n    \r\n    #if NUM_POINTLIGHT > 0\r\n        PointLight pointLight;\r\n        for(int i = 0;i<NUM_POINTLIGHT;i++)\r\n        {\r\n            pointLight = u_pointLights[i];\r\n            //\r\n            vec3 lightOffset = pointLight.position - v_worldPosition;\r\n            //光照方向\r\n            vec3 lightDir = normalize(lightOffset);\r\n            //灯光颜色\r\n            vec3 lightColor = pointLight.color;\r\n            //灯光强度\r\n            float lightIntensity = pointLight.intensity;\r\n            float falloff = computeDistanceLightFalloff(length(lightOffset), pointLight.range);\r\n            float diffuse = calculateLightDiffuse(normal, lightDir);\r\n            float specular = calculateLightSpecular(normal, lightDir, viewDir, glossiness);\r\n            float shadow = 1.0;\r\n            \r\n            resultColor += (diffuse * diffuseColor + specular * specularColor) * lightColor * lightIntensity * falloff * shadow;\r\n        }\r\n    #endif\r\n\r\n    #if NUM_POINTLIGHT_CASTSHADOW > 0\r\n        CastShadowPointLight castShadowPointLight;\r\n        for(int i = 0;i<NUM_POINTLIGHT_CASTSHADOW;i++)\r\n        {\r\n            castShadowPointLight = u_castShadowPointLights[i];\r\n            //\r\n            vec3 lightOffset = castShadowPointLight.position - v_worldPosition;\r\n            //光照方向\r\n            vec3 lightDir = normalize(lightOffset);\r\n            //灯光颜色\r\n            vec3 lightColor = castShadowPointLight.color;\r\n            //灯光强度\r\n            float lightIntensity = castShadowPointLight.intensity;\r\n            float falloff = computeDistanceLightFalloff(length(lightOffset), castShadowPointLight.range);\r\n            // 计算阴影\r\n            float shadow = getPointShadow( u_pointShadowMaps[ i ], castShadowPointLight.shadowType, castShadowPointLight.shadowMapSize, castShadowPointLight.shadowBias, castShadowPointLight.shadowRadius, -lightOffset, castShadowPointLight.shadowCameraNear, castShadowPointLight.shadowCameraFar );\r\n            float diffuse = calculateLightDiffuse(normal, lightDir);\r\n            float specular = calculateLightSpecular(normal, lightDir, viewDir, glossiness);\r\n            //\r\n            resultColor += (diffuse * diffuseColor + specular * specularColor) * lightColor * lightIntensity * falloff * shadow;\r\n        }\r\n    #endif\r\n\r\n    #if NUM_SPOT_LIGHTS > 0\r\n        SpotLight spotLight;\r\n        for(int i = 0; i < NUM_SPOT_LIGHTS; i++)\r\n        {\r\n            spotLight = u_spotLights[i];\r\n            //\r\n            vec3 lightOffset = spotLight.position - v_worldPosition;\r\n            //光照方向\r\n            vec3 lightDir = normalize(lightOffset);\r\n            float angleCos = dot(lightDir, -spotLight.direction);\r\n            if(angleCos > spotLight.coneCos)\r\n            {\r\n                float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\r\n                \r\n                //灯光颜色\r\n                vec3 lightColor = spotLight.color;\r\n                //灯光强度\r\n                float lightIntensity = spotLight.intensity;\r\n                float falloff = computeDistanceLightFalloff(length(lightOffset) * angleCos, spotLight.range);\r\n                float diffuse = calculateLightDiffuse(normal, lightDir);\r\n                float specular = calculateLightSpecular(normal, lightDir, viewDir, glossiness);\r\n                float shadow = 1.0;\r\n                \r\n                resultColor += (diffuse * diffuseColor + specular * specularColor) * lightColor * lightIntensity * falloff * shadow * spotEffect;\r\n            }            \r\n        }\r\n    #endif\r\n    \r\n    #if NUM_SPOT_LIGHTS_CASTSHADOW > 0\r\n        CastShadowSpotLight castShadowSpotLight;\r\n        for(int i = 0; i < NUM_SPOT_LIGHTS_CASTSHADOW; i++)\r\n        {\r\n            castShadowSpotLight = u_castShadowSpotLights[i];\r\n            //\r\n            vec3 lightOffset = castShadowSpotLight.position - v_worldPosition;\r\n            //光照方向\r\n            vec3 lightDir = normalize(lightOffset);\r\n            float angleCos = dot(lightDir, -castShadowSpotLight.direction);\r\n            if(angleCos > castShadowSpotLight.coneCos)\r\n            {\r\n                float spotEffect = smoothstep( castShadowSpotLight.coneCos, castShadowSpotLight.penumbraCos, angleCos );\r\n                \r\n                //灯光颜色\r\n                vec3 lightColor = castShadowSpotLight.color;\r\n                //灯光强度\r\n                float lightIntensity = castShadowSpotLight.intensity;\r\n                float falloff = computeDistanceLightFalloff(length(lightOffset) * angleCos, castShadowSpotLight.range);\r\n                float diffuse = calculateLightDiffuse(normal, lightDir);\r\n                float specular = calculateLightSpecular(normal, lightDir, viewDir, glossiness);\r\n                // 计算阴影\r\n                float shadow = getShadow( u_spotShadowMaps[i], castShadowSpotLight.shadowType, castShadowSpotLight.shadowMapSize, castShadowSpotLight.shadowBias, castShadowSpotLight.shadowRadius, v_spotShadowCoord[ i ], -lightOffset, castShadowSpotLight.shadowCameraNear, castShadowSpotLight.shadowCameraFar);\r\n                \r\n                resultColor += (diffuse * diffuseColor + specular * specularColor) * lightColor * lightIntensity * falloff * shadow * spotEffect;\r\n            }            \r\n        }\r\n    #endif\r\n\r\n    #if NUM_DIRECTIONALLIGHT > 0\r\n        DirectionalLight directionalLight;\r\n        for(int i = 0;i<NUM_DIRECTIONALLIGHT;i++)\r\n        {\r\n            directionalLight = u_directionalLights[i];\r\n            //光照方向\r\n            vec3 lightDir = normalize(-directionalLight.direction);\r\n            //灯光颜色\r\n            vec3 lightColor = directionalLight.color;\r\n            //灯光强度\r\n            float lightIntensity = directionalLight.intensity;\r\n\r\n            float falloff = 1.0;\r\n            float diffuse = calculateLightDiffuse(normal, lightDir);\r\n            float specular = calculateLightSpecular(normal, lightDir, viewDir, glossiness);\r\n            float shadow = 1.0;\r\n            //\r\n            resultColor += (diffuse * diffuseColor + specular * specularColor) * lightColor * lightIntensity * falloff * shadow;\r\n        }\r\n    #endif\r\n\r\n    #if NUM_DIRECTIONALLIGHT_CASTSHADOW > 0\r\n        CastShadowDirectionalLight castShadowDirectionalLight;\r\n        for(int i = 0;i<NUM_DIRECTIONALLIGHT_CASTSHADOW;i++)\r\n        {\r\n            castShadowDirectionalLight = u_castShadowDirectionalLights[i];\r\n            //\r\n            vec3 lightOffset = castShadowDirectionalLight.position - v_worldPosition;\r\n            //光照方向\r\n            vec3 lightDir = normalize(-castShadowDirectionalLight.direction);\r\n            //灯光颜色\r\n            vec3 lightColor = castShadowDirectionalLight.color;\r\n            //灯光强度\r\n            float lightIntensity = castShadowDirectionalLight.intensity;\r\n            // 计算阴影\r\n            float shadow = getShadow( u_directionalShadowMaps[i], castShadowDirectionalLight.shadowType, castShadowDirectionalLight.shadowMapSize, castShadowDirectionalLight.shadowBias, castShadowDirectionalLight.shadowRadius, v_directionalShadowCoord[ i ], -lightOffset, castShadowDirectionalLight.shadowCameraNear, castShadowDirectionalLight.shadowCameraFar);\r\n            \r\n            float falloff = 1.0;\r\n            float diffuse = calculateLightDiffuse(normal, lightDir);\r\n            float specular = calculateLightSpecular(normal, lightDir, viewDir, glossiness);\r\n            //\r\n            resultColor += (diffuse * diffuseColor + specular * specularColor) * lightColor * lightIntensity * falloff * shadow;\r\n        }\r\n    #endif\r\n\r\n    resultColor += ambientColor * diffuseColor;\r\n    return resultColor;\r\n}",lights_pars_vert:"// 灯光声明\r\n\r\n#if NUM_DIRECTIONALLIGHT_CASTSHADOW > 0\r\n    // 方向光源投影矩阵列表\r\n    uniform mat4 u_directionalShadowMatrixs[ NUM_DIRECTIONALLIGHT_CASTSHADOW ];\r\n    // 方向光源投影uv列表\r\n    varying vec4 v_directionalShadowCoord[ NUM_DIRECTIONALLIGHT_CASTSHADOW ];\r\n#endif\r\n\r\n#if NUM_SPOT_LIGHTS_CASTSHADOW > 0\r\n    // 聚光灯投影矩阵列表\r\n    uniform mat4 u_spotShadowMatrix[ NUM_SPOT_LIGHTS_CASTSHADOW ];\r\n    // 聚光灯投影uv列表\r\n    varying vec4 v_spotShadowCoord[ NUM_SPOT_LIGHTS_CASTSHADOW ];\r\n#endif",lights_vert:"#if NUM_DIRECTIONALLIGHT_CASTSHADOW > 0\r\n    for ( int i = 0; i < NUM_DIRECTIONALLIGHT_CASTSHADOW; i ++ ) \r\n    {\r\n        v_directionalShadowCoord[ i ] = u_directionalShadowMatrixs[ i ] * worldPosition;\r\n    }\r\n#endif\r\n\r\n#if NUM_SPOT_LIGHTS_CASTSHADOW > 0\r\n    for ( int i = 0; i < NUM_SPOT_LIGHTS_CASTSHADOW; i ++ ) \r\n    {\r\n        v_spotShadowCoord[ i ] = u_spotShadowMatrix[ i ] * worldPosition;\r\n    }\r\n#endif",normalmap_pars_vert:"uniform mat4 u_ITModelMatrix;\r\n\r\nvarying vec3 v_normal;\r\nvarying vec3 v_tangent;\r\nvarying vec3 v_bitangent;",normalmap_vert:"//计算法线\r\nv_normal = normalize((u_ITModelMatrix * vec4(normal, 0.0)).xyz);\r\nv_tangent = normalize((u_modelMatrix * vec4(tangent, 0.0)).xyz);\r\nv_bitangent = cross(v_normal, v_tangent);",normal_frag:"//获取法线\r\nvec3 normal = texture2D(s_normal,v_uv).xyz * 2.0 - 1.0;\r\nnormal = normalize(normal.x * v_tangent + normal.y * v_bitangent + normal.z * v_normal);",normal_pars_frag:"varying vec3 v_normal;\r\nvarying vec3 v_tangent;\r\nvarying vec3 v_bitangent;\r\n\r\n//法线贴图\r\nuniform sampler2D s_normal;",normal_pars_vert:"attribute vec3 a_normal;",normal_vert:"vec3 normal = a_normal;",particle_frag:"#ifdef HAS_PARTICLE_ANIMATOR\r\n    finalColor = particleAnimation(finalColor);\r\n#endif",particle_pars_frag:"#ifdef HAS_PARTICLE_ANIMATOR\r\n    varying vec4 v_particle_color;\r\n\r\n    vec4 particleAnimation(vec4 color) {\r\n\r\n        color.xyz = color.xyz * v_particle_color.xyz;\r\n        color.xyz = color.xyz * v_particle_color.www;\r\n        return color;\r\n    }\r\n#endif",particle_pars_vert:"#ifdef HAS_PARTICLE_ANIMATOR\r\n    //\r\n    attribute vec3 a_particle_position;\r\n    attribute vec3 a_particle_scale;\r\n    attribute vec3 a_particle_rotation;\r\n    attribute vec4 a_particle_color;\r\n\r\n    #ifdef ENABLED_PARTICLE_SYSTEM_textureSheetAnimation\r\n        attribute vec4 a_particle_tilingOffset;\r\n        attribute vec2 a_particle_flipUV;\r\n    #endif\r\n\r\n    uniform mat3 u_particle_billboardMatrix;\r\n\r\n    varying vec4 v_particle_color;\r\n\r\n    #define RotationOrder_XYZ 0\r\n    #define RotationOrder_ZXY 1\r\n    #define RotationOrder_ZYX 2\r\n    #define RotationOrder_YXZ 3\r\n    #define RotationOrder_YZX 4\r\n    #define RotationOrder_XZY 5\r\n\r\n    mat3 makeParticleRotationMatrix(vec3 rotation)\r\n    {\r\n        float DEG2RAD = 3.1415926 / 180.0;\r\n        \r\n        float rx = rotation.x * DEG2RAD;\r\n        float ry = rotation.y * DEG2RAD;\r\n        float rz = rotation.z * DEG2RAD;\r\n\r\n        float sinX = sin(rx);\r\n        float cosX = cos(rx);\r\n        float sinY = sin(ry);\r\n        float cosY = cos(ry);\r\n        float sinZ = sin(rz);\r\n        float cosZ = cos(rz);\r\n\r\n        mat3 tmp;\r\n        #ifdef RotationOrder\r\n            #if RotationOrder == RotationOrder_XYZ\r\n                float ae = cosX * cosZ;\r\n                float af = cosX * sinZ;\r\n                float be = sinX * cosZ;\r\n                float bf = sinX * sinZ;\r\n\r\n                float te0 = cosY * cosZ;\r\n                float te4 = - cosY * sinZ;\r\n                float te8 = sinY;\r\n\r\n                float te1 = af + be * sinY;\r\n                float te5 = ae - bf * sinY;\r\n                float te9 = - sinX * cosY;\r\n\r\n                float te2 = bf - ae * sinY;\r\n                float te6 = be + af * sinY;\r\n                float te10 = cosX * cosY;\r\n            #endif\r\n            #if RotationOrder == RotationOrder_YXZ\r\n                float ce = cosY * cosZ;\r\n                float cf = cosY * sinZ;\r\n                float de = sinY * cosZ;\r\n                float df = sinY * sinZ;\r\n\r\n                float te0 = ce + df * sinX;\r\n                float te4 = de * sinX - cf;\r\n                float te8 = cosX * sinY;\r\n\r\n                float te1 = cosX * sinZ;\r\n                float te5 = cosX * cosZ;\r\n                float te9 = - sinX;\r\n\r\n                float te2 = cf * sinX - de;\r\n                float te6 = df + ce * sinX;\r\n                float te10 = cosX * cosY;\r\n            #endif\r\n            #if RotationOrder == RotationOrder_ZXY\r\n                float ce = cosY * cosZ;\r\n                float cf = cosY * sinZ;\r\n                float de = sinY * cosZ;\r\n                float df = sinY * sinZ;\r\n\r\n                float te0 = ce - df * sinX;\r\n                float te4 = - cosX * sinZ;\r\n                float te8 = de + cf * sinX;\r\n\r\n                float te1 = cf + de * sinX;\r\n                float te5 = cosX * cosZ;\r\n                float te9 = df - ce * sinX;\r\n\r\n                float te2 = - cosX * sinY;\r\n                float te6 = sinX;\r\n                float te10 = cosX * cosY;\r\n            #endif\r\n            #if RotationOrder == RotationOrder_ZYX\r\n                float ae = cosX * cosZ;\r\n                float af = cosX * sinZ;\r\n                float be = sinX * cosZ;\r\n                float bf = sinX * sinZ;\r\n\r\n                float te0 = cosY * cosZ;\r\n                float te4 = be * sinY - af;\r\n                float te8 = ae * sinY + bf;\r\n\r\n                float te1 = cosY * sinZ;\r\n                float te5 = bf * sinY + ae;\r\n                float te9 = af * sinY - be;\r\n\r\n                float te2 = - sinY;\r\n                float te6 = sinX * cosY;\r\n                float te10 = cosX * cosY;\r\n            #endif\r\n            #if RotationOrder == RotationOrder_YZX\r\n                float ac = cosX * cosY;\r\n                float ad = cosX * sinY;\r\n                float bc = sinX * cosY;\r\n                float bd = sinX * sinY;\r\n\r\n                float te0 = cosY * cosZ;\r\n                float te4 = bd - ac * sinZ;\r\n                float te8 = bc * sinZ + ad;\r\n\r\n                float te1 = sinZ;\r\n                float te5 = cosX * cosZ;\r\n                float te9 = - sinX * cosZ;\r\n\r\n                float te2 = - sinY * cosZ;\r\n                float te6 = ad * sinZ + bc;\r\n                float te10 = ac - bd * sinZ;\r\n            #endif\r\n            #if RotationOrder == RotationOrder_XZY\r\n                float ac = cosX * cosY;\r\n                float ad = cosX * sinY;\r\n                float bc = sinX * cosY;\r\n                float bd = sinX * sinY;\r\n\r\n                float te0 = cosY * cosZ;\r\n                float te4 = - sinZ;\r\n                float te8 = sinY * cosZ;\r\n\r\n                float te1 = ac * sinZ + bd;\r\n                float te5 = cosX * cosZ;\r\n                float te9 = ad * sinZ - bc;\r\n\r\n                float te2 = bc * sinZ - ad;\r\n                float te6 = sinX * cosZ;\r\n                float te10 = bd * sinZ + ac;\r\n            #endif\r\n        #else\r\n            // YXZ\r\n            float ce = cosY * cosZ;\r\n            float cf = cosY * sinZ;\r\n            float de = sinY * cosZ;\r\n            float df = sinY * sinZ;\r\n\r\n            float te0 = ce + df * sinX;\r\n            float te4 = de * sinX - cf;\r\n            float te8 = cosX * sinY;\r\n\r\n            float te1 = cosX * sinZ;\r\n            float te5 = cosX * cosZ;\r\n            float te9 = - sinX;\r\n\r\n            float te2 = cf * sinX - de;\r\n            float te6 = df + ce * sinX;\r\n            float te10 = cosX * cosY;\r\n        #endif\r\n        \r\n        tmp[0] = vec3(te0, te1, te2);\r\n        tmp[1] = vec3(te4, te5, te6);\r\n        tmp[2] = vec3(te8, te9, te10);\r\n        \r\n        return tmp;\r\n    }\r\n\r\n    vec4 particleAnimation(vec4 position) \r\n    {\r\n        // 计算缩放\r\n        position.xyz = position.xyz * a_particle_scale;\r\n\r\n        // 计算旋转\r\n        mat3 rMat = makeParticleRotationMatrix(a_particle_rotation);\r\n        position.xyz = rMat * position.xyz;\r\n        position.xyz = u_particle_billboardMatrix * position.xyz;\r\n\r\n        // 位移\r\n        position.xyz = position.xyz + a_particle_position;\r\n\r\n        // 颜色\r\n        v_particle_color = a_particle_color;\r\n\r\n        #ifdef ENABLED_PARTICLE_SYSTEM_textureSheetAnimation\r\n            if(a_particle_flipUV.x > 0.5) v_uv.x = 1.0 - v_uv.x;\r\n            if(a_particle_flipUV.y > 0.5) v_uv.y = 1.0 - v_uv.y;\r\n            v_uv = v_uv * a_particle_tilingOffset.xy + a_particle_tilingOffset.zw;\r\n        #endif\r\n        \r\n        return position;\r\n    }\r\n#endif",particle_vert:"#ifdef HAS_PARTICLE_ANIMATOR\r\n    position = particleAnimation(position);\r\n#endif",pointsize_pars_vert:"#ifdef IS_POINTS_MODE\r\n    uniform float u_PointSize;\r\n#endif",pointsize_vert:"#ifdef IS_POINTS_MODE\r\n    gl_PointSize = u_PointSize;\r\n#endif",position_pars_vert:"attribute vec3 a_position;",position_vert:"vec4 position = vec4(a_position, 1.0);",project_pars_vert:"uniform mat4 u_viewProjection;",project_vert:"//计算投影坐标\r\ngl_Position = u_viewProjection * worldPosition;",shadowmap_pars_frag:"#if (NUM_POINTLIGHT_CASTSHADOW > 0) ||  (NUM_DIRECTIONALLIGHT_CASTSHADOW > 0) ||  (NUM_SPOT_LIGHTS_CASTSHADOW > 0)\r\n    #if NUM_POINTLIGHT_CASTSHADOW > 0\r\n        // 投影的点光源\r\n        struct CastShadowPointLight\r\n        {\r\n            // 位置\r\n            vec3 position;\r\n            // 颜色\r\n            vec3 color;\r\n            // 强度\r\n            float intensity;\r\n            // 范围\r\n            float range;\r\n            // 阴影类型\r\n            int shadowType;\r\n            // 阴影偏差，用来解决判断是否为阴影时精度问题\r\n            float shadowBias;\r\n            // 阴影半径，边缘宽度\r\n            float shadowRadius;\r\n            // 阴影图尺寸\r\n            vec2 shadowMapSize;\r\n            float shadowCameraNear;\r\n            float shadowCameraFar;\r\n        };\r\n        // 投影的点光源列表\r\n        uniform CastShadowPointLight u_castShadowPointLights[NUM_POINTLIGHT_CASTSHADOW];\r\n        // 点光源阴影图\r\n        uniform sampler2D u_pointShadowMaps[NUM_POINTLIGHT_CASTSHADOW];\r\n    #endif\r\n\r\n    #if NUM_SPOT_LIGHTS_CASTSHADOW > 0\r\n        // 投影的聚光灯\r\n        struct CastShadowSpotLight\r\n        {\r\n            // 位置\r\n            vec3 position;\r\n            // 颜色\r\n            vec3 color;\r\n            // 强度\r\n            float intensity;\r\n            // 范围\r\n            float range;\r\n            // 方向\r\n            vec3 direction;\r\n            // 椎体cos值\r\n            float coneCos;\r\n            // 半影cos\r\n            float penumbraCos;\r\n\r\n            // 阴影类型\r\n            int shadowType;\r\n            // 阴影偏差，用来解决判断是否为阴影时精度问题\r\n            float shadowBias;\r\n            // 阴影半径，边缘宽度\r\n            float shadowRadius;\r\n            // 阴影图尺寸\r\n            vec2 shadowMapSize;\r\n            float shadowCameraNear;\r\n            float shadowCameraFar;\r\n        };\r\n        // 投影的投影的聚光灯列表\r\n        uniform CastShadowSpotLight u_castShadowSpotLights[NUM_SPOT_LIGHTS_CASTSHADOW];\r\n        // 投影的聚光灯阴影图\r\n        uniform sampler2D u_spotShadowMaps[NUM_SPOT_LIGHTS_CASTSHADOW];\r\n        // 方向光源投影uv列表\r\n        varying vec4 v_spotShadowCoord[ NUM_SPOT_LIGHTS_CASTSHADOW ];\r\n    #endif\r\n\r\n    #if NUM_DIRECTIONALLIGHT_CASTSHADOW > 0\r\n        // 投影的方向光源\r\n        struct CastShadowDirectionalLight\r\n        {\r\n            // 方向\r\n            vec3 direction;\r\n            // 颜色\r\n            vec3 color;\r\n            // 强度\r\n            float intensity;\r\n            // 阴影类型\r\n            int shadowType;\r\n            // 阴影偏差，用来解决判断是否为阴影时精度问题\r\n            float shadowBias;\r\n            // 阴影半径，边缘宽度\r\n            float shadowRadius;\r\n            // 阴影图尺寸\r\n            vec2 shadowMapSize;\r\n            // 位置\r\n            vec3 position;\r\n            float shadowCameraNear;\r\n            float shadowCameraFar;\r\n        };\r\n        // 投影的方向光源列表\r\n        uniform CastShadowDirectionalLight u_castShadowDirectionalLights[NUM_DIRECTIONALLIGHT_CASTSHADOW];\r\n        // 方向光源阴影图\r\n        uniform sampler2D u_directionalShadowMaps[NUM_DIRECTIONALLIGHT_CASTSHADOW];\r\n        // 方向光源投影uv列表\r\n        varying vec4 v_directionalShadowCoord[ NUM_DIRECTIONALLIGHT_CASTSHADOW ];\r\n    #endif\r\n\r\n    // @see https://github.com/mrdoob/three.js/blob/dev/src/renderers/shaders/ShaderChunk/packing.glsl\r\n    const float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\r\n    const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\r\n    const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\r\n    float unpackRGBAToDepth( const in vec4 v ) \r\n    {\r\n        return dot( v, UnpackFactors );\r\n    }\r\n\r\n    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) \r\n    {\r\n        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\r\n    }\r\n\r\n    float texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) \r\n    {\r\n        const vec2 offset = vec2( 0.0, 1.0 );\r\n\r\n        vec2 texelSize = vec2( 1.0 ) / size;\r\n        vec2 centroidUV = floor( uv * size + 0.5 ) / size;\r\n\r\n        float lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\r\n        float lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\r\n        float rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\r\n        float rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\r\n\r\n        vec2 f = fract( uv * size + 0.5 );\r\n\r\n        float a = mix( lb, lt, f.y );\r\n        float b = mix( rb, rt, f.y );\r\n        float c = mix( a, b, f.x );\r\n\r\n        return c;\r\n    }\r\n\r\n    // 计算阴影值 @see https://github.com/mrdoob/three.js/blob/dev/src/renderers/shaders/ShaderChunk/shadowmap_pars_fragment.glsl\r\n    float getShadow( sampler2D shadowMap, int shadowType, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightToPosition, float shadowCameraNear, float shadowCameraFar) \r\n    {\r\n        float shadow = 1.0;\r\n\r\n        shadowCoord.xy /= shadowCoord.w;\r\n        shadowCoord.xy = (shadowCoord.xy + 1.0) / 2.0;\r\n\r\n        // dp = normalized distance from light to fragment position\r\n        float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\r\n        dp += shadowBias;\r\n        shadowCoord.z = dp;\r\n\r\n        // if ( something && something ) breaks ATI OpenGL shader compiler\r\n        // if ( all( something, something ) ) using this instead\r\n\r\n        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\r\n        bool inFrustum = all( inFrustumVec );\r\n\r\n        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\r\n\r\n        bool frustumTest = all( frustumTestVec );\r\n\r\n        if ( frustumTest ) \r\n        {\r\n            if (shadowType == 2)\r\n            {\r\n                // PCF\r\n                vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\r\n\r\n                float dx0 = - texelSize.x * shadowRadius;\r\n                float dy0 = - texelSize.y * shadowRadius;\r\n                float dx1 = + texelSize.x * shadowRadius;\r\n                float dy1 = + texelSize.y * shadowRadius;\r\n\r\n                shadow = (\r\n                    texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\r\n                    texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\r\n                    texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\r\n                    texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\r\n                    texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\r\n                    texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\r\n                    texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\r\n                    texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\r\n                    texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\r\n                ) * ( 1.0 / 9.0 );\r\n            }\r\n            else if(shadowType == 3)\r\n            {\r\n                // PCF soft\r\n                vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\r\n\r\n                float dx0 = - texelSize.x * shadowRadius;\r\n                float dy0 = - texelSize.y * shadowRadius;\r\n                float dx1 = + texelSize.x * shadowRadius;\r\n                float dy1 = + texelSize.y * shadowRadius;\r\n\r\n                shadow = (\r\n                    texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\r\n                    texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\r\n                    texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\r\n                    texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\r\n                    texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\r\n                    texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\r\n                    texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\r\n                    texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\r\n                    texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\r\n                ) * ( 1.0 / 9.0 );\r\n            }\r\n            else\r\n            {\r\n                shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\r\n            }\r\n        }\r\n\r\n        return shadow;\r\n    }\r\n\r\n    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\r\n    // vector suitable for 2D texture mapping. This code uses the following layout for the\r\n    // 2D texture:\r\n    //\r\n    // xzXZ\r\n    //  y Y\r\n    //\r\n    // Y - Positive y direction\r\n    // y - Negative y direction\r\n    // X - Positive x direction\r\n    // x - Negative x direction\r\n    // Z - Positive z direction\r\n    // z - Negative z direction\r\n    //\r\n    // Source and test bed:\r\n    // https://gist.github.com/tschw/da10c43c467ce8afd0c4\r\n\r\n    vec2 cubeToUV( vec3 v, float texelSizeY ) \r\n    {\r\n        // Number of texels to avoid at the edge of each square\r\n        vec3 absV = abs( v );\r\n\r\n        // Intersect unit cube\r\n        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\r\n        absV *= scaleToCube;\r\n\r\n        // Apply scale to avoid seams\r\n\r\n        // two texels less per square (one texel will do for NEAREST)\r\n        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\r\n\r\n        // Unwrap\r\n\r\n        // space: -1 ... 1 range for each square\r\n        //\r\n        // #X##\t\tdim    := ( 1/4 , 1/2 )\r\n        //  # #\t\tcenter := ( 1/2 , 1/2 )\r\n        vec2 planar;\r\n        float almostOne = 1.0 - 1.5 * texelSizeY;\r\n        if ( absV.z >= almostOne ) \r\n        {\r\n            if ( v.z > 0.0 )\r\n            {\r\n                planar.x = (0.5 + v.x * 0.5) * 0.25 + 0.75;\r\n                planar.y = (0.5 + v.y * 0.5) * 0.5 + 0.5;\r\n            }else\r\n            {\r\n                planar.x = (0.5 - v.x * 0.5) * 0.25 + 0.25;\r\n                planar.y = (0.5 + v.y * 0.5) * 0.5 + 0.5;\r\n            }\r\n        } else if ( absV.x >= almostOne ) \r\n        {\r\n            if( v.x > 0.0)\r\n            {\r\n                planar.x = (0.5 - v.z * 0.5) * 0.25 + 0.5;\r\n                planar.y = (0.5 + v.y * 0.5) * 0.5 + 0.5;\r\n            }else\r\n            {\r\n                planar.x = (0.5 + v.z * 0.5) * 0.25 + 0.0;\r\n                planar.y = (0.5 + v.y * 0.5) * 0.5 + 0.5;\r\n            }\r\n        } else if ( absV.y >= almostOne ) \r\n        {\r\n            if( v.y > 0.0)\r\n            {\r\n                planar.x = (0.5 - v.x * 0.5) * 0.25 + 0.75;\r\n                planar.y = (0.5 + v.z * 0.5) * 0.5 + 0.0;\r\n            }else\r\n            {\r\n                planar.x = (0.5 - v.x * 0.5) * 0.25 + 0.25;\r\n                planar.y = (0.5 - v.z * 0.5) * 0.5 + 0.0;\r\n            }\r\n        }\r\n        return planar;\r\n    }\r\n\r\n    float getPointShadow( sampler2D shadowMap, int shadowType, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec3 lightToPosition, float shadowCameraNear, float shadowCameraFar ) \r\n    {\r\n        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\r\n\r\n        // for point lights, the uniform @vShadowCoord is re-purposed to hold\r\n        // the vector from the light to the world-space position of the fragment.\r\n        // vec3 lightToPosition = shadowCoord.xyz;\r\n\r\n        // dp = normalized distance from light to fragment position\r\n        float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\r\n        dp += shadowBias;\r\n\r\n        // bd3D = base direction 3D\r\n        vec3 bd3D = normalize( lightToPosition );\r\n\r\n        if(shadowType == 2 || shadowType == 3)\r\n        {\r\n            vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\r\n\r\n            return (\r\n                texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\r\n                texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\r\n                texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\r\n                texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\r\n                texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\r\n                texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\r\n                texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\r\n                texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\r\n                texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\r\n            ) * ( 1.0 / 9.0 );\r\n        }else\r\n        {\r\n            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\r\n        }\r\n    }\r\n#endif",skeleton_pars_vert:"#ifdef HAS_SKELETON_ANIMATION\r\n\r\n    attribute vec4 a_skinIndices;\r\n    attribute vec4 a_skinWeights;\r\n\r\n    #ifdef HAS_a_skinIndices1\r\n        attribute vec4 a_skinIndices1;\r\n        attribute vec4 a_skinWeights1;\r\n    #endif\r\n\r\n    #ifdef NUM_SKELETONJOINT\r\n        uniform mat4 u_skeletonGlobalMatriices[NUM_SKELETONJOINT];\r\n    #endif\r\n\r\n    vec4 skeletonAnimation(vec4 position) \r\n    {\r\n        vec4 totalPosition = vec4(0.0,0.0,0.0,1.0);\r\n        for(int i = 0; i < 4; i++)\r\n        {\r\n            totalPosition += u_skeletonGlobalMatriices[int(a_skinIndices[i])] * position * a_skinWeights[i];\r\n        }\r\n        #ifdef HAS_a_skinIndices1\r\n            for(int i = 0; i < 4; i++)\r\n            {\r\n                totalPosition += u_skeletonGlobalMatriices[int(a_skinIndices1[i])] * position * a_skinWeights1[i];\r\n            }\r\n        #endif\r\n        position.xyz = totalPosition.xyz;\r\n        return position;\r\n    }\r\n#endif",skeleton_vert:"#ifdef HAS_SKELETON_ANIMATION\r\n    position = skeletonAnimation(position);\r\n#endif",specular_frag:"//获取高光值\r\nfloat glossiness = u_glossiness;\r\n//获取镜面反射基本颜色\r\nvec3 specularColor = u_specular;\r\nvec4 specularMapColor = texture2D(s_specular, v_uv);\r\nspecularColor.xyz = specularMapColor.xyz;\r\nglossiness = glossiness * specularMapColor.w;",specular_pars_frag:"//镜面反射\r\nuniform vec3 u_specular;\r\nuniform float u_glossiness;\r\nuniform sampler2D s_specular;",tangent_pars_vert:"attribute vec3 a_tangent;",tangent_vert:"vec3 tangent = a_tangent;",terrainDefault_pars_frag:"uniform sampler2D s_splatTexture1;\r\nuniform sampler2D s_splatTexture2;\r\nuniform sampler2D s_splatTexture3;\r\n\r\nuniform sampler2D s_blendTexture;\r\nuniform vec4 u_splatRepeats;\r\n\r\nvec4 terrainMethod(vec4 diffuseColor,vec2 v_uv) \r\n{\r\n    vec4 blend = texture2D(s_blendTexture, v_uv);\r\n\r\n    vec2 t_uv = v_uv.xy * u_splatRepeats.y;\r\n    vec4 tColor = texture2D(s_splatTexture1, t_uv);\r\n    diffuseColor = (tColor - diffuseColor) * blend.x + diffuseColor;\r\n\r\n    t_uv = v_uv.xy * u_splatRepeats.z;\r\n    tColor = texture2D(s_splatTexture2, t_uv);\r\n    diffuseColor = (tColor - diffuseColor) * blend.y + diffuseColor;\r\n\r\n    t_uv = v_uv.xy * u_splatRepeats.w;\r\n    tColor = texture2D(s_splatTexture3, t_uv);\r\n    diffuseColor = (tColor - diffuseColor) * blend.z + diffuseColor;\r\n\r\n    return diffuseColor;\r\n}",terrainMerge_pars_frag:"//代码实现lod以及线性插值 feng\r\n#extension GL_EXT_shader_texture_lod : enable\r\n#extension GL_OES_standard_derivatives : enable\r\n\r\n#define LOD_LINEAR\r\n\r\nuniform sampler2D s_splatMergeTexture;\r\nuniform sampler2D s_blendTexture;\r\nuniform vec4 u_splatRepeats;\r\n\r\nuniform vec2 u_imageSize;\r\nuniform vec4 u_tileOffset[3];\r\nuniform vec4 u_lod0vec;\r\nuniform vec2 u_tileSize;\r\nuniform float u_maxLod;\r\nuniform float u_scaleByDepth;\r\nuniform float u_uvPositionScale;\r\n\r\n\r\nvec4 terrainTexture2DLod(sampler2D s_splatMergeTexture,vec2 uv,float lod,vec4 offset){\r\n\r\n    //计算不同lod像素缩放以及起始坐标\r\n    vec4 lodvec = u_lod0vec;\r\n    lodvec.x = lodvec.x * pow(0.5,lod);\r\n    lodvec.y = lodvec.x * 2.0;\r\n    lodvec.z = 1.0 - lodvec.y;\r\n\r\n    //lod块尺寸\r\n    vec2 lodSize = u_imageSize * lodvec.xy;\r\n    vec2 lodPixelOffset = 1.0 / lodSize * 2.0;\r\n\r\n    // uv = uv - 1.0 / lodPixelOffset;\r\n    vec2 mixFactor = mod(uv, lodPixelOffset) / lodPixelOffset;\r\n\r\n    //lod块中像素索引\r\n    vec2 t_uv = fract(uv + lodPixelOffset * vec2(0.0, 0.0));\r\n    t_uv = t_uv * offset.xy + offset.zw;\r\n    //添加lod起始坐标\r\n    t_uv = t_uv * lodvec.xy + lodvec.zw;\r\n    //取整像素\r\n    t_uv = floor(t_uv * u_imageSize) / u_imageSize;\r\n    vec4 tColor00 = texture2D(s_splatMergeTexture,t_uv);\r\n\r\n    t_uv = fract(uv + lodPixelOffset * vec2(1.0, 0.0));\r\n    t_uv = t_uv * offset.xy + offset.zw;\r\n    //添加lod起始坐标\r\n    t_uv = t_uv * lodvec.xy + lodvec.zw;\r\n    //取整像素\r\n    t_uv = floor(t_uv * u_imageSize) / u_imageSize;\r\n    vec4 tColor10 = texture2D(s_splatMergeTexture,t_uv);\r\n\r\n    t_uv = fract(uv + lodPixelOffset * vec2(0.0, 1.0));\r\n    t_uv = t_uv * offset.xy + offset.zw;\r\n    //添加lod起始坐标\r\n    t_uv = t_uv * lodvec.xy + lodvec.zw;\r\n    //取整像素\r\n    t_uv = floor(t_uv * u_imageSize) / u_imageSize;\r\n    vec4 tColor01 = texture2D(s_splatMergeTexture,t_uv);\r\n\r\n    t_uv = fract(uv + lodPixelOffset * vec2(1.0, 1.0));\r\n    t_uv = t_uv * offset.xy + offset.zw;\r\n    //添加lod起始坐标\r\n    t_uv = t_uv * lodvec.xy + lodvec.zw;\r\n    //取整像素\r\n    t_uv = floor(t_uv * u_imageSize) / u_imageSize;\r\n    vec4 tColor11 = texture2D(s_splatMergeTexture,t_uv);\r\n\r\n    vec4 tColor0 = mix(tColor00,tColor10,mixFactor.x);\r\n    vec4 tColor1 = mix(tColor01,tColor11,mixFactor.x);\r\n    vec4 tColor = mix(tColor0,tColor1,mixFactor.y);\r\n\r\n    return tColor;\r\n\r\n    // return vec4(mixFactor.x,mixFactor.y,0.0,1.0);\r\n    // return vec4(mixFactor.x + 0.5,mixFactor.y + 0.5,0.0,1.0);\r\n}\r\n\r\n//参考 http://blog.csdn.net/cgwbr/article/details/6620318\r\n//计算MipMap层函数：\r\nfloat mipmapLevel(vec2 uv)\r\n{\r\n    vec2 dx = dFdx(uv);\r\n    vec2 dy = dFdy(uv);\r\n    float d = max(dot(dx, dx), dot(dy, dy));\r\n    return 0.5 * log2(d);\r\n}\r\n\r\n//根据距离以及法线计算MipMap层函数：\r\nfloat mipmapLevel1(vec2 uv)\r\n{\r\n    //视线方向\r\n    vec3 cameraDir = u_cameraPos - v_worldPosition.xyz;\r\n    float fogDistance = length(cameraDir);\r\n    float value = u_scaleByDepth * fogDistance * u_uvPositionScale;//uv变化率与距离成正比，0.001为顶点位置与uv的变化比率\r\n    cameraDir = normalize(cameraDir);\r\n    float dd = clamp(dot(cameraDir, v_normal),0.05,1.0);//取法线与视线余弦值的倒数，余弦值越大（朝向摄像机时uv变化程度越低）lod越小\r\n    value = value / dd;\r\n    value = value * 0.5;//还没搞懂0.5的来历\r\n    return log2(value);\r\n}\r\n\r\nvec4 terrainTexture2D(sampler2D s_splatMergeTexture, vec2 t_uv, float lod, vec4 offset){\r\n \r\n    #ifdef LOD_LINEAR\r\n        vec4 tColor = mix(terrainTexture2DLod(s_splatMergeTexture, t_uv, floor(lod), offset),terrainTexture2DLod(s_splatMergeTexture, t_uv, ceil(lod), offset), fract(lod));\r\n    #else\r\n        vec4 tColor = terrainTexture2DLod(s_splatMergeTexture, t_uv, ceil(lod), offset);\r\n    #endif\r\n\r\n    return tColor;\r\n}\r\n\r\nvec4 terrainMethod(vec4 diffuseColor, vec2 v_uv) \r\n{\r\n    float lod = 0.0;\r\n    vec4 blend = texture2D(s_blendTexture, v_uv);\r\n    for(int i = 0; i < 3; i++)\r\n    {\r\n        vec2 t_uv = v_uv * u_splatRepeats[i];\r\n        // lod = mipmapLevel(v_uv) + log2(u_tileSize.x * u_splatRepeats[i]);\r\n        lod = mipmapLevel1(v_uv) + log2(u_tileSize.x * u_splatRepeats[i]);\r\n        lod = clamp(lod, 0.0, u_maxLod);\r\n        vec4 tColor = terrainTexture2D(s_splatMergeTexture, t_uv, lod, u_tileOffset[i]);\r\n        diffuseColor = (tColor - diffuseColor) * blend[i] + diffuseColor;\r\n    }\r\n\r\n    // diffuseColor.xyz = vec3(1.0,0.0,0.0);\r\n    // diffuseColor.xyz = vec3(lod/u_maxLod,0.0,0.0);\r\n    // diffuseColor.xyz = vec3(floor(lod)/u_maxLod,0.0,0.0);\r\n    return diffuseColor;\r\n}",terrain_frag:"diffuseColor = terrainMethod(diffuseColor, v_uv);",terrain_pars_frag:"#ifdef USE_TERRAIN_MERGE\r\n    #include<terrainMerge_pars_frag>\r\n#else\r\n    #include<terrainDefault_pars_frag>\r\n#endif",uv_pars_vert:"attribute vec2 a_uv;\r\n\r\nvarying vec2 v_uv;",uv_vert:"v_uv = a_uv;\r\n#ifdef SCALEU\r\n    #ifdef SCALEV\r\n    v_uv = v_uv * vec2(SCALEU,SCALEV);\r\n    #endif\r\n#endif",worldposition_pars_vert:"uniform mat4 u_modelMatrix;\r\n\r\nvarying vec3 v_worldPosition;",worldposition_vert:"//获取全局坐标\r\nvec4 worldPosition = u_modelMatrix * position;\r\n//输出全局坐标\r\nv_worldPosition = worldPosition.xyz;"}});var da=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Mi(e,t),e.prototype._canvasChanged=function(){this._pixels=this.canvas,this.invalidate()},Ci([N("_canvasChanged")],e.prototype,"canvas",void 0),e}(zr),ma=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Mi(e,t),e.prototype._imageDataChanged=function(){this._pixels=this.imageData,this.invalidate()},Ci([N("_imageDataChanged")],e.prototype,"imageData",void 0),e}(zr),ya=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Mi(e,t),e.prototype._imageChanged=function(){this._pixels=this.imageSource,this.invalidate()},Ci([N("_imageChanged")],e.prototype,"imageSource",void 0),e}(zr),va=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Mi(e,t),e.prototype._videoChanged=function(){this._pixels=this.video,this.invalidate()},Ci([N("_videoChanged")],e.prototype,"video",void 0),e}(zr),ga=function(){function t(){this.objectUuid=new WeakMap}return t.prototype.getArrayUuid=function(t,e){var n=this;return void 0===e&&(e="$__uuid__$"),t.map((function(t){return n.getObjectUuid(t)})).join(e)},t.prototype.getObjectUuid=function(t){return f.isBaseType(t)?String(t):(t[_a]||Object.defineProperty(t,_a,{value:P.uuid()}),t[_a])},t}(),_a="__uuid__",ba=new ga,xa=function(){function t(){this._wrapFResult={},this._state={}}return t.prototype.extendFunction=function(t,e,n){var i=t[e];t[e]=function(){for(var t=arguments,e=[],r=0;r<arguments.length;r++)e[r]=t[r];var o=i.apply(this,e),a=e.concat();return a.unshift(o),o=n.apply(this,a)}},t.prototype.wrap=function(t,e,n,i){if(n||i){Object.getOwnPropertyDescriptor(t,wa)||Object.defineProperty(t,wa,{value:{},configurable:!0,enumerable:!1,writable:!1});var r=t[wa],o=r[e];if(!o){var a=Object.getOwnPropertyDescriptor(t,e),s=t[e];r[e]=o={space:t,funcName:e,oldPropertyDescriptor:a,original:s,funcs:[s]},t[e]=function(){var t=this,e=arguments;o.funcs.forEach((function(n){n.apply(t,e)}))}}var u=o.funcs;n&&(p.deleteItem(u,n),u.unshift(n)),i&&(p.deleteItem(u,i),u.push(i))}},t.prototype.unwrap=function(t,e,n){var i=t[wa],r=i[e];r&&(void 0===n?r.funcs=[r.original]:p.deleteItem(r.funcs,n),1===r.funcs.length&&(delete t[e],r.oldPropertyDescriptor&&Object.defineProperty(t,e,r.oldPropertyDescriptor),delete i[e],0===Object.keys(i).length&&delete t[wa]))},t.prototype.wrapAsyncFunc=function(t,e,n,i){var r=this,o=ba.getArrayUuid([e].concat(n)),a=this._wrapFResult[o];a?i.apply(null,a):(Y.once(this,o,(function(){r.wrapAsyncFunc(t,e,n,i)})),this._state[o]||(this._state[o]=!0,e.apply(t,n.concat((function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];delete r._state[o],r._wrapFResult[o]=e,Y.emit(r,o)})))))},t}(),wa="__functionwrap__",Sa=new xa,Pa=function(){function t(){Sa.wrap(console,"assert",(function(t){})),Sa.wrap(console,"error",(function(){})),Sa.wrap(console,"warn",(function(){}))}return t.prototype.time=function(t,e){e=e||t.name||"Anonymous function "+Math.random(),console.time(e),t(),console.timeEnd(e)},t}(),Ma=new Pa,Ca=function(){this.json=/(\.json)\b/i,this.image=/(\.jpg|\.png|\.jpeg|\.gif)\b/i,this.audio=/(\.ogg|\.mp3|\.wav)\b/i,this.namespace=/namespace\s+([\w$_\d\.]+)/,this.classReg=/(export\s+)?(abstract\s+)?class\s+([\w$_\d]+)(\s+extends\s+([\w$_\d\.]+))?/},Ta=new Ca,Aa=function(){function t(){var t=this,e=0;if("undefined"!=typeof document){var n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;",n.addEventListener("click",(function(t){t.preventDefault(),l(++e%n.children.length)}),!1);var i,r=(performance||Date).now(),o=r,a=0,s=c(new Oa("FPS","#0ff","#002")),u=c(new Oa("MS","#0f0","#020"));self.performance&&self.performance.memory&&(i=c(new Oa("MB","#f08","#201"))),l(0),this.REVISION=16,this.dom=n,this.addPanel=c,this.showPanel=l,this.begin=function(){r=(performance||Date).now()},this.end=function(){a++;var t=(performance||Date).now();if(u.update(t-r,200),t>o+1e3&&(s.update(1e3*a/(t-o),100),o=t,a=0,i)){var e=performance.memory;i.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},this.update=function(){r=t.end()},this.domElement=n,this.setMode=l}function c(t){return n.appendChild(t.dom),t}function l(t){for(var i=0;i<n.children.length;i++)n.children[i].style.display=i===t?"block":"none";e=t}}return t.init=function(e){this.instance||(this.instance=new t,(e=e||document.body).appendChild(this.instance.dom)),cr.onframe(this.instance.update,this.instance)},t}(),Oa=function(t,e,n){var i=1/0,r=0,o=Math.round,a=o(window.devicePixelRatio||1),s=80*a,u=48*a,c=3*a,l=2*a,h=3*a,p=15*a,f=74*a,d=30*a,m=document.createElement("canvas");m.width=s,m.height=u,m.style.cssText="width:80px;height:48px";var y=m.getContext("2d");if(y){var v=y;v.font="bold "+9*a+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=n,v.fillRect(0,0,s,u),v.fillStyle=e,v.fillText(t,c,l),v.fillRect(h,p,f,d),v.fillStyle=n,v.globalAlpha=.9,v.fillRect(h,p,f,d),this.dom=m,this.update=function(u,y){i=Math.min(i,u),r=Math.max(r,u),v.fillStyle=n,v.globalAlpha=1,v.fillRect(0,0,s,p),v.fillStyle=e,v.fillText(o(u)+" "+t+" ("+o(i)+"-"+o(r)+")",c,l),v.drawImage(m,h+a,p,f-a,d,h,p,f-a,d),v.fillRect(h+f-a,p,a,d),v.fillStyle=n,v.globalAlpha=.9,v.fillRect(h+f-a,p,a,o((1-u/y)*d))}}else console.log("无法创建 CanvasRenderingContext2D ")},Ea=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.geometry=Tr.getDefault("Plane"),e.material=Lr.getDefault("Water-Material"),e.frameBufferObject=new Co,e}return Mi(e,t),e.prototype.beforeRender=function(e,n,i){var r=this.material.uniforms,o=this.gameObject.scene.activeDirectionalLights[0];o&&(r.u_sunColor=o.color,r.u_sunDirection=o.transform.localToWorldMatrix.getAxisZ().negate()),r.u_time+=1/60,t.prototype.beforeRender.call(this,e,n,i)},e=Ci([zi("Graphics/Water"),Ai()],e)}(Fr);Vr.registerPrimitive("Water",(function(t){t.addComponent(Ea)})),Vi.push({path:"3D Object/Water",priority:-2e4,click:function(){return Vr.createPrimitive("Water")}});var Da=function(){function t(){this.u_alpha=1,this.u_time=0,this.u_size=10,this.u_distortionScale=20,this.u_waterColor=(new pt).fromUnit(5592405),this.s_normalSampler=zr.default,this.s_mirrorSampler=zr.default,this.u_textureMatrix=new Nt,this.u_sunColor=(new pt).fromUnit(8355711),this.u_sunDirection=new ht(.70707,.70707,0)}return Ci([C,n({tooltip:"透明度"})],t.prototype,"u_alpha",void 0),Ci([C,n({tooltip:"水体展现的尺寸"})],t.prototype,"u_size",void 0),Ci([n(),C],t.prototype,"u_distortionScale",void 0),Ci([C,n({tooltip:"水体颜色"})],t.prototype,"u_waterColor",void 0),Ci([n(),C,n({tooltip:"水体法线图"})],t.prototype,"s_normalSampler",void 0),Ci([n()],t.prototype,"s_mirrorSampler",void 0),t}();Fn.shaderConfig.shaders.water={fragment:"precision mediump float;  \r\n\r\nuniform vec3 u_cameraPos;\r\n\r\nvarying vec4 v_mirrorCoord;\r\nvarying vec4 v_worldPosition;\r\n\r\nuniform sampler2D s_mirrorSampler;\r\nuniform sampler2D s_normalSampler;\r\n\r\nuniform float u_alpha;\r\nuniform float u_time;\r\nuniform float u_size;\r\nuniform float u_distortionScale;\r\nuniform vec3 u_sunColor;\r\nuniform vec3 u_sunDirection;\r\nuniform vec3 u_waterColor;\r\n\r\nvec4 getNoise( vec2 uv ) \r\n{\r\n\tvec2 uv0 = ( uv / 103.0 ) + vec2(u_time / 17.0, u_time / 29.0);\r\n\tvec2 uv1 = uv / 107.0-vec2( u_time / -19.0, u_time / 31.0 );\r\n\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( u_time / 101.0, u_time / 97.0 );\r\n\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( u_time / 109.0, u_time / -113.0 );\r\n\tvec4 noise = texture2D( s_normalSampler, uv0 ) +\r\n\t\ttexture2D( s_normalSampler, uv1 ) +\r\n\t\ttexture2D( s_normalSampler, uv2 ) +\r\n\t\ttexture2D( s_normalSampler, uv3 );\r\n\treturn noise * 0.5 - 1.0;\r\n}\r\n\r\nvoid sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) \r\n{\r\n\tvec3 reflection = normalize( reflect( -u_sunDirection, surfaceNormal ) );\r\n\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );\r\n\tspecularColor += pow( direction, shiny ) * u_sunColor * spec;\r\n\tdiffuseColor += max( dot( u_sunDirection, surfaceNormal ), 0.0 ) * u_sunColor * diffuse;\r\n}\r\n\r\nvoid main() \r\n{\r\n\tvec4 noise = getNoise( v_worldPosition.xz * u_size );\r\n\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );\r\n\tvec3 diffuseLight = vec3(0.0);\r\n\tvec3 specularLight = vec3(0.0);\r\n\tvec3 worldToEye = u_cameraPos-v_worldPosition.xyz;\r\n\tvec3 eyeDirection = normalize( worldToEye );\r\n\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );\r\n\tfloat distance = length(worldToEye);\r\n\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * u_distortionScale;\r\n\tvec3 reflectionSample = vec3( texture2D( s_mirrorSampler, v_mirrorCoord.xy / v_mirrorCoord.z + distortion ) );\r\n\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );\r\n\tfloat rf0 = 0.3;\r\n\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );\r\n\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * u_waterColor;\r\n\r\n\tfloat shadowMask = 1.0;\r\n\t// float shadowMask = getShadowMask();\r\n\r\n\tvec3 albedo = mix( ( u_sunColor * diffuseLight * 0.3 + scatter ) * shadowMask, ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);\r\n\tvec3 outgoingLight = albedo;\r\n\tgl_FragColor = vec4( outgoingLight, u_alpha );\r\n\r\n\t// debug\r\n\t// gl_FragColor = texture2D( s_mirrorSampler, (v_mirrorCoord.xy / v_mirrorCoord.z + 1.0) / 2.0 );\r\n\t// gl_FragColor = vec4( reflectionSample, 1.0 );\r\n\t// gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\r\n}",vertex:"attribute vec3 a_position;\r\n\r\nuniform mat4 u_modelMatrix;\r\nuniform mat4 u_viewProjection;\r\n\r\nuniform mat4 u_textureMatrix;\r\n\r\nvarying vec4 v_mirrorCoord;\r\nvarying vec4 v_worldPosition;\r\n\r\nvoid main() \r\n{\r\n\tvec4 position = vec4(a_position, 1.0);\r\n\t//获取全局坐标\r\n    vec4 worldPosition = u_modelMatrix * position;\r\n    //计算投影坐标\r\n    gl_Position = u_viewProjection * worldPosition;\r\n\t\r\n\tv_worldPosition = worldPosition;\r\n\tv_mirrorCoord = u_textureMatrix * worldPosition;\r\n}",cls:Da},Lr.setDefault("Water-Material",{shaderName:"water"});var za=function(t,e){return za=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},za(t,e)};function Ia(t,e){function n(){this.constructor=t}za(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function ja(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}var Ra=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ia(e,t),e.prototype.saveFile=function(t){this.rs.fs.writeArrayBuffer(this.assetPath,this.arraybuffer,t)},e.prototype.readFile=function(t){var e=this;this.rs.fs.readArrayBuffer(this.assetPath,(function(n,i){e.arraybuffer=i,t&&t(n)}))},e}(br),La=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.assetType=t.AssetType.audio,n}return Ia(n,e),n}(Ra),Na=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ia(e,t),e.prototype.saveFile=function(t){this.data.assetId=this.assetId;var e=E.serialize(this.data);this.rs.fs.writeObject(this.assetPath,e,(function(e){t&&t(e)}))},e.prototype.readFile=function(t){var e=this;this.rs.fs.readObject(this.assetPath,(function(n,i){e.rs.deserializeWithAssets(i,(function(i){e.data=i,e.data.assetId=e.assetId,t&&t(n)}))}))},e.prototype._dataChanged=function(t,e,n){e&&Q.off(e,"propertyValueChanged",this._onDataChanged,this),n&&Q.on(n,"propertyValueChanged",this._onDataChanged,this)},e.prototype._onDataChanged=function(){this.write()},ja([n({component:"OAVObjectView"}),N("_dataChanged")],e.prototype,"data",void 0),e}(br),Fa=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.assetType=t.AssetType.gameobject,n}return Ia(i,e),i.prototype.initAsset=function(){this.data=this.data||new Vr,this.data.assetId=this.data.assetId||this.assetId},i.prototype._getAssetData=function(){var t=E.clone(this.data);return delete t.assetId,t.prefabId=this.assetId,t},i.extenson=".json",ja([n({component:"OAVObjectView"})],i.prototype,"data",void 0),i}(Na),ka=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.assetType=t.AssetType.geometry,n}return Ia(i,e),i.prototype.initAsset=function(){this.data=this.data||new oa,this.data.assetId=this.data.assetId||this.assetId},i.extenson=".json",ja([n({component:"OAVObjectView"})],i.prototype,"data",void 0),i}(Na);gr("geometry",ka);var Ba=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.assetType=t.AssetType.txt,n}return Ia(i,e),i.prototype.initAsset=function(){this.textContent=this.textContent||""},i.prototype.saveFile=function(t){this.rs.fs.writeString(this.assetPath,this.textContent,t)},i.prototype.readFile=function(t){var e=this;this.rs.fs.readString(this.assetPath,(function(n,i){e.textContent=i,t&&t(n)}))},i.extenson=".txt",ja([n({component:"OAVMultiText"})],i.prototype,"textContent",void 0),i}(br);gr("txt",Ba);var Va=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.assetType=t.AssetType.js,n}return Ia(n,e),n.prototype.initAsset=function(){this.textContent=this.textContent||""},n.extenson=".js",n}(Ba);gr("js",Va);var Wa=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.assetType=t.AssetType.json,n}return Ia(n,e),n.prototype.initAsset=function(){this.textContent=this.textContent||"{}"},n.extenson=".json",n}(Ba);gr("json",Wa);var Ua=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.assetType=t.AssetType.material,n}return Ia(i,e),i.prototype.initAsset=function(){this.data=this.data||new Lr},i.extenson=".json",ja([n({component:"OAVObjectView"})],i.prototype,"data",void 0),i}(Na);gr("material",Ua);var Ga=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.assetType=t.AssetType.script,n._invalid=!0,n}return Ia(n,e),Object.defineProperty(n.prototype,"parentScriptName",{get:function(){return this._update(),this._parentScriptName},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"scriptName",{get:function(){return this._update(),this._scriptName},enumerable:!1,configurable:!0}),n.prototype.initAsset=function(){this.textContent=this.textContent||""},n.prototype._invalidate=function(){this._invalid=!0},n.prototype._update=function(){if(this._invalid)if(this._invalid=!1,this.textContent){var t=Ta.classReg.exec(this.textContent);console.assert(null!==t,"在脚本 "+this.assetPath+" 中没有找到 脚本类定义");var e=t[3];t[5]&&(this._parentScriptName=t[5].split(".").pop()),t[1]&&(t=Ta.namespace.exec(this.textContent),console.assert(null!==t,"获取脚本 "+this.assetPath+" 命名空间失败"),e=t[1]+"."+e),this._scriptName=e}else this._scriptName=""},n.extenson=".ts",ja([N("_invalidate")],n.prototype,"textContent",void 0),n}(Ba);gr("script",Ga);var Ha=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.assetType=t.AssetType.shader,n}return Ia(n,e),n.extenson=".ts",n}(Ga);gr("shader",Ha);var Ka=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.assetType=t.AssetType.texture,n}return Ia(i,e),Object.defineProperty(i.prototype,"image",{get:function(){return this.data._pixels},set:function(t){this.data._pixels=t,this.saveFile()},enumerable:!1,configurable:!0}),i.prototype.initAsset=function(){this.data=this.data||new zr},i.prototype.saveFile=function(t){this.rs.fs.writeImage(this.assetPath,this.image,(function(e){t&&t(e)}))},i.prototype.readFile=function(t){var e=this;this.rs.fs.readImage(this.assetPath,(function(n,i){e.data._pixels=i,t&&t(n)}))},i.prototype.readMeta=function(t){var n=this;e.prototype.readMeta.call(this,(function(e){n.rs.deserializeWithAssets(n.meta.texture,(function(i){n.data=i,t&&t(e)}))}))},i.prototype.writeMeta=function(t){this.meta.texture=E.serialize(this.data),e.prototype.writeMeta.call(this,t)},i.extenson=".png",ja([n({component:"OAVObjectView"})],i.prototype,"data",void 0),i}(br),Xa=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.assetType=t.AssetType.texturecube,n}return Ia(i,e),i.prototype.initAsset=function(){this.data=this.data||new Ir},i.extenson=".json",ja([n({component:"OAVObjectView"})],i.prototype,"data",void 0),i}(Na);gr("texturecube",Xa);var qa,Ya,Za=function(){function e(){}return e.prototype.convert=function(e,n){var i=new Li;i.name=e.name,i.length=e.numFrames/e.frameRate*1e3,i.propertyClips=[];for(var r={},o=0;o<e.numFrames;++o)a(e,e.frame[o],i);function a(e,n,i){for(var o,a,s,u,c=new ht,l=n.components,h=0;h<e.numJoints;++h){u=0,o=e.hierarchy[h],a=e.baseframe[h],s=o.flags,c.x=a.position[0],c.y=a.position[1],c.z=a.position[2];var p=new jt;p.x=a.orientation[0],p.y=a.orientation[1],p.z=a.orientation[2],1&s&&(c.x=l[o.startIndex+u++]),2&s&&(c.y=l[o.startIndex+u++]),4&s&&(c.z=l[o.startIndex+u++]),8&s&&(p.x=l[o.startIndex+u++]),16&s&&(p.y=l[o.startIndex+u++]),32&s&&(p.z=l[o.startIndex+u++]);var f=1-p.x*p.x-p.y*p.y-p.z*p.z;p.w=f<0?0:-Math.sqrt(f),p.y=-p.y,p.z=-p.z,c.x=-c.x,p.toEulerAngles().scaleNumber(180/Math.PI);var d=[[t.PropertyClipPathItemType.GameObject,o.name],[t.PropertyClipPathItemType.Component,"Transform"]],m=n.index/e.frameRate*1e3;y(d,"position",m,c.toArray(),"Vector3"),y(d,"orientation",m,p.toArray(),"Quaternion")}function y(t,e,n,o,a){var s=function(t,e){var n=t.join("-")+e;if(r[n])return r[n];if(!r[n]){var o=r[n]=new Ni;o.path=t,o.propertyName=e,o.propertyValues=[],i.propertyClips.push(o)}return r[n]}(t,e);s.type=a,s.propertyValues.push([n,o])}}Z.emit("asset.parsed",i),n&&n(i)},e}(),Qa=new Za,Ja=function(){function t(){}return t.prototype.convert=function(t,e){var n=new Vr;n.name=t.name,n.addComponent(Fi),n.transform.rx=-90;var i=this.calculateMaxJointCount(t);console.assert(i<=8,"顶点最大关节关联数最多支持8个");var r=this.createSkeleton(t.joints),o=n.addComponent(Wr);o.joints=r;for(var a=0;a<t.meshs.length;a++){var s=new Kr,u=this.createGeometry(t.meshs[a],o,s),c=new Vr,l=c.addComponent(Ur);l.geometry=u,l.skinSkeleton=s,n.addChild(c)}Z.emit("asset.parsed",n),e&&e(n)},t.prototype.calculateMaxJointCount=function(t){for(var e=0,n=t.meshs.length,i=0;i<n;++i)for(var r=t.meshs[i],o=r.verts,a=o.length,s=0;s<a;++s){var u=this.countZeroWeightJoints(o[s],r.weights),c=o[s].countWeight-u;c>e&&(e=c)}return e},t.prototype.countZeroWeightJoints=function(t,e){for(var n=t.startWeight,i=t.startWeight+t.countWeight,r=0,o=n;o<i;++o)0===e[o].bias&&++r;return r},t.prototype.createSkeleton=function(t){for(var e=[],n=0;n<t.length;n++){var i=this.createSkeletonJoint(t[n]);e.push(i)}return e},t.prototype.createSkeletonJoint=function(t){var e=new Bi;e.name=t.name,e.parentIndex=t.parentIndex;var n=t.position,i=t.rotation,r=new jt(i[0],-i[1],-i[2]),o=1-r.x*r.x-r.y*r.y-r.z*r.z;r.w=o<0?0:-Math.sqrt(o);var a=r.toMatrix();return a.appendTranslation(-n[0],n[1],n[2]),e.matrix=a,e},t.prototype.createGeometry=function(t,e,n){var i,r,o,a=t.verts,s=t.weights,u=t.tris,c=new qo,l=a.length,h=[];h.length=2*l;var p=[];p.length=3*l;var f=[];f.length=4*l;var d=[];d.length=4*l;var m=[];m.length=4*l;var y=[];y.length=4*l;for(var v=0;v<l;++v){i=a[v],p[3*v]=p[3*v+1]=p[3*v+2]=0;for(var g=[],_=[],b=0;b<8;++b)g[b]=0,_[b]=0,b<i.countWeight&&(r=s[i.startWeight+b]).bias>0&&(o=e.joints[r.joint].matrix.transformPoint3(new ht(-r.pos[0],r.pos[1],r.pos[2])),p[3*v]+=o.x*r.bias,p[3*v+1]+=o.y*r.bias,p[3*v+2]+=o.z*r.bias,g[b]=r.joint,_[b]=r.bias);f[4*v]=g[0],f[4*v+1]=g[1],f[4*v+2]=g[2],f[4*v+3]=g[3],d[4*v]=g[4],d[4*v+1]=g[5],d[4*v+2]=g[6],d[4*v+3]=g[7],m[4*v]=_[0],m[4*v+1]=_[1],m[4*v+2]=_[2],m[4*v+3]=_[3],y[4*v]=_[4],y[4*v+1]=_[5],y[4*v+2]=_[6],y[4*v+3]=_[7],h[2*i.index]=i.u,h[2*i.index+1]=i.v}return n.resetJointIndices(f,e),n.resetJointIndices(d,e),c.indices=u,c.positions=p,c.uvs=h,c.skinIndices=f,c.skinWeights=m,c.skinIndices1=d,c.skinWeights1=y,c},t}(),$a=new Ja,ts=function(){function t(){}return t.prototype.convert=function(t,e){var n={};for(var i in t){var r=t[i],o=n[i]=E.setValue(new Lr,{name:r.name,uniforms:{u_diffuse:{r:r.kd[0],g:r.kd[1],b:r.kd[2]},u_specular:{r:r.ks[0],g:r.ks[1],b:r.ks[2]}}});Z.emit("asset.parsed",o)}e&&e(null,n)},t}(),es=new ts,ns=function(){function t(){}return t.prototype.convert=function(t,e,n){var i=new Vr;i.name=t.name;for(var r=t.objs,o=0;o<r.length;o++){var a=rs(t,r[o],e);i.addChild(a)}Z.emit("asset.parsed",i),n&&n(i)},t}(),is=new ns;function rs(t,e,n){for(var i=E.setValue(new Vr,{name:e.name}),r=e.subObjs,o=0;o<r.length;o++){var a=os(t,r[o],n);i.addChild(a)}return i}function os(t,e,n){var i=new Vr;i.name=e.g||i.name;var r=i.addComponent(Fr);n&&n[e.material]&&(r.material=n[e.material]);var o=r.geometry=new qo;o.name=e.g||o.name;var a=[],s=[],u=[];qa=[],Ya=0;for(var c=e.faces,l=[],h=0;h<c.length;h++)for(var p=c[h],f=p.indexIds.length-1,d=1;d<f;++d)m(p,d,a,u,l,s,t),m(p,0,a,u,l,s,t),m(p,d+1,a,u,l,s,t);return o.indices=l,o.positions=a,s.length>0&&(o.normals=s),u.length>0&&(o.uvs=u),Z.emit("asset.parsed",o),i;function m(t,e,n,i,r,o,a){var s,u,c,l;if(qa[t.indexIds[e]])s=qa[t.indexIds[e]]-1;else if(s=Ya,qa[t.indexIds[e]]=++Ya,u=a.vertex[parseInt(t.vertexIndices[e])-1],n.push(u.x,u.y,u.z),t.normalIndices&&t.normalIndices.length>0&&(c=a.vn[parseInt(t.normalIndices[e])-1],o.push(c.x,c.y,c.z)),t.uvIndices&&t.uvIndices.length>0)try{l=a.vt[parseInt(t.uvIndices[e])-1],i.push(l.u,l.v)}catch(t){switch(e){case 0:i.push(0,1);break;case 1:i.push(.5,0);break;case 2:i.push(1,1)}}r.push(s)}}var as,ss=function(){function t(){}return t.prototype.parse=function(t){var e,n={},i=t.split("\n").reverse();do{(e=i.pop())&&Ms(e,n)}while(e);return n},t}(),us=new ss,cs=/MD5Version\s+(\d+)/,ls=/commandline\s+"([\w\s/.-]+)"/,hs=/numFrames\s+(\d+)/,ps=/numJoints\s+(\d+)/,fs=/frameRate\s+(\d+)/,ds=/numAnimatedComponents\s+(\d+)/,ms=/hierarchy\s+{/,ys=/"(\w+)"\s+([\d-]+)\s+(\d+)\s+(\d+)(\s+\/\/(\s+\w+)?(\s+\([\s\w]+\))?)?/,vs=/}/,gs=/bounds\s+{/,_s=/\(\s+([\d.-]+)\s+([\d.-]+)\s+([\d.-]+)\s+\)\s+\(\s+([\d.-]+)\s+([\d.-]+)\s+([\d.-]+)\s+\)/,bs=/baseframe\s+{/,xs=/frame\s+(\d+)\s+{/,ws=/(-?[\d.]+)(\s+-?[\d.]+){0,}/;!function(t){t[t.hierarchy=0]="hierarchy",t[t.bounds=1]="bounds",t[t.baseframe=2]="baseframe",t[t.frame=3]="frame"}(as||(as={}));var Ss,Ps=[];function Ms(t,e){var n;if(t&&(t=t.trim()).length)if((n=cs.exec(t))&&n[0]===t)e.MD5Version=parseInt(n[1],10);else if((n=ls.exec(t))&&n[0]===t)e.commandline=n[1];else if((n=hs.exec(t))&&n[0]===t)e.numFrames=parseInt(n[1],10);else if((n=ps.exec(t))&&n[0]===t)e.numJoints=parseInt(n[1],10);else if((n=fs.exec(t))&&n[0]===t)e.frameRate=parseInt(n[1],10);else if((n=ds.exec(t))&&n[0]===t)e.numAnimatedComponents=parseInt(n[1],10);else if((n=ms.exec(t))&&n[0]===t)e.hierarchy=[],Ps.push(as.hierarchy);else if((n=ys.exec(t))&&n[0]===t){if(Ps[Ps.length-1]!==as.hierarchy)throw new Error("没有对应的数据处理");e.hierarchy.push({name:n[1],parentIndex:parseInt(n[2],10),flags:parseInt(n[3],10),startIndex:parseInt(n[4],10)})}else if((n=vs.exec(t))&&n[0]===t){if(Ps.pop()===as.frame){if(Ss&&Ss.components.length!==e.numAnimatedComponents)throw new Error("frame中数据不对");Ss=null}}else if((n=gs.exec(t))&&n[0]===t)e.bounds=[],Ps.push(as.bounds);else if((n=bs.exec(t))&&n[0]===t)e.baseframe=[],Ps.push(as.baseframe);else if((n=_s.exec(t))&&n[0]===t)switch(Ps[Ps.length-1]){case as.bounds:e.bounds.push({min:[parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])],max:[parseFloat(n[4]),parseFloat(n[5]),parseFloat(n[6])]});break;case as.baseframe:e.baseframe.push({position:[parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])],orientation:[parseFloat(n[4]),parseFloat(n[5]),parseFloat(n[6])]});break;default:throw new Error("没有对应的数据处理")}else if((n=xs.exec(t))&&n[0]===t)e.frame||(e.frame=[]),Ss={index:parseInt(n[1],10),components:[]},e.frame.push(Ss),Ps.push(as.frame);else{if(!(n=ws.exec(t))||n[0]!==t)throw new Error("无法解析"+t);if(Ps[Ps.length-1]!==as.frame)throw new Error("没有对应的数据处理");if(Ss)for(var i=t.split(" "),r=0;r<i.length;r++)Ss.components.push(parseFloat(i[r]))}}var Cs,Ts=function(){function t(){}return t.prototype.parse=function(t){for(var e={},n=t.split("\n"),i=0;i<n.length;i++)Xs(n[i],e);return e},t}(),As=new Ts,Os=/MD5Version\s+(\d+)/,Es=/commandline\s+"([\w\s/.-]+)"/,Ds=/numJoints\s+(\d+)/,zs=/numMeshes\s+(\d+)/,Is=/joints\s+{/,js=/"(\w+)"\s+([-\d]+)\s+\(\s+([\d.-]+)\s+([\d.-]+)\s+([\d.-]+)\s+\)\s+\(\s+([\d.-]+)\s+([\d.-]+)\s+([\d.-]+)\s+\)(\s+\/\/(\s+\w+)?)?/,Rs=/}/,Ls=/mesh\s+{/,Ns=/\/\/[\s\w:]+/,Fs=/shader\s+"([\w\/]+)"/,ks=/numverts\s+(\d+)/,Bs=/vert\s+(\d+)\s+\(\s+([\d.]+)\s+([\d.]+)\s+\)\s+(\d+)\s+(\d+)/,Vs=/numtris\s+(\d+)/,Ws=/tri\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)/,Us=/numweights\s+(\d+)/,Gs=/weight\s+(\d+)\s+(\d+)\s+([\d.]+)\s+\(\s+([\d.-]+)\s+([\d.-]+)\s+([\d.-]+)\s+\)/;!function(t){t[t.joints=0]="joints",t[t.mesh=1]="mesh"}(Cs||(Cs={}));var Hs,Ks=[];function Xs(t,e){var n;if(t&&(t=t.trim()).length)if((n=Os.exec(t))&&n[0]===t)e.MD5Version=parseInt(n[1],10);else if((n=Es.exec(t))&&n[0]===t)e.commandline=n[1];else if((n=Ds.exec(t))&&n[0]===t)e.numJoints=parseInt(n[1],10);else if((n=zs.exec(t))&&n[0]===t)e.numMeshes=parseInt(n[1],10);else if((n=Is.exec(t))&&n[0]===t)Ks.push(Cs.joints),e.joints=[];else if((n=js.exec(t))&&n[0]===t)e.joints.push({name:n[1],parentIndex:parseInt(n[2],10),position:[parseFloat(n[3]),parseFloat(n[4]),parseFloat(n[5])],rotation:[parseFloat(n[6]),parseFloat(n[7]),parseFloat(n[8])]});else if((n=Rs.exec(t))&&n[0]===t){Ks.pop()===Cs.mesh&&(Hs=null)}else if((n=Ls.exec(t))&&n[0]===t)Ks.push(Cs.mesh),e.meshs||(e.meshs=[]),Hs={},e.meshs.push(Hs);else if((n=Ns.exec(t))&&n[0]===t);else if((n=Fs.exec(t))&&n[0]===t)Hs.shader=n[1];else if((n=ks.exec(t))&&n[0]===t)Hs.numverts=parseInt(n[1],10),Hs.verts=[];else if((n=Bs.exec(t))&&n[0]===t)Hs.verts.push({index:parseFloat(n[1]),u:parseFloat(n[2]),v:parseFloat(n[3]),startWeight:parseFloat(n[4]),countWeight:parseFloat(n[5])});else if((n=Vs.exec(t))&&n[0]===t)Hs.numtris=parseInt(n[1],10),Hs.tris=[];else if((n=Ws.exec(t))&&n[0]===t){var i=3*parseInt(n[1],10);Hs.tris[i]=parseInt(n[2],10),Hs.tris[i+1]=parseInt(n[3],10),Hs.tris[i+2]=parseInt(n[4],10)}else if((n=Us.exec(t))&&n[0]===t)Hs.numweights=parseInt(n[1],10),Hs.weights=[];else{if(!(n=Gs.exec(t))||n[0]!==t)throw new Error("无法解析"+t);Hs.weights.push({index:parseInt(n[1],10),joint:parseInt(n[2],10),bias:parseFloat(n[3]),pos:[parseFloat(n[4]),parseFloat(n[5]),parseFloat(n[6])]})}}var qs=function(){function t(){}return t.prototype.load=function(t,e){Jn.fs.readString(t,(function(n,i){var r=As.parse(i);r.name=ri.getName(t),$a.convert(r,e)}))},t.prototype.loadAnim=function(t,e){Jn.fs.readString(t,(function(n,i){var r=us.parse(i);r.name=ri.getName(t),Qa.convert(r,e)}))},t}(),Ys=new qs,Zs=function(){this.loop=!0},Qs=function(){},Js=function(){function t(){this.rotations=[]}return t.prototype.getRotationItem=function(t){var e=new jt;return"DontInterp"===this.type?e.fromEuler(t.value.x,t.value.y,t.value.z):e.copy(t.value),e},t.prototype.getRotation=function(t){var e=new jt;if(0===this.rotations.length||t<this.rotations[0].time||t>this.rotations[this.rotations.length-1].time)return new jt;for(var n=this.rotations[0],i=this.rotations[0],r=0;r<this.rotations.length&&!((i=this.rotations[r]).time>t);r++)n=i;if(n===i)return e.copy(n.value),e;var o,a,s=(t-n.time)/(i.time-n.time);switch(this.type){case"DontInterp":e.fromEuler(n.value.x,n.value.y,n.value.z);break;case"Linear":case"Hermite":case"Bezier":o=n.value.clone(),a=i.value.clone(),o.slerpTo(a,s,e)}return e},t}(),$s=function(){function e(){this.Parent=-1,this.Translation=new eu,this.Scaling=new tu,this.Rotation=new Js,this.transformation=new Nt,this.globalTransformation=new Nt}return e.prototype.calculateTransformation=function(t){var e=this.Scaling.getScaling(t),n=this.Rotation.getRotation(t),i=this.Translation.getTranslation(t),r=this.transformation;r.appendScale(e.x,e.y,e.z).append(n.toMatrix(new Nt)),r.prependTranslation(-this.pivotPoint.x,-this.pivotPoint.y,-this.pivotPoint.z),r.appendTranslation(this.pivotPoint.x,this.pivotPoint.y,this.pivotPoint.z),r.appendTranslation(i.x,i.y,i.z)},e.prototype.buildAnimationclip=function(e,n,i,r){var o=[[t.PropertyClipPathItemType.GameObject,this.name],[t.PropertyClipPathItemType.Component,"Transform"]];if(this.Scaling.scalings.length>0)for(var a=this.Scaling.scalings,s=0,u=a.length;s<u;s++){var c=a[s];i<=c.time&&c.time<=r&&d(o,"scale",c.time-i,c.value.toArray(),"Vector3")}if(this.Translation.translations.length>0){var l=this.Translation.translations;for(s=0,u=l.length;s<u;s++){var h=l[s];i<=h.time&&h.time<=r&&d(o,"position",h.time-i,h.value.addTo(this.pivotPoint).toArray(),"Vector3")}}if(this.Rotation.rotations.length>0){var p=this.Rotation.rotations;for(s=0,u=p.length;s<u;s++){var f=p[s];i<=f.time&&f.time<=r&&d(o,"orientation",f.time-i,this.Rotation.getRotationItem(f).toArray(),"Quaternion")}}function d(t,i,r,o,a){var s=function(t,i){var r=t.join("-")+i;if(n[r])return n[r];if(!n[r]){var o=n[r]=new Ni;o.path=t,o.propertyName=i,o.propertyValues=[],e.propertyClips.push(o)}return n[r]}(t,i);s.type=a,s.propertyValues.push([r,o])}},e.prototype.getMatrix=function(t){var e=this.Scaling.getScaling(t),n=this.Rotation.getRotation(t),i=this.Translation.getTranslation(t),r=(new Nt).appendScale(e.x,e.y,e.z).append(n.toMatrix(new Nt));return r.appendTranslation(i.x+this.pivotPoint.x,i.y+this.pivotPoint.y,i.z+this.pivotPoint.z),r},e}(),tu=function(){function t(){this.scalings=[]}return t.prototype.getScaling=function(t){var e=new ht;if(0===this.scalings.length||t<this.scalings[0].time||t>this.scalings[this.scalings.length-1].time)return new ht(1,1,1);for(var n=this.scalings[0],i=this.scalings[0],r=0;r<this.scalings.length&&!((i=this.scalings[r]).time>=t);r++)n=i;if(n.time===i.time)return e.copy(n.value),e;var o,a,s,u,c,l,h,p=(t-n.time)/(i.time-n.time),f=1-p;switch(this.type){case"DontInterp":e.copy(n.value);break;case"Linear":(o=n.value.clone()).scaleNumber(f),e.add(o),(o=i.value.clone()).scaleNumber(p),e.add(o);break;case"Hermite":a=(l=p*p)*(2*p-3)+1,s=l*(p-2)+p,u=l*(p-1),c=l*(3-2*p),(o=n.value.clone()).scaleNumber(a),e.add(o),(o=n.OutTan.clone()).scaleNumber(s),e.add(o),(o=i.InTan.clone()).scaleNumber(u),e.add(o),(o=i.value.clone()).scaleNumber(c),e.add(o);break;case"Bezier":a=(h=f*f)*f,s=3*p*h,u=3*(l=p*p)*f,c=l*p,(o=n.value.clone()).scaleNumber(a),e.add(o),(o=n.OutTan.clone()).scaleNumber(s),e.add(o),(o=i.InTan.clone()).scaleNumber(u),e.add(o),(o=i.value.clone()).scaleNumber(c),e.add(o)}return e},t}(),eu=function(){function t(){this.translations=[]}return t.prototype.getTranslation=function(t){var e=new ht;if(0===this.translations.length)return new ht;for(var n=this.translations[0],i=this.translations[0],r=0;r<this.translations.length&&!((i=this.translations[r]).time>t);r++)n=i;if(n===i)return e.copy(n.value),e;var o,a,s,u,c,l,h,p=(t-n.time)/(i.time-n.time),f=1-p;switch(this.type){case"DontInterp":e.copy(n.value);break;case"Linear":(o=n.value.clone()).scaleNumber(f),e.add(o),(o=i.value.clone()).scaleNumber(p),e.add(o);break;case"Hermite":a=(l=p*p)*(2*p-3)+1,s=l*(p-2)+p,u=l*(p-1),c=l*(3-2*p),(o=n.value.clone()).scaleNumber(a),e.add(o),(o=n.OutTan.clone()).scaleNumber(s),e.add(o),(o=i.InTan.clone()).scaleNumber(u),e.add(o),(o=i.value.clone()).scaleNumber(c),e.add(o);break;case"Bezier":a=(h=f*f)*f,s=3*p*h,u=3*(l=p*p)*f,c=l*p,(o=n.value.clone()).scaleNumber(a),e.add(o),(o=n.OutTan.clone()).scaleNumber(s),e.add(o),(o=i.InTan.clone()).scaleNumber(u),e.add(o),(o=i.value.clone()).scaleNumber(c),e.add(o)}return e},t}(),nu=function(){},iu=function(){this.Anims=[]},ru=function(){this.durations=[]},ou=function(){},au=function(){},su=function(){this.layers=[]},uu=function(){},cu=function(){},lu=function(){},hu=function(){},pu=function(){function e(){this.geosets=[],this.bones=[]}return e.prototype.getMesh=function(){this.meshs=[],this.meshs.length=this.geosets.length;var e=E.setValue(new Vr,{name:this.model.name}),n=function(t){for(var e=t.bones,n=[],i=0;i<e.length;i++)r(i);return n;function r(i){if(n[i])return n[i];var o=e[i],a=new Bi;a.name=o.name,a.parentIndex=o.Parent;var s=t.pivotPoints[o.ObjectId],u=(new Nt).fromTRS(s,new ht,new ht(1,1,1));if(-1!==a.parentIndex){var c=r(a.parentIndex);o.pivotPoint=u.getPosition().subTo(c.matrix.getPosition())}else o.pivotPoint=s;return a.matrix=u,n[i]=a,a}}(this);this.skeletonComponent=e.addComponent(Wr),this.skeletonComponent.joints=n;for(var i=0;i<this.geosets.length;i++){var r=this.geosets[i],o=this.meshs[i]=new Vr,a=o.addComponent(Ur),s=new qo;s.positions=r.Vertices,s.uvs=r.TVertices,s.indices=r.Faces;var u=Cr.createVertexNormals(s.indices,s.positions,!0);s.normals=u;var c=fu(r),l=new Kr;l.resetJointIndices(c.jointIndices0,this.skeletonComponent),s.skinIndices=c.jointIndices0,s.skinWeights=c.jointWeights0;var h=this.materials[r.MaterialID];if(!h.material){var p=this.getFBitmap(h).image;h.material=a.material=E.setValue(new Lr,{name:p,renderParams:{cullFace:t.CullFace.FRONT}}),Z.emit("asset.parsed",h.material)}Z.emit("asset.parsed",s),a.geometry=s,a.skinSkeleton=l,e.addChild(o)}var f=function(t){for(var e=t.sequences,n=[],i=function(i){var r=e[i],o=new Li;o.name=r.name,o.loop=r.loop,o.length=r.interval.end-r.interval.start,o.propertyClips=[];var a={};t.bones.forEach((function(t){t.buildAnimationclip(o,a,r.interval.start,r.interval.end)})),Z.emit("asset.parsed",o),n.push(o)},r=0;r<e.length;r++)i(r);return n}(this),d=e.addComponent(Fi);return d.animation=f[0],d.animations=f,e.transform.rx=90,e.transform.sx=.01,e.transform.sy=.01,e.transform.sz=-.01,e},e.prototype.getFBitmap=function(t){for(var e=0,n=0;n<t.layers.length;n++){e=t.layers[n].TextureID;break}return this.textures[e]},e}();function fu(t){for(var e=[],n=[],i=t.Vertices.length/3,r=0;r<i;r++){for(var o=t.VertexGroup[r],a=t.Groups[o],s=a.length,u=[0,0,0,0],c=0;c<s;c++){var l=a[c];u[c]=l}var h=[0,0,0,0];for(c=0;c<4;c++)c<s&&(h[c]=1/s);e[4*r]=u[0],e[4*r+1]=u[1],e[4*r+2]=u[2],e[4*r+3]=u[3],n[4*r]=h[0],n[4*r+1]=h[1],n[4*r+2]=h[2],n[4*r+3]=h[3]}return{jointIndices0:e,jointWeights0:n}}var du=function(){function t(){}return t.prototype.parse=function(t,e){!function(t,e){var n,i,r,o,a=new pu,s=t,u=0,c=!1,l=0;for(;!c;)switch(n=U()){case vu:X();break;case yu:a._version=h();break;case gu:a.model=p();break;case _u:a.sequences=f();break;case bu:a.globalsequences=d();break;case xu:a.textures=m();break;case wu:a.materials=y();break;case Su:r=v(),a.geosets.push(r);break;case Pu:break;case Mu:i=g(),a.bones[i.ObjectId]=i;break;case Cu:i=_(),a.bones[i.ObjectId]=i;break;case"PivotPoints":a.pivotPoints=j();break;case"ParticleEmitter2":case"EventObject":case"Attachment":case"RibbonEmitter":case"CollisionShape":case"Camera":case"Light":k(),G();break;default:c||Q(n)}function h(){var t=U();"{"!==t&&Z(t),"FormatVersion"!==(t=U())&&Q(t);var e=W();return"}"!==(t=U())&&Z(t),e}function p(){var t=new uu;t.name=k();var e=U();"{"!==e&&Z(e);for(var n="";"}"!==n;)switch(n=U()){case vu:X();break;case"BlendTime":t.BlendTime=W();break;case"MinimumExtent":t.MinimumExtent=R();break;case"MaximumExtent":t.MaximumExtent=R();break;case"}":break;default:X()}return t}function f(){W();var t=[],e=U();"{"!==e&&Z(e);for(var n="";"}"!==n;)switch(n=U()){case vu:X();break;case"Anim":var i=z();t.push(i);break;case"}":break;default:Q(n)}return t}function d(){var t=new ru;t.id=W();var e=U();"{"!==e&&Z(e);for(var n="";"}"!==n;)switch(n=U()){case vu:X();break;case"Duration":var i=W();t.durations.push(i);break;case"}":break;default:Q(n)}return t}function m(){W();var t=[],e=U();"{"!==e&&Z(e);for(var n="";"}"!==n;)switch(n=U()){case vu:X();break;case"Bitmap":var i=O();t.push(i);break;case"}":break;default:Q(n)}return t}function y(){W();var t=[],e=U();"{"!==e&&Z(e);for(var n="";"}"!==n;)switch(n=U()){case vu:X();break;case"Material":var i=E();t.push(i);break;case"}":break;default:Q(n)}return t}function v(){var t=new iu,e=U();"{"!==e&&Z(e);for(var n="";"}"!==n;)switch(n=U()){case vu:X();break;case"Vertices":t.Vertices=S();break;case"Normals":t.Normals=P();break;case"TVertices":t.TVertices=M();break;case"VertexGroup":t.VertexGroup=C();break;case"Faces":t.Faces=T();break;case"Groups":t.Groups=A();break;case"MinimumExtent":t.MinimumExtent=R();break;case"MaximumExtent":t.MaximumExtent=R();break;case"BoundsRadius":t.BoundsRadius=B();break;case"Anim":var i=I();t.Anims.push(i);break;case"MaterialID":t.MaterialID=W();break;case"SelectionGroup":t.SelectionGroup=W();break;case"Unselectable":t.Unselectable=!0;break;case"}":break;default:Q(n)}return t}function g(){var t=new $s;t.type="bone",t.name=k();var e=U();"{"!==e&&Z(e);for(var n="";"}"!==n;)switch(n=U()){case vu:X();break;case"ObjectId":t.ObjectId=W();break;case"Parent":t.Parent=W();break;case"GeosetId":t.GeosetId=U();break;case"GeosetAnimId":t.GeosetAnimId=U();break;case"Billboarded":t.Billboarded=!0;break;case"Translation":x(t.Translation);break;case"Scaling":b(t.Scaling);break;case"Rotation":w(t.Rotation);break;case"BillboardedLockZ":case"BillboardedLockY":case"BillboardedLockX":case"}":break;default:Q(n)}return t}function _(){var t=new $s;t.type="helper",t.name=k();var e=U();"{"!==e&&Z(e);for(var n="";"}"!==n;)switch(n=U()){case vu:X();break;case"ObjectId":t.ObjectId=W();break;case"Parent":t.Parent=W();break;case"GeosetId":t.GeosetId=U();break;case"GeosetAnimId":t.GeosetAnimId=U();break;case"Billboarded":t.Billboarded=!0;break;case"Translation":x(t.Translation);break;case"Scaling":b(t.Scaling);break;case"Rotation":w(t.Rotation);break;case"BillboardedLockX":case"BillboardedLockY":case"BillboardedLockZ":break;case"DontInherit":G();break;case"}":break;default:Q(n)}return t}function b(t){var e=W();q("{"),t.type=U();var n=u;"GlobalSeqId"===U()?t.GlobalSeqId=W():u=n;var i,r=0;switch(t.type){case"Hermite":case"Bezier":for(r=0;r<e;r++)(i=new lu).time=W(),i.value=R(),i[U()]=R(),i[U()]=R(),t.scalings.push(i);break;case"Linear":for(r=0;r<e;r++)(i=new lu).time=W(),i.value=R(),t.scalings.push(i);break;case"DontInterp":for(r=0;r<e;r++)(i=new lu).time=W(),i.value=R(),t.scalings.push(i);break;default:throw new Error("未处理"+t.type+"类型角度")}q("}")}function x(t){var e=W();q("{"),t.type=U();var n=u;"GlobalSeqId"===U()?t.GlobalSeqId=W():u=n;var i,r=0;switch(t.type){case"Hermite":case"Bezier":for(r=0;r<e;r++)(i=new hu).time=W(),i.value=R(),i[U()]=R(),i[U()]=R(),t.translations.push(i);break;case"Linear":for(r=0;r<e;r++)(i=new hu).time=W(),i.value=R(),t.translations.push(i);break;case"DontInterp":for(r=0;r<e;r++)(i=new hu).time=W(),i.value=R(),t.translations.push(i);break;default:throw new Error("未处理"+t.type+"类型角度")}q("}")}function w(t){var e=W();q("{"),t.type=U();var n=u;"GlobalSeqId"===U()?t.GlobalSeqId=W():u=n;var i,r=0;switch(t.type){case"Hermite":case"Bezier":for(r=0;r<e;r++)(i=new cu).time=W(),i.value=L(),i[U()]=L(),i[U()]=L(),t.rotations.push(i);break;case"Linear":for(r=0;r<e;r++)(i=new cu).time=W(),i.value=L(),t.rotations.push(i);break;case"DontInterp":for(r=0;r<e;r++)(i=new cu).time=W(),i.value=L(),t.rotations.push(i);break;default:throw new Error("未处理"+t.type+"类型角度")}q("}")}function S(){var t,e=[],n=W(),i=U();"{"!==i&&Z(i);for(var r=0;r<n;r++)t=R(),e.push(t.x,t.y,t.z);return"}"!==(i=U())&&Z(i),e}function P(){var t,e=[],n=W(),i=U();"{"!==i&&Z(i);for(var r=0;r<n;r++)t=R(),e.push(t.x,t.y,t.z);return"}"!==(i=U())&&Z(i),e}function M(){var t,e=[],n=W(),i=U();"{"!==i&&Z(i);for(var r=0;r<n;r++)t=N(),e.push(t.x,t.y);return"}"!==(i=U())&&Z(i),e}function C(){var t=[],e=U();for("{"!==e&&Z(e),e=U();"}"!==e;)t.push(Number(e)),e=U();return t}function T(){var t,e=[];for(W(),W(),q("{"),q("Triangles"),q("{"),q("{"),t=U();"}"!==t;)e.push(Number(t)),t=U();return q("}"),q("}"),e}function A(){var t,e=[];for(W(),W(),q("{"),t=U();"}"!==t;){if("Matrices"===t){q("{"),t=U();for(var n=[];"}"!==t;)n.push(Number(t)),t=U();e.push(n)}t=U()}return e}function O(){var t=new nu,e=U();"{"!==e&&Z(e);for(var n="";"}"!==n;)switch(n=U()){case vu:X();break;case"Image":t.image=k(),t.image=t.image.replace(/\\/g,"/");break;case"ReplaceableId":t.ReplaceableId=W();break;case"WrapWidth":case"WrapHeight":case"}":break;default:Q(n)}return t}function E(){var t=new su,e=U();"{"!==e&&Z(e);for(var n="";"}"!==n;)switch(n=U()){case vu:X();break;case"Layer":var i=D();t.layers.push(i);break;case"SortPrimsFarZ":case"ConstantColor":case"}":break;default:Q(n)}return t}function D(){var t=new au,e=U();"{"!==e&&Z(e);for(var n=!1,i="";"}"!==i;)switch(i=U()){case vu:X();break;case"FilterMode":t.FilterMode=U();break;case"static":n=!0;break;case"TextureID":n?t.TextureID=W():Q(i),n=!1;break;case"Alpha":n?t.Alpha=B():(W(),G()),n=!1;break;case"Unshaded":t.Unshaded=!0;break;case"Unfogged":t.Unfogged=!0;break;case"TwoSided":t.TwoSided=!0;break;case"SphereEnvMap":t.SphereEnvMap=!0;break;case"NoDepthTest":t.NoDepthTest=!0;break;case"NoDepthSet":t.NoDepthSet=!0;break;case"}":break;default:Q(i)}return t}function z(){var t=new Zs;t.name=k();var e=U();"{"!==e&&Z(e);for(var n="";"}"!==n;)switch(n=U()){case vu:X();break;case"Interval":t.interval=F();break;case"MinimumExtent":t.MinimumExtent=R();break;case"MaximumExtent":t.MaximumExtent=R();break;case"BoundsRadius":t.BoundsRadius=B();break;case"Rarity":t.Rarity=B();break;case"NonLooping":t.loop=!1;break;case"MoveSpeed":t.MoveSpeed=B();break;case"}":break;default:Q(n)}return t}function I(){var t=new Qs,e=U();"{"!==e&&Z(e);for(var n="";"}"!==n;)switch(n=U()){case vu:X();break;case"MinimumExtent":t.MinimumExtent=R();break;case"MaximumExtent":t.MaximumExtent=R();break;case"BoundsRadius":t.BoundsRadius=B();break;case"}":break;default:Q(n)}return t}function j(){var t=[],e=W();q("{");for(var n=0;n<e;n++){var i=R();t.push(i)}return q("}"),t}function R(){var t=new ht,e=U();return"{"!==e&&Z("{"),t.x=B(),t.y=B(),t.z=B(),"}"!==(e=U())&&"},"!==e&&Z("}"),t}function L(){var t=new jt,e=U();return"{"!==e&&Z("{"),t.x=B(),t.y=B(),t.z=B(),t.w=B(),"}"!==(e=U())&&"},"!==e&&Z("}"),t}function N(){var t=new lt,e=U();return"{"!==e&&Z("{"),t.x=B(),t.y=B(),"}"!==(e=U())&&"},"!==e&&Z("}"),t}function F(){var t=new ou,e=U();return"{"!==e&&Z("{"),t.start=W(),t.end=W(),"}"!==(e=U())&&"},"!==e&&Z("}"),t}function k(){K();var t=V(),e="";'"'!==t&&Z('"');do{c&&Y(),'"'!==(t=V())&&(e+=t)}while('"'!==t);return e}function B(){var t=parseFloat(U());return isNaN(t)&&Z("float type"),t}function V(){var t=s.charAt(u++);return"\n"===t?(++o,l=0):"\r"!==t&&++l,u>=s.length&&(c=!0),t}function W(){var t=parseInt(U(),10);return isNaN(t)&&Z("int type"),t}function U(){for(var t,e="";!c;){if(" "===(t=V())||"\r"===t||"\n"===t||"\t"===t||","===t){if(e!==vu&&K(),""!==e)return e}else e+=t;if(e===vu)return e}return e}function G(){var t=u;q("{");for(var e,n=["{"];!c;)if("{"===(e=V())&&n.push("{"),"}"===e&&(n.pop(),0===n.length))return s.substring(t,u);return""}function H(){u--,l--,c=u>=s.length}function K(){var t;do{t=V()}while("\n"===t||" "===t||"\r"===t||"\t"===t);H()}function X(){for(var t="";!c&&"\n"!==t;)t=V()}function q(t){var e=U();e!==t&&Z(e)}function Y(){throw new Error("Unexpected end of file")}function Z(t){throw new Error("Unexpected token at line "+(o+1)+", character "+l+". "+t+" expected, but "+s.charAt(u-1)+" encountered")}function Q(t){throw new Error("Unknown keyword["+t+"] at line "+(o+1)+", character "+l+". ")}e&&e(a)}(t,e)},t}(),mu=new du,yu="Version",vu="//",gu="Model",_u="Sequences",bu="GlobalSequences",xu="Textures",wu="Materials",Su="Geoset",Pu="GeosetAnim",Mu="Bone",Cu="Helper";var Tu,Au=function(){function t(){}return t.prototype.load=function(t,e){Jn.fs.readString(t,(function(n,i){mu.parse(i,(function(n){var i=n.getMesh(),r=E.setValue(new Vr,{name:ri.getName(t),children:[i]});Z.emit("asset.parsed",r),e&&e(r)}))}))},t}(),Ou=new Au,Eu=function(){function t(){}return t.prototype.parser=function(t){for(var e={},n=t.split("\n"),i=0;i<n.length;i++)Gu(n[i],e);return e},t}(),Du=new Eu,zu=/newmtl\s+([\w.]+)/,Iu=/Ka\s+([\d.]+)\s+([\d.]+)\s+([\d.]+)/,ju=/Kd\s+([\d.]+)\s+([\d.]+)\s+([\d.]+)/,Ru=/Ks\s+([\d.]+)\s+([\d.]+)\s+([\d.]+)/,Lu=/Ns\s+([\d.]+)/,Nu=/Ni\s+([\d.]+)/,Fu=/d\s+([\d.]+)/,ku=/illum\s+([\d]+)/,Bu=/map_Bump\s+([\w\W]+\.[\w\W]+)/,Vu=/map_Ka\s+([\w\W]+\.[\w\W]+)/,Wu=/map_Kd\s+([\w\W]+\.[\w\W]+)/,Uu=/map_Ks\s+([\w\W]+\.[\w\W]+)/;function Gu(t,e){var n;if(t&&((t=t.trim()).length&&"#"!==t.charAt(0)))if((n=zu.exec(t))&&n[0]===t)e[(Tu={name:n[1],ka:[],kd:[],ks:[],ns:0,ni:0,d:0,illum:0,map_Bump:"",map_Ka:"",map_Kd:"",map_Ks:""}).name]=Tu;else if((n=Iu.exec(t))&&n[0]===t)Tu.ka=[parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])];else if((n=ju.exec(t))&&n[0]===t)Tu.kd=[parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])];else if((n=Ru.exec(t))&&n[0]===t)Tu.ks=[parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])];else if((n=Lu.exec(t))&&n[0]===t)Tu.ns=parseFloat(n[1]);else if((n=Nu.exec(t))&&n[0]===t)Tu.ni=parseFloat(n[1]);else if((n=Fu.exec(t))&&n[0]===t)Tu.d=parseFloat(n[1]);else if((n=ku.exec(t))&&n[0]===t)Tu.illum=parseFloat(n[1]);else if((n=Bu.exec(t))&&n[0]===t)Tu.map_Bump=n[1];else if((n=Vu.exec(t))&&n[0]===t)Tu.map_Ka=n[1];else if((n=Wu.exec(t))&&n[0]===t)Tu.map_Kd=n[1];else{if(!(n=Uu.exec(t))||n[0]!==t)throw new Error("无法解析"+t);Tu.map_Ks=n[1]}}var Hu,Ku,Xu=function(){function t(){}return t.prototype.load=function(t,e){Jn.fs.readString(t,(function(t,n){if(t)e(t,null);else{var i=Du.parser(n);es.convert(i,e)}}))},t}(),qu=new Xu,Yu=function(){function t(){}return t.prototype.parser=function(t){Hu=null,Ku=null;var e={mtl:null,objs:[],vertex:[],vn:[],vt:[]},n=t.split("\n").reverse();do{var i=n.pop();i&&cc(i,e)}while(n.length>0);return e},t}(),Zu=new Yu,Qu=/mtllib\s+([\w\s]+\.mtl)/,Ju=/o\s+([\w\.]+)/,$u=/v\s+([-\d.]+)\s+([-\d.]+)\s+([-\d.]+)/,tc=/vn\s+([-\d.]+)\s+([-\d.]+)\s+([-\d.]+)/,ec=/vt\s+([-\d.]+)\s+([-\d.]+)(\s+([-\d.]+))?/,nc=/usemtl\s+([\w.]+)/,ic=/f\s+(\d+)\s+(\d+)\s+(\d+)/,rc=/f\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)/,oc=/f\s+((\d+)\/(\d+)\/(\d+))\s+((\d+)\/(\d+)\/(\d+))\s+((\d+)\/(\d+)\/(\d+))/,ac=/f\s+(\d+)\/\/(\d+)\s+(\d+)\/\/(\d+)\s+(\d+)\/\/(\d+)/,sc=/g\s+([\(\)\w]+)?/,uc=/s\s+(\w+)/;function cc(t,e){var n;if(t&&((t=t.trim()).length&&"#"!==t.charAt(0)))if((n=Qu.exec(t))&&n[0]===t)e.mtl=n[1];else if((n=Ju.exec(t))&&n[0]===t)Hu={name:n[1],subObjs:[]},e.objs.push(Hu);else if((n=$u.exec(t))&&n[0]===t)Hu||(Hu={name:"",subObjs:[]},e.objs.push(Hu)),e.vertex.push({x:parseFloat(n[1]),y:parseFloat(n[2]),z:parseFloat(n[3])});else if((n=tc.exec(t))&&n[0]===t)e.vn.push({x:parseFloat(n[1]),y:parseFloat(n[2]),z:parseFloat(n[3])});else if((n=ec.exec(t))&&n[0]===t)e.vt.push({u:parseFloat(n[1]),v:1-parseFloat(n[2]),s:parseFloat(n[4])});else if((n=sc.exec(t))&&n[0]===t)Ku={faces:[]},Hu.subObjs.push(Ku),Ku.g=n[1];else if((n=uc.exec(t))&&n[0]===t);else if((n=nc.exec(t))&&n[0]===t)Ku={faces:[]},Hu.subObjs.push(Ku),Ku.material=n[1];else if((n=ic.exec(t))&&n[0]===t)Ku.faces.push({indexIds:[n[2],n[1],n[3]],vertexIndices:[n[2],n[1],n[3]]});else if((n=ac.exec(t))&&n[0]===t)Ku.faces.push({indexIds:[n[3],n[1],n[5]],vertexIndices:[n[3],n[1],n[5]],normalIndices:[n[4],n[2],n[6]]});else if((n=rc.exec(t))&&n[0]===t)Ku.faces.push({indexIds:[n[2],n[1],n[3]],vertexIndices:[n[2],n[1],n[3]]}),Ku.faces.push({indexIds:[n[4],n[3],n[1]],vertexIndices:[n[4],n[3],n[1]]});else{if(!(n=oc.exec(t))||n[0]!==t)throw new Error("无法解析"+t);Ku.faces.push({indexIds:[n[5],n[1],n[9]],vertexIndices:[n[6],n[2],n[10]],uvIndices:[n[7],n[3],n[11]],normalIndices:[n[8],n[4],n[12]]})}}var lc,hc,pc,fc,dc,mc,yc,vc,gc,_c,bc,xc,wc,Sc,Pc,Mc,Cc,Tc=function(){function t(){}return t.prototype.load=function(t,e){var n=t.substring(0,t.lastIndexOf("/")+1);Jn.fs.readString(t,(function(i,r){var o=Zu.parser(r);o.name=ri.getName(t);var a=o.mtl;a?qu.load(n+a,(function(t,n){is.convert(o,n,e)})):is.convert(o,null,e)}))},t}(),Ac=new Tc;t.ParticleSystemAnimationType=void 0,(lc=t.ParticleSystemAnimationType||(t.ParticleSystemAnimationType={}))[lc.WholeSheet=0]="WholeSheet",lc[lc.SingleRow=1]="SingleRow",t.ParticleSystemInheritVelocityMode=void 0,(hc=t.ParticleSystemInheritVelocityMode||(t.ParticleSystemInheritVelocityMode={}))[hc.Initial=0]="Initial",hc[hc.Current=1]="Current",t.ParticleSystemMeshShapeType=void 0,(pc=t.ParticleSystemMeshShapeType||(t.ParticleSystemMeshShapeType={}))[pc.Vertex=0]="Vertex",pc[pc.Edge=1]="Edge",pc[pc.Triangle=2]="Triangle",t.ParticleSystemNoiseQuality=void 0,(fc=t.ParticleSystemNoiseQuality||(t.ParticleSystemNoiseQuality={}))[fc.Low=0]="Low",fc[fc.Medium=1]="Medium",fc[fc.High=2]="High",t.ParticleSystemRenderMode=void 0,(dc=t.ParticleSystemRenderMode||(t.ParticleSystemRenderMode={}))[dc.Billboard=0]="Billboard",dc[dc.Stretch=1]="Stretch",dc[dc.HorizontalBillboard=2]="HorizontalBillboard",dc[dc.VerticalBillboard=3]="VerticalBillboard",dc[dc.Mesh=4]="Mesh",dc[dc.None=5]="None",t.ParticleSystemRenderSpace=void 0,(mc=t.ParticleSystemRenderSpace||(t.ParticleSystemRenderSpace={}))[mc.View=0]="View",mc[mc.World=1]="World",mc[mc.Local=2]="Local",mc[mc.Facing=3]="Facing",mc[mc.Velocity=4]="Velocity",t.ParticleSystemScalingMode=void 0,(yc=t.ParticleSystemScalingMode||(t.ParticleSystemScalingMode={}))[yc.Hierarchy=0]="Hierarchy",yc[yc.Local=1]="Local",yc[yc.Shape=2]="Shape",t.ParticleSystemShapeConeEmitFrom=void 0,(vc=t.ParticleSystemShapeConeEmitFrom||(t.ParticleSystemShapeConeEmitFrom={}))[vc.Base=0]="Base",vc[vc.BaseShell=1]="BaseShell",vc[vc.Volume=2]="Volume",vc[vc.VolumeShell=3]="VolumeShell",t.ParticleSystemShapeMultiModeValue=void 0,(gc=t.ParticleSystemShapeMultiModeValue||(t.ParticleSystemShapeMultiModeValue={}))[gc.Random=0]="Random",gc[gc.Loop=1]="Loop",gc[gc.PingPong=2]="PingPong",gc[gc.BurstSpread=3]="BurstSpread",t.ParticleSystemShapeType=void 0,(_c=t.ParticleSystemShapeType||(t.ParticleSystemShapeType={}))[_c.Sphere=0]="Sphere",_c[_c.SphereShell=1]="SphereShell",_c[_c.Hemisphere=2]="Hemisphere",_c[_c.HemisphereShell=3]="HemisphereShell",_c[_c.Cone=4]="Cone",_c[_c.ConeShell=7]="ConeShell",_c[_c.ConeVolume=8]="ConeVolume",_c[_c.ConeVolumeShell=9]="ConeVolumeShell",_c[_c.Box=5]="Box",_c[_c.BoxShell=15]="BoxShell",_c[_c.BoxEdge=16]="BoxEdge",_c[_c.Mesh=6]="Mesh",_c[_c.MeshRenderer=13]="MeshRenderer",_c[_c.SkinnedMeshRenderer=14]="SkinnedMeshRenderer",_c[_c.Circle=10]="Circle",_c[_c.CircleEdge=11]="CircleEdge",_c[_c.SingleSidedEdge=12]="SingleSidedEdge",t.ParticleSystemShapeType1=void 0,(bc=t.ParticleSystemShapeType1||(t.ParticleSystemShapeType1={}))[bc.Sphere=0]="Sphere",bc[bc.Hemisphere=1]="Hemisphere",bc[bc.Cone=2]="Cone",bc[bc.Box=3]="Box",bc[bc.Mesh=4]="Mesh",bc[bc.MeshRenderer=5]="MeshRenderer",bc[bc.SkinnedMeshRenderer=6]="SkinnedMeshRenderer",bc[bc.Circle=7]="Circle",bc[bc.Edge=8]="Edge",t.ParticleSystemSimulationSpace=void 0,(xc=t.ParticleSystemSimulationSpace||(t.ParticleSystemSimulationSpace={}))[xc.Local=0]="Local",xc[xc.World=1]="World",t.ParticleSystemSortMode=void 0,(wc=t.ParticleSystemSortMode||(t.ParticleSystemSortMode={}))[wc.None=0]="None",wc[wc.Distance=1]="Distance",wc[wc.OldestInFront=2]="OldestInFront",wc[wc.YoungestInFront=3]="YoungestInFront",t.ParticleSystemSubEmitterProperties=void 0,(Sc=t.ParticleSystemSubEmitterProperties||(t.ParticleSystemSubEmitterProperties={}))[Sc.InheritNothing=0]="InheritNothing",Sc[Sc.InheritEverything=1]="InheritEverything",Sc[Sc.InheritColor=2]="InheritColor",Sc[Sc.InheritSize=3]="InheritSize",Sc[Sc.InheritRotation=4]="InheritRotation",Sc[Sc.InheritLifetime=5]="InheritLifetime",Sc[Sc.InheritDuration=6]="InheritDuration",t.ParticleSystemSubEmitterType=void 0,(Pc=t.ParticleSystemSubEmitterType||(t.ParticleSystemSubEmitterType={}))[Pc.Birth=0]="Birth",Pc[Pc.Collision=1]="Collision",Pc[Pc.Death=2]="Death",Pc[Pc.Trigger=3]="Trigger",Pc[Pc.Manual=4]="Manual",t.SpriteMaskInteraction=void 0,(Mc=t.SpriteMaskInteraction||(t.SpriteMaskInteraction={}))[Mc.None=0]="None",Mc[Mc.VisibleInsideMask=1]="VisibleInsideMask",Mc[Mc.VisibleOutsideMask=2]="VisibleOutsideMask",t.UVChannelFlags=void 0,(Cc=t.UVChannelFlags||(t.UVChannelFlags={}))[Cc.Nothing=0]="Nothing",Cc[Cc.UV0=1]="UV0",Cc[Cc.UV1=2]="UV1",Cc[Cc.UV2=4]="UV2",Cc[Cc.UV3=8]="UV3",Cc[Cc.Everything=15]="Everything";var Oc=function(t,e){return Oc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},Oc(t,e)};function Ec(t,e){function n(){this.constructor=t}Oc(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function Dc(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}var zc,Ic=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.enabled=!1,e}return Ec(e,t),e.prototype.initParticleState=function(t){},e.prototype.updateParticleState=function(t){},e.prototype.update=function(t){},Dc([n({tooltip:"是否开启"}),C],e.prototype,"enabled",void 0),e}(X),jc=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.color=new Ht,e.range=new lt(0,1),e}return Ec(e,t),e.prototype.initParticleState=function(t){t[Rc]=Math.random()},e.prototype.updateParticleState=function(t){if(this.enabled){var e=t.velocity.length,n=P.clamp((e-this.range.x)/(this.range.y-this.range.x),0,1),i=this.color.getValue(n,t[Rc]);t.color.multiply(i)}},Dc([C,n({tooltip:"控制粒子颜色的梯度。"})],e.prototype,"color",void 0),Dc([C,n({tooltip:"在这些最小和最大速度之间应用颜色渐变。"})],e.prototype,"range",void 0),e}(Ic),Rc="_ColorBySpeed_rate",Lc=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.color=new Ht,e}return Ec(e,t),e.prototype.initParticleState=function(t){t[Nc]=Math.random()},e.prototype.updateParticleState=function(t){this.enabled&&t.color.multiply(this.color.getValue(t.rateAtLifeTime,t[Nc]))},Dc([C,n({tooltip:"控制粒子颜色的梯度。"})],e.prototype,"color",void 0),e}(Ic),Nc="_ColorOverLifetime_rate",Fc=function(){function t(){this.time=0,this.count=E.setValue(new Mt,{constant:30,constantMin:30,constantMax:30}),this.probability=1,this._isProbability=!0}return Object.defineProperty(t.prototype,"minCount",{get:function(){return this.count.constantMin},set:function(t){this.count.constantMin=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxCount",{get:function(){return this.count.constantMax},set:function(t){this.count.constantMax=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isProbability",{get:function(){return this._isProbability},enumerable:!1,configurable:!0}),t.prototype.calculateProbability=function(){return this._isProbability=this.probability>=Math.random(),this._isProbability},Dc([C,n({tooltip:"每次爆炸发生的时间。"})],t.prototype,"time",void 0),Dc([C,n({tooltip:"要发射的粒子数。"})],t.prototype,"count",void 0),Dc([C,n({tooltip:"喷发被触发的几率。取值在0与1之间，默认1。"})],t.prototype,"probability",void 0),t}(),kc=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rateOverTime=E.setValue(new Mt,{between0And1:!0,constant:10,constantMin:10,constantMax:10,curveMultiplier:10}),e.rateOverDistance=E.setValue(new Mt,{between0And1:!0,constant:0,constantMin:0,constantMax:1}),e.bursts=[],e}return Ec(e,t),Object.defineProperty(e.prototype,"rateOverTimeMultiplier",{get:function(){return this.rateOverTime.curveMultiplier},set:function(t){this.rateOverTime.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rateOverDistanceMultiplier",{get:function(){return this.rateOverDistance.curveMultiplier},set:function(t){this.rateOverDistance.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"burstCount",{get:function(){return this.bursts.length},enumerable:!1,configurable:!0}),e.prototype.getBursts=function(t){t.length=this.bursts.length;for(var e=0,n=t.length;e<n;e++)t[e]=this.bursts[e];return t.length},e.prototype.setBursts=function(t,e){void 0===e&&(e=Number.MAX_SAFE_INTEGER),e=Math.min(t.length,e);for(var n=0;n<e;n++)this.bursts[n]=t[n]},Dc([C,n({tooltip:"随着时间的推移，新粒子产生的速度。"})],e.prototype,"rateOverTime",void 0),Dc([C,n({tooltip:"产生新粒子的速度，通过距离。新粒子只有世界空间模拟且发射器移动时才会被发射出来。"})],e.prototype,"rateOverDistance",void 0),Dc([C,n({component:"OAVArray",tooltip:"在指定时间进行额外发射指定数量的粒子",componentParam:{defaultItem:function(){return new Fc}}})],e.prototype,"bursts",void 0),e}(Ic),Bc=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.force=new Ct,n.space=t.ParticleSystemSimulationSpace.Local,n.randomized=!1,n}return Ec(i,e),Object.defineProperty(i.prototype,"x",{get:function(){return this.force.xCurve},set:function(t){this.force.xCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"xMultiplier",{get:function(){return this.x.curveMultiplier},set:function(t){this.x.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this.force.yCurve},set:function(t){this.force.yCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"yMultiplier",{get:function(){return this.y.curveMultiplier},set:function(t){this.y.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"z",{get:function(){return this.force.zCurve},set:function(t){this.force.zCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"zMultiplier",{get:function(){return this.z.curveMultiplier},set:function(t){this.z.curveMultiplier=t},enumerable:!1,configurable:!0}),i.prototype.initParticleState=function(t){t[Vc]=Math.random()},i.prototype.updateParticleState=function(t){if(this.particleSystem.removeParticleAcceleration(t,Wc),this.enabled){var e=this.force.getValue(t.rateAtLifeTime,t[Vc]);this.particleSystem.addParticleAcceleration(t,e,this.space,Wc)}},Dc([C,n({tooltip:"作用在粒子上的力"})],i.prototype,"force",void 0),Dc([C,n({tooltip:"这些力是作用于局部空间还是世界空间?",component:"OAVEnum",componentParam:{enumClass:t.ParticleSystemSimulationSpace}})],i.prototype,"space",void 0),Dc([C,n({tooltip:"当在两条曲线或常数之间随机选择值时，此标志将导致在每一帧上选择一个新的随机力。"})],i.prototype,"randomized",void 0),i}(Ic),Vc="_ForceOverLifetime_rate",Wc="_ForceOverLifetime_preForce",Uc=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.__class__="feng3d.ParticleInheritVelocityModule",n.mode=t.ParticleSystemInheritVelocityMode.Initial,n.multiplier=E.setValue(new Mt,{constant:1,constantMin:1,constantMax:1}),n}return Ec(i,e),Object.defineProperty(i.prototype,"curve",{get:function(){return this.multiplier},set:function(t){this.multiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"curveMultiplier",{get:function(){return this.multiplier.curveMultiplier},set:function(t){this.multiplier.curveMultiplier=t},enumerable:!1,configurable:!0}),i.prototype.initParticleState=function(e){if(e[Gc]=Math.random(),this.enabled&&this.particleSystem.main.simulationSpace!==t.ParticleSystemSimulationSpace.Local&&this.mode===t.ParticleSystemInheritVelocityMode.Initial){var n=this.multiplier.getValue(e.rateAtLifeTime,e[Gc]);e.velocity.addScaledVector(n,this.particleSystem._emitInfo.speed)}},i.prototype.updateParticleState=function(e){if(this.enabled&&this.particleSystem.main.simulationSpace!==t.ParticleSystemSimulationSpace.Local&&this.mode===t.ParticleSystemInheritVelocityMode.Current){var n=this.multiplier.getValue(e.rateAtLifeTime,e[Gc]);e.position.addScaledVector(n,this.particleSystem._emitInfo.moveVec)}},Dc([C,n({tooltip:"如何将发射体速度应用于粒子。",component:"OAVEnum",componentParam:{enumClass:t.ParticleSystemInheritVelocityMode}})],i.prototype,"mode",void 0),Dc([C,n({tooltip:"曲线，用来定义在粒子的生命周期内应用了多少发射速度。"})],i.prototype,"multiplier",void 0),i}(Ic),Gc="_InheritVelocity_rate",Hc=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.separateAxes=!1,n.limit=E.setValue(new Mt,{between0And1:!0,constant:1,constantMin:1,constantMax:1}),n.limit3D=E.setValue(new Ct,{xCurve:{between0And1:!0,constant:1,constantMin:1,constantMax:1},yCurve:{between0And1:!0,constant:1,constantMin:1,constantMax:1},zCurve:{between0And1:!0,constant:1,constantMin:1,constantMax:1}}),n.space=t.ParticleSystemSimulationSpace.Local,n.dampen=1,n}return Ec(i,e),Object.defineProperty(i.prototype,"limitMultiplier",{get:function(){return this.limit.curveMultiplier},set:function(t){this.limit.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"limitX",{get:function(){return this.limit3D.xCurve},set:function(t){this.limit3D.xCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"limitXMultiplier",{get:function(){return this.limit3D.xCurve.curveMultiplier},set:function(t){this.limit3D.xCurve.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"limitY",{get:function(){return this.limit3D.yCurve},set:function(t){this.limit3D.yCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"limitYMultiplier",{get:function(){return this.limit3D.yCurve.curveMultiplier},set:function(t){this.limit3D.yCurve.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"limitZ",{get:function(){return this.limit3D.zCurve},set:function(t){this.limit3D.zCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"limitZMultiplier",{get:function(){return this.limit3D.zCurve.curveMultiplier},set:function(t){this.limit3D.zCurve.curveMultiplier=t},enumerable:!1,configurable:!0}),i.prototype.initParticleState=function(t){t[Kc]=Math.random()},i.prototype.updateParticleState=function(e){if(this.enabled){var n=this.limit3D.getValue(e.rateAtLifeTime,e[Kc]),i=this.limit.getValue(e.rateAtLifeTime,e[Kc]),r=e.velocity.clone(),o=new Nt;this.space!==this.particleSystem.main.simulationSpace&&(this.space===t.ParticleSystemSimulationSpace.World?o.copy(this.particleSystem.transform.localToWorldMatrix):o.copy(this.particleSystem.transform.worldToLocalMatrix)),o.transformVector3(r,r),this.separateAxes?r.clamp(n.negateTo(),n):r.lengthSquared>i*i&&r.normalize(i),o.invert(),o.transformVector3(r,r),e.velocity.lerpNumber(r,this.dampen)}},Dc([C,n({tooltip:"在每个轴上分别设置生命周期内的大小。"})],i.prototype,"separateAxes",void 0),Dc([C,n({tooltip:"最大速度曲线，当不使用每轴一个曲线时。"})],i.prototype,"limit",void 0),Dc([C,n({tooltip:"最高速度。"})],i.prototype,"limit3D",void 0),Dc([C,n({tooltip:"指定速度是在局部空间(与变换一起旋转)还是在世界空间。",component:"OAVEnum",componentParam:{enumClass:t.ParticleSystemSimulationSpace}})],i.prototype,"space",void 0),Dc([C,n({tooltip:"控制多少速度，超过速度限制应该被抑制。"})],i.prototype,"dampen",void 0),i}(Ic),Kc="_LimitVelocityOverLifetime_rate",Xc=function(e){function i(){var n=e.call(this)||this;return n.enabled=!0,n.duration=5,n.loop=!0,n.prewarm=!1,n.startDelay=new Mt,n.startLifetime=E.setValue(new Mt,{between0And1:!0,constant:5,constantMin:5,constantMax:5}),n.startSpeed=E.setValue(new Mt,{constant:5,constantMin:5,constantMax:5}),n.useStartSize3D=!1,n.startSize3D=E.setValue(new Ct,{xCurve:{between0And1:!0,constant:1,constantMin:1,constantMax:1},yCurve:{between0And1:!0,constant:1,constantMin:1,constantMax:1},zCurve:{between0And1:!0,constant:1,constantMin:1,constantMax:1}}),n.useStartRotation3D=!1,n.startRotation3D=E.setValue(new Ct,{xCurve:{curveMultiplier:180},yCurve:{curveMultiplier:180},zCurve:{curveMultiplier:180}}),n.randomizeRotationDirection=0,n.startColor=new Ht,n.gravityModifier=new Mt,n.simulationSpace=t.ParticleSystemSimulationSpace.Local,n.simulationSpeed=1,n.scalingMode=t.ParticleSystemScalingMode.Local,n.playOnAwake=!0,n.maxParticles=1e3,n}return Ec(i,e),Object.defineProperty(i.prototype,"startDelayMultiplier",{get:function(){return this.startDelay.curveMultiplier},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startLifetimeMultiplier",{get:function(){return this.startLifetime.curveMultiplier},set:function(t){this.startLifetime.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startSpeedMultiplier",{get:function(){return this.startSpeed.curveMultiplier},set:function(t){this.startSpeed.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startSize",{get:function(){return this.startSize3D.xCurve},set:function(t){this.startSize3D.xCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startSizeMultiplier",{get:function(){return this.startSize.curveMultiplier},set:function(t){this.startSize.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startSizeX",{get:function(){return this.startSize3D.xCurve},set:function(t){this.startSize3D.xCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startSizeXMultiplier",{get:function(){return this.startSizeX.curveMultiplier},set:function(t){this.startSizeX.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startSizeY",{get:function(){return this.startSize3D.yCurve},set:function(t){this.startSize3D.yCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startSizeYMultiplier",{get:function(){return this.startSizeY.curveMultiplier},set:function(t){this.startSizeY.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startSizeZ",{get:function(){return this.startSize3D.zCurve},set:function(t){this.startSize3D.zCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startSizeZMultiplier",{get:function(){return this.startSizeZ.curveMultiplier},set:function(t){this.startSizeZ.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startRotation",{get:function(){return this.startRotation3D.zCurve},set:function(t){this.startRotation3D.zCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startRotationMultiplier",{get:function(){return this.startRotation.curveMultiplier},set:function(t){this.startRotation.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startRotationX",{get:function(){return this.startRotation3D.xCurve},set:function(t){this.startRotation3D.xCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startRotationXMultiplier",{get:function(){return this.startRotationX.curveMultiplier},set:function(t){this.startRotationX.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startRotationY",{get:function(){return this.startRotation3D.yCurve},set:function(t){this.startRotation3D.yCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startRotationYMultiplier",{get:function(){return this.startRotationY.curveMultiplier},set:function(t){this.startRotationY.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startRotationZ",{get:function(){return this.startRotation3D.zCurve},set:function(t){this.startRotation3D.zCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startRotationZMultiplier",{get:function(){return this.startRotationZ.curveMultiplier},set:function(t){this.startRotationZ.curveMultiplier=t},enumerable:!1,configurable:!0}),i.prototype.initParticleState=function(t){var e=t.birthRateAtDuration;if(t.velocity.set(0,0,0),t.acceleration.set(0,0,0),this.useStartSize3D)t.startSize.copy(this.startSize3D.getValue(e));else{var n=this.startSize.getValue(e);t.startSize.set(n,n,n)}if(this.useStartRotation3D)t.rotation.copy(this.startRotation3D.getValue(e));else{var i=this.startRotation.getValue(e);t.rotation.set(0,0,i)}t.angularVelocity.set(0,0,0),t.startColor.copy(this.startColor.getValue(e))},i.prototype.updateParticleState=function(e){var n=qc.scaleNumberTo(this.gravityModifier.getValue(this.particleSystem._emitInfo.rateAtDuration));this.particleSystem.addParticleAcceleration(e,n,t.ParticleSystemSimulationSpace.World,Yc),e.size.copy(e.startSize),e.color.copy(e.startColor)},Dc([n({exclude:!0})],i.prototype,"enabled",void 0),Dc([C,n({tooltip:"粒子系统的持续时间(秒)。"})],i.prototype,"duration",void 0),Dc([C,n({tooltip:"粒子系统在循环吗?"})],i.prototype,"loop",void 0),Dc([C,n({tooltip:"当循环被激活时，它控制这个粒子系统在第一次出现时是否看起来像已经模拟了一个循环。"})],i.prototype,"prewarm",void 0),Dc([C,n({tooltip:"启动延迟(以秒为单位)。"})],i.prototype,"startDelay",void 0),Dc([C,n({tooltip:"每个新粒子的总寿命(以秒计)。"})],i.prototype,"startLifetime",void 0),Dc([C,n({tooltip:"粒子发射时的初始速度。"})],i.prototype,"startSpeed",void 0),Dc([C,n({tooltip:"允许为每个轴分别指定粒度大小的标志。"})],i.prototype,"useStartSize3D",void 0),Dc([C,n({tooltip:"粒子发射时的初始大小。"})],i.prototype,"startSize",null),Dc([C,n({tooltip:"发射时粒子的初始大小。"})],i.prototype,"startSize3D",void 0),Dc([C,n({tooltip:"一个启用粒子3D旋转的标记。"})],i.prototype,"useStartRotation3D",void 0),Dc([n({tooltip:"粒子发射时的初始旋转。"})],i.prototype,"startRotation",null),Dc([C,n({tooltip:"粒子发射时的初始旋转。"})],i.prototype,"startRotation3D",void 0),Dc([C,n({tooltip:"导致一些粒子向相反的方向旋转。设置在0和1之间，数值越大，粒子朝相反方向旋转的比例越大。"})],i.prototype,"randomizeRotationDirection",void 0),Dc([C,n({tooltip:"粒子发射时的初始颜色。"})],i.prototype,"startColor",void 0),Dc([C,n({tooltip:"应用于重力加速度的缩放。"})],i.prototype,"gravityModifier",void 0),Dc([C,n({tooltip:"模拟空间，使粒子位置模拟在世界，本地或自定义空间。在本地空间中，它们相对于自己的转换而存在，在自定义空间中，它们相对于自定义转换。",component:"OAVEnum",componentParam:{enumClass:t.ParticleSystemSimulationSpace}})],i.prototype,"simulationSpace",void 0),Dc([C,n({tooltip:"重写粒子系统的默认播放速度。"})],i.prototype,"simulationSpeed",void 0),Dc([C,n({tooltip:"控制粒子系统的变换组件如何应用于粒子系统。",component:"OAVEnum",componentParam:{enumClass:t.ParticleSystemScalingMode}})],i.prototype,"scalingMode",void 0),Dc([C,n({tooltip:"如果设置为真，粒子系统将自动开始播放启动。"})],i.prototype,"playOnAwake",void 0),Dc([C,n({tooltip:"发射粒子的最大数量。"})],i.prototype,"maxParticles",void 0),i}(Ic),qc=new ht(0,-9.8,0),Yc="_Main_preGravity",Zc=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.separateAxes=!1,n.strength3D=E.setValue(new Ct,{xCurve:{between0And1:!0,constant:1,constantMin:1,constantMax:1,curveMultiplier:1},yCurve:{between0And1:!0,constant:1,constantMin:1,constantMax:1,curveMultiplier:1},zCurve:{between0And1:!0,constant:1,constantMin:1,constantMax:1,curveMultiplier:1}}),n.frequency=.5,n.scrollSpeed=new Mt,n.damping=!0,n.octaveCount=1,n.octaveMultiplier=.5,n.octaveScale=2,n.quality=t.ParticleSystemNoiseQuality.High,n.remapEnabled=!1,n.remap3D=E.setValue(new Ct,{xCurve:{between0And1:!0,constant:1,constantMin:1,constantMax:1,curveMultiplier:1},yCurve:{between0And1:!0,constant:1,constantMin:1,constantMax:1,curveMultiplier:1},zCurve:{between0And1:!0,constant:1,constantMin:1,constantMax:1,curveMultiplier:1}}),n._scrollValue=0,n}return Ec(i,e),Object.defineProperty(i.prototype,"strength",{get:function(){return this.strength3D.xCurve},set:function(t){this.strength3D.xCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"strengthX",{get:function(){return this.strength3D.xCurve},set:function(t){this.strength3D.xCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"strengthY",{get:function(){return this.strength3D.yCurve},set:function(t){this.strength3D.yCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"strengthZ",{get:function(){return this.strength3D.zCurve},set:function(t){this.strength3D.zCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"remap",{get:function(){return this.remap3D.xCurve},set:function(t){this.remap3D.xCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"remapX",{get:function(){return this.remap3D.xCurve},set:function(t){this.remap3D.xCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"remapY",{get:function(){return this.remap3D.yCurve},set:function(t){this.remap3D.yCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"remapZ",{get:function(){return this.remap3D.zCurve},set:function(t){this.remap3D.zCurve=t},enumerable:!1,configurable:!0}),i.prototype.initParticleState=function(t){t[Qc]=Math.random(),t[Jc]=Math.random()},i.prototype.updateParticleState=function(t){if(this.particleSystem.removeParticlePosition(t,$c),this.enabled){var e=1,n=1,r=1;if(this.separateAxes){var o=this.strength3D.getValue(t.rateAtLifeTime,t[Qc]);e=o.x,n=o.y,r=o.z}else e=n=r=this.strength.getValue(t.rateAtLifeTime,t[Qc]);var a=i._frequencyScale*this.frequency,s=new ht(e,n,r);s.scaleNumber(i._strengthScale),this.damping&&s.scaleNumber(1/this.frequency);var u=t.rateAtLifeTime*i._timeScale%1;s.x*=this._getNoiseValue((0+u)*a,t[Jc]*a),s.y*=this._getNoiseValue((1/3*1+u)*a,t[Jc]*a),s.z*=this._getNoiseValue((1/3*2+u)*a,t[Jc]*a),this.particleSystem.addParticlePosition(t,s,this.particleSystem.main.simulationSpace,$c)}},i.prototype.drawImage=function(t){var e=this._getDrawImageStrength(),n=e.x,r=e.y,o=e.z;n*=i._strengthScale,r*=i._strengthScale,o*=i._strengthScale,this.damping&&(n/=this.frequency,r/=this.frequency,o/=this.frequency);for(var a=i._frequencyScale*this.frequency,s=t.data,u=t.width,c=t.height,l=0;l<u;l++)for(var h=0;h<c;h++){var p=l/u*a,f=1-h/c*a,d=this._getNoiseValue(p,f);d=p<1/3?(d*n+1)/2*256:p<2/3?(d*r+1)/2*256:(d*o+1)/2*256;var m=4*(l+h*u);s[m]=s[m+1]=s[m+2]=Math.floor(d),s[m+3]=255}},i.prototype._getDrawImageStrength=function(){var e=1,n=1,i=1;return this.separateAxes?(this.strengthX.mode===t.MinMaxCurveMode.Curve||this.strengthX.mode===t.MinMaxCurveMode.TwoCurves?e=this.strengthX.curveMultiplier:this.strengthX.mode===t.MinMaxCurveMode.Constant?e=this.strengthX.constant:this.strengthX.mode===t.MinMaxCurveMode.TwoConstants&&(e=this.strengthX.constantMax),this.strengthY.mode===t.MinMaxCurveMode.Curve||this.strengthY.mode===t.MinMaxCurveMode.TwoCurves?n=this.strengthY.curveMultiplier:this.strengthY.mode===t.MinMaxCurveMode.Constant?n=this.strengthY.constant:this.strengthY.mode===t.MinMaxCurveMode.TwoConstants&&(n=this.strengthY.constantMax),this.strengthZ.mode===t.MinMaxCurveMode.Curve||this.strengthZ.mode===t.MinMaxCurveMode.TwoCurves?i=this.strengthZ.curveMultiplier:this.strengthZ.mode===t.MinMaxCurveMode.Constant?i=this.strengthZ.constant:this.strengthZ.mode===t.MinMaxCurveMode.TwoConstants&&(i=this.strengthZ.constantMax)):this.strength.mode===t.MinMaxCurveMode.Curve||this.strength.mode===t.MinMaxCurveMode.TwoCurves?e=n=i=this.strength.curveMultiplier:this.strength.mode===t.MinMaxCurveMode.Constant?e=n=i=this.strength.constant:this.strength.mode===t.MinMaxCurveMode.TwoConstants&&(e=n=i=this.strength.constantMax),{x:e,y:n,z:i}},i.prototype._getNoiseValue=function(t,e){for(var n=this._getNoiseValueBase(t,e),i=1,r=this.octaveCount;i<r;i++){n+=(this._getNoiseValueBase(t*this.octaveScale,e*this.octaveScale)-n)*this.octaveMultiplier}return n},i.prototype._getNoiseValueBase=function(e,n){var i=this._scrollValue;return this.quality===t.ParticleSystemNoiseQuality.Low?se.perlin1(e+i):this.quality===t.ParticleSystemNoiseQuality.Medium?se.perlin2(e,n+i):se.perlin3(e,n,i)},i.prototype.update=function(t){this._scrollValue+=this.scrollSpeed.getValue(this.particleSystem._emitInfo.rateAtDuration)*t/1e3},i._frequencyScale=5,i._strengthScale=.3,i._timeScale=5,Dc([C,n({tooltip:"分别控制每个轴的噪声。"})],i.prototype,"separateAxes",void 0),Dc([n({tooltip:"整体噪音效应有多强。"})],i.prototype,"strength",null),Dc([C,n({tooltip:"整体噪音效应有多强。"})],i.prototype,"strength3D",void 0),Dc([C,n({tooltip:"低值产生柔和、平滑的噪声，高值产生快速变化的噪声。"})],i.prototype,"frequency",void 0),Dc([C,n({tooltip:"在粒子系统上滚动噪声图。"})],i.prototype,"scrollSpeed",void 0),Dc([C,n({tooltip:"如果启用高频率噪音，将按比例减少强度。"})],i.prototype,"damping",void 0),Dc([C,n({tooltip:"一层一层的噪声组合在一起产生最终的噪声。"})],i.prototype,"octaveCount",void 0),Dc([C,n({tooltip:"当组合每个八度时，按这个比例调整强度。"})],i.prototype,"octaveMultiplier",void 0),Dc([C,n({tooltip:"当组合每个八度时，放大这个数字。"})],i.prototype,"octaveScale",void 0),Dc([C,n({tooltip:"生成一维、二维或三维噪声。",componentParam:{enumClass:t.ParticleSystemNoiseQuality}})],i.prototype,"quality",void 0),Dc([C,n({tooltip:"允许重新映射最终的噪声值，允许将噪声值转换为不同的值。"})],i.prototype,"remapEnabled",void 0),Dc([n({tooltip:"生成一维、二维或三维噪声。"})],i.prototype,"remap",null),Dc([C,n({tooltip:"生成一维、二维或三维噪声。"})],i.prototype,"remap3D",void 0),i}(Ic),Qc="_Noise_strength_rate",Jc="_Noise_particle_rate",$c="_Noise_preOffset",tl=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.separateAxes=!1,e.angularVelocity=E.setValue(new Ct,{xCurve:{constant:45,constantMin:45,constantMax:45,curveMultiplier:45},yCurve:{constant:45,constantMin:45,constantMax:45,curveMultiplier:45},zCurve:{constant:45,constantMin:45,constantMax:45,curveMultiplier:45}}),e.range=new lt(0,1),e}return Ec(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this.angularVelocity.xCurve},set:function(t){this.angularVelocity.xCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"xMultiplier",{get:function(){return this.x.curveMultiplier},set:function(t){this.x.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.angularVelocity.yCurve},set:function(t){this.angularVelocity.yCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yMultiplier",{get:function(){return this.y.curveMultiplier},set:function(t){this.y.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this.angularVelocity.zCurve},set:function(t){this.angularVelocity.zCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zMultiplier",{get:function(){return this.z.curveMultiplier},set:function(t){this.z.curveMultiplier=t},enumerable:!1,configurable:!0}),e.prototype.initParticleState=function(t){t[el]=Math.random(),t[nl]=new ht},e.prototype.updateParticleState=function(t){var e=t[nl];if(t.angularVelocity.sub(e),e.set(0,0,0),this.enabled){var n=t.velocity.length,i=P.clamp((n-this.range.x)/(this.range.y-this.range.x),0,1),r=this.angularVelocity.getValue(i,t[el]);this.separateAxes||(r.x=r.y=0),t.angularVelocity.add(r),e.copy(r)}},Dc([C,n({tooltip:"在每个轴上分别设置随速度变化的旋转。"})],e.prototype,"separateAxes",void 0),Dc([C,n({tooltip:"角速度，随速度变化的旋转。"})],e.prototype,"angularVelocity",void 0),Dc([C,n({tooltip:"在这些最小和最大速度之间应用旋转曲线。"})],e.prototype,"range",void 0),e}(Ic),el="_RotationBySpeed_rate",nl="_RotationBySpeed_preAngularVelocity",il=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.separateAxes=!1,e.angularVelocity=E.setValue(new Ct,{xCurve:{constant:45,constantMin:45,constantMax:45,curveMultiplier:45},yCurve:{constant:45,constantMin:45,constantMax:45,curveMultiplier:45},zCurve:{constant:45,constantMin:45,constantMax:45,curveMultiplier:45}}),e}return Ec(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this.angularVelocity.xCurve},set:function(t){this.angularVelocity.xCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"xMultiplier",{get:function(){return this.x.curveMultiplier},set:function(t){this.x.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.angularVelocity.yCurve},set:function(t){this.angularVelocity.yCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yMultiplier",{get:function(){return this.y.curveMultiplier},set:function(t){this.y.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this.angularVelocity.zCurve},set:function(t){this.angularVelocity.zCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zMultiplier",{get:function(){return this.z.curveMultiplier},set:function(t){this.z.curveMultiplier=t},enumerable:!1,configurable:!0}),e.prototype.initParticleState=function(t){t[rl]=Math.random(),t[ol]=new ht},e.prototype.updateParticleState=function(t){var e=t[ol];if(t.angularVelocity.sub(e),e.set(0,0,0),this.enabled){var n=this.angularVelocity.getValue(t.rateAtLifeTime,t[rl]);this.separateAxes||(n.x=n.y=0),t.angularVelocity.add(n),e.copy(n)}},Dc([C,n({tooltip:"在每个轴上分别设置基于生命周期的旋转。"})],e.prototype,"separateAxes",void 0),Dc([C,n({tooltip:"角速度，基于生命周期的旋转。"})],e.prototype,"angularVelocity",void 0),e}(Ic),rl="_RotationOverLifetime_rate",ol="_RotationOverLifetime_preAngularVelocity",al=function(){function t(t){this._module=t}return t.prototype.calcParticlePosDir=function(t,e,n){},t}();t.ParticleSystemShapeBoxEmitFrom=void 0,(zc=t.ParticleSystemShapeBoxEmitFrom||(t.ParticleSystemShapeBoxEmitFrom={}))[zc.Volume=0]="Volume",zc[zc.Shell=1]="Shell",zc[zc.Edge=2]="Edge";var sl=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.emitFrom=t.ParticleSystemShapeBoxEmitFrom.Volume,n}return Ec(i,e),Object.defineProperty(i.prototype,"boxX",{get:function(){return this._module.box.x},set:function(t){this._module.box.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"boxY",{get:function(){return this._module.box.y},set:function(t){this._module.box.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"boxZ",{get:function(){return this._module.box.z},set:function(t){this._module.box.z=t},enumerable:!1,configurable:!0}),i.prototype.calcParticlePosDir=function(e,n,i){if(n.copy(ht.random().scaleNumber(2).subNumber(1)),this.emitFrom===t.ParticleSystemShapeBoxEmitFrom.Shell){var r=Math.max(Math.abs(n.x),Math.abs(n.y),Math.abs(n.z));Math.abs(n.x)===r?n.x=n.x<0?-1:1:Math.abs(n.y)===r?n.y=n.y<0?-1:1:Math.abs(n.z)===r&&(n.z=n.z<0?-1:1)}else if(this.emitFrom===t.ParticleSystemShapeBoxEmitFrom.Edge){var o=Math.min(Math.abs(n.x),Math.abs(n.y),Math.abs(n.z));Math.abs(n.x)===o?(n.y=n.y<0?-1:1,n.z=n.z<0?-1:1):Math.abs(n.y)===o?(n.x=n.x<0?-1:1,n.z=n.z<0?-1:1):Math.abs(n.z)===o&&(n.x=n.x<0?-1:1,n.y=n.y<0?-1:1)}n.scale(new ht(this.boxX,this.boxY,this.boxZ)).scaleNumber(.5),i.set(0,0,1)},Dc([n({tooltip:"盒子X方向缩放。"})],i.prototype,"boxX",null),Dc([n({tooltip:"盒子Y方向缩放。"})],i.prototype,"boxY",null),Dc([n({tooltip:"盒子Z方向缩放。"})],i.prototype,"boxZ",null),Dc([n({tooltip:"粒子系统盒子发射类型。",component:"OAVEnum",componentParam:{enumClass:t.ParticleSystemShapeBoxEmitFrom}})],i.prototype,"emitFrom",void 0),i}(al),ul=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.emitFromEdge=!1,t}return Ec(i,e),Object.defineProperty(i.prototype,"radius",{get:function(){return this._module.radius},set:function(t){this._module.radius=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"arc",{get:function(){return this._module.arc},set:function(t){this._module.arc=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"arcMode",{get:function(){return this._module.arcMode},set:function(t){this._module.arcMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"arcSpread",{get:function(){return this._module.arcSpread},set:function(t){this._module.arcSpread=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"arcSpeed",{get:function(){return this._module.arcSpeed},set:function(t){this._module.arcSpeed=t},enumerable:!1,configurable:!0}),i.prototype.calcParticlePosDir=function(e,n,i){var r=this.radius,o=this.arc,a=0;if(this.arcMode===t.ParticleSystemShapeMultiModeValue.Random)a=Math.random()*o;else if(this.arcMode===t.ParticleSystemShapeMultiModeValue.Loop){a=(s=e.birthTime*this.arcSpeed.getValue(e.birthRateAtDuration)*360)%o}else if(this.arcMode===t.ParticleSystemShapeMultiModeValue.PingPong){var s;a=(s=e.birthTime*this.arcSpeed.getValue(e.birthRateAtDuration)*360)%o,Math.floor(s/o)%2==1&&(a=o-a)}this.arcSpread>0&&(a=Math.floor(a/o/this.arcSpread)*o*this.arcSpread),a=P.degToRad(a),i.set(Math.cos(a),Math.sin(a),0),i.scaleNumberTo(r,n),this.emitFromEdge||n.scaleNumber(Math.random())},Dc([n({tooltip:"半径"})],i.prototype,"radius",null),Dc([n({tooltip:"弧度"})],i.prototype,"arc",null),Dc([n({tooltip:"在弧线周围产生粒子的模式。",component:"OAVEnum",componentParam:{enumClass:t.ParticleSystemShapeMultiModeValue}})],i.prototype,"arcMode",null),Dc([n({tooltip:"控制弧线周围发射点之间的间隙。"})],i.prototype,"arcSpread",null),Dc([n({tooltip:"当使用一个动画模式时，如何快速移动发射位置周围的弧。"})],i.prototype,"arcSpeed",null),Dc([n({tooltip:"是否从圆形边缘发射。"})],i.prototype,"emitFromEdge",void 0),i}(al),cl=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.emitFrom=t.ParticleSystemShapeConeEmitFrom.Base,n}return Ec(i,e),Object.defineProperty(i.prototype,"angle",{get:function(){return this._module.angle},set:function(t){this._module.angle=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"radius",{get:function(){return this._module.radius},set:function(t){this._module.radius=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"length",{get:function(){return this._module.length},set:function(t){this._module.length=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"arc",{get:function(){return this._module.arc},set:function(t){this._module.arc=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"arcMode",{get:function(){return this._module.arcMode},set:function(t){this._module.arcMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"arcSpread",{get:function(){return this._module.arcSpread},set:function(t){this._module.arcSpread=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"arcSpeed",{get:function(){return this._module.arcSpeed},set:function(t){this._module.arcSpeed=t},enumerable:!1,configurable:!0}),i.prototype.calcParticlePosDir=function(e,n,i){var r=this.radius,o=this.angle,a=this.arc;o=P.clamp(o,0,87);var s=0;if(this.arcMode===t.ParticleSystemShapeMultiModeValue.Random)s=Math.random()*a;else if(this.arcMode===t.ParticleSystemShapeMultiModeValue.Loop){s=(u=e.birthTime*this.arcSpeed.getValue(e.birthRateAtDuration)*360)%a}else if(this.arcMode===t.ParticleSystemShapeMultiModeValue.PingPong){var u;s=(u=e.birthTime*this.arcSpeed.getValue(e.birthRateAtDuration)*360)%a,Math.floor(u/a)%2==1&&(s=a-s)}this.arcSpread>0&&(s=Math.floor(s/a/this.arcSpread)*a*this.arcSpread),s=P.degToRad(s);var c=1;this.emitFrom!==t.ParticleSystemShapeConeEmitFrom.Base&&this.emitFrom!==t.ParticleSystemShapeConeEmitFrom.Volume||(c=Math.random());var l=new ht(Math.cos(s),Math.sin(s),0),h=l.scaleNumberTo(r).scaleNumber(c),p=l.scaleNumberTo(r+this.length*Math.tan(P.degToRad(o))).scaleNumber(c);p.z=this.length,i.copy(p).sub(h).normalize(),n.copy(h),this.emitFrom!==t.ParticleSystemShapeConeEmitFrom.Volume&&this.emitFrom!==t.ParticleSystemShapeConeEmitFrom.VolumeShell||n.lerpNumber(p,Math.random())},Dc([n({tooltip:"圆锥的角度。"})],i.prototype,"angle",null),Dc([n({tooltip:"圆锥体底部半径。"})],i.prototype,"radius",null),Dc([n({tooltip:"圆锥的长度（高度）。"})],i.prototype,"length",null),Dc([n({tooltip:"圆弧角。"})],i.prototype,"arc",null),Dc([n({tooltip:"在弧线周围产生粒子的模式。",component:"OAVEnum",componentParam:{enumClass:t.ParticleSystemShapeMultiModeValue}})],i.prototype,"arcMode",null),Dc([n({tooltip:"控制弧线周围发射点之间的间隙。"})],i.prototype,"arcSpread",null),Dc([n({tooltip:"当使用一个动画模式时，如何快速移动发射位置周围的弧。"})],i.prototype,"arcSpeed",null),Dc([n({tooltip:"粒子系统圆锥体发射类型。",component:"OAVEnum",componentParam:{enumClass:t.ParticleSystemShapeConeEmitFrom}})],i.prototype,"emitFrom",void 0),i}(al),ll=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return Ec(i,e),Object.defineProperty(i.prototype,"radius",{get:function(){return this._module.radius},set:function(t){this._module.radius=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"radiusMode",{get:function(){return this._module.radiusMode},set:function(t){this._module.radiusMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"radiusSpread",{get:function(){return this._module.radiusSpread},set:function(t){this._module.radiusSpread=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"radiusSpeed",{get:function(){return this._module.radiusSpeed},set:function(t){this._module.radiusSpeed=t},enumerable:!1,configurable:!0}),i.prototype.calcParticlePosDir=function(e,n,i){var r=360*this.radius,o=0;if(this.radiusMode===t.ParticleSystemShapeMultiModeValue.Random)o=Math.random()*r;else if(this.radiusMode===t.ParticleSystemShapeMultiModeValue.Loop){o=(a=e.birthTime*this.radiusSpeed.getValue(e.birthRateAtDuration)*360)%r}else if(this.radiusMode===t.ParticleSystemShapeMultiModeValue.PingPong){var a;o=(a=e.birthTime*this.radiusSpeed.getValue(e.birthRateAtDuration)*360)%r,Math.floor(a/r)%2==1&&(o=r-o)}this.radiusSpread>0&&(o=Math.floor(o/r/this.radiusSpread)*r*this.radiusSpread),o/=r,i.set(0,1,0),n.set(this.radius*(2*o-1),0,0)},Dc([n({tooltip:"边长的一半。"})],i.prototype,"radius",null),Dc([n({tooltip:"在弧线周围产生粒子的模式。",component:"OAVEnum",componentParam:{enumClass:t.ParticleSystemShapeMultiModeValue}})],i.prototype,"radiusMode",null),Dc([n({tooltip:"控制弧线周围发射点之间的间隙。"})],i.prototype,"radiusSpread",null),Dc([n({tooltip:"当使用一个动画模式时，如何快速移动发射位置周围的弧。"})],i.prototype,"radiusSpeed",null),i}(al),hl=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.radius=1,e.emitFromShell=!1,e}return Ec(e,t),e.prototype.calcParticlePosDir=function(t,e,n){n.copy(ht.random()).scaleNumber(2).subNumber(1).normalize(),n.z=Math.abs(n.z),e.copy(n).scaleNumber(this.radius),this.emitFromShell||e.scaleNumber(Math.random())},Dc([n({tooltip:"球体半径"})],e.prototype,"radius",void 0),Dc([n({tooltip:"是否从球面发射"})],e.prototype,"emitFromShell",void 0),e}(al),pl=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.emitFromShell=!1,e}return Ec(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._module.radius},set:function(t){this._module.radius=t},enumerable:!1,configurable:!0}),e.prototype.calcParticlePosDir=function(t,e,n){n.copy(ht.random()).scaleNumber(2).subNumber(1).normalize(),e.copy(n).scaleNumber(this.radius),this.emitFromShell||e.scaleNumber(Math.random())},Dc([n({tooltip:"球体半径"})],e.prototype,"radius",null),Dc([n({tooltip:"是否从球面发射"})],e.prototype,"emitFromShell",void 0),e}(al),fl=function(e){function i(){var n=e.call(this)||this;return n.alignToDirection=!1,n.randomDirectionAmount=0,n.sphericalDirectionAmount=0,n.angle=25,n.arc=360,n.arcMode=t.ParticleSystemShapeMultiModeValue.Random,n.arcSpeed=E.setValue(new Mt,{constant:1,constantMin:1,constantMax:1}),n.arcSpread=0,n.box=new ht(1,1,1),n.length=5,n.meshScale=1,n.meshShapeType=t.ParticleSystemMeshShapeType.Vertex,n.useMeshColors=!0,n.normalOffset=0,n.radius=1,n.radiusMode=t.ParticleSystemShapeMultiModeValue.Random,n.radiusSpeed=E.setValue(new Mt,{constant:1,constantMin:1,constantMax:1}),n.radiusSpread=0,n._shapeSphere=new pl(n),n._shapeHemisphere=new hl(n),n._shapeCone=new cl(n),n._shapeBox=new sl(n),n._shapeCircle=new ul(n),n._shapeEdge=new ll(n),n.shapeType=t.ParticleSystemShapeType.Cone,n}return Ec(i,e),Object.defineProperty(i.prototype,"arcSpeedMultiplier",{get:function(){return this.arcSpeed.curveMultiplier},set:function(t){this.arcSpeed.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"radiusSpeedMultiplier",{get:function(){return this.radiusSpeed.curveMultiplier},set:function(t){this.radiusSpeed.curveMultiplier=t},enumerable:!1,configurable:!0}),i.prototype.initParticleState=function(e){var n=this.particleSystem.main.startSpeed.getValue(e.birthRateAtDuration),i=dl.set(0,0,0),r=ml.set(0,0,1);if(this.enabled&&this.activeShape.calcParticlePosDir(e,i,r),r.scaleNumber(n),this.particleSystem.main.simulationSpace===t.ParticleSystemSimulationSpace.World){var o=this.particleSystem.transform.localToWorldMatrix;o.transformPoint3(i,i),o.transformVector3(r,r)}if(e.position.add(i),e.velocity.add(r),this.enabled){if(this.alignToDirection){var a=new Nt;a.lookAt(e.velocity,ht.Y_AXIS);var s=Nt.fromRotation(e.rotation.x,e.rotation.y,e.rotation.z);s.append(a),e.rotation=s.getRotation()}var u=e.velocity.length;if(this.randomDirectionAmount>0){var c=ht.random().scaleNumber(2).subNumber(1).normalize(u);e.velocity.lerpNumber(c,this.randomDirectionAmount).normalize(u)}if(this.sphericalDirectionAmount>0){c=e.position.clone().normalize(u);e.velocity.lerpNumber(c,this.sphericalDirectionAmount).normalize(u)}}},i.prototype._onShapeTypeChanged=function(){var e=this.activeShape;switch(this.shapeType){case t.ParticleSystemShapeType.Sphere:this.shape=t.ParticleSystemShapeType1.Sphere,this._shapeSphere.emitFromShell=!1,this.activeShape=this._shapeSphere;break;case t.ParticleSystemShapeType.SphereShell:this.shape=t.ParticleSystemShapeType1.Sphere,this._shapeSphere.emitFromShell=!0,this.activeShape=this._shapeSphere;break;case t.ParticleSystemShapeType.Hemisphere:this.shape=t.ParticleSystemShapeType1.Hemisphere,this._shapeHemisphere.emitFromShell=!1,this.activeShape=this._shapeHemisphere;break;case t.ParticleSystemShapeType.HemisphereShell:this.shape=t.ParticleSystemShapeType1.Hemisphere,this._shapeHemisphere.emitFromShell=!0,this.activeShape=this._shapeHemisphere;break;case t.ParticleSystemShapeType.Cone:this.shape=t.ParticleSystemShapeType1.Cone,this._shapeCone.emitFrom=t.ParticleSystemShapeConeEmitFrom.Base,this.activeShape=this._shapeCone;break;case t.ParticleSystemShapeType.ConeShell:this.shape=t.ParticleSystemShapeType1.Cone,this._shapeCone.emitFrom=t.ParticleSystemShapeConeEmitFrom.BaseShell,this.activeShape=this._shapeCone;break;case t.ParticleSystemShapeType.ConeVolume:this.shape=t.ParticleSystemShapeType1.Cone,this._shapeCone.emitFrom=t.ParticleSystemShapeConeEmitFrom.Volume,this.activeShape=this._shapeCone;break;case t.ParticleSystemShapeType.ConeVolumeShell:this.shape=t.ParticleSystemShapeType1.Cone,this._shapeCone.emitFrom=t.ParticleSystemShapeConeEmitFrom.VolumeShell,this.activeShape=this._shapeCone;break;case t.ParticleSystemShapeType.Box:this.shape=t.ParticleSystemShapeType1.Box,this._shapeBox.emitFrom=t.ParticleSystemShapeBoxEmitFrom.Volume,this.activeShape=this._shapeBox;break;case t.ParticleSystemShapeType.BoxShell:this.shape=t.ParticleSystemShapeType1.Box,this._shapeBox.emitFrom=t.ParticleSystemShapeBoxEmitFrom.Shell,this.activeShape=this._shapeBox;break;case t.ParticleSystemShapeType.BoxEdge:this.shape=t.ParticleSystemShapeType1.Box,this._shapeBox.emitFrom=t.ParticleSystemShapeBoxEmitFrom.Edge,this.activeShape=this._shapeBox;break;case t.ParticleSystemShapeType.Mesh:this.shape=t.ParticleSystemShapeType1.Mesh,console.warn("未实现 ParticleSystemShapeType.Mesh"),this.activeShape=null;break;case t.ParticleSystemShapeType.MeshRenderer:this.shape=t.ParticleSystemShapeType1.MeshRenderer,console.warn("未实现 ParticleSystemShapeType.Mesh"),this.activeShape=null;break;case t.ParticleSystemShapeType.SkinnedMeshRenderer:this.shape=t.ParticleSystemShapeType1.SkinnedMeshRenderer,console.warn("未实现 ParticleSystemShapeType.Mesh"),this.activeShape=null;break;case t.ParticleSystemShapeType.Circle:this.shape=t.ParticleSystemShapeType1.Circle,this._shapeCircle.emitFromEdge=!1,this.activeShape=this._shapeCircle;break;case t.ParticleSystemShapeType.CircleEdge:this.shape=t.ParticleSystemShapeType1.Circle,this._shapeCircle.emitFromEdge=!0,this.activeShape=this._shapeCircle;break;case t.ParticleSystemShapeType.SingleSidedEdge:this.shape=t.ParticleSystemShapeType1.Edge,this.activeShape=this._shapeEdge;break;default:console.warn("错误 ParticleShapeModule.shapeType 值 "+this.shapeType)}E.setValue(this.activeShape,e),this.emit("refreshView")},i.prototype._onShapeChanged=function(){switch(this.shape){case t.ParticleSystemShapeType1.Sphere:this.shapeType=this._shapeSphere.emitFromShell?t.ParticleSystemShapeType.SphereShell:t.ParticleSystemShapeType.Sphere;break;case t.ParticleSystemShapeType1.Hemisphere:this.shapeType=this._shapeHemisphere.emitFromShell?t.ParticleSystemShapeType.HemisphereShell:t.ParticleSystemShapeType.Hemisphere;break;case t.ParticleSystemShapeType1.Cone:switch(this._shapeCone.emitFrom){case t.ParticleSystemShapeConeEmitFrom.Base:this.shapeType=t.ParticleSystemShapeType.Cone;break;case t.ParticleSystemShapeConeEmitFrom.BaseShell:this.shapeType=t.ParticleSystemShapeType.ConeShell;break;case t.ParticleSystemShapeConeEmitFrom.Volume:this.shapeType=t.ParticleSystemShapeType.ConeVolume;break;case t.ParticleSystemShapeConeEmitFrom.VolumeShell:this.shapeType=t.ParticleSystemShapeType.ConeVolumeShell;break;default:console.warn("错误ParticleSystemShapeCone.emitFrom值 "+this._shapeCone.emitFrom)}break;case t.ParticleSystemShapeType1.Box:switch(this._shapeBox.emitFrom){case t.ParticleSystemShapeBoxEmitFrom.Volume:this.shapeType=t.ParticleSystemShapeType.Box;break;case t.ParticleSystemShapeBoxEmitFrom.Shell:this.shapeType=t.ParticleSystemShapeType.BoxShell;break;case t.ParticleSystemShapeBoxEmitFrom.Edge:this.shapeType=t.ParticleSystemShapeType.BoxEdge;break;default:console.warn("错误ParticleSystemShapeCone.emitFrom值 "+this._shapeCone.emitFrom)}break;case t.ParticleSystemShapeType1.Mesh:this.shapeType=t.ParticleSystemShapeType.Mesh;break;case t.ParticleSystemShapeType1.MeshRenderer:this.shapeType=t.ParticleSystemShapeType.MeshRenderer;break;case t.ParticleSystemShapeType1.SkinnedMeshRenderer:this.shapeType=t.ParticleSystemShapeType.SkinnedMeshRenderer;break;case t.ParticleSystemShapeType1.Circle:this.shapeType=this._shapeCircle.emitFromEdge?t.ParticleSystemShapeType.CircleEdge:t.ParticleSystemShapeType.Circle;break;case t.ParticleSystemShapeType1.Edge:this.shapeType=t.ParticleSystemShapeType.SingleSidedEdge;break;default:console.warn("错误 ParticleShapeModule.shape 值 "+this.shape)}},Dc([C,N("_onShapeTypeChanged")],i.prototype,"shapeType",void 0),Dc([n({tooltip:"发射粒子的形状类型。",component:"OAVEnum",componentParam:{enumClass:t.ParticleSystemShapeType1}}),N("_onShapeChanged")],i.prototype,"shape",void 0),Dc([n({component:"OAVObjectView"})],i.prototype,"activeShape",void 0),Dc([C,n({tooltip:"根据粒子的初始运动方向排列粒子。"})],i.prototype,"alignToDirection",void 0),Dc([C,n({tooltip:"随机化粒子的起始方向。"})],i.prototype,"randomDirectionAmount",void 0),Dc([C,n({tooltip:"Spherizes the starting direction of particles."})],i.prototype,"sphericalDirectionAmount",void 0),Dc([C],i.prototype,"angle",void 0),Dc([C],i.prototype,"arc",void 0),Dc([C],i.prototype,"arcMode",void 0),Dc([C],i.prototype,"arcSpeed",void 0),Dc([C],i.prototype,"arcSpread",void 0),Dc([C],i.prototype,"box",void 0),Dc([C],i.prototype,"length",void 0),Dc([C],i.prototype,"radius",void 0),Dc([C],i.prototype,"radiusMode",void 0),Dc([C],i.prototype,"radiusSpeed",void 0),Dc([C],i.prototype,"radiusSpread",void 0),i}(Ic),dl=new ht(0,0,0),ml=new ht(0,0,1),yl=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.separateAxes=!1,e.size3D=E.setValue(new Ct,{xCurve:{between0And1:!0,constant:1,constantMin:1,constantMax:1,curveMultiplier:1},yCurve:{between0And1:!0,constant:1,constantMin:1,constantMax:1,curveMultiplier:1},zCurve:{between0And1:!0,constant:1,constantMin:1,constantMax:1,curveMultiplier:1}}),e.range=new lt(0,1),e}return Ec(e,t),Object.defineProperty(e.prototype,"size",{get:function(){return this.size3D.xCurve},set:function(t){this.size3D.xCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizeMultiplier",{get:function(){return this.size.curveMultiplier},set:function(t){this.size.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this.size3D.xCurve},set:function(t){this.size3D.xCurve},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"xMultiplier",{get:function(){return this.x.curveMultiplier},set:function(t){this.x.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.size3D.yCurve},set:function(t){this.size3D.yCurve},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yMultiplier",{get:function(){return this.y.curveMultiplier},set:function(t){this.y.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this.size3D.zCurve},set:function(t){this.size3D.zCurve},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zMultiplier",{get:function(){return this.z.curveMultiplier},set:function(t){this.z.curveMultiplier=t},enumerable:!1,configurable:!0}),e.prototype.initParticleState=function(t){t[vl]=Math.random()},e.prototype.updateParticleState=function(t){if(this.enabled){var e=t.velocity.length,n=P.clamp((e-this.range.x)/(this.range.y-this.range.x),0,1),i=this.size3D.getValue(n,t[vl]);this.separateAxes||(i.y=i.z=i.x),t.size.multiply(i)}},Dc([C,n({tooltip:"在每个轴上分别设置生命周期内的大小。"})],e.prototype,"separateAxes",void 0),Dc([n({tooltip:"基于速度的粒度控制曲线。"})],e.prototype,"size",null),Dc([C,n({tooltip:"基于寿命的粒度控制曲线。"})],e.prototype,"size3D",void 0),Dc([C,n({tooltip:"在这些最小和最大速度之间应用颜色渐变。"})],e.prototype,"range",void 0),e}(Ic),vl="_SizeBySpeed_rate",gl=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.separateAxes=!1,e.size3D=E.setValue(new Ct,{xCurve:{between0And1:!0,constant:1,constantMin:1,constantMax:1,curveMultiplier:1},yCurve:{between0And1:!0,constant:1,constantMin:1,constantMax:1,curveMultiplier:1},zCurve:{between0And1:!0,constant:1,constantMin:1,constantMax:1,curveMultiplier:1}}),e}return Ec(e,t),Object.defineProperty(e.prototype,"size",{get:function(){return this.size3D.xCurve},set:function(t){this.size3D.xCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizeMultiplier",{get:function(){return this.size.curveMultiplier},set:function(t){this.size.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this.size3D.xCurve},set:function(t){this.size3D.xCurve},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"xMultiplier",{get:function(){return this.x.curveMultiplier},set:function(t){this.x.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.size3D.yCurve},set:function(t){this.size3D.yCurve},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yMultiplier",{get:function(){return this.y.curveMultiplier},set:function(t){this.y.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this.size3D.zCurve},set:function(t){this.size3D.zCurve},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zMultiplier",{get:function(){return this.z.curveMultiplier},set:function(t){this.z.curveMultiplier=t},enumerable:!1,configurable:!0}),e.prototype.initParticleState=function(t){t[_l]=Math.random()},e.prototype.updateParticleState=function(t){if(this.enabled){var e=this.size3D.getValue(t.rateAtLifeTime,t[_l]);this.separateAxes||(e.y=e.z=e.x),t.size.multiply(e)}},Dc([C,n({tooltip:"在每个轴上分别设置生命周期内的大小。"})],e.prototype,"separateAxes",void 0),Dc([n({tooltip:"基于寿命的粒度控制曲线。"})],e.prototype,"size",null),Dc([C,n({tooltip:"基于寿命的粒度控制曲线。"})],e.prototype,"size3D",void 0),e}(Ic),_l="_SizeOverLifetime_rate",bl=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.subEmitters=[],t}return Ec(n,e),Object.defineProperty(n.prototype,"subEmittersCount",{get:function(){return this.subEmitters.length},enumerable:!1,configurable:!0}),n.prototype.AddSubEmitter=function(t,e,n,i){t._isSubParticleSystem=!0,this.subEmitters.push({subEmitter:t,type:e,properties:n,emitProbability:i})},n.prototype.GetSubEmitterEmitProbability=function(t){return this.subEmitters[t]?this.subEmitters[t].emitProbability:0},n.prototype.GetSubEmitterProperties=function(t){return this.subEmitters[t]?this.subEmitters[t].properties:null},n.prototype.GetSubEmitterSystem=function(t){return this.subEmitters[t]?this.subEmitters[t].subEmitter:null},n.prototype.GetSubEmitterType=function(t){return this.subEmitters[t]?this.subEmitters[t].type:null},n.prototype.RemoveSubEmitter=function(t){this.subEmitters[t]&&this.subEmitters.splice(t,1)},n.prototype.SetSubEmitterEmitProbability=function(t,e){this.subEmitters[t]&&(this.subEmitters[t].emitProbability=e)},n.prototype.SetSubEmitterProperties=function(t,e){this.subEmitters[t]&&(this.subEmitters[t].properties=e)},n.prototype.SetSubEmitterSystem=function(t,e){this.subEmitters[t]&&(this.subEmitters[t].subEmitter=e)},n.prototype.SetSubEmitterType=function(t,e){this.subEmitters[t]&&(this.subEmitters[t].type=e)},n.prototype.updateParticleState=function(e){for(var n=0,i=this.subEmittersCount;n<i;n++){this.GetSubEmitterType(n)===t.ParticleSystemSubEmitterType.Birth&&this.particleSystem.TriggerSubEmitter(n,[e])}},n}(Ic),xl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ec(e,t),e}(Ic),wl=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.tiles=new lt(1,1),n.animation=t.ParticleSystemAnimationType.WholeSheet,n.frameOverTime=E.setValue(new Mt,{mode:t.MinMaxCurveMode.Curve,curveMin:{keys:[{time:0,value:0,inTangent:1,outTangent:1},{time:1,value:1,inTangent:1,outTangent:1}]}}),n.useRandomRow=!0,n._rowIndex=0,n.startFrame=new Mt,n.cycleCount=1,n.flipUV=new lt,n.uvChannelMask=t.UVChannelFlags.Everything,n}return Ec(i,e),Object.defineProperty(i.prototype,"rowIndex",{get:function(){return this._rowIndex},set:function(t){this._rowIndex=P.clamp(t,0,this.tiles.y-1)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"flipU",{get:function(){return this.flipUV.x},set:function(t){this.flipUV.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"flipV",{get:function(){return this.flipUV.y},set:function(t){this.flipUV.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"frameOverTimeMultiplier",{get:function(){return this.frameOverTime.curveMultiplier},set:function(t){this.frameOverTime.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"numTilesX",{get:function(){return this.tiles.x},set:function(t){this.tiles.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"numTilesY",{get:function(){return this.tiles.y},set:function(t){this.tiles.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"startFrameMultiplier",{get:function(){return this.startFrame.curveMultiplier},set:function(t){this.startFrame.curveMultiplier=t},enumerable:!1,configurable:!0}),i.prototype.initParticleState=function(t){t[Sl]=Math.random(),t[Pl]=Math.random(),t[Ml]=Math.random()},i.prototype.updateParticleState=function(e){if(e.tilingOffset.set(1,1,0,0),e.flipUV.set(0,0),this.enabled){var n=this.tiles.x,i=this.tiles.y,r=this.tiles.clone().reciprocal(),o=new lt,a=this.frameOverTime.getValue(e.rateAtLifeTime,e[Sl]),s=this.startFrame.getValue(e.rateAtLifeTime,e[Pl]),u=this.rowIndex,c=this.cycleCount;this.animation===t.ParticleSystemAnimationType.WholeSheet?(s=Math.round(s+a*n*i*c),o.set(s%n,Math.floor(s/n)%i).scale(r)):this.animation===t.ParticleSystemAnimationType.SingleRow&&(s=Math.round(s+a*n*c),this.useRandomRow&&(u=Math.round(i*e[Ml])),o.set(s%n,u).scale(r)),e.tilingOffset.set(r.x,r.y,o.x,o.y),e.flipUV=this.flipUV}},Dc([C,n({tooltip:"定义纹理的平铺。"})],i.prototype,"tiles",void 0),Dc([C,n({tooltip:"指定动画类型。",component:"OAVEnum",componentParam:{enumClass:t.ParticleSystemAnimationType}})],i.prototype,"animation",void 0),Dc([C,n({tooltip:"曲线控制哪个帧的纹理表动画播放。"})],i.prototype,"frameOverTime",void 0),Dc([C,n({tooltip:"对每个发射的粒子使用纹理表的随机行。"})],i.prototype,"useRandomRow",void 0),Dc([C,n({tooltip:"当useRandomRow设置为false时，显式选择使用纹理表的哪一行。"})],i.prototype,"rowIndex",null),Dc([C,n({tooltip:"为纹理表动画定义一个随机的起始帧。"})],i.prototype,"startFrame",void 0),Dc([C,n({tooltip:"指定在粒子的生命周期内动画将循环多少次。"})],i.prototype,"cycleCount",void 0),Dc([C,n({tooltip:"在粒子上翻转UV坐标，使它们呈现镜像翻转。"})],i.prototype,"flipUV",void 0),Dc([C,n({tooltip:"选择哪个UV通道将接收纹理动画。",component:"OAVEnum",componentParam:{enumClass:t.UVChannelFlags}})],i.prototype,"uvChannelMask",void 0),i}(Ic),Sl="_TextureSheetAnimation_rateAtLifeTime",Pl="_TextureSheetAnimation_startFrame",Ml="_TextureSheetAnimation_randomRow",Cl=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.velocity=new Ct,n.space=t.ParticleSystemSimulationSpace.Local,n}return Ec(i,e),Object.defineProperty(i.prototype,"x",{get:function(){return this.velocity.xCurve},set:function(t){this.velocity.xCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"xMultiplier",{get:function(){return this.x.curveMultiplier},set:function(t){this.x.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this.velocity.yCurve},set:function(t){this.velocity.yCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"yMultiplier",{get:function(){return this.y.curveMultiplier},set:function(t){this.y.curveMultiplier=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"z",{get:function(){return this.velocity.zCurve},set:function(t){this.velocity.zCurve=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"zMultiplier",{get:function(){return this.z.curveMultiplier},set:function(t){this.z.curveMultiplier=t},enumerable:!1,configurable:!0}),i.prototype.initParticleState=function(t){t[Tl]=Math.random()},i.prototype.updateParticleState=function(t){if(this.particleSystem.removeParticleVelocity(t,Al),this.enabled){var e=this.velocity.getValue(t.rateAtLifeTime,t[Tl]);this.particleSystem.addParticleVelocity(t,e,this.space,Al)}},Dc([C,n({tooltip:"基于寿命的粒子速度控制曲线。"})],i.prototype,"velocity",void 0),Dc([C,n({tooltip:"指定速度是在局部空间(与变换一起旋转)还是在世界空间。",component:"OAVEnum",componentParam:{enumClass:t.ParticleSystemSimulationSpace}})],i.prototype,"space",void 0),i}(Ic),Tl="_VelocityOverLifetime_rate",Al="_VelocityOverLifetime_preVelocity",Ol=function(){function t(){this.birthTime=0,this.lifetime=5,this.position=new ht,this.velocity=new ht,this.acceleration=new ht,this.rotation=new ht,this.angularVelocity=new ht,this.size=new ht(1,1,1),this.startSize=new ht(1,1,1),this.color=new yt,this.startColor=new yt,this.tilingOffset=new dt(1,1,0,0),this.flipUV=new lt,this.cache={}}return t.prototype.updateState=function(t){var e=Math.max(this.curTime,this.birthTime),n=(t=Math.max(this.birthTime,t))-e;this.velocity.add(this.acceleration.scaleNumberTo(n)),this.position.x+=this.velocity.x*n,this.position.y+=this.velocity.y*n,this.position.z+=this.velocity.z*n,this.rotation.add(this.angularVelocity.scaleNumberTo(n)),this.prePosition=this.curPosition.clone(),this.curPosition=this.position.clone(),this.preTime=this.curTime,this.curTime=t},t}(),El=function(){function t(){this._TintColor=new yt(.5,.5,.5,.5),this._MainTex=zr.defaultParticle,this._MainTex_ST=new dt(1,1,0,0),this._InvFade=1}return Dc([C,n()],t.prototype,"_TintColor",void 0),Dc([C,n({tooltip:"粒子贴图"})],t.prototype,"_MainTex",void 0),Dc([C,n({tooltip:"粒子贴图使用的UV变换"})],t.prototype,"_MainTex_ST",void 0),Dc([C,n()],t.prototype,"_InvFade",void 0),t}();Ln.shaders.Particles_Additive.cls=El,Ln.shaders.Particles_Additive.renderParams={enableBlend:!0,sfactor:t.BlendFactor.SRC_ALPHA,dfactor:t.BlendFactor.ONE,colorMask:t.ColorMask.RGB,cullFace:t.CullFace.NONE,depthMask:!1},Lr.setDefault("Particle-Material",{shaderName:"Particles_Additive"});var Dl=function(){function t(){this._MainTex=zr.defaultParticle,this._MainTex_ST=new dt(1,1,0,0),this.u_softParticlesFactor=1}return Dc([C,n({tooltip:"粒子贴图"})],t.prototype,"_MainTex",void 0),Dc([C,n({tooltip:"粒子贴图使用的UV变换"})],t.prototype,"_MainTex_ST",void 0),Dc([C,n()],t.prototype,"u_softParticlesFactor",void 0),t}();Ln.shaders.Particles_AlphaBlendedPremultiply.cls=Dl,Ln.shaders.Particles_AlphaBlendedPremultiply.renderParams={enableBlend:!0,sfactor:t.BlendFactor.ONE,dfactor:t.BlendFactor.ONE_MINUS_SRC_ALPHA,colorMask:t.ColorMask.RGB,cullFace:t.CullFace.NONE,depthMask:!1};var zl=function(e){function i(){var t=e.call(this)||this;return t._isPlaying=!1,t.time=0,t.geometry=Tr.getDefault("Billboard-Geometry"),t.material=Lr.getDefault("Particle-Material"),t.castShadows=!0,t.receiveShadows=!0,t._awaked=!1,t._particlePool=[],t._activeParticles=[],t._attributes={a_particle_position:new wn({name:"a_particle_position",data:[],size:3,divisor:1}),a_particle_scale:new wn({name:"a_particle_scale",data:[],size:3,divisor:1}),a_particle_rotation:new wn({name:"a_particle_rotation",data:[],size:3,divisor:1}),a_particle_color:new wn({name:"a_particle_color",data:[],size:4,divisor:1}),a_particle_tilingOffset:new wn({name:"a_particle_tilingOffset",data:[],size:4,divisor:1}),a_particle_flipUV:new wn({name:"a_particle_flipUV",data:[],size:2,divisor:1})},t._modules=[],t._isSubParticleSystem=!1,t.main=new Xc,t.emission=new kc,t.shape=new fl,t.velocityOverLifetime=new Cl,t.inheritVelocity=new Uc,t.forceOverLifetime=new Bc,t.limitVelocityOverLifetime=new Hc,t.colorOverLifetime=new Lc,t.colorBySpeed=new jc,t.sizeOverLifetime=new gl,t.sizeBySpeed=new yl,t.rotationOverLifetime=new il,t.rotationBySpeed=new tl,t.noise=new Zc,t.subEmitters=new bl,t.textureSheetAnimation=new wl,t.main.enabled=!0,t.emission.enabled=!0,t.shape.enabled=!0,t}return Ec(i,e),Object.defineProperty(i.prototype,"isPlaying",{get:function(){return this._isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isStopped",{get:function(){return!this._isPlaying&&0===this.time},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isPaused",{get:function(){return!this._isPlaying&&0!==this.time},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"particleCount",{get:function(){return this._activeParticles.length},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"main",{get:function(){return this._main},set:function(t){this._main&&k.unwatch(this._main,"simulationSpace",this._simulationSpaceChanged,this),p.replace(this._modules,this._main,t),t.particleSystem=this,this._main=t,k.watch(this._main,"simulationSpace",this._simulationSpaceChanged,this)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"emission",{get:function(){return this._emission},set:function(t){p.replace(this._modules,this._emission,t),t.particleSystem=this,this._emission=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shape",{get:function(){return this._shape},set:function(t){p.replace(this._modules,this._shape,t),t.particleSystem=this,this._shape=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"velocityOverLifetime",{get:function(){return this._velocityOverLifetime},set:function(t){p.replace(this._modules,this._velocityOverLifetime,t),t.particleSystem=this,this._velocityOverLifetime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"limitVelocityOverLifetime",{get:function(){return this._limitVelocityOverLifetime},set:function(t){p.replace(this._modules,this._limitVelocityOverLifetime,t),t.particleSystem=this,this._limitVelocityOverLifetime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"inheritVelocity",{get:function(){return this._inheritVelocity},set:function(t){p.replace(this._modules,this._inheritVelocity,t),t.particleSystem=this,this._inheritVelocity=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"forceOverLifetime",{get:function(){return this._forceOverLifetime},set:function(t){p.replace(this._modules,this._forceOverLifetime,t),t.particleSystem=this,this._forceOverLifetime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"colorOverLifetime",{get:function(){return this._colorOverLifetime},set:function(t){p.replace(this._modules,this._colorOverLifetime,t),t.particleSystem=this,this._colorOverLifetime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"colorBySpeed",{get:function(){return this._colorBySpeed},set:function(t){p.replace(this._modules,this._colorBySpeed,t),t.particleSystem=this,this._colorBySpeed=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sizeOverLifetime",{get:function(){return this._sizeOverLifetime},set:function(t){p.replace(this._modules,this._sizeOverLifetime,t),t.particleSystem=this,this._sizeOverLifetime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sizeBySpeed",{get:function(){return this._sizeBySpeed},set:function(t){p.replace(this._modules,this._sizeBySpeed,t),t.particleSystem=this,this._sizeBySpeed=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotationOverLifetime",{get:function(){return this._rotationOverLifetime},set:function(t){p.replace(this._modules,this._rotationOverLifetime,t),t.particleSystem=this,this._rotationOverLifetime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotationBySpeed",{get:function(){return this._rotationBySpeed},set:function(t){p.replace(this._modules,this._rotationBySpeed,t),t.particleSystem=this,this._rotationBySpeed=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"noise",{get:function(){return this._noise},set:function(t){p.replace(this._modules,this._noise,t),t.particleSystem=this,this._noise=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"subEmitters",{get:function(){return this._subEmitters},set:function(t){p.replace(this._modules,this._subEmitters,t),t.particleSystem=this,this._subEmitters=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"textureSheetAnimation",{get:function(){return this._textureSheetAnimation},set:function(t){p.replace(this._modules,this._textureSheetAnimation,t),t.particleSystem=this,this._textureSheetAnimation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"single",{get:function(){return!0},enumerable:!1,configurable:!0}),i.prototype.update=function(t){var e=this;if(this.isPlaying){var n=this.main.simulationSpeed*t/1e3;this.time=this.time+n;var i=this._emitInfo;if(i.preTime=i.currentTime,i.currentTime=this.time-i.startDelay,i.preWorldPos.copy(i.currentWorldPos),i.currentWorldPos.copy(this.transform.worldPosition),i.moveVec.copy(i.currentWorldPos).sub(i.preWorldPos),i.speed.copy(i.moveVec).divideNumber(n),this._modules.forEach((function(t){t.update(n)})),this._updateActiveParticlesState(n),this.main.loop&&Math.floor(i.preTime/this.main.duration)<Math.floor(i.currentTime/this.main.duration)&&(this.emission.bursts.forEach((function(t){t.calculateProbability()})),this.emit("particleCycled",this)),!this._isSubParticleSystem){var r=this._emit(i);r.sort((function(t,e){return t.time-e.time})),r.forEach((function(t){e._emitParticles(t)}))}!this.main.loop&&0===this._activeParticles.length&&i.currentTime>this.main.duration&&(this.stop(),this.emit("particleCompleted",this))}},i.prototype.stop=function(){this._isPlaying=!1,this.time=0,this._particlePool=this._particlePool.concat(this._activeParticles),this._activeParticles.length=0},i.prototype.play=function(){this._isPlaying=!0,this.time=0,this._particlePool=this._particlePool.concat(this._activeParticles),this._activeParticles.length=0;var t=this.main.startDelay.getValue(Math.random());this._emitInfo={preTime:-t,currentTime:-t,preWorldPos:new ht,currentWorldPos:new ht,rateAtDuration:0,_leftRateOverDistance:0,_isRateOverDistance:!1,startDelay:t,moveVec:new ht,speed:new ht,position:new ht},this.emission.bursts.forEach((function(t){t.calculateProbability()}))},i.prototype.pause=function(){this._isPlaying=!1},i.prototype.continue=function(){0===this.time?this.play():(this._isPlaying=!0,this._emitInfo.preTime=Math.max(0,this._emitInfo.currentTime))},i.prototype.beforeRender=function(n,i,r){e.prototype.beforeRender.call(this,n,i,r),Boolean(i.runEnvironment&t.RunEnvironment.feng3d)&&!this._awaked&&(this.main.playOnAwake&&!this._isPlaying&&this.play(),this._awaked=!0),n.instanceCount=this._activeParticles.length,n.shaderMacro.HAS_PARTICLE_ANIMATOR=!0,n.shaderMacro.ENABLED_PARTICLE_SYSTEM_textureSheetAnimation=this.textureSheetAnimation.enabled;var o=!this.shape.alignToDirection&&this.geometry===Tr.getDefault("Billboard-Geometry"),a=new It;if(o){var s=r.transform.localToWorldMatrix.clone(),u=s.getAxisZ(),c=s.getAxisY();this.main.simulationSpace===t.ParticleSystemSimulationSpace.Local&&(u=this.gameObject.transform.worldToLocalRotationMatrix.transformPoint3(u),c=this.gameObject.transform.worldToLocalRotationMatrix.transformPoint3(c));var l=new Nt;l.lookAt(u,c),a.formMatrix4x4(l)}for(var h=[],p=[],f=[],d=[],m=[],y=[],v=0,g=this._activeParticles.length;v<g;v++){var _=this._activeParticles[v];h.push(_.position.x,_.position.y,_.position.z),p.push(_.size.x,_.size.y,_.size.z),f.push(_.rotation.x,_.rotation.y,_.rotation.z),d.push(_.color.r,_.color.g,_.color.b,_.color.a),m.push(_.tilingOffset.x,_.tilingOffset.y,_.tilingOffset.z,_.tilingOffset.w),y.push(_.flipUV.x,_.flipUV.y)}if(o)for(v=0,g=f.length;v<g;v+=3)f[v+2]=-f[v+2];for(var b in this._attributes.a_particle_position.data=h,this._attributes.a_particle_scale.data=p,this._attributes.a_particle_rotation.data=f,this._attributes.a_particle_color.data=d,this._attributes.a_particle_tilingOffset.data=m,this._attributes.a_particle_flipUV.data=y,n.uniforms.u_particle_billboardMatrix=a,this.main.simulationSpace===t.ParticleSystemSimulationSpace.World&&(n.uniforms.u_modelMatrix=function(){return new Nt},n.uniforms.u_ITModelMatrix=function(){return new Nt}),this._attributes)n.attributes[b]=this._attributes[b]},i.prototype._emit=function(t){var e=[],n=t.preTime,i=t.currentTime;if(!this.emission.enabled)return e;if(i<=0)return e;var r=this.main.loop,o=this.main.duration;if(!r&&n>=o)return e;r||(i=Math.min(i,o));var a=i%o/o;0===a&&i>=o&&(a=1),t.rateAtDuration=a;var s=this._emitWithMove(t);e=e.concat(s);var u=this._emitWithTime(t,o);return e=e.concat(u)},i.prototype._emitWithMove=function(e){var n=[];if(this.main.simulationSpace===t.ParticleSystemSimulationSpace.World){if(e._isRateOverDistance){var i=e.currentWorldPos.subTo(e.preWorldPos),r=i.length,o=e.currentWorldPos;if(r>0){for(var a=i.clone().normalize(),s=e._leftRateOverDistance+r,u=this.emission.rateOverDistance.getValue(e.rateAtDuration),c=1/u,l=a.scaleNumberTo(1/u),h=e.preWorldPos.addTo(a.negateTo().scaleNumber(e._leftRateOverDistance));c<s;)n.push({position:h.add(l).clone().sub(o),time:e.preTime+(e.currentTime-e.preTime)*(1-s/r),num:1,emitInfo:e}),s-=c;e._leftRateOverDistance=s}}e._isRateOverDistance=!0}else e._isRateOverDistance=!1,e._leftRateOverDistance=0;return n},i.prototype._emitWithTime=function(t,e){for(var n=t.rateAtDuration,i=t.preTime,r=t.currentTime,o=[],a=1/this.emission.rateOverTime.getValue(n),s=this.emission.bursts,u=Math.floor(i/e),c=Math.ceil(r/e),l=u;l<c;l++){for(var h=l*e,p=(l+1)*e,f=Math.max(i,h),d=Math.min(r,p),m=Math.ceil(f/a)*a;m<d;m+=a)o.push({time:m,num:1,emitInfo:t,position:t.position.clone()});var y=f-h,v=d-h;for(m=0;m<s.length;m++){var g=s[m];g.isProbability&&y<=g.time&&g.time<v&&o.push({time:h+g.time,num:g.count.getValue(n),emitInfo:t,position:t.position.clone()})}}return o},i.prototype._emitParticles=function(t){for(var e=t.num,n=t.time,i=t.position,r=t.emitInfo,o=0;o<e;o++){if(this._activeParticles.length>=this.main.maxParticles)return;var a=this.main.startLifetime.getValue(r.rateAtDuration),s=(n-r.startDelay)/this.main.duration,u=(r.currentTime-n)/a;if(u<1){var c=this._particlePool.pop()||new Ol;c.cache={},c.position.copy(i),c.birthTime=n,c.lifetime=a,c.rateAtLifeTime=u,c.birthRateAtDuration=s-Math.floor(s),c.preTime=r.currentTime,c.curTime=r.currentTime,c.prePosition=i.clone(),c.curPosition=i.clone(),this._activeParticles.push(c),this._initParticleState(c),this._updateParticleState(c,0)}}},i.prototype._updateActiveParticlesState=function(t){for(var e=this._activeParticles.length-1;e>=0;e--){var n=this._activeParticles[e];n.rateAtLifeTime=(n.curTime+t-n.birthTime)/n.lifetime,n.rateAtLifeTime<0||n.rateAtLifeTime>1?(this._activeParticles.splice(e,1),this._particlePool.push(n),n.subEmitInfo=null):this._updateParticleState(n,t)}},i.prototype._initParticleState=function(t){this._modules.forEach((function(e){e.initParticleState(t)}))},i.prototype._updateParticleState=function(t,e){this._modules.forEach((function(e){e.updateParticleState(t)})),t.updateState(t.curTime+e)},i.prototype._simulationSpaceChanged=function(){if(this.transform&&0!==this._activeParticles.length)if(this._main.simulationSpace===t.ParticleSystemSimulationSpace.Local){var e=this.transform.worldToLocalMatrix;this._activeParticles.forEach((function(t){e.transformPoint3(t.position,t.position),e.transformVector3(t.velocity,t.velocity),e.transformVector3(t.acceleration,t.acceleration)}))}else{var n=this.transform.localToWorldMatrix;this._activeParticles.forEach((function(t){n.transformPoint3(t.position,t.position),n.transformVector3(t.velocity,t.velocity),n.transformVector3(t.acceleration,t.acceleration)}))}},i.prototype.addParticlePosition=function(e,n,i,r){void 0!==r&&(this.removeParticleVelocity(e,r),e.cache[r]={value:n.clone(),space:i}),i!==this.main.simulationSpace&&(i===t.ParticleSystemSimulationSpace.World?this.transform.worldToLocalMatrix.transformPoint3(n,n):this.transform.localToWorldMatrix.transformPoint3(n,n)),e.position.add(n)},i.prototype.removeParticlePosition=function(e,n){var i=e.cache[n];if(i){delete e.cache[n];var r=i.space,o=i.value;r!==this.main.simulationSpace&&(r===t.ParticleSystemSimulationSpace.World?this.transform.worldToLocalMatrix.transformPoint3(o,o):this.transform.localToWorldMatrix.transformPoint3(o,o)),e.position.sub(o)}},i.prototype.addParticleVelocity=function(e,n,i,r){void 0!==r&&(this.removeParticleVelocity(e,r),e.cache[r]={value:n.clone(),space:i}),i!==this.main.simulationSpace&&(i===t.ParticleSystemSimulationSpace.World?this.transform.worldToLocalMatrix.transformVector3(n,n):this.transform.localToWorldMatrix.transformVector3(n,n)),e.velocity.add(n)},i.prototype.removeParticleVelocity=function(e,n){var i=e.cache[n];if(i){delete e.cache[n];var r=i.space,o=i.value;r!==this.main.simulationSpace&&(r===t.ParticleSystemSimulationSpace.World?this.transform.worldToLocalMatrix.transformVector3(o,o):this.transform.localToWorldMatrix.transformVector3(o,o)),e.velocity.sub(o)}},i.prototype.addParticleAcceleration=function(e,n,i,r){void 0!==r&&(this.removeParticleAcceleration(e,r),e.cache[r]={value:n.clone(),space:i}),i!==this.main.simulationSpace&&(i===t.ParticleSystemSimulationSpace.World?this.transform.worldToLocalMatrix.transformVector3(n,n):this.transform.localToWorldMatrix.transformVector3(n,n)),e.acceleration.add(n)},i.prototype.removeParticleAcceleration=function(e,n){var i=e.cache[n];if(i){delete e.cache[n];var r=i.space,o=i.value;r!==this.main.simulationSpace&&(r===t.ParticleSystemSimulationSpace.World?this.transform.worldToLocalMatrix.transformVector3(o,o):this.transform.localToWorldMatrix.transformVector3(o,o)),e.acceleration.sub(o)}},i.prototype.TriggerSubEmitter=function(t,e){var n=this;if(void 0===e&&(e=null),this.subEmitters.enabled){var i=this.subEmitters.GetSubEmitterSystem(t);if(i&&i.enabled){var r=this.subEmitters.GetSubEmitterEmitProbability(t);this.subEmitters.GetSubEmitterProperties(t),this.subEmitters.GetSubEmitterType(t),e=e||this._activeParticles;var o=[];e.forEach((function(t){if(!(Math.random()>r)){var e=n.transform.localToWorldMatrix.transformPoint3(t.position),a=i.transform.worldToLocalMatrix.transformPoint3(e);if(t.subEmitInfo)t.subEmitInfo.preTime=t.preTime-t.birthTime-t.subEmitInfo.startDelay,t.subEmitInfo.currentTime=t.curTime-t.birthTime-t.subEmitInfo.startDelay,t.subEmitInfo.position.copy(a);else{var s=n.main.startDelay.getValue(Math.random());t.subEmitInfo={preTime:t.preTime-t.birthTime-s,currentTime:t.preTime-t.birthTime-s,preWorldPos:e.clone(),currentWorldPos:e.clone(),rateAtDuration:0,_leftRateOverDistance:0,_isRateOverDistance:!1,startDelay:s,moveVec:new ht,speed:new ht,position:a}}var u=i._emit(t.subEmitInfo);o=o.concat(u)}})),o.sort((function(t,e){return t.time-e.time})),o.forEach((function(t){i._emitParticles(t)}))}}},Dc([C,n({block:"Main",component:"OAVObjectView"})],i.prototype,"main",null),Dc([C,n({block:"Emission",component:"OAVObjectView"})],i.prototype,"emission",null),Dc([C,n({block:"Shape",component:"OAVObjectView"})],i.prototype,"shape",null),Dc([C,n({block:"Velocity Over Lifetime",component:"OAVObjectView"})],i.prototype,"velocityOverLifetime",null),Dc([C,n({tooltip:"基于时间轴限制速度模块。",block:"Limit Velocity Over Lifetime",component:"OAVObjectView"})],i.prototype,"limitVelocityOverLifetime",null),Dc([C,n({tooltip:"粒子系统速度继承模块。",block:"Inherit Velocity",component:"OAVObjectView"})],i.prototype,"inheritVelocity",null),Dc([C,n({block:"Force Over Lifetime",component:"OAVObjectView"})],i.prototype,"forceOverLifetime",null),Dc([C,n({block:"Color Over Lifetime",component:"OAVObjectView"})],i.prototype,"colorOverLifetime",null),Dc([C,n({block:"Color By Speed",component:"OAVObjectView"})],i.prototype,"colorBySpeed",null),Dc([C,n({block:"sizeOverLifetime",component:"OAVObjectView"})],i.prototype,"sizeOverLifetime",null),Dc([C,n({block:"Size By Speed",component:"OAVObjectView"})],i.prototype,"sizeBySpeed",null),Dc([C,n({block:"Rotation Over Lifetime",component:"OAVObjectView"})],i.prototype,"rotationOverLifetime",null),Dc([C,n({block:"Rotation By Speed",component:"OAVObjectView"})],i.prototype,"rotationBySpeed",null),Dc([C,n({block:"Noise",component:"OAVObjectView"})],i.prototype,"noise",null),Dc([C,n({block:"Sub Emitters",component:"OAVObjectView"})],i.prototype,"subEmitters",null),Dc([C,n({tooltip:"粒子系统纹理表动画模块。",block:"Texture Sheet Animation",component:"OAVObjectView"})],i.prototype,"textureSheetAnimation",null),Dc([n({tooltip:"粒子系统渲染模块。",block:"Renderer"})],i.prototype,"geometry",void 0),Dc([n({block:"Renderer"})],i.prototype,"material",void 0),Dc([n({block:"Renderer"}),C],i.prototype,"castShadows",void 0),Dc([n({block:"Renderer"}),C],i.prototype,"receiveShadows",void 0),i=Dc([zi("Effects/ParticleSystem"),Ai()],i)}(Fr);Tr.setDefault("Billboard-Geometry",new sa),Vr.registerPrimitive("Particle System",(function(t){t.addComponent(zl),t.getComponent(Br).rx=-90})),Vi.push({path:"Effects/Particle System",priority:-1,click:function(){return Vr.createPrimitive("Particle System")}});var Il=function(t,e){return Il=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},Il(t,e)};function jl(t,e){function n(){this.constructor=t}Il(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function Rl(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}var Ll=function(t){function e(){var e=t.call(this)||this;return e.geometry=Tr.getDefault("Terrain-Geometry"),e.material=Lr.getDefault("Terrain-Material"),e}return jl(e,t),e=Rl([Ai()],e)}(Fr);Vr.registerPrimitive("Terrain",(function(t){t.addComponent(Ll)})),Vi.push({path:"3D Object/Terrain",priority:-2e4,click:function(){return Vr.createPrimitive("Terrain")}});var Nl=function(){function t(){this.heightmapResolution=513,this.size=new ht(500,600,500)}return Object.defineProperty(t.prototype,"heightmapWidth",{get:function(){return this.heightmapResolution},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"heightmapHeight",{get:function(){return this.heightmapResolution},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"heightmapScale",{get:function(){return this.size.divideNumberTo(this.heightmapResolution)},enumerable:!1,configurable:!0}),t}(),Fl=function(t){function e(e){var n=t.call(this)||this;return n.heightMap=zr.default,n.width=10,n.height=1,n.depth=10,n.segmentsW=30,n.segmentsH=30,n.maxElevation=255,n.minElevation=0,n._heightImageData=kl,n.name="terrain",E.setValue(n,e),n}return jl(e,t),e.prototype._onHeightMapChanged=function(){var t=this;if(!this.heightMap._pixels)return this._heightImageData=kl,this.invalidateGeometry(),void this.heightMap.once("loadCompleted",(function(){var e=t.heightMap._pixels;t._heightImageData=Dr.fromImage(e).imageData,t.invalidateGeometry()}));var e=this.heightMap._pixels;this._heightImageData=Dr.fromImage(e).imageData,this.invalidateGeometry()},e.prototype.buildGeometry=function(){if(this._heightImageData){var t,e,n,i,r,o,a=0,s=0,u=this.segmentsW+1,c=(this.segmentsH+1)*u,l=(this._heightImageData.width-1)/this.segmentsW,h=(this._heightImageData.height-1)/this.segmentsH,p=[],f=[];c=0;for(var d=0;d<=this.segmentsH;++d)for(var m=0;m<=this.segmentsW;++m)t=(m/this.segmentsW-.5)*this.width,e=(d/this.segmentsH-.5)*this.depth,n=m*l,i=(this.segmentsH-d)*h,r=(o=255&this.getPixel(this._heightImageData,n,i))>this.maxElevation?this.maxElevation/255*this.height:o<this.minElevation?this.minElevation/255*this.height:o/255*this.height,p[c++]=t,p[c++]=r,p[c++]=e,m!==this.segmentsW&&d!==this.segmentsH&&(s=m+d*u,f[a++]=s,f[a++]=s+u,f[a++]=s+u+1,f[a++]=s,f[a++]=s+u+1,f[a++]=s+1);var y=this.buildUVs();this.positions=p,this.uvs=y,this.indices=f,this.normals=Cr.createVertexNormals(this.indices,this.positions,!0),this.tangents=Cr.createVertexTangents(this.indices,this.positions,this.uvs,!0)}},e.prototype.buildUVs=function(){var t=(this.segmentsH+1)*(this.segmentsW+1)*2,e=[];t=0;for(var n=0;n<=this.segmentsH;++n)for(var i=0;i<=this.segmentsW;++i)e[t++]=i/this.segmentsW,e[t++]=1-n/this.segmentsH;return e},e.prototype.getHeightAt=function(t,e){var n=(t/this.width+.5)*(this._heightImageData.width-1),i=(-e/this.depth+.5)*(this._heightImageData.height-1),r=255&this.getPixel(this._heightImageData,n,i);return r>this.maxElevation?this.maxElevation/255*this.height:r<this.minElevation?this.minElevation/255*this.height:r/255*this.height},e.prototype.getPixel=function(t,e,n){e=~~e;var i=4*((n=~~n)*t.width+e);return t.data[i+2]},Rl([C,n(),N("_onHeightMapChanged")],e.prototype,"heightMap",void 0),Rl([C,n(),N("invalidateGeometry")],e.prototype,"width",void 0),Rl([C,n(),N("invalidateGeometry")],e.prototype,"height",void 0),Rl([C,n(),N("invalidateGeometry")],e.prototype,"depth",void 0),Rl([C,n(),N("invalidateGeometry")],e.prototype,"segmentsW",void 0),Rl([C,n(),N("invalidateGeometry")],e.prototype,"segmentsH",void 0),Rl([C,n(),N("invalidateGeometry")],e.prototype,"maxElevation",void 0),Rl([C,n(),N("invalidateGeometry")],e.prototype,"minElevation",void 0),e}(Tr),kl=new Dr(1024,1024,new yt(0,0,0,0)).imageData;Tr.setDefault("Terrain-Geometry",new Fl);var Bl=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.s_splatTexture1=zr.default,e.s_splatTexture2=zr.default,e.s_splatTexture3=zr.default,e.s_blendTexture=zr.default,e.u_splatRepeats=new dt(1,1,1,1),e}return jl(e,t),Rl([C,n({block:"terrain"})],e.prototype,"s_splatTexture1",void 0),Rl([C,n({block:"terrain"})],e.prototype,"s_splatTexture2",void 0),Rl([C,n({block:"terrain"})],e.prototype,"s_splatTexture3",void 0),Rl([C,n({block:"terrain"})],e.prototype,"s_blendTexture",void 0),Rl([C,n({block:"terrain"})],e.prototype,"u_splatRepeats",void 0),e}(Rr);Ln.shaders.terrain.cls=Bl,Lr.setDefault("Terrain-Material",{shaderName:"terrain"});var Vl=function(e){function n(){var n=e.call(this)||this;return n.splatMergeTexture=zr.default,n.blendTexture=zr.default,n.splatRepeats=new dt(1,1,1,1),n.splatMergeTexture.minFilter=t.TextureMinFilter.NEAREST,n.splatMergeTexture.magFilter=t.TextureMagFilter.NEAREST,n.splatMergeTexture.wrapS=t.TextureWrap.REPEAT,n.splatMergeTexture.wrapT=t.TextureWrap.REPEAT,n}return jl(n,e),n.prototype.beforeRender=function(t){t.uniforms.s_blendTexture=this.blendTexture,t.uniforms.s_splatMergeTexture=this.splatMergeTexture,t.uniforms.u_splatMergeTextureSize=this.splatMergeTexture.getSize(),t.uniforms.u_splatRepeats=this.splatRepeats,t.uniforms.u_imageSize=new lt(2048,1024),t.uniforms.u_tileSize=new lt(512,512),t.uniforms.u_maxLod=7,t.uniforms.u_uvPositionScale=.001,t.uniforms.u_tileOffset=[new dt(.5,.5,0,0),new dt(.5,.5,.5,0),new dt(.5,.5,0,.5)],t.uniforms.u_lod0vec=new dt(.5,1,0,0)},n}(X),Wl=function(t,e){return Wl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},Wl(t,e)};function Ul(t,e){function n(){this.constructor=t}Wl(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function Gl(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}var Hl,Kl=function(e){function i(){var t=e.call(this)||this;return t._rect=new dt(0,0,100,100),t._position=new lt,t._size=new lt(1,1),t._layout=new dt,t._anchorMin=new lt(.5,.5),t._anchorMax=new lt(.5,.5),t._pivot=new lt(.5,.5),t._rotation=0,t._scale=new lt(1,1),k.watch(t,"transformLayout",t._onTransformLayoutChanged,t),t}return Ul(i,e),Object.defineProperty(i.prototype,"single",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rect",{get:function(){var t=this.transformLayout;return this._rect.set(-t.pivot.x*t.size.x,-t.pivot.y*t.size.y,t.size.x,t.size.y),this._rect},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._position},set:function(t){this._position.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"size",{get:function(){return this._size},set:function(t){this._size.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"layout",{get:function(){return this._layout},set:function(t){this._layout.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"anchorMin",{get:function(){return this._anchorMin},set:function(t){this._anchorMin.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"anchorMax",{get:function(){return this._anchorMax},set:function(t){this._anchorMax.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"pivot",{get:function(){return this._pivot},set:function(t){this._pivot.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale.copy(t)},enumerable:!1,configurable:!0}),i.prototype.init=function(){e.prototype.init.call(this);var t=this.getComponent(wo);t||(t=this.gameObject.addComponent(wo)),this.transformLayout=t,k.bind(this.transform.rotation,"z",this,"rotation"),k.bind(this.transform.scale,"x",this.scale,"x"),k.bind(this.transform.scale,"y",this.scale,"y"),this.on("addComponent",this._onAddComponent,this),this.on("removeComponent",this._onRemovedComponent,this)},i.prototype._onAddComponent=function(e){if(e.data.gameobject===this.gameObject){var n=e.data.component;n instanceof wo&&(n.hideFlags=n.hideFlags|t.HideFlags.HideInInspector,this.transformLayout=n)}},i.prototype._onRemovedComponent=function(t){t.data.gameobject===this.gameObject&&(t.data.component instanceof wo&&(this.transformLayout=null))},i.prototype._onTransformLayoutChanged=function(t,e,n,i){e&&(k.unbind(e.position,"x",this.position,"x"),k.unbind(e.position,"y",this.position,"y"),k.unbind(e.anchorMin,"x",this.anchorMin,"x"),k.unbind(e.anchorMin,"y",this.anchorMin,"y"),k.unbind(e.anchorMax,"x",this.anchorMax,"x"),k.unbind(e.anchorMax,"y",this.anchorMax,"y"),k.unbind(e.leftTop,"x",this.layout,"x"),k.unbind(e.rightBottom,"x",this.layout,"y"),k.unbind(e.leftTop,"y",this.layout,"z"),k.unbind(e.rightBottom,"y",this.layout,"w"),k.unbind(e.size,"x",this.size,"x"),k.unbind(e.size,"y",this.size,"y"),k.unbind(e.pivot,"x",this.pivot,"x"),k.unbind(e.pivot,"y",this.pivot,"y")),t&&(k.bind(t.position,"x",this.position,"x"),k.bind(t.position,"y",this.position,"y"),k.bind(t.anchorMin,"x",this.anchorMin,"x"),k.bind(t.anchorMin,"y",this.anchorMin,"y"),k.bind(t.anchorMax,"x",this.anchorMax,"x"),k.bind(t.anchorMax,"y",this.anchorMax,"y"),k.bind(t.leftTop,"x",this.layout,"x"),k.bind(t.rightBottom,"x",this.layout,"y"),k.bind(t.leftTop,"y",this.layout,"z"),k.bind(t.rightBottom,"y",this.layout,"w"),k.bind(t.size,"x",this.size,"x"),k.bind(t.size,"y",this.size,"y"),k.bind(t.pivot,"x",this.pivot,"x"),k.bind(t.pivot,"y",this.pivot,"y"))},i.prototype.beforeRender=function(t,e,n){t.uniforms.u_rect=this.rect},Gl([n({tooltip:"当anchorMin.x == anchorMax.x时对position.x赋值生效，当 anchorMin.y == anchorMax.y 时对position.y赋值生效，否则赋值无效，自动被覆盖。",componentParam:{step:1,stepScale:1,stepDownup:1}}),C],i.prototype,"position",null),Gl([n({tooltip:"宽度，不会影响到缩放值。当 anchorMin.x == anchorMax.x 时对 size.x 赋值生效，当anchorMin.y == anchorMax.y时对 size.y 赋值生效，否则赋值无效，自动被覆盖。",componentParam:{step:1,stepScale:1,stepDownup:1}}),C],i.prototype,"size",null),Gl([n({tooltip:"与最小最大锚点形成的边框的left、right、top、bottom距离。当 anchorMin.x != anchorMax.x 时对 layout.x layout.y 赋值生效，当 anchorMin.y != anchorMax.y 时对 layout.z layout.w 赋值生效，否则赋值无效，自动被覆盖。",componentParam:{step:1,stepScale:1,stepDownup:1}}),C],i.prototype,"layout",null),Gl([n({tooltip:"父Transform2D中左上角锚定的规范化位置。",componentParam:{step:.01,stepScale:.01,stepDownup:.01}}),C],i.prototype,"anchorMin",null),Gl([n({tooltip:"最大锚点，父Transform2D中左上角锚定的规范化位置。",componentParam:{step:.01,stepScale:.01,stepDownup:.01}}),C],i.prototype,"anchorMax",null),Gl([n({tooltip:"中心点"}),C],i.prototype,"pivot",null),Gl([n({tooltip:"旋转",componentParam:{step:.01,stepScale:30,stepDownup:50}})],i.prototype,"rotation",null),Gl([n({tooltip:"缩放",componentParam:{step:.01,stepScale:1,stepDownup:1}})],i.prototype,"scale",null),i=Gl([zi("Layout/Transform2D"),Ai()],i)}(Ei);Object.defineProperty(Vr.prototype,"transform2D",{get:function(){return this.getComponent(Kl)}}),Object.defineProperty(Ei.prototype,"transform2D",{get:function(){return this._gameObject&&this._gameObject.transform2D}}),t.ButtonState=void 0,(Hl=t.ButtonState||(t.ButtonState={})).up="up",Hl.over="over",Hl.down="down",Hl.selected_up="selected_up",Hl.selected_over="selected_over",Hl.selected_down="selected_down",Hl.disabled="disabled";var Xl,ql=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.state=t.ButtonState.up,n.allStateData={},n._stateInvalid=!0,n}return Ul(i,e),i.prototype.saveState=function(){var t={},e={};for(var n in this.gameObject.children.forEach((function(t){e[t.name]||(e[t.name]=t)})),e){var i=E.serialize(e[n]);E.deleteClassKey(i),t[n]=i}this.allStateData[this.state]=t},i.prototype._onStateChanged=function(){this._stateInvalid=!0},i.prototype.update=function(t){this._stateInvalid&&(this._updateState(),this._stateInvalid=!1)},i.prototype._updateState=function(){var t=this.allStateData[this.state];if(t){var e={};for(var n in this.gameObject.children.forEach((function(t){e[t.name]||(e[t.name]=t)})),e)e[n]=E.setValue(e[n],t[n])}},Gl([n({block:"Layout",tooltip:"按钮所处状态。",component:"OAVEnum",componentParam:{enumClass:t.ButtonState}}),N("_onStateChanged")],i.prototype,"state",void 0),Gl([C],i.prototype,"allStateData",void 0),Gl([n()],i.prototype,"saveState",null),i=Gl([zi("UI/Button"),Ai()],i)}(Di);Vr.registerPrimitive("Button",(function(t){var e=t.addComponent(Kl);e.size.x=160,e.size.y=30,t.addComponent(ql)})),Vi.push({path:"UI/Button",priority:-2,click:function(){return Vr.createPrimitive("Button")}}),t.UIRenderMode=void 0,(Xl=t.UIRenderMode||(t.UIRenderMode={}))[Xl.ScreenSpaceOverlay=0]="ScreenSpaceOverlay",Xl[Xl.ScreenSpaceCamera=1]="ScreenSpaceCamera",Xl[Xl.WorldSpace=2]="WorldSpace";var Yl=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.renderMode=t.UIRenderMode.ScreenSpaceOverlay,n.mouseRay=new Rt(new ht,new ht(0,0,1)),n.projection=new Nt,n.near=-1e3,n.far=1e4,n}return Ul(i,e),i.prototype.init=function(){},i.prototype.layout=function(t,e){this.transform2D.size.x=t,this.transform2D.size.y=e,this.transform2D.pivot.set(0,0),this.transform.x=0,this.transform.y=0,this.transform.z=0,this.transform.rx=0,this.transform.ry=0,this.transform.rz=0,this.transform.sx=1,this.transform.sy=1,this.transform.sz=1;var n=this.near,i=this.far;this.projection.identity().appendTranslation(0,0,-(i+n)/2).appendScale(2/t,-2/e,2/(i-n)).appendTranslation(-1,1,0)},i.prototype.calcMouseRay3D=function(t){this.mouseRay.origin.set(t.mousePos.x,t.mousePos.y,0)},Gl([C,n({component:"OAVEnum",tooltip:"画布是在世界或覆盖模式",componentParam:{enumClass:t.UIRenderMode}})],i.prototype,"renderMode",void 0),Gl([C,n()],i.prototype,"near",void 0),Gl([C,n()],i.prototype,"far",void 0),i=Gl([Ai()],i)}(Di);Vr.registerPrimitive("Canvas",(function(t){t.addComponent(Kl),t.addComponent(Yl)}));var Zl=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderAtomic=new Bn,t.geometry=Tr.getDefault("Default-UIGeometry"),t.material=Lr.getDefault("Default-UIMaterial"),t}var r;return Ul(i,e),r=i,i.prototype.worldRayIntersection=function(e){var n=this.getComponentsInParent(Yl)[0];n&&(e=n.mouseRay);var i=this.transform.rayWorldToLocal(e);if(this.transform2D){var r=new ht(this.transform2D.size.x,this.transform2D.size.y,1),o=new ht(this.transform2D.pivot.x,this.transform2D.pivot.y,0);i.origin.divide(r).add(o),i.direction.divide(r).normalize()}var a=this.localRayIntersection(i);return a&&(a.cullFace=t.CullFace.NONE),a},i.prototype._updateBounds=function(){var t=this.geometry.bounding.clone(),e=this.getComponent(wo);e&&t.scale(e.size),this._selfLocalBounds=t},i.draw=function(t){var e=t.gl.gl;t.scene.getComponentsInChildren(Yl).filter((function(t){return t.isVisibleAndEnabled})).forEach((function(n){n.layout(e.canvas.width,e.canvas.height),n.calcMouseRay3D(t),n.getComponentsInChildren(r).filter((function(t){return t.isVisibleAndEnabled})).forEach((function(e){var i=e.renderAtomic;i.uniforms.u_viewProjection=n.projection,e.beforeRender(i,null,null),t.gl.render(i)}))}))},Gl([n()],i.prototype,"material",void 0),i=r=Gl([zi("Rendering/CanvasRenderer"),Ai()],i)}(Fr),Ql=function(t){function e(){var e=t.call(this)||this;return e.positions=[0,0,0,1,0,0,1,1,0,0,1,0],e.uvs=[0,0,1,0,1,1,0,1],e.indices=[0,1,2,0,2,3],e.normals=Cr.createVertexNormals(e.indices,e.positions,!0),e.tangents=Cr.createVertexTangents(e.indices,e.positions,e.uvs,!0),e}return Ul(e,t),e}(Tr);Tr.setDefault("Default-UIGeometry",new Ql);var Jl=function(){function t(){this.u_rect=new dt(0,0,100,100),this.u_color=new yt,this.s_texture=zr.default,this.u_uvRect=new dt(0,0,1,1)}return Gl([C,n()],t.prototype,"u_color",void 0),Gl([n(),C],t.prototype,"s_texture",void 0),t}();Ln.shaders.ui={vertex:"\n    attribute vec2 a_position;\n    attribute vec2 a_uv;\n    \n    uniform vec4 u_uvRect;\n    uniform vec4 u_rect;\n    uniform mat4 u_modelMatrix;\n    uniform mat4 u_viewProjection;\n    \n    varying vec2 v_uv;\n    varying vec2 v_position;\n\n    void main() \n    {\n        vec2 position = u_rect.xy + a_position * u_rect.zw;\n        gl_Position = u_viewProjection * u_modelMatrix * vec4(position, 0.0, 1.0);\n        v_uv = u_uvRect.xy + a_uv * u_uvRect.zw;\n        v_position = position.xy;\n    }\n    ",fragment:"\n    precision mediump float;\n\n    uniform sampler2D s_texture;\n    varying vec2 v_uv;\n    varying vec2 v_position;\n    \n    uniform vec4 u_color;\n    \n    void main() \n    {\n        vec4 color = texture2D(s_texture, v_uv);\n        gl_FragColor = color * u_color;\n    }\n    \n    ",cls:Jl,renderParams:{enableBlend:!0,depthtest:!1}},Lr.setDefault("Default-UIMaterial",{shaderName:"ui"});var $l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.image=zr.default,e.color=new yt,e}return Ul(e,t),e.prototype.setNativeSize=function(){var t=this.image.getSize();this.transform2D.size.x=t.x,this.transform2D.size.y=t.y},e.prototype.beforeRender=function(e,n,i){t.prototype.beforeRender.call(this,e,n,i),e.uniforms.s_texture=this.image,e.uniforms.u_color=this.color},Gl([n(),C],e.prototype,"image",void 0),Gl([n(),C],e.prototype,"color",void 0),Gl([n({tooltip:"使图片显示实际尺寸",componentParam:{label:"ReSize"}})],e.prototype,"setNativeSize",null),e=Gl([zi("UI/Image"),Ai()],e)}(Ei);Vr.registerPrimitive("Image",(function(t){var e=t.addComponent(Kl);t.addComponent(Zl),e.size.x=100,e.size.y=100,t.addComponent($l)})),Vi.push({path:"UI/Image",priority:-2,click:function(){return Vr.createPrimitive("Image")}}),Sa.extendFunction(Xo.prototype,"render",(function(t,e){Zl.draw(this)}));var th=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.color=new yt,e}return Ul(e,t),e.prototype.beforeRender=function(e,n,i){t.prototype.beforeRender.call(this,e,n,i),e.uniforms.u_color=this.color},Gl([n(),C],e.prototype,"color",void 0),e=Gl([zi("UI/Rect"),Ai()],e)}(Ei);Vr.registerPrimitive("Rect",(function(t){var e=t.addComponent(Kl);t.addComponent(Zl),e.size.x=100,e.size.y=100,t.addComponent(th)})),Vi.push({path:"UI/Rect",priority:-2,click:function(){return Vr.createPrimitive("Rect")}});var eh,nh,ih,rh,oh,ah,sh,uh,ch,lh=function(){function t(t,e,n,i,r,o,a,s,u){this.text=t,this.style=e,this.width=n,this.height=i,this.lines=r,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=s,this.fontProperties=u}var e;return t.measureText=function(e,n,i,r){void 0===r&&(r=t._canvas),i=null==i?n.wordWrap:i;var o=n.toFontString(),a=t.measureFont(o);0===a.fontSize&&(a.fontSize=n.fontSize,a.ascent=n.fontSize);var s=r.getContext("2d");if(!s)throw"获取 CanvasRenderingContext2D 失败！";s.font=o;for(var u=(i?t.wordWrap(e,n,r):e).split(/(?:\r\n|\r|\n)/),c=new Array(u.length),l=0,h=0;h<u.length;h++){var p=s.measureText(u[h]).width+(u[h].length-1)*n.letterSpacing;c[h]=p,l=Math.max(l,p)}var f=l+n.strokeThickness;n.dropShadow&&(f+=n.dropShadowDistance);var d=n.lineHeight||a.fontSize+n.strokeThickness,m=Math.max(d,a.fontSize+n.strokeThickness)+(u.length-1)*(d+n.leading);return n.dropShadow&&(m+=n.dropShadowDistance),new t(e,n,f,m,u,c,d+n.leading,l,a)},t.wordWrap=function(e,n,i){void 0===i&&(i=t._canvas);var r=i.getContext("2d");if(!r)throw"获取 CanvasRenderingContext2D 失败！";for(var o=0,a="",s="",u={},c=n.letterSpacing,l=n.whiteSpace,h=t.collapseSpaces(l),p=t.collapseNewlines(l),f=!h,d=n.wordWrapWidth+c,m=t.tokenize(e),y=0;y<m.length;y++){var v=m[y];if(t.isNewline(v)){if(!p){s+=t.addLine(a),f=!h,a="",o=0;continue}v=" "}if(h){var g=t.isBreakingSpace(v),_=t.isBreakingSpace(a[a.length-1]);if(g&&_)continue}var b=t.getFromCache(v,c,u,r);if(b>d)if(""!==a&&(s+=t.addLine(a),a="",o=0),t.canBreakWords(v,n.breakWords))for(var x=t.wordWrapSplit(v),w=0;w<x.length;w++){for(var S=x[w],P=1;x[w+P];){var M=x[w+P],C=S[S.length-1];if(t.canBreakChars(C,M,v,w,n.breakWords))break;S+=M,P++}w+=S.length-1;var T=t.getFromCache(S,c,u,r);T+o>d&&(s+=t.addLine(a),f=!1,a="",o=0),a+=S,o+=T}else{a.length>0&&(s+=t.addLine(a),a="",o=0);var A=y===m.length-1;s+=t.addLine(v,!A),f=!1,a="",o=0}else b+o>d&&(f=!1,s+=t.addLine(a),a="",o=0),(a.length>0||!t.isBreakingSpace(v)||f)&&(a+=v,o+=b)}return s+=t.addLine(a,!1)},t.addLine=function(e,n){return void 0===n&&(n=!0),e=t.trimRight(e),e=n?e+"\n":e},t.getFromCache=function(t,e,n,i){var r=n[t];if(void 0===r){var o=t.length*e;r=i.measureText(t).width+o,n[t]=r}return r},t.collapseSpaces=function(t){return"normal"===t||"pre-line"===t},t.collapseNewlines=function(t){return"normal"===t},t.trimRight=function(e){if("string"!=typeof e)return"";for(var n=e.length-1;n>=0;n--){var i=e[n];if(!t.isBreakingSpace(i))break;e=e.slice(0,-1)}return e},t.isNewline=function(e){return"string"==typeof e&&t._newlines.indexOf(e.charCodeAt(0))>=0},t.isBreakingSpace=function(e){return"string"==typeof e&&t._breakingSpaces.indexOf(e.charCodeAt(0))>=0},t.tokenize=function(e){var n=[],i="";if("string"!=typeof e)return n;for(var r=0;r<e.length;r++){var o=e[r];t.isBreakingSpace(o)||t.isNewline(o)?(""!==i&&(n.push(i),i=""),n.push(o)):i+=o}return""!==i&&n.push(i),n},t.canBreakWords=function(t,e){return e},t.canBreakChars=function(t,e,n,i,r){return!0},t.wordWrapSplit=function(t){return t.split("")},t.measureFont=function(e){if(t._fonts[e])return t._fonts[e];var n={},i=t._canvas,r=t._context;r.font=e;var o=t.METRICS_STRING+t.BASELINE_SYMBOL,a=Math.ceil(r.measureText(o).width),s=Math.ceil(r.measureText(t.BASELINE_SYMBOL).width),u=3*s;s=s*t.BASELINE_MULTIPLIER|0,i.width=a,i.height=u,r.fillStyle="#f00",r.fillRect(0,0,a,u),r.font=e,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(o,0,s);var c=r.getImageData(0,0,a,u).data,l=c.length,h=4*a,p=0,f=0,d=!1;for(p=0;p<s;++p){for(var m=0;m<h;m+=4)if(255!==c[f+m]){d=!0;break}if(d)break;f+=h}for(n.ascent=s-p,f=l-h,d=!1,p=u;p>s;--p){for(m=0;m<h;m+=4)if(255!==c[f+m]){d=!0;break}if(d)break;f-=h}return n.descent=p-s,n.fontSize=n.ascent+n.descent,t._fonts[e]=n,n},t.clearMetrics=function(e){void 0===e&&(e=""),e?delete t._fonts[e]:t._fonts={}},t._canvas=((e=document.createElement("canvas")).width=e.height=10,e),t._context=t._canvas.getContext("2d"),t._fonts={},t.METRICS_STRING="|ÉqÅ",t.BASELINE_SYMBOL="M",t.BASELINE_MULTIPLIER=2,t._newlines=[10,13],t._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288],t}();t.TEXT_GRADIENT=void 0,(eh=t.TEXT_GRADIENT||(t.TEXT_GRADIENT={}))[eh.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",eh[eh.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",t.FontFamily=void 0,(nh=t.FontFamily||(t.FontFamily={})).Arial="Arial",nh.serif="serif",nh["sans-serif"]="sans-serif",nh.monospace="monospace",nh.cursive="cursive",nh.fantasy="fantasy",nh["system-ui"]="system-ui",nh["宋体"]="宋体",t.FontStyle=void 0,(ih=t.FontStyle||(t.FontStyle={})).normal="normal",ih.italic="italic",ih.oblique="oblique",t.FontVariant=void 0,(rh=t.FontVariant||(t.FontVariant={})).normal="normal",rh["small-caps"]="small-caps",t.FontWeight=void 0,(oh=t.FontWeight||(t.FontWeight={})).normal="normal",oh.bold="bold",oh.bolder="bolder",oh.lighter="lighter",t.CanvasLineJoin=void 0,(ah=t.CanvasLineJoin||(t.CanvasLineJoin={})).round="round",ah.bevel="bevel",ah.miter="miter",t.CanvasTextBaseline=void 0,(sh=t.CanvasTextBaseline||(t.CanvasTextBaseline={})).top="top",sh.hanging="hanging",sh.middle="middle",sh.alphabetic="alphabetic",sh.ideographic="ideographic",sh.bottom="bottom",t.TextAlign=void 0,(uh=t.TextAlign||(t.TextAlign={})).left="left",uh.center="center",uh.right="right",t.WhiteSpaceHandle=void 0,(ch=t.WhiteSpaceHandle||(t.WhiteSpaceHandle={})).normal="normal",ch.pre="pre",ch["pre-line"]="pre-line";var hh=function(e){function i(n){var i=e.call(this)||this;return i.fontFamily=t.FontFamily.Arial,i.fontSize=26,i.fontStyle=t.FontStyle.normal,i.fontVariant=t.FontVariant.normal,i.fontWeight=t.FontWeight.normal,i.fill=new yt(0,0,0,1),i.fillGradientType=t.TEXT_GRADIENT.LINEAR_VERTICAL,i.fillGradientStops=[],i.stroke=new yt(0,0,0,1),i.strokeThickness=0,i.lineJoin=t.CanvasLineJoin.miter,i.miterLimit=10,i.letterSpacing=0,i.textBaseline=t.CanvasTextBaseline.alphabetic,i.dropShadow=!1,i.dropShadowColor=new yt(0,0,0,1),i.dropShadowAngle=30,i.dropShadowBlur=0,i.dropShadowDistance=5,i.wordWrap=!1,i.breakWords=!1,i.align=t.TextAlign.left,i.whiteSpace=t.WhiteSpaceHandle.pre,i.wordWrapWidth=100,i.lineHeight=0,i.leading=0,i.padding=0,i.trim=!1,E.setValue(i,n),i}return Ul(i,e),i.prototype.invalidate=function(){this.emit("changed")},i.prototype.toFontString=function(){var e=this.fontSize+"px",n=this.fontFamily;Array.isArray(this.fontFamily)||(n=this.fontFamily.split(","));for(var i=n.length-1;i>=0;i--){var r=n[i].trim();/([\"\'])[^\'\"]+\1/.test(r)||void 0!==t.FontFamily[r]||(r='"'+r+'"'),n[i]=r}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+e+" "+n.join(",")},Gl([n({block:"Font",tooltip:"字体。",component:"OAVEnum",componentParam:{enumClass:t.FontFamily}}),N("invalidate"),C],i.prototype,"fontFamily",void 0),Gl([n({block:"Font",tooltip:"字体尺寸。"}),N("invalidate"),C],i.prototype,"fontSize",void 0),Gl([n({block:"Font",tooltip:"字体样式。",component:"OAVEnum",componentParam:{enumClass:t.FontStyle}}),N("invalidate"),C],i.prototype,"fontStyle",void 0),Gl([n({block:"Font",tooltip:"字体变体。",component:"OAVEnum",componentParam:{enumClass:t.FontVariant}}),N("invalidate"),C],i.prototype,"fontVariant",void 0),Gl([n({block:"Font",tooltip:"字型粗细。",component:"OAVEnum",componentParam:{enumClass:t.FontWeight}}),N("invalidate"),C],i.prototype,"fontWeight",void 0),Gl([n({block:"Fill",tooltip:"用于填充文本的颜色。"}),N("invalidate"),C],i.prototype,"fill",void 0),Gl([n({block:"Fill",tooltip:"如果填充是一个创建渐变的颜色数组，这可以改变渐变的方向。",component:"OAVEnum",componentParam:{enumClass:t.TEXT_GRADIENT}}),N("invalidate"),C],i.prototype,"fillGradientType",void 0),Gl([n({block:"Fill"}),N("invalidate"),C],i.prototype,"fillGradientStops",void 0),Gl([n({block:"Stroke",tooltip:"将用于文本笔划的画布填充样式。"}),N("invalidate"),C],i.prototype,"stroke",void 0),Gl([n({block:"Stroke",tooltip:"一个表示笔画厚度的数字。"}),N("invalidate"),C],i.prototype,"strokeThickness",void 0),Gl([n({block:"Stroke",tooltip:"lineJoin属性设置创建的角的类型，它可以解决带尖刺的文本问题。",component:"OAVEnum",componentParam:{enumClass:t.CanvasLineJoin}}),N("invalidate"),C],i.prototype,"lineJoin",void 0),Gl([n({block:"Stroke",tooltip:"当使用“miter”lineJoin模式时，miter限制使用。这可以减少或增加呈现文本的尖锐性。"}),N("invalidate"),C],i.prototype,"miterLimit",void 0),Gl([n({block:"Layout",tooltip:"字母之间的间距，默认为0"}),N("invalidate"),C],i.prototype,"letterSpacing",void 0),Gl([n({block:"Layout",tooltip:"呈现文本的基线。",component:"OAVEnum",componentParam:{enumClass:t.CanvasTextBaseline}}),N("invalidate"),C],i.prototype,"textBaseline",void 0),Gl([n({block:"Drop Shadow",tooltip:"是否为文本设置一个投影。"}),N("invalidate"),C],i.prototype,"dropShadow",void 0),Gl([n({block:"Drop Shadow",tooltip:"投影颜色。"}),N("invalidate"),C],i.prototype,"dropShadowColor",void 0),Gl([n({block:"Drop Shadow",tooltip:"投影角度。"}),N("invalidate"),C],i.prototype,"dropShadowAngle",void 0),Gl([n({block:"Drop Shadow",tooltip:"阴影模糊半径。"}),N("invalidate"),C],i.prototype,"dropShadowBlur",void 0),Gl([n({block:"Drop Shadow",tooltip:"投影距离。"}),N("invalidate"),C],i.prototype,"dropShadowDistance",void 0),Gl([n({block:"Multiline",tooltip:"是否应使用自动换行。"}),N("invalidate"),C],i.prototype,"wordWrap",void 0),Gl([n({block:"Multiline"}),N("invalidate"),C],i.prototype,"breakWords",void 0),Gl([n({block:"Multiline",tooltip:"多行文本对齐方式。",component:"OAVEnum",componentParam:{enumClass:t.TextAlign}}),N("invalidate"),C],i.prototype,"align",void 0),Gl([n({block:"Multiline",tooltip:"如何处理换行与空格。",component:"OAVEnum",componentParam:{enumClass:t.WhiteSpaceHandle}}),N("invalidate"),C],i.prototype,"whiteSpace",void 0),Gl([n({block:"Multiline",tooltip:"文本的换行宽度。"}),N("invalidate"),C],i.prototype,"wordWrapWidth",void 0),Gl([n({block:"Multiline",tooltip:"行高。"}),N("invalidate"),C],i.prototype,"lineHeight",void 0),Gl([n({block:"Multiline",tooltip:"行距。"}),N("invalidate"),C],i.prototype,"leading",void 0),Gl([n({block:"Texture",tooltip:"内边距，用于文字被裁减问题。"}),N("invalidate"),C],i.prototype,"padding",void 0),Gl([n({block:"Texture",tooltip:"是否修剪透明边界。"}),N("invalidate"),C],i.prototype,"trim",void 0),i}(X);function ph(t,e,n,i){void 0===i&&(i=1),t=t||document.createElement("canvas"),n.fontSize<1&&(n.fontSize=1);var r,o,a=n.toFontString(),s=t.getContext("2d"),u=lh.measureText(e||" ",n,n.wordWrap,t),c=u.width,l=u.height,h=u.lines,p=u.lineHeight,f=u.lineWidths,d=u.maxLineWidth,m=u.fontProperties;t.width=Math.ceil((Math.max(1,c)+2*n.padding)*i),t.height=Math.ceil((Math.max(1,l)+2*n.padding)*i),s.scale(i,i),s.clearRect(0,0,t.width,t.height),s.font=a,s.lineWidth=n.strokeThickness,s.textBaseline=n.textBaseline,s.lineJoin=n.lineJoin,s.miterLimit=n.miterLimit;for(var y=n.dropShadow?2:1,v=0;v<y;++v){var g=n.dropShadow&&0===v,_=g?2*l:0,b=_*i;g?(s.fillStyle="black",s.strokeStyle="black",s.shadowColor=n.dropShadowColor.toRGBA(),s.shadowBlur=n.dropShadowBlur,s.shadowOffsetX=Math.cos(n.dropShadowAngle*P.DEG2RAD)*n.dropShadowDistance,s.shadowOffsetY=Math.sin(n.dropShadowAngle*P.DEG2RAD)*n.dropShadowDistance+b):(s.fillStyle=fh(t,n,h,i),s.strokeStyle=n.stroke.toRGBA(),s.shadowColor="",s.shadowBlur=0,s.shadowOffsetX=0,s.shadowOffsetY=0);for(var x=0;x<h.length;x++)r=n.strokeThickness/2,o=n.strokeThickness/2+x*p+m.ascent,"right"===n.align?r+=d-f[x]:"center"===n.align&&(r+=(d-f[x])/2),n.stroke&&n.strokeThickness&&dh(t,n,h[x],r+n.padding,o+n.padding-_,!0),n.fill&&dh(t,n,h[x],r+n.padding,o+n.padding-_)}if(n.trim){var w=function(t){var e,n,i,r=t.width,o=t.height,a=t.getContext("2d"),s=a.getImageData(0,0,r,o).data,u=s.length,c=NaN,l=NaN,h=NaN,p=NaN,f=null;for(e=0;e<u;e+=4)0!==s[e+3]&&(n=e/4%r,i=~~(e/4/r),isNaN(c)&&(c=i),(isNaN(l)||n<l)&&(l=n),(isNaN(h)||h<n)&&(h=n+1),(isNaN(p)||p<i)&&(p=i));isNaN(c)||(r=h-l,o=p-c+1,f=a.getImageData(l,c,r,o));return{height:o,width:r,data:f}}(t);w.data&&(t.width=w.width,t.height=w.height,s.putImageData(w.data,0,0))}return t}function fh(e,n,i,r){void 0===r&&(r=1);var o,a,s,u,c=e.getContext("2d"),l=n.fill;if(!Array.isArray(l))return l.toRGBA();if(1===l.length)return l[0];var h=Math.ceil(e.width/r),p=Math.ceil(e.height/r),f=l.slice(),d=n.fillGradientStops.slice();if(!d.length)for(var m=f.length+1,y=1;y<m;++y)d.push(y/m);if(f.unshift(l[0]),d.unshift(0),f.push(l[l.length-1]),d.push(1),n.fillGradientType===t.TEXT_GRADIENT.LINEAR_VERTICAL){o=c.createLinearGradient(h/2,0,h/2,p),a=(f.length+1)*i.length,s=0;for(y=0;y<i.length;y++){s+=1;for(var v=0;v<f.length;v++)u="number"==typeof d[v]?d[v]/i.length+y/i.length:s/a,o.addColorStop(u,f[v]),s++}}else{o=c.createLinearGradient(0,p/2,h,p/2),a=f.length+1,s=1;for(y=0;y<f.length;y++)u="number"==typeof d[y]?d[y]:s/a,o.addColorStop(u,f[y]),s++}return o}function dh(t,e,n,i,r,o){void 0===o&&(o=!1);var a=t.getContext("2d"),s=e.letterSpacing;if(0!==s)for(var u=i,c=Array.from(n),l=a.measureText(n).width,h=0,p=0;p<c.length;++p){var f=c[p];o?a.strokeText(f,u,r):a.fillText(f,u,r),u+=l-(h=a.measureText(n.substring(p+1)).width)+s,l=h}else o?a.strokeText(n,i,r):a.fillText(n,i,r)}var mh=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.text="Hello 🌷 world\nHello 🌷 world",e.autoSize=!0,e.style=new hh,e._uvRect=new dt(0,0,1,1),e._image=new zr,e._invalid=!0,e}return Ul(e,t),e.prototype.beforeRender=function(e,n,i){t.prototype.beforeRender.call(this,e,n,i);var r=this._canvas;this._canvas&&!this._invalid||(r=this._canvas=ph(this._canvas,this.text,this.style),this._image._pixels=r,this._image.wrapS,this._image.invalidate(),this._invalid=!1),this.autoSize&&(this.transform2D.size.x=r.width,this.transform2D.size.y=r.height),this._uvRect.z=this.transform2D.size.x/r.width,this._uvRect.w=this.transform2D.size.y/r.height,e.uniforms.s_texture=this._image,e.uniforms.u_uvRect=this._uvRect},e.prototype.invalidate=function(){this._invalid=!0},e.prototype._styleChanged=function(t,e,n){e&&e.off("changed",this.invalidate,this),n&&n.on("changed",this.invalidate,this)},Gl([n(),C,N("invalidate")],e.prototype,"text",void 0),Gl([n({tooltip:"是否根据文本自动调整宽高。"}),C],e.prototype,"autoSize",void 0),Gl([n(),C,N("_styleChanged")],e.prototype,"style",void 0),e=Gl([zi("UI/Text"),Ai()],e)}(Ei);Vr.registerPrimitive("Text",(function(t){var e=t.addComponent(Kl);t.addComponent(Zl),e.size.x=160,e.size.y=30,t.addComponent(mh)})),Vi.push({path:"UI/Text",priority:-2,click:function(){return Vr.createPrimitive("Text")}});return t.AddComponentMenu=zi,t.Animation=Fi,t.AnimationClip=Li,t.AnimationCurve=bt,t.AnimationCurveVector3=xt,t.AnyEmitter=q,t.ArcCurve2=Qe,t.ArrayBufferAsset=Ra,t.ArrayUtils=p,t.AssetData=Sr,t.Attribute=wn,t.AudioAsset=La,t.AudioListener=Yr,t.AudioSource=Qr,t.Behaviour=Di,t.Bezier=tt,t.BezierCurve=vt,t.BillboardComponent=no,t.BoundingBox=Wi,t.Box3=Dt,t.Button=ql,t.Camera=eo,t.Canvas=Yl,t.CanvasRenderer=Zl,t.CanvasTexture2D=da,t.CapsuleGeometry=na,t.CartoonComponent=io,t.CatmullRomCurve3=Je,t.ClassUtils=m,t.Color3=pt,t.Color4=yt,t.ColorKeywords=ft,t.ColorUniforms=Jo,t.Component=Ei,t.ConeGeometry=ra,t.ControllerBase=co,t.CubeGeometry=oa,t.CubicBezierCurve2=Be,t.CubicBezierCurve3=on,t.Curve=ue,t.CurvePath=le,t.CustomGeometry=qo,t.CylinderGeometry=ia,t.DataTransform=b,t.Debug=Pa,t.DirectionalLight=Ao,t.Earcut=he,t.EllipseCurve2=Ve,t.EquationSolving=J,t.Euler=Ft,t.EventEmitter=X,t.EventProxy=pi,t.FPSController=lo,t.FS=Jn,t.Feng3dObject=Ti,t.FileAsset=br,t.FolderAsset=xr,t.Font=Xe,t.ForwardRenderer=Oo,t.FrameBuffer=Sn,t.FrameBufferObject=Co,t.Frustum=kt,t.FunctionWrap=xa,t.GLCache=gn,t.GLCapabilities=_n,t.GLExtension=bn,t.GameObject=Vr,t.GameObjectAsset=Fa,t.Geometry=Tr,t.GeometryAsset=ka,t.GeometryUtils=Mr,t.Gradient=Gt,t.Graphics=ro,t.HighFunction=nt,t.HoldSizeComponent=ao,t.HoverController=po,t.HttpFS=$n,t.Image=$l,t.ImageDataTexture2D=ma,t.ImageTexture2D=ya,t.ImageUtil=Dr,t.Index=Pn,t.IndexedDBFS=ei,t.Interpolations=ke,t.JSAsset=Va,t.JsonAsset=Wa,t.KeyBoard=_i,t.KeyState=fi,t.LensBase=Jr,t.Light=To,t.LightPicker=Or,t.Line3=Tt,t.LineCurve2=ce,t.LineCurve3=an,t.Loader=Gn,t.LookAtController=ho,t.MD5AnimConverter=Za,t.MD5AnimParser=ss,t.MD5Loader=qs,t.MD5MeshConverter=Ja,t.MD5MeshParser=Ts,t.MDLLoader=Au,t.MDLParser=du,t.MTLConverter=ts,t.MTLLoader=Xu,t.MTLParser=Eu,t.MapUtils=w,t.Material=Lr,t.MaterialAsset=Ua,t.MathUtil=S,t.Matrix3x3=It,t.Matrix4x4=Nt,t.MeshRenderer=fo,t.MinMaxCurve=Mt,t.MinMaxCurveVector3=Ct,t.MinMaxGradient=Ht,t.Mouse3DManager=vo,t.MouseInput=go,t.MouseRenderer=la,t.Noise=Kt,t.OAVComponent=function(t){return function(e){t=t||e.name,r.OAVComponent[t]=e}},t.OBJConverter=ns,t.OBJParser=Yu,t.OBVComponent=function(t){return function(e){t=t||e.name,r.OBVComponent[t]=e}},t.OVComponent=function(t){return function(e){t=t||e.name,r.OVComponent[t]=e}},t.ObjLoader=Tc,t.ObjectAsset=Na,t.ObjectUtils=f,t.ObjectView=i,t.OrthographicLens=$r,t.OutLineComponent=so,t.OutlineRenderer=Do,t.ParametricGeometry=aa,t.Particle=Ol,t.ParticleColorBySpeedModule=jc,t.ParticleColorOverLifetimeModule=Lc,t.ParticleEmissionBurst=Fc,t.ParticleEmissionModule=kc,t.ParticleForceOverLifetimeModule=Bc,t.ParticleInheritVelocityModule=Uc,t.ParticleLimitVelocityOverLifetimeModule=Hc,t.ParticleMainModule=Xc,t.ParticleModule=Ic,t.ParticleNoiseModule=Zc,t.ParticleRotationBySpeedModule=tl,t.ParticleRotationOverLifetimeModule=il,t.ParticleShapeModule=fl,t.ParticleSizeBySpeedModule=yl,t.ParticleSizeOverLifetimeModule=gl,t.ParticleSubEmittersModule=bl,t.ParticleSystem=zl,t.ParticleSystemRenderer=xl,t.ParticleSystemShape=al,t.ParticleSystemShapeBox=sl,t.ParticleSystemShapeCircle=ul,t.ParticleSystemShapeCone=cl,t.ParticleSystemShapeEdge=ll,t.ParticleSystemShapeHemisphere=hl,t.ParticleSystemShapeSphere=pl,t.ParticleTextureSheetAnimationModule=wl,t.ParticleVelocityOverLifetimeModule=Cl,t.ParticlesAdditiveUniforms=El,t.ParticlesAlphaBlendedPremultiplyUniforms=Dl,t.Path2=Ge,t.PathUtils=ii,t.PerspectiveLens=to,t.Plane=At,t.PlaneGeometry=So,t.PointGeometry=Yo,t.PointLight=Bo,t.PointUniforms=$o,t.PropertyClip=Ni,t.QuadGeometry=sa,t.QuadraticBezierCurve2=We,t.QuadraticBezierCurve3=sn,t.Quaternion=jt,t.Ray3=Rt,t.RayCastable=Nr,t.Raycaster=mo,t.ReadFS=oi,t.ReadRS=wr,t.ReadWriteFS=si,t.ReadWriteRS=Xr,t.Rect=th,t.Rectangle=Bt,t.RegExps=Ca,t.RegisterComponent=Ai,t.RenderAtomic=Bn,t.RenderBuffer=Wn,t.RenderParams=zn,t.RenderTargetTexture2D=Mo,t.Renderable=Fr,t.Scene=Go,t.ScenePickCache=Uo,t.SceneUtil=pa,t.Script=xo,t.ScriptAsset=Ga,t.ScriptComponent=kr,t.Segment=Qo,t.Segment3=Ot,t.SegmentGeometry=Zo,t.SegmentUniforms=ta,t.Serialization=A,t.Shader=kn,t.ShaderAsset=Ha,t.ShaderLib=Nn,t.ShaderMacroUtils=jn,t.ShadowRenderer=Io,t.Shape2=He,t.ShapePath2=Ke,t.ShapeUtils=Le,t.ShortCut=wi,t.ShortCutCapture=di,t.SkeletonComponent=Wr,t.SkeletonJoint=Bi,t.SkinSkeleton=Hr,t.SkinSkeletonTemp=Kr,t.SkinnedMeshRenderer=Ur,t.SkyBox=Wo,t.SkyBoxRenderer=Ho,t.Sphere=Vt,t.SphereGeometry=ua,t.SplineCurve2=Ue,t.SpotLight=Vo,t.StandardUniforms=Rr,t.Stats=Aa,t.StatsPanel=Oa,t.Terrain=Ll,t.TerrainData=Nl,t.TerrainGeometry=Fl,t.TerrainMergeMethod=Vl,t.TerrainUniforms=Bl,t.Text=mh,t.TextAsset=Ba,t.TextMetrics=lh,t.TextStyle=hh,t.Texture=vn,t.Texture2D=zr,t.TextureAsset=Ka,t.TextureCube=Ir,t.TextureCubeAsset=Xa,t.TextureInfo=Er,t.TextureUniforms=ea,t.Ticker=ur,t.Timer=lr,t.TorusGeometry=ca,t.Transform=Br,t.Transform2D=Kl,t.TransformLayout=wo,t.Triangle3=Et,t.TriangleGeometry=Wt,t.UIGeometry=Ql,t.UIUniforms=Jl,t.Uuid=ga,t.Vector2=lt,t.Vector3=ht,t.Vector4=dt,t.VideoTexture2D=va,t.View=Xo,t.Watcher=F,t.Water=Ea,t.WaterUniforms=Da,t.WebGLRenderer=xn,t.WindowMouseInput=bo,t.WireframeComponent=uo,t.WireframeRenderer=Fo,t._IndexedDB=Yn,t.__class__=d,t.__functionwrap__=wa,t.__uuid__=_a,t.__watchchains__=V,t.__watchs__=B,t._indexedDB=Zn,t.anyEmitter=Y,t.assetTypeClassMap=_r,t.bezier=et,t.bezierCurve=gt,t.buildLineGeometry=function(t,e){return void 0===e&&(e={points:[],indices:[]}),(t=Object.assign({},{epsilon:1e-4,closeStroke:!1},t)).lineStyle=Object.assign({},{width:1,alignment:.5,cap:"butt",join:"miter",miterLimit:10,dashedLinePatternUnit:1},t.lineStyle),function(t,e,n){void 0===n&&(n=[]);if(!n||0===n.length)return[t];for(var i=[t[0],t[1]],r=[i],o=0,a=!0,s=n[0]*e,u=[t[0],t[1]],c=2;c<t.length;c+=2){for(var l=[t[c],t[c+1]],h=Math.sqrt((l[0]-u[0])*(l[0]-u[0])+(l[1]-u[1])*(l[1]-u[1])),p=h;p>0&&s>0;)if(s>p)a&&i.push(l[0],l[1]),s-=p,p=0;else if(s===p)a&&i.push(l[0],l[1]),p=0,(a=!a)&&(i=[l[0],l[1]],r.push(i)),s=n[++o%n.length]*e;else{var f=1-(p-=s)/h,d=u[0]+f*(l[0]-u[0]),m=u[1]+f*(l[1]-u[1]);a&&i.push(d,m),(a=!a)&&(i=[d,m],r.push(i)),s=n[++o%n.length]*e}u=l}return r}(t.points,t.lineStyle.dashedLinePatternUnit,t.lineStyle.dashedLinePattern).forEach((function(n){t.points=n,function(t,e){void 0===e&&(e={points:[],indices:[]});var n=t.points,i=t.epsilon;if(0===n.length)return e;var r=t.lineStyle,o={x:n[0],y:n[1]},a={x:n[n.length-2],y:n[n.length-1]},s=t.close,u=Math.abs(o.x-a.x)<i&&Math.abs(o.y-a.y)<i;if(s){n=n.slice(),u&&(n.pop(),n.pop(),a.x=n[n.length-2],a.y=n[n.length-1]);var c=.5*(o.x+a.x),l=.5*(a.y+o.y);n.unshift(c,l),n.push(c,l)}var h=e.points,p=n.length/2,f=n.length,d=h.length/2,m=r.width/2,y=m*m,v=r.miterLimit*r.miterLimit,g=n[0],_=n[1],b=n[2],x=n[3],w=0,S=0,P=-(_-x),M=g-b,C=0,T=0,A=Math.sqrt(P*P+M*M);P/=A,M/=A,P*=m,M*=m;var O=r.alignment,E=2*(1-O),D=2*O;s||("round"===r.cap?f+=rt(g-P*(E-D)*.5,_-M*(E-D)*.5,g-P*E,_-M*E,g+P*D,_+M*D,h,!0)+2:"square"===r.cap&&(f+=it(g,_,P,M,E,D,!0,h)));h.push(g-P*E,_-M*E),h.push(g+P*D,_+M*D);for(var z=1;z<p-1;++z){g=n[2*(z-1)],_=n[2*(z-1)+1],b=n[2*z],x=n[2*z+1],w=n[2*(z+1)],S=n[2*(z+1)+1],P=-(_-x),M=g-b,P/=A=Math.sqrt(P*P+M*M),M/=A,P*=m,M*=m,C=-(x-S),T=b-w,C/=A=Math.sqrt(C*C+T*T),T/=A,C*=m,T*=m;var I=b-g,j=_-x,R=b-w,L=S-x,N=j*R-L*I,F=N<0;if(Math.abs(N)<.1)h.push(b-P*E,x-M*E),h.push(b+P*D,x+M*D);else{var k=(-P+g)*(-M+x)-(-P+b)*(-M+_),B=(-C+w)*(-T+x)-(-C+b)*(-T+S),V=(I*B-R*k)/N,W=(L*k-j*B)/N,U=(V-b)*(V-b)+(W-x)*(W-x),G=b+(V-b)*E,H=x+(W-x)*E,K=b-(V-b)*D,X=x-(W-x)*D,q=F?E:D;U<=Math.min(I*I+j*j,R*R+L*L)+q*q*y?"bevel"===r.join||U/y>v?(F?(h.push(G,H),h.push(b+P*D,x+M*D),h.push(G,H),h.push(b+C*D,x+T*D)):(h.push(b-P*E,x-M*E),h.push(K,X),h.push(b-C*E,x-T*E),h.push(K,X)),f+=2):"round"===r.join?F?(h.push(G,H),h.push(b+P*D,x+M*D),f+=rt(b,x,b+P*D,x+M*D,b+C*D,x+T*D,h,!0)+4,h.push(G,H),h.push(b+C*D,x+T*D)):(h.push(b-P*E,x-M*E),h.push(K,X),f+=rt(b,x,b-P*E,x-M*E,b-C*E,x-T*E,h,!1)+4,h.push(b-C*E,x-T*E),h.push(K,X)):(h.push(G,H),h.push(K,X)):(h.push(b-P*E,x-M*E),h.push(b+P*D,x+M*D),"bevel"===r.join||U/y>v||("round"===r.join?f+=F?rt(b,x,b+P*D,x+M*D,b+C*D,x+T*D,h,!0)+2:rt(b,x,b-P*E,x-M*E,b-C*E,x-T*E,h,!1)+2:(F?(h.push(K,X),h.push(K,X)):(h.push(G,H),h.push(G,H)),f+=2)),h.push(b-C*E,x-T*E),h.push(b+C*D,x+T*D),f+=2)}}g=n[2*(p-2)],_=n[2*(p-2)+1],b=n[2*(p-1)],x=n[2*(p-1)+1],P=-(_-x),M=g-b,A=Math.sqrt(P*P+M*M),P/=A,M/=A,P*=m,M*=m,h.push(b-P*E,x-M*E),h.push(b+P*D,x+M*D),s||("round"===r.cap?f+=rt(b-P*(E-D)*.5,x-M*(E-D)*.5,b-P*E,x-M*E,b+P*D,x+M*D,h,!1)+2:"square"===r.cap&&(f+=it(b,x,P,M,E,D,!1,h)));var Y=e.indices,Z=t.epsilon*t.epsilon;for(z=d;z<f+d-2;++z)g=h[2*z],_=h[2*z+1],b=h[2*(z+1)],x=h[2*(z+1)+1],w=h[2*(z+2)],S=h[2*(z+2)+1],Math.abs(g*(x-S)+b*(S-_)+w*(_-x))<Z||Y.push(z,z+1,z+2)}(t,e)})),e},t.classUtils=y,t.componentMap={},t.createGrad=Xt,t.createNodeMenu=Vi,t.dataTransform=x,t.debug=Ma,t.debuger=!0,t.decoratorRegisterClass=function(t){return function(e){_(e,t)}},t.drawText=ph,t.equationSolving=$,t.forwardRenderer=Eo,t.functionwrap=Sa,t.geometryUtils=Cr,t.getAssetTypeClass=function(t){return _r[t]},t.getBits=Zt,t.getComponentType=Oi,t.globalEmitter=Z,t.indexedDBFS=ni,t.lazy=M,t.loader=Hn,t.mathUtil=P,t.md5AnimConverter=Qa,t.md5AnimParser=us,t.md5Loader=Ys,t.md5MeshConverter=$a,t.md5MeshParser=As,t.mdlLoader=Ou,t.mdlParser=mu,t.menuConfig=ji,t.mouseRenderer=ha,t.mtlConverter=es,t.mtlLoader=qu,t.mtlParser=Du,t.noise=se,t.oav=n,t.objConverter=is,t.objLoader=Ac,t.objParser=Zu,t.objectEmitter=Q,t.objectview=r,t.outlineRenderer=zo,t.ov=e,t.path=sr,t.pathUtils=ri,t.raycaster=yo,t.regExps=Ta,t.registerClass=_,t.sceneUtil=fa,t.serialization=E,t.serialize=C,t.setAssetTypeClass=gr,t.shaderConfig=Ln,t.shaderMacroUtils=Rn,t.shaderlib=Fn,t.shadowRenderer=jo,t.shortcut=Si,t.skyboxRenderer=Ko,t.task=Un,t.ticker=cr,t.uuid=ba,t.version="0.1.3",t.watch=N,t.watchContext2D=oo,t.watcher=k,t.windowEventProxy=bi,t.wireframeRenderer=ko,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
//# sourceMappingURL=index.min.js.map
